<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.50" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://hanekawa.top/document/node-doc/Command-line%20API.html"><meta property="og:site_name" content="hanekawa-shiki"><meta property="og:title" content="Command-line API"><meta property="og:description" content="Command-line API Node.js çš„å‘½ä»¤è¡Œ API æŒ‡çš„æ˜¯ä¸€ç³»åˆ—åœ¨ Node.js ç¯å¢ƒä¸‹é€šè¿‡å‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰å¯ä»¥ä½¿ç”¨çš„åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½å…è®¸å¼€å‘è€…æ‰§è¡Œå„ç§æ“ä½œï¼Œæ¯”å¦‚è¿è¡Œè„šæœ¬ã€ç®¡ç†æ¨¡å—å’Œäº¤äº’å¼è°ƒè¯•ç­‰ã€‚ åœ¨ Node.js v21.7.1 ä¸­ï¼Œå‘½ä»¤è¡Œ API æä¾›äº†å¾ˆå¤šé€‰é¡¹ï¼Œä½†ç”±äºä½ å¯èƒ½æ˜¯ç¼–ç¨‹æ–°æ‰‹ï¼Œæˆ‘ä¼šå…ˆè§£é‡Šä¸€äº›åŸºç¡€çš„æ¦‚å¿µå’Œå¸¸ç”¨å‘½ä»¤ã€‚ ä¸€..."><meta property="og:type" content="website"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-06-21T09:46:17.000Z"><meta property="article:author" content="hanekawa-shiki"><meta property="article:modified_time" content="2024-06-21T09:46:17.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"WebPage","name":"Command-line API","description":"Command-line API Node.js çš„å‘½ä»¤è¡Œ API æŒ‡çš„æ˜¯ä¸€ç³»åˆ—åœ¨ Node.js ç¯å¢ƒä¸‹é€šè¿‡å‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰å¯ä»¥ä½¿ç”¨çš„åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½å…è®¸å¼€å‘è€…æ‰§è¡Œå„ç§æ“ä½œï¼Œæ¯”å¦‚è¿è¡Œè„šæœ¬ã€ç®¡ç†æ¨¡å—å’Œäº¤äº’å¼è°ƒè¯•ç­‰ã€‚ åœ¨ Node.js v21.7.1 ä¸­ï¼Œå‘½ä»¤è¡Œ API æä¾›äº†å¾ˆå¤šé€‰é¡¹ï¼Œä½†ç”±äºä½ å¯èƒ½æ˜¯ç¼–ç¨‹æ–°æ‰‹ï¼Œæˆ‘ä¼šå…ˆè§£é‡Šä¸€äº›åŸºç¡€çš„æ¦‚å¿µå’Œå¸¸ç”¨å‘½ä»¤ã€‚ ä¸€..."}</script><meta name="keywords" content="JavaScript,HTML,CSS"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icons/chrome-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icons/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#5c92d1"><link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="white"><meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><title>Command-line API | hanekawa-shiki</title><meta name="description" content="Command-line API Node.js çš„å‘½ä»¤è¡Œ API æŒ‡çš„æ˜¯ä¸€ç³»åˆ—åœ¨ Node.js ç¯å¢ƒä¸‹é€šè¿‡å‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰å¯ä»¥ä½¿ç”¨çš„åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½å…è®¸å¼€å‘è€…æ‰§è¡Œå„ç§æ“ä½œï¼Œæ¯”å¦‚è¿è¡Œè„šæœ¬ã€ç®¡ç†æ¨¡å—å’Œäº¤äº’å¼è°ƒè¯•ç­‰ã€‚ åœ¨ Node.js v21.7.1 ä¸­ï¼Œå‘½ä»¤è¡Œ API æä¾›äº†å¾ˆå¤šé€‰é¡¹ï¼Œä½†ç”±äºä½ å¯èƒ½æ˜¯ç¼–ç¨‹æ–°æ‰‹ï¼Œæˆ‘ä¼šå…ˆè§£é‡Šä¸€äº›åŸºç¡€çš„æ¦‚å¿µå’Œå¸¸ç”¨å‘½ä»¤ã€‚ ä¸€...">
    <link rel="stylesheet" href="/assets/css/styles.2fe8dfd0.css">
    <link rel="preload" href="/assets/js/runtime~app.e98858ae.js" as="script"><link rel="preload" href="/assets/css/styles.2fe8dfd0.css" as="style"><link rel="preload" href="/assets/js/9435.209d772b.js" as="script"><link rel="preload" href="/assets/js/app.604dc302.js" as="script">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo light" src="/assets/svg/logo.svg" alt><img class="vp-nav-logo dark" src="/assets/svg/logo.svg" alt><span class="vp-site-name hide-in-pad">hanekawa-shiki</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="åšå®¢ä¸»é¡µ"><!--[--><span class="font-icon icon home" style=""></span><!--]-->åšå®¢ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="å­¦ä¹ ç¬”è®°"><!--[--><span class="font-icon icon framework" style=""></span>å­¦ä¹ ç¬”è®°<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">å‰ç«¯æ¡†æ¶</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/vue3/" aria-label="Vue3ç¬”è®°"><!--[--><span class="font-icon icon vue" style=""></span><!--]-->Vue3ç¬”è®°<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/react/" aria-label="Reactç¬”è®°"><!--[--><span class="font-icon icon react" style=""></span><!--]-->Reactç¬”è®°<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ–‡æ¡£"><!--[--><span class="font-icon icon framework" style=""></span>æ–‡æ¡£<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">æ¬è¿</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li></ul></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/hanekawa-shiki/hanekawa-shiki.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Assert.html" aria-label="Assert"><!---->Assert<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Async%20hooks.html" aria-label="Async hooks"><!---->Async hooks<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Asynchronous%20context%20tracking.html" aria-label="Asynchronous context tracking"><!---->Asynchronous context tracking<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Buffer.html" aria-label="Buffer"><!---->Buffer<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20addons.html" aria-label="C++ addons"><!---->C++ addons<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20embedder%20API.html" aria-label="C++ embedder API"><!---->C++ embedder API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Child%20process.html" aria-label="Child process"><!---->Child process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Cluster.html" aria-label="Cluster"><!---->Cluster<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/document/node-doc/Command-line%20API.html" aria-label="Command-line API"><!---->Command-line API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Console.html" aria-label="Console"><!---->Console<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Corepack.html" aria-label="Corepack"><!---->Corepack<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Crypto.html" aria-label="Crypto"><!---->Crypto<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Debugger.html" aria-label="Debugger"><!---->Debugger<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Deprecated%20APIs.html" aria-label="Deprecated APIs"><!---->Deprecated APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostic%20report.html" aria-label="Diagnostic report"><!---->Diagnostic report<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostics%20Channel.html" aria-label="Diagnostics Channel"><!---->Diagnostics Channel<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/DNS.html" aria-label="DNS"><!---->DNS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Domain.html" aria-label="Domain"><!---->Domain<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Errors.html" aria-label="Errors"><!---->Errors<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Events.html" aria-label="Events"><!---->Events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/File%20system.html" aria-label="File system"><!---->File system<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Global%20objects.html" aria-label="Global objects"><!---->Global objects<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTP.html" aria-label="HTTP"><!---->HTTP<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTPS.html" aria-label="HTTPS"><!---->HTTPS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Inspector.html" aria-label="Inspector"><!---->Inspector<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Internationalization%20support.html" aria-label="Internationalization support"><!---->Internationalization support<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-CommonJS%20modules.html" aria-label="Modules: CommonJS modules"><!---->Modules: CommonJS modules<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-ECMAScript%20modules.html" aria-label="Modules: ECMAScript modules"><!---->Modules: ECMAScript modules<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-node_module%20API.html" aria-label="Modules: node:module API"><!---->Modules: node:module API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-Packages.html" aria-label="Modules: Packages"><!---->Modules: Packages<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Net.html" aria-label="Net"><!---->Net<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Node-API.html" aria-label="Node-API"><!---->Node-API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/OS.html" aria-label="OS"><!---->OS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Path.html" aria-label="Path"><!---->Path<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Performance%20measurement%20APIs.html" aria-label="Performance measurement APIs"><!---->Performance measurement APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Permissions.html" aria-label="Permissions"><!---->Permissions<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Process.html" aria-label="Process"><!---->Process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Punycode.html" aria-label="Punycode"><!---->Punycode<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Query%20string.html" aria-label="Query string"><!---->Query string<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Readline.html" aria-label="Readline"><!---->Readline<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/REPL.html" aria-label="REPL"><!---->REPL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Stream.html" aria-label="Stream"><!---->Stream<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/String%20decoder.html" aria-label="String decoder"><!---->String decoder<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Test%20runner.html" aria-label="Test runner"><!---->Test runner<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Timers.html" aria-label="Timers"><!---->Timers<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TLS%20(SSL).html" aria-label="TLS (SSL)"><!---->TLS (SSL)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Trace%20events.html" aria-label="Trace events"><!---->Trace events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TTY.html" aria-label="TTY"><!---->TTY<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/URL.html" aria-label="URL"><!---->URL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Util.html" aria-label="Util"><!---->Util<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/V8.html" aria-label="V8"><!---->V8<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/VM%20(executing%20JavaScript).html" aria-label="VM (executing JavaScript)"><!---->VM (executing JavaScript)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Crypto%20API.html" aria-label="Web Crypto API"><!---->Web Crypto API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Streams%20API.html" aria-label="Web Streams API"><!---->Web Streams API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/WebAssembly%20System%20Interface%20(WASI).html" aria-label="WebAssembly System Interface (WASI)"><!---->WebAssembly System Interface (WASI)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Worker%20threads.html" aria-label="Worker threads"><!---->Worker threads<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Zlib.html" aria-label="Zlib"><!---->Zlib<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Command-line API</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://hanekawa.top" target="_blank" rel="noopener noreferrer">hanekawa-shiki</a></span><span property="author" content="hanekawa-shiki"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-21T09:46:17.000Z"></span><!----><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 364 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT364M"></span><span class="page-word-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon" name="word"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 109069 å­—</span><meta property="wordCount" content="109069"></span><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#synopsis">Synopsis</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#program-entry-point">Program entry point</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ecmascript-modules-loader-entry-point-caveat">ECMAScript modules loader entry point caveat</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#options">Options</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#">-</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#-1">--</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1-è¿è¡Œè„šæœ¬å¹¶ä¼ é€’å‚æ•°">ç¤ºä¾‹ 1ï¼šè¿è¡Œè„šæœ¬å¹¶ä¼ é€’å‚æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2-ä¸-npm-scripts-ç»“åˆä½¿ç”¨">ç¤ºä¾‹ 2ï¼šä¸ npm scripts ç»“åˆä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#abort-on-uncaught-exception">--abort-on-uncaught-exception</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#allow-addons">--allow-addons</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨-allow-addons-é€‰é¡¹">ä½¿ç”¨ --allow-addons é€‰é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­">ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#allow-child-process">--allow-child-process</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#allow-fs-read">--allow-fs-read</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#allow-fs-write">--allow-fs-write</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1-ä½¿ç”¨-allow-fs-write-è¿è¡Œè„šæœ¬">ç¤ºä¾‹ 1ï¼šä½¿ç”¨ --allow-fs-write è¿è¡Œè„šæœ¬</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2-æ²™ç®±ç¯å¢ƒä¸­å…è®¸æ–‡ä»¶å†™æ“ä½œ">ç¤ºä¾‹ 2ï¼šæ²™ç®±ç¯å¢ƒä¸­å…è®¸æ–‡ä»¶å†™æ“ä½œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#allow-worker">--allow-worker</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#build-snapshot">--build-snapshot</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#build-snapshot-config">--build-snapshot-config</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#c-check">-c, --check</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#completion-bash">--completion-bash</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#c-condition-conditions-condition">-C condition, --conditions=condition</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cpu-prof">--cpu-prof</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cpu-prof-dir">--cpu-prof-dir</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cpu-prof-interval">--cpu-prof-interval</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cpu-prof-name">--cpu-prof-name</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#diagnostic-dir-directory">--diagnostic-dir=directory</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨ä¾‹å­">ä½¿ç”¨ä¾‹å­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#disable-warning-code-or-type">--disable-warning=code-or-type</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#disable-proto-mode">--disable-proto=mode</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#disallow-code-generation-from-strings">--disallow-code-generation-from-strings</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#dns-result-order-order">--dns-result-order=order</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#enable-fips">--enable-fips</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#fips-æ¨¡å¼">FIPS æ¨¡å¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#enable-fips-é€‰é¡¹">--enable-fips é€‰é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨ä¸¾ä¾‹">ä½¿ç”¨ä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨">å®é™…è¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#enable-network-family-autoselection">--enable-network-family-autoselection</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#enable-source-maps">--enable-source-maps</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#env-file-config">--env-file=config</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1-åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶">ç¤ºä¾‹ 1ï¼šåˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2-å¯åŠ¨-node-js-åº”ç”¨ç¨‹åºæ—¶åŠ è½½ç¯å¢ƒå˜é‡">ç¤ºä¾‹ 2ï¼šå¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶åŠ è½½ç¯å¢ƒå˜é‡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-3-åœ¨åº”ç”¨ä»£ç ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡">ç¤ºä¾‹ 3ï¼šåœ¨åº”ç”¨ä»£ç ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#e-eval-script">-e, --eval &quot;script&quot;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-æ‰§è¡Œç®€å•è¡¨è¾¾å¼">ä¾‹å­ 1: æ‰§è¡Œç®€å•è¡¨è¾¾å¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-ä½¿ç”¨-json">ä¾‹å­ 2: ä½¿ç”¨ JSON</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-3-ä½¿ç”¨æ¨¡å—">ä¾‹å­ 3: ä½¿ç”¨æ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-4-å¤æ‚çš„é€»è¾‘">ä¾‹å­ 4: å¤æ‚çš„é€»è¾‘</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-5-iife-ç«‹å³è°ƒç”¨çš„å‡½æ•°è¡¨è¾¾å¼">ä¾‹å­ 5: IIFEï¼ˆç«‹å³è°ƒç”¨çš„å‡½æ•°è¡¨è¾¾å¼ï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#experimental-default-type-type">--experimental-default-type=type</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#experimental-detect-module">--experimental-detect-module</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#experimental-import-meta-resolve">--experimental-import-meta-resolve</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#experimental-loader-module">--experimental-loader=module</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#experimental-network-imports">--experimental-network-imports</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-1">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹-1">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#experimental-permission">--experimental-permission</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#experimental-policy">--experimental-policy</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#experimental-sea-config">--experimental-sea-config</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-1-å¯ç”¨-sea-åŠŸèƒ½">å®ä¾‹ 1ï¼šå¯ç”¨ SEA åŠŸèƒ½</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-2-å°†åº”ç”¨ç¨‹åºæ‰“åŒ…ä¸º-sea-æ–‡ä»¶">å®ä¾‹ 2ï¼šå°†åº”ç”¨ç¨‹åºæ‰“åŒ…ä¸º SEA æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-3-è¿è¡Œ-sea-æ–‡ä»¶">å®ä¾‹ 3ï¼šè¿è¡Œ SEA æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#experimental-shadow-realm">--experimental-shadow-realm</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#shadowrealm-æ˜¯ä»€ä¹ˆ">ShadowRealm æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-experimental-shadow-realm">å¦‚ä½•ä½¿ç”¨ --experimental-shadow-realm</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#experimental-test-coverage">--experimental-test-coverage</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#experimental-vm-modules">--experimental-vm-modules</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#experimental-wasi-unstable-preview1">--experimental-wasi-unstable-preview1</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#experimental-wasm-modules">--experimental-wasm-modules</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆè¢«æ ‡è®°ä¸ºå®éªŒæ€§-experimental">ä¸ºä»€ä¹ˆè¢«æ ‡è®°ä¸ºå®éªŒæ€§ï¼ˆExperimentalï¼‰ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-experimental-wasm-modules">å¦‚ä½•ä½¿ç”¨ --experimental-wasm-modulesï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-1">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#experimental-websocket">--experimental-websocket</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#force-context-aware">--force-context-aware</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#force-fips">--force-fips</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-force-fips">å¦‚ä½•ä½¿ç”¨ --force-fips</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-1">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#force-node-api-uncaught-exceptions-policy">--force-node-api-uncaught-exceptions-policy</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#frozen-intrinsics">--frozen-intrinsics</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ¦‚å¿µ">æ¦‚å¿µï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#frozen-intrinsics-é€‰é¡¹">--frozen-intrinsics é€‰é¡¹ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#heap-prof">--heap-prof</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨-heap-prof">ä½¿ç”¨ --heap-prof</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-2">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#heap-prof-dir">--heap-prof-dir</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-1-æŸ¥æ‰¾å†…å­˜æ³„æ¼">å®é™…ä¾‹å­ 1ï¼šæŸ¥æ‰¾å†…å­˜æ³„æ¼</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-2-æ€§èƒ½ä¼˜åŒ–">å®é™…ä¾‹å­ 2ï¼šæ€§èƒ½ä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#heap-prof-interval">--heap-prof-interval</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#heap-prof-name">--heap-prof-name</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨-heap-prof-name-çš„ä¾‹å­">ä½¿ç”¨ --heap-prof-name çš„ä¾‹å­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#heapsnapshot-near-heap-limit-max-count">--heapsnapshot-near-heap-limit=max_count</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#heapsnapshot-signal-signal">--heapsnapshot-signal=signal</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#h-help">-h, --help</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#icu-data-dir-file">--icu-data-dir=file</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#import-module">--import=module</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#input-type-type">--input-type=type</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1-ç›´æ¥æ‰§è¡Œå­—ç¬¦ä¸²ä»£ç ">ç¤ºä¾‹ 1ï¼šç›´æ¥æ‰§è¡Œå­—ç¬¦ä¸²ä»£ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2-ä½¿ç”¨æ–‡ä»¶é‡å®šå‘æ‰§è¡Œæ¨¡å—ä»£ç ">ç¤ºä¾‹ 2ï¼šä½¿ç”¨æ–‡ä»¶é‡å®šå‘æ‰§è¡Œæ¨¡å—ä»£ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#insecure-http-parser">--insecure-http-parser</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#inspect-host-port">--inspect[=[host:]port]</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬ç”¨æ³•">åŸºæœ¬ç”¨æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æŒ‡å®šä¸»æœºå’Œç«¯å£">æŒ‡å®šä¸»æœºå’Œç«¯å£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è¿æ¥è°ƒè¯•å®¢æˆ·ç«¯">è¿æ¥è°ƒè¯•å®¢æˆ·ç«¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-2">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#inspect-brk-host-port">--inspect-brk[=[host:]port]</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#inspect-port-host-port">--inspect-port=[host:]port</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#inspect-publish-uid-stderr-http">--inspect-publish-uid=stderr,http</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#inspect-publish-uid">--inspect-publish-uid</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-3">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#i-interactive">-i, --interactive</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#jitless">--jitless</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#max-http-header-size-size">--max-http-header-size=size</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-3">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#napi-modules">--napi-modules</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#no-addons">--no-addons</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#no-deprecation">--no-deprecation</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#no-experimental-fetch">--no-experimental-fetch</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#no-experimental-global-customevent">--no-experimental-global-customevent</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#no-experimental-global-navigator">--no-experimental-global-navigator</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#no-experimental-global-webcrypto">--no-experimental-global-webcrypto</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#no-experimental-repl-await">--no-experimental-repl-await</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#no-extra-info-on-fatal-exception">--no-extra-info-on-fatal-exception</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#no-force-async-hooks-checks">--no-force-async-hooks-checks</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¼‚æ­¥é’©å­-async-hooks">å¼‚æ­¥é’©å­ï¼ˆAsync Hooksï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#no-force-async-hooks-checks-1">--no-force-async-hooks-checks</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#no-global-search-paths">--no-global-search-paths</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#no-network-family-autoselection">--no-network-family-autoselection</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#no-warnings">--no-warnings</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-memory-debug">--node-memory-debug</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-1-è·Ÿè¸ªæ™®é€šçš„-node-js-åº”ç”¨ç¨‹åºå†…å­˜ä½¿ç”¨æƒ…å†µ">å®ä¾‹ 1ï¼šè·Ÿè¸ªæ™®é€šçš„ Node.js åº”ç”¨ç¨‹åºå†…å­˜ä½¿ç”¨æƒ…å†µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹-2-è°ƒè¯•å†…å­˜æ³„éœ²">å®ä¾‹ 2ï¼šè°ƒè¯•å†…å­˜æ³„éœ²</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹-2">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#openssl-config-file">--openssl-config=file</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-openssl">ä»€ä¹ˆæ˜¯ OpenSSLï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆéœ€è¦æŒ‡å®š-openssl-é…ç½®æ–‡ä»¶">ä¸ºä»€ä¹ˆéœ€è¦æŒ‡å®š OpenSSL é…ç½®æ–‡ä»¶ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-openssl-config-file">å¦‚ä½•ä½¿ç”¨--openssl-config=fileï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-3">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#openssl-legacy-provider">--openssl-legacy-provider</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-4">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#openssl-shared-config">--openssl-shared-config</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#pending-deprecation">--pending-deprecation</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#policy-integrity-sri">--policy-integrity=sri</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#preserve-symlinks">--preserve-symlinks</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#preserve-symlinks-main">--preserve-symlinks-main</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#p-print-script">-p, --print &quot;script&quot;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#prof">--prof</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-prof">å¦‚ä½•ä½¿ç”¨ --prof?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€æ ·é˜…è¯»-v8-log-æ–‡ä»¶">æ€æ ·é˜…è¯» v8.log æ–‡ä»¶ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-5">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#prof-process">--prof-process</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#redirect-warnings-file">--redirect-warnings=file</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#report-compact">--report-compact</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-6">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#report-dir-directory-report-directory-directory">--report-dir=directory, report-directory=directory</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#report-filename-filename">--report-filename=filename</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è¯Šæ–­æŠ¥å‘Šæ˜¯ä»€ä¹ˆ">è¯Šæ–­æŠ¥å‘Šæ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-report-filename">å¦‚ä½•ä½¿ç”¨ --report-filenameï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-1">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#report-on-fatalerror">--report-on-fatalerror</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1-å¯ç”¨æŠ¥å‘Šç”Ÿæˆ">ç¤ºä¾‹ 1ï¼šå¯ç”¨æŠ¥å‘Šç”Ÿæˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2-åˆ†ææŠ¥å‘Šå†…å®¹">ç¤ºä¾‹ 2ï¼šåˆ†ææŠ¥å‘Šå†…å®¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-3-åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ•è·è‡´å‘½é”™è¯¯">ç¤ºä¾‹ 3ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ•è·è‡´å‘½é”™è¯¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#report-on-signal">--report-on-signal</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#report-signal-signal">--report-signal=signal</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-è§¦å‘ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š">ä¾‹å­ 1ï¼šè§¦å‘ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-è‡ªåŠ¨åŒ–å¤„ç†">ä¾‹å­ 2ï¼šè‡ªåŠ¨åŒ–å¤„ç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#report-uncaught-exception">--report-uncaught-exception</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#r-require-module">-r, --require module</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-4">å®é™…ä¾‹å­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#secure-heap-n">--secure-heap=n</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#secure-heap-min-n">--secure-heap-min=n</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®è·µä¾‹å­">å®è·µä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#snapshot-blob-path">--snapshot-blob=path</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#test">--test</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#test-concurrency">--test-concurrency</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#test-name-pattern">--test-name-pattern</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#test-only">--test-only</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#test-reporter">--test-reporter</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#test-reporter-destination">--test-reporter-destination</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#test-shard">--test-shard</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#test-timeout">--test-timeout</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#throw-deprecation">--throw-deprecation</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#title-title">--title=title</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-cipher-list-list">--tls-cipher-list=list</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è¯¦ç»†è§£é‡Š">è¯¦ç»†è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-1">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹-3">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-keylog-file">--tls-keylog=file</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1-è°ƒè¯•-https-æœåŠ¡å™¨">ç¤ºä¾‹ 1ï¼šè°ƒè¯• HTTPS æœåŠ¡å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2-åˆ†æ-websocket-secure-wss-é€šä¿¡">ç¤ºä¾‹ 2ï¼šåˆ†æ WebSocket Secure (WSS) é€šä¿¡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-max-v1-2">--tls-max-v1.2</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-max-v1-3">--tls-max-v1.3</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-7">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-min-v1-0">--tls-min-v1.0</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£é‡Š-tls-min-v1-0">è§£é‡Š --tls-min-v1.0</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-4">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-min-v1-1">--tls-min-v1.1</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-min-v1-2">--tls-min-v1.2</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tls-min-v1-3">--tls-min-v1.3</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#trace-atomics-wait">--trace-atomics-wait</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#trace-deprecation">--trace-deprecation</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#trace-event-categories">--trace-event-categories</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#trace-event-file-pattern">--trace-event-file-pattern</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å ä½ç¬¦">å ä½ç¬¦</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹-4">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#trace-events-enabled">--trace-events-enabled</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#trace-exit">--trace-exit</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-5">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#trace-sigint">--trace-sigint</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#trace-sync-io">--trace-sync-io</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯åŒæ­¥-i-o-æ“ä½œ">ä»€ä¹ˆæ˜¯åŒæ­¥ I/O æ“ä½œï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä½•éœ€è¦é¿å…åŒæ­¥-i-o">ä¸ºä½•éœ€è¦é¿å…åŒæ­¥ I/Oï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-trace-sync-ioæ ‡å¿—">å¦‚ä½•ä½¿ç”¨--trace-sync-ioæ ‡å¿—ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-8">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#trace-tls">--trace-tls</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#trace-uncaught">--trace-uncaught</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#trace-warnings">--trace-warnings</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-6">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#track-heap-objects">--track-heap-objects</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#unhandled-rejections-mode">--unhandled-rejections=mode</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#strict-æ¨¡å¼">strict æ¨¡å¼ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#warn-æ¨¡å¼">warn æ¨¡å¼ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#none-æ¨¡å¼">none æ¨¡å¼ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#use-bundled-ca-use-openssl-ca">--use-bundled-ca, --use-openssl-ca</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#use-largepages-mode">--use-largepages=mode</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#v8-options">--v8-options</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#v8-pool-size-num">--v8-pool-size=num</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#v-version">-v, --version</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-æ£€æŸ¥-node-js-ç‰ˆæœ¬">ä¾‹å­ 1ï¼šæ£€æŸ¥ Node.js ç‰ˆæœ¬</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-ç¼–å†™è„šæœ¬æ£€æµ‹-node-js-ç‰ˆæœ¬">ä¾‹å­ 2ï¼šç¼–å†™è„šæœ¬æ£€æµ‹ Node.js ç‰ˆæœ¬</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-3-åˆ›å»ºå®‰è£…è„šæœ¬">ä¾‹å­ 3ï¼šåˆ›å»ºå®‰è£…è„šæœ¬</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#watch">--watch</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#watch-path">--watch-path</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#watch-preserve-output">--watch-preserve-output</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#zero-fill-buffers">--zero-fill-buffers</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1-æœªä½¿ç”¨-zero-fill-buffers">ç¤ºä¾‹ 1ï¼šæœªä½¿ç”¨ --zero-fill-buffers</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2-ä½¿ç”¨-zero-fill-buffers">ç¤ºä¾‹ 2ï¼šä½¿ç”¨ --zero-fill-buffers</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯-1">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#environment-variables">Environment variables</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#force-color-1-2-3">FORCE_COLOR=[1, 2, 3]</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-9">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#no-color-any">NO_COLOR=&lt;`any`&gt;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-debug-module">NODE_DEBUG=module[,â€¦]</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-debug-native-module">NODE_DEBUG_NATIVE=module[,â€¦]</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-disable-colors-1">NODE_DISABLE_COLORS=1</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-1-åœ¨å‘½ä»¤è¡Œä¸­ä¸´æ—¶ç¦ç”¨é¢œè‰²">ç¤ºä¾‹ 1ï¼šåœ¨å‘½ä»¤è¡Œä¸­ä¸´æ—¶ç¦ç”¨é¢œè‰²</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-2-åœ¨-windows-ç³»ç»Ÿä¸­æ°¸ä¹…ç¦ç”¨é¢œè‰²">ç¤ºä¾‹ 2ï¼šåœ¨ Windows ç³»ç»Ÿä¸­æ°¸ä¹…ç¦ç”¨é¢œè‰²</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹-3-åœ¨-unix-like-ç³»ç»Ÿä¸­æ°¸ä¹…ç¦ç”¨é¢œè‰²">ç¤ºä¾‹ 3ï¼šåœ¨ Unix-like ç³»ç»Ÿä¸­æ°¸ä¹…ç¦ç”¨é¢œè‰²</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-extra-ca-certs-file">NODE_EXTRA_CA_CERTS=file</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-icu-data-file">NODE_ICU_DATA=file</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-no-warnings-1">NODE_NO_WARNINGS=1</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-node-no-warnings-1">å¦‚ä½•ä½¿ç”¨ NODE_NO_WARNINGS=1</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-7">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹-5">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-options-options">NODE_OPTIONS=options...</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-è®¾ç½®æœ€å¤§å†…å­˜">1. è®¾ç½®æœ€å¤§å†…å­˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-å¯ç”¨-es6-æ¨¡å—">2. å¯ç”¨ ES6 æ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-é¢„åŠ è½½æ¨¡å—">3. é¢„åŠ è½½æ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-è°ƒè¯•å’Œæ€§èƒ½åˆ†æ">4. è°ƒè¯•å’Œæ€§èƒ½åˆ†æ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹-6">æ³¨æ„äº‹é¡¹ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-path-path">NODE_PATH=path[:â€¦]</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-pending-deprecation-1">NODE_PENDING_DEPRECATION=1</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-pending-pipe-instances-instances">NODE_PENDING_PIPE_INSTANCES=instances</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-preserve-symlinks-1">NODE_PRESERVE_SYMLINKS=1</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-redirect-warnings-file">NODE_REDIRECT_WARNINGS=file</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-repl-external-module-file">NODE_REPL_EXTERNAL_MODULE=file</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-åˆ›å»ºä¸€ä¸ª-node-js-æ–‡ä»¶">1. åˆ›å»ºä¸€ä¸ª Node.js æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-è®¾ç½®ç¯å¢ƒå˜é‡">2. è®¾ç½®ç¯å¢ƒå˜é‡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-ä½¿ç”¨-repl">3. ä½¿ç”¨ REPL</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-repl-history-file">NODE_REPL_HISTORY=file</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-skip-platform-check-value">NODE_SKIP_PLATFORM_CHECK=value</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-test-context-value">NODE_TEST_CONTEXT=value</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-tls-reject-unauthorized-value">NODE_TLS_REJECT_UNAUTHORIZED=value</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å€¼è§£é‡Š">å€¼è§£é‡Šï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹">ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹-7">æ³¨æ„äº‹é¡¹ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-v8-coverage-dir">NODE_V8_COVERAGE=dir</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-1">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-coverage-output">ä»€ä¹ˆæ˜¯ Coverage outputï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-node-js-çš„-coverage-output">å¦‚ä½•ä½¿ç”¨ Node.js çš„ Coverage outputï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-8">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#openssl-conf-file">OPENSSL_CONF=file</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ssl-cert-dir-dir">SSL_CERT_DIR=dir</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ssl-å’Œè¯ä¹¦">SSL å’Œè¯ä¹¦</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¯å¢ƒå˜é‡-ssl-cert-dir">ç¯å¢ƒå˜é‡ SSL_CERT_DIR</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-5">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ssl-cert-file-file">SSL_CERT_FILE=file</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tz">TZ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-9">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹-8">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#uv-threadpool-size-size">UV_THREADPOOL_SIZE=size</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ">ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#uv-threadpool-size-çš„ä½œç”¨">UV_THREADPOOL_SIZE çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-2">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹-9">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#uv-use-io-uring-value">UV_USE_IO_URING=value</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-10">å®é™…ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#useful-v8-options">Useful V8 options</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-max-old-space-size">1. --max-old-space-size</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-optimize-for-size">2. --optimize-for-size</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-trace-deprecation">3. --trace-deprecation</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-prof">4. --prof</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-allow-natives-syntax">5. --allow-natives-syntax</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#max-old-space-size-size-in-megabytes">--max-old-space-size=SIZE (in megabytes)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-10">å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#max-semi-space-size-size-in-megabytes">--max-semi-space-size=SIZE (in megabytes)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ–°ç”Ÿä»£å†…å­˜çš„ç»„æˆ">æ–°ç”Ÿä»£å†…å­˜çš„ç»„æˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#max-semi-space-size-å‚æ•°">--max-semi-space-size å‚æ•°</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="command-line-api" tabindex="-1"><a class="header-anchor" href="#command-line-api"><span><a href="https://nodejs.org/docs/latest/api/cli.html#command-line-api" target="_blank" rel="noopener noreferrer">Command-line API</a></span></a></h1><p>Node.js çš„å‘½ä»¤è¡Œ API æŒ‡çš„æ˜¯ä¸€ç³»åˆ—åœ¨ Node.js ç¯å¢ƒä¸‹é€šè¿‡å‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰å¯ä»¥ä½¿ç”¨çš„åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½å…è®¸å¼€å‘è€…æ‰§è¡Œå„ç§æ“ä½œï¼Œæ¯”å¦‚è¿è¡Œè„šæœ¬ã€ç®¡ç†æ¨¡å—å’Œäº¤äº’å¼è°ƒè¯•ç­‰ã€‚</p><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œå‘½ä»¤è¡Œ API æä¾›äº†å¾ˆå¤šé€‰é¡¹ï¼Œä½†ç”±äºä½ å¯èƒ½æ˜¯ç¼–ç¨‹æ–°æ‰‹ï¼Œæˆ‘ä¼šå…ˆè§£é‡Šä¸€äº›åŸºç¡€çš„æ¦‚å¿µå’Œå¸¸ç”¨å‘½ä»¤ã€‚</p><p><strong>ä¸€äº›åŸºç¡€çš„å‘½ä»¤è¡Œå‚æ•°ï¼š</strong></p><ul><li><code>node -v</code> æˆ– <code>node --version</code>: æ˜¾ç¤ºå½“å‰å®‰è£…çš„ Node.js ç‰ˆæœ¬ã€‚</li><li><code>node script.js</code>: è¿è¡Œä¸€ä¸ªåä¸º <code>script.js</code> çš„ Node.js è„šæœ¬æ–‡ä»¶ã€‚</li><li><code>node --help</code>: æ˜¾ç¤º Node.js å‘½ä»¤è¡Œå·¥å…·çš„å¸®åŠ©ä¿¡æ¯ã€‚</li></ul><p><strong>å®é™…åº”ç”¨ä¾‹å­ï¼š</strong></p><ol><li><p><strong>æŸ¥çœ‹ç‰ˆæœ¬</strong><br> å‡è®¾ä½ æƒ³çŸ¥é“å½“å‰ç”µè„‘ä¸Šå®‰è£…çš„ Node.js ç‰ˆæœ¬ï¼Œä½ åªéœ€è¦æ‰“å¼€ä¸€ä¸ªå‘½ä»¤è¡Œçª—å£ï¼Œç„¶åè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node -v</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>è¿è¡Œä¸€ä¸ªç®€å•çš„ç¨‹åº</strong><br> å‡è®¾ä½ æœ‰ä¸€ä¸ª <code>hello-world.js</code> æ–‡ä»¶ï¼Œé‡Œé¢çš„ä»£ç æ˜¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¦è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œä½ éœ€è¦åœ¨å‘½ä»¤è¡Œä¸­è¿›å…¥è¯¥æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œå¹¶è¾“å…¥ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node hello-world.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·ä½ å°±ä¼šåœ¨å‘½ä»¤è¡Œçª—å£çœ‹åˆ°è¾“å‡º &quot;Hello, World!&quot;ã€‚</p></li><li><p><strong>ä½¿ç”¨ REPL</strong><br> REPL æ˜¯ Read-Eval-Print Loop çš„ç¼©å†™ï¼Œæ„ä¸ºè¯»å–-æ±‚å€¼-è¾“å‡ºå¾ªç¯ã€‚å®ƒæ˜¯ä¸€ä¸ªç®€å•çš„ã€äº¤äº’å¼ç¼–ç¨‹ç¯å¢ƒã€‚åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ <code>node</code> å¹¶æ•²å‡» Enter é”®åï¼Œå°±ä¼šè¿›å…¥ Node.js çš„äº¤äº’å¼ç¯å¢ƒã€‚åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥ç›´æ¥è¾“å…¥ JavaScript ä»£ç å¹¶ç«‹å³å¾—åˆ°ç»“æœã€‚ä¾‹å¦‚ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>&gt; 1 + 1</span></span>
<span class="line"><span>2</span></span>
<span class="line"><span>&gt; let name = &#39;Node.js&#39;</span></span>
<span class="line"><span>undefined</span></span>
<span class="line"><span>&gt; console.log(`Hello, ${name}!`)</span></span>
<span class="line"><span>Hello, Node.js!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ä½¿ç”¨å‘½ä»¤è¡Œé€‰é¡¹</strong><br> Node.js è¿˜æä¾›äº†æ›´å¤šçš„å‘½ä»¤è¡Œé€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³æ£€æŸ¥ä½ çš„ä»£ç ä¸­æ˜¯å¦å­˜åœ¨æ½œåœ¨çš„é”™è¯¯æˆ–è€…ä¸ç¬¦åˆæœ€ä½³å®è·µï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>--check</code> å‚æ•°ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node --check script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼ŒNode.js ä¼šåœ¨å‘½ä»¤è¡Œä¸­æ‰“å°å‡ºæ¥ã€‚</p></li><li><p><strong>å¯åŠ¨è°ƒè¯•æ¨¡å¼</strong><br> å¦‚æœä½ æ­£åœ¨å¼€å‘å¤æ‚çš„åº”ç”¨å¹¶é‡åˆ°äº†ä¸€äº› bug éœ€è¦è°ƒè¯•ï¼ŒNode.js æä¾›äº†å†…ç½®çš„è°ƒè¯•å™¨ã€‚é€šè¿‡æ·»åŠ  <code>--inspect</code> å‚æ•°ï¼Œå¯ä»¥å¯åŠ¨ä¸€ä¸ªè°ƒè¯•ä¼šè¯ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node --inspect script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¼šå…è®¸ä½ ä½¿ç”¨ Chrome æµè§ˆå™¨çš„ DevTools æˆ–å…¶ä»–æ”¯æŒçš„è°ƒè¯•å·¥å…·æ¥æ–­ç‚¹è°ƒè¯•ä½ çš„åº”ç”¨ã€‚</p></li></ol><p>ä¸Šé¢ä¸¾ä¾‹çš„åªæ˜¯å‘½ä»¤è¡Œ API çš„ä¸€å°éƒ¨åˆ†åŠŸèƒ½ã€‚éšç€ä½ å¯¹ Node.js çš„æ·±å…¥å­¦ä¹ ï¼Œä½ å°†èƒ½å¤ŸæŒæ¡æ›´å¤šé«˜çº§åŠŸèƒ½ï¼Œä»¥ä¾¿æ›´å¥½åœ°è¿›è¡Œåº”ç”¨å¼€å‘å’Œè°ƒè¯•ã€‚è®°ä½ï¼Œå®è·µæ˜¯å­¦ä¹ ç¼–ç¨‹çš„å…³é”®ï¼Œå°è¯•ç”¨ Node.js å†™ä¸€äº›å°ç¨‹åºå¹¶è¿è¡Œå®ƒä»¬å°†ä¼šéå¸¸æœ‰å¸®åŠ©ã€‚</p><h2 id="synopsis" tabindex="-1"><a class="header-anchor" href="#synopsis"><span><a href="https://nodejs.org/docs/latest/api/cli.html#synopsis" target="_blank" rel="noopener noreferrer">Synopsis</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒè®©ä½ å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ï¼Œæ‰§è¡Œå„ç§åç«¯ä»»åŠ¡ï¼Œæ¯”å¦‚è¿æ¥æ•°æ®åº“ã€å¤„ç†æ–‡ä»¶ã€æ­å»º API å’ŒæœåŠ¡å™¨ç­‰ã€‚</p><p>åœ¨ Node.js å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œâ€œSynopsisâ€ä¸€è¯é€šå¸¸æŒ‡çš„æ˜¯å¯¹æŸä¸ªå‘½ä»¤æˆ–è€…åŠŸèƒ½çš„ç®€è¦æ¦‚è¿°ã€‚å®ƒå‘Šè¯‰ä½ è¯¥åŠŸèƒ½å¤§ä½“ä¸Šæ˜¯å¹²ä»€ä¹ˆçš„å’Œå¦‚ä½•ä½¿ç”¨ã€‚ä»¥ Node.js v21.7.1 ç‰ˆæœ¬ä¸­çš„ CLIï¼ˆå‘½ä»¤è¡Œæ¥å£ï¼‰æ–‡æ¡£ä¸ºä¾‹ï¼Œ&quot;Synopsis&quot; æè¿°çš„æ˜¯å¦‚ä½•é€šè¿‡å‘½ä»¤è¡Œæ¥è¿è¡Œ Node.js ç¨‹åºã€‚</p><p>Node.js çš„åŸºæœ¬å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [options] [V8 options] [script.js </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;script&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] [arguments]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è®©æˆ‘ä»¬åˆ†è§£ä¸€ä¸‹è¿™ä¸ªå‘½ä»¤çš„ä¸åŒéƒ¨åˆ†ï¼š</p><ol><li><code>node</code>ï¼šè¿™æ˜¯æ‰§è¡Œ Node.js ç¨‹åºçš„å‘½ä»¤ã€‚</li><li><code>[options]</code>ï¼šè¿™è¡¨ç¤º Node.js çš„é€‰é¡¹ï¼Œä½ å¯ä»¥æ·»åŠ å¤šä¸ªé€‰é¡¹æ¥ä¿®æ”¹ç¨‹åºçš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œ<code>-v</code>æˆ–è€…<code>--version</code>ä¼šè¿”å›ä½ æ­£åœ¨ä½¿ç”¨çš„ Node.js çš„ç‰ˆæœ¬ã€‚</li><li><code>[V8 options]</code>ï¼šNode.js æ˜¯ç”¨ V8 å¼•æ“æ„å»ºçš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä¼ é€’ V8 å¼•æ“ä¸“æœ‰çš„é€‰é¡¹æ¥ä¼˜åŒ–æ€§èƒ½æˆ–è°ƒè¯•ã€‚</li><li><code>[script.js]</code>ï¼šè¿™é‡Œä½ å¯ä»¥æ”¾ç½®ä½ æƒ³è¦ Node.js æ‰§è¡Œçš„ JavaScript æ–‡ä»¶åã€‚</li><li><code>-e &quot;script&quot;</code>ï¼šå¦‚æœä½ ä¸æƒ³å†™ä¸€ä¸ªå®Œæ•´çš„è„šæœ¬æ–‡ä»¶ï¼Œä½ å¯ä»¥ç›´æ¥æ‰§è¡Œä¸€æ®µä»£ç ã€‚å°†ä»£ç æ”¾åœ¨å¼•å·ä¹‹é—´è·Ÿåœ¨ <code>-e</code> é€‰é¡¹åé¢ã€‚</li><li><code>[arguments]</code>ï¼šè¿™äº›æ˜¯ä¼ é€’ç»™ä½ çš„è„šæœ¬çš„å‚æ•°ï¼Œä½ çš„è„šæœ¬å¯ä»¥é€šè¿‡ <code>process.argv</code> æ•°ç»„è®¿é—®ä»–ä»¬ã€‚</li></ol><p>ä¸¾å‡ ä¸ªå®é™…çš„ä¾‹å­ï¼š</p><p><strong>ä¾‹å­ 1</strong>: æŸ¥çœ‹ Node.js ç‰ˆæœ¬</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -v</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>ä¾‹å­ 2</strong>: è¿è¡Œä¸€ä¸ªå«åš â€œapp.jsâ€ çš„è„šæœ¬æ–‡ä»¶</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>ä¾‹å­ 3</strong>: åœ¨ Node.js ä¸­æ‰§è¡Œä¸€æ®µç®€å•çš„ JavaScript ä»£ç </p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;console.log(&#39;Hello, World!&#39;)&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>ä¾‹å­ 4</strong>: å‘è„šæœ¬ â€œapp.jsâ€ ä¼ é€’å‚æ•°</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> user123</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> password123</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™é‡Œ &quot;user123&quot; å’Œ &quot;password123&quot; æ˜¯ä¼ é€’ç»™ &quot;app.js&quot; çš„å‚æ•°ï¼Œä½ çš„ Node.js è„šæœ¬å¯ä»¥åœ¨å†…éƒ¨é€šè¿‡ <code>process.argv</code> è·å–è¿™äº›å‚æ•°ã€‚</p><p>Node.js æä¾›äº†å¹¿æ³›çš„å‘½ä»¤è¡Œé€‰é¡¹æ¥æ§åˆ¶è„šæœ¬çš„æ‰§è¡Œæ–¹å¼ï¼Œè°ƒæ•´æ€§èƒ½å‚æ•°ç­‰ã€‚é€šè¿‡è¯»å–å®˜æ–¹æ–‡æ¡£ä¸­çš„ &quot;Synopsis&quot; éƒ¨åˆ†ï¼Œä½ å¯ä»¥å¾—åˆ°å…³äºå¦‚ä½•åˆ©ç”¨è¿™äº›é€‰é¡¹è¿›è¡ŒåŸºæœ¬æ“ä½œçš„å¿«é€ŸæŒ‡å—ã€‚éšç€ä½ å¯¹ Node.js çš„æ·±å…¥å­¦ä¹ ï¼Œé€æ¸ä½ ä¼šæ›´å¤šåœ°ä¸å‘½ä»¤è¡Œäº¤äº’ï¼Œç†Ÿæ‚‰å„ç§ä¸åŒçš„é€‰é¡¹å’Œä»–ä»¬çš„ä½œç”¨ã€‚</p><h2 id="program-entry-point" tabindex="-1"><a class="header-anchor" href="#program-entry-point"><span><a href="https://nodejs.org/docs/latest/api/cli.html#program-entry-point" target="_blank" rel="noopener noreferrer">Program entry point</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº JavaScript è¿è¡Œæ—¶çš„å¼€æºå¹³å°ï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œç¨‹åºçš„å…¥å£ç‚¹æ˜¯æ ‡è¯†åº”ç”¨å¼€å§‹æ‰§è¡Œçš„åœ°æ–¹ã€‚</p><p>é€šå¸¸ï¼Œå½“ä½ åœ¨å‘½ä»¤è¡Œï¼ˆå³ç»ˆç«¯æˆ–å‘½ä»¤æç¤ºç¬¦ï¼‰ä¸­è¿è¡Œä¸€ä¸ª Node.js ç¨‹åºæ—¶ï¼Œä½ éœ€è¦æŒ‡æ˜ä¸€ä¸ªå…¥å£ç‚¹æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>app.js</code> å°±æ˜¯ç¨‹åºçš„å…¥å£ç‚¹æ–‡ä»¶ã€‚Node.js ä¼šåŠ è½½å¹¶æ‰§è¡Œ <code>app.js</code> æ–‡ä»¶ä¸­çš„ä»£ç ã€‚</p><p>å…·ä½“åˆ° Node.js v21.7.1 çš„æ–‡æ¡£ä¸­æåˆ°çš„ &quot;Program entry point&quot;ï¼Œè¿™æ¶‰åŠåˆ° Node.js å¦‚ä½•å¤„ç†ä¸åŒå½¢å¼çš„å…¥å£ç‚¹ã€‚åœ¨ Node.js ä¸­ï¼Œå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æ¥æŒ‡å®šç¨‹åºçš„å…¥å£ç‚¹ï¼š</p><ol><li><p><strong>ç›´æ¥æ‰§è¡Œæ–‡ä»¶</strong>ï¼šæ­£å¦‚å‰é¢çš„ä¾‹å­æ‰€ç¤ºï¼Œä½ å¯ä»¥ç›´æ¥è¿è¡Œä¸€ä¸ªæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°±æˆä¸ºäº†ç¨‹åºçš„å…¥å£ç‚¹ã€‚</p></li><li><p><strong>ä½¿ç”¨ <code>npm start</code> æˆ– <code>yarn start</code></strong>ï¼šå¦‚æœä½ çš„é¡¹ç›®åŒ…å«ä¸€ä¸ª <code>package.json</code> æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨å…¶ä¸­å®šä¹‰äº†ä¸€ä¸ª <code>start</code> è„šæœ¬ï¼Œä½ å¯ä»¥é€šè¿‡ <code>npm start</code> æˆ– <code>yarn start</code> æ¥è¿è¡Œä½ çš„ç¨‹åºï¼Œä¾‹å¦‚ï¼š</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;my-node-app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;1.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;scripts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node app.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä½ è¿è¡Œ <code>npm start</code> æ—¶ï¼Œå®ƒå°†æ‰§è¡Œ <code>package.json</code> é‡Œå®šä¹‰çš„ <code>start</code> è„šæœ¬ä¸­çš„å‘½ä»¤ï¼Œä»è€ŒåŠ è½½å¹¶æ‰§è¡Œ <code>app.js</code> æ–‡ä»¶ã€‚</p></li><li><p><strong>ä½¿ç”¨ <code>node</code> å‘½ä»¤åè·Ÿ <code>-e</code> å‚æ•°å’Œä»£ç </strong>ï¼šä½ è¿˜å¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œä¸€æ®µ JavaScript ä»£ç ã€‚ä¾‹å¦‚ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;console.log(&#39;Hello, World!&#39;)&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ­¤æ—¶æ²¡æœ‰æ–‡ä»¶ä½œä¸ºå…¥å£ç‚¹ï¼Œè€Œæ˜¯ <code>-e</code> åè·Ÿçš„ JavaScript ä»£ç å­—ç¬¦ä¸²ä½œä¸ºç¨‹åºçš„å…¥å£ç‚¹ã€‚</p></li><li><p><strong>REPLï¼ˆäº¤äº’å¼è§£é‡Šå™¨ï¼‰æ¨¡å¼</strong>ï¼šå¦‚æœä½ åªè¾“å…¥ <code>node</code> å¹¶æ•²å‡»å›è½¦ï¼Œä½ å°†è¿›å…¥ REPL æ¨¡å¼ã€‚è¿™æ˜¯ä¸€ä¸ªäº¤äº’å¼ç¯å¢ƒï¼Œä½ å¯ä»¥é€è¡Œè¾“å…¥ JavaScript ä»£ç å¹¶ç«‹å³çœ‹åˆ°ç»“æœã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ²¡æœ‰æ–‡ä»¶ä½œä¸ºå…¥å£ç‚¹ï¼Œä½ åœ¨ REPL ä¸­è¾“å…¥çš„æ¯ä¸€è¡Œä»£ç éƒ½æ˜¯å³æ—¶æ‰§è¡Œçš„ã€‚</p></li><li><p><strong>ä½¿ç”¨ <code>require()</code> åŠ¨æ€å¯¼å…¥æ¨¡å—</strong>ï¼šä½ å¯ä»¥åœ¨ä»£ç ä¸­ä½¿ç”¨ <code>require()</code> å‡½æ•°æ¥åŠ¨æ€åŠ è½½å…¶ä»–æ¨¡å—ï¼ˆå³å…¶ä»– JavaScript æ–‡ä»¶ï¼‰ã€‚è¢«åŠ è½½çš„æ¨¡å—ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ç¨‹åºçš„ä¸€ä¸ªå…¥å£ç‚¹ã€‚ä¾‹å¦‚ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨ app.js ä¸­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myModule</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./myModule.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ä½¿ç”¨ ES Modules</strong>ï¼šå¦‚æœä½ å¯ç”¨äº† ES Modules æ”¯æŒï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>import</code> è¯­æ³•æ¥å¼•å…¥æ¨¡å—ã€‚ä¾‹å¦‚ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨ app.js ä¸­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myModule</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;./myModule.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>å®é™…ä¸Šï¼Œåœ¨ Node.js æ–‡æ¡£ä¸­æåˆ°çš„ &quot;Program entry point&quot; æ˜¯æŒ‡ä½ å¯ä»¥é€šè¿‡ä»¥ä¸Šçš„å„ç§æ–¹å¼æ¥å¼€å§‹ä½ çš„ Node.js åº”ç”¨ç¨‹åºã€‚ç†è§£ç¨‹åºçš„å…¥å£ç‚¹å¯¹äºç»„ç»‡å’Œç»“æ„åŒ–ä½ çš„ä»£ç éå¸¸é‡è¦ã€‚</p><h3 id="ecmascript-modules-loader-entry-point-caveat" tabindex="-1"><a class="header-anchor" href="#ecmascript-modules-loader-entry-point-caveat"><span><a href="https://nodejs.org/docs/latest/api/cli.html#ecmascript-modules-loader-entry-point-caveat" target="_blank" rel="noopener noreferrer">ECMAScript modules loader entry point caveat</a></span></a></h3><p>Node.js v21.7.1 æ–‡æ¡£ä¸­æåˆ°çš„â€œECMAScript modules loader entry point caveatâ€ï¼Œä¸»è¦æ˜¯åœ¨è°ˆè®ºå…³äºå¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰åŠ è½½å™¨ï¼ˆloadersï¼‰æ¥æ”¹å˜é»˜è®¤çš„æ¨¡å—è§£æè¡Œä¸ºæ—¶éœ€è¦æ³¨æ„çš„ä¸€ä¸ªé—®é¢˜ã€‚ECMAScript æ¨¡å—ï¼ˆç®€ç§° ESMï¼‰æ˜¯ JavaScript å®˜æ–¹çš„æ¨¡å—ç³»ç»Ÿï¼ŒNode.js æ”¯æŒè¿™ç§æ¨¡å—ç³»ç»Ÿæ¥è®©ä½ èƒ½å¤Ÿç»„ç»‡å’Œé‡ç”¨ä»£ç ã€‚</p><p>é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯è‡ªå®šä¹‰åŠ è½½å™¨å‘¢ï¼Ÿè‡ªå®šä¹‰åŠ è½½å™¨å…è®¸å¼€å‘è€…åœ¨æ¨¡å—è¢« Node.js æ‰§è¡Œä¹‹å‰ä»‹å…¥æ¨¡å—çš„åŠ è½½è¿‡ç¨‹ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æŒ‡å®šæŸäº›è‡ªå®šä¹‰çš„é€»è¾‘å»è§£æå’Œå¤„ç†æ–‡ä»¶ï¼Œæ¯”å¦‚è½¬æ¢æ–‡ä»¶å†…å®¹ã€æ·»åŠ é¢å¤–çš„ç¼–è¯‘æ­¥éª¤æˆ–è€…å®ç°ç‰¹å®šçš„æ¨¡å—æŸ¥æ‰¾é€»è¾‘ç­‰ã€‚</p><p>ç„¶è€Œï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å­˜åœ¨ä¸€ä¸ªâ€œcaveatâ€ï¼ˆè­¦å‘Š/æ³¨æ„äº‹é¡¹ï¼‰ï¼Œå°±æ˜¯å½“ä½ ä½¿ç”¨<code>--loader</code>æ ‡å¿—æ¥æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„åŠ è½½å™¨æ—¶ï¼Œè¿™ä¸ªåŠ è½½å™¨åªå¯¹<code>import</code>è¯­å¥å¯¼å…¥çš„æ¨¡å—æœ‰æ•ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ åœ¨é¡¹ç›®çš„å…¥å£ç‚¹ä½¿ç”¨äº†<code>require()</code>å‡½æ•°æ¥åŠ è½½ä¸€ä¸ªæ¨¡å—ï¼Œé‚£ä¹ˆè¯¥æ¨¡å—å°†ä¸ä¼šé€šè¿‡ä½ æŒ‡å®šçš„è‡ªå®šä¹‰åŠ è½½å™¨å¤„ç†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä¸¾ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜è¿™ä¸ªé—®é¢˜ã€‚</p><p>å‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰åŠ è½½å™¨<code>custom-loader.mjs</code>ï¼Œè¿™ä¸ªåŠ è½½å™¨æ‰“ç®—æ”¹å˜.js æ–‡ä»¶çš„åŠ è½½æ–¹å¼ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// custom-loader.mjs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> load</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">defaultLoad</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è‡ªå®šä¹‰çš„åŠ è½½é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">endsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Loading </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> via custom loader`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è¿™é‡Œå¯ä»¥æœ‰ä¸€äº›è‡ªå®šä¹‰çš„å¤„ç†é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è°ƒç”¨é»˜è®¤çš„åŠ è½½é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> defaultLoad</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">defaultLoad</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åä½ æœ‰ä¸€ä¸ªå…¥å£è„šæœ¬<code>entry.js</code>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// entry.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myModule</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./my-module.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å³ä½¿åœ¨è¿è¡Œ Node.js æ—¶ä½¿ç”¨äº†<code>--loader</code>æ ‡å¿—æ¥æŒ‡å®š<code>custom-loader.mjs</code>ï¼Œä¾‹å¦‚ï¼š<code>node --loader ./custom-loader.mjs entry.js</code>ï¼Œä¸Šè¿°çš„<code>require(&#39;./my-module.js&#39;)</code>å¹¶ä¸ä¼šé€šè¿‡æŒ‡å®šçš„<code>custom-loader.mjs</code>è¢«å¤„ç†ï¼Œå› ä¸º<code>require()</code>ä¸éµå¾ª ESM åŠ è½½å™¨çš„è§„åˆ™ã€‚</p><p>ä¸ºäº†ç¡®ä¿è‡ªå®šä¹‰åŠ è½½å™¨è¢«åº”ç”¨ï¼Œä½ åº”è¯¥ä½¿ç”¨<code>import</code>è€Œä¸æ˜¯<code>require</code>ï¼Œä¾‹å¦‚å°†å…¥å£è„šæœ¬æ”¹ä¸ºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// entry.mjs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;./my-module.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åå†æ¬¡è¿è¡Œ <code>node --loader ./custom-loader.mjs entry.mjs</code>ï¼Œè¿™æ¬¡çš„å¯¼å…¥å°†ä¼šé€šè¿‡è‡ªå®šä¹‰åŠ è½½å™¨è¿›è¡Œå¤„ç†ã€‚</p><p>ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼ŒNode.js å»ºè®®å°½å¯èƒ½åœ°ä½¿ç”¨ ECMAScript æ¨¡å—ï¼ˆ.mjs æ–‡ä»¶æˆ–åœ¨<code>package.json</code>ä¸­è®¾ç½®<code>&quot;type&quot;: &quot;module&quot;</code>ï¼‰ï¼Œå¹¶ä¸”ä½¿ç”¨<code>import</code>è€Œé<code>require()</code>æ¥åŠ è½½æ¨¡å—ã€‚è¿™æ ·åšå¯ä»¥ç¡®ä¿æ‰€æœ‰çš„æ¨¡å—åŠ è½½éƒ½ç»è¿‡ä½ è‡ªå®šä¹‰çš„åŠ è½½å™¨å¤„ç†ï¼Œä»è€Œè¾¾åˆ°é¢„æœŸçš„æ•ˆæœã€‚</p><h2 id="options" tabindex="-1"><a class="header-anchor" href="#options"><span><a href="https://nodejs.org/docs/latest/api/cli.html#options" target="_blank" rel="noopener noreferrer">Options</a></span></a></h2><p>å½“æˆ‘ä»¬è°ˆè®º <code>Node.js</code> çš„ CLIï¼ˆå‘½ä»¤è¡Œç•Œé¢ï¼‰é€‰é¡¹æ—¶ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯å¯ä»¥åœ¨è¿è¡Œ Node.js ç¨‹åºæ—¶ä¼ é€’ç»™ <code>node</code> å‘½ä»¤çš„å„ç§å‚æ•°ã€‚è¿™äº›é€‰é¡¹å…è®¸å¼€å‘è€…è°ƒæ•´ Node.js è¿è¡Œæ—¶çš„è¡Œä¸ºï¼Œä¾‹å¦‚è®¾ç½®å†…å­˜é™åˆ¶ã€é€‰æ‹©æ¨¡å—åŠ è½½æ–¹å¼æˆ–è€…å¯ç”¨è°ƒè¯•å·¥å…·ç­‰ã€‚</p><p>ç”±äºä½ æåˆ°çš„æ˜¯ Node.js v21.7.1 ç‰ˆæœ¬ï¼Œè¿™é‡Œæˆ‘ä¼šä»¥è¯¥ç‰ˆæœ¬ä¸ºå‡†æ¥ä¸¾ä¾‹è¯´æ˜å‡ ä¸ªå¸¸è§çš„ CLI é€‰é¡¹å’Œå®ƒä»¬çš„ä½œç”¨ï¼š</p><ol><li><p><strong>--inspect-brk</strong>:</p><ul><li>è¿™ä¸ªé€‰é¡¹ç”¨äºå¯åŠ¨ Node.js çš„è°ƒè¯•å™¨ï¼Œå¹¶åœ¨ç”¨æˆ·ä»£ç å¼€å§‹æ‰§è¡Œå‰ä¸­æ–­ï¼ˆå³æš‚åœåœ¨ç¬¬ä¸€è¡Œä»£ç ï¼‰ã€‚è¿™è®©å¼€å‘è€…æœ‰æœºä¼šè®¾å®šæ–­ç‚¹ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªè°ƒè¯•å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚ Chrome DevTools æˆ– VS Codeï¼‰è¿›è¡Œä»£ç è°ƒè¯•ã€‚</li><li>ç¤ºä¾‹ï¼š<code>node --inspect-brk app.js</code> å°†ä¼šå¯åŠ¨æ–‡ä»¶ <code>app.js</code> å¹¶åœ¨ç¬¬ä¸€è¡Œä»£ç å¤„æš‚åœæ‰§è¡Œï¼Œç­‰å¾…è°ƒè¯•è¿æ¥ã€‚</li></ul></li><li><p><strong>--require, -r</strong>:</p><ul><li>ä½¿ç”¨è¿™ä¸ªé€‰é¡¹å¯ä»¥é¢„å…ˆåŠ è½½ä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡å—ã€‚è¿™é€šå¸¸ç”¨äºè®¾ç½®å…¨å±€é’©å­æˆ–è€…æ³¨å†Œç¼–è¯‘å™¨ï¼ˆå¦‚ Babelï¼‰ã€‚</li><li>ç¤ºä¾‹ï¼š<code>node -r ./my-module.js app.js</code> åœ¨è¿è¡Œ <code>app.js</code> å‰ï¼Œä¼šé¦–å…ˆåŠ è½½å¹¶æ‰§è¡Œ <code>./my-module.js</code>ã€‚</li></ul></li><li><p><strong>--max-old-space-size</strong>:</p><ul><li>è¿™ä¸ªå‚æ•°ç”¨äºè®¾ç½® V8 JavaScript å¼•æ“çš„æœ€å¤§è€ç”Ÿä»£å†…å­˜å¤§å°ã€‚è€ç”Ÿä»£å†…å­˜æ˜¯ç”¨äºå­˜å‚¨é•¿æ—¶é—´å­˜åœ¨çš„å¯¹è±¡çš„å†…å­˜åŒºåŸŸã€‚å¦‚æœä½ çš„ç¨‹åºå¤„ç†å¤§é‡æ•°æ®æˆ–è€…é‡åˆ°å†…å­˜æ³„æ¼é—®é¢˜ï¼Œå¯èƒ½éœ€è¦å¢åŠ è¿™ä¸ªé™åˆ¶ã€‚</li><li>ç¤ºä¾‹ï¼š<code>node --max-old-space-size=4096 app.js</code> å°†å¯¹ <code>app.js</code> è®¾ç½®æœ€å¤§ 4GB çš„è€ç”Ÿä»£å†…å­˜å¤§å°ã€‚</li></ul></li><li><p><strong>--experimental-modules</strong>:</p><ul><li>æ­¤é€‰é¡¹å…è®¸åœ¨ Node.js ä¸­å¯ç”¨å®éªŒæ€§çš„ ES æ¨¡å—æ”¯æŒï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ <code>import</code> å’Œ <code>export</code> è¯­æ³•å¯¼å…¥å’Œå¯¼å‡ºæ¨¡å—ï¼Œç±»ä¼¼äºåœ¨ç°ä»£æµè§ˆå™¨ä¸­çš„è¡Œä¸ºã€‚</li><li>ç¤ºä¾‹ï¼š<code>node --experimental-modules app.mjs</code> å°†å…è®¸ <code>app.mjs</code> ä½¿ç”¨ ES æ¨¡å—ç‰¹æ€§ã€‚</li></ul></li><li><p><strong>--no-warnings</strong>:</p><ul><li>å¦‚æœä½ ä¸å¸Œæœ›åœ¨æ§åˆ¶å°çœ‹åˆ°ä»»ä½•è­¦å‘Šï¼ˆå¦‚å®éªŒæ€§åŠŸèƒ½è­¦å‘Šæˆ–å¼ƒç”¨è­¦å‘Šï¼‰ï¼Œå¯ä»¥ä½¿ç”¨æ­¤é€‰é¡¹æ¥ç¦æ­¢æ˜¾ç¤ºå®ƒä»¬ã€‚</li><li>ç¤ºä¾‹ï¼š<code>node --no-warnings app.js</code> å°†è¿è¡Œ <code>app.js</code> ä½†ä¸ä¼šåœ¨æ§åˆ¶å°æ‰“å°ä»»ä½•è­¦å‘Šä¿¡æ¯ã€‚</li></ul></li></ol><p>è¯·æ³¨æ„ï¼ŒCLI é€‰é¡¹ä¹Ÿæœ‰å¯èƒ½éšç€ Node.js ç‰ˆæœ¬çš„æ›´æ–°è€Œå˜åŒ–ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨å‰åº”è¯¥æŸ¥é˜…å®˜æ–¹æ–‡æ¡£æˆ–ä½¿ç”¨ <code>node --help</code> å‘½ä»¤ä»¥è·å–æœ€æ–°å’Œå®Œæ•´çš„é€‰é¡¹åˆ—è¡¨åŠå…¶æè¿°ã€‚</p><p>ç†è§£å’Œç†Ÿç»ƒè¿ç”¨è¿™äº› CLI é€‰é¡¹èƒ½å¤Ÿå¸®åŠ©ä½ æ›´å¥½åœ°æ§åˆ¶å’Œä¼˜åŒ–ä½ çš„ Node.js åº”ç”¨ç¨‹åºçš„æ‰§è¡Œç¯å¢ƒã€‚</p><h3 id="" tabindex="-1"><a class="header-anchor" href="#"><span><a href="https://nodejs.org/docs/latest/api/cli.html#-" target="_blank" rel="noopener noreferrer">-</a></span></a></h3><p>Node.js v21.7.1 ä¸­çš„ <code>### [-]</code> æ˜¯æŒ‡åœ¨ Node.js å‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰ä¸­ä½¿ç”¨å•ç ´æŠ˜å· <code>-</code> ä½œä¸ºä¸€ä¸ªç‰¹æ®Šçš„å‚æ•°ã€‚è¿™ä¸ªç ´æŠ˜å·ç”¨æ¥å‘Šè¯‰ Node.js åœæ­¢è¯»å–å‘½ä»¤è¡Œé€‰é¡¹ï¼Œä»»ä½•æ¥ä¸‹æ¥çš„å‘½ä»¤è¡Œå‚æ•°éƒ½ä¼šè¢«å½“ä½œæ–‡ä»¶åã€æ¨¡å—æˆ–è€…æ˜¯è¡¨è¾¾å¼ç­‰ï¼Œè¿™æ ·åšå¯ä»¥é¿å…å‘½ä»¤è¡Œè§£æé—®é¢˜ï¼Œå°¤å…¶æ˜¯å½“ä½ çš„æ–‡ä»¶åå¯èƒ½ä»¥ç ´æŠ˜å·å¼€å¤´æ—¶ã€‚</p><p>åœ¨ä¸åŒçš„ç¨‹åºå’Œè„šæœ¬ä¸­ï¼Œå•ç ´æŠ˜å· <code>-</code> é€šå¸¸ç”¨äºè¡¨ç¤ºä»æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰è¯»å–æ•°æ®æˆ–è€…å°†å‰©ä½™çš„å‚æ•°è§†ä¸ºä¸æ˜¯é€‰é¡¹çš„å€¼ï¼Œè¿™åœ¨ UNIX å’Œ Linux ç³»ç»Ÿä¸­ååˆ†å¸¸è§ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ Node.js ä¸­ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹åœºæ™¯ï¼š</p><ol><li>è¿è¡Œä¸€ä¸ªæ–‡ä»¶ï¼šå¦‚æœä½ æœ‰ä¸€ä¸ªå«åš <code>-my-script.js</code> çš„æ–‡ä»¶ï¼ˆæ³¨æ„æ–‡ä»¶åå‰æœ‰ä¸ªç ´æŠ˜å·ï¼‰ï¼Œç›´æ¥è¿è¡Œ <code>node -my-script.js</code> å¾ˆå¯èƒ½ä¼šå‡ºé”™ï¼Œå› ä¸º Node.js ä¼šå°è¯•è§£æ <code>-my</code> ä½œä¸ºä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥è¿™æ ·è¿è¡Œå®ƒï¼š</li></ol><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -my-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li>ä»æ ‡å‡†è¾“å…¥æ‰§è¡Œä»£ç ï¼šå¦‚æœä½ æƒ³æ‰§è¡Œä¸€äº›é€šè¿‡ç®¡é“ï¼ˆpipeï¼‰ä¼ é€’ç»™ Node.js çš„ä»£ç ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>-</code> å‘½ä»¤æ¥å‘Šè¯‰ Node.js ä»æ ‡å‡†è¾“å…¥è¯»å–ä»£ç ã€‚</li></ol><p>ä¾‹å¦‚ï¼Œecho &#39;console.log(&quot;Hello, World!&quot;);&#39; | node - ï¼Œè¿™æ¡å‘½ä»¤é¦–å…ˆä¼šè¾“å‡º <code>console.log(&quot;Hello, World!&quot;);</code> ï¼Œç„¶åé€šè¿‡ç®¡é“ä¼ é€’ç»™ Node.js å»æ‰§è¡Œã€‚</p><p>è§£é‡Šè¿™äº›ä¾‹å­èƒŒåçš„åŸç†ï¼š</p><ul><li><code>node</code> æ˜¯å¯åŠ¨ Node.js è¿›ç¨‹çš„å‘½ä»¤ã€‚</li><li><code>--</code> è¿™ä¸ªå‚æ•°ç”¨äºå‘Šè¯‰ Node.js å‘½ä»¤è¡Œè§£æå™¨ï¼Œ<code>--</code> åé¢è·Ÿç€çš„ä¸å†æ˜¯å‘½ä»¤è¡Œé€‰é¡¹ã€‚</li><li><code>-my-script.js</code> æ˜¯ä½ çš„è„šæœ¬æ–‡ä»¶ï¼Œè€Œ <code>-</code> åˆ™æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œè¡¨ç¤º Node åº”è¯¥ä»æ ‡å‡†è¾“å…¥è¯»å–å†…å®¹ã€‚</li></ul><p>æ€»ä¹‹ï¼Œåœ¨ Node.js å‘½ä»¤è¡Œä¸­ï¼Œ<code>### [-]</code> è¡¨ç¤ºä¸€ä¸ªç‰¹æ®Šçš„å‚æ•° <code>-</code> ï¼Œç”¨äºæ”¹å˜ Node.js å¯¹éšåå‚æ•°çš„å¤„ç†æ–¹å¼ï¼Œè®©äººä»¬å¯ä»¥æ›´çµæ´»åœ°è¿è¡Œè„šæœ¬æˆ–å¤„ç†å‘½ä»¤è¡Œå‚æ•°ã€‚</p><h3 id="-1" tabindex="-1"><a class="header-anchor" href="#-1"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--" target="_blank" rel="noopener noreferrer">--</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>--</code>ï¼ˆä¸¤ä¸ªè¿å­—ç¬¦ï¼‰æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å‘½ä»¤è¡Œå‚æ•°åˆ†éš”ç¬¦ã€‚å®ƒç”¨æ¥æ˜ç¡®æ ‡è¯†å‘½ä»¤è¡Œå‚æ•°çš„ç»“æŸï¼Œä½¿å¾—ä¹‹åçš„æ‰€æœ‰å†…å®¹ä¸ä¼šè¢« Node.js è§£æä¸ºå®ƒçš„é€‰é¡¹ï¼Œè€Œæ˜¯ç›´æ¥ä¼ é€’ç»™è¿è¡Œçš„è„šæœ¬æˆ–è€…åº”ç”¨ç¨‹åºã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ä½ åœ¨ç»ˆç«¯é‡Œè¿è¡Œ Node.js è„šæœ¬æ—¶ï¼Œä½ å¯èƒ½éœ€è¦å‘è¿™ä¸ªè„šæœ¬ä¼ é€’ä¸€äº›å‚æ•°ï¼Œè¿™äº›å‚æ•°æœ‰æ—¶å¯èƒ½ä¼šè·Ÿ Node.js è‡ªèº«çš„å‚æ•°å‘ç”Ÿå†²çªã€‚ä¸ºäº†é¿å…è¿™ç§å†²çªï¼Œä½ å¯ä»¥ä½¿ç”¨<code>--</code>æ¥å‘Šè¯‰ Node.jsï¼šâ€œæˆ‘å·²ç»å®Œæˆäº†æ‰€æœ‰å¯¹ Node.js å‘½ä»¤è¡Œå‚æ•°çš„é…ç½®ï¼Œä»ç°åœ¨å¼€å§‹çš„æ‰€æœ‰å†…å®¹éƒ½åº”è¯¥åŸå°ä¸åŠ¨åœ°ä¼ é€’åˆ°æˆ‘çš„è„šæœ¬ä¸­â€ã€‚</p><p>è®©æˆ‘ä»¬ä¸¾å‡ ä¸ªå®é™…ä¾‹å­æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨<code>--</code>ï¼š</p><h3 id="ç¤ºä¾‹-1-è¿è¡Œè„šæœ¬å¹¶ä¼ é€’å‚æ•°" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-è¿è¡Œè„šæœ¬å¹¶ä¼ é€’å‚æ•°"><span>ç¤ºä¾‹ 1ï¼šè¿è¡Œè„šæœ¬å¹¶ä¼ é€’å‚æ•°</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªåä¸º<code>script.js</code>çš„ Node.js è„šæœ¬ï¼Œå®ƒæœŸæœ›æ¥æ”¶ä¸€äº›è‡ªå®šä¹‰å‚æ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// script.js</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">slice</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ æƒ³è¦ä¼ é€’ä¸€äº›å‚æ•°ç»™è¿™ä¸ªè„šæœ¬ï¼Œä½†æ˜¯ä¸å¸Œæœ›è¿™äº›å‚æ•°è¢« Node.js å¤„ç†ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨<code>--</code>ã€‚æ¯”å¦‚è¯´ï¼Œä½ æƒ³è¦ä¼ é€’<code>--version</code>ä½œä¸ºå‚æ•°ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> script.js</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --version</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€ä¸ª<code>--version</code>å‚æ•°ä¼šè¢« Node.js å¿½ç•¥ï¼Œå› ä¸ºå®ƒåœ¨<code>--</code>ä¹‹åï¼Œæ‰€ä»¥å®ƒä¼šæ­£å¸¸ä¼ é€’åˆ°<code>script.js</code>ä¸­ï¼Œå¹¶ä¸”åœ¨æ§åˆ¶å°è¾“å‡ºç±»ä¼¼ä¸‹é¢çš„å†…å®¹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[ &#39;--version&#39; ]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="ç¤ºä¾‹-2-ä¸-npm-scripts-ç»“åˆä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ä¸-npm-scripts-ç»“åˆä½¿ç”¨"><span>ç¤ºä¾‹ 2ï¼šä¸ npm scripts ç»“åˆä½¿ç”¨</span></a></h3><p>å½“ä½ åœ¨ npm è„šæœ¬ä¸­è¿è¡Œ Node.js ç¨‹åºæ—¶ï¼Œä¹Ÿå¯èƒ½éœ€è¦ä¼ é€’å‚æ•°ç»™å®é™…çš„ Node.js è„šæœ¬ã€‚ä¾‹å¦‚ï¼Œåœ¨<code>package.json</code>æ–‡ä»¶ä¸­å¯èƒ½ä¼šæœ‰ç±»ä¼¼ä¸‹é¢çš„è®¾ç½®ï¼š</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;scripts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node script.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œå¦‚æœä½ æƒ³é€šè¿‡ npm è¿è¡Œè¿™ä¸ªè„šæœ¬ï¼Œå¹¶ä¸”ä¼ é€’å‚æ•°ï¼Œä½ å°†ä¼šä½¿ç”¨<code>--</code>ä¸¤æ¬¡â€”â€”ä¸€æ¬¡æ˜¯ä¸ºäº†å‘Šè¯‰ npm åœæ­¢å¤„ç†å‚æ•°ï¼Œå¦ä¸€æ¬¡æ˜¯ä¸ºäº†å‘Šè¯‰ Node.jsï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --version</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç¬¬ä¸€ä¸ª<code>--</code>æ˜¯å‘Šè¯‰ npm CLI åœæ­¢å¤„ç†åé¢çš„å‚æ•°ï¼ŒæŠŠå®ƒä»¬ä¼ é€’ç»™<code>npm run</code>è°ƒç”¨çš„è„šæœ¬ã€‚ç¬¬äºŒä¸ª<code>--</code>æ˜¯ä¼ é€’ç»™ Node.jsï¼Œç¡®ä¿<code>--version</code>èƒ½å¤Ÿå®‰å…¨ä¼ é€’ç»™<code>script.js</code>ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>--</code>æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åˆ†éš”ç¬¦ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ¸…æ™°åœ°åŒºåˆ†å“ªäº›å‚æ•°æ˜¯ç»™ Node.js ç”¨çš„ï¼Œå“ªäº›æ˜¯ç»™æˆ‘ä»¬è‡ªå·±çš„è„šæœ¬æˆ–è€…åº”ç”¨ç¨‹åºç”¨çš„ã€‚è®°ä½è¿™ä¸ªå°æŠ€å·§ï¼Œå®ƒåœ¨ç¼–å†™æ›´åŠ å¤æ‚çš„å‘½ä»¤è¡Œå·¥å…·æ—¶å°¤å…¶æœ‰ç”¨ã€‚</p><h3 id="abort-on-uncaught-exception" tabindex="-1"><a class="header-anchor" href="#abort-on-uncaught-exception"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--abort-on-uncaught-exception" target="_blank" rel="noopener noreferrer">--abort-on-uncaught-exception</a></span></a></h3><p>Node.js ä¸­çš„ <code>--abort-on-uncaught-exception</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨ Node.js ç¨‹åºæ—¶ä½¿ç”¨å®ƒã€‚è¿™ä¸ªé€‰é¡¹çš„ä½œç”¨æ˜¯æŒ‡ç¤º Node.js è¿è¡Œç¯å¢ƒåœ¨é‡åˆ°æœªæ•è·çš„å¼‚å¸¸æ—¶ç«‹å³ä¸­æ–­æ‰§è¡Œï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ ¸å¿ƒè½¬å‚¨ï¼ˆcore dumpï¼‰ã€‚æ ¸å¿ƒè½¬å‚¨æ˜¯ç¨‹åºåœ¨å¼‚å¸¸ç»ˆæ­¢æ—¶å†…å­˜ä¸­å†…å®¹çš„å¿«ç…§ï¼Œå®ƒå¯ä»¥è¢«ç”¨äºåç»­çš„è°ƒè¯•åˆ†æï¼Œä»¥ç¡®å®šç¨‹åºå´©æºƒçš„åŸå› ã€‚</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“ Node.js ç¨‹åºä¸­å‘ç”Ÿäº†ä¸€ä¸ªæœªè¢«æ•è·çš„å¼‚å¸¸ï¼ˆå³æ²¡æœ‰è¢« try...catch è¯­å¥åŒ…å›´çš„å¼‚å¸¸æˆ–è€…æ²¡æœ‰é€šè¿‡ process.on(&#39;uncaughtException&#39;, handler) è®¾ç½®å¤„ç†å™¨çš„å¼‚å¸¸ï¼‰ï¼ŒNode.js ä¼šæ‰“å°é”™è¯¯ä¿¡æ¯åˆ°æ§åˆ¶å°ç„¶åé€€å‡ºç¨‹åºã€‚</p><p>ä½†æ˜¯æœ‰äº›æ—¶å€™ï¼Œä»…ä»…çŸ¥é“é”™è¯¯ä¿¡æ¯å¯èƒ½ä¸è¶³ä»¥æ‰¾å‡ºé—®é¢˜æ‰€åœ¨ï¼Œå°¤å…¶æ˜¯åœ¨å¤æ‚çš„åº”ç”¨ç¨‹åºä¸­ã€‚è¿™æ—¶å€™å¦‚æœæœ‰ä¸€ä¸ªå†…å­˜å¿«ç…§ï¼Œå°±èƒ½é€šè¿‡ä¸“é—¨çš„å·¥å…·åˆ†æå¿«ç…§æ–‡ä»¶æ¥æ·±å…¥äº†è§£å¼•èµ·å¼‚å¸¸çš„å…·ä½“åŸå› ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="ä¸ä½¿ç”¨-abort-on-uncaught-exception" tabindex="-1"><a class="header-anchor" href="#ä¸ä½¿ç”¨-abort-on-uncaught-exception"><span>ä¸ä½¿ç”¨ <code>--abort-on-uncaught-exception</code></span></a></h4><p>å‡è®¾ä½ æœ‰ä»¥ä¸‹ç®€å•çš„ Node.js ç¨‹åºï¼Œå®ƒä¼šæ•…æ„æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// app.js</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç¨‹åºå¼€å§‹æ‰§è¡Œ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å“¦è±ï¼Œå‡ºé”™å•¦ï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç¨‹åºæ‰§è¡Œä¸­...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœç›´æ¥è¿è¡Œè¿™ä¸ªç¨‹åºï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>é‚£ä¹ˆå¤§çº¦ä¸€ç§’é’Ÿåï¼Œä½ å°†åœ¨æ§åˆ¶å°çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„é”™è¯¯ä¿¡æ¯ï¼Œå¹¶ä¸”ç¨‹åºé€€å‡ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>ç¨‹åºå¼€å§‹æ‰§è¡Œ</span></span>
<span class="line"><span>ç¨‹åºæ‰§è¡Œä¸­...</span></span>
<span class="line"><span>/Users/yourname/path/to/app.js:4</span></span>
<span class="line"><span>  throw new Error(&#39;å“¦è±ï¼Œå‡ºé”™å•¦ï¼&#39;);</span></span>
<span class="line"><span>        ^</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Error: å“¦è±ï¼Œå‡ºé”™å•¦ï¼</span></span>
<span class="line"><span>    at Timeout._onTimeout (/Users/yourname/path/to/app.js:4:9)</span></span>
<span class="line"><span>    ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä½¿ç”¨-abort-on-uncaught-exception" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-abort-on-uncaught-exception"><span>ä½¿ç”¨ <code>--abort-on-uncaught-exception</code></span></a></h4><p>å¦‚æœä½ ä½¿ç”¨ <code>--abort-on-uncaught-exception</code> é€‰é¡¹è¿è¡Œç›¸åŒçš„ç¨‹åºï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --abort-on-uncaught-exception</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>é‚£ä¹ˆå½“æœªæ•è·çš„å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œé™¤äº†æ‰“å°é”™è¯¯ä¿¡æ¯ä¹‹å¤–ï¼ŒNode.js ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªæ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ã€‚æ ¹æ®æ“ä½œç³»ç»Ÿçš„é…ç½®ï¼Œè¿™ä¸ªæ–‡ä»¶é€šå¸¸ä¼šåœ¨ç¨‹åºè¿è¡Œç›®å½•ä¸‹ç”Ÿæˆï¼Œåå­—å¯èƒ½æ˜¯ <code>core</code> æˆ– <code>core.dmp</code>ã€‚</p><p>ä½ å¯ä»¥ä½¿ç”¨ gdb (GNU Debugger)ã€lldb (LLVM Debugger) æˆ–å…¶ä»–è°ƒè¯•å·¥å…·åŠ è½½è¿™ä¸ªæ ¸å¿ƒè½¬å‚¨æ–‡ä»¶æ¥è¿›è¡Œåˆ†æã€‚ä¾‹å¦‚ï¼Œåœ¨ Linux ç¯å¢ƒä¸‹ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·åšï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">gdb</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> core</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç„¶ååœ¨ GDB æç¤ºç¬¦ä¸‹è¾“å…¥ <code>bt</code>ï¼ˆbacktrace çš„ç¼©å†™ï¼‰æ¥æŸ¥çœ‹å½“æ—¶çš„è°ƒç”¨å †æ ˆï¼Œè¿™ä¼šå¸®åŠ©ä½ ç†è§£é”™è¯¯å‘ç”Ÿçš„ä¸Šä¸‹æ–‡ã€‚</p><p>è¯·æ³¨æ„ï¼Œæ­¤åŠŸèƒ½ä¸»è¦ç”¨äºå¼€å‘å’Œè°ƒè¯•é˜¶æ®µï¼Œè€Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç›´æ¥ç”Ÿæˆæ ¸å¿ƒè½¬å‚¨å¯èƒ½ä¼šæ¶‰åŠå®‰å…¨é£é™©ï¼Œå› ä¸ºè½¬å‚¨æ–‡ä»¶å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ã€‚æ­¤å¤–ï¼Œæ“ä½œç³»ç»Ÿå¯èƒ½éœ€è¦é¢å¤–çš„é…ç½®æ‰èƒ½å…è®¸æ™®é€šåº”ç”¨ç¨‹åºç”Ÿæˆæ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ã€‚</p><h3 id="allow-addons" tabindex="-1"><a class="header-anchor" href="#allow-addons"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--allow-addons" target="_blank" rel="noopener noreferrer">--allow-addons</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript çš„å¹³å°ï¼Œè€Œ <code>--allow-addons</code> æ˜¯ Node.js å‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰ä¸­çš„ä¸€ä¸ªé€‰é¡¹ã€‚ä» Node.js 21.7.1 ç‰ˆæœ¬å¼€å§‹ï¼Œè¿™ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ç”¨æ¥å¼€å¯æˆ–é™åˆ¶åŸç”Ÿæ’ä»¶ï¼ˆnative addonsï¼‰çš„æŸäº›åŠŸèƒ½ã€‚</p><p>åŸç”Ÿæ’ä»¶æ˜¯ä¸€ç§ç‰¹æ®Šçš„ä»£ç åº“ï¼Œé€šè¿‡ä½¿ç”¨ C++ ç­‰è¯­è¨€ç¼–å†™å¹¶ä¸ Node.js çš„ V8 JavaScript å¼•æ“è¿›è¡Œäº¤äº’ï¼Œä»¥æ­¤æä¾›æŸäº› JavaScript æœ¬èº«æ— æ³•é«˜æ•ˆå®ç°çš„æ“ä½œæˆ–è®¿é—®ç³»ç»Ÿåº•å±‚èµ„æºçš„èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½éœ€è¦ä¸€ä¸ªæ›´å¿«é€Ÿåœ°æ‰§è¡Œå›¾åƒå¤„ç†ä»»åŠ¡çš„åŸç”Ÿæ’ä»¶ï¼Œæˆ–è€…éœ€è¦ç›´æ¥ä¸æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œäº¤äº’çš„èƒ½åŠ›ã€‚</p><p>ç„¶è€Œï¼Œç”±äºåŸç”Ÿæ’ä»¶å¯ä»¥æ‰§è¡Œä»»æ„çš„ç³»ç»Ÿçº§æ“ä½œï¼Œå®ƒä»¬å¯èƒ½ä¼šå¸¦æ¥å®‰å…¨é£é™©ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªç²—å¿ƒç¼–å†™çš„æ’ä»¶å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ï¼Œæˆ–è€…æ¶æ„çš„æ’ä»¶å¯èƒ½è¯•å›¾æŸå®³ç³»ç»Ÿå®‰å…¨ã€‚å› æ­¤ï¼ŒNode.js æä¾›äº† <code>--allow-addons</code> é€‰é¡¹æ¥ç»™äºˆå¼€å‘è€…å¯¹åŸç”Ÿæ’ä»¶ä½¿ç”¨çš„æ§åˆ¶ã€‚</p><h3 id="ä½¿ç”¨-allow-addons-é€‰é¡¹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-allow-addons-é€‰é¡¹"><span>ä½¿ç”¨ <code>--allow-addons</code> é€‰é¡¹</span></a></h3><p>å½“ä½ åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œå¯ä»¥åŠ ä¸Š <code>--allow-addons</code> é€‰é¡¹ followed by a path to either a directory or a file.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --allow-addons=/path/to/allowed/addons</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåªæœ‰ <code>/path/to/allowed/addons</code> ç›®å½•ä¸­çš„åŸç”Ÿæ’ä»¶æ‰è¢«å…è®¸åŠ è½½ã€‚å¦‚æœå°è¯•åŠ è½½ä»»ä½•å…¶ä»–ä½ç½®çš„æ’ä»¶ï¼ŒNode.js å°†æŠ›å‡ºé”™è¯¯å¹¶æ‹’ç»æ‰§è¡Œã€‚</p><h3 id="ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­"><span>ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå›¾åƒå¤„ç†åº”ç”¨ï¼Œä½ é€‰æ‹©äº†ä¸€ä¸ªåä¸º <code>sharp</code> çš„æµè¡Œ Node.js å›¾åƒå¤„ç†åº“ï¼Œè¯¥åº“åœ¨å†…éƒ¨ä½¿ç”¨åŸç”Ÿæ’ä»¶æ¥åŠ é€Ÿæ“ä½œã€‚ä½ çš„åº”ç”¨ç›®å½•ç»“æ„å¯èƒ½å¦‚ä¸‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>/my-image-app</span></span>
<span class="line"><span>  /node_modules</span></span>
<span class="line"><span>    /sharp</span></span>
<span class="line"><span>      ...sharp çš„ç›¸å…³æ–‡ä»¶å’ŒåŸç”Ÿæ’ä»¶...</span></span>
<span class="line"><span>  my-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šå¸¸ï¼Œä½ ä¼šç›´æ¥è¿è¡Œ <code>node my-app.js</code> æ¥å¯åŠ¨åº”ç”¨ç¨‹åºã€‚ä½†å¦‚æœä½ æƒ³ç¡®ä¿åªæœ‰ <code>sharp</code> åº“ä¸­çš„åŸç”Ÿæ’ä»¶è¢«å…è®¸åŠ è½½ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code>--allow-addons</code> é€‰é¡¹æ¥æŒ‡å®š <code>sharp</code> æ¨¡å—çš„è·¯å¾„ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --allow-addons=/my-image-app/node_modules/sharp</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œå°±ç®—ä½ çš„åº”ç”¨ä¾èµ–äº†å…¶å®ƒä½¿ç”¨åŸç”Ÿæ’ä»¶çš„åº“ï¼ŒNode.js è¿˜æ˜¯åªä¼šå…è®¸ <code>sharp</code> ä¸­çš„åŸç”Ÿæ’ä»¶åŠ è½½è¿è¡Œã€‚</p><p>æ€»ä¹‹ï¼Œ<code>--allow-addons</code> é€‰é¡¹æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œä½¿å¾— Node.js åº”ç”¨çš„å¼€å‘è€…å¯ä»¥æ›´ç»†ç²’åº¦åœ°æ§åˆ¶å“ªäº›åŸç”Ÿæ’ä»¶æ˜¯è¢«ä¿¡ä»»å¹¶å…è®¸åŠ è½½çš„ï¼Œä»è€Œå¢å¼ºäº†åº”ç”¨çš„å®‰å…¨æ€§ã€‚</p><h3 id="allow-child-process" tabindex="-1"><a class="header-anchor" href="#allow-child-process"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--allow-child-process" target="_blank" rel="noopener noreferrer">--allow-child-process</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>--allow-child-process</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼ˆCLI flagï¼‰ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨ Node.js ç¨‹åºæ—¶æ·»åŠ å®ƒæ¥æ§åˆ¶å­è¿›ç¨‹çš„åˆ›å»ºã€‚è¿™ä¸ªæ ‡å¿—æ˜¯ Node.js å®‰å…¨ç›¸å…³åŠŸèƒ½çš„ä¸€éƒ¨åˆ†ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ å¯åŠ¨ä¸€ä¸ª Node.js åº”ç”¨æ—¶ï¼Œä½¿ç”¨ <code>--allow-child-process</code> æ ‡å¿—å¯ä»¥å…è®¸æˆ–é™åˆ¶åº”ç”¨ç¨‹åºå†…éƒ¨åˆ›å»ºæ–°çš„å­è¿›ç¨‹ã€‚</p><p>å­è¿›ç¨‹æ˜¯ä»çˆ¶è¿›ç¨‹ï¼ˆä½ çš„ä¸» Node.js åº”ç”¨ç¨‹åºï¼‰æ´¾ç”Ÿå‡ºæ¥çš„ç‹¬ç«‹è¿›ç¨‹ã€‚åœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸é€šè¿‡ <code>child_process</code> æ¨¡å—æ¥åˆ›å»ºå’Œç®¡ç†å­è¿›ç¨‹ã€‚å­è¿›ç¨‹å¯ä»¥ç”¨æ¥æ‰§è¡Œå…¶ä»–ç¨‹åºã€è¿è¡Œå¦ä¸€ä¸ªè„šæœ¬æˆ–è¿›è¡Œä¸€äº›éœ€è¦éš”ç¦»æ‰§è¡Œçš„ä»»åŠ¡ã€‚</p><p>å®é™…åº”ç”¨ç¤ºä¾‹:</p><ol><li><p><strong>è‡ªåŠ¨åŒ–è„šæœ¬è¿è¡Œ</strong>: å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªè‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œä½ å¯èƒ½éœ€è¦è°ƒç”¨åƒ Git, SSH æˆ–å…¶ä»–ç³»ç»Ÿå‘½ä»¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ Node.js çš„ <code>child_process</code> æ¨¡å—æ¥æ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">exec</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;child_process&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">exec</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;git pull origin master&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">stderr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`æ‰§è¡Œçš„é”™è¯¯: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`stdout: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stdout</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`stderr: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stderr</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœä½ çš„ Node.js åº”ç”¨å¯åŠ¨æ—¶ä½¿ç”¨äº† <code>--allow-child-process</code> æ ‡å¿—ï¼Œé‚£ä¹ˆ <code>exec</code> è°ƒç”¨å°†èƒ½æˆåŠŸæ‰§è¡Œ <code>git pull</code> å‘½ä»¤ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªæ ‡å¿—ï¼ŒNode.js å¯èƒ½ä¼šé˜»æ­¢åˆ›å»ºå­è¿›ç¨‹å¹¶æŠ›å‡ºé”™è¯¯ã€‚</p></li><li><p><strong>Web æœåŠ¡å™¨å¤„ç† CPU å¯†é›†å‹ä»»åŠ¡</strong>: å‡è®¾ä½ æœ‰ä¸€ä¸ª Web åº”ç”¨ç¨‹åºï¼Œç”¨æˆ·è¯·æ±‚å¯¹å›¾åƒè¿›è¡Œå¤„ç†ã€‚ä¸ºäº†ä¸é˜»å¡äº‹ä»¶å¾ªç¯ï¼Œä½ å¯èƒ½å¸Œæœ›åœ¨å­è¿›ç¨‹ä¸­å¤„ç†å›¾åƒã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">fork</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;child_process&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> child</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fork</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./image-processing-script.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">child</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ”¶åˆ°å­è¿›ç¨‹çš„æ¶ˆæ¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">child</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">imagePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/image.png&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ çš„æœåŠ¡å™¨å¯åŠ¨æ—¶åŒ…å« <code>--allow-child-process</code> æ ‡å¿—ï¼Œå®ƒå°†å…è®¸ <code>fork</code> åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹æ¥è¿è¡Œ <code>image-processing-script.js</code>ã€‚å¦åˆ™ï¼Œå°è¯•åˆ›å»ºå­è¿›ç¨‹æ—¶å¯èƒ½ä¼šå¤±è´¥ã€‚</p></li><li><p><strong>å¾®æœåŠ¡æ¶æ„ä¸­çš„æœåŠ¡é—´é€šä¿¡</strong>: åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå„ä¸ªæœåŠ¡å¯èƒ½ä¼šä½œä¸ºç‹¬ç«‹çš„è¿›ç¨‹è¿è¡Œã€‚Node.js åº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦å¯åŠ¨æˆ–ä¸è¿™äº›ç‹¬ç«‹çš„æœåŠ¡è¿›è¡Œäº¤äº’ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">spawn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;child_process&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> microService</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> spawn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;service.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">microService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`è¾“å‡º: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">microService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stderr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`é”™è¯¯: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ<code>spawn</code> ç”¨æ¥å¯åŠ¨å¦ä¸€ä¸ª Node.js è„šæœ¬ <code>service.js</code> ä½œä¸ºå­è¿›ç¨‹ã€‚å¦‚æœåœ¨å¯åŠ¨ä¸» Node.js åº”ç”¨ç¨‹åºæ—¶è®¾ç½®äº† <code>--allow-child-process</code> æ ‡å¿—ï¼Œåˆ™æ­¤å­è¿›ç¨‹ä¼šè¢«æˆåŠŸåˆ›å»ºã€‚</p></li></ol><p><strong>æ³¨æ„</strong>: <code>--allow-child-process</code> æ ‡è®°çš„ç¡®åˆ‡è¡Œä¸ºå¯èƒ½ä¼šéšç€ Node.js ç‰ˆæœ¬å˜åŒ–è€Œå˜åŒ–ï¼Œå¹¶ä¸”æŸäº›ç‰ˆæœ¬å¯èƒ½ä¸æ”¯æŒè¿™ä¸ªæ ‡å¿—ï¼Œå› æ­¤é‡è¦çš„æ˜¯è¦æŸ¥çœ‹ç‰¹å®šäºæ‚¨æ­£åœ¨ä½¿ç”¨çš„ Node.js ç‰ˆæœ¬çš„æ–‡æ¡£ã€‚åœ¨æ’°å†™è¿™ç¯‡å›ç­”æ—¶çš„æœ€æ–°ç¨³å®šç‰ˆæœ¬ Node.js v21.7.1 æ”¯æŒè¿™ä¸ªæ ‡å¿—ï¼Œä½†æœªæ¥çš„ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚</p><h3 id="allow-fs-read" tabindex="-1"><a class="header-anchor" href="#allow-fs-read"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--allow-fs-read" target="_blank" rel="noopener noreferrer">--allow-fs-read</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js çš„ä¸åŒç‰ˆæœ¬ä¸­ï¼Œæä¾›äº†å¤šç§å‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰é€‰é¡¹æ¥æ§åˆ¶ JavaScript ä»£ç çš„æ‰§è¡Œæ–¹å¼ã€‚</p><p>åœ¨ Node.js ç‰ˆæœ¬ 21.7.1 ä¸­ï¼Œ<code>--allow-fs-read</code> æ˜¯ä¸€ä¸ª CLI é€‰é¡¹ï¼Œå®ƒç”¨äºé™åˆ¶æˆ–å…è®¸è„šæœ¬å¯¹æ–‡ä»¶ç³»ç»Ÿçš„è¯»å–æ“ä½œã€‚å½“ä½ å¯åŠ¨ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ·»åŠ è¿™ä¸ªé€‰é¡¹æ¥å¼€å¯æˆ–å…³é—­æ–‡ä»¶ç³»ç»Ÿè¯»å–æƒé™ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js åº”ç”¨å¯ä»¥è‡ªç”±åœ°è¯»å–ä¸»æœºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„ä»»ä½•æ–‡ä»¶ï¼Œå‰ææ˜¯åº”ç”¨æœ‰è¶³å¤Ÿçš„æƒé™ã€‚ä½†å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä½ å¯èƒ½æƒ³è¦é™åˆ¶ä¸€ä¸ª Node.js åº”ç”¨çš„èƒ½åŠ›ï¼Œå°¤å…¶æ˜¯å½“åº”ç”¨æ¥è‡ªä¸ä¿¡ä»»çš„æºæˆ–è€…æ˜¯åœ¨æŸäº›å®‰å…¨æ•æ„Ÿçš„ç¯å¢ƒä¸­æ‰§è¡Œæ—¶ã€‚</p><p>ä½¿ç”¨ <code>--allow-fs-read</code> é€‰é¡¹çš„ä¾‹å­ï¼š</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„ Node.js è„šæœ¬ (<code>readfile.js</code>)ï¼Œå®ƒå°è¯•è¯»å–ç³»ç»Ÿä¸Šçš„ä¸€ä¸ªæ–‡ä»¶å¹¶æ‰“å°å…¶å†…å®¹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°è¯•è¯»å–å½“å‰ç›®å½•ä¸‹çš„ &#39;example.txt&#39; æ–‡ä»¶ï¼Œå¹¶æ‰“å°å…¶å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ— æ³•è¯»å–æ–‡ä»¶&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šå¸¸ï¼Œä½ ä¼šè¿™æ ·è¿è¡Œè¯¥è„šæœ¬ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> readfile.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœ <code>example.txt</code> æ–‡ä»¶å­˜åœ¨ä¸”è„šæœ¬æœ‰æƒé™è¯»å–å®ƒï¼Œé‚£ä¹ˆå®ƒçš„å†…å®¹å°†è¢«æ‰“å°åˆ°æ§åˆ¶å°ã€‚</p><p>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦é™åˆ¶æ–‡ä»¶ç³»ç»Ÿçš„è¯»å–æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>--allow-fs-read</code> é€‰é¡¹ã€‚ä¾‹å¦‚ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --allow-fs-read=false</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> readfile.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¸Šè¿°å‘½ä»¤å‘Šè¯‰ Node.js åœ¨è¿è¡Œ <code>readfile.js</code> è„šæœ¬æ—¶ç¦æ­¢æ–‡ä»¶ç³»ç»Ÿè¯»å–æ“ä½œã€‚å› æ­¤ï¼Œå°½ç®¡è„šæœ¬è¯•å›¾è¯»å–æ–‡ä»¶ï¼Œä½†å®ƒä¼šå¤±è´¥ï¼Œå¹¶ä¸”å¯èƒ½ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œæ˜¾ç¤ºä¸º &quot;æ— æ³•è¯»å–æ–‡ä»¶&quot;ã€‚</p><p>åè¿‡æ¥ï¼Œå¦‚æœä½ æƒ³è¦æ˜¾å¼åœ°å…è®¸æŸä¸ªç‰¹å®šçš„è·¯å¾„æˆ–æ–‡ä»¶çš„è¯»å–ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --allow-fs-read=/path/to/specific/directory</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> readfile.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æˆ–è€…åªå…è®¸è¯»å–ç‰¹å®šçš„æ–‡ä»¶ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --allow-fs-read=/path/to/specific/file.txt</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> readfile.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¸¤ä¸ªå‘½ä»¤ä¸­ï¼Œæˆ‘ä»¬åˆ†åˆ«å…è®¸äº†å¯¹ <code>/path/to/specific/directory</code> ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„è¯»å–ï¼Œä»¥åŠå¯¹ <code>/path/to/specific/file.txt</code> å•ä¸ªæ–‡ä»¶çš„è¯»å–ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦åœ¨è¿è¡Œ Node.js åº”ç”¨æ—¶æ›´ç»†ç²’åº¦åœ°æ§åˆ¶æ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®ï¼Œè¿™æœ‰åˆ©äºæé«˜åº”ç”¨çš„å®‰å…¨æ€§ã€‚</p><h3 id="allow-fs-write" tabindex="-1"><a class="header-anchor" href="#allow-fs-write"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--allow-fs-write" target="_blank" rel="noopener noreferrer">--allow-fs-write</a></span></a></h3><p><code>--allow-fs-write</code> æ˜¯åœ¨ Node.js v21.7.1 ä¸­è¢«å¼•å…¥çš„ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œè¿™æ˜¯ä¸ºäº†å®‰å…¨æ€§è€Œè®¾è®¡çš„ã€‚Node.js é€šå¸¸ä¼šå…è®¸åº”ç”¨ç¨‹åºè¯»å†™æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™æ˜¯å¾ˆå¤šæœåŠ¡å™¨ç«¯ç¨‹åºçš„åŸºç¡€åŠŸèƒ½ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³è¦é™åˆ¶è¿™ç§èƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯å½“æˆ‘ä»¬è¿è¡Œä¸ä¿¡ä»»çš„ä»£ç æ—¶ã€‚</p><p>åœ¨ Node.js v21.7.1 ä¹‹å‰ï¼Œå¦‚æœä½ è¿è¡Œ Node.js çš„æ²™ç®±ç¯å¢ƒï¼ˆæ¯”å¦‚ <code>vm</code> æ¨¡å—ï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸èƒ½è¿›è¡Œæ–‡ä»¶ç³»ç»Ÿæ“ä½œçš„ã€‚å¦‚æœä½ æƒ³è¦åœ¨æ²™ç®±ç¯å¢ƒä¸­å…è®¸æ–‡ä»¶ç³»ç»Ÿå†™æ“ä½œï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨ <code>--allow-fs-write</code> é€‰é¡¹ã€‚</p><p>ä¸‹é¢é€šè¿‡ä¸€äº›ä¾‹å­æ¥è¯´æ˜ <code>--allow-fs-write</code> å¦‚ä½•å·¥ä½œï¼š</p><h3 id="ç¤ºä¾‹-1-ä½¿ç”¨-allow-fs-write-è¿è¡Œè„šæœ¬" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-ä½¿ç”¨-allow-fs-write-è¿è¡Œè„šæœ¬"><span>ç¤ºä¾‹ 1ï¼šä½¿ç”¨ <code>--allow-fs-write</code> è¿è¡Œè„šæœ¬</span></a></h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º <code>script.js</code> çš„ç®€å• Node.js è„šæœ¬ï¼Œå®ƒå°è¯•åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;The file has been saved!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœä½ ç›´æ¥è¿è¡Œè¿™ä¸ªè„šæœ¬ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å®ƒå°†åˆ›å»ºä¸€ä¸ªåä¸º <code>hello.txt</code> çš„æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«æ–‡æœ¬ <code>Hello, world!</code>ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å¯ç”¨äº† Node.js çš„æ²™ç®±æ¨¡å¼ï¼Œå¹¶ä¸”æ²¡æœ‰æŒ‡å®š <code>--allow-fs-write</code> é€‰é¡¹ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶åˆ›å»ºæ“ä½œå°†å¤±è´¥ï¼Œå› ä¸ºæ²™ç®±æ¨¡å¼é»˜è®¤ç¦æ­¢æ–‡ä»¶ç³»ç»Ÿçš„å†™æ“ä½œã€‚</p><h3 id="ç¤ºä¾‹-2-æ²™ç®±ç¯å¢ƒä¸­å…è®¸æ–‡ä»¶å†™æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-æ²™ç®±ç¯å¢ƒä¸­å…è®¸æ–‡ä»¶å†™æ“ä½œ"><span>ç¤ºä¾‹ 2ï¼šæ²™ç®±ç¯å¢ƒä¸­å…è®¸æ–‡ä»¶å†™æ“ä½œ</span></a></h3><p>ç°åœ¨å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ Node.js çš„æ²™ç®±æ¨¡å¼æ¥è¿è¡Œä¸€äº›ä»£ç ç‰‡æ®µï¼Œå¹¶ä¸”ä½ æƒ³è¦å…è®¸è¿™æ®µä»£ç å†™å…¥æ–‡ä»¶ç³»ç»Ÿã€‚ä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --allow-fs-write</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;const fs = require(&#39;fs&#39;); fs.writeFileSync(&#39;sandbox_hello.txt&#39;, &#39;Sandbox Hello, world!&#39;);&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¸Šé¢çš„å‘½ä»¤ä½¿ç”¨ <code>-e</code> å‚æ•°åœ¨ Node.js å‘½ä»¤è¡Œä¸­ç›´æ¥æ‰§è¡Œäº†ä¸€æ®µä»£ç ï¼Œåˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>sandbox_hello.txt</code> çš„æ–‡ä»¶ã€‚ç”±äºæˆ‘ä»¬æŒ‡å®šäº† <code>--allow-fs-write</code> é€‰é¡¹ï¼Œå³ä½¿åœ¨æ²™ç®±ç¯å¢ƒä¸­ï¼Œè¿™æ®µä»£ç ä¹Ÿè¢«å…è®¸å†™æ–‡ä»¶ã€‚</p><h3 id="æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹"><span>æ³¨æ„äº‹é¡¹</span></a></h3><ul><li>è¿™ä¸ªé€‰é¡¹ä¸»è¦æ˜¯ä¸ºäº†æé«˜å®‰å…¨æ€§ï¼Œä½¿ä½ èƒ½å¤Ÿæ›´å¥½åœ°æ§åˆ¶å“ªäº› Node.js ä»£ç å¯ä»¥å¯¹æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå†™æ“ä½œã€‚</li><li>ä½¿ç”¨ <code>--allow-fs-write</code> æ—¶ï¼Œéœ€è¦è€ƒè™‘å®‰å…¨æ€§ï¼Œåªåœ¨ä½ ä¿¡ä»»è¿è¡Œçš„ä»£ç æ—¶ä½¿ç”¨å®ƒï¼Œæˆ–è€…åœ¨ä¸€ä¸ªå®‰å…¨çš„ã€éš”ç¦»çš„ç¯å¢ƒä¸‹ä½¿ç”¨ã€‚</li></ul><p>æ€»ç»“æ¥è¯´ï¼Œ<code>--allow-fs-write</code> æ˜¯ä¸€ä¸ªç”¨äºæ§åˆ¶ Node.js ç¨‹åºåœ¨æ²™ç®±æ¨¡å¼ä¸‹æ˜¯å¦èƒ½è¿›è¡Œæ–‡ä»¶ç³»ç»Ÿå†™æ“ä½œçš„é€‰é¡¹ã€‚åœ¨å®‰å…¨æ•æ„Ÿçš„åº”ç”¨åœºæ™¯ä¸‹ï¼Œé€‚å½“çš„ä½¿ç”¨è¿™ä¸ªé€‰é¡¹å¯ä»¥å¸®åŠ©é˜²æ­¢æ¶æ„ä»£ç é€ æˆæ–‡ä»¶ç³»ç»Ÿçš„ç ´åã€‚</p><h3 id="allow-worker" tabindex="-1"><a class="header-anchor" href="#allow-worker"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--allow-worker" target="_blank" rel="noopener noreferrer">--allow-worker</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡ç«¯ä»£ç ã€‚Node.js æœ¬èº«æ˜¯å•çº¿ç¨‹çš„ï¼Œä½†ä¸ºäº†åˆ©ç”¨å¤šæ ¸ CPU çš„æ€§èƒ½ï¼Œæä¾›äº†ä¸€ç§å«åš Worker Threads çš„æ–¹å¼æ¥åˆ›å»ºå¯ä»¥è¿è¡Œåœ¨å…¶ä»–çº¿ç¨‹ä¸Šçš„ä»»åŠ¡ã€‚</p><p><code>--allow-worker</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼ˆCLIï¼‰ï¼Œå®ƒç”¨äºå¯åŠ¨æ—¶æ§åˆ¶æ˜¯å¦å…è®¸ä½¿ç”¨ Worker Threadsã€‚ä» Node.js v12.11.0 ç‰ˆæœ¬å¼€å§‹å¼•å…¥ï¼Œå½“ä½ å¯åŠ¨ Node.js ç¨‹åºæ—¶åŠ ä¸Šè¿™ä¸ªé€‰é¡¹ï¼Œå°±è¡¨ç¤ºä½ å…è®¸åœ¨è¯¥ç¨‹åºä¸­ä½¿ç”¨ Worker Threadsã€‚</p><p>Worker Threads å…è®¸ä½ è¿›è¡Œå¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œæ¯ä¸ª Worker éƒ½æœ‰è‡ªå·±çš„ V8 å®ä¾‹å’Œ Event Loopï¼Œå› æ­¤å®ƒä»¬å¯ä»¥åœ¨ä¸åŒçš„å†…æ ¸ä¸Šå¹¶è¡Œæ‰§è¡Œè®¡ç®—å¯†é›†å‹æˆ–å¼‚æ­¥ I/O æ“ä½œï¼Œè€Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚</p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºéœ€è¦è¿›è¡Œå¤§é‡çš„è®¡ç®—å·¥ä½œï¼Œæ¯”å¦‚å›¾åƒå¤„ç†æˆ–æ–‡ä»¶åŠ å¯†ç­‰ï¼Œé€šå¸¸è¿™äº›æ“ä½œå¦‚æœæ”¾åœ¨å•ä¸ªä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œå¯èƒ½ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºå˜å¾—ç¼“æ…¢ç”šè‡³æ— å“åº”ã€‚é€šè¿‡ä½¿ç”¨ Worker Threadsï¼Œä½ å¯ä»¥å°†è¿™äº›ä»»åŠ¡åˆ†æ•£åˆ°å¤šä¸ªçº¿ç¨‹ä¸­å»æ‰§è¡Œï¼Œè¿™æ ·ä¸»çº¿ç¨‹å°±å¯ä»¥ä¿æŒè½»ç›ˆå¿«é€Ÿï¼Œç»§ç»­å¤„ç†å…¶ä»–çš„äº‹ä»¶å¾ªç¯ä»»åŠ¡ï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ç­‰ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><ol><li>å›¾åƒå¤„ç†ï¼šå¦‚æœä½ æ­£åœ¨æ„å»ºä¸€ä¸ªç½‘ç«™ï¼Œéœ€è¦å¯¹ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚é‡è®¾å¤§å°ã€åº”ç”¨æ»¤é•œç­‰ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª Worker Thread æ¥æ‰§è¡Œè¿™äº›è€—æ—¶çš„æ“ä½œï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// main.js ä¸»çº¿ç¨‹ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;worker_threads&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> processImage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">imagePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> worker</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./image-worker.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">workerData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">imagePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;exit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Worker stopped with exit code </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// image-worker.js å·¥ä½œçº¿ç¨‹ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">workerData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">parentPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;worker_threads&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> process</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;some-image-processing-library&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">workerData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  parentPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>æ•°æ®åŠ å¯†ï¼šå½“ç”¨æˆ·æ³¨å†Œè´¦å·æ—¶ï¼Œä½ éœ€è¦å¯¹å¯†ç è¿›è¡ŒåŠ å¯†å­˜å‚¨ã€‚è¿™ä¸ªåŠ å¯†è¿‡ç¨‹å¯ä»¥æ”¾åœ¨ä¸€ä¸ª Worker Thread å®Œæˆï¼Œä»¥ç¡®ä¿ä¸»çº¿ç¨‹å¯ä»¥ç»§ç»­æ¥æ”¶æ–°çš„è¯·æ±‚ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// main.js ä¸»çº¿ç¨‹ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;worker_threads&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> encryptPassword</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">password</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> worker</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./encrypt-worker.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">workerData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">password</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;exit&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Worker stopped with exit code </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// encrypt-worker.js å·¥ä½œçº¿ç¨‹ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">workerData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">parentPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;worker_threads&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> bcrypt</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;bcrypt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">bcrypt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">hash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">workerData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">hash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  parentPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ <code>--allow-worker</code> é€‰é¡¹ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ¥å¯åŠ¨åŒ…å« Worker Threads ä»£ç çš„ Node.js åº”ç”¨ç¨‹åºï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --allow-worker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> main.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œä½ çš„åº”ç”¨ç¨‹åºå°±å¯ä»¥åœ¨éœ€è¦æ—¶åˆ›å»ºå’Œä½¿ç”¨ Worker Threads æ¥æå‡æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚</p><h3 id="build-snapshot" tabindex="-1"><a class="header-anchor" href="#build-snapshot"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--build-snapshot" target="_blank" rel="noopener noreferrer">--build-snapshot</a></span></a></h3><p>Node.js ä¸­çš„ <code>--build-snapshot</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨äºåœ¨æ„å»º Node.js æ—¶åˆ›å»ºä¸€ä¸ªå¯åŠ¨å¿«ç…§ï¼ˆsnapshotï¼‰ã€‚è¿™ä¸ªåŠŸèƒ½ä¸»è¦æ˜¯ä¸ºäº†æé«˜ Node.js åº”ç”¨ç¨‹åºçš„å¯åŠ¨é€Ÿåº¦ã€‚</p><p>å½“ Node.js å¯åŠ¨æ—¶ï¼Œå®ƒéœ€è¦åˆå§‹åŒ–å†…éƒ¨çš„å¾ˆå¤šä¸œè¥¿ï¼Œä¾‹å¦‚è®¾ç½®å†…ç½®æ¨¡å—å’Œå…¨å±€å¯¹è±¡ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œç‰¹åˆ«æ˜¯åœ¨è¾ƒæ…¢çš„è®¾å¤‡ä¸Šã€‚é€šè¿‡åˆ›å»ºä¸€ä¸ªå¯åŠ¨å¿«ç…§ï¼Œå¯ä»¥å°†è¿™ä¸ªåˆå§‹åŒ–è¿‡ç¨‹ä¿å­˜ä¸‹æ¥ï¼Œä»¥ä¾¿ä¸‹æ¬¡å¯åŠ¨æ—¶ç›´æ¥è¯»å–å¿«ç…§ï¼Œè€Œä¸æ˜¯é‡æ–°æ‰§è¡Œæ‰€æœ‰åˆå§‹åŒ–æ­¥éª¤ã€‚</p><p>è¿™é‡Œæœ‰ä¸¤ä¸ªæœ¯è¯­éœ€è¦è§£é‡Šï¼š</p><ol><li><strong>Snapshot</strong>: å¿«ç…§æ˜¯æŒ‡åœ¨ç‰¹å®šæ—¶åˆ»å¯¹åº”ç”¨ç¨‹åºçŠ¶æ€è¿›è¡Œçš„å®Œæ•´è®°å½•ã€‚</li><li><strong>V8</strong>: V8 æ˜¯ Google å¼€å‘çš„å¼€æº JavaScript å¼•æ“ï¼ŒNode.js å°±æ˜¯åŸºäºè¿™ä¸ªå¼•æ“è¿è¡Œ JavaScript ä»£ç çš„ã€‚</li></ol><p>å®é™…ä¸Šï¼Œ<code>--build-snapshot</code> é€‰é¡¹æ˜¯ç»™ Node.js çš„æ„å»ºç³»ç»Ÿä½¿ç”¨çš„ï¼Œæ™®é€šç”¨æˆ·åœ¨æ—¥å¸¸å¼€å‘ä¸­ä¸€èˆ¬ä¸ä¼šç›´æ¥ä½¿ç”¨æ­¤é€‰é¡¹ã€‚è¿™æ˜¯ä¸€ä¸ªæ›´é€‚åˆ Node.js ç»´æŠ¤è€…æˆ–é‚£äº›æƒ³è¦è‡ªå®šä¹‰ Node.js äºŒè¿›åˆ¶æ–‡ä»¶çš„é«˜çº§ç”¨æˆ·çš„åŠŸèƒ½ã€‚</p><p>ä»¥ä¸‹æ˜¯å¦‚æœä½ æ˜¯ Node.js ç»´æŠ¤è€…æˆ–é«˜çº§ç”¨æˆ·æƒ³è¦æ„å»ºå¸¦æœ‰å¿«ç…§çš„ Node.js æ—¶å¯èƒ½ä¼šç»å†çš„æ­¥éª¤ï¼š</p><ol><li><p><strong>è·å– Node.js æºä»£ç </strong>: é¦–å…ˆä½ éœ€è¦ä» Node.js çš„ GitHub ä»“åº“å…‹éš†æºä»£ç åˆ°æœ¬åœ°è®¡ç®—æœºä¸Šã€‚</p></li><li><p><strong>ç¼–è¯‘</strong>: ä½¿ç”¨ Node.js æºä»£ç ç¼–è¯‘è‡ªå·±çš„ Node.js äºŒè¿›åˆ¶æ–‡ä»¶ã€‚é€šå¸¸è¿™æ¶‰åŠåˆ°è¿è¡Œä¸€ç³»åˆ—çš„è„šæœ¬å’Œå‘½ä»¤ï¼Œæ¯”å¦‚ <code>./configure</code> å’Œ <code>make</code>ã€‚</p></li><li><p><strong>åˆ›å»ºå¿«ç…§</strong>: åœ¨ç¼–è¯‘æ—¶åŠ å…¥ <code>--build-snapshot</code> é€‰é¡¹ï¼Œè¿™æ ·æ„å»ºè¿‡ç¨‹å°±ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«äº†åˆå§‹åŒ–çŠ¶æ€çš„å¿«ç…§æ–‡ä»¶ã€‚</p></li><li><p><strong>ä½¿ç”¨å¿«ç…§å¯åŠ¨ Node.js</strong>: å½“ä½ ä¹‹åå¯åŠ¨è¿™ä¸ªç¼–è¯‘å¥½çš„ Node.js äºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šä½¿ç”¨ä¹‹å‰åˆ›å»ºçš„å¿«ç…§ï¼Œè¿™æ ·å¯ä»¥è·³è¿‡åˆå§‹åŒ–è¿‡ç¨‹ï¼Œä½¿å¾— Node.js å¯åŠ¨æ›´å¿«ã€‚</p></li></ol><p>ä¸¾ä¸€ä¸ªå®é™…ä¾‹å­ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ª Node.js ç¨‹åºï¼Œæ¯æ¬¡å¯åŠ¨éƒ½éœ€è¦åŠ è½½å¤§é‡çš„æ¨¡å—å’Œé…ç½®ï¼Œåœ¨æ²¡æœ‰å¿«ç…§çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå¯åŠ¨è¿‡ç¨‹å¯èƒ½éœ€è¦å‡ ç§’é’Ÿã€‚ä½†æ˜¯å¦‚æœä½ ä½¿ç”¨äº† <code>--build-snapshot</code> åˆ›å»ºäº†ä¸€ä¸ªå¯åŠ¨å¿«ç…§å¹¶åœ¨å¯åŠ¨æ—¶ä½¿ç”¨å®ƒï¼Œé‚£ä¹ˆè¿™ä¸ªå¯åŠ¨æ—¶é—´å¯èƒ½ä¼šæ˜¾è‘—ç¼©çŸ­ï¼Œå› ä¸ºè®¸å¤šåˆå§‹åŒ–å·¥ä½œå·²ç»æå‰å®Œæˆäº†ã€‚</p><p>è®°ä½ï¼Œè¿™ä¸ªåŠŸèƒ½æ›´å¤šæ˜¯é’ˆå¯¹éœ€è¦ä¼˜åŒ– Node.js å¯åŠ¨æ€§èƒ½çš„åœºæ™¯ï¼Œå¯¹äºæ™®é€šå¼€å‘è€…æ¥è¯´ï¼Œä½¿ç”¨æ ‡å‡†çš„ Node.js ç‰ˆæœ¬å°±è¶³å¤Ÿäº†ï¼Œä¸éœ€è¦æ·±å…¥è¿™äº›åº•å±‚ç»†èŠ‚ã€‚</p><h3 id="build-snapshot-config" tabindex="-1"><a class="header-anchor" href="#build-snapshot-config"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--build-snapshot-config" target="_blank" rel="noopener noreferrer">--build-snapshot-config</a></span></a></h3><p><code>--build-snapshot-config</code> æ˜¯ä¸€ä¸ªç”¨äº Node.js æ„å»ºè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªé«˜çº§å‘½ä»¤è¡Œé€‰é¡¹ã€‚åœ¨ä½ ä½œä¸ºç¼–ç¨‹æ–°æ‰‹æ—¶ï¼Œé€šå¸¸ä¸éœ€è¦ç”¨åˆ°è¿™ä¸ªé€‰é¡¹ï¼Œå› ä¸ºå®ƒå…³ç³»åˆ° Node.js çš„å†…éƒ¨æ„å»ºå’Œæ€§èƒ½ä¼˜åŒ–ã€‚ä½†æ˜¯ï¼Œæˆ‘å¯ä»¥ç®€å•åœ°è§£é‡Šä¸€ä¸‹å®ƒçš„ä½œç”¨ï¼Œå¹¶ç»™å‡ºä¸€äº›å¯èƒ½çš„ä½¿ç”¨åœºæ™¯ã€‚</p><p>é¦–å…ˆï¼Œ&quot;å¿«ç…§&quot;ï¼ˆsnapshotï¼‰åœ¨ Node.js ä¸­æŒ‡çš„æ˜¯åœ¨ç¼–è¯‘æ—¶æ•è·çš„ JavaScript ä»£ç çš„çŠ¶æ€ã€‚Node.js å¯ä»¥å°†åˆå§‹åŒ–æ—¶éœ€è¦æ‰§è¡Œçš„ä»£ç å­˜å‚¨åœ¨å¿«ç…§ä¸­ï¼Œè¿™æ ·å½“ Node.js å¯åŠ¨æ—¶å°±å¯ä»¥å¿«é€ŸåŠ è½½è¿™ä¸ªå¿«ç…§ï¼Œè€Œä¸æ˜¯é‡æ–°æ‰§è¡Œæ‰€æœ‰çš„åˆå§‹åŒ–ä»£ç ã€‚è¿™é€šå¸¸ä¼šå¯¼è‡´æ›´å¿«çš„å¯åŠ¨æ—¶é—´ã€‚</p><p><code>--build-snapshot-config</code> è¿™ä¸ªé€‰é¡¹å…è®¸ä½ åœ¨æ„å»º Node.js äºŒè¿›åˆ¶æ–‡ä»¶æ—¶æŒ‡å®šä¸€ä¸ª JSON é…ç½®æ–‡ä»¶ã€‚è¿™ä¸ª JSON æ–‡ä»¶åŒ…å«äº†å“ªäº› JavaScript ä»£ç åº”è¯¥è¢«åŒ…å«åœ¨å¿«ç…§ä¸­ã€‚ä½ å¯ä»¥æ§åˆ¶å“ªäº›æ¨¡å—æˆ–è€…è„šæœ¬è¢«é¢„å…ˆåŠ è½½å¹¶ä¸”åˆ›å»ºå¿«ç…§ï¼Œä»è€Œå¯èƒ½å‡å°‘ç¨‹åºçš„å¯åŠ¨æ—¶é—´ã€‚</p><p>å®é™…ä½¿ç”¨ä¾‹å­ï¼š</p><ol><li><p><strong>é«˜æ€§èƒ½åº”ç”¨</strong>ï¼šå¦‚æœä½ å¼€å‘äº†ä¸€ä¸ªéœ€è¦æå¿«å¯åŠ¨æ—¶é—´çš„é«˜æ€§èƒ½åº”ç”¨ï¼Œä½ å¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªé€‰é¡¹æ¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ Node.js æ„å»ºã€‚é€šè¿‡è¿™ä¸ªæ„å»ºï¼Œä½ å¯ä»¥ç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶åŠ è½½çš„æ˜¯é¢„å…ˆç”Ÿæˆçš„å¿«ç…§ï¼Œè€Œä¸æ˜¯åœ¨æ¯æ¬¡å¯åŠ¨æ—¶éƒ½é‡æ–°æ‰§è¡Œåˆå§‹åŒ–ä»£ç ã€‚</p></li><li><p><strong>åµŒå…¥å¼ç³»ç»Ÿ</strong>ï¼šåœ¨åµŒå…¥å¼ç³»ç»Ÿæˆ–è€…æœ‰é™èµ„æºçš„ç¯å¢ƒä¸­ï¼Œæ¯ä¸€æ¯«ç§’çš„å¯åŠ¨æ—¶é—´éƒ½å¾ˆå®è´µã€‚é€šè¿‡ä½¿ç”¨ <code>--build-snapshot-config</code> é€‰é¡¹å’Œç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼Œå¼€å‘è€…å¯ä»¥å‡å°‘ Node.js åº”ç”¨æ‰€éœ€çš„å¯åŠ¨æ—¶é—´ã€‚</p></li><li><p><strong>è‡ªå®šä¹‰ Node.js å‘è¡Œç‰ˆ</strong>ï¼šå¦‚æœä½ æ˜¯ä¸€ä¸ª Node.js çš„å‘è¡Œç‰ˆç»´æŠ¤è€…ï¼Œå¸Œæœ›æä¾›ä¸€ä¸ªé’ˆå¯¹ç‰¹å®šåœºæ™¯ä¼˜åŒ–è¿‡çš„ Node.js ç‰ˆæœ¬ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹æ¥åˆ›å»ºä¸€ä¸ªåŒ…å«äº†ç‰¹å®šä»£ç å’Œæ¨¡å—çš„å¿«ç…§ï¼Œä½¿å¾—æœ€ç»ˆç”¨æˆ·çš„åº”ç”¨èƒ½å¤Ÿæ›´å¿«åœ°å¯åŠ¨ã€‚</p></li></ol><p>æ„å»ºè¿‡ç¨‹é€šå¸¸å¦‚ä¸‹ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## å‡è®¾ä½ å·²ç»ä¸‹è½½äº† Node.js æºç ï¼Œå¹¶ä¸”å…·å¤‡äº†æ„å»º Node.js çš„ç¯å¢ƒ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## ç¼–è¾‘ä¸€ä¸ª JSON æ–‡ä»¶ï¼Œæ¯”å¦‚å«åš snapshot-config.json</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œä½ ä¼šåˆ—å‡ºæƒ³è¦åŒ…å«åœ¨å¿«ç…§ä¸­çš„ JavaScript ä»£ç æ–‡ä»¶</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## ä½¿ç”¨ --build-snapshot-config é€‰é¡¹è¿›è¡Œæ„å»º</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">./configure</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --build-snapshot-config=snapshot-config.json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j4</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # ä½¿ç”¨å¤šä¸ªæ ¸å¿ƒæ¥åŠ é€Ÿæ„å»ºè¿‡ç¨‹</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ³¨æ„ï¼Œç”±äºè¿™æ¶‰åŠåˆ° Node.js çš„ç¼–è¯‘å’Œæ„å»ºè¿‡ç¨‹ï¼Œå®ƒé€šå¸¸éœ€è¦ç›¸å½“æ·±çš„ç³»ç»Ÿå’Œç¼–è¯‘çŸ¥è¯†ã€‚å¯¹äºå¤§å¤šæ•°æ—¥å¸¸ Node.js å¼€å‘å·¥ä½œå¹¶ä¸éœ€è¦ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚ç®€å•æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºä¼˜åŒ– Node.js å¯åŠ¨æ—¶é—´çš„é«˜çº§åŠŸèƒ½ï¼Œé€šè¿‡é¢„å…ˆåŠ è½½å’Œæ‰§è¡Œä»£ç æ¥ç”Ÿæˆå¿«ç…§ï¼Œä»è€Œåœ¨å®é™…è¿è¡Œæ—¶å‡å°‘åˆå§‹åŒ–æ‰€éœ€çš„æ—¶é—´ã€‚</p><h3 id="c-check" tabindex="-1"><a class="header-anchor" href="#c-check"><span><a href="https://nodejs.org/docs/latest/api/cli.html#-c---check" target="_blank" rel="noopener noreferrer">-c, --check</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå‘½ä»¤è¡Œå‚æ•° <code>-c</code> æˆ– <code>--check</code> ç”¨äºæ£€æŸ¥è„šæœ¬çš„è¯­æ³•æ­£ç¡®æ€§ï¼Œä½†å¹¶ä¸æ‰§è¡Œè¯¥è„šæœ¬ã€‚è¿™ä¸ªåŠŸèƒ½å¯¹äºå¼€å‘è€…æ¥è¯´å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©å¿«é€ŸéªŒè¯ä»£ç ä¸­æ˜¯å¦å­˜åœ¨è¯­æ³•é”™è¯¯è€Œæ— éœ€å®é™…è¿è¡Œç¨‹åºã€‚</p><p>æ¯”æ–¹è¯´ä½ å†™äº†ä¸€æ®µ JavaScript ä»£ç ï¼Œå­˜å‚¨åœ¨ä¸€ä¸ªåä¸º <code>example.js</code> çš„æ–‡ä»¶ä¸­ï¼Œè€Œä½ æƒ³ç¡®ä¿è¿™æ®µä»£ç åœ¨è¯­æ³•ä¸Šæ˜¯æ­£ç¡®çš„ã€‚åœ¨ä¸æ‰§è¡Œä»£ç çš„å‰æä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ Node.js çš„ <code>-c</code> æˆ– <code>--check</code> å‚æ•°æ¥å®Œæˆè¿™é¡¹æ£€æŸ¥ã€‚</p><p>ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ <code>-c</code> æˆ– <code>--check</code> å‚æ•°çš„å…·ä½“æ­¥éª¤å’Œä¾‹å­ï¼š</p><ol><li>æ‰“å¼€å‘½ä»¤è¡Œæˆ–ç»ˆç«¯ã€‚</li><li>åˆ‡æ¢è‡³å­˜æœ‰ <code>example.js</code> æ–‡ä»¶çš„ç›®å½•ã€‚</li><li>æ‰§è¡Œå‘½ä»¤ï¼š<code>node -c example.js</code> æˆ– <code>node --check example.js</code>ã€‚</li></ol><p>å¦‚æœä½ çš„ <code>example.js</code> æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sayHello</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œ <code>node -c example.js</code> åï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œè¿™æ„å‘³ç€ä½ çš„ä»£ç åœ¨è¯­æ³•ä¸Šæ˜¯æ­£ç¡®çš„ï¼Œæ²¡æœ‰å‘ç°ä»»ä½•é”™è¯¯ã€‚</p><p>å‡è®¾æˆ‘ä»¬æ•…æ„åœ¨ä»£ç é‡Œåˆ¶é€ ä¸€ä¸ªé”™è¯¯ï¼Œå°† <code>example.js</code> æ–‡ä»¶ä¿®æ”¹ä¸ºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sayHello</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;Hello, world!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ³¨æ„è¿™é‡Œç¼ºå°‘ä¸€ä¸ªé—­åˆæ‹¬å· )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†æ¬¡æ‰§è¡Œ <code>node -c example.js</code> å‘½ä»¤ï¼ŒNode.js å°†ä¼šè¾“å‡ºä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼ŒæŒ‡å‡ºä½ çš„ä»£ç åœ¨å“ªé‡Œå‡ºç°äº†è¯­æ³•é—®é¢˜ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>/example.js:2</span></span>
<span class="line"><span>    console.log(&#39;Hello, world!&#39;;</span></span>
<span class="line"><span>                                ^</span></span>
<span class="line"><span></span></span>
<span class="line"><span>SyntaxError: missing ) after argument list</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ¡ä¿¡æ¯å‘Šè¯‰æˆ‘ä»¬åœ¨ç¬¬äºŒè¡Œä»£ç  <code>console.log</code> è¯­å¥åé¢ç¼ºå°‘äº†ä¸€ä¸ªé—­åˆæ‹¬å·ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½¿ç”¨ <code>-c</code> æˆ– <code>--check</code> å‚æ•°å¯ä»¥å¸®åŠ©å¼€å‘è€…åœ¨ä¸è¿è¡Œä»£ç çš„æƒ…å†µä¸‹å¿«é€Ÿåœ°æ£€æµ‹å‡ºæ½œåœ¨çš„è¯­æ³•é”™è¯¯ï¼Œä»è€Œæé«˜å¼€å‘æ•ˆç‡ã€‚</p><h3 id="completion-bash" tabindex="-1"><a class="header-anchor" href="#completion-bash"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--completion-bash" target="_blank" rel="noopener noreferrer">--completion-bash</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘ä¼šç›´æ¥å›ç­”ä½ çš„é—®é¢˜ã€‚</p><p>Node.js ä¸­çš„<code>--completion-bash</code>é€‰é¡¹æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆè‡ªåŠ¨è¡¥å…¨è„šæœ¬çš„åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€å½“ä½ åœ¨ä½¿ç”¨ bashï¼ˆä¸€ä¸ªå¸¸è§çš„å‘½ä»¤è¡Œç•Œé¢ï¼‰æ—¶ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ è‡ªåŠ¨è¡¥å…¨ Node.js å‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰çš„å‘½ä»¤å’Œå‚æ•°ã€‚</p><p>å¼€å¯ Bash è‡ªåŠ¨è¡¥å…¨çš„æ­¥éª¤é€šå¸¸åŒ…æ‹¬ï¼š</p><ol><li>ç”Ÿæˆè‡ªåŠ¨è¡¥å…¨è„šæœ¬ã€‚</li><li>å°†ç”Ÿæˆçš„è„šæœ¬ç½®å…¥åˆé€‚çš„ä½ç½®ï¼Œä½¿å…¶è¢« bash ä¼šè¯è¯»å–å’Œæ‰§è¡Œã€‚</li></ol><p>å…·ä½“åˆ° Node.js v21.7.1 ç‰ˆæœ¬ï¼Œä½¿ç”¨<code>--completion-bash</code>çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>æ‰“å¼€ç»ˆç«¯ã€‚</li><li>è¿è¡Œå‘½ä»¤<code>node --completion-bash</code>ã€‚è¿™å°†æ‰“å°å‡ºä¸€æ®µ shell è„šæœ¬ã€‚</li><li>æ¥ä¸‹æ¥ï¼Œä½ éœ€è¦å°†è¿™æ®µè„šæœ¬åŠ å…¥åˆ°ä½ çš„ bash é…ç½®æ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚<code>.bashrc</code>æˆ–<code>.bash_profile</code>ã€‚</li></ol><p>è¿™é‡Œæ˜¯ä¸€ä¸ªå®ç°è¿™ä¸ªåŠŸèƒ½çš„ç¤ºä¾‹æ­¥éª¤ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --completion-bash</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~/.bashrc</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # å°†è‡ªåŠ¨è¡¥å…¨è„šæœ¬è¿½åŠ åˆ°.bashrcæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~/.bashrc</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                       # è®©ä¿®æ”¹åçš„.bashrcæ–‡ä»¶ç«‹å³ç”Ÿæ•ˆ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®Œæˆä»¥ä¸Šæ“ä½œåï¼Œä½ å°±å¯ä»¥åœ¨ä½¿ç”¨ Node.js å‘½ä»¤æ—¶äº«å—è‡ªåŠ¨è¡¥å…¨çš„ä¾¿åˆ©äº†ã€‚æ¯”å¦‚è¯´ï¼Œå½“ä½ å¼€å§‹é”®å…¥<code>node --</code>å¹¶æŒ‰ Tab é”®æ—¶ï¼Œbash å°†ä¼šæ˜¾ç¤ºæ‰€æœ‰ä»¥<code>--</code>å¼€å¤´çš„å¯ç”¨ Node.js å‘½ä»¤è¡Œé€‰é¡¹ã€‚</p><p>è®©æˆ‘ä»¬ä¸¾ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼š</p><p>å‡è®¾ä½ æƒ³ç›‘æ§ä¸€ä¸ªæ–‡ä»¶çš„å˜åŒ–ï¼Œå¹¶åœ¨æ–‡ä»¶æ¯æ¬¡æ”¹åŠ¨æ—¶ä½¿ç”¨ Node.js è¿è¡Œå®ƒã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½è¦è¾“å…¥å®Œæ•´çš„å‘½ä»¤<code>node --inspect-brk your_script.js</code>æ¥å¯åŠ¨å¸¦æœ‰è°ƒè¯•æ–­ç‚¹çš„ Node.js è¿›ç¨‹ã€‚</p><p>ä½†å¦‚æœä½ å·²ç»è®¾ç½®äº† bash è‡ªåŠ¨è¡¥å…¨ï¼Œä½ åªéœ€è¾“å…¥ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --ins[æŒ‰Tabé”®]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>bash å°†ä¼šè‡ªåŠ¨å±•ç¤ºæ‰€æœ‰ä»¥<code>--ins</code>å¼€å¤´çš„å‘½ä»¤ï¼Œæˆ–è€…å¦‚æœåªæœ‰ä¸€ä¸ªåŒ¹é…é¡¹ï¼Œå®ƒä¼šè‡ªåŠ¨å¡«å……ä¸º<code>--inspect-brk</code>ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>--completion-bash</code>æ˜¯ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ä½ æ›´å¿«åœ°ç¼–å†™å‘½ä»¤ï¼Œå‡å°‘æ‹¼å†™é”™è¯¯ï¼Œå¹¶æé«˜ä½ åœ¨ä½¿ç”¨ Node.js å‘½ä»¤è¡Œæ—¶çš„æ•ˆç‡ã€‚</p><h3 id="c-condition-conditions-condition" tabindex="-1"><a class="header-anchor" href="#c-condition-conditions-condition"><span><a href="https://nodejs.org/docs/latest/api/cli.html#-c-condition---conditionscondition" target="_blank" rel="noopener noreferrer">-C condition, --conditions=condition</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘ä¼šç›´æ¥è¿›å…¥ä¸»é¢˜ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>-C condition</code> æˆ– <code>--conditions=condition</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼ˆCLIï¼‰ï¼Œå®ƒå…è®¸ä½ æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªæ¡ä»¶ï¼Œè¿™äº›æ¡ä»¶ç”¨äºå¯¼å…¥æ¡ä»¶æ€§çš„ exportsã€‚æ‰€è°“æ¡ä»¶æ€§çš„ exportsï¼ŒæŒ‡çš„æ˜¯<code>package.json</code>æ–‡ä»¶ä¸­å¯ä»¥æ ¹æ®ä¸åŒçš„ç¯å¢ƒæˆ–æ¨¡å¼æä¾›ä¸åŒç‰ˆæœ¬çš„æ¨¡å—ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ª Node.js é¡¹ç›®çš„<code>package.json</code>æ–‡ä»¶ä¸­ï¼Œå¯èƒ½ä¼šæœ‰åƒè¿™æ ·çš„éƒ¨åˆ†ï¼š</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;exports&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;import&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./main-module.mjs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;require&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./main-module.cjs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;production&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./main-module.prod.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œ<code>.</code>è¡¨ç¤ºæ¨¡å—çš„é»˜è®¤å¯¼å‡ºè·¯å¾„ï¼Œå½“å…¶ä»–æ–‡ä»¶å°è¯•å¯¼å…¥è¿™ä¸ªæ¨¡å—æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹å°†ä¼šä½¿ç”¨<code>&quot;import&quot;</code>å’Œ<code>&quot;require&quot;</code>æŒ‡å®šçš„æ–‡ä»¶ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æƒ³è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ä¸€ä¸ªç‰¹åˆ«ä¸ºç”Ÿäº§ç¯å¢ƒä¼˜åŒ–è¿‡çš„æ–‡ä»¶(<code>&quot;production&quot;: &quot;./main-module.prod.js&quot;</code>)ï¼Œä½ å°±å¯ä»¥é€šè¿‡ä½¿ç”¨<code>-C</code>æˆ–<code>--conditions</code>é€‰é¡¹æ¥å‘Šè¯‰ Node.js ä½ å¸Œæœ›å¯ç”¨<code>&quot;production&quot;</code>æ¡ä»¶ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä½ è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --conditions=production</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Node.js å°†ä¼šåŠ è½½<code>package.json</code>ä¸­å®šä¹‰çš„é’ˆå¯¹ç”Ÿäº§ç¯å¢ƒçš„æ¨¡å—ç‰ˆæœ¬ï¼Œå³<code>&quot;./main-module.prod.js&quot;</code>ã€‚</p><p>è¿™ç§æœºåˆ¶å…è®¸å¼€å‘è€…æ ¹æ®éœ€è¦é€‰æ‹©ä¸åŒç‰ˆæœ¬çš„ä»£ç ï¼Œä¾‹å¦‚ï¼šå¼€å‘ç‰ˆæœ¬ã€ç”Ÿäº§ç‰ˆæœ¬æˆ–è€…æ˜¯ç¬¦åˆç‰¹å®šå¹³å°ï¼ˆæ¯”å¦‚<code>deno</code>, <code>browser</code>, <code>node</code>ï¼‰çš„ç‰ˆæœ¬ç­‰ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹å¦å¤–ä¸€ä¸ªå®é™…çš„åº”ç”¨åœºæ™¯ï¼š</p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªé¡¹ç›®ï¼Œå…¶ä¸­åŒ…å«äº†ä¸ºæµè§ˆå™¨ç«¯å’Œ Node.js ç«¯å‡†å¤‡çš„ä¸åŒç‰ˆæœ¬çš„ä»£ç ã€‚ä½ çš„<code>package.json</code>å¯èƒ½ä¼šæœ‰è¿™æ ·çš„è®¾ç½®ï¼š</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;exports&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;./feature&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;browser&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./src/feature-browser.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;node&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./src/feature-node.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ å¸Œæœ›åœ¨ Node.js ç¯å¢ƒä¸­æ˜¾å¼åœ°åŠ è½½æµè§ˆå™¨ç‰ˆçš„ä»£ç ï¼Œå¯ä»¥åœ¨å¯åŠ¨ Node.js ç¨‹åºæ—¶åŠ ä¸Š<code>--conditions=browser</code>ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --conditions=browser</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿åœ¨ Node.js ç¯å¢ƒä¸­ï¼Œä¹Ÿä¼šå¯¼å…¥<code>&quot;./src/feature-browser.js&quot;</code>ä»£æ›¿é»˜è®¤çš„ Node.js ç‰ˆæœ¬<code>&quot;./src/feature-node.js&quot;</code>ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>-C</code>æˆ–<code>--conditions</code>é€‰é¡¹ä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿé€šè¿‡å‘½ä»¤è¡Œå‚æ•°æ§åˆ¶ Node.js å¦‚ä½•æ ¹æ®ä¸åŒæ¡ä»¶åŠ è½½æ¨¡å—ï¼Œä»è€Œä½¿å¾—ä»£ç èƒ½å¤Ÿæ›´çµæ´»åœ°é€‚åº”ä¸åŒçš„è¿è¡Œæ—¶ç¯å¢ƒã€‚</p><h3 id="cpu-prof" tabindex="-1"><a class="header-anchor" href="#cpu-prof"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--cpu-prof" target="_blank" rel="noopener noreferrer">--cpu-prof</a></span></a></h3><p>Node.js ä¸­çš„ <code>--cpu-prof</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨æ¥å¼€å¯ CPU æ€§èƒ½åˆ†æã€‚åœ¨ä½ è¿è¡Œ Node.js åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œå¯ä»¥å¸®åŠ©ä½ äº†è§£ä½ çš„ç¨‹åºå“ªéƒ¨åˆ†ä»£ç å ç”¨äº†æ›´å¤šçš„ CPU èµ„æºã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥å®šä½åˆ°å¯èƒ½çš„æ€§èƒ½ç“¶é¢ˆï¼Œç„¶åå¯¹å®ƒä»¬è¿›è¡Œä¼˜åŒ–ã€‚</p><p>å½“ä½ åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ Node.js è¿è¡Œä½ çš„è„šæœ¬æ—¶ï¼Œåªéœ€è¦åœ¨ <code>node</code> å‘½ä»¤åé¢åŠ ä¸Š <code>--cpu-prof</code> é€‰é¡¹ã€‚ä¾‹å¦‚ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --cpu-prof</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œ<code>app.js</code> æ˜¯ä½ çš„ Node.js ç¨‹åºå…¥å£æ–‡ä»¶ã€‚</p><p>ä¸€æ—¦å¯ç”¨äº† CPU åˆ†æï¼Œå¹¶ä¸”ä½ çš„åº”ç”¨ç¨‹åºè¢«æ­£ç¡®è¿è¡Œå’Œé€€å‡ºåï¼ŒNode.js ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª <code>.cpuprofile</code> æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†æ€§èƒ½åˆ†ææ•°æ®ï¼Œä½ å¯ä»¥åˆ©ç”¨ Chrome æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·ä¸­çš„ â€œPerformanceâ€ æˆ–è€… â€œProfilerâ€ é¢æ¿æ¥æŸ¥çœ‹å’Œåˆ†æè¿™ä¸ªæ–‡ä»¶ã€‚</p><p>å®é™…æ“ä½œä¾‹å­å¦‚ä¸‹ï¼š</p><ol><li>å‡è®¾ä½ æœ‰ä¸€ä¸ªç®€å•çš„ Node.js è„šæœ¬ <code>app.js</code>ï¼Œé‡Œé¢æœ‰ä¸€äº›å¯èƒ½ä¼šæ¶ˆè€— CPU çš„è®¡ç®—ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// app.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> heavyComputation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `&lt;`</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1000000000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Math</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sqrt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Math</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Heavy computation started.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> heavyComputation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Result: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Finished heavy computation.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥è¿è¡Œè¿™ä¸ªè„šæœ¬ï¼Œå¹¶å¯ç”¨ CPU åˆ†æï¼š</li></ol><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --cpu-prof</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="3"><li><p>å½“è„šæœ¬æ‰§è¡Œå®Œæ¯•å¹¶é€€å‡ºåï¼Œä½ ä¼šåœ¨å½“å‰ç›®å½•ä¸‹æ‰¾åˆ°ä¸€ä¸ªåä¸º <code>CPU.${timestamp}.cpuprofile</code> çš„æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶åä¼šåŒ…å«æ—¶é—´æˆ³ï¼Œä»¥ä¾¿äºä½ æ ¹æ®ç”Ÿæˆæ—¶é—´åŒºåˆ†ä¸åŒçš„åˆ†ææ–‡ä»¶ã€‚</p></li><li><p>æ¥ä¸‹æ¥ï¼Œä½ å¯ä»¥æ‰“å¼€ Chrome æµè§ˆå™¨ï¼Œè¿›å…¥ <code>chrome://inspect</code> é¡µé¢ï¼Œç‚¹å‡» &quot;Open dedicated DevTools for Node&quot;ï¼Œåœ¨å¼¹å‡ºçš„ DevTools çª—å£ä¸­åˆ‡æ¢åˆ° &quot;Profiler&quot; æ ‡ç­¾é¡µï¼Œç„¶åç‚¹å‡» &quot;Load&quot; æŒ‰é’®åŠ è½½åˆšåˆšç”Ÿæˆçš„ <code>.cpuprofile</code> æ–‡ä»¶è¿›è¡Œåˆ†æã€‚</p></li><li><p>åœ¨ Profiler é¢æ¿ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°å‡½æ•°è°ƒç”¨çš„æ—¶é—´æ¶ˆè€—ï¼Œå“ªäº›å‡½æ•°æ‰§è¡Œæ—¶é—´æœ€é•¿ï¼Œä»è€Œå¯¹ç…§ç€ä½ çš„ä»£ç è¿›è¡Œä¼˜åŒ–ã€‚</p></li></ol><p>æ€»ç»“æ¥è¯´ï¼Œ<code>--cpu-prof</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œè®©ä½ å¯ä»¥æ›´æ·±å…¥åœ°ç†è§£å’Œä¼˜åŒ–ä½ çš„ Node.js åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚é€šè¿‡å®é™…çš„ CPU ä½¿ç”¨æ•°æ®ï¼Œä½ å¯ä»¥åšå‡ºä¿¡æ¯å……åˆ†çš„å†³ç­–æ¥æé«˜ç¨‹åºæ•ˆç‡ã€‚</p><h3 id="cpu-prof-dir" tabindex="-1"><a class="header-anchor" href="#cpu-prof-dir"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--cpu-prof-dir" target="_blank" rel="noopener noreferrer">--cpu-prof-dir</a></span></a></h3><p>Node.js ä¸­ <code>--cpu-prof-dir</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒç”¨æ¥æŒ‡å®šåœ¨ä½ è¿è¡Œ Node.js åº”ç”¨æ—¶ç”Ÿæˆ CPU profile æ–‡ä»¶çš„å­˜å‚¨ç›®å½•ã€‚CPU profiling æ˜¯ä¸€ç§æ€§èƒ½è°ƒä¼˜çš„æŠ€æœ¯ï¼Œå¯ä»¥å¸®åŠ©ä½ åˆ†æç¨‹åºè¿è¡ŒæœŸé—´èŠ±è´¹æ—¶é—´åœ¨å„ä¸ªå‡½æ•°ä¸Šçš„è¯¦ç»†æ•°æ®ï¼Œä»è€Œç†è§£ç¨‹åºçš„æ€§èƒ½ç“¶é¢ˆåœ¨å“ªé‡Œã€‚</p><p>é€šå¸¸ï¼Œå½“ä½ æƒ³è¦æå‡ä½ çš„åº”ç”¨æ€§èƒ½æˆ–è€…è°ƒè¯•æ€§èƒ½é—®é¢˜æ—¶ï¼Œä½ å¯èƒ½ä¼šéœ€è¦å¯¹ä½ çš„ç¨‹åºè¿›è¡Œæ€§èƒ½åˆ†æï¼Œè¿™æ—¶å€™ CPU profiling å°±æ˜¾å¾—éå¸¸æœ‰ç”¨äº†ã€‚</p><p>è®©æˆ‘é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¯¦ç»†è¯´æ˜å¦‚ä½•ä½¿ç”¨ <code>--cpu-prof-dir</code> é€‰é¡¹ï¼š</p><ol><li>å‡è®¾ä½ å†™äº†ä¸€ä¸ªç®€å•çš„ Node.js åº”ç”¨ <code>app.js</code>ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> doHeavyComputation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sum</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `&lt;`</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1e7</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    sum</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sum</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è®¡ç®—å¼€å§‹&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> doHeavyComputation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç»“æœ:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è®¡ç®—ç»“æŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¨‹åºä¸­ï¼Œå‡½æ•° <code>doHeavyComputation</code> æ‰§è¡Œäº†ä¸€ä¸ªè€—æ—¶çš„è®¡ç®—ä»»åŠ¡ã€‚</p><ol start="2"><li><p>ä½ ç°åœ¨æƒ³å¯¹è¿™æ®µä»£ç è¿›è¡Œæ€§èƒ½åˆ†æï¼Œä»¥æŸ¥æ˜ <code>doHeavyComputation</code> å‡½æ•°æ˜¯å¦æ˜¯æ€§èƒ½ç“¶é¢ˆã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>--cpu-prof</code> é€‰é¡¹å¼€å¯ CPU profilingï¼Œå¹¶ä¸”ä½¿ç”¨ <code>--cpu-prof-dir</code> æ¥æŒ‡å®šç”Ÿæˆçš„ CPU profile æ–‡ä»¶å­˜æ”¾åœ¨å“ªä¸ªç›®å½•ã€‚</p></li><li><p>æ‰“å¼€ç»ˆç«¯ï¼ˆå‘½ä»¤è¡Œï¼‰ï¼Œåˆ‡æ¢åˆ°ä½ çš„åº”ç”¨ <code>app.js</code> æ‰€åœ¨çš„ç›®å½•ã€‚ç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p></li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --cpu-prof</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --cpu-prof-dir=./profiles</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤è¡¨ç¤º Node.js è¿è¡Œ <code>app.js</code> çš„åŒæ—¶ï¼Œå¼€å¯ CPU profiling åŠŸèƒ½ï¼Œå¹¶å°† profile æ–‡ä»¶ä¿å­˜åœ¨å½“å‰ç›®å½•ä¸‹çš„ <code>profiles</code> æ–‡ä»¶å¤¹å†…ã€‚</p><ol start="4"><li><p>å½“ä½ çš„ç¨‹åºè¿è¡Œå®Œæ¯•ä¹‹åï¼Œä½ å¯ä»¥åœ¨ <code>./profiles</code> ç›®å½•ä¸‹æ‰¾åˆ°ä¸€ä¸ª <code>.cpuprofile</code> æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å°±åŒ…å«äº†ä½ çš„ç¨‹åºè¿è¡ŒæœŸé—´çš„æ€§èƒ½æ•°æ®ã€‚</p></li><li><p>æ¥ä¸‹æ¥ï¼Œä½ å¯ä»¥ä½¿ç”¨ Chrome å¼€å‘è€…å·¥å…·ä¸­çš„ &quot;Performance&quot; æˆ– &quot;JavaScript Profiler&quot; é¢æ¿åŠ è½½è¿™ä¸ª <code>.cpuprofile</code> æ–‡ä»¶ï¼Œæ¥å¯è§†åŒ–åœ°åˆ†æç¨‹åºçš„æ€§èƒ½ã€‚</p></li></ol><p>åœ¨ä½ åŠ è½½æ–‡ä»¶ä¹‹åï¼ŒChrome å¼€å‘è€…å·¥å…·ä¼šæ˜¾ç¤ºä¸€ä¸ªç«ç„°å›¾ï¼ˆFlame Chartï¼‰ï¼Œå±•ç¤ºä¸åŒå‡½æ•°æ‰§è¡Œæ‰€å ç”¨çš„æ—¶é—´æ¯”ä¾‹ã€‚é€šè¿‡è¿™å¼ å›¾ï¼Œä½ å¯ä»¥å¾ˆç›´è§‚åœ°çœ‹å‡ºç¨‹åºçš„æ—¶é—´éƒ½èŠ±åœ¨å“ªäº›å‡½æ•°ä¸Šäº†ï¼Œå“ªäº›å‡½æ•°æ˜¯æ€§èƒ½ç“¶é¢ˆã€‚è¿™æ ·ï¼Œä½ å°±èƒ½æœ‰é’ˆå¯¹æ€§åœ°ä¼˜åŒ–é‚£äº›è€—æ—¶çš„éƒ¨åˆ†ï¼Œæå‡æ•´ä¸ªåº”ç”¨çš„æ€§èƒ½ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>--cpu-prof-dir</code> æ˜¯ä¸€ä¸ªç”¨äºè¯Šæ–­å’Œä¼˜åŒ– Node.js ç¨‹åºæ€§èƒ½çš„å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ç¨‹åºè¿è¡Œæ—¶çš„æ€§èƒ½ç‰¹æ€§ã€‚</p><h3 id="cpu-prof-interval" tabindex="-1"><a class="header-anchor" href="#cpu-prof-interval"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--cpu-prof-interval" target="_blank" rel="noopener noreferrer">--cpu-prof-interval</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬è¯¦ç»†äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ <code>--cpu-prof-interval</code> é€‰é¡¹ã€‚</p><p>é¦–å…ˆéœ€è¦æ˜ç™½ï¼ŒNode.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚å½“æˆ‘ä»¬è°ˆè®ºæ€§èƒ½åˆ†æï¼ˆProfilingï¼‰æ—¶ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯ç›‘æµ‹ç¨‹åºåœ¨è¿è¡Œæ—¶çš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯æ£€æŸ¥å“ªéƒ¨åˆ†ä»£ç æ¶ˆè€—äº†å¤§é‡çš„å¤„ç†å™¨æ—¶é—´ï¼ˆCPUï¼‰ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>--cpu-prof</code> æ˜¯å¯åŠ¨ CPU æ€§èƒ½åˆ†æçš„å‘½ä»¤è¡Œé€‰é¡¹ã€‚ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œå¯ä»¥ç”Ÿæˆä¸€ä¸ª CPU ä½¿ç”¨æƒ…å†µçš„æŠ¥å‘Šï¼Œè¯¥æŠ¥å‘Šå¯ä»¥å¸®åŠ©å¼€å‘è€…æ‰¾å‡ºç¨‹åºä¸­çš„çƒ­ç‚¹ï¼Œå³é‚£äº›æ‰§è¡Œæœ€é¢‘ç¹æˆ–æœ€è€—æ—¶çš„ä»£ç éƒ¨åˆ†ã€‚</p><p>è€Œ <code>--cpu-prof-interval</code> é€‰é¡¹åˆ™ç”¨æ¥è®¾ç½®æ€§èƒ½åˆ†æè¿‡ç¨‹ä¸­é‡‡æ ·çš„é—´éš”ã€‚CPU åˆ†æå™¨ä¼šå®šæœŸè®°å½•ç¨‹åºçš„çŠ¶æ€ï¼Œ<code>--cpu-prof-interval</code> ç”¨äºå®šä¹‰è¿™äº›è®°å½•ä¹‹é—´çš„å¾®ç§’æ•°ã€‚é»˜è®¤å€¼é€šå¸¸ä¸º 1000 å¾®ç§’ï¼ˆ1 æ¯«ç§’ï¼‰ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœä½ æœ‰ä¸€ä¸ª Node.js åº”ç”¨ï¼Œå¹¶ä¸”æƒ³è¦è¿›è¡Œæ€§èƒ½åˆ†ææ¥æŸ¥çœ‹å“ªäº›å‡½æ•°å ç”¨äº†å¤§é‡ CPU æ—¶é—´ã€‚ä½ ä¼šè¿™æ ·åšï¼š</p><ol><li><p>åœ¨ç»ˆç«¯ä¸­è¿è¡Œä½ çš„ Node.js åº”ç”¨ï¼Œå¹¶åŠ ä¸Š <code>--cpu-prof</code> å’Œ <code>--cpu-prof-interval</code> é€‰é¡¹ã€‚</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --cpu-prof</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --cpu-prof-interval=10000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤ä¼šå¯åŠ¨ä½ çš„ <code>app.js</code> åº”ç”¨ï¼Œå¹¶å¼€å¯ CPU æ€§èƒ½åˆ†æï¼Œè®¾ç½®é‡‡æ ·é—´éš”ä¸º 10000 å¾®ç§’ï¼ˆ10 æ¯«ç§’ï¼‰ã€‚è¿™æ„å‘³ç€æ¯éš” 10 æ¯«ç§’ï¼Œæ€§èƒ½åˆ†æå™¨å°†è®°å½•ä¸‹å½“å‰çš„è°ƒç”¨å †æ ˆä¿¡æ¯ã€‚</p></li><li><p>å½“åº”ç”¨è¿è¡Œå®Œæ¯•åï¼Œä¼šç”Ÿæˆä¸€ä¸ªåä¸º <code>CPU.</code>&lt;<code>pid&gt;.cpuprofile</code> çš„æ–‡ä»¶ï¼Œå…¶ä¸­ <code>&lt;`pid`&gt;</code> æ˜¯è¿›ç¨‹ IDã€‚è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†æ€§èƒ½æ•°æ®ã€‚</p></li><li><p>ä½ å¯ä»¥ä½¿ç”¨ Chrome æµè§ˆå™¨çš„ DevTools æˆ–å…¶ä»–æ”¯æŒ <code>.cpuprofile</code> æ ¼å¼çš„å·¥å…·æ¥æŸ¥çœ‹å’Œåˆ†æè¿™ä¸ªæ–‡ä»¶ã€‚é‡Œé¢ä¼šå±•ç¤ºå“ªäº›å‡½æ•°è¢«è°ƒç”¨ä»¥åŠå„è‡ªå ç”¨äº†å¤šå°‘ CPU æ—¶é—´ã€‚</p></li></ol><p>è°ƒæ•´ <code>--cpu-prof-interval</code> å€¼çš„å½±å“ï¼š</p><ul><li>å¦‚æœä½ å°†é—´éš”è®¾ç½®å¾—å¤ªé•¿ï¼Œå¯èƒ½ä¼šé—æ¼ä¸€äº›é‡è¦çš„æ€§èƒ½æ•°æ®ï¼Œå› ä¸ºè¾ƒå°‘çš„é‡‡æ ·å¯èƒ½æ— æ³•æ•æ‰åˆ°æ‰€æœ‰å…³é”®çš„æ€§èƒ½ä¿¡æ¯ã€‚</li><li>åä¹‹ï¼Œå¦‚æœè®¾ç½®å¾—å¤ªçŸ­ï¼Œåˆ™å¯èƒ½ä¼šäº§ç”Ÿå¤§é‡çš„æ€§èƒ½æ•°æ®ï¼Œè¿™ä¸ä»…ä¼šå¢åŠ åˆ†ææ–‡ä»¶çš„å¤§å°ï¼Œä¹Ÿå¯èƒ½å¯¹ç¨‹åºçš„æ€§èƒ½é€ æˆå½±å“ï¼Œå› ä¸ºåˆ†ææœ¬èº«å°±éœ€è¦æ¶ˆè€—ä¸€å®šçš„ç³»ç»Ÿèµ„æºã€‚</li></ul><p>ç†è§£å’Œä½¿ç”¨ <code>--cpu-prof-interval</code> é€‰é¡¹ï¼Œå¯ä»¥å¸®ä½ æ›´ç²¾ç¡®åœ°æ§åˆ¶æ€§èƒ½åˆ†æçš„ç²’åº¦ï¼Œå¹¶ä¼˜åŒ–æ€§èƒ½é—®é¢˜çš„è¯Šæ–­è¿‡ç¨‹ã€‚</p><h3 id="cpu-prof-name" tabindex="-1"><a class="header-anchor" href="#cpu-prof-name"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--cpu-prof-name" target="_blank" rel="noopener noreferrer">--cpu-prof-name</a></span></a></h3><p>å½“ä½ åœ¨ä½¿ç”¨ Node.js ç¨‹åºæ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°éœ€è¦æ£€æŸ¥ç¨‹åºæ€§èƒ½çš„æƒ…å†µï¼Œå°¤å…¶æ˜¯æ‰¾å‡ºå“ªäº›éƒ¨åˆ†çš„ä»£ç è¿è¡Œç¼“æ…¢æˆ–æ¶ˆè€—å¤§é‡ CPU èµ„æºã€‚Node.js æä¾›äº†ä¸€ç§åä¸º CPU æ€§èƒ½å‰–æï¼ˆprofilingï¼‰çš„å·¥å…·æ¥å¸®ä½ åˆ†æè¿™äº›é—®é¢˜ã€‚<code>--cpu-prof-name</code> æ˜¯ä¸€ä¸ªç”¨äºè‡ªå®šä¹‰ç”Ÿæˆçš„ CPU å‰–ææ–‡ä»¶åç§°çš„å‘½ä»¤è¡Œé€‰é¡¹ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä½ å¯ç”¨ CPU æ€§èƒ½å‰–ææ—¶ï¼ŒNode.js ä¼šè¾“å‡ºä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒé€šå¸¸ä»¥<code>.cpuprofile</code>ä¸ºæ‰©å±•åã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æ²¡æœ‰æŒ‡å®šæ–‡ä»¶åï¼Œé‚£ä¹ˆ Node.js ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåŒ…å«æ—¶é—´æˆ³çš„æ–‡ä»¶åï¼Œä½¿å…¶å”¯ä¸€ã€‚å¦‚æœä½ æƒ³è‡ªå·±è®¾å®šè¿™ä¸ªæ–‡ä»¶çš„åç§°ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>--cpu-prof-name</code>é€‰é¡¹ã€‚</p><p>è¿™é‡Œæœ‰å‡ ä¸ªä¾‹å­æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨<code>--cpu-prof-name</code>ï¼š</p><ol><li><p><strong>åŸºæœ¬ä¾‹å­</strong>ï¼š<br> å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ªå«åš<code>app.js</code>çš„ Node.js åº”ç”¨ï¼Œå¹¶å¸Œæœ› CPU å‰–ææ–‡ä»¶åä¸º<code>my-app-profile.cpuprofile</code>ï¼Œä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¿™æ ·è¿è¡Œä½ çš„åº”ç”¨ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --cpu-prof</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --cpu-prof-name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-app-profile.cpuprofile</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™å°†å¯åŠ¨ CPU å‰–æï¼Œå¹¶ä¸”å½“ä½ ç»“æŸç¨‹åºæ—¶ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªåä¸º<code>my-app-profile.cpuprofile</code>çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº† CPU ä½¿ç”¨æ•°æ®ã€‚</p></li><li><p><strong>å®šåˆ¶åŒ–ä¾‹å­</strong>ï¼š<br> å¦‚æœä½ æ­£åœ¨å¼€å‘å¤šä¸ªæœåŠ¡ï¼Œå¹¶å¸Œæœ›æ¯ä¸ªæœåŠ¡çš„ CPU å‰–ææ–‡ä»¶éƒ½æœ‰ç‰¹å®šçš„å‰ç¼€ï¼Œä¾‹å¦‚<code>service-A-profile</code>, <code>service-B-profile</code>ç­‰ï¼Œä½ å¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼æ‰§è¡Œï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --cpu-prof</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --cpu-prof-name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> service-A-profile.cpuprofile</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> service-A.js</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --cpu-prof</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --cpu-prof-name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> service-B-profile.cpuprofile</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> service-B.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯ä¸ªæœåŠ¡å°†ä¼šæ ¹æ®æŒ‡å®šçš„åç§°ç”Ÿæˆå„è‡ªçš„å‰–ææ–‡ä»¶ã€‚</p></li><li><p><strong>è„šæœ¬é›†æˆä¾‹å­</strong>ï¼š<br> æœ‰æ—¶å€™ä½ å¯èƒ½ä¼šæŠŠå¯åŠ¨æŒ‡ä»¤å†™åœ¨ä¸€ä¸ª npm è„šæœ¬é‡Œé¢ï¼Œå¦‚<code>package.json</code>ä¸­ï¼š</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;scripts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;profile&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node --cpu-prof --cpu-prof-name my-app-profile.cpuprofile app.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œä½ å¯ä»¥é€šè¿‡æ‰§è¡Œ<code>npm run profile</code>æ¥å¯åŠ¨åº”ç”¨å¹¶ç”Ÿæˆ CPU æ€§èƒ½å‰–ææ–‡ä»¶ã€‚</p></li></ol><p>ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œä½ å¯ä»¥æ›´æ–¹ä¾¿åœ°ç»„ç»‡å’Œè¯†åˆ«ä¸åŒçš„å‰–ææ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯åœ¨åšå¤šæ¬¡å‰–ææˆ–è€…å¯¹å¤šä¸ªåº”ç”¨è¿›è¡Œå‰–ææ—¶ã€‚å®Œæˆæ€§èƒ½å‰–æåï¼Œä½ å¯ä»¥ä½¿ç”¨ Chrome æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·ä¸­çš„ Profile åŠŸèƒ½æŸ¥çœ‹å’Œåˆ†æ.cpuprofile æ–‡ä»¶ã€‚è¿™å¯ä»¥å¸®åŠ©ä½ è¯†åˆ«ä»£ç ä¸­çš„ç“¶é¢ˆï¼Œå¹¶ä¼˜åŒ–ç¨‹åºçš„æ€§èƒ½ã€‚</p><h3 id="diagnostic-dir-directory" tabindex="-1"><a class="header-anchor" href="#diagnostic-dir-directory"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--diagnostic-dirdirectory" target="_blank" rel="noopener noreferrer">--diagnostic-dir=directory</a></span></a></h3><p>å½“æˆ‘ä»¬è¿è¡Œ Node.js ç¨‹åºæ—¶ï¼Œæœ‰æ—¶å€™ä¼šæƒ³è¦æ”¶é›†ä¸€äº›è¯Šæ–­ä¿¡æ¯ï¼Œæ¯”å¦‚é”™è¯¯æŠ¥å‘Šæˆ–è€…æ€§èƒ½åˆ†ææ•°æ®ã€‚è¿™äº›ä¿¡æ¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£ç¨‹åºæ˜¯æ€ä¹ˆè¿è¡Œçš„ï¼Œä»¥åŠå‡ºç°é—®é¢˜æ—¶å‘ç”Ÿäº†ä»€ä¹ˆã€‚<code>--diagnostic-dir</code>é€‰é¡¹å°±æ˜¯ç”¨æ¥æŒ‡å®šè¿™äº›è¯Šæ–­æ•°æ®å­˜æ”¾çš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚</p><p>åœ¨ Node.js ç‰ˆæœ¬ 21.7.1 ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°<code>--diagnostic-dir</code>æ¥è®¾ç½®ä¸€ä¸ªç›®å½•ï¼ŒNode.js ä¼šå°†æ‰€æœ‰çš„è¯Šæ–­è¾“å‡ºæ–‡ä»¶(åƒæ˜¯ HeapDumps, CPU Profiles, Report files ç­‰)éƒ½ä¿å­˜åˆ°ä½ æŒ‡å®šçš„é‚£ä¸ªç›®å½•é‡Œã€‚</p><h3 id="ä½¿ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ä¾‹å­"><span>ä½¿ç”¨ä¾‹å­ï¼š</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ª Node.js è„šæœ¬å«åš<code>app.js</code>, é€šå¸¸ä½ ä¼šè¿™æ ·è¿è¡Œå®ƒ:</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä½†æ˜¯å¦‚æœä½ æƒ³è¦æ”¶é›†è¯Šæ–­ä¿¡æ¯ï¼Œå¹¶ä¸”å°†è¿™äº›ä¿¡æ¯ä¿å­˜åˆ°ç‰¹å®šç›®å½•ä¸‹ï¼Œæ¯”å¦‚<code>/path/to/diagnostic-dir/</code>ï¼Œä½ å°±å¯ä»¥è¿™æ ·å¯åŠ¨ä½ çš„è„šæœ¬ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --diagnostic-dir=/path/to/diagnostic-dir/</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·åšä¹‹åï¼Œæ‰€æœ‰ç”Ÿæˆçš„è¯Šæ–­æ–‡ä»¶å°±ä¼šè‡ªåŠ¨ä¿å­˜åˆ°<code>/path/to/diagnostic-dir/</code>è¿™ä¸ªç›®å½•é‡Œé¢ã€‚</p><p>å†æ¯”å¦‚ä½ è¿è¡Œåº”ç”¨æ—¶å‘ç°äº†å†…å­˜æ³„æ¼ï¼Œä½ å¯èƒ½æƒ³è¦å¯¼å‡º heap dump æ¥åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µã€‚é€šå¸¸ï¼Œè¿™æ ·çš„è¯Šæ–­æ–‡ä»¶ä¼šè¢«æ”¾åœ¨å½“å‰å·¥ä½œç›®å½•æˆ–ç³»ç»Ÿçš„é»˜è®¤ä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸­ï¼Œä½†æ˜¯å¦‚æœä½ ä½¿ç”¨äº†<code>--diagnostic-dir</code>é€‰é¡¹ï¼Œé‚£ä¹ˆ heap dump å°†ä¼šè¢«ç›´æ¥ä¿å­˜åˆ°ä½ æŒ‡å®šçš„ç›®å½•é‡Œã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªåŠŸèƒ½ä¸»è¦æ˜¯ä¸ºäº†ä¾¿äºç®¡ç†å’Œç»„ç»‡è¯Šæ–­æ–‡ä»¶ã€‚ä½ éœ€è¦ç¡®ä¿æŒ‡å®šçš„ç›®å½•å­˜åœ¨å¹¶ä¸”åº”ç”¨æœ‰æƒé™å†™å…¥è¯¥ç›®å½•ã€‚å¦‚æœç›®å½•ä¸å­˜åœ¨æˆ–ä¸å¯å†™ï¼ŒNode.js å¯åŠ¨æ—¶ä¼šæŠ¥é”™ã€‚</p><p>è®°ä½ï¼Œè™½ç„¶æ”¶é›†è¿™äº›ä¿¡æ¯å¯¹äºè°ƒè¯•å’Œä¼˜åŒ–åº”ç”¨éå¸¸æœ‰ç”¨ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç”Ÿæˆè¿™äº›è¯Šæ–­ä¿¡æ¯å¯èƒ½ä¼šå½±å“æ€§èƒ½ï¼Œæ‰€ä»¥è¦è°¨æ…ä½¿ç”¨ã€‚</p><h3 id="disable-warning-code-or-type" tabindex="-1"><a class="header-anchor" href="#disable-warning-code-or-type"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--disable-warningcode-or-type" target="_blank" rel="noopener noreferrer">--disable-warning=code-or-type</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰æ—¶å€™ç³»ç»Ÿä¼šæŠ›å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯ï¼Œä»¥æé†’ä½ æ³¨æ„æ½œåœ¨çš„é—®é¢˜æˆ–è€…ä¸æ¨èçš„ä½¿ç”¨æ–¹å¼ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¸å¸Œæœ›çœ‹åˆ°ç‰¹å®šç±»å‹çš„è­¦å‘Šä¿¡æ¯ã€‚</p><p><code>--disable-warning=code-or-type</code> æ˜¯ Node.js å‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰çš„ä¸€ä¸ªé€‰é¡¹ï¼Œå®ƒå…è®¸ä½ å…³é—­æŒ‡å®šç±»å‹çš„è­¦å‘Šä¿¡æ¯ã€‚è¿™ä¸ªé€‰é¡¹åé¢éœ€è¦è·Ÿç€ä¸€ä¸ªå‚æ•°ï¼Œå³è­¦å‘Šçš„ä»£ç ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªç®€çŸ­çš„å­—ç¬¦ä¸²ï¼‰æˆ–è€…ç±»å‹ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ è¿è¡Œäº†ä¸€æ®µ Node.js ä»£ç ï¼Œå¹¶ä¸”é‡åˆ°äº†å¦‚ä¸‹çš„è­¦å‘Šï¼š</p><div class="language-plaintext line-numbers-mode" data-highlighter="shiki" data-ext="plaintext" data-title="plaintext" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>(node:12345) [DEP0013] DeprecationWarning: Calling an asynchronous function without a callback is deprecated.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œ<code>DEP0013</code> å°±æ˜¯ä¸€ä¸ªç‰¹å®šçš„è­¦å‘Šä»£ç ï¼Œè¡¨ç¤ºè°ƒç”¨å¼‚æ­¥å‡½æ•°æ²¡æœ‰æä¾›å›è°ƒå‡½æ•°å·²è¢«åºŸå¼ƒï¼ˆdeprecatedï¼‰ã€‚å¦‚æœä½ ç¡®å®šå¿½ç•¥æ­¤è­¦å‘Šä¸ä¼šå¯¹ä½ çš„åº”ç”¨é€ æˆé—®é¢˜ï¼Œå¹¶ä¸”ä¸æƒ³æ¯æ¬¡è¿è¡Œä»£ç æ—¶éƒ½çœ‹åˆ°å®ƒï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨ Node.js æ—¶åŠ ä¸Š <code>--disable-warning=DEP0013</code> é€‰é¡¹æ¥å…³é—­å®ƒã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›ä½¿ç”¨è¿™ä¸ª CLI é€‰é¡¹çš„å®é™…ä¾‹å­ï¼š</p><ol><li><p><strong>å…³é—­å•ä¸ªç‰¹å®šè­¦å‘Šï¼š</strong></p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --disable-warning=DEP0013</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™å°†å…³é—­ä»£ç  <code>DEP0013</code> çš„è­¦å‘Šã€‚</p></li><li><p><strong>å…³é—­å¤šä¸ªç‰¹å®šè­¦å‘Šï¼š</strong><br> å¦‚æœä½ æƒ³å…³é—­å¤šä¸ªè­¦å‘Šï¼Œä½ å¯ä»¥å¤šæ¬¡ä½¿ç”¨è¯¥é€‰é¡¹ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --disable-warning=DEP0013</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --disable-warning=DEP0005</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·å°±åŒæ—¶å…³é—­äº† <code>DEP0013</code> å’Œ <code>DEP0005</code> çš„è­¦å‘Šã€‚</p></li></ol><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæœ€å¥½çš„åšæ³•æ˜¯å°½é‡å…³æ³¨å¹¶è§£å†³è¿™äº›è­¦å‘Šï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸æŒ‡å‘æ½œåœ¨çš„é—®é¢˜ï¼Œæˆ–è€…æç¤ºä½ æŸäº› API å¯èƒ½åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­è¢«ç§»é™¤æˆ–æ›´æ”¹ã€‚åªæœ‰å½“ä½ æ˜ç¡®çŸ¥é“æŸä¸ªè­¦å‘Šå¯¹ä½ çš„åº”ç”¨ä¸ä¼šäº§ç”Ÿè´Ÿé¢å½±å“ï¼Œä¸”æš‚æ—¶ä¸éœ€è¦å¤„ç†è¯¥è­¦å‘Šæ—¶ï¼Œæ‰æ¨èä½¿ç”¨ <code>--disable-warning=code-or-type</code> æ¥å…³é—­å®ƒã€‚</p><h3 id="disable-proto-mode" tabindex="-1"><a class="header-anchor" href="#disable-proto-mode"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--disable-protomode" target="_blank" rel="noopener noreferrer">--disable-proto=mode</a></span></a></h3><p>åœ¨ JavaScript ä¸­ï¼Œå¯¹è±¡ç”±å±æ€§ç»„æˆï¼ŒåŒ…æ‹¬æ™®é€šçš„æ•°æ®å±æ€§å’Œä¸€äº›ç‰¹æ®Šçš„å±æ€§ï¼Œå¦‚ <code>__proto__</code>ã€‚<code>__proto__</code> æ˜¯ä¸€ä¸ªè®¿é—®å™¨å±æ€§ï¼ˆä¸€ä¸ªä¸åŒ…å«å®é™…å€¼ï¼Œè€Œæ˜¯å®šä¹‰äº†ä¸€ä¸ªè·å–å‡½æ•°ï¼ˆgetterï¼‰å’Œä¸€ä¸ªè®¾ç½®å‡½æ•°ï¼ˆsetterï¼‰çš„å±æ€§ï¼‰ï¼Œé€šè¿‡å®ƒå¯ä»¥è®¿é—®æˆ–è®¾ç½®ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ã€‚</p><p>åœ¨è¿‡å»ï¼Œ<code>__proto__</code> è¢«å¹¿æ³›ç”¨æ¥ç›´æ¥è®¿é—®æˆ–è®¾ç½®å¯¹è±¡çš„åŸå‹ï¼Œä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> animal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  eats</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> rabbit</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  jumps</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">rabbit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">__proto__</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> animal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½® rabbit å¯¹è±¡çš„åŸå‹ä¸º animal</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">rabbit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">eats</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// true, å› ä¸ºå±æ€§é€šè¿‡åŸå‹é“¾ä» animal ç»§æ‰¿è€Œæ¥</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶è€Œï¼Œç›´æ¥ä½¿ç”¨ <code>__proto__</code> å­˜åœ¨å®‰å…¨æ€§å’Œæ€§èƒ½ä¸Šçš„é—®é¢˜ã€‚å› æ­¤ï¼Œç°ä»£ JavaScript å¼•æ“æä¾›äº† <code>Object.create()</code>, <code>Object.getPrototypeOf()</code>, å’Œ <code>Object.setPrototypeOf()</code> è¿™äº›æ–¹æ³•æ¥æ›´å®‰å…¨é«˜æ•ˆåœ°æ“ä½œå¯¹è±¡çš„åŸå‹ã€‚</p><p>å°½ç®¡ <code>__proto__</code> ä»ç„¶åœ¨è®¸å¤šæµè§ˆå™¨ä¸­å¯ç”¨ï¼Œä½†å®ƒè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå†å²é—ç•™é—®é¢˜ï¼Œå¹¶ä¸”åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä¸æ¨èä½¿ç”¨ã€‚</p><p>Node.js v21.7.1 å¼•å…¥äº† <code>--disable-proto=mode</code> è¿™ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå…è®¸ä½ æ§åˆ¶ <code>__proto__</code> çš„å¯ç”¨æ€§ã€‚è¿™ä¸ªé€‰é¡¹æœ‰ä¸‰ç§æ¨¡å¼ï¼š</p><ol><li><code>delete</code>ï¼šå½»åº•åˆ é™¤æ‰€æœ‰å¯¹è±¡çš„ <code>__proto__</code> è®¿é—®å™¨ã€‚</li><li><code>throw</code>ï¼šå¯¹ä»»ä½•å°è¯•è®¿é—® <code>__proto__</code> å±æ€§çš„æ“ä½œæŠ›å‡ºé”™è¯¯ã€‚</li><li><code>default</code>ï¼šä¿æŒ <code>__proto__</code> çš„æ­£å¸¸åŠŸèƒ½ï¼Œè¿™æ˜¯é»˜è®¤è¡Œä¸ºã€‚</li></ol><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¿è¡Œä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºå¹¶å®Œå…¨ç¦ç”¨ <code>__proto__</code>ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --disable-proto=delete</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä½¿ç”¨ throw æ¨¡å¼ï¼Œå¦‚æœä½ çš„ä»£ç ä¸­æœ‰ä»»ä½•å°è¯•è®¿é—® <code>__proto__</code> çš„ä½ç½®ï¼Œç¨‹åºä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè¿™å¯ä»¥å¸®åŠ©ä½ è¯†åˆ«å’Œä¿®å¤ä¾èµ–äºä¸å®‰å…¨æˆ–å·²åºŸå¼ƒç‰¹æ€§çš„ä»£ç ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --disable-proto=throw</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä½¿ç”¨è¿™ä¸ªé€‰é¡¹å¯ä»¥å¸®åŠ©å¢å¼ºä½ çš„ Node.js åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ï¼Œç‰¹åˆ«æ˜¯å¦‚æœä½ çš„ä»£ç æ˜¯å…¬å…±çš„æˆ–å¤„ç†ä¸ä¿¡ä»»çš„è¾“å…¥æ—¶ã€‚é€šè¿‡é¿å…ä½¿ç”¨ <code>__proto__</code>ï¼Œä½ å¯ä»¥å‡å°‘æŸäº›ç±»å‹çš„åŸå‹æ±¡æŸ“æ”»å‡»ï¼ˆprototype pollution attacksï¼‰çš„é£é™©ï¼Œè¿™æ˜¯ä¸€ç§æ”»å‡»è€…å¯èƒ½ä¼šå°è¯•åˆ©ç”¨åŸå‹é“¾çš„å¼±ç‚¹æ¥ç ´ååº”ç”¨ç¨‹åºçš„æ–¹å¼ã€‚</p><h3 id="disallow-code-generation-from-strings" tabindex="-1"><a class="header-anchor" href="#disallow-code-generation-from-strings"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--disallow-code-generation-from-strings" target="_blank" rel="noopener noreferrer">--disallow-code-generation-from-strings</a></span></a></h3><p>Node.js ä¸­çš„<code>--disallow-code-generation-from-strings</code>é€‰é¡¹æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼Œå®ƒç”¨äºæé«˜åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚å½“å¯ç”¨è¿™ä¸ªå‚æ•°æ—¶ï¼Œå®ƒå°†é˜»æ­¢åº”ç”¨ç¨‹åºä½¿ç”¨æŸäº›ä¼šä»å­—ç¬¦ä¸²ä¸­ç”Ÿæˆä»£ç å¹¶æ‰§è¡Œçš„ JavaScript å‡½æ•°ï¼Œæ¯”å¦‚<code>eval()</code>å’Œ<code>new Function()</code>ã€‚</p><p>ä¸ºä»€ä¹ˆè¦ç¦ç”¨è¿™äº›åŠŸèƒ½å‘¢ï¼Ÿå› ä¸ºå¦‚æœæ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶é‚£äº›ä¼ é€’ç»™<code>eval()</code>æˆ–<code>new Function()</code>çš„å­—ç¬¦ä¸²ï¼Œä»–ä»¬å°±å¯èƒ½æ‰§è¡Œæ¶æ„ä»£ç ï¼Œè¿™ç§æ”»å‡»é€šå¸¸è¢«ç§°ä¸ºä»£ç æ³¨å…¥æ”»å‡»ã€‚é€šè¿‡ç¦æ­¢ä»å­—ç¬¦ä¸²ä¸­ç”Ÿæˆä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å‡å°‘è¿™ç§å®‰å…¨é£é™©ã€‚</p><p>è®©æˆ‘ç»™ä½ ä¸¾ä¸ªä¾‹å­ï¼š</p><p>ä¸å®‰å…¨çš„ä»£ç ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> userInput</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;console.log(&#39;Hello, world!&#39;);&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™æ˜¯ç”¨æˆ·è¾“å…¥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">eval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">userInput</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™ä¼šæ‰§è¡Œç”¨æˆ·è¾“å…¥çš„ä»£ç </span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œå¦‚æœç”¨æˆ·è¾“å…¥çš„å†…å®¹æ˜¯æˆ‘ä»¬ä¿¡ä»»çš„ï¼Œåˆ™ä»£ç çœ‹èµ·æ¥æ²¡æœ‰é—®é¢˜ã€‚ä½†å¦‚æœç”¨æˆ·è¾“å…¥äº†æ¶æ„ä»£ç ï¼Œæ¯”å¦‚ <code>&quot;process.exit();&quot;</code>ï¼Œé‚£ä¹ˆ<code>eval()</code>ä¼šæ‰§è¡Œè¿™æ®µä»£ç ï¼Œå¯¼è‡´ç¨‹åºé€€å‡ºã€‚è¿™å°±æ˜¯æ½œåœ¨çš„å®‰å…¨éšæ‚£ã€‚</p><p>å®‰å…¨çš„ä»£ç ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯åŠ¨ Node.js åº”ç”¨æ—¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¡Œå‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">node</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> --</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">disallow</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">generation</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">from</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">strings</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> app</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> userInput</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;console.log(&#39;Hello, world!&#39;);&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¸‹é¢çš„è°ƒç”¨å°†æŠ›å‡ºé”™è¯¯ï¼Œå› ä¸ºæˆ‘ä»¬ç¦æ­¢äº†ä»å­—ç¬¦ä¸²ç”Ÿæˆä»£ç </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">eval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">userInput</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å¯ç”¨äº†<code>--disallow-code-generation-from-strings</code>åï¼Œå°è¯•ä½¿ç”¨<code>eval()</code>å°†ä¼šæŠ›å‡ºé”™è¯¯ï¼Œä¿æŠ¤ä½ çš„ç¨‹åºä¸æ‰§è¡Œæ½œåœ¨çš„æ¶æ„ä»£ç ã€‚</p><p>è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªå‚æ•°ä¸ä»…å½±å“<code>eval()</code>ï¼Œè¿˜å½±å“æ‰€æœ‰èƒ½å¤Ÿä»å­—ç¬¦ä¸²ä¸­ç”Ÿæˆä»£ç çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ <code>setTimeout()</code> å’Œ <code>setInterval()</code> å½“ä½ ç”¨å®ƒä»¬ä»¥å­—ç¬¦ä¸²å½¢å¼ä¼ é€’ä»£ç æ—¶ï¼Œä»¥åŠ <code>Function</code> æ„é€ å‡½æ•°ã€‚</p><p>å› æ­¤ï¼Œåœ¨å®è·µä¸­ï¼Œä½¿ç”¨<code>--disallow-code-generation-from-strings</code>é€‰é¡¹å¯ä»¥å¸®åŠ©ä½ å¼ºåˆ¶å®è¡Œæ›´å®‰å…¨çš„ç¼–ç ä¹ æƒ¯ï¼Œå¹¶ä¿è¯ä½ çš„ä»£ç ä¸ä¼šè¯¯ç”¨è¿™äº›å¯èƒ½å¯¼è‡´å®‰å…¨é—®é¢˜çš„ JavaScript ç‰¹æ€§ã€‚</p><h3 id="dns-result-order-order" tabindex="-1"><a class="header-anchor" href="#dns-result-order-order"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--dns-result-orderorder" target="_blank" rel="noopener noreferrer">--dns-result-order=order</a></span></a></h3><p><code>--dns-result-order=order</code> æ˜¯ Node.js çš„ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨äºæŒ‡å®šåœ¨è§£æåŸŸåï¼ˆæ¯”å¦‚å½“ä½ å°è¯•è¿æ¥åˆ°ä¸€ä¸ªç½‘ç«™æˆ–æœåŠ¡å™¨æ—¶ï¼‰æ—¶è¿”å›çš„ IP åœ°å€çš„é¡ºåºã€‚DNS è§£ææ˜¯å°†äººç±»å¯è¯»çš„ç½‘å€ï¼ˆå¦‚ <code>www.example.com</code>ï¼‰è½¬æ¢ä¸ºæœºå™¨å¯ç†è§£çš„ IP åœ°å€ï¼ˆå¦‚ <code>93.184.216.34</code>ï¼‰çš„è¿‡ç¨‹ã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ DNS è§£æè¿”å›å¤šä¸ª IP åœ°å€çš„æƒ…å†µã€‚æœ‰æ—¶å€™ï¼Œå½“ä½ æŸ¥è¯¢ä¸€ä¸ªåŸŸåå¯¹åº”çš„ IP åœ°å€æ—¶ï¼Œä¼šå¾—åˆ°ä¸æ­¢ä¸€ä¸ª IP åœ°å€ã€‚è¿™æ˜¯å› ä¸ºå¤§å‹ç½‘ç«™å’ŒæœåŠ¡é€šå¸¸ä¼šéƒ¨ç½²åœ¨å¤šå°æœåŠ¡å™¨ä¸Šï¼Œåˆ†å¸ƒåœ¨ä¸åŒçš„åœ°ç†ä½ç½®ï¼Œä»¥å®ç°è´Ÿè½½å‡è¡¡å’Œé«˜å¯ç”¨æ€§ã€‚å› æ­¤ï¼ŒDNS æŸ¥è¯¢å¯èƒ½è¿”å›ä¸€ä¸ª IP åœ°å€åˆ—è¡¨ï¼Œè€Œä½ çš„è®¡ç®—æœºéœ€è¦ä»è¿™ä¸ªåˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ª IP åœ°å€æ¥å»ºç«‹è¿æ¥ã€‚</p><p>Node.js ä¸­ <code>--dns-result-order</code> é€‰é¡¹å…è®¸å¼€å‘è€…æŒ‡å®šè¿™äº› IP åœ°å€çš„æ’åºæ–¹å¼ã€‚è¯¥é€‰é¡¹å¯ä»¥æ¥å—ä»¥ä¸‹å€¼ä¹‹ä¸€ï¼š</p><ul><li><code>ipv4first</code>ï¼šIPv4 åœ°å€ä¼šè¢«æ”¾åœ¨ IPv6 åœ°å€å‰é¢è¿”å›ã€‚</li><li><code>verbatim</code>ï¼šæŒ‰ç…§ä» DNS æœåŠ¡å™¨æ”¶åˆ°çš„åŸå§‹é¡ºåºè¿”å› IP åœ°å€ã€‚</li></ul><p>è¿™é‡Œæ˜¯å‡ ä¸ªå®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><ol><li><p><strong>ç®€å•çš„ Web è¯·æ±‚</strong> - å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js ç¨‹åºï¼Œè¦å‘ <code>www.example.com</code> å‘èµ· HTTP è¯·æ±‚ã€‚è¿™ä¸ªåŸŸåå¯èƒ½ä¼šè§£æå‡ºå¤šä¸ª IP åœ°å€ã€‚å¦‚æœä½ å¸Œæœ›ç¨‹åºä¼˜å…ˆä½¿ç”¨ IPv4 åœ°å€ï¼Œä½ å¯ä»¥å¯åŠ¨ Node.js ç¨‹åºæ—¶æ·»åŠ  <code>--dns-result-order=ipv4first</code> é€‰é¡¹ã€‚</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --dns-result-order=ipv4first</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>å¾®æœåŠ¡æ¶æ„</strong> - åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå„ä¸ªæœåŠ¡å¯èƒ½éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨æˆ–å®¹å™¨ä¸­ã€‚å¦‚æœæŸä¸ªæœåŠ¡ï¼ˆæ¯”å¦‚ç”¨æˆ·è®¤è¯æœåŠ¡ï¼‰å…·æœ‰å¤šä¸ªå®ä¾‹ï¼Œå¹¶ä¸”ç”±äºæŸç§åŸå› ï¼Œä½ æƒ³è¦è®©ä½ çš„ Node.js åº”ç”¨æ€»æ˜¯å°è¯•åŒæ ·çš„ IP åœ°å€é¡ºåºæ¥ä¿æŒä¸€è‡´çš„å»¶è¿Ÿç‰¹æ€§ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>verbatim</code> é€‰é¡¹æ¥ç¡®ä¿æ¯æ¬¡ DNS è§£æç»“æœçš„é¡ºåºéƒ½æ˜¯ç›¸åŒçš„ã€‚</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --dns-result-order=verbatim</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>è·¨å¹³å°è„šæœ¬</strong> - å½“ä½ çš„ Node.js åº”ç”¨éœ€è¦åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿç¯å¢ƒä¸‹è¿è¡Œï¼Œè€Œè¿™äº›ç³»ç»Ÿå¯¹äº DNS è§£æçš„é»˜è®¤å¤„ç†æ–¹å¼å¯èƒ½æœ‰æ‰€ä¸åŒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨ <code>--dns-result-order</code> é€‰é¡¹å¯ä»¥å¸®åŠ©ä½ ç¡®ä¿æ‰€æœ‰ç¯å¢ƒä¸‹ DNS è§£æçš„è¡Œä¸ºä¸€è‡´æ€§ã€‚</p></li></ol><p>è¿™ä¸ªé€‰é¡¹ä¸»è¦æ˜¯å½±å“åº•å±‚ç½‘ç»œè¯·æ±‚çš„ç»†èŠ‚ï¼Œå¯¹äºå¤§å¤šæ•°åº”ç”¨æ¥è¯´ï¼Œé»˜è®¤è®¾ç½®å·²ç»è¶³å¤Ÿå¥½ç”¨ï¼Œä½†æ˜ç™½å®ƒçš„å­˜åœ¨å¯ä»¥å¸®åŠ©ä½ åœ¨é‡åˆ°å¤æ‚ç½‘ç»œé—®é¢˜æ—¶æœ‰æ›´å¤šçš„è°ƒè¯•æ‰‹æ®µã€‚</p><h3 id="enable-fips" tabindex="-1"><a class="header-anchor" href="#enable-fips"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--enable-fips" target="_blank" rel="noopener noreferrer">--enable-fips</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒè®©ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€äº›è¿è¡Œé€‰é¡¹å¯ä»¥åœ¨å¯åŠ¨æ—¶é…ç½®ï¼Œ<code>--enable-fips</code> æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚</p><h3 id="fips-æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#fips-æ¨¡å¼"><span>FIPS æ¨¡å¼</span></a></h3><p>FIPS æ˜¯æŒ‡ç¾å›½è”é‚¦ä¿¡æ¯å¤„ç†æ ‡å‡†ï¼ˆFederal Information Processing Standardï¼‰ã€‚ä¸»è¦ç”¨äºè®¡ç®—æœºç³»ç»Ÿä¸­åŠ å¯†æ¨¡å—çš„æ ‡å‡†åŒ–ï¼Œå¹¶ä¸”å®ƒæ˜¯ç¾å›½æ”¿åºœæœºæ„åœ¨é‡‡è´­ç¡¬ä»¶å’Œè½¯ä»¶äº§å“æ—¶å¿…é¡»éµå¾ªçš„å®‰å…¨è¦æ±‚ä¹‹ä¸€ã€‚</p><p>å½“æ¶‰åŠåˆ°éœ€è¦æé«˜å®‰å…¨æ€§çš„æ•°æ®ï¼ˆæ¯”å¦‚æ”¿åºœæˆ–é‡‘èæœºæ„ï¼‰æ—¶ï¼Œå¼€å¯ FIPS æ¨¡å¼æ„å‘³ç€æ‰€æœ‰çš„åŠ è§£å¯†æ“ä½œéƒ½å¿…é¡»ä½¿ç”¨ç»è¿‡ FIPS è®¤è¯çš„ç®—æ³•å’Œå®ç°ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ä½¿ç”¨çš„åŠ å¯†æŠ€æœ¯è¾¾åˆ°äº†ä¸€å®šçš„å®‰å…¨æ ‡å‡†ã€‚</p><h3 id="enable-fips-é€‰é¡¹" tabindex="-1"><a class="header-anchor" href="#enable-fips-é€‰é¡¹"><span><code>--enable-fips</code> é€‰é¡¹</span></a></h3><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>--enable-fips</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨äºå¯åŠ¨æ—¶å°† Node.js è¿è¡Œåœ¨ FIPS å…¼å®¹æ¨¡å¼ä¸‹ã€‚å½“ä½ å¯åŠ¨ Node.js æ—¶ï¼Œåœ¨å‘½ä»¤è¡Œä¸­æ·»åŠ è¿™ä¸ªé€‰é¡¹ï¼Œä¼šä½¿å¾— Node.js çš„åŠ å¯†åº“åªä½¿ç”¨ç¬¦åˆ FIPS æ ‡å‡†çš„ç®—æ³•ã€‚</p><h3 id="ä½¿ç”¨ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ä¸¾ä¾‹"><span>ä½¿ç”¨ä¸¾ä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€æ¬¾éœ€è¦ç¬¦åˆä¸¥æ ¼å®‰å…¨è§„èŒƒçš„åº”ç”¨ç¨‹åºï¼Œå¯èƒ½å› ä¸ºå®ƒéœ€è¦é€šè¿‡æ”¿åºœçš„å®¡æ ¸æˆ–è€…å®ƒå¤„ç†äº†éå¸¸æ•æ„Ÿçš„æ•°æ®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦å¼€å¯ Node.js çš„ FIPS æ¨¡å¼æ¥æ»¡è¶³è¿™äº›å®‰å…¨è¦æ±‚ã€‚</p><p>ä¾‹å¦‚ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --enable-fips</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¸Šè¿°å‘½ä»¤ä¼šå¯åŠ¨åä¸º <code>your-app.js</code> çš„ Node.js åº”ç”¨ç¨‹åºï¼Œå¹¶å¼ºåˆ¶ä½¿ç”¨ FIPS å…¼å®¹çš„åŠ å¯†ç®—æ³•ã€‚</p><h3 id="å®é™…è¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨"><span>å®é™…è¿ç”¨</span></a></h3><p>å¯¹äºå¤§å¤šæ•°æ™®é€šçš„ Node.js åº”ç”¨æ¥è¯´ï¼Œå¯èƒ½ä¸éœ€è¦è€ƒè™‘ FIPS æ¨¡å¼ï¼Œå› ä¸ºå®ƒä¸»è¦æ˜¯é’ˆå¯¹ç‰¹å®šçš„è¡Œä¸šå’Œç»„ç»‡çš„éœ€æ±‚ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ åœ¨åˆ›å»ºæ¶‰åŠåˆ°éœ€è¦éµå®ˆè”é‚¦ä¿¡æ¯å®‰å…¨æ ‡å‡†çš„é¡¹ç›®ï¼Œè¿™æ—¶å€™ <code>--enable-fips</code> å°±å˜å¾—éå¸¸é‡è¦ã€‚</p><p>æ¯”å¦‚ï¼š</p><ul><li>æ”¿åºœé¡¹ç›®éœ€è¦åŠ å¯†ä¼ è¾“å’Œå­˜å‚¨æ•æ„Ÿä¿¡æ¯ã€‚</li><li>é‡‘èæœåŠ¡åº”ç”¨ï¼Œä¾‹å¦‚é“¶è¡Œæˆ–äº¤æ˜“å¹³å°ï¼Œéœ€è¦ç¡®ä¿æ‰€æœ‰äº¤æ˜“æ•°æ®çš„å®‰å…¨æ€§ã€‚</li><li>åŒ»ç–—å¥åº·åº”ç”¨ç¨‹åºï¼Œæ¶‰åŠåˆ°ç—…äººéšç§ä¿¡æ¯çš„ä¿æŠ¤ã€‚</li></ul><p>åœ¨è¿™äº›æ¡ˆä¾‹ä¸­ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>--enable-fips</code> é€‰é¡¹æ¥å¸®åŠ©ç¡®ä¿ä»–ä»¬çš„ Node.js åº”ç”¨æ»¡è¶³ç›¸åº”çš„å®‰å…¨æ³•è§„å’Œæ ‡å‡†ã€‚</p><h3 id="enable-network-family-autoselection" tabindex="-1"><a class="header-anchor" href="#enable-network-family-autoselection"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--enable-network-family-autoselection" target="_blank" rel="noopener noreferrer">--enable-network-family-autoselection</a></span></a></h3><p>Node.js çš„ <code>--enable-network-family-autoselection</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå¯ä»¥åœ¨å¯åŠ¨ Node.js ç¨‹åºæ—¶ä½¿ç”¨ã€‚è¿™ä¸ªé€‰é¡¹çš„ç›®çš„æ˜¯ä¸ºäº†è®© Node.js è‡ªåŠ¨é€‰æ‹©ç½‘ç»œåœ°å€æ—ï¼ˆIPv4 æˆ– IPv6ï¼‰ï¼Œå½“å®ƒå°è¯•è¿æ¥åˆ°ä¸€ä¸ªåŸŸåï¼ˆä¾‹å¦‚ <a href="http://www.example.com" target="_blank" rel="noopener noreferrer">www.example.com</a>ï¼‰å¹¶ä¸”è¯¥åŸŸååŒæ—¶æœ‰ IPv4 å’Œ IPv6 åœ°å€æ—¶ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œäº’è”ç½‘ä¸Šçš„è®¾å¤‡å¯ä»¥é€šè¿‡ä¸¤ç§ä¸»è¦ç±»å‹çš„ IP åœ°å€æ¥è¯†åˆ«ï¼šIPv4 å’Œ IPv6ã€‚IPv4 æ˜¯æ—©æœŸäº’è”ç½‘ä½¿ç”¨çš„æ ‡å‡†ï¼Œè€Œç”±äº IPv4 åœ°å€æ•°é‡çš„æ¯ç«­ï¼ŒIPv6 è¢«è®¾è®¡å‡ºæ¥ä»¥æä¾›æ›´å¤šçš„ IP åœ°å€ã€‚æœ‰äº›æœåŠ¡å™¨å¯èƒ½åŒæ—¶æ”¯æŒ IPv4 å’Œ IPv6 åœ°å€ã€‚</p><p>ä¸ä½¿ç”¨ <code>--enable-network-family-autoselection</code> é€‰é¡¹æ—¶ï¼Œå¦‚æœä½ çš„ Node.js åº”ç”¨éœ€è¦è¿æ¥åˆ°ä¸€ä¸ªå…·æœ‰åŒæ ˆï¼ˆåŒæ—¶æ‹¥æœ‰ IPv4 å’Œ IPv6ï¼‰çš„æœåŠ¡å™¨ï¼Œä½ å¯èƒ½éœ€è¦æ‰‹åŠ¨æŒ‡å®šä½¿ç”¨ IPv4 æˆ– IPv6ã€‚è¿™å¯èƒ½éœ€è¦åœ¨ä»£ç ä¸­æ·»åŠ é¢å¤–çš„é€»è¾‘æ¥æ£€æŸ¥å“ªä¸ª IP ç‰ˆæœ¬å¯ç”¨ï¼Œå¹¶æ®æ­¤å‘èµ·è¿æ¥ã€‚</p><p>å½“ä½ ä½¿ç”¨ <code>--enable-network-family-autoselection</code> é€‰é¡¹æ—¶ï¼ŒNode.js å°†è‡ªåŠ¨ç¡®å®šåº”å½“ä½¿ç”¨ IPv4 è¿˜æ˜¯ IPv6 æ¥å»ºç«‹ç½‘ç»œè¿æ¥ã€‚è¿™æ ·åšä¹‹åï¼Œä½œä¸ºå¼€å‘è€…ï¼Œä½ å°±ä¸å¿…æ‹…å¿ƒè¿™ä¸ªç»†èŠ‚ï¼Œå¯ä»¥è®© Node.js å¸®ä½ å¤„ç†è¿™éƒ¨åˆ†é€»è¾‘ã€‚</p><p>å®é™…è¿ç”¨ä¾‹å­ï¼š</p><ol><li><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç®€å•çš„ Node.js HTTP å®¢æˆ·ç«¯å»è¯·æ±‚ä¸€ä¸ªåŒæ ˆæ”¯æŒçš„æœåŠ¡ã€‚å¯ç”¨äº† <code>--enable-network-family-autoselection</code> åï¼Œæ— è®ºæœåŠ¡æ˜¯é€šè¿‡ IPv4 è¿˜æ˜¯ IPv6 åœ°å€å›åº”ï¼Œä½ çš„å®¢æˆ·ç«¯éƒ½èƒ½æˆåŠŸå»ºç«‹è¿æ¥è€Œæ— éœ€ä»»ä½•é¢å¤–é€»è¾‘ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --enable-network-family-autoselection</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-http-client-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>å¦‚æœä½ åœ¨ç¼–å†™ä¸€ä¸ªç½‘ç»œçˆ¬è™«ï¼Œè¿™ä¸ªçˆ¬è™«ä¼šè®¿é—®å¤§é‡ä¸åŒçš„ç½‘ç«™ï¼Œè¿™äº›ç½‘ç«™å¯èƒ½åœ¨ä¸åŒåœ°åŒºã€ç”±ä¸åŒçš„æŠ€æœ¯æ”¯æŒï¼Œå› æ­¤å¯èƒ½ä½¿ç”¨ IPv4 æˆ– IPv6ã€‚ä½¿ç”¨ <code>--enable-network-family-autoselection</code>ï¼Œä½ çš„çˆ¬è™«ç¨‹åºå°±å¯ä»¥çµæ´»åœ°è¿æ¥åˆ°ä»»ä½•ä¸€ç§ç±»å‹çš„ IP åœ°å€ï¼Œè€Œä¸éœ€è¦æ‹…å¿ƒå…¼å®¹æ€§é—®é¢˜ã€‚</p></li><li><p>éƒ¨ç½²åˆ°ä¸€ä¸ªæ–°çš„ç¯å¢ƒä¸­ï¼Œæ¯”å¦‚ä»åªæ”¯æŒ IPv4 çš„ç¯å¢ƒè¿ç§»åˆ°åŒæ—¶æ”¯æŒ IPv4 å’Œ IPv6 çš„ç¯å¢ƒï¼Œå¯ç”¨è‡ªåŠ¨é€‰æ‹©å°†ä½¿å¾—ä½ çš„ Node.js åº”ç”¨èƒ½å¤Ÿå¹³æ»‘è¿‡æ¸¡ï¼Œè€Œä¸éœ€è¦ä½ ä¿®æ”¹ä»£ç æ¥é€‚é…æ–°çš„ç½‘ç»œé…ç½®ã€‚</p></li></ol><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>--enable-network-family-autoselection</code> è®©ä½ çš„ Node.js åº”ç”¨ç¨‹åºåœ¨å¤„ç†ä¸åŒçš„ IP åœ°å€ç±»å‹æ—¶å˜å¾—æ›´åŠ æ™ºèƒ½å’Œçµæ´»ã€‚å¯¹äºå¤§å¤šæ•°åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šç§ç½‘ç»œç¯å¢ƒä¸‹è¿è¡Œçš„åº”ç”¨ï¼Œè¿™å¯ä»¥å‡å°‘å¾ˆå¤šæ½œåœ¨çš„å¤æ‚æ€§å’Œç¼–ç å·¥ä½œã€‚</p><h3 id="enable-source-maps" tabindex="-1"><a class="header-anchor" href="#enable-source-maps"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--enable-source-maps" target="_blank" rel="noopener noreferrer">--enable-source-maps</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘æ¥å¸®ä½ äº†è§£ Node.js ä¸­çš„ <code>--enable-source-maps</code> é€‰é¡¹ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯ Source Mapsã€‚åœ¨ç¼–ç¨‹ä¸­ï¼Œå°¤å…¶æ˜¯å½“ä½ åœ¨å†™ JavaScript æˆ– TypeScript è¿™æ ·çš„è„šæœ¬è¯­è¨€æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨ä¸€äº›å·¥å…·æ¥è½¬æ¢æˆ–è€…å‹ç¼©ä»£ç ã€‚ä¾‹å¦‚ï¼ŒTypeScript</p><h3 id="env-file-config" tabindex="-1"><a class="header-anchor" href="#env-file-config"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--env-fileconfig" target="_blank" rel="noopener noreferrer">--env-file=config</a></span></a></h3><p>Node.js ä¸­çš„ <code>--env-file=config</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒå…è®¸ä½ åœ¨å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶åŠ è½½ç¯å¢ƒå˜é‡ã€‚ç¯å¢ƒå˜é‡æ˜¯è¿è¡Œæ—¶å¯ç”¨çš„é”®å€¼å¯¹ï¼Œé€šå¸¸ç”¨äºé…ç½®åº”ç”¨ç¨‹åºè¡Œä¸ºè€Œæ— éœ€æ›´æ”¹ä»£ç ã€‚è¿™ä¸ªåŠŸèƒ½ç‰¹åˆ«é€‚åˆç®¡ç†ä¸åŒç¯å¢ƒï¼ˆå¦‚å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰çš„é…ç½®ä¿¡æ¯ã€‚</p><p>å½“ä½ ä½¿ç”¨ <code>--env-file=config</code> é€‰é¡¹æ—¶ï¼ŒNode.js ä¼šä»æŒ‡å®šçš„æ–‡ä»¶ä¸­è¯»å–ç¯å¢ƒå˜é‡ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ä¸­ã€‚è¿™ä¸ªæ–‡ä»¶é€šå¸¸æ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†æ ¼å¼ä¸º <code>KEY=VALUE</code> çš„è¡Œã€‚æ¯è¡Œå®šä¹‰äº†ä¸€ä¸ªç¯å¢ƒå˜é‡çš„é”®å’Œå€¼ã€‚</p><p>ä¸‹é¢æ˜¯å‡ ä¸ªå®é™…çš„ä¾‹å­æ¥è¯´æ˜ <code>--env-file=config</code> çš„ç”¨æ³•ï¼š</p><h3 id="ç¤ºä¾‹-1-åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶"><span>ç¤ºä¾‹ 1ï¼šåˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶</span></a></h3><p>é¦–å…ˆï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªåŒ…å«ç¯å¢ƒå˜é‡çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸º <code>.env</code>ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹å†…å®¹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>## .env æ–‡ä»¶</span></span>
<span class="line"><span>DATABASE_URL=mongodb://localhost:27017/myapp</span></span>
<span class="line"><span>SECRET_KEY=mysecretkey</span></span>
<span class="line"><span>PORT=3000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå·¦è¾¹æ˜¯é”®åï¼Œå³è¾¹æ˜¯å€¼ï¼Œå®ƒä»¬é€šè¿‡ç­‰å· <code>=</code> åˆ†éš”ã€‚</p><h3 id="ç¤ºä¾‹-2-å¯åŠ¨-node-js-åº”ç”¨ç¨‹åºæ—¶åŠ è½½ç¯å¢ƒå˜é‡" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-å¯åŠ¨-node-js-åº”ç”¨ç¨‹åºæ—¶åŠ è½½ç¯å¢ƒå˜é‡"><span>ç¤ºä¾‹ 2ï¼šå¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶åŠ è½½ç¯å¢ƒå˜é‡</span></a></h3><p>ç°åœ¨ï¼Œå½“ä½ æƒ³è¦å¯åŠ¨ä½ çš„ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ <code>--env-file</code> é€‰é¡¹æ¥æŒ‡å®š <code>.env</code> æ–‡ä»¶ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --env-file=.env</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your_app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¸Šé¢çš„å‘½ä»¤å‘Šè¯‰ Node.js åœ¨å¯åŠ¨ <code>your_app.js</code> ä¹‹å‰ï¼Œå…ˆä»å½“å‰ç›®å½•ä¸‹çš„ <code>.env</code> æ–‡ä»¶ä¸­è¯»å–ç¯å¢ƒå˜é‡ã€‚</p><h3 id="ç¤ºä¾‹-3-åœ¨åº”ç”¨ä»£ç ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-3-åœ¨åº”ç”¨ä»£ç ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡"><span>ç¤ºä¾‹ 3ï¼šåœ¨åº”ç”¨ä»£ç ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡</span></a></h3><p>åœ¨ <code>your_app.js</code> æˆ–è€…ä»»ä½•å…¶ä»–çš„ Node.js æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>process.env</code> å¯¹è±¡æ¥è®¿é—®è¿™äº›ç¯å¢ƒå˜é‡ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// your_app.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> express</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;express&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> app</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> express</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> port</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ||</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é»˜è®¤å€¼</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">app</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Server is running on port </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ<code>process.env.PORT</code> å°†ä¼šå¾—åˆ° <code>.env</code> æ–‡ä»¶ä¸­å®šä¹‰çš„ç«¯å£å· <code>3000</code>ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ° <code>PORT</code> ç¯å¢ƒå˜é‡ï¼Œå®ƒä¼šä½¿ç”¨é»˜è®¤ç«¯å£ <code>5000</code>ã€‚</p><p>ä½¿ç”¨ <code>--env-file</code> é€‰é¡¹ï¼Œä½ å°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç®¡ç†å’Œåˆ‡æ¢åº”ç”¨ç¨‹åºçš„é…ç½®ï¼Œè€Œæ— éœ€ç›´æ¥åœ¨ä»£ç ä¸­ç¡¬ç¼–ç è¿™äº›ä¿¡æ¯ï¼ŒåŒæ—¶è¿˜èƒ½ä¿æŒæ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚æ•°æ®åº“ URLã€ç§˜é’¥ç­‰ï¼‰çš„å®‰å…¨æ€§ï¼Œå› ä¸ºè¿™äº›ä¿¡æ¯ä¸ä¼šè¢«æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚</p><h3 id="e-eval-script" tabindex="-1"><a class="header-anchor" href="#e-eval-script"><span><a href="https://nodejs.org/docs/latest/api/cli.html#-e---eval-script" target="_blank" rel="noopener noreferrer">-e, --eval &quot;script&quot;</a></span></a></h3><p>Node.js ä¸­çš„ <code>-e</code> æˆ– <code>--eval</code> å‘½ä»¤è¡Œé€‰é¡¹å…è®¸ä½ ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œä¸€æ®µ JavaScript ä»£ç ï¼Œè€Œä¸æ˜¯å°†ä»£ç å†™åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ç„¶åè¿è¡Œè¯¥æ–‡ä»¶ã€‚ä½¿ç”¨ <code>-e</code> æˆ– <code>--eval</code> å¾ˆæ–¹ä¾¿è¿›è¡Œå¿«é€Ÿæµ‹è¯•æˆ–æ‰§è¡Œç®€å•çš„è„šæœ¬ã€‚</p><p>è¿™é‡Œæœ‰ä¸€äº›å…³äºå¦‚ä½•ä½¿ç”¨ <code>-e</code> æˆ– <code>--eval</code> çš„å®é™…ä¾‹å­ï¼š</p><h3 id="ä¾‹å­-1-æ‰§è¡Œç®€å•è¡¨è¾¾å¼" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-æ‰§è¡Œç®€å•è¡¨è¾¾å¼"><span>ä¾‹å­ 1: æ‰§è¡Œç®€å•è¡¨è¾¾å¼</span></a></h3><p>å‡è®¾ä½ æƒ³è¦å¿«é€Ÿè®¡ç®—ä¸€ä¸ªæ•°å­¦è¡¨è¾¾å¼çš„ç»“æœï¼Œæ¯”å¦‚ <code>3 + 4</code>ã€‚ä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¿™æ ·åšï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;console.log(3 + 4)&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ï¼Œå°†ä¼šè¾“å‡ºç»“æœ <code>7</code> åˆ°æ§åˆ¶å°ã€‚</p><h3 id="ä¾‹å­-2-ä½¿ç”¨-json" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ä½¿ç”¨-json"><span>ä¾‹å­ 2: ä½¿ç”¨ JSON</span></a></h3><p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>-e</code> é€‰é¡¹æ¥å¤„ç† JSON æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¦æ ¼å¼åŒ–ä¸€ä¸ª JSON å­—ç¬¦ä¸²ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;console.log(JSON.stringify({name: &#39;Node.js&#39;, version: &#39;v21.7.1&#39;}, null, 2))&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¸ªå‘½ä»¤å°†ä¼šåœ¨æ§åˆ¶å°æ‰“å°å‡ºæ ¼å¼åŒ–åçš„ JSON å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Node.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;v21.7.1&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¾‹å­-3-ä½¿ç”¨æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-3-ä½¿ç”¨æ¨¡å—"><span>ä¾‹å­ 3: ä½¿ç”¨æ¨¡å—</span></a></h3><p>é€šè¿‡ <code>-e</code> é€‰é¡¹ï¼Œä½ å¯ä»¥å¼•å…¥ Node.js çš„æ ¸å¿ƒæ¨¡å—ï¼ˆå¦‚ <code>fs</code> æ–‡ä»¶ç³»ç»Ÿæ¨¡å—ï¼‰æˆ–è€…è‡ªå®šä¹‰æ¨¡å—ï¼Œå¹¶æ‰§è¡Œç›¸å…³æ“ä½œï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;const fs = require(&#39;fs&#39;); fs.writeFileSync(&#39;test.txt&#39;, &#39;Hello Node.js!&#39;);&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¸ªå‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>test.txt</code> çš„æ–‡ä»¶ï¼Œå¹¶å†™å…¥äº†æ–‡æœ¬ <code>Hello Node.js!</code>ã€‚</p><h3 id="ä¾‹å­-4-å¤æ‚çš„é€»è¾‘" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-4-å¤æ‚çš„é€»è¾‘"><span>ä¾‹å­ 4: å¤æ‚çš„é€»è¾‘</span></a></h3><p>å³ä½¿æ˜¯æ›´å¤æ‚çš„é€»è¾‘ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>-e</code> é€‰é¡¹æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå°çš„ for å¾ªç¯ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;for (let i = 0; i `</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">` 5; i++) console.log(`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Number:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">}`)&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™å°†ä¼šè¾“å‡ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>Number: 0</span></span>
<span class="line"><span>Number: 1</span></span>
<span class="line"><span>Number: 2</span></span>
<span class="line"><span>Number: 3</span></span>
<span class="line"><span>Number: 4</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¾‹å­-5-iife-ç«‹å³è°ƒç”¨çš„å‡½æ•°è¡¨è¾¾å¼" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-5-iife-ç«‹å³è°ƒç”¨çš„å‡½æ•°è¡¨è¾¾å¼"><span>ä¾‹å­ 5: IIFEï¼ˆç«‹å³è°ƒç”¨çš„å‡½æ•°è¡¨è¾¾å¼ï¼‰</span></a></h3><p>ä¸ºäº†é¿å…å…¨å±€æ±¡æŸ“ï¼Œä½ å¯èƒ½æƒ³è¦å°†ä½ çš„ä»£ç æ”¾åœ¨ä¸€ä¸ª IIFE ä¸­ï¼Œå°±åƒè¿™æ ·ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;(function() { var x = &#39;Local to IIFE&#39;; console.log(x); })()&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç å®šä¹‰å¹¶ç«‹å³æ‰§è¡Œäº†ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå®ƒçš„å˜é‡ <code>x</code> ä¸ä¼šæ±¡æŸ“å…¨å±€å‘½åç©ºé—´ã€‚</p><p>ä½¿ç”¨ <code>-e</code> é€‰é¡¹çš„å¥½å¤„æ˜¯ä½ å¯ä»¥éå¸¸å¿«é€Ÿåœ°æµ‹è¯•å‡ºä¸€æ®µä»£ç æ˜¯å¦æŒ‰ç…§é¢„æœŸå·¥ä½œï¼Œè€Œä¸éœ€è¦åˆ›å»ºå’Œç¼–è¾‘ä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶ã€‚ç„¶è€Œï¼Œå¯¹äºæ›´é•¿ã€æ›´å¤æ‚çš„è„šæœ¬ï¼Œé€šå¸¸æ›´æ¨èç¼–å†™åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­å»ï¼Œå¹¶ä½¿ç”¨ <code>node filename.js</code> æ¥è¿è¡Œã€‚</p><h3 id="experimental-default-type-type" tabindex="-1"><a class="header-anchor" href="#experimental-default-type-type"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--experimental-default-typetype" target="_blank" rel="noopener noreferrer">--experimental-default-type=type</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå¯ä»¥è®©ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚åœ¨ Node.js ä¸­ï¼Œæ¨¡å—ç³»ç»Ÿæ˜¯ç»„ç»‡å’Œå¤ç”¨ä»£ç çš„ä¸€ç§æ–¹å¼ã€‚é€šå¸¸ï¼Œå½“ä½  <code>require</code> æˆ–ä½¿ç”¨ <code>import</code> è¯­æ³•åŠ è½½æ–‡ä»¶æ—¶ï¼ŒNode.js éœ€è¦çŸ¥é“è¿™ä¸ªæ–‡ä»¶æ˜¯ä»€ä¹ˆç±»å‹çš„æ¨¡å—â€”â€”æ¯”å¦‚æ˜¯ CommonJS æ¨¡å—è¿˜æ˜¯ ES æ¨¡å—ã€‚</p><p>åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼ŒNode.js ä¸»è¦æ”¯æŒ CommonJS æ¨¡å—ç³»ç»Ÿã€‚éšç€ ES æ¨¡å—ï¼ˆECMAScript Modulesï¼Œç®€ç§° ESMï¼‰çš„æµè¡Œï¼ŒNode.js ä¹Ÿå¼€å§‹æ”¯æŒè¿™ç§æ–°çš„æ¨¡å—ç³»ç»Ÿã€‚ESM åœ¨å†™æ³•å’ŒåŠŸèƒ½ä¸Šä¸ CommonJS æœ‰ä¸€äº›åŒºåˆ«ï¼Œä¾‹å¦‚å®ƒæ”¯æŒé™æ€å¯¼å…¥å¯¼å‡ºå’Œæ¨¡å—ä½œç”¨åŸŸã€‚</p><p>ä»¥å¾€åœ¨ Node.js ä¸­ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨ ESMï¼Œä½ éœ€è¦åœ¨ä½ çš„æ¨¡å—æ–‡ä»¶ä¸­ä½¿ç”¨ <code>.mjs</code> æ‰©å±•åï¼Œæˆ–è€…åœ¨ <code>package.json</code> æ–‡ä»¶ä¸­è®¾ç½® <code>&quot;type&quot;: &quot;module&quot;</code> æ¥è¡¨æ˜è¿™æ˜¯ä¸€ä¸ª ECMAScript æ¨¡å—ã€‚ç›¸å¯¹åº”åœ°ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨ <code>.js</code> æ‰©å±•åçš„æ–‡ä»¶è¢«è§†ä¸º CommonJS æ¨¡å—ã€‚</p><p>ç°åœ¨ï¼Œè€ƒè™‘åˆ°æŸäº›å¼€å‘åœºæ™¯å¯èƒ½éœ€è¦é»˜è®¤å°†æ‰€æœ‰æ¨¡å—éƒ½ä½œä¸º ESM å¤„ç†ï¼ŒNode.js å¼•å…¥äº†ä¸€ä¸ªå®éªŒæ€§çš„ CLIï¼ˆå‘½ä»¤è¡Œç•Œé¢ï¼‰é€‰é¡¹ <code>--experimental-default-type=type</code>ã€‚é€šè¿‡è¿™ä¸ªé€‰é¡¹ï¼Œä½ å¯ä»¥æŒ‡å®šé»˜è®¤çš„æ¨¡å—ç³»ç»Ÿç±»å‹ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ è¿è¡Œ Node.js åº”ç”¨ç¨‹åºå¹¶å¸Œæœ›æ‰€æœ‰ä¸å…·æœ‰æ˜ç¡®æ ‡è®°ç±»å‹çš„ JavaScript æ–‡ä»¶éƒ½è¢«è§†ä¸º ESMï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨ Node.js æ—¶åŠ ä¸Š <code>--experimental-default-type=module</code> å‚æ•°ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --experimental-default-type=module</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ„å‘³ç€å³ä½¿ <code>your-app.js</code> å’Œå…¶ä»–å¯èƒ½æ²¡æœ‰æ˜ç¡®æŒ‡å®šç±»å‹çš„ JavaScript æ–‡ä»¶ä¹Ÿä¼šè¢«å½“ä½œ ESM æ¥å¤„ç†ã€‚è¿™æ ·ï¼Œä½ å°±ä¸éœ€è¦åœ¨æ¯ä¸ªæ–‡ä»¶é‡Œå•ç‹¬æŒ‡å®šæ¨¡å—ç±»å‹æˆ–è€…æ”¹å˜æ–‡ä»¶æ‰©å±•åäº†ã€‚</p><p>è¯·æ³¨æ„ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§åŠŸèƒ½ï¼Œåœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­ï¼Œå®ƒçš„è¡Œä¸ºå’Œå¯ç”¨æ€§å¯èƒ½ä¼šæ›´æ”¹ã€‚æ‰€ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è°¨æ…ä½¿ç”¨å®ƒã€‚</p><p>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</p><ol><li><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå…¨æ–°çš„é¡¹ç›®ï¼Œè€Œä½ æƒ³è¦é»˜è®¤æ‰€æœ‰æ¨¡å—éƒ½æ˜¯ ESMï¼Œåˆä¸æƒ³åœ¨ <code>package.json</code> é‡Œè®¾ç½® <code>&quot;type&quot;: &quot;module&quot;</code> æˆ–è€…ä½¿ç”¨ <code>.mjs</code> æ‰©å±•åã€‚ä½ å¯ä»¥åœ¨è¿è¡Œé¡¹ç›®çš„æ—¶å€™ä½¿ç”¨ä¸Šè¿°çš„ CLI é€‰é¡¹ã€‚</p></li><li><p>å¦‚æœä½ å·²ç»æœ‰ä¸€ä¸ªå¤§å‹çš„ Node.js é¡¹ç›®ï¼Œå¹¶ä¸”å†³å®šå°†å…¶è¿ç§»åˆ° ESMï¼Œè¿™ä¸ªé€‰é¡¹å…è®¸ä½ é€æ­¥è¿ç§»ã€‚ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨è¿™ä¸ªé€‰é¡¹å¿«é€Ÿæµ‹è¯•é¡¹ç›®ä¸­çš„æ¨¡å—æ˜¯å¦èƒ½ä½œä¸º ESM æ­£ç¡®å·¥ä½œï¼Œè€Œä¸å¿…ä¿®æ”¹å¤§é‡çš„æ–‡ä»¶æ‰©å±•åæˆ–è€… <code>package.json</code> æ–‡ä»¶ã€‚</p></li><li><p>å½“ä½ åœ¨æ•™è‚²ç¯å¢ƒæˆ–è€…ç¼–å†™ç¤ºä¾‹ä»£ç æ—¶ï¼Œå¯èƒ½å¸Œæœ›çœå»è§£é‡Šæ¨¡å—ç±»å‹å·®å¼‚çš„éº»çƒ¦ã€‚é€šè¿‡ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œä½ å¯ä»¥ä½¿å¾—æ‰€æœ‰ç¤ºä¾‹ä»£ç é»˜è®¤ä½¿ç”¨ ESMï¼Œä»è€Œä¿æŒä»£ç ç®€æ´ä¸€è‡´ã€‚</p></li></ol><h3 id="experimental-detect-module" tabindex="-1"><a class="header-anchor" href="#experimental-detect-module"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--experimental-detect-module" target="_blank" rel="noopener noreferrer">--experimental-detect-module</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚è€Œ Node.js çš„ä¸€å¤§ç‰¹æ€§å°±æ˜¯å…¶æ¨¡å—ç³»ç»Ÿã€‚åœ¨æ—©æœŸç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œä¸»è¦ä½¿ç”¨çš„æ˜¯ CommonJS æ¨¡å—è§„èŒƒï¼Œè€Œæœ€è¿‘å‡ å¹´ï¼Œéšç€ ES6 (ECMAScript 2015) çš„æ¨å¹¿ï¼ŒNode.js ä¹Ÿå¼€å§‹æ”¯æŒåŸç”Ÿçš„ ES æ¨¡å—ï¼ˆä¹Ÿç§°ä¸º ESMï¼‰ã€‚</p><p>åœ¨å¼•å…¥ ES æ¨¡å—çš„è¿‡ç¨‹ä¸­ï¼ŒNode.js é‡åˆ°äº†ä¸€ä¸ªæŒ‘æˆ˜ï¼šå¦‚ä½•åŒºåˆ†æ–‡ä»¶æ˜¯é‡‡ç”¨ CommonJS è¿˜æ˜¯ ES æ¨¡å—è§„èŒƒï¼Ÿå› ä¸ºä¸¤è€…æœ‰ä¸åŒçš„å¯¼å…¥å’Œå¯¼å‡ºæœºåˆ¶ã€‚ä¾‹å¦‚ï¼š</p><ul><li>CommonJS ä½¿ç”¨ <code>require()</code> å‡½æ•°æ¥å¯¼å…¥æ¨¡å—ï¼Œä½¿ç”¨ <code>module.exports</code> æˆ– <code>exports</code> å¯¹è±¡æ¥å¯¼å‡ºã€‚</li><li>ES æ¨¡å—ä½¿ç”¨ <code>import</code> å’Œ <code>export</code> è¯­å¥æ¥å¤„ç†æ¨¡å—çš„å¯¼å…¥å¯¼å‡ºã€‚</li></ul><p>ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒNode.js æä¾›äº†ä¸€ä¸ªå®éªŒæ€§çš„ CLI å‚æ•° <code>--experimental-detect-module</code>ã€‚å½“ä½ åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ Node.js è„šæœ¬æ—¶ï¼Œå¦‚æœåŠ ä¸Šè¿™ä¸ªå‚æ•°ï¼ŒNode.js å°†ä¼šå°è¯•æ£€æµ‹ JavaScript æ–‡ä»¶æ˜¯ç”¨çš„å“ªç§æ¨¡å—ç³»ç»Ÿã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®é™…ä¾‹å­æ¥çœ‹çœ‹è¿™ä¸ªåŠŸèƒ½ï¼š</p><p>å‡è®¾ä½ æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯ CommonJS æ ¼å¼çš„ <code>commonjs-module.js</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// commonjs-module.js</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">exports</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  hello</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;world&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦ä¸€ä¸ªæ˜¯ ES æ¨¡å—æ ¼å¼çš„ <code>es-module.mjs</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// es-module.mjs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> hello</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;world&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„åˆ°æˆ‘ä»¬é€šå¸¸æŠŠ ES æ¨¡å—çš„æ–‡ä»¶æ‰©å±•åæŒ‡å®šä¸º <code>.mjs</code> æ¥æ˜ç¡®è¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ª ES æ¨¡å—ï¼ˆä½†è¿™ä¸æ˜¯å¼ºåˆ¶çš„ï¼Œåªæ˜¯ä¸€ç§çº¦å®šï¼‰ã€‚</p><p>ç°åœ¨ï¼Œå¦‚æœä½ æƒ³è¦è¿è¡Œä¸€ä¸ªå¯èƒ½ä¸ç¡®å®šæ˜¯å“ªç§æ¨¡å—ç±»å‹çš„æ–‡ä»¶ <code>unknown-module.js</code>ï¼Œä½ å¯ä»¥åœ¨ Node.js å‘½ä»¤åé¢æ·»åŠ  <code>--experimental-detect-module</code> å‚æ•°ï¼Œæ¯”å¦‚ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --experimental-detect-module</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> unknown-module.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Node.js å°†ä¼šåˆ†æ<code>unknown-module.js</code>æ–‡ä»¶çš„å†…å®¹ï¼Œå°è¯•æ ¹æ®å…¶è¯­æ³•åˆ¤æ–­å®ƒåˆ°åº•æ˜¯ CommonJS æ¨¡å—è¿˜æ˜¯ ES æ¨¡å—ã€‚</p><p>è®°ä½ï¼Œç”±äº <code>--experimental-detect-module</code> æ˜¯ä¸€ä¸ªå®éªŒæ€§åŠŸèƒ½ï¼ŒNode.js å®˜æ–¹å¹¶ä¸ä¿è¯å…¶åœ¨æœªæ¥ç‰ˆæœ¬ä¸­çš„ç¨³å®šæ€§å’Œå‘åå…¼å®¹æ€§ã€‚å®éªŒæ€§åŠŸèƒ½æ„å‘³ç€å®ƒä»¬å¯èƒ½åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­å‘ç”Ÿå˜åŒ–æˆ–è€…è¢«å®Œå…¨ç§»é™¤ã€‚å¦‚æœä½ æ­£åœ¨ç¼–å†™ç”Ÿäº§çº§åˆ«çš„åº”ç”¨ç¨‹åºï¼Œä¾èµ–æ­¤ç±»åŠŸèƒ½éœ€è°¨æ…è€ƒè™‘é£é™©ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>--experimental-detect-module</code> å‚æ•°ä½¿å¼€å‘è€…èƒ½å¤Ÿåœ¨æ‰§è¡Œè„šæœ¬æ—¶è®© Node.js è‡ªåŠ¨æ£€æµ‹æ¨¡å—ç±»å‹ï¼Œè¿™å¯¹äºç¼–å†™åŒ…å«ä¸åŒæ¨¡å—ç³»ç»Ÿçš„ä»£ç çš„é¡¹ç›®æˆ–è€…åœ¨è¿ç§»è€é¡¹ç›®è‡³æ–°æ¨¡å—ç³»ç»Ÿæ—¶éå¸¸æœ‰å¸®åŠ©ã€‚ç„¶è€Œï¼Œé‰´äºå®ƒçš„å®éªŒæ€§è´¨ï¼Œå»ºè®®åœ¨å¿…è¦æ—¶æ‰ä½¿ç”¨ï¼Œå¹¶ä¸”å¯†åˆ‡å…³æ³¨ Node.js çš„æœªæ¥æ›´æ–°ä»¥é¿å…å¯èƒ½çš„å…¼å®¹æ€§é—®é¢˜ã€‚</p><h3 id="experimental-import-meta-resolve" tabindex="-1"><a class="header-anchor" href="#experimental-import-meta-resolve"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--experimental-import-meta-resolve" target="_blank" rel="noopener noreferrer">--experimental-import-meta-resolve</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>--experimental-import-meta-resolve</code>æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼ˆCLI flagï¼‰ï¼Œç”¨äºå¯ç”¨ä¸€ä¸ªå®éªŒæ€§åŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½å…è®¸å¼€å‘è€…åœ¨ä½¿ç”¨ ES æ¨¡å—æ—¶æ›´çµæ´»åœ°è§£ææ¨¡å—è·¯å¾„ã€‚</p><p>é¦–å…ˆï¼Œè¦ç†è§£è¿™ä¸ªé€‰é¡¹çš„ä½œç”¨ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸¤ä¸ªä¸œè¥¿ï¼šES æ¨¡å—å’Œ<code>import.meta</code>å¯¹è±¡ã€‚</p><p><strong>ES æ¨¡å—</strong>: ECMAScript æ¨¡å—ï¼ˆES æ¨¡å—ï¼‰æ˜¯ JavaScript å®˜æ–¹çš„æ ‡å‡†æ¨¡å—ç³»ç»Ÿï¼Œå…è®¸å¼€å‘è€…ä½¿ç”¨<code>import</code>å’Œ<code>export</code>å…³é”®å­—æ¥å¯¼å…¥å’Œè¾“å‡ºæ¨¡å—ã€‚æ¯”å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// math.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">x</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">y</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> x</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> y</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// main.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;./math.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>main.js</code>å¯¼å…¥äº†<code>math.js</code>æ–‡ä»¶ä¸­çš„<code>add</code>å‡½æ•°ã€‚</p><p><strong>import.meta</strong>: åœ¨ ES æ¨¡å—ä¸­ï¼Œ<code>import.meta</code>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œå®ƒæä¾›äº†å½“å‰æ¨¡å—ç›¸å…³çš„ä¿¡æ¯ã€‚é€šå¸¸ï¼Œå®ƒè‡³å°‘åŒ…å«<code>url</code>å±æ€§ï¼Œè¡¨ç¤ºå½“å‰æ¨¡å—æ–‡ä»¶çš„ URLã€‚</p><p>åœ¨ Node.js çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ æƒ³åŠ¨æ€åœ°åŠ è½½æ¨¡å—æˆ–è§£ææ¨¡å—è·¯å¾„ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸€äº›é™åˆ¶ã€‚<code>--experimental-import-meta-resolve</code>è¿™ä¸ªé€‰é¡¹å°±æ˜¯ä¸ºäº†è§£å†³è¿™äº›é™åˆ¶ã€‚</p><p>å½“ä½¿ç”¨<code>--experimental-import-meta-resolve</code>é€‰é¡¹æ—¶ï¼Œ<code>import.meta</code>å¯¹è±¡è·å¾—äº†ä¸€ä¸ªæ–°çš„æ–¹æ³•å«åš<code>resolve</code>ã€‚åˆ©ç”¨è¿™ä¸ª<code>resolve</code>æ–¹æ³•ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªæ¨¡å—æ–‡ä»¶çš„å®Œæ•´ URL è·¯å¾„ï¼Œå³ä½¿æ˜¯åœ¨åŠ¨æ€è®¡ç®—æ¨¡å—è·¯å¾„æ—¶ä¹ŸåŒæ ·å·¥ä½œã€‚è¿™å¯¹äºåŠ¨æ€å¯¼å…¥å’Œå¤„ç†æ¨¡å—è·¯å¾„ç‰¹åˆ«æœ‰ç”¨ã€‚</p><p>æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><p>æ²¡æœ‰å¯ç”¨<code>--experimental-import-meta-resolve</code>ä¹‹å‰ï¼Œå¦‚æœä½ æƒ³åŠ¨æ€åœ°å¯¼å…¥ä¸€ä¸ªæ¨¡å—ï¼Œå¯èƒ½ä¼šè¿™ä¹ˆå†™ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> moduleName</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;./module-&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ ¹æ®å‚æ•°åŠ¨æ€ç”Ÿæˆæ¨¡å—å</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">moduleName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä½¿ç”¨module</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ï¼Œç”¨è¿™ç§æ–¹å¼å¹¶ä¸èƒ½ä¿è¯<code>moduleName</code>ä¸€å®šèƒ½è¢«æ­£ç¡®è§£æï¼Œå°¤å…¶æ˜¯æ¶‰åŠåˆ°å¤æ‚çš„ç›®å½•ç»“æ„æˆ–è€…é“¾æ¥æ¨¡å—çš„æƒ…å†µã€‚</p><p>å¼€å¯<code>--experimental-import-meta-resolve</code>åï¼Œä»£ç å¯ä»¥æ”¹å†™ä¸ºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> moduleSpecifier</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;./module-&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨¡å—æ ‡è¯†ç¬¦</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">moduleSpecifier</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">resolvedPath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  import</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">resolvedPath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ä½¿ç”¨module</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œï¼Œ<code>import.meta.resolve(moduleSpecifier)</code>å°†ä¼šè¿”å›ä¸€ä¸ª Promiseï¼Œå®ƒè§£æå‡ºå®Œæ•´çš„æ¨¡å—è·¯å¾„ã€‚ç„¶åä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªè·¯å¾„å»åŠ¨æ€åœ°å¯¼å…¥ç›®æ ‡æ¨¡å—ã€‚</p><p>è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œæ— è®ºä½ çš„æ¨¡å—åœ¨ä½•ç§å¤æ‚çš„ç›®å½•ç»“æ„ä¸­ï¼Œ<code>resolve</code>æ–¹æ³•éƒ½èƒ½å¸®åŠ©ä½ æ‰¾åˆ°æ­£ç¡®çš„è·¯å¾„ã€‚</p><p>è¯·è®°ä½ï¼Œç”±äºè¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§è´¨çš„åŠŸèƒ½ï¼Œåœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­å®ƒå¯èƒ½ä¼šå˜åŒ–æˆ–è¢«æ­£å¼é‡‡çº³ï¼ˆç§»é™¤å®éªŒæ€§æ ‡ç­¾ï¼‰ã€‚ä½¿ç”¨å®éªŒæ€§åŠŸèƒ½æ—¶åº”è°¨æ…ï¼Œå› ä¸ºå®ƒä»¬ä¸ä¿è¯ç¨³å®šæ€§å’Œå‘åå…¼å®¹æ€§ã€‚</p><h3 id="experimental-loader-module" tabindex="-1"><a class="header-anchor" href="#experimental-loader-module"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--experimental-loadermodule" target="_blank" rel="noopener noreferrer">--experimental-loader=module</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚Node.js å…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ï¼Œå®ƒå…·æœ‰éé˜»å¡ I/O å’Œäº‹ä»¶é©±åŠ¨çš„ç‰¹æ€§ï¼Œä½¿å…¶é€‚åˆæ„å»ºé«˜æ€§èƒ½çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚</p><p>åœ¨ Node.js v21.7.1 çš„ç‰ˆæœ¬ä¸­ï¼Œ<code>--experimental-loader=module</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒå…è®¸ä½ æŒ‡å®šè‡ªå®šä¹‰çš„æ¨¡å—åŠ è½½å™¨ã€‚è¿™ä¸ªé€‰é¡¹è¢«æ ‡è®°ä¸ºå®éªŒæ€§çš„ï¼Œæ„å‘³ç€å®ƒå°šä¸ç¨³å®šï¼ŒAPI åœ¨æœªæ¥ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨è¿™ä¸ªç‰¹æ€§æ—¶éœ€è¦æ ¼å¤–å°å¿ƒã€‚</p><p>æ¨¡å—åŠ è½½å™¨æœ¬è´¨ä¸Šæ˜¯ä¸€ç§æœºåˆ¶ï¼Œå®ƒå®šä¹‰äº†å¦‚ä½•è§£ææ¨¡å—çš„ä½ç½®ã€å¦‚ä½•ä¸‹è½½æ¨¡å—ä»¥åŠå¦‚ä½•ç¼–è¯‘å’Œæ‰§è¡Œæ¨¡å—çš„ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œé»˜è®¤çš„æ¨¡å—åŠ è½½å™¨æ˜¯å†…ç½®çš„ï¼Œå¤„ç†ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½ CommonJS æˆ–è€… ES æ¨¡å—ã€‚</p><p>ä½¿ç”¨ <code>--experimental-loader</code> é€‰é¡¹ï¼Œä½ å¯ä»¥æä¾›ä¸€ä¸ªè‡ªå®šä¹‰çš„åŠ è½½å™¨æ¨¡å—ï¼Œè¿™ä¸ªåŠ è½½å™¨å¯ä»¥æ”¹å˜æˆ–å¢å¼ºé»˜è®¤çš„åŠ è½½è¡Œä¸ºã€‚æ¯”å¦‚è¯´ï¼Œä½ å¯èƒ½æƒ³è¦è½¬æ¢æ¨¡å—çš„æºä»£ç ã€æ·»åŠ é¢å¤–çš„è°ƒè¯•ä¿¡æ¯ï¼Œæˆ–è€…æ˜¯å¼•å…¥æ–°çš„æ–‡ä»¶ç±»å‹ä½œä¸ºæ¨¡å—ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><p>å‡è®¾ä½ æƒ³è¦åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰åŠ è½½å™¨ï¼Œå®ƒåœ¨åŠ è½½æ¯ä¸ªæ¨¡å—å‰éƒ½æ‰“å°å‡ºæ¨¡å—åã€‚é¦–å…ˆï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ª JavaScript æ–‡ä»¶ï¼ˆæ¯”å¦‚å« <code>custom-loader.mjs</code>ï¼‰ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­å®šä¹‰ä½ çš„åŠ è½½å™¨é€»è¾‘ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// custom-loader.mjs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> load</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">defaultLoad</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Loading </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è°ƒç”¨é»˜è®¤çš„åŠ è½½æœºåˆ¶æ¥å®é™…åŠ è½½æ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> defaultLoad</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">context</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">defaultLoad</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼å¯åŠ¨ä½ çš„ Node.js åº”ç”¨ç¨‹åºå¹¶ä¼ å…¥ä½ çš„è‡ªå®šä¹‰åŠ è½½å™¨ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --experimental-loader=./custom-loader.mjs</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å½“ä½ è¿è¡Œç¨‹åºæ—¶ï¼Œä½ ä¼šçœ‹åˆ°æ¯æ¬¡æ¨¡å—è¢«åŠ è½½æ—¶ï¼Œæ§åˆ¶å°ä¼šè¾“å‡ºç›¸åº”çš„æ¨¡å—åï¼Œè¿™æ„å‘³ç€ä½ çš„è‡ªå®šä¹‰åŠ è½½å™¨æ­£åœ¨èµ·ä½œç”¨ã€‚</p><p>è¯·è®°ä½ï¼Œç”±äº <code>--experimental-loader</code> æ˜¯ä¸€ä¸ªå®éªŒæ€§ç‰¹æ€§ï¼Œä¸æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥ç‰ˆæœ¬çš„ Node.js ä¸­å¯èƒ½ä¼šæœ‰æ‰€æ”¹å˜ã€‚æ­¤å¤–ï¼Œè‡ªå®šä¹‰åŠ è½½å™¨çš„ç¼–å†™é€šå¸¸æ¯”è¾ƒå¤æ‚ï¼Œå¹¶ä¸”éœ€è¦æ·±å…¥ç†è§£ Node.js æ¨¡å—ç³»ç»Ÿçš„å·¥ä½œåŸç†ã€‚</p><h3 id="experimental-network-imports" tabindex="-1"><a class="header-anchor" href="#experimental-network-imports"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--experimental-network-imports" target="_blank" rel="noopener noreferrer">--experimental-network-imports</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…èƒ½å¤Ÿä½¿ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç ã€‚åœ¨ Node.js çš„æŸäº›ç‰ˆæœ¬ä¸­ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°å¸¦æœ‰ <code>--experimental</code> æ ‡ç­¾çš„åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€è¿™äº›ç‰¹æ€§æ˜¯å®éªŒæ€§çš„ï¼Œå¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å‘ç”Ÿå˜åŒ–ï¼Œæˆ–è€…è¢«ç§»é™¤ã€‚</p><p><code>--experimental-network-imports</code> æ˜¯ Node.js v21.7.1 ä¸­çš„ä¸€ä¸ªå®éªŒæ€§åŠŸèƒ½ã€‚è¿™ä¸ªç‰¹æ€§å…è®¸å¼€å‘è€…é€šè¿‡ç½‘ç»œ URL ç›´æ¥å¯¼å…¥ ES æ¨¡å—ã€‚åœ¨æ ‡å‡†çš„ Node.js ç”¨æ³•ä¸­ï¼Œä½ é€šå¸¸åªèƒ½é€šè¿‡æœ¬åœ°æ–‡ä»¶è·¯å¾„æ¥å¯¼å…¥æ¨¡å—ï¼Œå¦‚ä½¿ç”¨ <code>require</code> æˆ– <code>import</code> è¯­å¥ã€‚</p><p>å¼€å¯äº† <code>--experimental-network-imports</code> åŠŸèƒ½åï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> someLibrary</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;https://example.com/some-library.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™é‡Œæ˜¯ä¸€äº›ä¾‹å­å’Œè§£é‡Šè¯´æ˜ï¼š</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-1"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªä¾‹å­ï¼Œä¸€ä¸ªæ˜¯ä»è¿œç¨‹ CDN å¯¼å…¥ Lodash åº“ï¼Œå¦ä¸€ä¸ªæ˜¯ç›´æ¥ä» GitHub å¯¼å…¥ä¸€ä¸ªå°å‹çš„ JavaScript æ¨¡å—ã€‚</p><h4 id="ä»-cdn-å¯¼å…¥-lodash" tabindex="-1"><a class="header-anchor" href="#ä»-cdn-å¯¼å…¥-lodash"><span>ä» CDN å¯¼å…¥ Lodash</span></a></h4><p>Lodash æ˜¯ä¸€ä¸ªè‘—åçš„ JavaScript å®ç”¨å·¥å…·åº“ã€‚å‡è®¾ä½ éœ€è¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Lodashï¼Œå¹¶ä¸”æƒ³è¦é€šè¿‡ CDN ç›´æ¥å¯¼å…¥å®ƒã€‚</p><p>ä¸ä½¿ç”¨ <code>--experimental-network-imports</code> æ—¶ï¼Œä½ å¯èƒ½ä¼šå…ˆä¸‹è½½ Lodash åˆ°æœ¬åœ° <code>node_modules</code> æ–‡ä»¶å¤¹ï¼Œç„¶ååƒè¿™æ ·å¯¼å…¥ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> _</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;lodash&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æˆ–è€…</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> _</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;lodash&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä½†å¦‚æœä½ ä½¿ç”¨ <code>--experimental-network-imports</code> å¹¶ä¸”å¯åŠ¨ Node.js æ—¶æ·»åŠ äº†è¿™ä¸ªæ ‡å¿—ï¼Œä½ å¯ä»¥ç›´æ¥é€šè¿‡ç½‘ç»œ URL æ¥å¯¼å…¥ Lodashï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> _</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;https://cdn.jsdelivr.net/npm/lodash/lodash.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="ä»-github-å¯¼å…¥æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#ä»-github-å¯¼å…¥æ¨¡å—"><span>ä» GitHub å¯¼å…¥æ¨¡å—</span></a></h4><p>å‡è®¾æœ‰ä¸€ä¸ªç®€å•çš„ JavaScript æ¨¡å—æ‰˜ç®¡åœ¨ GitHub ä¸Šï¼Œä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// URL: https://raw.githubusercontent.com/user/project/main/module.js</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sayHello</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `Hello, </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">!`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥å¯¼å…¥å¹¶ä¸”ä½¿ç”¨è¿™ä¸ªæ¨¡å—ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">sayHello</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;https://raw.githubusercontent.com/user/project/main/module.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sayHello</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;World&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼šHello, World!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ³¨æ„äº‹é¡¹-1" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-1"><span>æ³¨æ„äº‹é¡¹</span></a></h3><ul><li>å®éªŒæ€§ç‰¹æ€§å¹¶ä¸ç¨³å®šã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è°¨æ…ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šæ”¹å˜æˆ–åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚</li><li>ä½¿ç”¨ç½‘ç»œèµ„æºæ„å‘³ç€åœ¨è¿è¡Œç¨‹åºæ—¶éœ€è¦å¯é çš„ç½‘ç»œè¿æ¥ï¼Œå¹¶ä¸”ä¼šå¢åŠ ç¨‹åºå¯åŠ¨æ—¶é—´ï¼Œå› ä¸ºå¿…é¡»ç­‰å¾…ç½‘ç»œè¯·æ±‚å®Œæˆã€‚</li><li>ç½‘ç»œèµ„æºå¿…é¡»ç»è¿‡é€‚å½“è®¾ç½®ä»¥æ”¯æŒè·¨æºèµ„æºå…±äº«ï¼ˆCORSï¼‰ï¼Œå¦åˆ™å¯èƒ½æ— æ³•æ­£å¸¸å¯¼å…¥ã€‚</li><li>ç½‘ç»œå¯¼å…¥å¯èƒ½ä¼šå¸¦æ¥å®‰å…¨é£é™©ï¼Œå› ä¸ºå¦‚æœ URL æŒ‡å‘çš„èµ„æºè¢«æ¶æ„ä¿®æ”¹ï¼Œå¯èƒ½ä¼šå¯¹åº”ç”¨ç¨‹åºé€ æˆå¨èƒã€‚</li></ul><p>ä½¿ç”¨ <code>--experimental-network-imports</code> å¯èƒ½æ˜¯ä¸€ç§ä¾¿æ·çš„å°è¯•æ–°åº“æˆ–å¿«é€ŸåŸå‹å¼€å‘çš„æ–¹æ³•ï¼Œä½†å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®å°†ä¾èµ–é¡¹ä¿å­˜åœ¨æœ¬åœ°æˆ–ç§æœ‰æœåŠ¡å™¨ä¸Šï¼Œä»¥ç¡®ä¿ç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚</p><h3 id="experimental-permission" tabindex="-1"><a class="header-anchor" href="#experimental-permission"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--experimental-permission" target="_blank" rel="noopener noreferrer">--experimental-permission</a></span></a></h3><p>Node.js ä¸­çš„ <code>--experimental-permission</code> æ ‡å¿—æ˜¯ç”¨æ¥æ§åˆ¶å’Œé™åˆ¶ Node.js åº”ç”¨ç¨‹åºè®¿é—®ç³»ç»Ÿèµ„æºçš„ä¸€ä¸ªå®éªŒæ€§åŠŸèƒ½ã€‚è¿™ä¸ªåŠŸèƒ½è®©ä½ èƒ½å¤Ÿæ›´ç²¾ç»†åœ°ç®¡ç†ä¸€ä¸ª Node.js ç¨‹åºèƒ½å¤Ÿåšä»€ä¹ˆï¼Œæ¯”å¦‚å®ƒæ˜¯å¦å¯ä»¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œè¯·æ±‚ç­‰ã€‚å› ä¸ºè¿™ä¸ªåŠŸèƒ½åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­æ ‡è®°ä¸ºå®éªŒæ€§çš„ï¼Œæ‰€ä»¥å®ƒå¯èƒ½åœ¨æœªæ¥ç‰ˆæœ¬ä¸­ä¼šæœ‰å˜åŠ¨ã€‚</p><p>ä½¿ç”¨ <code>--experimental-permission</code> çš„æ—¶å€™ï¼Œä½ éœ€è¦æŒ‡å®šç‰¹å®šçš„æƒé™ï¼Œå¹¶ä¸”å‘Šè¯‰ Node.js è¿™ä¸ªç¨‹åºå¯ä»¥ä½¿ç”¨å“ªäº›èµ„æºã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥å‡å°‘å®‰å…¨é£é™©ï¼Œå› ä¸ºä½ å¯ä»¥é™åˆ¶ç¨‹åºåªèƒ½è®¿é—®å®ƒéœ€è¦çš„èµ„æºï¼Œè€Œä¸èƒ½éšæ„è®¿é—®ç³»ç»Ÿçš„å…¶ä»–éƒ¨åˆ†ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡å‡ ä¸ªä¾‹å­æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ <code>--experimental-permission</code>:</p><ol><li><p><strong>è¯»å–æ–‡ä»¶</strong> - å‡è®¾ä½ æœ‰ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œåªéœ€è¦ä» <code>/etc/config.json</code> æ–‡ä»¶ä¸­è¯»å–é…ç½®ä¿¡æ¯ã€‚ä½ å¯ä»¥åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºçš„æ—¶å€™è¿™æ ·æŒ‡å®šæƒé™ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --experimental-permissions=fs.read:/etc/config.json</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œå³ä½¿ä½ çš„ç¨‹åºé‡Œæœ‰ä»£ç å°è¯•å»è¯»å–æˆ–å†™å…¥å…¶ä»–æ–‡ä»¶ï¼Œå› ä¸ºä½ æ²¡æœ‰èµ‹äºˆç›¸åº”çš„æƒé™ï¼Œè¿™äº›æ“ä½œéƒ½ä¼šå¤±è´¥ã€‚</p></li><li><p><strong>ç½‘ç»œè¯·æ±‚</strong> - å¦‚æœä½ çš„åº”ç”¨ç¨‹åºéœ€è¦ä¸å¤–éƒ¨ API äº¤äº’ï¼ˆä¾‹å¦‚è°ƒç”¨ <code>https://api.example.com</code>ï¼‰ï¼Œä½†ä¸åº”è¯¥è®¿é—®å…¶ä»–ç½‘å€ï¼Œä½ å¯ä»¥è¿™æ ·è®¾ç½®ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --experimental-permissions=net:https://api.example.com</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä½¿ç”¨è¿™ä¸ªå‘½ä»¤è¡Œå‚æ•°åï¼Œç¨‹åºå°†åªèƒ½å¯¹ <code>https://api.example.com</code> å‘èµ·ç½‘ç»œè¯·æ±‚ã€‚å¦‚æœå°è¯•è¯·æ±‚å…¶ä»–åœ°å€ï¼Œå°†ä¼šè¢«æ‹’ç»ã€‚</p></li></ol><p>æ³¨æ„ï¼šå› ä¸ºè¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§åŠŸèƒ½ï¼Œæ‰€ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è°¨æ…ä½¿ç”¨ã€‚æ­¤å¤–ï¼Œæ ¹æ®ä½ æ­£åœ¨ä½¿ç”¨çš„ Node.js ç‰ˆæœ¬çš„æ–‡æ¡£ï¼Œå¯èƒ½ä¼šæœ‰æŸäº›å…·ä½“çš„å¥æ³•ä¸Šçš„å·®å¼‚ï¼Œæ‰€ä»¥æœ€å¥½æŸ¥é˜…ç›¸å…³çš„å®˜æ–¹æ–‡æ¡£äº†è§£æœ€æ–°çš„ä½¿ç”¨æ–¹æ³•å’Œæ”¯æŒçš„æƒé™åˆ—è¡¨ã€‚å®éªŒæ€§ç‰¹æ€§å¾ˆå¯èƒ½ä¼šå‘ç”Ÿæ”¹å˜ï¼Œå› æ­¤è·Ÿè¿›æœ€æ–°çš„ Node.js æ›´æ–°éå¸¸é‡è¦ã€‚</p><h3 id="experimental-policy" tabindex="-1"><a class="header-anchor" href="#experimental-policy"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--experimental-policy" target="_blank" rel="noopener noreferrer">--experimental-policy</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘ä¼šè¯¦ç»†è§£é‡Šè¿™ä¸ªé€‰é¡¹ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>--experimental-policy</code> æ˜¯ä¸€ä¸ªå®éªŒæ€§åŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨ä¸€ä¸ªåä¸ºâ€œç­–ç•¥æ–‡ä»¶â€çš„ JSON æ–‡ä»¶æ¥å®šä¹‰ä¸€äº›å®‰å…¨ç­–ç•¥ã€‚è¿™äº›å®‰å…¨ç­–ç•¥ä¸»è¦ç”¨äºé™åˆ¶æˆ–è€…è§„å®šåœ¨ Node.js åº”ç”¨ä¸­å¯ä»¥åŠ è½½å“ªäº›èµ„æºï¼Œç‰¹åˆ«æ˜¯æŒ‡æ˜å“ªäº› JavaScript æ¨¡å—å’ŒåŒ…æ˜¯å…è®¸è¢«å¯¼å…¥çš„ã€‚</p><p>ä½¿ç”¨ <code>--experimental-policy</code> å‚æ•°å¯åŠ¨ Node.js ç¨‹åºæ—¶ï¼Œä½ éœ€è¦æä¾›ä¸€ä¸ªç­–ç•¥æ–‡ä»¶çš„è·¯å¾„ã€‚è¿™ä¸ªç­–ç•¥æ–‡ä»¶åŒ…å«äº†ä½ æƒ³è¦å¼ºåˆ¶å®è¡Œçš„å®‰å…¨ç­–ç•¥ã€‚</p><p>ä¸‹é¢ä¸¾å‡ ä¸ªä¾‹å­æ¥è¯´æ˜ <code>--experimental-policy</code> çš„å®é™…ç”¨æ³•ï¼š</p><p><strong>ä¾‹å­ 1ï¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„ç­–ç•¥æ–‡ä»¶</strong></p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º <code>policy.json</code> çš„ç­–ç•¥æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;resources&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;./node_modules/some-library/index.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">      &quot;integrity&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sha384-oqVuAfXRKap7fdgcCY5uykM6+R9GR2GhlGBFsP7sgt9/DKpTJ3Cn0FfuVjzRzoA=&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªç­–ç•¥æ–‡ä»¶æŒ‡å®šäº† <code>some-library</code> åŒ…çš„ <code>index.js</code> æ–‡ä»¶å¿…é¡»åŒ¹é…ç»™å®šçš„å®Œæ•´æ€§å“ˆå¸Œå€¼ã€‚å¦‚æœæ–‡ä»¶çš„å†…å®¹å‘ç”Ÿäº†å˜åŒ–ï¼Œæˆ–è€…ä¸åŒ¹é…è¿™ä¸ªå“ˆå¸Œå€¼ï¼ŒNode.js å°†ä¼šæ‹’ç»åŠ è½½å®ƒã€‚</p><p><strong>ä¾‹å­ 2ï¼šå¯åŠ¨ Node.js åº”ç”¨å¹¶åº”ç”¨ç­–ç•¥æ–‡ä»¶</strong></p><p>å½“ä½ æœ‰äº†ç­–ç•¥æ–‡ä»¶åï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ä½ çš„ Node.js åº”ç”¨ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --experimental-policy=policy.json</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤å‘Šè¯‰ Node.js åœ¨è¿è¡Œ <code>your-app.js</code> è¿™ä¸ªåº”ç”¨ä¹‹å‰å…ˆè¯»å–å¹¶åº”ç”¨ <code>policy.json</code> æ–‡ä»¶ä¸­å®šä¹‰çš„ç­–ç•¥ã€‚</p><p>æ³¨æ„ç”±äºè¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§åŠŸèƒ½ï¼Œå®ƒå¯èƒ½ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œæ”¹å˜æˆ–è€…åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«å–æ¶ˆã€‚å› æ­¤ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è°¨æ…ä½¿ç”¨ï¼Œå¹¶ä¸”éšæ—¶å…³æ³¨ Node.js å®˜æ–¹æ–‡æ¡£ä¸­å…³äºæ­¤åŠŸèƒ½çš„æœ€æ–°æ›´æ–°ã€‚</p><p>ç›®å‰ï¼Œä½¿ç”¨ç­–ç•¥æ–‡ä»¶å¯ä»¥æé«˜åº”ç”¨çš„å®‰å…¨æ€§ï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©é˜²æ­¢æ¶æ„ä»£ç çš„æ³¨å…¥ï¼Œç¡®ä¿åªæœ‰ç»è¿‡éªŒè¯å¹¶ä¸”ç¬¦åˆç­–ç•¥è§„å®šçš„ä»£ç æ‰èƒ½è¢«æ‰§è¡Œã€‚ä¸è¿‡ï¼Œç”±äºå®ƒè¿˜å¤„äºå®éªŒé˜¶æ®µï¼Œå¼€å‘è€…å¯èƒ½éœ€è¦å¯¹è¿™ä¸ªç‰¹æ€§è¿›è¡Œé¢å¤–çš„æµ‹è¯•ä»¥ç¡®ä¿å®ƒçš„ç¨³å®šæ€§å’Œé€‚ç”¨æ€§ã€‚</p><h3 id="experimental-sea-config" tabindex="-1"><a class="header-anchor" href="#experimental-sea-config"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--experimental-sea-config" target="_blank" rel="noopener noreferrer">--experimental-sea-config</a></span></a></h3><p><code>--experimental-sea-config</code> æ˜¯ä¸€ä¸ª Node.js çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼ˆä¹Ÿç§°ä¸º CLI flagï¼‰ï¼Œå®ƒå…è®¸ä½ åœ¨å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨å®éªŒæ€§çš„ Self-Encapsulated Archive(SEA) é…ç½®ã€‚ç”±äºè¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§åŠŸèƒ½ï¼Œæ„å‘³ç€å®ƒå¯èƒ½ä¼šåœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­å‘ç”Ÿå˜åŒ–æˆ–è¢«å¼ƒç”¨ï¼Œå¹¶ä¸”å¯èƒ½ä¸æ˜¯å®Œå…¨ç¨³å®šçš„ã€‚</p><p>Self-Encapsulated Archive (SEA) æ˜¯ä¸€ç§å¯ä»¥è®©ä½ å°†åº”ç”¨ç¨‹åºå’Œå®ƒçš„ä¾èµ–æ‰“åŒ…æˆå•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„æŠ€æœ¯ã€‚è¿™ç±»ä¼¼äºå°†æ‰€æœ‰å¿…éœ€çš„ä»£ç å’Œèµ„æºåŒ…è£…åˆ°ä¸€ä¸ªå®¹å™¨å†…ï¼Œä½¿å¾—éƒ¨ç½²å’Œåˆ†å‘å˜å¾—æ›´åŠ ç®€å•å’Œä¸€è‡´ï¼Œå› ä¸ºä½ åªéœ€è¦å¤„ç†ä¸€ä¸ªæ–‡ä»¶ã€‚</p><p>è¦åœ¨ Node.js v21.7.1 ä¸­å¯ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œä½ éœ€è¦åœ¨å¯åŠ¨ä½ çš„ Node.js åº”ç”¨ç¨‹åºæ—¶æ·»åŠ  <code>--experimental-sea-config</code> é€‰é¡¹ã€‚è¯·æ³¨æ„ï¼Œç”±äºè¿™æ˜¯å®éªŒæ€§ç‰¹æ€§ï¼Œå®ƒå¹¶æ²¡æœ‰å¹¿æ³›çš„æ–‡æ¡£æ”¯æŒï¼Œå¹¶ä¸”åœ¨æ­£å¼ç¯å¢ƒä¸­ä½¿ç”¨æ—¶åº”è°¨æ…ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªå‡è®¾çš„ä¾‹å­ï¼š</p><h3 id="å®ä¾‹-1-å¯ç”¨-sea-åŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-1-å¯ç”¨-sea-åŠŸèƒ½"><span>å®ä¾‹ 1ï¼šå¯ç”¨ SEA åŠŸèƒ½</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --experimental-sea-config</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªå«åš <code>app.js</code> çš„ Node.js æ–‡ä»¶ã€‚é€šè¿‡æ·»åŠ  <code>--experimental-sea-config</code> å‚æ•°ï¼Œä½ å‘Šè¯‰ Node.js åœ¨å¯åŠ¨æ—¶å°è¯•ä½¿ç”¨ SEA é…ç½®ã€‚</p><h3 id="å®ä¾‹-2-å°†åº”ç”¨ç¨‹åºæ‰“åŒ…ä¸º-sea-æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-2-å°†åº”ç”¨ç¨‹åºæ‰“åŒ…ä¸º-sea-æ–‡ä»¶"><span>å®ä¾‹ 2ï¼šå°†åº”ç”¨ç¨‹åºæ‰“åŒ…ä¸º SEA æ–‡ä»¶</span></a></h3><p>è™½ç„¶ Node.js å®˜æ–¹æš‚æ—¶æ²¡æœ‰æä¾›ç›´æ¥çš„å‘½ä»¤æ¥åˆ›å»º SEA æ–‡ä»¶ï¼Œä½†æ˜¯å®é™…ä¸Šçš„ä½¿ç”¨å¯èƒ½åŒ…æ‹¬ç¬¬ä¸‰æ–¹å·¥å…·æˆ–è‡ªå®šä¹‰è„šæœ¬æ¥ç”Ÿæˆä¸€ä¸ª SEA æ–‡ä»¶ã€‚ä»¥å®éªŒç‰¹æ€§çš„åä¹‰ï¼Œè¯¥è¿‡ç¨‹å¯èƒ½æ¶‰åŠåˆ°åƒä¸‹é¢è¿™æ ·çš„æ­¥éª¤ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## å‡è®¾å­˜åœ¨ä¸€ä¸ªç¬¬ä¸‰æ–¹å·¥å…· &#39;node-sea-packager&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node-sea-packager</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --entry</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --output</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.sea</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªå‡è®¾çš„å·¥å…· <code>node-sea-packager</code> å°†ä½ çš„ <code>app.js</code> å’Œå…¶ä¾èµ–æ‰“åŒ…æˆä¸€ä¸ªåä¸º <code>app.sea</code> çš„æ–‡ä»¶ã€‚</p><h3 id="å®ä¾‹-3-è¿è¡Œ-sea-æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-3-è¿è¡Œ-sea-æ–‡ä»¶"><span>å®ä¾‹ 3ï¼šè¿è¡Œ SEA æ–‡ä»¶</span></a></h3><p>å¦‚æœä½ å·²ç»æˆåŠŸåˆ›å»ºäº†ä¸€ä¸ª SEA æ–‡ä»¶ï¼Œä½ å¯èƒ½éœ€è¦è¿™æ ·è¿è¡Œå®ƒï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --experimental-sea-config</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.sea</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œï¼Œä½ å‘Šè¯‰ Node.js ä½¿ç”¨ <code>--experimental-sea-config</code> é€‰é¡¹æ¥è¿è¡Œ <code>app.sea</code> è¿™ä¸ªè‡ªå°é—­çš„å½’æ¡£æ–‡ä»¶ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œ<code>--experimental-sea-config</code> é€‰é¡¹å’Œä¸ä¹‹ç›¸å…³çš„ SEA åŠŸèƒ½æ˜¯ Node.js å®éªŒæ€§åœ°æ¢ç´¢å¦‚ä½•æ‰“åŒ…å’Œéƒ¨ç½² Node.js åº”ç”¨ç¨‹åºçš„ä¸€ç§æ–¹æ³•ã€‚è¿™ç§æ–¹å¼å¯èƒ½åœ¨å°†æ¥ä¸ºå¼€å‘è€…æä¾›ä¸€ç§æ–°çš„ç®€åŒ–éƒ¨ç½²æµç¨‹çš„æ–¹å¼ï¼Œä½†å› ä¸ºå®ƒè¿˜å¤„äºå®éªŒé˜¶æ®µï¼Œæ‰€ä»¥åœ¨å®é™…å¼€å‘ä¸­ä½¿ç”¨æ—¶è¦å°å¿ƒè°¨æ…ã€‚</p><h3 id="experimental-shadow-realm" tabindex="-1"><a class="header-anchor" href="#experimental-shadow-realm"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--experimental-shadow-realm" target="_blank" rel="noopener noreferrer">--experimental-shadow-realm</a></span></a></h3><p><code>--experimental-shadow-realm</code> æ˜¯ Node.js çš„ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨äºå¯ç”¨å®éªŒæ€§çš„ ShadowRealm åŠŸèƒ½ã€‚è¿™ä¸ªåŠŸèƒ½æ˜¯ ECMAScript (JavaScript çš„å®˜æ–¹æ ‡å‡†) çš„ä¸€ä¸ªææ¡ˆï¼Œç›®å‰è¿˜æ²¡æœ‰æ­£å¼æˆä¸ºæ ‡å‡†ï¼Œå› æ­¤åœ¨ Node.js ä¸­è¢«æ ‡è®°ä¸ºå®éªŒæ€§çš„ã€‚</p><h3 id="shadowrealm-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#shadowrealm-æ˜¯ä»€ä¹ˆ"><span>ShadowRealm æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>ShadowRealm æä¾›äº†ä¸€ç§åˆ›å»ºéš”ç¦»çš„æ‰§è¡Œç¯å¢ƒï¼ˆç§°ä¸ºâ€œå½±å­é¢†åŸŸâ€æˆ–â€œShadow Realmsâ€ï¼‰çš„èƒ½åŠ›ã€‚åœ¨è¿™ä¸ªç¯å¢ƒä¸­ï¼Œä½ å¯ä»¥è¿è¡Œ JavaScript ä»£ç ï¼Œè€Œè¿™äº›ä»£ç ä¼šä¸å…¶å®ƒä»£ç ï¼ˆæ¯”å¦‚ä¸»åº”ç”¨ç¨‹åºçš„ä»£ç ï¼‰å®Œå…¨éš”ç¦»ï¼Œæœ‰ç‚¹åƒæ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ²™ç®±ã€‚è¿è¡Œåœ¨ ShadowRealm ä¸­çš„ä»£ç æ‹¥æœ‰è‡ªå·±çš„å…¨å±€ä½œç”¨åŸŸï¼Œå¹¶ä¸”ä¸èƒ½ç›´æ¥è®¿é—®å¤–éƒ¨ä½œç”¨åŸŸçš„å¯¹è±¡å’Œå˜é‡ã€‚</p><p>è¿™æœ‰å‡ ä¸ªå¥½å¤„ï¼š</p><ol><li><strong>å®‰å…¨æ€§</strong>ï¼šç”±äºä»£ç æ˜¯éš”ç¦»çš„ï¼Œæ‰€ä»¥å³ä½¿æ˜¯ä¸ä¿¡ä»»çš„ä»£ç ï¼Œåœ¨ ShadowRealm ä¸­è¿è¡Œä¹Ÿæ›´åŠ å®‰å…¨ï¼Œå› ä¸ºå®ƒä¸èƒ½è®¿é—®æˆ–ä¿®æ”¹å¤–éƒ¨ç¯å¢ƒã€‚</li><li><strong>å°è£…æ€§</strong>ï¼šä½ å¯ä»¥åœ¨ ShadowRealm ä¸­åŠ è½½å’Œæ‰§è¡Œæ¨¡å—æˆ–è€…è„šæœ¬ï¼Œè€Œä¸å¿…æ‹…å¿ƒå®ƒä»¬ä¼šæ±¡æŸ“å…¶ä»–çš„å…¨å±€ä½œç”¨åŸŸã€‚</li><li><strong>é¿å…å†²çª</strong>ï¼šåœ¨æ’ä»¶ç³»ç»Ÿæˆ–ç±»ä¼¼çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥é˜²æ­¢ä¸åŒæ’ä»¶ä¹‹é—´çš„å…¨å±€å˜é‡æˆ–å‡½æ•°å†²çªã€‚</li></ol><h3 id="å¦‚ä½•ä½¿ç”¨-experimental-shadow-realm" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-experimental-shadow-realm"><span>å¦‚ä½•ä½¿ç”¨ <code>--experimental-shadow-realm</code></span></a></h3><p>å› ä¸º ShadowRealm æ˜¯ä¸€ä¸ªå®éªŒæ€§ç‰¹æ€§ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ Node.js å¯åŠ¨æ—¶éœ€è¦åŠ ä¸Š <code>--experimental-shadow-realm</code> è¿™ä¸ªå‘½ä»¤è¡Œé€‰é¡¹æ¥æ˜¾å¼åœ°å¼€å¯è¯¥ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¦åœ¨ Node.js è„šæœ¬ä¸­ä½¿ç”¨ ShadowRealm APIï¼Œä½ å¯èƒ½éœ€è¦è¿™æ ·åšï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --experimental-shadow-realm</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™å‘Šè¯‰ Node.js åœ¨æ‰§è¡Œ <code>your-script.js</code> æ—¶å¯ç”¨ ShadowRealm åŠŸèƒ½ã€‚</p><h3 id="å®é™…ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬æƒ³è¦åœ¨ä¸€ä¸ªéš”ç¦»çš„ç¯å¢ƒä¸­è¿è¡Œä¸€äº›ä»£ç ï¼Œè¿™æ®µä»£ç å°†è®¡ç®—æ•°å­—çš„å¹³æ–¹å¹¶è¿”å›ç»“æœï¼Œä½†æˆ‘ä»¬ä¸æƒ³è¦è¿™æ®µä»£ç èƒ½è®¿é—®æˆ‘ä»¬çš„ä¸»åº”ç”¨ç¨‹åºçš„ä»»ä½•å˜é‡æˆ–ç¯å¢ƒã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é¦–å…ˆç¡®ä¿è„šæœ¬æ˜¯ä½¿ç”¨ --experimental-shadow-realm é€‰é¡¹å¯åŠ¨çš„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">ShadowRealm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> globalThis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ ShadowRealm å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> realm</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ShadowRealm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®šä¹‰æˆ‘ä»¬æƒ³åœ¨ ShadowRealm ä¸­è¿è¡Œçš„ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> codeInShadowRealm</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">function calculateSquare(number) {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  return number * number;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æˆ‘ä»¬å¯ä»¥å°†è¿™æ®µä»£ç ä½œä¸ºå­—ç¬¦ä¸²å¼•å…¥åˆ° ShadowRealm ä¸­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">realm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">evaluate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">codeInShadowRealm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨ ShadowRealm ä¸­è°ƒç”¨ `calculateSquare` å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> realm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">evaluate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;calculateSquare(2)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åº”è¯¥æ‰“å°å‡º 4ï¼Œå› ä¸º 2 çš„å¹³æ–¹æ˜¯ 4</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ³¨æ„ï¼ševaluate æ–¹æ³•è¿”å›çš„ç»“æœå¯ä»¥æ˜¯åŸºç¡€æ•°æ®ç±»å‹ï¼ˆå¦‚æ•°å­—ã€å­—ç¬¦ä¸²ç­‰ï¼‰ï¼Œä½†ä¸å…è®¸ç›´æ¥ä¼ é€’å¯¹è±¡ï¼Œå› ä¸ºè¿™ä¼šç ´åéš”ç¦»æ€§ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ³¨æ„ï¼Œå› ä¸º ShadowRealm ç‰¹æ€§ç›®å‰æ˜¯å®éªŒæ€§çš„ï¼ŒAPI å’Œè¡Œä¸ºæœªæ¥å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚åœ¨å®ƒæˆä¸ºæ­£å¼æ ‡å‡†ä¹‹å‰ï¼Œä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¤§é‡ä½¿ç”¨è¯¥ç‰¹æ€§ã€‚æ­¤å¤–ï¼Œåœ¨ä½¿ç”¨å®éªŒæ€§åŠŸèƒ½æ—¶éœ€è°¨æ…ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½åŒ…å«æœªçŸ¥çš„ç¼ºé™·æˆ–é™åˆ¶ã€‚</p><h3 id="experimental-test-coverage" tabindex="-1"><a class="header-anchor" href="#experimental-test-coverage"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--experimental-test-coverage" target="_blank" rel="noopener noreferrer">--experimental-test-coverage</a></span></a></h3><p>Node.js v21.7.1 ä¸­å¼•å…¥çš„<code>--experimental-test-coverage</code>æ˜¯ä¸€ä¸ªå®éªŒæ€§çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨äºç”Ÿæˆä½ åº”ç”¨ç¨‹åºä»£ç çš„æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šã€‚æµ‹è¯•è¦†ç›–ç‡æ˜¯ä¸€ç§åº¦é‡æ ‡å‡†ï¼Œç”¨æ¥è¡¡é‡ä½ çš„æµ‹è¯•æœ‰å¤šå°‘è¦†ç›–äº†ä½ çš„ä»£ç ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒå¯ä»¥å‘Šè¯‰ä½ å“ªäº›ä»£ç è¢«æµ‹è¯•äº†ï¼Œå“ªäº›æ²¡æœ‰ã€‚</p><p>åœ¨ç¼–å†™æµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æƒ³è¦ç¡®ä¿æ‰€æœ‰é‡è¦çš„ä»£ç è·¯å¾„éƒ½è¢«æ£€æŸ¥è¿‡ï¼Œä»¥é¿å…æ½œåœ¨çš„é”™è¯¯ã€‚æµ‹è¯•è¦†ç›–ç‡å·¥å…·å°±èƒ½å¸®åŠ©æˆ‘ä»¬å®ç°è¿™ä¸ªç›®æ ‡ã€‚å¦‚æœè¦†ç›–ç‡å¾ˆä½ï¼Œé‚£å¯èƒ½æ„å‘³ç€æˆ‘ä»¬çš„æµ‹è¯•ä¸å¤Ÿå……åˆ†ï¼Œæœ‰ä¸€äº›ä»£ç å¯èƒ½å°±æ²¡æœ‰è¢«æµ‹è¯•åˆ°ã€‚</p><p>ä½¿ç”¨<code>--experimental-test-coverage</code>é€‰é¡¹ï¼Œå½“ä½ è¿è¡Œ Node.js ç¨‹åºæ—¶ï¼ŒNode.js ä¼šè‡ªåŠ¨æ”¶é›†è¦†ç›–æ•°æ®ï¼Œå¹¶ä¸”åœ¨ç¨‹åºç»“æŸåç”Ÿæˆä¸€ä¸ªæŠ¥å‘Šã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡å‡ ä¸ªæ­¥éª¤æ¥çœ‹å¦‚ä½•ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ï¼š</p><ol><li><p><strong>ç¼–å†™ç¨‹åºæ–‡ä»¶</strong>ï¼šé¦–å…ˆï¼Œä½ éœ€è¦æœ‰ä¸€ä¸ª Node.js ç¨‹åºã€‚æ¯”å¦‚ä½ æœ‰ä¸€ä¸ªåä¸º<code>app.js</code>çš„æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«ä¸€äº›å‡½æ•°å’Œé€»è¾‘ã€‚</p></li><li><p><strong>ç¼–å†™æµ‹è¯•</strong>ï¼šåˆ›å»ºæµ‹è¯•æ–‡ä»¶æ¥æµ‹è¯•<code>app.js</code>ä¸­çš„å‡½æ•°ã€‚å‡è®¾ä½ çš„æµ‹è¯•æ–‡ä»¶åä¸º<code>test.js</code>ã€‚</p></li><li><p><strong>ä½¿èƒ½æµ‹è¯•è¦†ç›–ç‡</strong>ï¼šåœ¨ Node.js v21.7.1 æˆ–ä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡æ·»åŠ <code>--experimental-test-coverage</code>æ¥è¿è¡Œä½ çš„æµ‹è¯•ï¼Œå¹¶ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šã€‚ä½ å¯ä»¥åœ¨ç»ˆç«¯ä¸­è¿™æ ·è¿è¡Œå®ƒï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --experimental-test-coverage</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>æŸ¥çœ‹æŠ¥å‘Š</strong>ï¼šå½“æµ‹è¯•è¿è¡Œå®Œæˆåï¼ŒNode.js å°†è¾“å‡ºè¦†ç›–ç‡ä¿¡æ¯ï¼Œå¹¶ä¸”ä¼šç”Ÿæˆä¸€ä¸ª<code>.nyc_output</code>æ–‡ä»¶å¤¹å’Œä¸€ä¸ª<code>coverage</code>æ–‡ä»¶å¤¹ã€‚<code>.nyc_output</code>åŒ…å«åŸå§‹çš„è¦†ç›–ç‡æ•°æ®ï¼Œè€Œ<code>coverage</code>æ–‡ä»¶å¤¹é€šå¸¸åŒ…å«ä¸€ä¸ªæ ¼å¼åŒ–å¥½çš„ HTML æŠ¥å‘Šï¼Œä½ å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æŸ¥çœ‹ã€‚</p></li></ol><p>è¿™ä¸ªç‰¹æ€§æ­£å¤„äºå®éªŒé˜¶æ®µï¼Œå› æ­¤å®ƒè¿˜å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæœªæ¥ç‰ˆæœ¬çš„ Node.js å¯èƒ½ä¼šä¿®æ”¹æˆ–æ”¹è¿›è¿™ä¸ªåŠŸèƒ½ã€‚ç”±äºå®ƒæ˜¯å®éªŒæ€§çš„ï¼Œæ‰€ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¾èµ–å®ƒä¹‹å‰è¦è°¨æ…è€ƒè™‘ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸¤ä¸ªç®€å•çš„ä¾‹å­è¯´æ˜å¦‚ä½•ä½¿ç”¨<code>--experimental-test-coverage</code>ï¼š</p><p><strong>ä¾‹å­ 1ï¼šå•ä¸ªæ–‡ä»¶</strong><br> å‡è®¾ä½ æœ‰ä¸€ä¸ªç®€å•çš„æ¨¡å—<code>calculator.js</code>ï¼Œæä¾›åŠ æ³•å’Œå‡æ³•åŠŸèƒ½ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// calculator.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> subtract</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">exports</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">subtract</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> };</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½ çš„æµ‹è¯•æ–‡ä»¶<code>calculator.test.js</code>å¯èƒ½é•¿è¿™æ ·ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// calculator.test.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> calculator</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./calculator&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;add(2, 3) should be 5:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">assert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">calculator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;add function failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;subtract(5, 2) should be 3:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">assert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">calculator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">subtract</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;subtract function failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½ å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Šï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --experimental-test-coverage</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> calculator.test.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>ä¾‹å­ 2ï¼šä½¿ç”¨æµ‹è¯•æ¡†æ¶</strong><br> åœ¨ç°å®é¡¹ç›®ä¸­ï¼Œä½ é€šå¸¸ä¼šä½¿ç”¨ä¸“é—¨çš„æµ‹è¯•æ¡†æ¶ï¼Œæ¯”å¦‚ Mochaã€Jest ç­‰æ¥ç¼–å†™å’Œè¿è¡Œæµ‹è¯•ã€‚è¿è¡Œè¿™äº›æ¡†æ¶çš„å‘½ä»¤æ—¶ä¹Ÿå¯ä»¥æ­é…<code>--experimental-test-coverage</code>ã€‚ä¾‹å¦‚ï¼š</p><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Mochaï¼Œä½ çš„æµ‹è¯•å‘½ä»¤å¯èƒ½ä¼šæ˜¯è¿™æ ·ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --experimental-test-coverage</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> node_modules/.bin/mocha</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¸Šé¢çš„å‘½ä»¤å‘Šè¯‰ Node.js è¿è¡Œ Mocha æµ‹è¯•å¹¶æ”¶é›†æµ‹è¯•è¦†ç›–ç‡ä¿¡æ¯ã€‚æ³¨æ„ï¼Œç”±äºè¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§åŠŸèƒ½ï¼Œæœ€å¥½å…ˆåœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­å°è¯•ï¼Œä»¥ç†Ÿæ‚‰å®ƒçš„å·¥ä½œæ–¹å¼å’Œé™åˆ¶ã€‚</p><h3 id="experimental-vm-modules" tabindex="-1"><a class="header-anchor" href="#experimental-vm-modules"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--experimental-vm-modules" target="_blank" rel="noopener noreferrer">--experimental-vm-modules</a></span></a></h3><p>å¥½çš„ï¼ŒNode.js ä¸­çš„ <code>--experimental-vm-modules</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒç”¨äºå¯ç”¨å¯¹ ECMAScript æ¨¡å—ï¼ˆESMï¼‰åœ¨ VM æ¨¡å—ä¸­çš„å®éªŒæ€§æ”¯æŒã€‚åœ¨ Node.js ä¸­ï¼ŒVM æ¨¡å—å…è®¸ç”¨æˆ·æ‰§è¡Œ JavaScript ä»£ç åœ¨ä¸€ä¸ªæ²™ç›’ç¯å¢ƒä¸­ï¼Œè¿™ä¸ªç¯å¢ƒæä¾›äº†ä¸€å®šç¨‹åº¦ä¸Šä¸ä¸» Node.js ç¯å¢ƒéš”ç¦»çš„èƒ½åŠ›ã€‚</p><p>ESM æ˜¯ JavaScript çš„å®˜æ–¹æ¨¡å—ç³»ç»Ÿï¼Œæ ‡å‡†åŒ–äº†å¦‚ä½•å¯¼å…¥å’Œå¯¼å‡ºæ¨¡å—ã€‚åœ¨ Node.js ä¸­ä½¿ç”¨ ESMï¼Œé€šå¸¸ä½ ä¼šçœ‹åˆ°ä½¿ç”¨ <code>import</code> å’Œ <code>export</code> å…³é”®å­—æ¥ç®¡ç†ä¾èµ–å…³ç³»ã€‚</p><p>è¦ç†è§£ <code>--experimental-vm-modules</code>ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æ˜ç™½ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li><p><strong>VM Module</strong>ï¼š<code>vm</code> æ˜¯ Node.js çš„å†…ç½®æ¨¡å—ä¹‹ä¸€ï¼Œå®ƒå¯ä»¥æ‰§è¡Œ JavaScript ä»£ç ã€‚é€šè¿‡ <code>vm</code> æ¨¡å—ï¼Œä½ å¯ä»¥è¿è¡Œä¸€ä¸ªå­—ç¬¦ä¸²å½¢å¼çš„ä»£ç ï¼Œå¹¶å°†å…¶ä¸å…¨å±€ä½œç”¨åŸŸéš”ç¦»å¼€æ¥ï¼Œä»è€Œä¸ºä»£ç æ‰§è¡Œæä¾›ä¸€ä¸ªå®‰å…¨çš„ç¯å¢ƒã€‚</p></li><li><p><strong>å®éªŒæ€§ç‰¹æ€§</strong>ï¼šåœ¨ Node.js ä¸­ï¼Œæ ‡è®°ä¸ºâ€œå®éªŒæ€§â€çš„ç‰¹æ€§æ„å‘³ç€å®ƒä»¬è¿˜åœ¨æµ‹è¯•é˜¶æ®µï¼Œå°šæœªå®Œå…¨ç¨³å®šã€‚å› æ­¤ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æ—¶éœ€è¦è°¨æ…ï¼Œå› ä¸ºè¿™äº›ç‰¹æ€§å¯èƒ½ä¼šæœ‰é‡å¤§æ›´æ”¹æˆ–è¢«ç§»é™¤ã€‚</p></li><li><p><strong>ES Modules</strong>ï¼šESM æ˜¯ä¸€ä¸ªè¾ƒæ–°çš„æ¨¡å—ç³»ç»Ÿï¼Œç›¸æ¯”äº Node.js ä¼ ç»Ÿçš„ CommonJSï¼ˆCJSï¼‰æ¨¡å—ç³»ç»Ÿï¼ŒESM æä¾›äº†é™æ€å¯¼å…¥å’Œå¯¼å‡ºï¼Œä»¥åŠæ›´å¥½çš„å¼‚æ­¥åŠ è½½æ”¯æŒç­‰ç‰¹æ€§ã€‚</p></li></ol><p>ä¸¾ä¾‹è¯´æ˜å¦‚ä½•ä½¿ç”¨ <code>--experimental-vm-modules</code>ï¼š</p><p>å‡è®¾ä½ æƒ³åœ¨ç‹¬ç«‹çš„æ²™ç›’ç¯å¢ƒé‡Œæ‰§è¡Œä¸€æ®µ ES æ¨¡å—ä»£ç ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨ Node.js æ—¶æ·»åŠ  <code>--experimental-vm-modules</code> å‚æ•°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// example.mjs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> vm</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;vm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> code</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  import { add } from &#39;./math_utils.mjs&#39;;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  console.log(add(2, 3));</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> module</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> vm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">SourceTextModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™é‡Œå¯ä»¥æä¾›ä¸€äº›é€‰é¡¹ï¼Œä¾‹å¦‚æŒ‡å®šæ–‡ä»¶çš„ URL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  await</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">link</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åœ¨è¿™é‡Œå¤„ç†æ¨¡å—çš„ä¾èµ–å…³ç³»</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  await</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">evaluate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">})();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæºæ–‡æœ¬æ¨¡å— <code>SourceTextModule</code>ï¼Œå…¶ä¸­åŒ…å«äº†å¯¼å…¥å¹¶ä½¿ç”¨å…¶ä»–æ¨¡å—å‡½æ•°çš„ä»£ç ã€‚ç„¶åæˆ‘ä»¬é€šè¿‡ <code>link</code> æ–¹æ³•è®¾ç½®ä¾èµ–é¡¹ï¼Œå¹¶ä½¿ç”¨ <code>evaluate</code> æ–¹æ³•æ‰§è¡Œè¯¥æ¨¡å—ã€‚</p><p>è¦è¿è¡Œè¿™ä¸ªè„šæœ¬ï¼Œä½ éœ€è¦åœ¨å‘½ä»¤è¡Œä¸­å¯ç”¨å®éªŒæ€§ç‰¹æ€§ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --experimental-vm-modules</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> example.mjs</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¯·æ³¨æ„ï¼Œå› ä¸ºè¿™ä¸ªç‰¹æ€§æ˜¯å®éªŒæ€§çš„ï¼Œæ‰€ä»¥åœ¨æœªæ¥ç‰ˆæœ¬ä¸­ï¼Œç›¸å…³çš„ API å’Œè¡Œä¸ºå¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆé€šå¸¸ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å®éªŒæ€§ç‰¹æ€§ã€‚å¦‚æœä½ åªæ˜¯åœ¨å­¦ä¹ æˆ–è€…è¿›è¡ŒåŸå‹å¼€å‘ï¼Œé‚£ä¹ˆä½¿ç”¨è¿™äº›ç‰¹æ€§å¯ä»¥å¸®åŠ©ä½ äº†è§£æœ€æ–°çš„ Node.js åŠŸèƒ½ã€‚</p><h3 id="experimental-wasi-unstable-preview1" tabindex="-1"><a class="header-anchor" href="#experimental-wasi-unstable-preview1"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--experimental-wasi-unstable-preview1" target="_blank" rel="noopener noreferrer">--experimental-wasi-unstable-preview1</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹ Node.js ä¸­çš„ <code>--experimental-wasi-unstable-preview1</code> è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>é¦–å…ˆï¼Œéœ€è¦äº†è§£ WASI æ˜¯ä»€ä¹ˆã€‚WASI å…¨ç§°ä¸º WebAssembly System Interfaceï¼Œå®ƒæ˜¯ä¸€ä¸ªå…è®¸ WebAssemblyï¼ˆä»¥ä¸‹ç®€ç§° Wasmï¼‰ä»£ç ä¸ç³»ç»Ÿæ¥å£äº¤äº’çš„æ ‡å‡†ã€‚ç®€å•æ¥è¯´ï¼ŒWASI è®©åŸæœ¬åªèƒ½åœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„ Wasm ä»£ç ï¼Œä¹Ÿèƒ½å¤Ÿåœ¨æœåŠ¡å™¨æˆ–è€…å…¶ä»–è®¡ç®—ç¯å¢ƒä¸­æ‰§è¡Œï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œç­‰èµ„æºã€‚</p><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒä½¿å¾—å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚Node.js æ”¯æŒ Wasmï¼Œå¹¶å¼•å…¥äº† WASI å®éªŒæ€§æ”¯æŒï¼Œè¿™å°±æ˜¯ä½ æåˆ°çš„ <code>--experimental-wasi-unstable-preview1</code>ã€‚</p><p>å…·ä½“æ¥è®²ï¼Œ<code>--experimental-wasi-unstable-preview1</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨æ¥åœ¨ Node.js ä¸­å¯ç”¨å¯¹ WASI çš„å®éªŒæ€§æ”¯æŒã€‚å› ä¸ºè¿™é¡¹åŠŸèƒ½è¿˜åœ¨å®éªŒé˜¶æ®µï¼Œæ‰€ä»¥è¢«æ ‡è®°ä¸ºâ€œä¸ç¨³å®šâ€å’Œâ€œé¢„è§ˆç‰ˆâ€ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä¸¾ä¸€äº›å®é™…çš„ä¾‹å­ï¼š</p><p>å‡è®¾æœ‰ä¸€ä¸ªç”¨ C è¯­è¨€ç¼–å†™çš„ç¨‹åºï¼Œå®ƒå¯ä»¥å¤„ç†å›¾åƒè½¬æ¢å·¥ä½œã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ éœ€è¦å°†è¿™ä¸ªç¨‹åºç¼–è¯‘æˆæœºå™¨ç æ‰èƒ½åœ¨æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å°†å…¶ç¼–è¯‘æˆ Wasm æ¨¡å—ï¼Œå¹¶é€šè¿‡ WASI æ¥å£è¿›è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ª Wasm æ¨¡å—å°±å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ WASI çš„ç¯å¢ƒä¸­è¿è¡Œï¼ŒåŒ…æ‹¬ Node.jsã€‚</p><p>å¦‚æœæƒ³åœ¨ Node.js ä¸­ä½¿ç”¨è¿™ä¸ª Wasm æ¨¡å—ï¼Œä½ éœ€è¦åšçš„æ˜¯ï¼š</p><ol><li>ä½¿ç”¨ç›¸åº”çš„ç¼–è¯‘å·¥å…·é“¾ï¼Œå°†ä½ çš„ C ç¨‹åºç¼–è¯‘æˆ Wasmã€‚</li><li>ç¡®ä¿ä½ çš„ Node.js ç‰ˆæœ¬å¸¦æœ‰ WASI çš„æ”¯æŒã€‚</li><li>å¯åŠ¨ Node.js æ—¶åŠ ä¸Š <code>--experimental-wasi-unstable-preview1</code> å‚æ•°ã€‚</li><li>åœ¨ Node.js ä»£ç ä¸­åŠ è½½å¹¶è¿è¡Œè¿™ä¸ª Wasm æ¨¡å—ï¼Œå°±åƒè°ƒç”¨æ™®é€šçš„ Node.js æ¨¡å—ä¸€æ ·ã€‚</li></ol><p>ä¸€ä¸ªç®€å•çš„ Node.js è„šæœ¬ç¤ºä¾‹å¯èƒ½å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">WASI</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;wasi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º WASI å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> wasi</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> WASI</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  env</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  preopens</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;/sandbox&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/some/real/path/that/you/want/to/access&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¯»å–ç¼–è¯‘åçš„ Wasm æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> wasmBuffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./my-wasm-app.wasm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åŠ è½½ Wasm æ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">WebAssembly</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">instantiate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">wasmBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  wasi_snapshot_preview1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">wasi</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(({ </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">instance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ‰§è¡Œ Wasm æ¨¡å—çš„ _start å‡½æ•°ï¼Œè¿™é‡Œä»¥ _start ä¸ºä¾‹ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å®é™…ä¸Šå¯èƒ½æ˜¯å…¶å®ƒå¯¼å‡ºå‡½æ•°ï¼Œå…·ä½“å–å†³äºä½ çš„ Wasm åº”ç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    wasi</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">instance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šå¯åŠ¨ Node.js æ—¶è¦åŠ ä¸Š <code>--experimental-wasi-unstable-preview1</code>ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --experimental-wasi-unstable-preview1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-node-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¸ªè„šæœ¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª WASI å®ä¾‹å¹¶è®¾ç½®äº†åˆå§‹åŒ–å‚æ•°ï¼Œç„¶ååŠ è½½å¹¶å®ä¾‹åŒ–äº†ä¸€ä¸ª Wasm æ¨¡å—ï¼Œå¹¶æœ€ç»ˆé€šè¿‡ WASI å¯åŠ¨è¯¥æ¨¡å—ã€‚</p><p>ç”±äºè¿™ä¸ªç‰¹æ€§æ˜¯å®éªŒæ€§çš„ï¼ŒAPI å’ŒåŠŸèƒ½åœ¨æ­£å¼å‘å¸ƒä¹‹å‰å¯èƒ½ä¼šæœ‰å˜åŒ–ï¼Œå› æ­¤è¦è°¨æ…ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚éšç€æ—¶é—´çš„æ¨ç§»å’Œ Node.js çš„æ›´æ–°ï¼ŒWASI åœ¨ Node.js ä¸­çš„æ”¯æŒä¼šè¶Šæ¥è¶Šç¨³å®šï¼Œå¹¶æœ€ç»ˆæˆä¸ºæ­£å¼ç‰¹æ€§ã€‚</p><h3 id="experimental-wasm-modules" tabindex="-1"><a class="header-anchor" href="#experimental-wasm-modules"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--experimental-wasm-modules" target="_blank" rel="noopener noreferrer">--experimental-wasm-modules</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡ŒäºæœåŠ¡å™¨ç«¯çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç ã€‚è€Œ WebAssemblyï¼ˆç®€ç§° Wasmï¼‰æ˜¯ä¸€ç§æ–°çš„ä»£ç æ ¼å¼ï¼Œå®ƒå¯ä»¥åœ¨ç°ä»£ web æµè§ˆå™¨ä¸­è¿è¡Œï¼Œå¹¶ä¸”å…·æœ‰æ¥è¿‘æœ¬åœ°æ‰§è¡Œé€Ÿåº¦çš„ç‰¹ç‚¹ï¼Œè¿™ä¸»è¦å¾—ç›Šäºå…¶äºŒè¿›åˆ¶æ ¼å¼ï¼Œä½¿å¾—è§£æå’Œæ‰§è¡Œæ›´åŠ é«˜æ•ˆã€‚</p><p>åœ¨ Node.js çš„æŸäº›ç‰ˆæœ¬ä¸­ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ° <code>--experimental-wasm-modules</code> è¿™æ ·ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ã€‚è¿™ä¸ªé€‰é¡¹è¡¨ç¤ºåœ¨ Node.js ä¸­å¯ç”¨äº†å¯¹ WebAssembly æ¨¡å—çš„å®éªŒæ€§æ”¯æŒã€‚ç”±äº WebAssembly å’Œ JavaScript ä¸å°½ç›¸åŒï¼ŒNode.js éœ€è¦æä¾›ç‰¹å®šçš„æ¥å£æ¥åŠ è½½å’Œæ‰§è¡Œ Wasm æ¨¡å—ã€‚ä½¿ç”¨è¿™ä¸ªæ ‡å¿—å°±æ„å‘³ç€ä½ å¯ä»¥åœ¨ Node.js ä¸­è¯•ç”¨è¿™äº›åŠŸèƒ½ã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¢«æ ‡è®°ä¸ºå®éªŒæ€§-experimental" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¢«æ ‡è®°ä¸ºå®éªŒæ€§-experimental"><span>ä¸ºä»€ä¹ˆè¢«æ ‡è®°ä¸ºå®éªŒæ€§ï¼ˆExperimentalï¼‰ï¼Ÿ</span></a></h3><p>Node.js æ ¸å¿ƒå›¢é˜Ÿé€šå¸¸ä¼šå…ˆä»¥å®éªŒæ€§åŠŸèƒ½çš„å½¢å¼å¼•å…¥æ–°ç‰¹æ€§ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†æ”¶é›†ç”¨æˆ·åé¦ˆï¼Œå¹¶è¿›ä¸€æ­¥å®Œå–„è¯¥ç‰¹æ€§ã€‚å®éªŒæ€§åŠŸèƒ½å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œç”šè‡³åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-experimental-wasm-modules" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-experimental-wasm-modules"><span>å¦‚ä½•ä½¿ç”¨ <code>--experimental-wasm-modules</code>ï¼Ÿ</span></a></h3><p>å¦‚æœä½ æƒ³åœ¨ Node.js ç¨‹åºä¸­å°è¯•ä½¿ç”¨ Wasm æ¨¡å—ï¼Œä½ éœ€è¦å¯åŠ¨ Node.js æ—¶å¸¦ä¸Š <code>--experimental-wasm-modules</code> æ ‡å¿—ã€‚ä¾‹å¦‚ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --experimental-wasm-modules</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å…¶ä¸­ï¼Œ<code>my-app.js</code> æ˜¯ä½ çš„ Node.js ç¨‹åºçš„å…¥å£æ–‡ä»¶ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-1"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªè®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ WebAssembly æ¨¡å—ï¼ˆfibonacci.wasmï¼‰ï¼Œä¸‹é¢æ˜¯å¦‚ä½•åœ¨ Node.js ä¸­åŠ è½½å’Œä½¿ç”¨è¯¥æ¨¡å—çš„ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> loadWasmModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> wasmBuffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> wasmModule</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> WebAssembly</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">compile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">wasmBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> instance</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> WebAssembly</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">instantiate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">wasmModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> instance</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">exports</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¯åŠ¨ Node.js æ—¶éœ€è¦åŠ ä¸Š --experimental-wasm-modules æ ‡å¿—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> wasmFilePath</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">__dirname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fibonacci.wasm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> wasmExports</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> loadWasmModule</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">wasmFilePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‡è®¾ Wasm æ¨¡å—å¯¼å‡ºäº†ä¸€ä¸ªåä¸º &quot;calculateFibonacci&quot; çš„å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> wasmExports</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">calculateFibonacci</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Fibonacci of 10 is: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">})();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåŠ è½½äº†åŒ…å«æ–æ³¢é‚£å¥‘æ•°åˆ—ç®—æ³•çš„ WebAssembly æ¨¡å— <code>fibonacci.wasm</code>ï¼Œç„¶åè°ƒç”¨äº†æ¨¡å—å¯¼å‡ºçš„ <code>calculateFibonacci</code> å‡½æ•°æ¥è®¡ç®—å¹¶æ‰“å°å‡ºç¬¬ 10 é¡¹æ–æ³¢é‚£å¥‘æ•°åˆ—çš„å€¼ã€‚</p><p>è¯·æ³¨æ„ï¼Œå½“å‰ WebAssembly åœ¨ Node.js ä¸­çš„ä½¿ç”¨è¿˜å¤„äºä¸æ–­å‘å±•ä¹‹ä¸­ï¼Œå› æ­¤ç›¸å…³ API å’ŒåŠŸèƒ½å¯èƒ½ä¼šéšç€ Node.js ç‰ˆæœ¬çš„æ›´æ–°è€Œæ”¹å˜ã€‚åœ¨ä½¿ç”¨ä»»ä½•å®éªŒæ€§åŠŸèƒ½æ—¶ï¼Œå»ºè®®æŸ¥é˜…æœ€æ–°çš„å®˜æ–¹æ–‡æ¡£ä»¥è·å–æœ€å‡†ç¡®çš„ä¿¡æ¯ã€‚</p><h3 id="experimental-websocket" tabindex="-1"><a class="header-anchor" href="#experimental-websocket"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--experimental-websocket" target="_blank" rel="noopener noreferrer">--experimental-websocket</a></span></a></h3><p>Node.js çš„ <code>--experimental-websocket</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨äºåœ¨ Node.js ç¨‹åºä¸­å¯ç”¨å®éªŒæ€§çš„ WebSocket åŠŸèƒ½ã€‚WebSocket æ˜¯ä¸€ç§ç½‘ç»œé€šä¿¡åè®®ï¼Œå®ƒæä¾›äº†æµè§ˆå™¨ï¼ˆæˆ–å…¶ä»–å®¢æˆ·ç«¯ï¼‰å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å…¨åŒå·¥é€šä¿¡æ¸ é“ï¼Œè¿™æ„å‘³ç€æ•°æ®å¯ä»¥åŒæ—¶åŒå‘æµåŠ¨ã€‚</p><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨ WebSocket åŠŸèƒ½è€Œä¸ä¾èµ–ç¬¬ä¸‰æ–¹åº“ï¼ˆæ¯”å¦‚ <code>ws</code> æˆ–è€… <code>socket.io</code>ï¼‰ï¼Œä½ éœ€è¦åœ¨è¿è¡Œ Node.js åº”ç”¨æ—¶åŠ ä¸Š <code>--experimental-websocket</code> æ ‡å¿—ï¼Œå› ä¸ºè¿™ä¸ªåŠŸèƒ½ä»ç„¶æ˜¯å®éªŒæ€§çš„ï¼Œå¹¶ä¸åŒ…å«åœ¨ Node.js çš„ç¨³å®šç‰ˆæœ¬ä¸­ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªç®€å•çš„ Node.js è„šæœ¬ï¼Œåä¸º <code>app.js</code>ï¼Œå¸Œæœ›åœ¨å…¶ä¸­ä½¿ç”¨ WebSocket åŠŸèƒ½ï¼Œä½ éœ€è¦è¿™æ ·è¿è¡Œç¨‹åºï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --experimental-websocket</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨åŸç”Ÿ WebSocket API åœ¨ Node.js ä¸­åˆ›å»º WebSocket æœåŠ¡å™¨çš„ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼•å…¥ HTTP å’Œ WebSocket æ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">WebSocketServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ws&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ª WebSocket æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> wss</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> WebSocketServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">wss</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;connection&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> connection</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">ws</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  ws</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> incoming</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;received: %s&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  ws</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">send</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;something&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// HTTP æœåŠ¡å™¨å°†ç›‘å¬ç«¯å£ 3000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server is running on http://localhost:3000/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† HTTP å’Œ WebSocket æ¨¡å—ã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå½“ç”¨æˆ·è®¿é—®æœåŠ¡å™¨æ—¶è¿”å› &quot;Hello World&quot; æ¶ˆæ¯ã€‚ç„¶åæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª WebSocket æœåŠ¡å™¨å¹¶å°†å…¶ç»‘å®šåˆ°åŒä¸€ä¸ª HTTP æœåŠ¡å™¨ä¸Šã€‚</p><p>å½“æœ‰æ–°çš„å®¢æˆ·ç«¯è¿æ¥åˆ° WebSocket æœåŠ¡å™¨æ—¶ï¼Œä¼šè§¦å‘ <code>&#39;connection&#39;</code> äº‹ä»¶ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºçš„ WebSocket (<code>ws</code>) è®¾ç½®äº†æ¶ˆæ¯å¤„ç†å‡½æ•°ã€‚æ¯å½“æœåŠ¡å™¨æ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯æ—¶ï¼Œå®ƒéƒ½ä¼šæ‰“å°å‡ºè¯¥æ¶ˆæ¯ã€‚åŒæ—¶ï¼ŒæœåŠ¡å™¨ä¹Ÿå‘å®¢æˆ·ç«¯å‘é€äº†ä¸€æ¡æ¶ˆæ¯ <code>&#39;something&#39;</code>ã€‚</p><p>è¯·æ³¨æ„ï¼Œç”±äº <code>--experimental-websocket</code> æä¾›çš„æ˜¯å®éªŒæ€§ç‰¹æ€§ï¼Œæœªæ¥çš„ Node.js ç‰ˆæœ¬å¯èƒ½ä¼šæ›´æ”¹è¿™ä¸€ç‰¹æ€§çš„å·¥ä½œæ–¹å¼ï¼Œå¹¶ä¸”åœ¨æ²¡æœ‰è¯¥æ ‡å¿—çš„æƒ…å†µä¸‹å¯èƒ½æ— æ³•ä½¿ç”¨ WebSocket åŠŸèƒ½ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å®éªŒæ€§ç‰¹æ€§å¾€å¾€ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½å¹¶ä¸ç¨³å®šæˆ–è€…å¯èƒ½åœ¨æœªæ¥è¢«ç§»é™¤ã€‚</p><h3 id="force-context-aware" tabindex="-1"><a class="header-anchor" href="#force-context-aware"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--force-context-aware" target="_blank" rel="noopener noreferrer">--force-context-aware</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰æ—¶æˆ‘ä»¬ä¼šä½¿ç”¨ä¸€äº›æ‰©å±•æ¨¡å—ï¼ˆä¹Ÿå°±æ˜¯ç”± C++ ç¼–å†™çš„æ’ä»¶ï¼‰ï¼Œè¿™äº›æ¨¡å—è¢«ç§°ä¸ºåŸç”Ÿæ¨¡å—ã€‚</p><p>æœ‰äº›åŸç”Ÿæ¨¡å—æ˜¯â€œä¸Šä¸‹æ–‡æ„ŸçŸ¥â€çš„ï¼Œæ„å‘³ç€å®ƒä»¬èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­å¯èƒ½å‡ºç°çš„å¤šä¸ªä¸Šä¸‹æ–‡æƒ…å†µã€‚ä¸€ä¸ªä¸Šä¸‹æ–‡é€šå¸¸å¯¹åº”äºä¸€ä¸ªå…¨å±€ä½œç”¨åŸŸï¼Œæ¯”å¦‚åœ¨ Web æµè§ˆå™¨ä¸­çš„ä¸€ä¸ªçª—å£æˆ–è€…åœ¨ Node.js ä¸­çš„ä¸€ä¸ªè™šæ‹Ÿæœºï¼ˆVMï¼‰å®ä¾‹ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œå½“ä½ ä½¿ç”¨ <code>require()</code> å‡½æ•°åŠ è½½æ¨¡å—æ—¶ï¼ŒNode.js é»˜è®¤å‡è®¾è¯¥æ¨¡å—ä¸æ˜¯ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨ä½¿ç”¨äº† <code>vm</code> æ¨¡å—åˆ›å»ºæ–°çš„ VM ä¸Šä¸‹æ–‡æ—¶ï¼Œæˆ–è€…åœ¨ Electron è¿™æ ·çš„æ¡†æ¶ä¸­ï¼Œå®ƒä»¬åœ¨ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ä¹‹é—´å…±äº«åŸç”Ÿæ¨¡å—ã€‚</p><p><code>--force-context-aware</code> æ˜¯ Node.js çš„ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒå¼ºåˆ¶æ‰€æœ‰åŸç”Ÿæ¨¡å—åœ¨åŠ è½½æ—¶éƒ½è¦è¡¨ç°ä¸ºä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„ï¼Œå³ä½¿å®ƒä»¬æ²¡æœ‰è¢«æ˜ç¡®è®¾è®¡æˆä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„ä¹Ÿæ˜¯å¦‚æ­¤ã€‚è¿™æ ·åšå¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§ï¼Œä½†å¯èƒ½ä¼šå½±å“æ€§èƒ½ï¼Œå¹¶ä¸”å¯èƒ½ä¸é‚£äº›ç¡®å®ä¸æ”¯æŒä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„æ¨¡å—ä¸å…¼å®¹ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œè¯¥ç¨‹åºä½¿ç”¨äº†ä¸€ä¸ªå›¾å½¢å¤„ç†åº“ï¼Œè¿™ä¸ªåº“åº•å±‚é€šè¿‡ä¸€ä¸ªåŸç”Ÿæ¨¡å—æ¥åŠ é€Ÿå›¾åƒå¤„ç†çš„è®¡ç®—ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªåŸç”Ÿæ¨¡å—åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶åŠ è½½ä¸€æ¬¡ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸå†…å¤„äºæ´»è·ƒçŠ¶æ€ã€‚</p><p>ç°åœ¨ï¼Œå¦‚æœä½ çš„åº”ç”¨ç¨‹åºéœ€è¦åœ¨ä¸åŒçš„ VM ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä»£ç ï¼ˆä¾‹å¦‚ï¼Œåœ¨ä¸åŒçš„ç”¨æˆ·ä¼šè¯ä¸­ç‹¬ç«‹è¿è¡Œä»£ç ç‰‡æ®µï¼‰ï¼Œè€Œè¯¥åŸç”Ÿæ¨¡å—æœªè¢«è®¾è®¡ä¸ºä¸Šä¸‹æ–‡æ„ŸçŸ¥ï¼Œåˆ™å¯èƒ½ä¼šç¢°åˆ°é—®é¢˜ï¼šå½“ç¬¬äºŒä¸ª VM ä¸Šä¸‹æ–‡è¯•å›¾ä½¿ç”¨è¿™ä¸ªæ¨¡å—æ—¶ï¼Œå®ƒå¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œï¼Œå› ä¸ºå®ƒå·²ç»ä¸ç¬¬ä¸€ä¸ª VM ä¸Šä¸‹æ–‡ç»‘å®šã€‚</p><p>ä½¿ç”¨ <code>--force-context-aware</code> å¼€å…³å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå®ƒå‘Šè¯‰ Node.js å¼ºåˆ¶æ‰€æœ‰çš„åŸç”Ÿæ¨¡å—éƒ½åƒä¸Šä¸‹æ–‡æ„ŸçŸ¥æ¨¡å—ä¸€æ ·å·¥ä½œï¼Œè¿™æ ·æ¯ä¸ªæ–°çš„ VM ä¸Šä¸‹æ–‡éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªå¹²å‡€çš„åŸç”Ÿæ¨¡å—å®ä¾‹ï¼Œé¿å…äº†å¤ç”¨åŒä¸€ä¸ªå®ä¾‹é€ æˆçš„å†²çªã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨ --force-context-aware é€‰é¡¹</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --force-context-aware</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†è¯·æ³¨æ„ï¼Œè¿™ä¸ªé€‰é¡¹å¹¶ä¸æ˜¯ä¸‡èƒ½è¯ï¼Œå®ƒå¯èƒ½ä¼šå¼•å…¥æ€§èƒ½å¼€é”€ï¼Œå¹¶ä¸”å¦‚æœåŸç”Ÿæ¨¡å—æœ¬èº«å­˜åœ¨ç¼ºé™·æˆ–è€…å¹¶ä¸æ”¯æŒå¤šä¸ªä¸Šä¸‹æ–‡ï¼Œè¿˜æ˜¯å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨è¿™ä¸ªé€‰é¡¹æ—¶ï¼Œä½ åº”å½“å……åˆ†æµ‹è¯•ä½ çš„åº”ç”¨ç¨‹åºä»¥ç¡®ä¿ä¸€åˆ‡æ­£å¸¸ã€‚</p><h3 id="force-fips" tabindex="-1"><a class="header-anchor" href="#force-fips"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--force-fips" target="_blank" rel="noopener noreferrer">--force-fips</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>--force-fips</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨æ¥å¯åŠ¨ Node.js çš„ FIPS å…¼å®¹æ¨¡å¼ã€‚</p><p>FIPSï¼ˆFederal Information Processing Standardï¼‰æ˜¯ç¾å›½è”é‚¦ä¿¡æ¯å¤„ç†æ ‡å‡†ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ç³»åˆ—å…³äºè®¡ç®—æœºç³»ç»ŸåŠ å¯†æ¨¡å—å®‰å…¨æ€§çš„è§„èŒƒã€‚è¿™äº›è§„èŒƒç”±ç¾å›½å›½å®¶æ ‡å‡†ä¸æŠ€æœ¯ç ”ç©¶é™¢ï¼ˆNISTï¼‰åˆ¶å®šï¼Œæ—¨åœ¨ç”¨äºæ”¿åºœéƒ¨é—¨å’Œå…¶ä»–éœ€è¦é«˜å®‰å…¨æ€§çš„åœºåˆã€‚</p><p>å½“ Node.js åœ¨ FIPS æ¨¡å¼ä¸‹è¿è¡Œæ—¶ï¼Œå®ƒåªä¼šä½¿ç”¨é‚£äº›ç¬¦åˆ FIPS æ ‡å‡†çš„åŠ å¯†ç®—æ³•ï¼Œè¿™æœ‰åŠ©äºç¡®ä¿åº”ç”¨ç¨‹åºæ»¡è¶³æŸäº›æ”¿åºœæˆ–è¡Œä¸šçš„åŠ å¯†å®‰å…¨è¦æ±‚ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„åº”ç”¨ç¨‹åºæ˜¯ä¾›æ”¿åºœæœºæ„ä½¿ç”¨ï¼Œæˆ–è€…éœ€è¦éµå®ˆä¸¥æ ¼çš„æ•°æ®ä¿æŠ¤è§„å®šï¼Œå¯èƒ½å°±éœ€è¦å¼€å¯ FIPS æ¨¡å¼ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-force-fips" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-force-fips"><span>å¦‚ä½•ä½¿ç”¨ <code>--force-fips</code></span></a></h3><p>å½“ä½ å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œé€šå¸¸ä½ ä¼šåœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œåƒ <code>node app.js</code> è¿™æ ·çš„å‘½ä»¤ã€‚å¦‚æœæƒ³è¦å¼ºåˆ¶ä½¿ç”¨ FIPS å…¼å®¹çš„åŠ å¯†ç®—æ³•ï¼Œä½ éœ€è¦åœ¨å‘½ä»¤å‰æ·»åŠ  <code>--force-fips</code> é€‰é¡¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --force-fips</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¸ªå‘½ä»¤å‘Šè¯‰ Node.js å¯åŠ¨æ—¶è¦è¿›å…¥ FIPS æ¨¡å¼ã€‚ä»»ä½•å°è¯•ä½¿ç”¨é FIPS ç®—æ³•çš„æ“ä½œéƒ½å°†å¤±è´¥ï¼Œå› ä¸º <code>--force-fips</code> é€‰é¡¹ä¼šé˜»æ­¢å®ƒä»¬ã€‚</p><h3 id="å®é™…ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-1"><span>å®é™…ä¾‹å­</span></a></h3><ol><li><p><strong>æ”¿åºœé¡¹ç›®</strong>ï¼šå‡è®¾ä½ æ­£åœ¨ä¸ºæ”¿åºœéƒ¨é—¨å¼€å‘ä¸€ä¸ªéœ€è¦å¤„ç†æ•æ„Ÿä¿¡æ¯çš„ web åº”ç”¨ç¨‹åºã€‚ä¸ºäº†ç¬¦åˆå®‰å…¨æ ‡å‡†ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨ <code>--force-fips</code> é€‰é¡¹æ¥ç¡®ä¿æ‰€æœ‰çš„åŠ å¯†æ“ä½œéƒ½æ˜¯ FIPS è®¤è¯çš„ã€‚</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --force-fips</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> government-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>é‡‘èæœåŠ¡</strong>ï¼šå¦‚æœä½ çš„ Node.js åº”ç”¨ç¨‹åºæ˜¯ä¸ºé“¶è¡Œæˆ–é‡‘èæœºæ„è®¾è®¡çš„ï¼Œåœ¨å¤„ç†äº¤æ˜“æˆ–å­˜å‚¨å®¢æˆ·æ•°æ®æ—¶å¯èƒ½éœ€è¦åŠ å¯†åŠŸèƒ½ã€‚å¼€å¯ FIPS æ¨¡å¼å¯ä»¥ä¿è¯ä½¿ç”¨çš„åŠ å¯†æ–¹æ³•å¾—åˆ°äº†è®¤å¯ï¼Œé€‚åˆç®¡ç†è¿™äº›é«˜åº¦æ•æ„Ÿçš„ä¿¡æ¯ã€‚</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --force-fips</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> financial-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>åŒ»ç–—æ•°æ®å¤„ç†</strong>ï¼šåŒ»ç–—è¡Œä¸šå¯¹äºæ•°æ®çš„ä¿æŠ¤æœ‰ç€ä¸¥æ ¼çš„æ³•å¾‹è¦æ±‚ï¼Œæ¯”å¦‚ HIPAA è§„å®šã€‚ä½¿ç”¨ <code>--force-fips</code> é€‰é¡¹å¯ä»¥å¸®åŠ©ç¡®ä¿åº”ç”¨ç¨‹åºåœ¨å¤„ç†æ‚£è€…æ•°æ®æ—¶ç¬¦åˆè¿™äº›è§„å®šã€‚</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --force-fips</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> medical-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><p>è®°ä½ï¼Œåªæœ‰åœ¨ä½ çš„æ“ä½œç³»ç»Ÿå’Œ Node.js éƒ½é…ç½®äº† FIPS æ¨¡å¼æ—¶ï¼Œä¸Šè¿°å‘½ä»¤æ‰èƒ½ç”Ÿæ•ˆã€‚å¦‚æœä½ å°è¯•åœ¨æ²¡æœ‰æ­£ç¡®é…ç½®çš„ç³»ç»Ÿä¸Šä½¿ç”¨ <code>--force-fips</code>ï¼ŒNode.js å¯èƒ½æ— æ³•å¯åŠ¨æˆ–è€…ä¼šå‡ºç°é”™è¯¯ã€‚</p><h3 id="force-node-api-uncaught-exceptions-policy" tabindex="-1"><a class="header-anchor" href="#force-node-api-uncaught-exceptions-policy"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--force-node-api-uncaught-exceptions-policy" target="_blank" rel="noopener noreferrer">--force-node-api-uncaught-exceptions-policy</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥è°ˆä¸€è°ˆ Node.js ä¸­çš„ <code>--force-node-api-uncaught-exceptions-policy</code> å‘½ä»¤è¡Œé€‰é¡¹ï¼Œå¹¶ä¸”é€šè¿‡ä¸€äº›ä¾‹å­æ¥è®©ä½ æ›´å¥½åœ°ç†è§£å®ƒã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œä¸€ä¸ª &quot;uncaught exception&quot;ï¼ˆæœªæ•è·çš„å¼‚å¸¸ï¼‰æ˜¯æŒ‡å½“ç¨‹åºä¸­å‡ºç°é”™è¯¯ï¼Œè€Œè¿™ä¸ªé”™è¯¯æ²¡æœ‰è¢«ç›¸åº”çš„é”™è¯¯å¤„ç†ä»£ç æ•è·å’Œå¤„ç†æ—¶ï¼Œå°±ä¼šæŠ›å‡ºçš„å¼‚å¸¸ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ ·çš„å¼‚å¸¸ä¼šå¯¼è‡´ Node.js ç¨‹åºå´©æºƒï¼Œå¹¶æ‰“å°é”™è¯¯ä¿¡æ¯åˆ°æ§åˆ¶å°ã€‚</p><p>Node.js æä¾›äº†å¤šç§æ–¹å¼è®©å¼€å‘è€…å¯ä»¥æ›´ç²¾ç»†åœ°æ§åˆ¶æœªæ•è·å¼‚å¸¸çš„å¤„ç†æ–¹å¼ã€‚å…¶ä¸­ä¹‹ä¸€å°±æ˜¯ Node-APIï¼Œå®ƒæ˜¯ä¸€ä¸ªæ„å»ºåŸç”Ÿæ’ä»¶çš„ APIã€‚è¿™äº›æ’ä»¶å…è®¸ JavaScript ä»£ç ç›´æ¥è°ƒç”¨ C/C++ ç¼–å†™çš„åº“ï¼Œå®ƒä»¬é€šå¸¸ç”¨äºæå‡æ€§èƒ½æˆ–è®¿é—®æ“ä½œç³»ç»Ÿåº•å±‚çš„ç‰¹æ€§ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>--force-node-api-uncaught-exceptions-policy</code> è¿™ä¸ªå‘½ä»¤è¡Œé€‰é¡¹è®©ä½ å¯ä»¥æ˜ç¡®å‘Šè¯‰ Node.js å½“ Node-API è°ƒç”¨äº§ç”Ÿæœªæ•è·å¼‚å¸¸æ—¶ï¼Œåº”è¯¥å¦‚ä½•å¤„ç†ã€‚</p><p>è¿™ä¸ªé€‰é¡¹æœ‰å‡ ä¸ªå¯èƒ½çš„å€¼ï¼š</p><ol><li><code>crash</code> (é»˜è®¤) - å½“å‡ºç°æœªæ•è·çš„å¼‚å¸¸æ—¶ï¼ŒNode.js è¿›ç¨‹å°†é€€å‡ºã€‚</li><li><code>throw</code> - å¼‚å¸¸å°†è¢«é‡æ–°æŠ›å‡ºè‡³ JavaScript å±‚é¢ã€‚</li><li><code>abort</code> - ç±»ä¼¼äº <code>crash</code>ï¼Œä½†ä¼šç”Ÿæˆä¸€ä¸ªæ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ï¼Œæœ‰åŠ©äºè°ƒè¯•ã€‚</li></ol><p>ç°åœ¨ï¼Œå‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œä½ ä½¿ç”¨äº†ä¸€ä¸ª Node-API çš„åŸç”Ÿæ’ä»¶ï¼Œæ¯”å¦‚ä¸€ä¸ªç”¨æ¥è¿›è¡Œå›¾åƒå¤„ç†çš„åº“ã€‚å¦‚æœè¿™ä¸ªåº“åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€ä¸ªé”™è¯¯ï¼ˆå¦‚æ— æ³•æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼‰ï¼Œå®ƒå¯èƒ½ä¼šå¼•èµ·ä¸€ä¸ªæœªæ•è·çš„å¼‚å¸¸ã€‚</p><p><strong>ä¾‹å­ï¼š</strong></p><p>å¦‚æœä½ æ²¡æœ‰ä¸ºè¿™ç§æƒ…å†µæ·»åŠ å¼‚å¸¸å¤„ç†ï¼Œé‚£ä¹ˆæŒ‰ç…§é»˜è®¤ç­–ç•¥ï¼ˆ<code>crash</code>ï¼‰ï¼Œä½ çš„ Node.js ç¨‹åºå°†ä¼šå› ä¸ºè¿™ä¸ªé”™è¯¯è€Œé€€å‡ºã€‚</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å‡å¦‚ä½ å¸Œæœ›èƒ½å¤Ÿåœ¨ JavaScript å±‚æ¬¡æ•è·è¿™ä¸ªé”™è¯¯ï¼Œè¿›è¡Œä¸€å®šçš„é”™è¯¯å¤„ç†ï¼Œæ¯”å¦‚è®°å½•é”™è¯¯æ—¥å¿—å¹¶è¿”å›ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨ <code>throw</code> ç­–ç•¥ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --force-node-api-uncaught-exceptions-policy=throw</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œå½“åŸç”Ÿæ’ä»¶äº§ç”Ÿæœªæ•è·å¼‚å¸¸æ—¶ï¼ŒNode.js ä¸ä¼šç«‹å³é€€å‡ºè¿›ç¨‹ï¼Œè€Œæ˜¯ä¼šæŠŠå¼‚å¸¸æŠ›å›ç»™ JavaScriptï¼Œè¿™æ ·ä½ å°±å¯ä»¥ç”¨ try-catch è¯­å¥æ¥æ•è·å’Œå¤„ç†è¿™ä¸ªå¼‚å¸¸ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è°ƒç”¨å¯èƒ½ä¼šå¼•å‘æœªæ•è·å¼‚å¸¸çš„åŸç”Ÿæ’ä»¶å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†å¼‚å¸¸</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;An unexpected error occurred:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ æ­£å¤„äºè°ƒè¯•é˜¶æ®µï¼Œå¹¶ä¸”éœ€è¦è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯æ¥åˆ†æé—®é¢˜ï¼Œä½ å¯èƒ½ä¼šé€‰æ‹© <code>abort</code> ç­–ç•¥ã€‚è¿™æ ·ï¼Œä¸€æ—¦åŸç”Ÿæ’ä»¶æŠ›å‡ºæœªæ•è·çš„å¼‚å¸¸ï¼ŒNode.js å°†äº§ç”Ÿä¸€ä¸ªæ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨è°ƒè¯•å·¥å…·æ¥åˆ†æè¿™ä¸ªæ–‡ä»¶ã€‚</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --force-node-api-uncaught-exceptions-policy=abort</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è®°ä½ï¼Œä½¿ç”¨ <code>abort</code> ç­–ç•¥ç”Ÿæˆçš„æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶å¯ä»¥åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨å¤„ç†è¿™ç±»æ–‡ä»¶æ—¶è¦å°å¿ƒã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>--force-node-api-uncaught-exceptions-policy</code> å‘½ä»¤è¡Œé€‰é¡¹è®©ä½ å¯ä»¥å¼ºåˆ¶æŒ‡å®š Node-API åœ¨å¤„ç†æœªæ•è·å¼‚å¸¸æ—¶çš„è¡Œä¸ºã€‚é€šè¿‡é€‰æ‹©åˆé€‚çš„ç­–ç•¥ï¼Œä½ å¯ä»¥æ›´å¥½åœ°æ§åˆ¶ä½ çš„åº”ç”¨ç¨‹åºåœ¨é‡åˆ°é”™è¯¯æ—¶çš„è¡Œä¸ºï¼Œæ— è®ºæ˜¯ä¸ºäº†ç¨³å®šæ€§ã€è°ƒè¯•è¿˜æ˜¯ç”¨æˆ·ä½“éªŒã€‚</p><h3 id="frozen-intrinsics" tabindex="-1"><a class="header-anchor" href="#frozen-intrinsics"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--frozen-intrinsics" target="_blank" rel="noopener noreferrer">--frozen-intrinsics</a></span></a></h3><p><code>--frozen-intrinsics</code> æ˜¯ Node.js è¿è¡Œæ—¶çš„ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒç”¨äºæé«˜å®‰å…¨æ€§ã€‚åœ¨è§£é‡Šè¿™ä¸ªé€‰é¡¹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£å‡ ä¸ªç›¸å…³çš„æ¦‚å¿µã€‚</p><h3 id="æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#æ¦‚å¿µ"><span>æ¦‚å¿µï¼š</span></a></h3><ol><li><p><strong>Intrinsics (å†…ç½®å¯¹è±¡)</strong>ï¼šè¿™äº›æ˜¯ JavaScript è¯­è¨€æä¾›çš„åŸºç¡€å¯¹è±¡å’Œå‡½æ•°ï¼Œæ¯”å¦‚ <code>Array</code>, <code>Object</code>, <code>Function</code> ç­‰ã€‚å®ƒä»¬æ˜¯è¯­è¨€æ ¸å¿ƒçš„ä¸€éƒ¨åˆ†ã€‚</p></li><li><p><strong>Freezing (å†»ç»“)</strong>ï¼šJavaScript æä¾›äº†ä¸€ä¸ªå«åš <code>Object.freeze()</code> çš„æ–¹æ³•ï¼Œå¯ä»¥ä½¿ä¸€ä¸ªå¯¹è±¡å˜å¾—ä¸å¯æ›´æ”¹ã€‚å†»ç»“åçš„å¯¹è±¡æ— æ³•æ·»åŠ æ–°çš„å±æ€§ï¼Œç°æœ‰å±æ€§ä¹Ÿä¸èƒ½è¢«ä¿®æ”¹æˆ–åˆ é™¤ï¼Œè€Œä¸”å…¶åŸå‹é“¾ä¹Ÿä¼šè¢«é”å®šã€‚</p></li><li><p><strong>Security (å®‰å…¨æ€§)</strong>ï¼šåœ¨ JavaScript ç¯å¢ƒä¸­ï¼Œä»£ç çš„å®‰å…¨æ€§å¾ˆé‡è¦ï¼Œå°¤å…¶æ˜¯å½“ä½ åœ¨æ‰§è¡Œæ¥è‡ªä¸åŒæ¥æºçš„ä»£ç æ—¶ã€‚å¦‚æœå†…ç½®å¯¹è±¡è¢«æ¶æ„ä»£ç ç¯¡æ”¹ï¼Œé‚£ä¹ˆæ•´ä¸ªç¯å¢ƒçš„å®‰å…¨æ€§éƒ½ä¼šå—åˆ°å¨èƒã€‚</p></li></ol><h3 id="frozen-intrinsics-é€‰é¡¹" tabindex="-1"><a class="header-anchor" href="#frozen-intrinsics-é€‰é¡¹"><span><code>--frozen-intrinsics</code> é€‰é¡¹ï¼š</span></a></h3><p>ä½¿ç”¨ <code>--frozen-intrinsics</code> é€‰é¡¹å¯åŠ¨ Node.js æ—¶ï¼ŒNode.js ä¼šè‡ªåŠ¨å†»ç»“æ‰€æœ‰å†…ç½®å¯¹è±¡ã€‚è¿™å°±æ„å‘³ç€ï¼Œæ‰€æœ‰çš„å†…ç½®å¯¹è±¡å’Œå®ƒä»¬çš„åŸå‹éƒ½ä¼šå˜æˆä¸å¯æ›´æ”¹çš„çŠ¶æ€ã€‚</p><h4 id="å®é™…è¿ç”¨çš„ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-2"><span>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</span></a></h4><p>ä¾‹å­ 1 - ä¸ä½¿ç”¨ <code>--frozen-intrinsics</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ --frozen-intrinsics å¯åŠ¨ Node.js</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¶æ„ä»£ç å¯èƒ½ä¼šå°è¯•ä¿®æ”¹ Array æ„é€ å™¨</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Array</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">prototype</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Array has been hacked!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ­£å¸¸ä½¿ç”¨ Array push æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myArray</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: Array has been hacked!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¾‹å­ 2 - ä½¿ç”¨ <code>--frozen-intrinsics</code>ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## é¦–å…ˆä½¿ç”¨ --frozen-intrinsics é€‰é¡¹å¯åŠ¨ Node.js</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --frozen-intrinsics</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç°åœ¨å†…ç½®å¯¹è±¡å·²ç»è¢«å†»ç»“</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°è¯•ä¿®æ”¹ Array æ„é€ å™¨å°†ä¸èµ·ä½œç”¨</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Array</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">prototype</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Array has been hacked!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ­£å¸¸ä½¿ç”¨ Array push æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myArray</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™æ¬¡æ“ä½œæ­£å¸¸ï¼Œè¾“å‡ºä¸ä¼šæ˜¾ç¤ºå·²è¢«ç¯¡æ”¹çš„ä¿¡æ¯</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œå³ä½¿æ¶æ„ä»£ç è¯•å›¾ä¿®æ”¹ <code>Array</code> çš„åŸå‹æ–¹æ³• <code>push</code>ï¼Œç”±äº <code>Array</code> å·²ç»è¢«å†»ç»“ï¼Œè¿™ä¸ªä¿®æ”¹å°†ä¸ä¼šç”Ÿæ•ˆã€‚å› æ­¤ï¼Œä½¿ç”¨ <code>--frozen-intrinsics</code> å¯ä»¥å¸®åŠ©ä¿æŠ¤ä½ çš„ Node.js ç¯å¢ƒå…å—æ­¤ç±»ç¯¡æ”¹çš„å½±å“ã€‚</p><h3 id="heap-prof" tabindex="-1"><a class="header-anchor" href="#heap-prof"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--heap-prof" target="_blank" rel="noopener noreferrer">--heap-prof</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚éšç€åº”ç”¨ç¨‹åºçš„å¢é•¿ï¼Œæ€§èƒ½ä¼˜åŒ–å’Œå†…å­˜ç®¡ç†å˜å¾—éå¸¸å…³é”®ã€‚è¿™å°±æ˜¯ <code>--heap-prof</code> é€‰é¡¹å­˜åœ¨çš„åŸå› ã€‚</p><p><code>--heap-prof</code> æ˜¯ Node.js å‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰çš„ä¸€ä¸ªå‚æ•°ï¼Œå®ƒå¯ç”¨äº†å¯¹å †å†…å­˜ä½¿ç”¨æƒ…å†µçš„åˆ†æã€‚å †å†…å­˜æ˜¯ä¸€ç§åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œå®ƒåœ¨ç¨‹åºæ‰§è¡Œæ—¶ç”¨äºå­˜å‚¨å¯¹è±¡å’Œå…¶ä»–æ•°æ®ç»“æ„ã€‚</p><h3 id="ä½¿ç”¨-heap-prof" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-heap-prof"><span>ä½¿ç”¨ <code>--heap-prof</code></span></a></h3><p>å½“ä½ åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ Node.js ç¨‹åºæ—¶ï¼Œå¯ä»¥æ·»åŠ  <code>--heap-prof</code> å‚æ•°æ¥å¯åŠ¨å †å†…å­˜åˆ†æï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --heap-prof</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä»¥ä¸Šå‘½ä»¤ä¼šåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚ <code>Heap-</code>&lt;<code>timestamp&gt;</code>ï¼Œå…¶ä¸­åŒ…å«äº†å †å†…å­˜ä½¿ç”¨æƒ…å†µçš„å¿«ç…§ã€‚è¿™äº›å¿«ç…§æ–‡ä»¶å¯ä»¥ä½¿ç”¨ä¸“é—¨çš„å·¥å…·ï¼ˆå¦‚ Chrome å¼€å‘è€…å·¥å…·ä¸­çš„ Memory åˆ†æå™¨ï¼‰æ¥æ£€æŸ¥ã€‚</p><h3 id="å®é™…ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-2"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªç®€å•çš„ Node.js åº”ç”¨ç¨‹åºï¼Œå®ƒåœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶å¯¼è‡´å†…å­˜ä½¿ç”¨é‡æ€¥å‰§å¢åŠ ã€‚ä½ æƒ³è¦åˆ†æå †å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œä»¥ä¸‹æ˜¯å®ç°æ­¥éª¤ï¼š</p><ol><li><p><strong>å¯åŠ¨å †åˆ†æï¼š</strong><br> ä½ å¯ä»¥é€šè¿‡åœ¨å¯åŠ¨è„šæœ¬æ—¶æ·»åŠ  <code>--heap-prof</code> å‚æ•°æ¥è¿›è¡Œå†…å­˜åˆ†æã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --heap-prof</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>è¿è¡Œä½ çš„åº”ç”¨ç¨‹åºï¼š</strong><br> æ­£å¸¸ä½¿ç”¨ä½ çš„åº”ç”¨ç¨‹åºï¼Œç¡®ä¿é‡ç°é‚£äº›å¯èƒ½å¯¼è‡´å†…å­˜é—®é¢˜çš„æ“ä½œã€‚</p></li><li><p><strong>æ£€æŸ¥ç”Ÿæˆçš„å †å¿«ç…§ï¼š</strong><br> åœ¨åº”ç”¨ç¨‹åºåœæ­¢åï¼Œè¿›å…¥ç”Ÿæˆçš„ <code>Heap-</code>&lt;<code>timestamp&gt;</code>æ–‡ä»¶å¤¹ï¼Œé‡Œé¢åŒ…å«æœ‰<code>.heapprofile</code> çš„å †å¿«ç…§æ–‡ä»¶ã€‚</p></li><li><p><strong>ä½¿ç”¨åˆ†æå·¥å…·ï¼š</strong><br> æ‰“å¼€ Chrome æµè§ˆå™¨ï¼Œå»åˆ°å¼€å‘è€…å·¥å…· (DevTools) çš„ Memory éƒ¨åˆ†ï¼ŒåŠ è½½ <code>.heapprofile</code> æ–‡ä»¶è¿›è¡Œåˆ†æã€‚åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°å†…å­˜çš„åˆ†é…æƒ…å†µï¼Œå“ªäº›å¯¹è±¡å ç”¨äº†æœ€å¤šçš„å†…å­˜ï¼Œä»¥åŠå¯èƒ½çš„å†…å­˜æ³„æ¼ã€‚</p></li><li><p><strong>è¯Šæ–­å’Œä¼˜åŒ–ï¼š</strong><br> æ ¹æ®åˆ†æç»“æœï¼Œä½ å¯ä»¥ç¡®å®šå“ªéƒ¨åˆ†ä»£ç æˆ–å“ªäº›æ•°æ®ç»“æ„å¯¼è‡´äº†è¿‡é«˜çš„å†…å­˜ä½¿ç”¨ã€‚ç„¶åï¼Œä½ å¯ä»¥é’ˆå¯¹è¿™äº›åŒºåŸŸè¿›è¡Œä»£ç ä¼˜åŒ–ï¼Œä¾‹å¦‚é™åˆ¶æ•°æ®å¤§å°ã€æ”¹å–„ç®—æ³•å¤æ‚åº¦æˆ–æ¸…ç†ä¸å†éœ€è¦çš„å¯¹è±¡æ¥é‡Šæ”¾å†…å­˜ã€‚</p></li></ol><p>é€šè¿‡ä½¿ç”¨ <code>--heap-prof</code>ï¼Œä½ å¯ä»¥æ›´å¥½åœ°ç†è§£ä½ çš„ Node.js åº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶å¦‚ä½•ä½¿ç”¨å†…å­˜ï¼Œå¹¶æ‰¾åˆ°æ€§èƒ½ç“¶é¢ˆæˆ–å†…å­˜æ³„æ¼çš„æ ¹æºï¼Œä»è€Œä½¿ä½ çš„åº”ç”¨æ›´é«˜æ•ˆã€ç¨³å®šã€‚</p><h3 id="heap-prof-dir" tabindex="-1"><a class="header-anchor" href="#heap-prof-dir"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--heap-prof-dir" target="_blank" rel="noopener noreferrer">--heap-prof-dir</a></span></a></h3><p>Node.js çš„ <code>--heap-prof-dir</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼Œå®ƒä½¿å¾—ä½ å¯ä»¥åœ¨ Node.js ç¨‹åºè¿è¡Œæ—¶æ”¶é›†å…³äºå†…å­˜ä½¿ç”¨æƒ…å†µçš„ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯å †å†…å­˜ï¼ˆheap memoryï¼‰çš„ä½¿ç”¨æ•°æ®ã€‚å †å†…å­˜æ˜¯åŠ¨æ€åˆ†é…å†…å­˜çš„åŒºåŸŸï¼Œåœ¨ JavaScript ä¸­ï¼Œå¯¹è±¡å’Œé—­åŒ…ç­‰éƒ½æ˜¯å­˜æ”¾åœ¨è¿™é‡Œçš„ã€‚</p><p>å½“ä½ åœ¨è¿è¡Œ Node.js åº”ç”¨ç¨‹åºæ—¶æ·»åŠ äº† <code>--heap-prof-dir</code> å‚æ•°ï¼ŒNode.js ä¼šåœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´è®°å½•å †å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶å¤¹ä¸­ã€‚è¿™å¯¹äºæ€§èƒ½è°ƒä¼˜å’Œæ’æŸ¥å†…å­˜æ³„æ¼ï¼ˆmemory leaksï¼‰éå¸¸æœ‰ç”¨ã€‚</p><p>ä½¿ç”¨ <code>--heap-prof-dir</code> å‚æ•°çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --heap-prof-dir=./heap-profiles</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>./heap-profiles</code> æ˜¯å­˜æ”¾å †å†…å­˜ä½¿ç”¨æƒ…å†µè®°å½•æ–‡ä»¶çš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œè€Œ <code>your-app.js</code> æ˜¯ä½ æƒ³è¦è¿è¡Œçš„ Node.js ç¨‹åºçš„æ–‡ä»¶åã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›å®é™…çš„ä¾‹å­æ¥ç†è§£è¿™ä¸ªåŠŸèƒ½çš„ç”¨å¤„ï¼š</p><h3 id="å®é™…ä¾‹å­-1-æŸ¥æ‰¾å†…å­˜æ³„æ¼" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-1-æŸ¥æ‰¾å†…å­˜æ³„æ¼"><span>å®é™…ä¾‹å­ 1ï¼šæŸ¥æ‰¾å†…å­˜æ³„æ¼</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œå®ƒä¼¼ä¹éšç€æ—¶é—´çš„æ¨ç§»è€Œæ¶ˆè€—è¶Šæ¥è¶Šå¤šçš„å†…å­˜ï¼Œä½ æ€€ç–‘å¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼ã€‚ä¸ºäº†è¯Šæ–­é—®é¢˜ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>--heap-prof-dir</code> å‚æ•°æ¥æ”¶é›†åº”ç”¨ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­çš„å †å†…å­˜ä½¿ç”¨æƒ…å†µã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --heap-prof-dir=./heap-profiles</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-server.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨æœåŠ¡å™¨è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œä½ ä¼šåœ¨ <code>./heap-profiles</code> æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°å †å†…å­˜çš„å¿«ç…§æ–‡ä»¶ã€‚ç„¶åä½ å¯ä»¥ä½¿ç”¨ç‰¹å®šçš„åˆ†æå·¥å…·ï¼ˆå¦‚ Chrome å¼€å‘è€…å·¥å…·ä¸­çš„ Memory åˆ†æåŠŸèƒ½ï¼‰æ¥æŸ¥çœ‹è¿™äº›æ–‡ä»¶ï¼Œå¹¶æ‰¾å‡ºå†…å­˜æ³„æ¼çš„æ¥æºã€‚</p><h3 id="å®é™…ä¾‹å­-2-æ€§èƒ½ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-2-æ€§èƒ½ä¼˜åŒ–"><span>å®é™…ä¾‹å­ 2ï¼šæ€§èƒ½ä¼˜åŒ–</span></a></h3><p>å¦‚æœä½ æ­£åœ¨å°è¯•ä¼˜åŒ–ä½ çš„åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œäº†è§£å®ƒå¦‚ä½•ä½¿ç”¨å †å†…å­˜å¯èƒ½ä¼šå¸®åŠ©ä½ åšå‡ºæ”¹è¿›ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½å‘ç°æŸäº›å¯¹è±¡ä¸éœ€è¦é•¿æ—¶é—´ä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œæˆ–è€…æŸäº›æ•°æ®ç»“æ„å¯ä»¥æ›¿æ¢ä¸ºæ›´é«˜æ•ˆçš„ç‰ˆæœ¬ã€‚</p><p>ä½¿ç”¨ <code>--heap-prof-dir</code> å‚æ•°ï¼Œä½ å¯ä»¥åœ¨ä»£ç çš„ä¸åŒé˜¶æ®µæ•è·å†…å­˜å¿«ç…§ï¼Œæ¯”è¾ƒå¿«ç…§ä¹‹é—´çš„å·®å¼‚ï¼Œä»¥æ­¤æ¥ç¡®å®šå“ªäº›éƒ¨åˆ†çš„å†…å­˜ä½¿ç”¨æ˜¯æœ€é«˜çš„ï¼Œæˆ–è€…æ˜¯å¦æœ‰æœªé¢„æœŸçš„å†…å­˜å¢é•¿ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --heap-prof-dir=./heap-profiles</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-processing-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>é€šè¿‡æ£€æŸ¥ç”Ÿæˆçš„å †å†…å­˜å¿«ç…§ï¼Œä½ å¯ä»¥æ›´å¥½åœ°ç†è§£ç¨‹åºåœ¨å¤„ç†æ•°æ®æ—¶çš„å†…å­˜ä½¿ç”¨æ¨¡å¼ï¼Œä»è€Œè¿›è¡Œé’ˆå¯¹æ€§çš„ä¼˜åŒ–ã€‚</p><h3 id="ç»“è®º" tabindex="-1"><a class="header-anchor" href="#ç»“è®º"><span>ç»“è®º</span></a></h3><p><code>--heap-prof-dir</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…ç†è§£å’Œä¼˜åŒ–ä»–ä»¬çš„ Node.js åº”ç”¨ç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚è™½ç„¶åˆ†æå †å†…å­˜ä½¿ç”¨éœ€è¦ä¸€å®šçš„æŠ€æœ¯çŸ¥è¯†å’Œåˆ†æå·¥å…·ï¼Œä½†å®ƒæä¾›äº†æŸ¥æ‰¾å’Œä¿®å¤å†…å­˜ç›¸å…³é—®é¢˜çš„é‡è¦çº¿ç´¢ã€‚è®°ä½ï¼Œä½¿ç”¨è¿™ä¸ªå‚æ•°ä¸ä¼šå½±å“ä½ çš„ç¨‹åºçš„æ­£å¸¸è¿è¡Œï¼Œåªä¼šåœ¨ä½ æŒ‡å®šçš„ç›®å½•ä¸­ç”Ÿæˆå†…å­˜ä½¿ç”¨çš„è®°å½•ï¼Œä¾›ä½ äº‹ååˆ†æã€‚</p><h3 id="heap-prof-interval" tabindex="-1"><a class="header-anchor" href="#heap-prof-interval"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--heap-prof-interval" target="_blank" rel="noopener noreferrer">--heap-prof-interval</a></span></a></h3><p>åœ¨äº†è§£ <code>--heap-prof-interval</code> è¿™ä¸ªé€‰é¡¹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç®€å•äº†è§£ Node.js ä¸­çš„ &quot;å †å†…å­˜(heap memory)&quot; å’Œ &quot;æ€§èƒ½å‰–æ(profiling)&quot;ã€‚</p><p>å †å†…å­˜æ˜¯ JavaScript åœ¨è¿è¡Œæ—¶ç”¨äºå­˜å‚¨å¯¹è±¡å’Œå…¶ä»–ç»“æ„æ•°æ®çš„å†…å­˜åŒºåŸŸã€‚å½“ä½ åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€æ•°ç»„æˆ–è€…å‡½æ•°ç­‰ï¼Œè¿™äº›æ•°æ®éƒ½ä¼šè¢«åˆ†é…åˆ°å †å†…å­˜ä¸­ã€‚Node.js å†…å»ºçš„ V8 å¼•æ“è´Ÿè´£ç®¡ç†è¿™éƒ¨åˆ†å†…å­˜ã€‚</p><p>æ€§èƒ½å‰–ææ˜¯ä¸€ç§ç›‘æµ‹ç¨‹åºè¿è¡Œæ—¶æ€§èƒ½çš„æ‰‹æ®µï¼Œå¯ä»¥è®©å¼€å‘è€…çŸ¥é“å“ªäº›éƒ¨åˆ†çš„ä»£ç å¯èƒ½å¯¼è‡´å†…å­˜ä½¿ç”¨ä¸å½“æˆ–è€…æ‰§è¡Œæ•ˆç‡ä½ä¸‹ã€‚å…¶ä¸­ä¸€ç§æ€§èƒ½å‰–æå°±æ˜¯å †å†…å­˜å‰–æï¼ˆheap profilingï¼‰ï¼Œå®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…äº†è§£åº”ç”¨ç¨‹åºä¸­å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬å“ªäº›åœ°æ–¹åˆ†é…äº†å¤šå°‘å†…å­˜ï¼Œä»¥åŠå¯èƒ½å­˜åœ¨çš„å†…å­˜æ³„éœ²ã€‚</p><p>é‚£ä¹ˆï¼Œ<code>--heap-prof-interval</code> æ˜¯ Node.js ä¸­ä¸€ä¸ªç”¨äºè°ƒæ•´å †å†…å­˜å‰–æç²¾åº¦çš„å‘½ä»¤è¡Œé€‰é¡¹ã€‚è¿™ä¸ªé€‰é¡¹å…è®¸ä½ æŒ‡å®šåœ¨ç”Ÿæˆå †å†…å­˜å‰–ææ—¥å¿—æ—¶é‡‡æ ·çš„é—´éš”å¤§å°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒè®¾ç½®äº†åœ¨è®°å½•å †å†…å­˜åˆ†é…äº‹ä»¶æ—¶æ¯éš”å¤šå°‘å­—èŠ‚è¿›è¡Œä¸€æ¬¡é‡‡æ ·ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä½ ä¸è®¾ç½®è¿™ä¸ªé€‰é¡¹ï¼ŒV8 ä¼šåœ¨æ¯åˆ†é… 512KB çš„å †å†…å­˜åè¿›è¡Œä¸€æ¬¡é‡‡æ ·ã€‚å¦‚æœä½ æƒ³è¦æ›´è¯¦ç»†çš„å‰–æä¿¡æ¯ï¼Œä½ å¯ä»¥å‡å°è¿™ä¸ªé—´éš”å€¼ï¼›ç›¸åï¼Œå¦‚æœä½ åªéœ€è¦å¤§è‡´çš„å‰–æä¿¡æ¯ï¼Œåˆæˆ–è€…æƒ³è¦å‡å°‘å‰–æå¯¹ç¨‹åºæ€§èƒ½çš„å½±å“ï¼Œä½ å¯ä»¥å¢åŠ è¿™ä¸ªé—´éš”å€¼ã€‚</p><p>ä½¿ç”¨ <code>--heap-prof-interval</code> çš„ä¾‹å­ï¼š</p><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”ä½ æ€€ç–‘å®ƒæœ‰å†…å­˜æ³„éœ²çš„é—®é¢˜ã€‚ä½ æƒ³è¦å‰–æç¨‹åºçš„å †å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä½†æ˜¯ä½ éœ€è¦æ¯”é»˜è®¤è®¾ç½®æ›´ç²¾ç»†çš„æ•°æ®ã€‚</p><ol><li><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ä½¿ç”¨ <code>--heap-prof-interval</code>ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™å°†ä»¥é»˜è®¤çš„é‡‡æ ·é—´éš”è¿è¡Œä½ çš„åº”ç”¨ç¨‹åºã€‚</p></li><li><p>ä½¿ç”¨ <code>--heap-prof-interval</code> æ¥è®¾ç½®æ›´å°çš„é‡‡æ ·é—´éš”ï¼Œæ¯”å¦‚æ¯ 100KB å †å†…å­˜åˆ†é…åè¿›è¡Œä¸€æ¬¡é‡‡æ ·ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --heap-prof-interval=102400</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¼šä½¿å¾—å‰–ææ—¥å¿—åŒ…å«æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œå¸®åŠ©ä½ æ›´ç²¾ç¡®åœ°å®šä½å¯èƒ½çš„å†…å­˜æ³„æ¼ã€‚</p></li></ol><p>è¯·è®°ä½ï¼Œè°ƒæ•´ <code>--heap-prof-interval</code> è®¾ç½®å¯èƒ½å½±å“åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œå› ä¸ºæ›´é¢‘ç¹çš„é‡‡æ ·æ„å‘³ç€ V8 éœ€è¦åšæ›´å¤šçš„å·¥ä½œæ¥è®°å½•å†…å­˜åˆ†é…äº‹ä»¶ã€‚å› æ­¤ï¼Œåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æ—¶éœ€è¦æƒè¡¡å‰–æçš„ç²¾åº¦å’Œæ€§èƒ½çš„éœ€æ±‚ã€‚</p><h3 id="heap-prof-name" tabindex="-1"><a class="header-anchor" href="#heap-prof-name"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--heap-prof-name" target="_blank" rel="noopener noreferrer">--heap-prof-name</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒå…è®¸ä½ ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ï¼Œå°±åƒä½ åœ¨æµè§ˆå™¨ä¸­ç”¨ JavaScript ç¼–å†™å‰ç«¯ä»£ç ä¸€æ ·ã€‚Node.js éå¸¸é€‚åˆå¤„ç†å¤§é‡çš„å¹¶å‘è¿æ¥å’Œ I/O å¯†é›†å‹ä»»åŠ¡ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œå†…å­˜ç®¡ç†æ˜¯æ€§èƒ½ä¼˜åŒ–çš„é‡è¦æ–¹é¢ä¹‹ä¸€ã€‚æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ç¨‹åºå¦‚ä½•åœ¨è¿è¡Œæ—¶ä½¿ç”¨å †å†…å­˜ï¼ˆheap memoryï¼‰ï¼Œè¿™å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ£€æµ‹å’Œè§£å†³å†…å­˜æ³„æ¼ç­‰é—®é¢˜ã€‚</p><p><code>--heap-prof-name</code> æ˜¯ Node.js v21.7.1 ç‰ˆæœ¬ä¸­æä¾›çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒå…è®¸ä½ åœ¨å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„æ–‡ä»¶åï¼Œç”¨äºç”Ÿæˆå †å†…å­˜çš„æ€§èƒ½åˆ†ææŠ¥å‘Šã€‚è¿™ä¸ªæŠ¥å‘Šè¢«ç§°ä¸ºâ€œå †å¿«ç…§â€(heap snapshot)ï¼Œå®ƒè®°å½•äº†åœ¨æŸä¸€æ—¶åˆ»ç¨‹åºä¸­æ‰€æœ‰å¯¹è±¡çš„å†…å­˜åˆ†é…æƒ…å†µã€‚</p><h3 id="ä½¿ç”¨-heap-prof-name-çš„ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-heap-prof-name-çš„ä¾‹å­"><span>ä½¿ç”¨ <code>--heap-prof-name</code> çš„ä¾‹å­ï¼š</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºå«åš<code>app.js</code>ï¼Œå¹¶ä¸”æƒ³è¦åˆ†æå®ƒçš„å †å†…å­˜ä½¿ç”¨æƒ…å†µã€‚</p><ol><li><p><strong>å¯åŠ¨åº”ç”¨ç¨‹åºå¹¶ç”Ÿæˆå †å¿«ç…§</strong></p><p>åœ¨ç»ˆç«¯æˆ–å‘½ä»¤æç¤ºç¬¦ä¸­ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ä½ çš„ Node.js åº”ç”¨ç¨‹åºï¼Œå¹¶æŒ‡å®šå †å¿«ç…§çš„æ–‡ä»¶åï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --heap-prof-name=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;my_heap_snapshot.heapprofile&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤ä¼šåœ¨è¿è¡Œ<code>app.js</code>æ—¶å¯ç”¨å †å†…å­˜åˆ†æï¼Œå¹¶å°†ç”Ÿæˆçš„å †å¿«ç…§ä¿å­˜ä¸º<code>my_heap_snapshot.heapprofile</code>ã€‚</p></li><li><p><strong>åˆ†æå †å¿«ç…§</strong></p><p>ä¸€æ—¦ä½ çš„åº”ç”¨ç¨‹åºæ‰§è¡Œå®Œæ¯•æˆ–è¾¾åˆ°ä½ æƒ³è¦åˆ†æçš„çŠ¶æ€ï¼Œä½ å¯ä»¥ä½¿ç”¨å„ç§å·¥å…·ï¼Œä¾‹å¦‚ Chrome å¼€å‘è€…å·¥å…·ä¸­çš„å†…å­˜åˆ†æå™¨ï¼Œæ¥æ‰“å¼€<code>.heapprofile</code>æ–‡ä»¶è¿›è¡Œåˆ†æã€‚</p><p>åœ¨ Chrome å¼€å‘è€…å·¥å…·ä¸­ï¼š</p><ul><li>æ‰“å¼€ Chrome æµè§ˆå™¨ã€‚</li><li>æŒ‰ &quot;F12&quot; æ‰“å¼€å¼€å‘è€…å·¥å…·ã€‚</li><li>åˆ‡æ¢åˆ° â€œMemoryâ€ æ ‡ç­¾ã€‚</li><li>ç‚¹å‡» â€œLoadâ€ æŒ‰é’®ï¼Œå¹¶é€‰æ‹©ä½ çš„ <code>my_heap_snapshot.heapprofile</code> æ–‡ä»¶ã€‚</li></ul><p>è¿™æ ·ï¼Œä½ å°±å¯ä»¥çœ‹åˆ°åº”ç”¨ç¨‹åºä¸­å„ç§å¯¹è±¡çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬å“ªäº›å¯¹è±¡å ç”¨äº†å¤šå°‘å†…å­˜ã€æ˜¯å¦å­˜åœ¨æœªè¢«æ¸…ç†çš„å†…å­˜ï¼Œç­‰ç­‰ã€‚</p></li><li><p><strong>ä¼˜åŒ–ä½ çš„ä»£ç </strong></p><p>åˆ†æåï¼Œä½ å¯èƒ½å‘ç°æŸäº›å¯¹è±¡å ç”¨äº†å¼‚å¸¸å¤šçš„å†…å­˜ï¼Œæˆ–è€…å†…å­˜æ²¡æœ‰æŒ‰é¢„æœŸé‡Šæ”¾ã€‚è¿™å¯èƒ½æ˜¯å†…å­˜æ³„æ¼çš„è¿¹è±¡ã€‚æ¥ä¸‹æ¥ï¼Œä½ å¯ä»¥æ ¹æ®è¿™äº›ä¿¡æ¯è°ƒæ•´ä½ çš„ä»£ç ï¼Œå°è¯•å‡å°‘å†…å­˜ä½¿ç”¨ï¼Œæˆ–è€…ä¿®å¤å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚</p></li></ol><p>ç»¼ä¸Šæ‰€è¿°ï¼Œ<code>--heap-prof-name</code> å‘½ä»¤è¡Œé€‰é¡¹æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…é€šè¿‡ç”Ÿæˆå’Œåˆ†æå †å¿«ç…§æ¥ä¼˜åŒ–åº”ç”¨ç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚</p><h3 id="heapsnapshot-near-heap-limit-max-count" tabindex="-1"><a class="header-anchor" href="#heapsnapshot-near-heap-limit-max-count"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--heapsnapshot-near-heap-limitmax_count" target="_blank" rel="noopener noreferrer">--heapsnapshot-near-heap-limit=max_count</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚Node.js ä½¿ç”¨äº‹ä»¶é©±åŠ¨ã€éé˜»å¡ I/O æ¨¡å‹ï¼Œä½¿å…¶è½»é‡ä¸”é«˜æ•ˆã€‚</p><p>åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­ï¼Œç®¡ç†å†…å­˜æ˜¯ä¸€ä¸ªé‡è¦çš„éƒ¨åˆ†ï¼Œå› ä¸ºä¸å½“çš„å†…å­˜ä½¿ç”¨å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œç”šè‡³æ˜¯åº”ç”¨ç¨‹åºå´©æºƒã€‚<code>--heapsnapshot-near-heap-limit</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨äºåœ¨ Node.js åº”ç”¨ç¨‹åºæ¥è¿‘å †å†…å­˜é™åˆ¶æ—¶è‡ªåŠ¨ç”Ÿæˆå †å¿«ç…§ï¼ˆHeap Snapshotï¼‰ã€‚</p><p>å †å†…å­˜ï¼ˆHeap Memoryï¼‰æ˜¯ä¸€å—ç”¨äºå­˜å‚¨å¯¹è±¡ã€å­—ç¬¦ä¸²å’Œé—­åŒ…ç­‰åŠ¨æ€åˆ†é…çš„å†…å­˜åŒºåŸŸã€‚åœ¨ JavaScript ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†è¿™å—å†…å­˜çš„åˆ†é…å’Œå›æ”¶ï¼Œå› ä¸ºå®ƒæœ‰ä¸€ä¸ªåƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆGarbage Collectorï¼Œç®€ç§° GCï¼‰æ¥è‡ªåŠ¨å¤„ç†è¿™äº›ä»»åŠ¡ã€‚</p><p>ä½†æœ‰æ—¶å€™ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä¼šå› ä¸ºå„ç§åŸå› ï¼ˆå¦‚å†…å­˜æ³„æ¼ï¼‰è€Œæ¶ˆè€—è¿‡å¤šçš„å †å†…å­˜ï¼Œä½¿å¾—æ¥è¿‘ç”šè‡³è¶…å‡º V8 å¼•æ“è®¾å®šçš„å †å†…å­˜é™åˆ¶ã€‚å½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œå¦‚æœæ²¡æœ‰é€‚å½“çš„ç›‘æ§å’Œå·¥å…·ï¼Œå¯èƒ½å¾ˆéš¾æ‰¾åˆ°é—®é¢˜çš„æ ¹æºã€‚</p><p>è¿™é‡Œå°±æ˜¯ <code>--heapsnapshot-near-heap-limit=max_count</code> å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚è¿™ä¸ªé€‰é¡¹å…è®¸ä½ æŒ‡å®šåœ¨å †å†…å­˜è¾¾åˆ°å…¶æé™ä¹‹å‰ï¼Œæœ€å¤šå¯ä»¥è‡ªåŠ¨ç”Ÿæˆå¤šå°‘ä¸ªå †å¿«ç…§ã€‚å †å¿«ç…§æ˜¯å †å†…å­˜ä½¿ç”¨æƒ…å†µçš„ä¸€ä¸ªå¿«ç…§ï¼Œå®ƒè®°å½•äº†æ‰€æœ‰æ´»åŠ¨å¯¹è±¡åŠå…¶å¼•ç”¨å…³ç³»ï¼Œè¿™å¯¹äºè¯Šæ–­å†…å­˜é—®é¢˜éå¸¸æœ‰ç”¨ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”æ€€ç–‘å®ƒåœ¨è¿è¡Œä¸€æ®µæ—¶é—´åå­˜åœ¨å†…å­˜æ³„æ¼ã€‚ä¸ºäº†è°ƒæŸ¥è¿™ä¸ªé—®é¢˜ï¼Œä½ å†³å®šä½¿ç”¨ <code>--heapsnapshot-near-heap-limit</code> é€‰é¡¹æ¥å¸®åŠ©æ•è·å†…å­˜ä½¿ç”¨æƒ…å†µã€‚</p><ol><li><p>å¯åŠ¨ä½ çš„ Node.js åº”ç”¨ç¨‹åºå¹¶æ·»åŠ è¯¥é€‰é¡¹ï¼Œè®¾ç½®æœ€å¤šç”Ÿæˆ 3 ä¸ªå †å¿«ç…§ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --heapsnapshot-near-heap-limit=3</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>è®©ä½ çš„åº”ç”¨ç¨‹åºè¿è¡Œï¼Œå¹¶è¿›è¡Œæ­£å¸¸çš„æ“ä½œã€‚å¦‚æœä½ çš„åº”ç”¨ç¨‹åºç¡®å®æœ‰å†…å­˜æ³„æ¼ï¼Œéšç€æ—¶é—´çš„æ¨ç§»å®ƒå°†æ¶ˆè€—è¶Šæ¥è¶Šå¤šçš„å †å†…å­˜ã€‚</p></li><li><p>å½“åº”ç”¨ç¨‹åºçš„å †å†…å­˜ä½¿ç”¨æ¥è¿‘é™åˆ¶æ—¶ï¼ŒNode.js å°†è‡ªåŠ¨ç”Ÿæˆå †å¿«ç…§ã€‚è¿™å°†å‘ç”Ÿæœ€å¤šä¸‰æ¬¡ï¼Œå› ä¸ºæˆ‘ä»¬è®¾ç½®äº† <code>max_count</code> ä¸º 3ã€‚</p></li><li><p>åœ¨åº”ç”¨ç¨‹åºçš„åŒä¸€ç›®å½•ä¸‹ï¼Œä½ å°†æ‰¾åˆ°ç”Ÿæˆçš„å †å¿«ç…§æ–‡ä»¶ï¼ˆé€šå¸¸ä»¥ <code>.heapsnapshot</code> æ‰©å±•åç»“å°¾ï¼‰ã€‚</p></li><li><p>ä½¿ç”¨åƒ Chrome å¼€å‘è€…å·¥å…·è¿™æ ·çš„å †åˆ†æå·¥å…·æ‰“å¼€è¿™äº›å¿«ç…§æ–‡ä»¶ã€‚ä½ å¯ä»¥æ£€æŸ¥å†…å­˜ä¸­å¯¹è±¡çš„åˆ†å¸ƒï¼Œçœ‹å“ªäº›å¯¹è±¡å ç”¨äº†è¾ƒå¤šå†…å­˜ï¼Œä»¥åŠæ˜¯å¦æœ‰å¼‚å¸¸çš„å¼•ç”¨æ¨¡å¼è¡¨æ˜å¯èƒ½çš„å†…å­˜æ³„æ¼ã€‚</p></li></ol><p>é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œä½ å¯ä»¥æ›´å®¹æ˜“åœ°æ‰¾åˆ°å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼Œå¹¶ä¿®å¤å®ƒä»¬ï¼Œä»è€Œæé«˜åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚</p><h3 id="heapsnapshot-signal-signal" tabindex="-1"><a class="header-anchor" href="#heapsnapshot-signal-signal"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--heapsnapshot-signalsignal" target="_blank" rel="noopener noreferrer">--heapsnapshot-signal=signal</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå¯ä»¥è®©ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚Node.js éå¸¸é€‚åˆæ„å»ºå¿«é€Ÿçš„ã€å¯æ‰©å±•çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚</p><p>åœ¨ Node.js çš„ç‰ˆæœ¬ 21.7.1 ä¸­ï¼Œæœ‰ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ <code>--heapsnapshot-signal=signal</code>ï¼Œè¿™ä¸ªé€‰é¡¹æ˜¯ç”¨æ¥ç”Ÿæˆå †å¿«ç…§ï¼ˆheap snapshotï¼‰çš„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä»€ä¹ˆæ˜¯å †å¿«ç…§ï¼š</p><p><strong>å †å¿«ç…§ï¼ˆHeap Snapshotï¼‰</strong>ï¼š<br> å †å¿«ç…§æ˜¯å†…å­˜ç®¡ç†çš„ä¸€ç§å·¥å…·ï¼Œå®ƒè®°å½•äº†åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Š JavaScript å¼•æ“åˆ†é…çš„æ‰€æœ‰å¯¹è±¡åŠå…¶å…³ç³»çš„å¿«ç…§ã€‚é€šè¿‡åˆ†æå †å¿«ç…§ï¼Œå¼€å‘è€…å¯ä»¥è¯†åˆ«å‡ºå†…å­˜æ³„æ¼ï¼ˆmemory leaksï¼‰ã€æŸ¥çœ‹å½“å‰å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä»¥åŠå¯èƒ½å¯¼è‡´åº”ç”¨ç¨‹åºæ€§èƒ½é—®é¢˜çš„å…¶ä»–å†…å­˜ç›¸å…³é—®é¢˜ã€‚</p><p><strong><code>--heapsnapshot-signal=signal</code> é€‰é¡¹</strong>ï¼š<br> è¿™ä¸ªé€‰é¡¹å…è®¸ä½ æŒ‡å®šä¸€ä¸ªç³»ç»Ÿä¿¡å·ï¼Œå½“ Node.js è¿›ç¨‹æ¥æ”¶åˆ°è¿™ä¸ªä¿¡å·æ—¶ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå †å¿«ç…§æ–‡ä»¶ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œåœ¨ä¸ç»ˆæ­¢ä½ çš„åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹ï¼Œéšæ—¶ç”Ÿæˆå †å¿«ç…§è¿›è¡Œè°ƒè¯•å’Œåˆ†æã€‚</p><p>ç³»ç»Ÿä¿¡å·æ˜¯æ“ä½œç³»ç»Ÿä¸­ç”¨äºè¿›ç¨‹é—´é€šä¿¡çš„ä¸€ç§æœºåˆ¶ï¼Œä¾‹å¦‚ &quot;SIGUSR2&quot; åœ¨ Unix ç³»ç»Ÿä¸­æ˜¯ç”¨æˆ·å®šä¹‰çš„ä¿¡å·ä¹‹ä¸€ã€‚</p><p><strong>å®é™…ä¾‹å­</strong>ï¼š</p><p>å‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”æ€€ç–‘å®ƒæœ‰å†…å­˜æ³„æ¼é—®é¢˜ã€‚ä½ æƒ³è¦åœ¨ä¸åœæ­¢åº”ç”¨çš„æƒ…å†µä¸‹æ•è·å†…å­˜çš„çŠ¶æ€ï¼Œè¿™æ—¶ä½ å¯ä»¥ä½¿ç”¨ <code>--heapsnapshot-signal</code> é€‰é¡¹ã€‚</p><ol><li><p>å¯åŠ¨ä½ çš„ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œåœ¨å‘½ä»¤è¡Œä¸­åŠ å…¥è¿™ä¸ªé€‰é¡¹ï¼Œå‡è®¾æˆ‘ä»¬é€‰æ‹© &quot;SIGUSR2&quot; ä½œä¸ºä¿¡å·ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --heapsnapshot-signal=SIGUSR2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>å½“ä½ çš„åº”ç”¨æ­£åœ¨è¿è¡Œæ—¶ï¼Œå¦‚æœä½ æƒ³ç”Ÿæˆå †å¿«ç…§ï¼Œå¯ä»¥åœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£å‘é€ SIGUSR2 ä¿¡å·ç»™ Node.js è¿›ç¨‹ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœä½ çš„ Node.js è¿›ç¨‹çš„ PIDï¼ˆè¿›ç¨‹ IDï¼‰æ˜¯ 12345ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">kill</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -SIGUSR2</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 12345</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>å‘é€è¯¥ä¿¡å·åï¼ŒNode.js ä¼šåœ¨å®ƒçš„å½“å‰å·¥ä½œç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª <code>.heapsnapshot</code> æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å°±åŒ…å«äº†å½“æ—¶çš„å †å¿«ç…§ä¿¡æ¯ã€‚</p></li><li><p>ä½ ç°åœ¨å¯ä»¥ä½¿ç”¨åƒ Chrome å¼€å‘è€…å·¥å…·çš„ Memory åˆ†æå™¨è¿™æ ·çš„å·¥å…·æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œåˆ†æåº”ç”¨ç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µå¹¶è¯Šæ–­é—®é¢˜ã€‚</p></li></ol><p>è®°ä½ï¼Œè¿‡åº¦ä½¿ç”¨å †å¿«ç…§ä¼šå½±å“ç¨‹åºçš„æ€§èƒ½ï¼Œå› ä¸ºç”Ÿæˆå †å¿«ç…§æœ¬èº«æ˜¯ä¸€é¡¹è€—æ—¶çš„æ“ä½œï¼Œå¹¶ä¸”ä¼šçŸ­æš‚åœ°é˜»å¡ä½ çš„ Node.js è¿›ç¨‹ã€‚æ‰€ä»¥ï¼Œæœ€å¥½åœ¨ç¡®è®¤éœ€è¦æ·±å…¥åˆ†æå’Œè°ƒè¯•çš„æ—¶å€™å†ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ã€‚</p><h3 id="h-help" tabindex="-1"><a class="header-anchor" href="#h-help"><span><a href="https://nodejs.org/docs/latest/api/cli.html#-h---help" target="_blank" rel="noopener noreferrer">-h, --help</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šçš„ JavaScript ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç ã€‚Node.js æœ‰å¾ˆå¤šå‘½ä»¤è¡Œé€‰é¡¹å¯ä»¥ç”¨æ¥æ§åˆ¶å®ƒçš„è¡Œä¸ºï¼Œå…¶ä¸­ <code>-h</code> æˆ–è€… <code>--help</code> å°±æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„é€‰é¡¹ã€‚</p><p>å½“ä½ åœ¨ç»ˆç«¯ï¼ˆæˆ–å‘½ä»¤æç¤ºç¬¦ï¼‰ä¸­è¾“å…¥ <code>node -h</code> æˆ– <code>node --help</code> æ—¶ï¼ŒNode.js ä¼šæ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯åŒ…æ‹¬äº† Node.js å¯ä»¥æ¥å—çš„æ‰€æœ‰å‘½ä»¤è¡Œé€‰é¡¹å’Œæ¯ä¸ªé€‰é¡¹çš„ç®€çŸ­æè¿°ã€‚é€šè¿‡è¿™ä¸ªå¸®åŠ©é€‰é¡¹ï¼Œä½ å¯ä»¥å¿«é€Ÿäº†è§£ Node.js å‘½ä»¤è¡Œå·¥å…·çš„åŸºæœ¬ç”¨æ³•å’ŒåŠŸèƒ½ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ ä¸ç¡®å®šå¦‚ä½•ä½¿ç”¨ Node.js çš„æŸä¸ªç‰¹å®šåŠŸèƒ½ï¼Œæˆ–è€…è®°ä¸æ¸…æ¥šç‰¹å®šçš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><ol><li>æ‰“å¼€ä½ çš„ç”µè„‘ç»ˆç«¯æˆ–å‘½ä»¤æç¤ºç¬¦ã€‚</li><li>è¾“å…¥ <code>node -h</code> æˆ– <code>node --help</code>ã€‚</li><li>æŒ‰ä¸‹å›è½¦é”®ã€‚</li><li>è§‚å¯Ÿç»ˆç«¯æˆ–å‘½ä»¤æç¤ºç¬¦è¾“å‡ºçš„ä¿¡æ¯ã€‚</li></ol><p>è¾“å‡ºçš„ä¿¡æ¯å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>Usage: node [options] [script.js] [--] [arguments]</span></span>
<span class="line"><span>       node inspect [options] [script.js | -e &quot;script&quot;] [--] [arguments]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Options:</span></span>
<span class="line"><span>  -v, --version              print Node.js version</span></span>
<span class="line"><span>  -e, --eval script          evaluate script</span></span>
<span class="line"><span>  -p, --print                evaluate script and print result</span></span>
<span class="line"><span>  ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œåªå±•ç¤ºäº†å‡ ä¸ªé€‰é¡¹ï¼Œå®é™…ä¸Šä¼šæœ‰æ›´å¤šã€‚ä»¥ä¸Šé¢çš„ä¿¡æ¯ä¸ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼š</p><ul><li>ä½¿ç”¨ <code>-v</code> æˆ– <code>--version</code> é€‰é¡¹å¯ä»¥æ‰“å°å‡º Node.js çš„ç‰ˆæœ¬ã€‚</li><li>ä½¿ç”¨ <code>-e</code> æˆ– <code>--eval</code> followed by <code>script</code> é€‰é¡¹å¯ä»¥è¯„ä¼°ä¸€æ®µ JS ä»£ç ã€‚</li><li>ä½¿ç”¨ <code>-p</code> æˆ– <code>--print</code> é€‰é¡¹å¯ä»¥è¯„ä¼° JS ä»£ç å¹¶å°†ç»“æœæ‰“å°åœ¨å±å¹•ä¸Šã€‚</li></ul><p>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><ol><li><p>æŸ¥çœ‹ Node.js ç‰ˆæœ¬ï¼š<br> åœ¨ç»ˆç«¯è¾“å…¥ <code>node -v</code> æˆ– <code>node --version</code>ã€‚</p></li><li><p>æ‰§è¡Œä¸€æ®µ JavaScript ä»£ç ï¼š<br> å¦‚æœä½ æƒ³è¦å¿«é€Ÿæµ‹è¯•ä¸€å°æ®µ JavaScript ä»£ç ï¼Œæ¯”å¦‚ <code>console.log(&#39;Hello, World!&#39;)</code>ï¼Œä½ å¯ä»¥åœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node -e &quot;console.log(&#39;Hello, World!&#39;)&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™å°†ä¼šæ‰“å° <code>Hello, World!</code> åˆ°ç»ˆç«¯ã€‚</p></li><li><p>è¯„ä¼°å¹¶æ‰“å°ç»“æœï¼š<br> å‡è®¾ä½ æƒ³è®¡ç®—ä¸€ä¸ªç®€å•çš„æ•°å­¦è¡¨è¾¾å¼å¹¶ç«‹å³çœ‹åˆ°ç»“æœï¼Œæ¯”å¦‚ <code>1 + 1</code>ï¼Œä½ å¯ä»¥ç”¨ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node -p &quot;1 + 1&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™å°†ä¼šåœ¨ç»ˆç«¯æ˜¾ç¤º <code>2</code>ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œ<code>-h</code> æˆ– <code>--help</code> æ˜¯ä¸€ä¸ªæä¾›å¸®åŠ©å’ŒæŒ‡å¯¼çš„é€‰é¡¹ï¼Œå®ƒèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ Node.js çš„å‘½ä»¤è¡Œç•Œé¢ã€‚</p><h3 id="icu-data-dir-file" tabindex="-1"><a class="header-anchor" href="#icu-data-dir-file"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--icu-data-dirfile" target="_blank" rel="noopener noreferrer">--icu-data-dir=file</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>--icu-data-dir=file</code> æ˜¯ä¸€ä¸ªå¯åŠ¨å‚æ•°ï¼ˆä¹Ÿç§°ä½œå‘½ä»¤è¡Œæ ‡å¿—æˆ–é€‰é¡¹ï¼‰ï¼Œå®ƒç”¨äºæŒ‡å®š ICUï¼ˆInternational Components for Unicodeï¼‰æ•°æ®çš„å­˜å‚¨ç›®å½•ã€‚ICU æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„åº“ï¼Œå®ƒæä¾›äº† Unicode å’Œå…¨çƒåŒ–æ”¯æŒï¼Œæ¯”å¦‚å­—ç¬¦ç¼–ç è½¬æ¢ã€æ—¥æœŸã€æ—¶é—´ã€è´§å¸æ ¼å¼åŒ–ç­‰å¤šç§è¯­è¨€å’Œæ–‡åŒ–æƒ¯ä¾‹ã€‚</p><p>ä½¿ç”¨ <code>--icu-data-dir</code> è¿™ä¸ªå‚æ•°å¯ä»¥è‡ªå®šä¹‰ ICU æ•°æ®çš„ä½ç½®ï¼Œè¿™åœ¨ä½ éœ€è¦ä»ç‰¹å®šä½ç½®åŠ è½½ ICU æ•°æ®æ—¶éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚ï¼Œå½“ç³»ç»Ÿä¸Šé¢æ²¡æœ‰å®‰è£… ICU æ•°æ®ï¼Œæˆ–è€…ä½ æƒ³è¦ä½¿ç”¨ä¸åŒç‰ˆæœ¬ã€å®šåˆ¶è¿‡æˆ–æ›´å°å°ºå¯¸çš„ ICU æ•°æ®é›†æ—¶ã€‚</p><p>ä¸‹é¢æ˜¯å‡ ä¸ªå®é™…åº”ç”¨ä¸­ä½¿ç”¨ <code>--icu-data-dir</code> çš„ä¾‹å­ï¼š</p><p><strong>ä¾‹å­ 1ï¼šä½¿ç”¨å®šåˆ¶çš„ ICU æ•°æ®ç›®å½•</strong><br> å‡è®¾ä½ æœ‰ä¸€ä»½å®šåˆ¶çš„ ICU æ•°æ®å­˜æ”¾åœ¨ <code>/my/custom/icu/data</code> ç›®å½•ï¼Œå¹¶ä¸”ä½ æƒ³è¦ Node.js ä½¿ç”¨è¿™ä¸ªæ•°æ®è€Œä¸æ˜¯é»˜è®¤è·¯å¾„ä¸‹çš„æ•°æ®ã€‚ä½ å¯ä»¥è¿™æ ·å¯åŠ¨ Node.js åº”ç”¨ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --icu-data-dir=/my/custom/icu/data</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>my-app.js</code> æ˜¯ä½ çš„ Node.js åº”ç”¨ç¨‹åºå…¥å£æ–‡ä»¶ã€‚</p><p><strong>ä¾‹å­ 2ï¼šæ‰“åŒ…åº”ç”¨æ—¶æŒ‡å®š ICU æ•°æ®ç›®å½•</strong><br> å¦‚æœä½ æ­£åœ¨æ‰“åŒ…ä¸€ä¸ªå¯ä»¥åœ¨æ²¡æœ‰å®Œæ•´ ICU æ•°æ®çš„ç¯å¢ƒä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œä½ å¯èƒ½ä¼šå°† ICU æ•°æ®å’Œä½ çš„åº”ç”¨ç¨‹åºæ‰“åŒ…åˆ°ä¸€èµ·ï¼Œå¹¶å‘Šè¯‰ Node.js åœ¨å“ªé‡Œæ‰¾åˆ°è¿™äº›æ•°æ®ã€‚å‡è®¾ä½ çš„åº”ç”¨åŠå…¶ä¾èµ–çš„ ICU æ•°æ®è¢«æ‰“åŒ…åˆ° <code>/opt/my-node-app</code> ç›®å½•ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --icu-data-dir=/opt/my-node-app/icu-data</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-packed-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>ä¾‹å­ 3ï¼šèŠ‚çœç©ºé—´ä½¿ç”¨å°å‹ ICU æ•°æ®</strong><br> å¦‚æœä½ æƒ³è¦åˆ›å»ºä¸€ä¸ª Docker é•œåƒï¼Œå¹¶ä¸”æƒ³è¦é•œåƒå°½é‡å°ï¼Œä½ å¯èƒ½ä¼šé€‰æ‹©ä½¿ç”¨ä¸€ä¸ªå°å‹çš„ ICU æ•°æ®é›†è€Œä¸æ˜¯å®Œæ•´çš„æ•°æ®é›†ã€‚é¦–å…ˆï¼Œä½ ä¸‹è½½æˆ–è€…ç”Ÿæˆä¸€ä¸ªå°å‹çš„ ICU æ•°æ®é›†å¹¶å°†å…¶æ”¾åœ¨æŸä¸ªç›®å½•ï¼Œæ¯”å¦‚ <code>/small-icu-data</code>ã€‚ç„¶åä½ å¯ä»¥è¿™æ ·å¯åŠ¨ä½ çš„ Node.js åº”ç”¨ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --icu-data-dir=/small-icu-data</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-lightweight-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ çš„ Node.js åº”ç”¨ä¼šä½¿ç”¨è¾ƒå°‘çš„ç£ç›˜ç©ºé—´ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†ä¸€ä¸ªç²¾ç®€ç‰ˆçš„ ICU æ•°æ®é›†ã€‚</p><p>æ€»ç»“ï¼Œ<code>--icu-data-dir=file</code> å‚æ•°è®©ä½ æœ‰çµæ´»æ€§æ¥æ§åˆ¶ Node.js å¦‚ä½•åŠ è½½ ICU æ•°æ®ï¼Œæ— è®ºæ˜¯ä¸ºäº†å®šåˆ¶åŒ–ã€ä¼˜åŒ–æ€§èƒ½è¿˜æ˜¯é€‚åº”ç‰¹å®šçš„éƒ¨ç½²ç¯å¢ƒã€‚</p><h3 id="import-module" tabindex="-1"><a class="header-anchor" href="#import-module"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--importmodule" target="_blank" rel="noopener noreferrer">--import=module</a></span></a></h3><p>Node.js åœ¨è¿è¡Œæ—¶å…è®¸ä½ é€šè¿‡å‘½ä»¤è¡Œå‚æ•°å»åˆ¶å®šä¸€äº›è¡Œä¸ºï¼Œ<code>--import=module</code> å°±æ˜¯è¿™æ ·ä¸€ä¸ªå‚æ•°ã€‚ä½¿ç”¨è¿™ä¸ªå‚æ•°å¯ä»¥å‘Šè¯‰ Node.js åœ¨å¯åŠ¨æ—¶é¢„å…ˆåŠ è½½å¹¶æ‰§è¡ŒæŸäº›æ¨¡å—ã€‚</p><p>è¿™é‡Œçš„ <code>module</code> æ˜¯æŒ‡è¦åŠ è½½çš„æ¨¡å—çš„è·¯å¾„ã€‚è·¯å¾„å¯ä»¥æ˜¯ç›¸å¯¹çš„ä¹Ÿå¯ä»¥æ˜¯ç»å¯¹çš„ï¼Œå¹¶ä¸”æ”¯æŒ URL å½¢å¼ï¼Œä»¥ä¾¿ä»è¿œç¨‹ä½ç½®åŠ è½½æ¨¡å—ã€‚ä½¿ç”¨è¿™ä¸ªå‚æ•°çš„ç›®çš„é€šå¸¸æ˜¯ä¸ºäº†è®¾ç½®å…¨å±€çš„é…ç½®æˆ–è€…æ˜¯ä»£ç ï¼Œæˆ–æ˜¯åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­é¢„åŠ è½½ä¾èµ–ã€‚</p><h4 id="ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1"><span>ä¾‹å­</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªåä¸º <code>setup.js</code> çš„æ–‡ä»¶ï¼Œå®ƒåˆå§‹åŒ–ä¸€äº›å…¨å±€çŠ¶æ€æˆ–è€…æ˜¯ polyfillsï¼ˆæä¾›ç°ä»£åŠŸèƒ½åœ¨æ—§ç¯å¢ƒä¸‹çš„å…¼å®¹ä»£ç ï¼‰ï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶è¿™æ ·ä½¿ç”¨ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --import=./setup.js</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-main-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤ä¼šåœ¨æ‰§è¡Œ <code>your-main-app.js</code> ä¹‹å‰ï¼Œå…ˆåŠ è½½å¹¶æ‰§è¡Œ <code>setup.js</code> æ–‡ä»¶ã€‚</p><p>å†æ¯”å¦‚è¯´ï¼Œä½ æƒ³è¦å¯¼å…¥ä¸€ä¸ªé€šç”¨çš„åº“ï¼Œæ¯”å¦‚ <code>lodash</code>ï¼Œè€Œä¸”ä½ å¸Œæœ›åœ¨ä½ çš„æ‰€æœ‰æ¨¡å—ä¸­éƒ½èƒ½å¤Ÿä¸åŠ ä»»ä½• <code>require</code> æˆ– <code>import</code> ç›´æ¥ä½¿ç”¨ <code>_</code> è¿™ä¸ªå˜é‡ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ <code>global-lodash.js</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// global-lodash.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> lodash</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;lodash&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">global</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">_</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> lodash</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶ååœ¨å¯åŠ¨ä½ çš„åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --import=./global-lodash.js</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-main-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œåœ¨ <code>your-main-app.js</code> æˆ–è€…å…¶å®ƒä»»ä½•æ¨¡å—ä¸­ï¼Œä½ éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>_</code> æ¥è°ƒç”¨ <code>lodash</code> çš„æ–¹æ³•ï¼Œè€Œæ— éœ€å†æ¬¡å¯¼å…¥å®ƒã€‚</p><p>æ³¨æ„ï¼šè™½ç„¶è¿™ä¸ªç‰¹æ€§å¾ˆå¼ºå¤§ï¼Œä½†è¿‡åº¦ä½¿ç”¨å®ƒå¯èƒ½ä¼šå¯¼è‡´ä»£ç éš¾ä»¥è·Ÿè¸ªå’Œç»´æŠ¤ï¼Œå› ä¸ºå®ƒå¼•å…¥äº†ä¸€ç§éšå¼çš„ä¾èµ–å…³ç³»ï¼Œå…¶ä»–äººæŸ¥çœ‹å•ä¸ªæ–‡ä»¶æ—¶å¯èƒ½å¹¶ä¸æ¸…æ¥šæŸäº›å˜é‡æˆ–æ¨¡å—æ˜¯ä»å“ªé‡Œæ¥çš„ã€‚æ‰€ä»¥ï¼Œåœ¨è€ƒè™‘ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½æ—¶ï¼Œè¦è°¨æ…è€ƒè™‘å®ƒå¯¹é¡¹ç›®ç»“æ„çš„å½±å“ã€‚</p><h3 id="input-type-type" tabindex="-1"><a class="header-anchor" href="#input-type-type"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--input-typetype" target="_blank" rel="noopener noreferrer">--input-type=type</a></span></a></h3><p><code>--input-type=type</code> æ˜¯ä¸€ä¸ªåœ¨ Node.js å‘½ä»¤è¡Œæ¥å£ä¸­ä½¿ç”¨çš„é€‰é¡¹ï¼Œå®ƒæŒ‡å®šå½“ç›´æ¥ä»æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰è¯»å–ä»£ç æ—¶ï¼Œè¦ä½¿ç”¨çš„æ¨¡å—ç³»ç»Ÿç±»å‹ã€‚åœ¨ Node.js ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ CommonJS æˆ– ECMAScript æ¨¡å—ï¼ˆç®€ç§° ESMï¼‰ã€‚è¿™ä¸ªé€‰é¡¹å‘Šè¯‰ Node.js è§£é‡Šå™¨ä½ æ­£åœ¨æä¾›çš„æ•°æ®æ˜¯å“ªç§æ ¼å¼ã€‚</p><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œ<code>--input-type</code> é€‰é¡¹å…è®¸ä½ æŒ‡å®š <code>&#39;module&#39;</code> å¦‚æœä½ çš„è¾“å…¥åº”è¯¥è¢«å½“ä½œä¸€ä¸ª ES æ¨¡å—å¤„ç†ã€‚å¦‚æœä½ ä¸æŒ‡å®šè¿™ä¸ªé€‰é¡¹ï¼Œé»˜è®¤ä¼šè®¤ä¸ºè¾“å…¥æ˜¯ CommonJS æ ¼å¼çš„ã€‚</p><p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€äº›å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><h3 id="ç¤ºä¾‹-1-ç›´æ¥æ‰§è¡Œå­—ç¬¦ä¸²ä»£ç " tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-ç›´æ¥æ‰§è¡Œå­—ç¬¦ä¸²ä»£ç "><span>ç¤ºä¾‹ 1ï¼šç›´æ¥æ‰§è¡Œå­—ç¬¦ä¸²ä»£ç </span></a></h3><p>å‡è®¾ä½ æƒ³è¦ç›´æ¥ä»å‘½ä»¤è¡Œæ‰§è¡Œä¸€æ®µ ECMAScript æ¨¡å—è¯­æ³•çš„ JavaScript ä»£ç ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>echo</code> å‘½ä»¤å°†ä»£ç ä¼ é€’ç»™ Node.jsï¼Œå¹¶é€šè¿‡ <code>--input-type=module</code> å‘ŠçŸ¥ Node.js è¯¥ä»£ç æ˜¯ä¸€ä¸ª ESMã€‚</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;import { promises as fs } from &#39;fs&#39;; console.log(await fs.readFile(&#39;/path/to/file&#39;, &#39;utf8&#39;));&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --input-type=module</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è§£é‡Šï¼š</p><ul><li><code>echo</code> æ˜¯æ‰“å°å­—ç¬¦ä¸²çš„å‘½ä»¤ã€‚</li><li><code>&quot;import ...&quot;</code> æ˜¯è¦æ‰§è¡Œçš„ ECMAScript æ¨¡å—ä»£ç ã€‚</li><li><code>|</code> æ˜¯ç®¡é“æ“ä½œç¬¦ï¼Œå®ƒå°†å‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥ã€‚</li><li><code>node</code> æ˜¯ Node.js æ‰§è¡Œç¨‹åºã€‚</li><li><code>--input-type=module</code> å‘Šè¯‰ Node.js æˆ‘ä»¬æä¾›çš„ä»£ç æ˜¯ä¸€ä¸ª ESMã€‚</li></ul><h3 id="ç¤ºä¾‹-2-ä½¿ç”¨æ–‡ä»¶é‡å®šå‘æ‰§è¡Œæ¨¡å—ä»£ç " tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ä½¿ç”¨æ–‡ä»¶é‡å®šå‘æ‰§è¡Œæ¨¡å—ä»£ç "><span>ç¤ºä¾‹ 2ï¼šä½¿ç”¨æ–‡ä»¶é‡å®šå‘æ‰§è¡Œæ¨¡å—ä»£ç </span></a></h3><p>å¦‚æœä½ æœ‰ä¸€ä¸ªåŒ…å« ECMAScript æ¨¡å—ä»£ç çš„æ–‡ä»¶ï¼Œä½†è¯¥æ–‡ä»¶æ²¡æœ‰ <code>.mjs</code> æ‰©å±•åï¼ŒNode.js é»˜è®¤ä¸ä¼šå°†å…¶è§†ä¸º ESMã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>--input-type=module</code> å¼ºåˆ¶ Node.js å°†è¾“å…¥è§†ä¸º ESMã€‚</p><p>å‡è®¾æœ‰ä¸€ä¸ªæ–‡ä»¶å« <code>script.js</code>ï¼Œå†…éƒ¨å†™ç€ ESM ä»£ç ï¼Œåƒè¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™æ˜¯ script.js æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">promises</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> content</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">content</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»å‘½ä»¤è¡Œï¼Œä½ å¯ä»¥è¿™æ ·æ‰§è¡Œå®ƒï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --input-type=module</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è§£é‡Šï¼š</p><ul><li><code>&lt;</code> æ˜¯æ–‡ä»¶é‡å®šå‘æ“ä½œç¬¦ï¼Œå®ƒå°† <code>script.js</code> æ–‡ä»¶çš„å†…å®¹ä½œä¸º Node.js çš„è¾“å…¥ã€‚</li><li><code>--input-type=module</code> è¡¨ç¤ºå³ä½¿æ–‡ä»¶æ‰©å±•åä¸æ˜¯ <code>.mjs</code>ï¼ŒNode.js ä¹Ÿåº”è¯¥æŒ‰ç…§ ESM æ¥å¤„ç†ã€‚</li></ul><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>--input-type=type</code> é€‰é¡¹åœ¨ä¸ Node.js äº¤äº’æ—¶éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯å½“ä½ éœ€è¦æ˜ç¡®å‘Šè¯‰ Node.js ä½ çš„ä»£ç æ˜¯ä¸€ä¸ªç‰¹å®šç±»å‹çš„æ¨¡å—æ—¶ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥ç¡®ä¿ä½ çš„ä»£ç ä»¥æ­£ç¡®çš„æ¨¡å—è¯­æ³•è¢«å¤„ç†å’Œæ‰§è¡Œã€‚</p><h3 id="insecure-http-parser" tabindex="-1"><a class="header-anchor" href="#insecure-http-parser"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--insecure-http-parser" target="_blank" rel="noopener noreferrer">--insecure-http-parser</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>http</code> æ¨¡å—ç”¨äºå¤„ç† HTTP ç½‘ç»œé€šä¿¡ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js ä½¿ç”¨ä¸€ä¸ªå®‰å…¨çš„ HTTP è§£æå™¨æ¥è§£ææ”¶åˆ°çš„ HTTP è¯·æ±‚ã€‚è¿™ä¸ªè§£æå™¨éµå¾ªäº†ä¸¥æ ¼çš„æ ‡å‡†å’Œè§„èŒƒï¼Œä»¥ç¡®ä¿å¤„ç†çš„ HTTP è¯·æ±‚æ ¼å¼æ­£ç¡®ï¼Œæ²¡æœ‰å®‰å…¨é—®é¢˜ã€‚ç„¶è€Œï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šæ¥æ”¶åˆ°ä¸€äº›ä¸å®Œå…¨ç¬¦åˆ HTTP æ ‡å‡†çš„è¯·æ±‚ã€‚æ¯”å¦‚ï¼Œæœ‰äº›è€æ—§çš„å®¢æˆ·ç«¯è½¯ä»¶æˆ–è€…æœåŠ¡å¯èƒ½ä¼šç”Ÿæˆå¸¦æœ‰è½»å¾®é”™è¯¯çš„ HTTP æŠ¥æ–‡ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>--insecure-http-parser</code> æ˜¯ä¸€ä¸ªå¯åŠ¨é€‰é¡¹ï¼ˆå‘½ä»¤è¡Œå‚æ•°ï¼‰ï¼Œå¦‚æœä½ åœ¨å¯åŠ¨ Node.js æ—¶æ·»åŠ äº†è¿™ä¸ªå‚æ•°ï¼ŒNode.js å°†ä¼šä½¿ç”¨ä¸€ä¸ªä¸é‚£ä¹ˆä¸¥æ ¼çš„ HTTP è§£æå™¨æ¥è§£æè¯·æ±‚ã€‚è¿™æ„å‘³ç€å³ä½¿è¯·æ±‚ä¸å®Œå…¨ç¬¦åˆæ ‡å‡†ï¼ŒNode.js ä¹Ÿå¯èƒ½ä¼šå°è¯•è§£æå¹¶å¤„ç†å®ƒã€‚</p><p>ä½¿ç”¨ <code>--insecure-http-parser</code> çš„åœºæ™¯å¯èƒ½åŒ…æ‹¬ï¼š</p><ol><li><p>å…¼å®¹æ€§æµ‹è¯•ï¼šå½“ä½ éœ€è¦æµ‹è¯•æœåŠ¡å™¨å¦‚ä½•å“åº”æ ¼å¼ä¸å®Œå…¨æ­£ç¡®çš„ HTTP è¯·æ±‚æ—¶ã€‚</p></li><li><p>é—ç•™ç³»ç»Ÿæ”¯æŒï¼šå¦‚æœä½ æ­£åœ¨ç»´æŠ¤ä¸€ä¸ªè€ç³»ç»Ÿï¼Œå®ƒä¸éµå¾ªç°ä»£æ ‡å‡†çš„ç³»ç»Ÿäº¤äº’æœ‰å›°éš¾ï¼Œé‚£ä¹ˆä½¿ç”¨è¿™ä¸ªå‚æ•°å¯ä»¥ä½œä¸ºä¸´æ—¶è§£å†³æ–¹æ¡ˆã€‚</p></li><li><p>æ€§èƒ½æµ‹è¯•ï¼šå°½ç®¡ä¸å»ºè®®è¿™æ ·åšï¼Œä½†ä½ å¯èƒ½æƒ³çŸ¥é“åœ¨æ”¾å®½å®‰å…¨é™åˆ¶åï¼Œç³»ç»Ÿçš„æ€§èƒ½è¡¨ç°å¦‚ä½•ã€‚</p></li><li><p>è°ƒè¯•ï¼šå½“ä½ è°ƒè¯•ä¸€ä¸ªå¤æ‚çš„é—®é¢˜ï¼Œéœ€è¦è¯¦ç»†äº†è§£è¯·æ±‚çš„è§£æè¿‡ç¨‹æ—¶ã€‚</p></li></ol><p>å®é™…ä½¿ç”¨ç¤ºä¾‹ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --insecure-http-parser</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ å°†é€šè¿‡å‘½ä»¤è¡Œå¯åŠ¨åä¸º <code>your-script.js</code> çš„ Node.js è„šæœ¬ï¼Œå¹¶ä¼ é€’ <code>--insecure-http-parser</code> é€‰é¡¹æ¥å‘Šè¯‰ Node.js ä½¿ç”¨ä¸å®‰å…¨çš„ HTTP è§£æå™¨ã€‚</p><p>é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œä½¿ç”¨ <code>--insecure-http-parser</code> ä¼šå¢åŠ æ¥å—æ½œåœ¨æ¶æ„ HTTP è¯·æ±‚çš„é£é™©ï¼Œå› æ­¤åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åº”è¯¥è°¨æ…ä½¿ç”¨ã€‚è¿™ä¸ªé€‰é¡¹ä¸»è¦æ˜¯ä¸ºäº†å‘åå…¼å®¹å’Œè°ƒè¯•ç”¨é€”ï¼Œè€Œä¸æ˜¯æ¨èçš„å¸¸è§„åšæ³•ã€‚å§‹ç»ˆä¼˜å…ˆè€ƒè™‘æ›´æ–°å®¢æˆ·ç«¯æˆ–æœåŠ¡ä»¥éµå¾ªå½“å‰çš„ HTTP æ ‡å‡†ã€‚</p><h3 id="inspect-host-port" tabindex="-1"><a class="header-anchor" href="#inspect-host-port"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--inspecthostport" target="_blank" rel="noopener noreferrer">--inspect[=[host:]port]</a></span></a></h3><p><code>--inspect[=[host:]port]</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒç”¨æ¥å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºçš„è°ƒè¯•å™¨ã€‚ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªé€‰é¡¹è®©ä½ çš„åº”ç”¨åœ¨å¯åŠ¨æ—¶ç«‹å³æ‰“å¼€ä¸€ä¸ªè°ƒè¯•æœåŠ¡å™¨ï¼Œç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨æ”¯æŒ Chrome DevTools åè®®çš„è°ƒè¯•å®¢æˆ·ç«¯æ¥è¿æ¥åˆ°è¿™ä¸ªæœåŠ¡å™¨ä¸Šï¼Œè¿›è¡Œä»£ç æ–­ç‚¹è®¾ç½®ã€æ­¥è¿›æ‰§è¡Œã€å˜é‡æ£€æŸ¥ç­‰è°ƒè¯•æ“ä½œã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä¼šè§£é‡Šå¦‚ä½•ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œä»¥åŠä¸€äº›å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><h3 id="åŸºæœ¬ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ç”¨æ³•"><span>åŸºæœ¬ç”¨æ³•</span></a></h3><p>å½“ä½ ä½¿ç”¨ <code>node</code> å‘½ä»¤å¯åŠ¨ä¸€ä¸ªåº”ç”¨æ—¶ï¼Œä¾‹å¦‚ <code>node app.js</code>ï¼Œå¦‚æœä½ æƒ³è¦è°ƒè¯•è¿™ä¸ªåº”ç”¨ï¼Œä½ å¯ä»¥æ·»åŠ  <code>--inspect</code> æ ‡å¿—ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --inspect</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·åšä¼šåœ¨é»˜è®¤çš„è°ƒè¯•ç«¯å£ï¼ˆ9229ï¼‰ä¸Šå¯åŠ¨ä¸€ä¸ªè°ƒè¯•æœåŠ¡å™¨ã€‚</p><h3 id="æŒ‡å®šä¸»æœºå’Œç«¯å£" tabindex="-1"><a class="header-anchor" href="#æŒ‡å®šä¸»æœºå’Œç«¯å£"><span>æŒ‡å®šä¸»æœºå’Œç«¯å£</span></a></h3><p>å¦‚æœä½ éœ€è¦æŒ‡å®šç›‘å¬çš„ä¸»æœºåœ°å€å’Œç«¯å£å·ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --inspect=127.0.0.1:9230</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤è®© Node.js åœ¨æœ¬åœ°æœºå™¨çš„ 9230 ç«¯å£ä¸Šå¯åŠ¨è°ƒè¯•æœåŠ¡å™¨ã€‚å¦‚æœä½ çœç•¥äº†ä¸»æœºåœ°å€ï¼Œå°±åƒè¿™æ ·ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --inspect=:9230</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>é‚£ä¹ˆï¼ŒNode.js å°†ä¼šç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ä¸Šçš„ 9230 ç«¯å£ï¼Œå…è®¸ä»»ä½•èƒ½å¤Ÿè®¿é—®ä½ æœºå™¨çš„è®¾å¤‡è¿æ¥åˆ°è°ƒè¯•æœåŠ¡å™¨ã€‚</p><h3 id="è¿æ¥è°ƒè¯•å®¢æˆ·ç«¯" tabindex="-1"><a class="header-anchor" href="#è¿æ¥è°ƒè¯•å®¢æˆ·ç«¯"><span>è¿æ¥è°ƒè¯•å®¢æˆ·ç«¯</span></a></h3><p>å½“ä½ çš„åº”ç”¨ä»¥ <code>--inspect</code> æ¨¡å¼å¯åŠ¨ä¹‹åï¼Œä½ å¯ä»¥ä½¿ç”¨æµè§ˆå™¨æˆ–å…¶ä»–æ”¯æŒçš„è°ƒè¯•å·¥å…·è¿æ¥åˆ°è°ƒè¯•æœåŠ¡å™¨ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨æœ€æ–°ç‰ˆçš„ Google Chrome æµè§ˆå™¨ï¼š</p><ol><li>æ‰“å¼€ Chromeã€‚</li><li>åœ¨åœ°å€æ è¾“å…¥ <code>chrome://inspect</code> å¹¶å›è½¦ã€‚</li><li>åœ¨ &quot;Discover network targets&quot; éƒ¨åˆ†ç‚¹å‡» &quot;Configure...&quot;ã€‚</li><li>æ·»åŠ ä½ çš„ä¸»æœºå’Œç«¯å£ä¿¡æ¯ï¼Œæ¯”å¦‚ <code>localhost:9230</code>ã€‚</li><li>è¿”å› <code>chrome://inspect</code> é¡µé¢ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°ä½ çš„ Node.js åº”ç”¨å·²ç»å‡ºç°åœ¨ &quot;Remote Target&quot; åˆ—è¡¨ä¸­ã€‚</li><li>ç‚¹å‡» &quot;inspect&quot; é“¾æ¥å³å¯æ‰“å¼€ DevTools è°ƒè¯•ç•Œé¢ã€‚</li></ol><h3 id="å®é™…è¿ç”¨ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-2"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç®€å•çš„ web åº”ç”¨ï¼Œä½ å¸Œæœ›è°ƒè¯•åœ¨æœåŠ¡å™¨ç«¯å¤„ç† HTTP è¯·æ±‚çš„é€»è¾‘ã€‚ä½ çš„æ–‡ä»¶åä¸º <code>server.js</code>ï¼Œä½ å¯ä»¥è¿™æ ·å¯åŠ¨ä½ çš„åº”ç”¨ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --inspect</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> server.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç„¶åæŒ‰ç…§ä¸Šè¿°æ­¥éª¤ä½¿ç”¨ Chrome çš„ <code>chrome://inspect</code> å·¥å…·è¿æ¥åˆ°ä½ çš„åº”ç”¨ã€‚åœ¨ DevTools ä¸­ï¼Œä½ å¯ä»¥åœ¨ä½ çš„ä»£ç ä¸­æ”¾ç½®æ–­ç‚¹ï¼Œä¾‹å¦‚åœ¨å¤„ç†æŸä¸ªç‰¹å®šè·¯ç”±çš„å‡½æ•°ä¸­ã€‚å½“è¿™ä¸ªè·¯ç”±è¢«è¯·æ±‚æ—¶ï¼ŒNode.js å°†ä¼šåœ¨é‚£ä¸ªæ–­ç‚¹å¤„æš‚åœæ‰§è¡Œï¼Œå…è®¸ä½ æ£€æŸ¥å˜é‡å€¼ã€è°ƒç”¨å †æ ˆç­‰ã€‚</p><p>è°ƒè¯•æ˜¯ç¼–ç¨‹ä¸­éå¸¸å…³é”®çš„éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒå…è®¸ä½ ç†è§£ä»£ç æ˜¯å¦‚ä½•è¿è¡Œçš„ï¼Œä¹Ÿå¸®åŠ©ä½ è¿½è¸ªå’Œä¿®å¤é”™è¯¯ã€‚ä½¿ç”¨ Node.js çš„ <code>--inspect</code> åŠŸèƒ½å°†å¤§å¤§æé«˜ä½ è°ƒè¯• Node.js åº”ç”¨çš„æ•ˆç‡ã€‚</p><h4 id="warning-binding-inspector-to-a-public-ip-port-combination-is-insecure" tabindex="-1"><a class="header-anchor" href="#warning-binding-inspector-to-a-public-ip-port-combination-is-insecure"><span><a href="https://nodejs.org/docs/latest/api/cli.html#warning-binding-inspector-to-a-public-ipport-combination-is-insecure" target="_blank" rel="noopener noreferrer">Warning: binding inspector to a public IP:port combination is insecure</a></span></a></h4><p>å¥½çš„ï¼Œè®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹è¿™ä¸ªè­¦å‘Šä¿¡æ¯ã€‚</p><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªå†…ç½®æ¨¡å—å«åš <code>inspector</code>ã€‚è¿™ä¸ªæ¨¡å—ç”¨äºæä¾›è°ƒè¯•å™¨æ”¯æŒï¼Œå®ƒå…è®¸å¼€å‘è€…è¿æ¥åˆ°æ­£åœ¨è¿è¡Œçš„ Node.js è¿›ç¨‹ï¼Œä»¥ä¾¿å¯ä»¥è¿›è¡Œä»£ç æ–­ç‚¹ã€æ€§èƒ½åˆ†æç­‰è°ƒè¯•æ“ä½œã€‚</p><p>å½“ä½ å¯åŠ¨ Node.js åº”ç”¨æ—¶ï¼Œé€šå¸¸ä½ ä¼šåœ¨æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œå’Œè°ƒè¯•å®ƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ é€šå¸¸åªå…è®¸æ¥è‡ªåŒä¸€å°ç”µè„‘çš„è¿æ¥è¯·æ±‚ã€‚è¿™æ ·ï¼Œä½ çš„è°ƒè¯•ç«¯å£ä¸ä¼šå¯¹å¤–ç•Œæš´éœ²ï¼Œä»è€Œä¿è¯äº†å®‰å…¨æ€§ã€‚</p><p>ç„¶è€Œï¼Œå¦‚æœä½ é…ç½® Node.js åº”ç”¨ï¼Œä½¿å¾—å®ƒçš„è°ƒè¯•å™¨ä¸ä»…ç»‘å®šåˆ°æœ¬åœ° IPï¼ˆå¦‚ï¼š127.0.0.1 æˆ– localhostï¼‰ï¼Œè€Œä¸”ç»‘å®šåˆ°äº†ä¸€ä¸ªå…¬å…±çš„ IP åœ°å€å’Œç«¯å£ç»„åˆä¸Šï¼Œé‚£ä¹ˆä»»ä½•ç½‘ç»œä¸Šçš„äººéƒ½å¯èƒ½å°è¯•è¿æ¥åˆ°ä½ çš„è°ƒè¯•å™¨ã€‚è¿™æ ·åšæ˜¯éå¸¸ä¸å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒå¯èƒ½å¯¼è‡´æœªæˆæƒçš„è®¿é—®ï¼Œç”šè‡³å…è®¸æ¶æ„ç”¨æˆ·æ‰§è¡Œä»£ç æˆ–è€…æ›´æ”¹æ­£åœ¨è¿è¡Œä¸­çš„åº”ç”¨ç¨‹åºã€‚</p><p>ç°åœ¨ï¼Œå‡è®¾ä»¥ä¸‹å‡ ä¸ªåœºæ™¯ï¼š</p><ol><li><p><strong>æœ¬åœ°å¼€å‘</strong>ï¼š</p><ul><li>å®‰å…¨æ–¹å¼ï¼šåªåœ¨ <code>localhost</code> ä¸Šç›‘å¬è°ƒè¯•ç«¯å£ï¼Œæ¯”å¦‚é€šè¿‡å‘½ä»¤ <code>node --inspect=localhost:9229 your-app.js</code> å¯åŠ¨åº”ç”¨ã€‚</li><li>ä¸å®‰å…¨æ–¹å¼ï¼šåœ¨å…¬ç½‘ IP ä¸Šç›‘å¬ï¼Œå¦‚ <code>node --inspect=0.0.0.0:9229 your-app.js</code>ï¼Œè¿™å°†å…è®¸ä»»ä½•çŸ¥é“æ­¤ IP å’Œç«¯å£çš„äººå°è¯•è¿æ¥è°ƒè¯•å™¨ã€‚</li></ul></li><li><p><strong>è¿œç¨‹æœåŠ¡å™¨</strong>ï¼š</p><ul><li>å®‰å…¨æ–¹å¼ï¼šä½¿ç”¨ SSH ç«¯å£è½¬å‘æ¥å®‰å…¨åœ°å°†è¿œç¨‹æœåŠ¡å™¨çš„è°ƒè¯•ç«¯å£æ˜ å°„åˆ°æœ¬åœ°æœºå™¨ã€‚</li><li>ä¸å®‰å…¨æ–¹å¼ï¼šç›´æ¥åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„å…¬ç½‘ IP ä¸Šå¯åŠ¨è°ƒè¯•æ¨¡å¼ï¼Œè¿™æ ·åšä¼šå°†ä½ çš„è°ƒè¯•ç«¯å£æš´éœ²ç»™æ•´ä¸ªäº’è”ç½‘ã€‚</li></ul></li><li><p><strong>å®¹å™¨åŒ–éƒ¨ç½²ï¼ˆå¦‚ï¼šä½¿ç”¨ Dockerï¼‰</strong>ï¼š</p><ul><li>å®‰å…¨æ–¹å¼ï¼šç¡®ä¿ Docker å®¹å™¨å†…çš„æœåŠ¡åªåœ¨æœ¬åœ°å›ç¯åœ°å€ä¸Šæš´éœ²è°ƒè¯•ç«¯å£ï¼Œå¹¶ä¸”åœ¨éœ€è¦æ—¶ä½¿ç”¨å®‰å…¨çš„æ–¹æ³•è¿æ¥åˆ°å®¹å™¨å†…çš„æœåŠ¡ã€‚</li><li>ä¸å®‰å…¨æ–¹å¼ï¼šåœ¨ Docker å®¹å™¨é…ç½®ä¸­å°†è°ƒè¯•ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„å…¬å…± IPï¼Œè¿™å°†ä½¿å¾—è°ƒè¯•ç«¯å£å¯¹æ‰€æœ‰èƒ½å¤Ÿè®¿é—®è¯¥å…¬å…± IP çš„ç”¨æˆ·å¯è§ã€‚</li></ul></li></ol><p>æ€»ç»“ä¸€ä¸‹ï¼ŒNode.js v21.7.1 ä¸­çš„è¿™ä¸ªè­¦å‘Šæ˜¯åœ¨å‘Šè¯‰ä½ ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä¸è¦å°† Node.js çš„ <code>inspector</code> ç»„ä»¶ç»‘å®šåˆ°å…¬å…±çš„ IP åœ°å€å’Œç«¯å£ä¸Šï¼Œé™¤éä½ å®Œå…¨æ¸…æ¥šå¹¶èƒ½å¤Ÿæ§åˆ¶ç›¸å…³çš„å®‰å…¨é£é™©ã€‚æœ€ä½³å®è·µæ˜¯ï¼Œå§‹ç»ˆä»…åœ¨æœ¬åœ°ç¯å¢ƒæˆ–è€…é€šè¿‡å®‰å…¨éš§é“ï¼ˆä¾‹å¦‚ SSHï¼‰æš´éœ²è°ƒè¯•ç«¯å£ï¼Œé˜²æ­¢æ½œåœ¨çš„å®‰å…¨å¨èƒã€‚</p><h3 id="inspect-brk-host-port" tabindex="-1"><a class="header-anchor" href="#inspect-brk-host-port"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--inspect-brkhostport" target="_blank" rel="noopener noreferrer">--inspect-brk[=[host:]port]</a></span></a></h3><p><code>--inspect-brk[=[host:]port]</code> æ˜¯ä¸€ä¸ª Node.js åœ¨å¯åŠ¨æ—¶å¯ä»¥ä½¿ç”¨çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒå…è®¸ä½ è°ƒè¯•ä½ çš„ Node.js åº”ç”¨ç¨‹åºã€‚å½“ä½ åœ¨å‘½ä»¤è¡Œä¸­å¯åŠ¨ Node.js å¹¶åŠ ä¸Šè¿™ä¸ªå‚æ•°åï¼ŒNode.js ä¼šåœ¨æ‰§è¡Œä»»ä½•ä»£ç ä¹‹å‰æš‚åœï¼ˆæ–­ç‚¹ï¼‰ï¼Œè¿™æ ·å°±ç»™ä½ æœºä¼šèƒ½å¤Ÿä½¿ç”¨è°ƒè¯•å™¨è¿æ¥åˆ°ç¨‹åºï¼Œå¹¶ä¸”è®¾ç½®æ–­ç‚¹ã€æ£€æŸ¥å˜é‡ç­‰ã€‚</p><p>ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ä¼šè‡ªåŠ¨æ‰“å¼€ Node.js çš„è°ƒè¯•å™¨æœåŠ¡å™¨ï¼Œå®ƒä¼šç›‘å¬æŒ‡å®šçš„ä¸»æœºå’Œç«¯å£ã€‚å¦‚æœæ²¡æœ‰æä¾›ä¸»æœºå’Œç«¯å£ï¼ŒNode.js å°†ä½¿ç”¨é»˜è®¤å€¼ï¼ˆé€šå¸¸æ˜¯ <code>127.0.0.1:9229</code>ï¼‰ã€‚</p><p>ä¸‹é¢ä¸¾å‡ ä¸ªå…·ä½“çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•åœ¨å®é™…ä¸­ä½¿ç”¨ <code>--inspect-brk</code>ï¼š</p><p><strong>ä¾‹å­ 1ï¼šä½¿ç”¨é»˜è®¤ç«¯å£å¯åŠ¨è°ƒè¯•</strong></p><p>å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºæ¯”å¦‚ <code>app.js</code> å¹¶æƒ³è¦è°ƒè¯•å®ƒï¼Œä½ å¯ä»¥åœ¨ç»ˆç«¯ï¼ˆå‘½ä»¤è¡Œç•Œé¢ï¼‰ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --inspect-brk</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™å°†å¯åŠ¨ Node.js çš„è°ƒè¯•æœåŠ¡å™¨ï¼Œå¹¶ä¸”åœ¨å¼€å§‹æ‰§è¡Œ <code>app.js</code> ä¸­çš„ä»»ä½•ä»£ç ä¹‹å‰æš‚åœã€‚ç„¶åä½ å¯ä»¥æ‰“å¼€ Chrome æµè§ˆå™¨ï¼Œè¾“å…¥ <code>chrome://inspect</code> åœ¨ Chrome çš„å†…ç½®è°ƒè¯•å·¥å…·ä¸­æŸ¥çœ‹è¿è¡Œçš„ Node.js è¿›ç¨‹ã€‚ç‚¹å‡» <code>inspect</code> é“¾æ¥å°±å¯ä»¥æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œè¿›è¡Œä»£ç çš„æ–­ç‚¹ã€å•æ­¥æ‰§è¡ŒåŠå˜é‡çš„æ£€æŸ¥ç­‰ã€‚</p><p><strong>ä¾‹å­ 2ï¼šæŒ‡å®šç«¯å£å¯åŠ¨è°ƒè¯•</strong></p><p>å¦‚æœä½ æƒ³è¦è®©è°ƒè¯•æœåŠ¡å™¨ç›‘å¬å…¶ä»–ç«¯å£ï¼Œæ¯”å¦‚<code>1234</code>ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --inspect-brk=1234</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œä½ å‘Šè¯‰ Node.js åœ¨å¯åŠ¨æ—¶æ‰“å¼€è°ƒè¯•æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç›‘å¬æœ¬åœ°çš„ 1234 ç«¯å£ã€‚åŒæ ·åœ°ï¼Œä½ éœ€è¦ä½¿ç”¨è°ƒè¯•å·¥å…·è¿æ¥åˆ°è¿™ä¸ªç«¯å£ä»¥å¼€å§‹è°ƒè¯•ã€‚</p><p><strong>ä¾‹å­ 3ï¼šæŒ‡å®šä¸»æœºå’Œç«¯å£å¯åŠ¨è°ƒè¯•</strong></p><p>å¦‚æœä½ å¤„äºç½‘ç»œç¯å¢ƒä¸­ï¼Œå¯èƒ½éœ€è¦æŒ‡å®šç‰¹å®šçš„ä¸»æœºåœ°å€æ¥ç¡®ä¿è°ƒè¯•æœåŠ¡å™¨åªå¯¹æŸäº›ç½‘ç»œå¯è§ã€‚ä¾‹å¦‚ï¼Œåœ¨å±€åŸŸç½‘çš„ IP åœ°å€æ˜¯<code>192.168.1.5</code>çš„è®¡ç®—æœºä¸Šï¼Œä½ æƒ³è¦ç›‘å¬ç«¯å£<code>5678</code>ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --inspect-brk=192.168.1.5:5678</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·åšä¼šä½¿å¾—è°ƒè¯•æœåŠ¡å™¨ç›‘å¬åœ¨ <code>192.168.1.5</code> IP åœ°å€ä¸Šçš„ <code>5678</code> ç«¯å£ï¼Œè€Œä¸æ˜¯åªåœ¨æœ¬åœ°è®¡ç®—æœºä¸Šã€‚ä½ éœ€è¦åœ¨åŒä¸€å±€åŸŸç½‘å†…çš„å¦ä¸€å°è®¡ç®—æœºçš„è°ƒè¯•å·¥å…·ä¸­è¿æ¥åˆ°è¿™ä¸ªåœ°å€å’Œç«¯å£è¿›è¡Œè°ƒè¯•ã€‚</p><p><strong>æ³¨æ„ï¼š</strong></p><ol><li>è°ƒè¯•æ—¶ï¼Œè¯·ç¡®ä¿ä½ çš„é˜²ç«å¢™è®¾ç½®å…è®¸ä½ é€‰æ‹©çš„ç«¯å£é€šä¿¡ã€‚</li><li>ä½¿ç”¨è°ƒè¯•æ¨¡å¼æ—¶è¦å°å¿ƒï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šæš´éœ²æ•æ„Ÿä¿¡æ¯ï¼Œä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ— æ„ä¸­å¯ç”¨å®ƒã€‚</li></ol><h3 id="inspect-port-host-port" tabindex="-1"><a class="header-anchor" href="#inspect-port-host-port"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--inspect-porthostport" target="_blank" rel="noopener noreferrer">--inspect-port=[host:]port</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘ä¼šå°½é‡ç”¨é€šä¿—æ˜“æ‡‚çš„è¯­è¨€æ¥è§£é‡Š Node.js ä¸­çš„ <code>--inspect-port</code> é€‰é¡¹ã€‚</p><p>é¦–å…ˆï¼ŒNode.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ JavaScript ç¯å¢ƒï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™åå°æœåŠ¡ã€‚è€Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè°ƒè¯•æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ç¯èŠ‚ã€‚Node.js æä¾›äº†ä¸€ç§å†…ç½®çš„è°ƒè¯•åŠŸèƒ½ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥æ›´åŠ æ–¹ä¾¿åœ°æ£€æŸ¥ä»£ç å’Œç›‘æ§è¿è¡Œæ—¶çš„çŠ¶æ€ã€‚</p><p><code>--inspect-port</code> å°±æ˜¯ä¸ Node.js çš„è¿™ä¸€è°ƒè¯•åŠŸèƒ½ç›¸å…³çš„ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ã€‚å½“ä½ å¯åŠ¨ Node.js åº”ç”¨æ—¶é€šè¿‡æ·»åŠ è¿™ä¸ªé€‰é¡¹ï¼Œä½ å¯ä»¥æŒ‡å®šè°ƒè¯•å™¨ç›‘å¬çš„ç«¯å£ï¼ˆä»¥åŠå¯é€‰çš„ä¸»æœºåï¼‰ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†è®©å¤–éƒ¨çš„è°ƒè¯•å·¥å…·ï¼Œæ¯”å¦‚ Chrome DevTools æˆ– VSCode è°ƒè¯•å™¨ï¼Œèƒ½å¤Ÿè¿æ¥åˆ°ä½ çš„ Node.js åº”ç”¨ï¼Œå¹¶å¯¹å…¶è¿›è¡Œå®æ—¶çš„è°ƒè¯•ã€‚</p><p>ç°åœ¨æˆ‘æ¥è¯¦ç»†è§£é‡Š <code>--inspect-port=[host:]port</code> è¿™ä¸ªé€‰é¡¹ï¼š</p><ul><li><code>--inspect-port=</code>ï¼šè¿™éƒ¨åˆ†å‘Šè¯‰ Node.js ä½ æƒ³è¦ä½¿ç”¨è°ƒè¯•åŠŸèƒ½ã€‚</li><li><code>[host:]</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„å‚æ•°ï¼Œå…è®¸ä½ æŒ‡å®šä¸€ä¸ªä¸»æœºåï¼ˆä¾‹å¦‚ä½ çš„æœ¬åœ°è®¡ç®—æœºçš„ IP åœ°å€æˆ–è€…ä¸€ä¸ªåŸŸåï¼‰ã€‚å¦‚æœä½ ä¸æŒ‡å®šå®ƒï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè°ƒè¯•å™¨åªæ¥å—æœ¬æœºï¼ˆlocalhostï¼‰ä¸Šçš„è¿æ¥ã€‚</li><li><code>port</code>ï¼šè¿™é‡Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªç«¯å£å·ï¼Œè¿™ä¸ªç«¯å£å·å°±æ˜¯å¤–éƒ¨è°ƒè¯•å·¥å…·ç”¨æ¥è¿æ¥ä½ çš„ Node.js åº”ç”¨çš„â€œé—¨â€ã€‚æ¯ä¸ªåº”ç”¨éƒ½éœ€è¦ç”¨ä¸åŒçš„ç«¯å£å·ï¼Œä»¥é¿å…å†²çªã€‚</li></ul><p>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><ol><li>å‡è®¾ä½ æ­£åœ¨æœ¬åœ°å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œä½ å¸Œæœ›èƒ½å¤Ÿè°ƒè¯•è¿™ä¸ªåº”ç”¨ã€‚ä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¿™æ ·å¯åŠ¨ä½ çš„åº”ç”¨ï¼š</li></ol><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --inspect=9229</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·ä½ å°±è®¾ç½®äº†è°ƒè¯•å™¨ç«¯å£ä¸º <code>9229</code>ã€‚ä¹‹åï¼Œä½ å¯ä»¥æ‰“å¼€ Chrome æµè§ˆå™¨ï¼Œè¾“å…¥ <code>chrome://inspect</code> å¹¶ä¸”æ‰¾åˆ°ä½ çš„ Node.js åº”ç”¨ï¼Œä»è€Œå¼€å§‹è°ƒè¯•ã€‚</p><ol start="2"><li>å¦‚æœä½ æƒ³å…è®¸å…¶ä»–ç”µè„‘ä¹Ÿèƒ½å¤Ÿè¿æ¥åˆ°ä½ çš„è°ƒè¯•å™¨ï¼ˆæ¯”å¦‚å½“ä½ åœ¨å±€åŸŸç½‘ä¸­å·¥ä½œæ—¶ï¼‰ï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªä¸»æœºåï¼š</li></ol><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --inspect-port=192.168.1.5:9229</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™é‡Œ <code>192.168.1.5</code> æ˜¯ä½ ä¸»æœºçš„å±€åŸŸç½‘ IP åœ°å€ï¼Œå…¶ä»–ç”µè„‘å¯ä»¥ä½¿ç”¨è¿™ä¸ªåœ°å€å’Œç«¯å£ <code>9229</code> æ¥è¿æ¥ä½ çš„è°ƒè¯•å™¨ã€‚</p><ol start="3"><li>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœä½ æ²¡æœ‰æŒ‡å®šç«¯å£ï¼ŒNode.js ä¼šè‡ªåŠ¨ä¸ºè°ƒè¯•å™¨é€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„ç«¯å£ã€‚ä¾‹å¦‚ï¼š</li></ol><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --inspect</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥åœ¨ç»ˆç«¯ï¼ˆå‘½ä»¤è¡Œç•Œé¢ï¼‰çš„è¾“å‡ºä¸­çœ‹åˆ° Node.js ç»™å‡ºçš„ç«¯å£å·ã€‚</p><p>å¸Œæœ›è¿™äº›è§£é‡Šå’Œä¾‹å­èƒ½å¸®åŠ©ä½ ç†è§£ <code>--inspect-port</code> é€‰é¡¹æ˜¯å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨çš„ã€‚</p><h3 id="inspect-publish-uid-stderr-http" tabindex="-1"><a class="header-anchor" href="#inspect-publish-uid-stderr-http"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--inspect-publish-uidstderrhttp" target="_blank" rel="noopener noreferrer">--inspect-publish-uid=stderr,http</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªå…è®¸å¼€å‘è€…ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç çš„è¿è¡Œç¯å¢ƒã€‚å®ƒé€šå¸¸ç”¨äºåˆ›å»ºå„ç§ç½‘ç»œåº”ç”¨ï¼Œå¦‚ç½‘ç«™åç«¯æœåŠ¡ã€API æˆ–å®æ—¶é€šä¿¡åº”ç”¨ç­‰ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>--inspect-publish-uid</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼ˆCLIï¼‰ï¼Œå®ƒä¸ Node.js çš„è°ƒè¯•åŠŸèƒ½æœ‰å…³ã€‚å½“ä½ è¿è¡Œä¸€ä¸ª Node.js åº”ç”¨å¹¶å¸Œæœ›è¿›è¡Œè°ƒè¯•æ—¶ï¼Œé€šå¸¸éœ€è¦å¯åŠ¨ä¸€ä¸ªç‰¹æ®Šçš„è°ƒè¯•å™¨ç›‘å¬å™¨ã€‚è¿™å¯ä»¥é€šè¿‡æ·»åŠ  <code>--inspect</code> æˆ– <code>--inspect-brk</code> æ ‡å¿—åˆ° Node.js å¯åŠ¨å‘½ä»¤æ¥å®ç°ã€‚è¿™æ ·åšä¼šå¼€å¯ä¸€ä¸ª WebSocket æœåŠ¡å™¨ï¼Œå…è®¸è°ƒè¯•å®¢æˆ·ç«¯ï¼ˆå¦‚ Chrome å¼€å‘è€…å·¥å…·ï¼‰è¿æ¥åˆ°å®ƒï¼Œä½ å°±èƒ½æ£€æŸ¥ä»£ç ã€è®¾ç½®æ–­ç‚¹å’Œè§‚å¯Ÿç¨‹åºè¿è¡Œæ—¶çš„å˜é‡çŠ¶æ€ç­‰ã€‚</p><p>é‚£ä¹ˆï¼Œ<code>--inspect-publish-uid</code> è¿™ä¸ªé€‰é¡¹æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„å‘¢ï¼Ÿ</p><h3 id="inspect-publish-uid" tabindex="-1"><a class="header-anchor" href="#inspect-publish-uid"><span><code>--inspect-publish-uid</code></span></a></h3><p>æ­¤é€‰é¡¹ç”¨äºæŒ‡å®š Node.js è°ƒè¯•ä¿¡æ¯å‘å¸ƒï¼ˆpublishï¼‰æ–¹å¼çš„ç”¨æˆ·æ ‡è¯†ï¼ˆUIDï¼‰ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒå®šä¹‰äº†è°ƒè¯•å™¨ç›‘å¬å™¨åœ°å€ä¿¡æ¯åº”è¯¥å¦‚ä½•å…¬å¸ƒç»™å¤–ç•Œã€‚è¿™ä¸ªé€‰é¡¹æœ‰ä¸¤ä¸ªå¯èƒ½çš„å€¼ï¼š<code>stderr</code> å’Œ <code>http</code>ã€‚</p><ul><li><p><code>--inspect-publish-uid=stderr</code>: å½“ä½ ä½¿ç”¨è¿™ä¸ªé€‰é¡¹æ—¶ï¼ŒNode.js ä¼šæŠŠè°ƒè¯•å™¨ç›‘å¬å™¨çš„åœ°å€æ‰“å°åˆ°æ ‡å‡†é”™è¯¯æµï¼ˆstderrï¼‰ã€‚è¿™å¯¹äºæœ¬åœ°å¼€å‘å’Œè°ƒè¯•æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ä½ åªéœ€è¦æŸ¥çœ‹ä½ çš„ç»ˆç«¯æˆ–æ§åˆ¶å°è¾“å‡ºï¼Œå°±å¯ä»¥æ‰¾åˆ°è¿™ä¸ªåœ°å€ï¼Œå¹¶ç”¨å®ƒæ¥è¿æ¥ä½ çš„è°ƒè¯•å®¢æˆ·ç«¯ã€‚</p></li><li><p><code>--inspect-publish-uid=http</code>: å½“ä½¿ç”¨è¿™ä¸ªé€‰é¡¹æ—¶ï¼ŒNode.js ä¼šå°è¯•é€šè¿‡ HTTP åè®®å‘é€è°ƒè¯•å™¨ç›‘å¬å™¨çš„åœ°å€ã€‚è¿™åœ¨æŸäº›å¤æ‚çš„éƒ¨ç½²åœºæ™¯ä¸‹å¯èƒ½ä¼šæœ‰ç”¨ï¼Œå¦‚å®¹å™¨åŒ–ç¯å¢ƒæˆ–å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä½ å¯èƒ½éœ€è¦è¿œç¨‹è·å–è°ƒè¯•å™¨ç›‘å¬å™¨çš„åœ°å€ã€‚</p></li></ul><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-3"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><ol><li><p><strong>æœ¬åœ°å¼€å‘è°ƒè¯•</strong>: å‡è®¾ä½ æ­£åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šå¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºã€‚ä½ å¸Œæœ›ä½¿ç”¨ Chrome çš„ DevTools æ¥è°ƒè¯•ä½ çš„åº”ç”¨ã€‚ä½ å¯ä»¥åœ¨å¯åŠ¨åº”ç”¨æ—¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --inspect-brk=9229</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --inspect-publish-uid=stderr</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åº”ç”¨ä¼šåœ¨å¯åŠ¨æ—¶æš‚åœï¼Œå¹¶ä¸”è°ƒè¯•å™¨ç›‘å¬å™¨çš„åœ°å€ä¼šè¢«æ‰“å°åˆ° stderrï¼Œé€šå¸¸æ˜¯ä½ çš„ç»ˆç«¯çª—å£ã€‚ç„¶åä½ å¯ä»¥å¤åˆ¶è¿™ä¸ªåœ°å€ï¼Œç²˜è´´åˆ° Chrome çš„åœ°å€æ ï¼Œå¹¶å¼€å§‹ä½¿ç”¨ DevTools è¿›è¡Œè°ƒè¯•ã€‚</p></li><li><p><strong>è¿œç¨‹è°ƒè¯•</strong>: å‡è®¾ä½ çš„ Node.js åº”ç”¨éƒ¨ç½²åœ¨è¿œç¨‹æœåŠ¡å™¨æˆ–å®¹å™¨ä¸­ï¼Œè€Œä½ æƒ³ä»ä½ çš„æœ¬åœ°æœºå™¨è¿›è¡Œè°ƒè¯•ã€‚å¦‚æœç¯å¢ƒé…ç½®æ­£ç¡®å¹¶ä¸”å®‰å…¨æªæ–½å·²ç»åˆ°ä½ï¼Œä½ å¯èƒ½ä¼šé€‰æ‹©ä½¿ç”¨ <code>--inspect-publish-uid=http</code> é€‰é¡¹ï¼Œä»¥ä¾¿å¯ä»¥é€šè¿‡ HTTP è¯·æ±‚æ¥è·å–è°ƒè¯•å™¨ç›‘å¬å™¨çš„åœ°å€ã€‚ç„¶åï¼Œä½ å¯ä»¥åœ¨ä½ çš„æœ¬åœ°è°ƒè¯•å®¢æˆ·ç«¯ä¸­ä½¿ç”¨è¿™ä¸ªåœ°å€è¿›è¡Œè¿œç¨‹è°ƒè¯•ã€‚</p></li></ol><p>è¯·æ³¨æ„ï¼Œæš´éœ²è°ƒè¯•ç«¯å£å¯èƒ½ä¼šå¼•å…¥å®‰å…¨é£é™©ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿œç¨‹è°ƒè¯•æ—¶è¦æ ¼å¤–å°å¿ƒï¼Œç¡®ä¿æ‰€æœ‰çš„è¿æ¥éƒ½æ˜¯å®‰å…¨çš„ï¼Œå¹¶ä¸”åªæœ‰æˆæƒçš„è°ƒè¯•å®¢æˆ·ç«¯æ‰èƒ½è¿æ¥åˆ°è°ƒè¯•å™¨ç›‘å¬å™¨ã€‚</p><h3 id="i-interactive" tabindex="-1"><a class="header-anchor" href="#i-interactive"><span><a href="https://nodejs.org/docs/latest/api/cli.html#-i---interactive" target="_blank" rel="noopener noreferrer">-i, --interactive</a></span></a></h3><p>Node.js ä¸­çš„ <code>-i</code> æˆ– <code>--interactive</code> æ ‡å¿—ç”¨äºå¯åŠ¨ Node.js çš„ REPL (Read-Eval-Print Loop) ç¯å¢ƒã€‚REPL æ˜¯ä¸€ä¸ªäº¤äº’å¼è§£é‡Šå™¨ç•Œé¢ï¼Œé€šè¿‡å®ƒä½ å¯ä»¥è¾“å…¥ JavaScript ä»£ç å¹¶ç«‹å³çœ‹åˆ°ä»£ç æ‰§è¡Œç»“æœã€‚è¿™ä¸ªç¯å¢ƒå¯¹äºå¿«é€Ÿæµ‹è¯•ä»£ç ç‰‡æ®µå’Œå­¦ä¹  JavaScript éå¸¸æœ‰ç”¨ã€‚</p><p>å½“ä½ åœ¨å‘½ä»¤è¡Œä¸­åªé”®å…¥ <code>node</code> å¹¶æŒ‰ä¸‹å›è½¦æ—¶ï¼Œé»˜è®¤ä¼šè¿›å…¥ REPL ç¯å¢ƒã€‚ä½†æ˜¯å¦‚æœä½ å¸Œæœ› Node.js åœ¨å¤„ç†å®Œå…¶ä»–å‚æ•°ï¼ˆä¾‹å¦‚æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶ï¼‰åè¿›å…¥ REPL ç¯å¢ƒï¼Œæˆ–è€…ä½ æ­£åœ¨ä½¿ç”¨ç®¡é“ï¼ˆpipeï¼‰ä¼ é€’æ•°æ®ç»™ Node.js æ—¶æƒ³è¦è¿›å…¥ REPLï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code>-i</code> æˆ– <code>--interactive</code> æ ‡å¿—æ¥å¼ºåˆ¶å¯åŠ¨ REPLã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›å…·ä½“çš„ä¾‹å­ï¼š</p><ol><li>ç›´æ¥å¯åŠ¨ Node.js REPLï¼š</li></ol><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿›å…¥åï¼Œä½ å¯ä»¥å¼€å§‹è¾“å…¥ JavaScript ä»£ç äº†ï¼Œä¾‹å¦‚ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li>å¼ºåˆ¶å¯åŠ¨ REPLï¼Œå³ä½¿å·²ç»æ‰§è¡Œäº†è„šæœ¬æ–‡ä»¶ï¼š</li></ol><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;console.log(&#39;å…ˆæ‰§è¡Œè¿™æ¡å‘½ä»¤&#39;)&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>-e</code> å‚æ•°è®© Node.js æ‰§è¡Œæä¾›çš„ JavaScript è¡¨è¾¾å¼ã€‚å‘½ä»¤æ‰§è¡Œå®Œæ¯•åï¼Œç”±äº <code>-i</code>ï¼Œæˆ‘ä»¬è¿›å…¥äº† REPL æ¨¡å¼ï¼Œå¯ä»¥ç»§ç»­è¾“å…¥æ›´å¤šå‘½ä»¤ã€‚</p><ol start="3"><li>ä½¿ç”¨ç®¡é“ä¸ Node.js REPL äº¤äº’ï¼š</li></ol><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;const x = 5; console.log(x);&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -i</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>echo</code> å‘½ä»¤å°†ä»£ç ä¼ é€’ç»™ Node.jsã€‚é€šå¸¸ï¼Œæ²¡æœ‰ <code>-i</code>ï¼ŒNode.js å°†æ‰§è¡Œä»£ç ç„¶åé€€å‡ºã€‚ä½†æ˜¯å› ä¸º <code>-i</code> æ ‡å¿—ï¼ŒNode.js æ‰§è¡Œäº†ä»£ç åä»ç„¶è¿›å…¥äº† REPL ç¯å¢ƒï¼Œä½ å¯ä»¥è¿›è¡Œåç»­çš„æ“ä½œã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒNode.js çš„ <code>-i</code> æˆ– <code>--interactive</code> æ ‡å¿—ä¸ºç”¨æˆ·æä¾›äº†ä¸€ç§çµæ´»çš„æ–¹å¼ï¼Œå³ä½¿åœ¨è‡ªåŠ¨åŒ–è„šæœ¬æˆ–è€…ç®¡é“æ“ä½œä¸­ä¹Ÿèƒ½å¤Ÿäº¤äº’å¼åœ°ä½¿ç”¨ REPLã€‚</p><h3 id="jitless" tabindex="-1"><a class="header-anchor" href="#jitless"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--jitless" target="_blank" rel="noopener noreferrer">--jitless</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆåˆ° Node.jsï¼Œæˆ‘ä»¬å®é™…ä¸Šåœ¨è°ˆè®ºçš„æ˜¯ä¸€ä¸ª JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒè®©æ‚¨å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚Node.js å†…éƒ¨ä½¿ç”¨äº† Google çš„ V8 å¼•æ“æ¥æ‰§è¡Œ JavaScript ä»£ç ï¼Œè€Œ V8 å¼•æ“ä¸ºäº†æé«˜æ€§èƒ½ï¼Œä¼šä½¿ç”¨æ‰€è°“çš„â€œå³æ—¶ç¼–è¯‘â€ï¼ˆJITï¼‰æŠ€æœ¯ã€‚</p><p><strong>ä»€ä¹ˆæ˜¯ JIT?</strong><br> JITï¼Œå…¨ç§°å³æ—¶ç¼–è¯‘ï¼Œæ˜¯ä¸€ç§ç¼–è¯‘æŠ€æœ¯ï¼Œå®ƒåœ¨ç¨‹åºè¿è¡Œæ—¶å°†æºä»£ç æˆ–ä¸­é—´å­—èŠ‚ç è½¬æ¢æˆæœºå™¨ç ï¼Œä»è€Œæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚ä½ å¯ä»¥ç†è§£ä¸º JIT æ˜¯ä¸€ç§è¯•å›¾åœ¨ä¸ç‰ºç‰²å¤ªå¤šå¯åŠ¨æ—¶é—´çš„æƒ…å†µä¸‹ï¼Œä¼˜åŒ–é•¿æœŸè¿è¡Œæ€§èƒ½çš„æ–¹æ³•ã€‚</p><p><strong>ç„¶è€Œï¼Œä¸ºä»€ä¹ˆè¦æœ‰ä¸€ä¸ª <code>--jitless</code> é€‰é¡¹å‘¢ï¼Ÿ</strong></p><p>æŸäº›ç‰¹å®šçš„åœºåˆï¼Œä½ å¯èƒ½ä¸å¸Œæœ›ä½¿ç”¨ JIT ç¼–è¯‘ã€‚è¿™é‡Œæœ‰å‡ ä¸ªåŸå› ï¼š</p><ol><li><strong>å®‰å…¨æ€§</strong>ï¼šåœ¨æŸäº›å®‰å…¨æ•æ„Ÿçš„ç¯å¢ƒä¸­ï¼Œæ¯”å¦‚é‡‘èã€å†›äº‹ç³»ç»Ÿï¼ŒJIT ç¼–è¯‘è¿‡ç¨‹ä¸­ç”Ÿæˆçš„ä»£ç å¯èƒ½å­˜åœ¨å®‰å…¨é£é™©ï¼Œå› ä¸ºå®ƒå¯ä»¥è¢«æ¶æ„åˆ©ç”¨ã€‚</li><li><strong>å…¼å®¹æ€§é—®é¢˜</strong>ï¼šæŸäº›æ—§çš„ç³»ç»Ÿå¯èƒ½ä¸æ”¯æŒ JIT æŠ€æœ¯ã€‚</li><li><strong>ç¡®å®šæ€§å’Œè°ƒè¯•</strong>ï¼šJIT åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œä¼˜åŒ–ï¼Œè¿™å¯èƒ½ä½¿å¾—è°ƒè¯•å˜å¾—å¤æ‚ï¼Œå› ä¸ºæºä»£ç å’Œæ‰§è¡Œæ—¶çš„ä»£ç å¯èƒ½ä¼šæœ‰å·®å¼‚ã€‚å…³é—­ JIT å¯ä»¥è®©ç¨‹åºçš„è¡Œä¸ºæ›´åŠ å¯é¢„æµ‹å’Œå¯é‡ç°ã€‚</li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä½ å…³é—­ JIT åï¼ŒJavaScript ä»£ç çš„æ‰§è¡Œé€Ÿåº¦é€šå¸¸ä¼šé™ä½ï¼Œå› ä¸ºä½ å¤±å»äº† JIT æ‰€æä¾›çš„æ€§èƒ½ä¼˜åŒ–ã€‚</p><p><strong>å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ <code>--jitless</code>?</strong><br> å½“ä½ å¯åŠ¨ Node.js æ—¶ï¼Œåœ¨å‘½ä»¤è¡Œä¸­æ·»åŠ  <code>--jitless</code> å‚æ•°å³å¯å…³é—­ JIT åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --jitless</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your_script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>å®é™…ä¾‹å­ï¼š</strong></p><ul><li><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªé“¶è¡Œè½¯ä»¶ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä½ å¯èƒ½ä¼šé€‰æ‹©å…³é—­ JIT æ¥é¿å…ä»»ä½•æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚</p></li><li><p>å¦‚æœä½ æ­£åœ¨è¿›è¡Œç¨‹åºè°ƒè¯•ï¼Œå¹¶æƒ³ç¡®ä¿ä»£ç çš„æ‰§è¡Œä¸æºä»£ç å®Œå…¨ä¸€è‡´ï¼Œé‚£ä¹ˆä½¿ç”¨ <code>--jitless</code> å¯ä»¥å¸®åŠ©ä½ æ›´å‡†ç¡®åœ°å®šä½é—®é¢˜ã€‚</p></li><li><p>åœ¨æŸäº›è€æ—§çš„ç¡¬ä»¶æˆ–è€…æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œ Node.js åº”ç”¨ï¼Œå¦‚æœå‘ç° JIT ä¸è¢«æ”¯æŒæˆ–å¯¼è‡´é—®é¢˜ï¼Œ<code>--jitless</code> é€‰é¡¹å¯ä»¥ä½œä¸ºä¸€ä¸ªå›é€€æ–¹æ¡ˆæ¥ç¡®ä¿åº”ç”¨ç¨‹åºçš„è¿è¡Œã€‚</p></li></ul><p>æ€»ä¹‹ï¼Œ<code>--jitless</code> æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªå¯åŠ¨é€‰é¡¹ï¼Œç”¨æ¥å…³é—­ V8 å¼•æ“çš„å³æ—¶ç¼–è¯‘åŠŸèƒ½ï¼Œä¸»è¦ç”¨äºå®‰å…¨æ€§æ›´é«˜ã€å…¼å®¹æ€§æ›´å¥½æˆ–è€…è°ƒè¯•è¿‡ç¨‹ä¸­çš„åœºæ™¯ï¼Œä½†å®ƒä¼šç‰ºç‰²ä¸€å®šçš„æ‰§è¡Œæ€§èƒ½ã€‚</p><h3 id="max-http-header-size-size" tabindex="-1"><a class="header-anchor" href="#max-http-header-size-size"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--max-http-header-sizesize" target="_blank" rel="noopener noreferrer">--max-http-header-size=size</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>--max-http-header-size=size</code> æ˜¯ä¸€ä¸ªå¯åŠ¨å‚æ•°ï¼ˆCLI flagï¼‰ï¼Œå®ƒç”¨æ¥æŒ‡å®š HTTP è¯·æ±‚å’Œå“åº”å¤´çš„æœ€å¤§é•¿åº¦ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒHTTP å¤´éƒ¨çš„æœ€å¤§é•¿åº¦æ˜¯ 8 KB (8192 bytes)ï¼Œä½†æœ‰æ—¶å€™ä½ å¯èƒ½éœ€è¦å¤„ç†æ›´å¤§çš„å¤´éƒ¨ä¿¡æ¯ï¼Œè¿™æ—¶ä½ å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‚æ•°æ¥è°ƒæ•´æœ€å¤§é•¿åº¦ã€‚</p><p>å½“ä½ å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œåœ¨å‘½ä»¤è¡Œä¸­åŠ å…¥æ­¤å‚æ•°å³å¯è®¾ç½® HTTP å¤´éƒ¨çš„æœ€å¤§å°ºå¯¸ã€‚ä¾‹å¦‚ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --max-http-header-size=16384</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°† HTTP å¤´çš„æœ€å¤§å°ºå¯¸è®¾ç½®ä¸ºäº† 16 KB (16384 bytes)ã€‚å¦‚æœæœ‰ä¸ª HTTP è¯·æ±‚çš„å¤´éƒ¨å¤§å°è¶…è¿‡äº†è¿™ä¸ªé™åˆ¶ï¼ŒNode.js ä¼šè¿”å›ä¸€ä¸ª HTTP 431 é”™è¯¯ï¼ˆRequest Header Fields Too Largeï¼‰ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›å®é™…è¿ç”¨çš„ä¾‹å­æ¥çœ‹çœ‹è¿™ä¸ªå‚æ•°æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-3"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p><strong>ä¾‹å­ 1ï¼šWeb æœåŠ¡å™¨</strong></p><p>å‡è®¾ä½ æ­£åœ¨å†™ä¸€ä¸ª Node.js çš„ Web æœåŠ¡å™¨ï¼Œä¸”ä½ é¢„è®¡ä¼šæ”¶åˆ°åŒ…å«å¤§é‡ Cookie æˆ–å®‰å…¨ä»¤ç‰Œçš„ HTTP è¯·æ±‚ã€‚è¿™å¯èƒ½å¯¼è‡´è¯·æ±‚å¤´çš„å¤§å°è¶…å‡ºé»˜è®¤çš„ 8 KB é™åˆ¶ã€‚ä¸ºäº†é¿å…å› ä¸ºå¤´éƒ¨è¿‡å¤§è€Œæ— æ³•å¤„ç†è¯·æ±‚ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨æœåŠ¡å™¨ä¹‹å‰å¢åŠ <code>--max-http-header-size</code>é€‰é¡¹ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --max-http-header-size=20000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> server.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·ä½ çš„æœåŠ¡å™¨å°±å¯ä»¥æ¥æ”¶å’Œå¤„ç†æœ€å¤§ 20 KB å¤§å°å¤´éƒ¨çš„ HTTP è¯·æ±‚äº†ã€‚</p><p><strong>ä¾‹å­ 2ï¼šä»£ç†æœåŠ¡</strong></p><p>å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œå¹¶ä¸”çŸ¥é“å°†è¦è½¬å‘ä¸€äº›å«æœ‰å¤§å‹è‡ªå®šä¹‰ HTTP å¤´çš„è¯·æ±‚ï¼Œå¯èƒ½ä¼šéœ€è¦å¢åŠ æœ€å¤§å¤´éƒ¨å°ºå¯¸ã€‚å¦åˆ™ï¼Œä»£ç†æœåŠ¡å™¨å¯èƒ½ä¼šå› ä¸ºè¯·æ±‚å¤´è¿‡å¤§è€Œæ‹’ç»è½¬å‘è¿™äº›è¯·æ±‚ã€‚</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --max-http-header-size=32000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> proxy-server.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œï¼Œä»£ç†æœåŠ¡å™¨è¢«é…ç½®ä¸ºæ¥å—æœ€å¤§ 32 KB çš„ HTTP å¤´éƒ¨ã€‚</p><p><strong>ä¾‹å­ 3ï¼šå¾®æœåŠ¡æ¶æ„</strong></p><p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå„ä¸ªæœåŠ¡ä¹‹é—´å¯èƒ½ä¼šé€šè¿‡ HTTP å¤´è¿›è¡Œå¤æ‚çš„äº¤äº’ï¼Œæ¯”å¦‚ä¼ é€’è·Ÿè¸ª IDã€è®¤è¯ä¿¡æ¯ç­‰ã€‚è¿™å¯èƒ½ä¼šä½¿å¾— HTTP å¤´éƒ¨å˜å¾—å¾ˆå¤§ã€‚å¦‚æœä½ çš„æŸä¸ªæœåŠ¡ä¸æ¥å—å¤§äºé»˜è®¤å¤§å°çš„ HTTP å¤´ï¼Œå®ƒå¯èƒ½å°±æ— æ³•åœ¨è¿™ç§æ¶æ„ä¸­æ­£å¸¸å·¥ä½œã€‚</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --max-http-header-size=40000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> microservice.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è®¾ç½®è¾ƒå¤§çš„å¤´éƒ¨å°ºå¯¸å¯ä»¥å¸®åŠ©ç¡®ä¿å¾®æœåŠ¡èƒ½å¤Ÿå¤„ç†å…¶ä»–æœåŠ¡å‘æ¥çš„å¤§å‹ HTTP å¤´ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>--max-http-header-size=size</code> å‚æ•°å¯ä»¥å¸®åŠ©ä½ çš„ Node.js åº”ç”¨ç¨‹åºçµæ´»åœ°é€‚åº”é‚£äº›éœ€è¦å¤„ç†å¤§å‹ HTTP å¤´éƒ¨çš„åœºæ™¯ã€‚ç„¶è€Œï¼Œè¯·æ³¨æ„ä¸è¦è½»æ˜“æé«˜è¿™ä¸ªå€¼ï¼Œå› ä¸ºéå¸¸å¤§çš„å¤´éƒ¨å¯èƒ½ä¼šå¢åŠ æœåŠ¡é­å—æ¶æ„ç”¨æˆ·æ”»å‡»çš„é£é™©ã€‚åªæœ‰å½“ä½ ç¡®å®šéœ€è¦å¤„ç†å¤§å‹å¤´éƒ¨ï¼Œå¹¶ä¸”å·²ç»é‡‡å–äº†é€‚å½“çš„å®‰å…¨æªæ–½æ—¶ï¼Œæ‰å»è°ƒæ•´å®ƒã€‚</p><h3 id="napi-modules" tabindex="-1"><a class="header-anchor" href="#napi-modules"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--napi-modules" target="_blank" rel="noopener noreferrer">--napi-modules</a></span></a></h3><p>Node.js ä¸­çš„ <code>--napi-modules</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒå…è®¸ä½ åœ¨å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶å¯ç”¨æˆ–ç¦ç”¨ N-API æ¨¡å—ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ N-APIã€‚</p><p>N-APIï¼ˆNode.js APIï¼‰æ˜¯ä¸€ä¸ªç‹¬ç«‹äº JavaScript è¿è¡Œæ—¶çš„ API å±‚ï¼Œå®ƒå…è®¸ä½ ç¼–å†™åŸç”Ÿçš„æ’ä»¶æ¨¡å—ã€‚è¿™äº›æ¨¡å—å¯ä»¥ç›´æ¥ä¸ Node.js çš„åº•å±‚ C/C++ API è¿›è¡Œäº¤äº’ï¼Œè€Œä¸ä¾èµ–äº V8ï¼ˆNode.js é»˜è®¤çš„ JavaScript å¼•æ“ï¼‰çš„å†…éƒ¨ç»“æ„ã€‚ä½¿ç”¨ N-API ç¼–å†™çš„æ¨¡å—æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜ç‚¹ï¼Œé‚£å°±æ˜¯å®ƒä»¬å¯ä»¥å…¼å®¹ä¸åŒç‰ˆæœ¬çš„ Node.jsï¼Œæ— éœ€é’ˆå¯¹æ¯ä¸ªæ–°ç‰ˆæœ¬é‡æ–°ç¼–è¯‘ã€‚</p><p>ç°åœ¨ï¼Œå›åˆ° <code>--napi-modules</code> è¿™ä¸ªå‚æ•°ã€‚å½“ä½ è¿è¡Œä¸€ä¸ª Node.js ç¨‹åºæ—¶ï¼Œé€šå¸¸ä¼šåƒè¿™æ ·åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœä½ æƒ³è¦æ˜¾å¼åœ°å¯ç”¨ N-API æ¨¡å—æ”¯æŒï¼ˆé€šå¸¸åœ¨æ–°ç‰ˆ Node.js ä¸­é»˜è®¤å¯ç”¨ï¼‰ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --napi-modules</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åä¹‹ï¼Œå¦‚æœå‡ºäºæŸç§ç‰¹æ®ŠåŸå› ä½ éœ€è¦ç¦ç”¨ N-API æ¨¡å—ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --no-napi-modules</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¸ºä»€ä¹ˆä¼šéœ€è¦ç¦ç”¨ N-API æ¨¡å—å‘¢ï¼Ÿå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ ä¸éœ€è¦è¿™æ ·åšã€‚ä½†åœ¨ä¸€äº›ç‰¹å®šçš„åœºæ™¯ä¸‹ï¼Œä¾‹å¦‚è°ƒè¯•æˆ–è€…æµ‹è¯• N-API æ¨¡å—éå…¼å®¹æ€§é—®é¢˜æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°ã€‚</p><p>ä¸¾ä¸ªå®é™…çš„ä¾‹å­ï¼š</p><p>å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªåä¸º <code>sharp</code> çš„æµè¡Œå›¾ç‰‡å¤„ç†åº“ï¼Œå®ƒä½¿ç”¨äº† N-API æ¥æå‡æ€§èƒ½å’Œè·¨ç‰ˆæœ¬çš„å…¼å®¹æ€§ã€‚å½“ä½ åœ¨é¡¹ç›®ä¸­å®‰è£…å¹¶ä½¿ç”¨ <code>sharp</code> æ—¶ï¼Œå®ƒä¼šé»˜è®¤å¯ç”¨ N-APIã€‚ç„¶è€Œï¼Œå¦‚æœä½ é‡åˆ°äº†ä¸ <code>sharp</code> ç›¸å…³çš„é—®é¢˜ï¼Œæƒ³è¦æ£€æŸ¥æ˜¯å¦æ˜¯ N-API å¯¼è‡´çš„ï¼Œä½ å¯èƒ½ä¼šå°è¯•ç¦ç”¨ N-API æ¥è¿è¡Œä½ çš„åº”ç”¨ç¨‹åºï¼Œçœ‹çœ‹æ˜¯å¦é—®é¢˜è¿˜å­˜åœ¨ã€‚</p><p>æ­£å¸¸å¯åŠ¨åº”ç”¨ç¨‹åºï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç¦ç”¨ N-API å¯åŠ¨åº”ç”¨ç¨‹åºè¿›è¡Œæµ‹è¯•ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --no-napi-modules</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ€»çš„æ¥è¯´ï¼Œ<code>--napi-modules</code> æ˜¯ä¸€ä¸ªé«˜çº§ç‰¹æ€§ï¼Œå¯¹äºå¤§å¤šæ•° Node.js å¼€å‘è€…æ¥è¯´ï¼Œæ˜¯ä¸éœ€è¦ç›´æ¥æ“ä½œçš„ã€‚åªæœ‰åœ¨éœ€è¦æ·±å…¥è°ƒè¯•æˆ–ç†è§£åº•å±‚å…¼å®¹æ€§é—®é¢˜æ—¶ï¼Œæ‰å¯èƒ½ç”¨åˆ°è¿™ä¸ªé€‰é¡¹ã€‚</p><h3 id="no-addons" tabindex="-1"><a class="header-anchor" href="#no-addons"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--no-addons" target="_blank" rel="noopener noreferrer">--no-addons</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚Node.js è‡ªå¸¦äº†å¾ˆå¤šåŠŸèƒ½ï¼Œä½†æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æ›´å¤šçš„è‡ªå®šä¹‰ç‰¹æ€§æˆ–è€…ç›´æ¥ä½¿ç”¨ä¸€äº›ç³»ç»Ÿçº§åˆ«çš„æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç”¨åˆ° Node.js çš„æ‰©å±•æœºåˆ¶ï¼Œå³ &quot;addons&quot;ã€‚</p><p>Addons æ˜¯ç”¨ C æˆ– C++ å†™çš„æ¨¡å—ï¼Œå®ƒä»¬å¯ä»¥é€šè¿‡ Node.js æä¾›çš„ <code>N-API</code> ï¼ˆä¹‹å‰æ˜¯ <code>nan</code>ï¼‰ æ¥å£ä¸ Node.js è¿›è¡Œäº¤äº‘ã€‚å› ä¸º addons å¯ä»¥ç›´æ¥æ“ä½œç³»ç»Ÿå±‚é¢çš„èµ„æºï¼Œæ‰€ä»¥å®ƒä»¬èƒ½å¤Ÿæ‰§è¡Œä¸€äº› JavaScript æœ¬èº«åšä¸åˆ°çš„é«˜æ€§èƒ½è®¡ç®—æˆ–è€…ç³»ç»Ÿè°ƒç”¨ç­‰ä»»åŠ¡ã€‚</p><p>ä½†æœ‰äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½ä¸æƒ³è®©ç¨‹åºåŠ è½½å’Œè¿è¡Œè¿™äº› addonsï¼ŒåŸå› å¯èƒ½æ˜¯å‡ºäºå®‰å…¨è€ƒè™‘ï¼ˆé˜²æ­¢æœªçŸ¥çš„ addons æ‰§è¡Œä¸å®‰å…¨çš„æ“ä½œï¼‰ï¼Œæˆ–è€…æ˜¯ä¸ºäº†é¿å…æŸäº›ä¾èµ–é—®é¢˜ï¼ˆæ¯”å¦‚æŸäº› addons åœ¨å½“å‰ç¯å¢ƒä¸‹æ— æ³•æ­£å¸¸å·¥ä½œï¼‰ã€‚è¿™æ—¶ï¼ŒNode.js æä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ <code>--no-addons</code> æ¥ç¦æ­¢åŠ è½½ä»»ä½• native addonsã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¦è¿è¡Œä¸€ä¸ª Node.js ç¨‹åºï¼Œä½†æ˜¯åˆä¸æƒ³è®©å®ƒåŠ è½½ä»»ä½• addonsï¼Œå¯ä»¥åœ¨ç»ˆç«¯ä¸­è¿™æ ·è¾“å…¥å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --no-addons</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤ä¼šå¯åŠ¨ Node.jsï¼Œè¿è¡Œ <code>your-script.js</code> æ–‡ä»¶ï¼Œä½†æ˜¯åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå®ƒä¸ä¼šåŠ è½½ä»»ä½• addonsã€‚</p><p>ä¸¾å‡ ä¸ªå®é™…çš„ä¾‹å­ï¼š</p><ol><li><p><strong>å®‰å…¨å®¡è®¡</strong>: å¦‚æœä½ çš„åº”ç”¨æ­£åœ¨æ¥å—å®‰å…¨å®¡è®¡ï¼Œå®¡æ ¸äººå‘˜å¯èƒ½è¦æ±‚ä¸åŠ è½½ä»»ä½•éæ ¸å¿ƒæ¨¡å—ï¼ŒåŒ…æ‹¬ addonsï¼Œä»¥ç¡®ä¿åº”ç”¨çš„å®‰å…¨æ€§ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>--no-addons</code> é€‰é¡¹æ¥æ»¡è¶³è¿™ä¸ªè¦æ±‚ã€‚</p></li><li><p><strong>å…¼å®¹æ€§æµ‹è¯•</strong>: å½“ä½ åœ¨ä¸€ä¸ªå…¨æ–°çš„ç¯å¢ƒï¼ˆæ¯”å¦‚ä¸€ä¸ªæ–°ç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿï¼‰ä¸Šæµ‹è¯•ä½ çš„åº”ç”¨æ—¶ï¼Œå¯èƒ½ä¸€äº› addons è¿˜æ²¡æœ‰æ›´æ–°ä»¥æ”¯æŒè¿™ä¸ªæ–°ç¯å¢ƒã€‚ä½¿ç”¨ <code>--no-addons</code> å¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿç¡®å®šé—®é¢˜æ˜¯å¦å‡ºåœ¨ addons ä¸Šã€‚</p></li><li><p><strong>æ€§èƒ½åŸºå‡†æµ‹è¯•</strong>: å¦‚æœä½ æƒ³æµ‹å®šä½ çš„ Node.js åº”ç”¨çš„æ€§èƒ½ï¼Œå¹¶ä¸”åªå…³æ³¨çº¯ JavaScript æ‰§è¡Œçš„éƒ¨åˆ†ï¼Œæ’é™¤ä»»ä½•ç”± addons å¯¼è‡´çš„æ€§èƒ½å½±å“ã€‚é‚£ä¹ˆï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>--no-addons</code> é€‰é¡¹æ¥ç¡®ä¿æµ‹è¯•ç»“æœçš„å‡†ç¡®ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œ<code>--no-addons</code> æ˜¯ä¸€ä¸ªç”¨äºæ§åˆ¶ Node.js å¯åŠ¨è¡Œä¸ºçš„é€‰é¡¹ï¼Œæä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥é˜»æ­¢ native addons è¢«åŠ è½½å’Œæ‰§è¡Œã€‚</p><h3 id="no-deprecation" tabindex="-1"><a class="header-anchor" href="#no-deprecation"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--no-deprecation" target="_blank" rel="noopener noreferrer">--no-deprecation</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 JavaScript å¼•æ“æ„å»ºçš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ï¼Œè¿™æ ·ä½ å°±å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™èƒ½å¤Ÿå¤„ç†ç½‘ç«™åå°ä»»åŠ¡çš„è„šæœ¬ï¼Œæ¯”å¦‚æ–‡ä»¶æ“ä½œã€ç½‘ç»œé€šä¿¡ç­‰ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæœ‰æ—¶å€™ä¸€äº› API æˆ–è€…åŠŸèƒ½å¯èƒ½å› ä¸ºå„ç§åŸå› ï¼ˆå¦‚æ€§èƒ½ä¸ä½³ã€å­˜åœ¨å®‰å…¨éšæ‚£ã€æˆ–æ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆå‡ºç°ï¼‰è¢«å®˜æ–¹æ ‡è®°ä¸ºâ€œå¼ƒç”¨â€(Deprecation)ã€‚è¿™æ„å‘³ç€è¯¥åŠŸèƒ½è™½ç„¶ç›®å‰è¿˜åœ¨ç»´æŠ¤å¹¶å¯ä»¥ä½¿ç”¨ï¼Œä½†æœªæ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤æˆ–æ”¹å˜ï¼Œæ‰€ä»¥å¼€å‘è€…åº”è¯¥é¿å…ä½¿ç”¨è¿™äº›è¢«å¼ƒç”¨çš„åŠŸèƒ½ï¼Œå¹¶æ¸æ¸è¿ç§»åˆ°æ¨èçš„æ–°æ–¹æ³•ä¸Šå»ã€‚</p><p>å½“ä½ ä½¿ç”¨è¢«å¼ƒç”¨çš„ API æ—¶ï¼ŒNode.js é€šå¸¸ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºè­¦å‘Šä¿¡æ¯ï¼Œå‘ŠçŸ¥ä½ æ­£åœ¨ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªä¸æ¨èçš„åŠŸèƒ½ã€‚è¿™æœ‰åŠ©äºå¼€å‘è€…æ³¨æ„åˆ°è‡ªå·±çš„ä»£ç ä¸­éœ€è¦æ›´æ–°çš„éƒ¨åˆ†ã€‚</p><p><code>--no-deprecation</code> æ˜¯ Node.js çš„ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ã€‚å½“ä½ åœ¨å¯åŠ¨ Node.js åº”ç”¨æ—¶é™„å¸¦è¿™ä¸ªå‚æ•°ï¼ŒNode.js å°†ä¸ä¼šè¾“å‡ºä»»ä½•å…³äºå¼ƒç”¨è­¦å‘Šçš„ä¿¡æ¯ã€‚è¿™ä¸ªé€‰é¡¹é€šå¸¸ç”¨äºé‚£äº›ä¸æƒ³è¢«å¼ƒç”¨è­¦å‘Šæ‰“æ‰°çš„æƒ…å†µï¼Œç‰¹åˆ«æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä½ å¯èƒ½æƒ³è¦ä¸€ä¸ªæ¸…æ´çš„æ—¥å¿—è¾“å‡ºã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>å‡è®¾æœ‰ä¸€ä¸ª Node.js çš„æ¨¡å— <code>oldModule</code>ï¼Œå®ƒåŒ…å«äº†ä¸€äº›å·²ç»è¢«å¼ƒç”¨çš„åŠŸèƒ½ã€‚å¦‚æœä½ åœ¨ä»£ç ä¸­ä½¿ç”¨äº†è¿™ä¸ªæ¨¡å—ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼ŒNode.js å¯èƒ½ä¼šå‘æ§åˆ¶å°è¾“å‡ºç±»ä¼¼ä¸‹é¢çš„è­¦å‘Šä¿¡æ¯ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>(node:12345) DeprecationWarning: oldModule.someDeprecatedFunction() is deprecated and will be removed in a future version.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœä½ ä¸æƒ³çœ‹åˆ°è¿™äº›è­¦å‘Šä¿¡æ¯ï¼Œå¯ä»¥åœ¨å¯åŠ¨ä½ çš„ Node.js åº”ç”¨ç¨‹åºæ—¶åŠ ä¸Š <code>--no-deprecation</code> å‚æ•°ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ é€šå¸¸é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ä½ çš„åº”ç”¨ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä½ å¯ä»¥æ”¹æˆï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --no-deprecation</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œä»»ä½•å¼ƒç”¨çš„è­¦å‘Šéƒ½ä¸ä¼šè¢«æ‰“å°åˆ°æ§åˆ¶å°ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ <code>--no-deprecation</code> é€‰é¡¹ä»…ä»…æ˜¯éšè—äº†è­¦å‘Šä¿¡æ¯ï¼Œå¹¶æ²¡æœ‰è§£å†³æ½œåœ¨çš„é—®é¢˜ã€‚é•¿è¿œæ¥çœ‹ï¼Œä½ åº”è¯¥æŸ¥æ‰¾è¿™äº›è­¦å‘Šçš„æ¥æºï¼Œå¹¶æ›´æ–°ä½ çš„ä»£ç ä»¥ä½¿ç”¨å½“å‰æ¨èçš„ APIï¼Œä»¥ç¡®ä¿ä½ çš„åº”ç”¨åœ¨å°†æ¥çš„ Node.js ç‰ˆæœ¬ä¸­ä»ç„¶èƒ½å¤Ÿæ­£ç¡®è¿è¡Œã€‚</p><h3 id="no-experimental-fetch" tabindex="-1"><a class="header-anchor" href="#no-experimental-fetch"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--no-experimental-fetch" target="_blank" rel="noopener noreferrer">--no-experimental-fetch</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰å¾ˆå¤šåŠŸèƒ½æ˜¯ä»¥æ‰€è°“çš„â€œå®éªŒæ€§ç‰¹æ€§â€ï¼ˆexperimental featuresï¼‰çš„å½¢å¼å‡ºç°çš„ã€‚è¿™æ„å‘³ç€è¿™äº›åŠŸèƒ½è¿˜åœ¨æµ‹è¯•ä¸­ï¼Œå¯èƒ½è¿˜ä¸ç¨³å®šï¼Œä¹Ÿå¯èƒ½åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­æœ‰è¾ƒå¤§çš„æ”¹åŠ¨ã€‚</p><p><code>--no-experimental-fetch</code> æ˜¯ Node.js åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨çš„ä¸€ä¸ªé€‰é¡¹ã€‚è¿™ä¸ªé€‰é¡¹çš„ä½œç”¨æ˜¯ç¦ç”¨ Node.js å†…ç½®çš„å®éªŒæ€§ <code>fetch</code> APIã€‚è¿™ä¸ª <code>fetch</code> API ç±»ä¼¼äºæµè§ˆå™¨ä¸­çš„å…¨å±€ <code>fetch</code> å‡½æ•°ï¼Œå®ƒå…è®¸ä½ åœ¨ Node.js ç¨‹åºä¸­å‘èµ·ç½‘ç»œè¯·æ±‚ã€‚</p><p>åœ¨ Node.js ç‰ˆæœ¬ 21.7.1 ä¸­ï¼Œå¦‚æœä½ ä¸å¸Œæœ›ä½¿ç”¨è¿™ä¸ªå®éªŒæ€§çš„ <code>fetch</code> åŠŸèƒ½ï¼Œæˆ–è€…ä½ æƒ³è¦ç¡®ä¿ä½ çš„ä»£ç åªä½¿ç”¨ç¨³å®šçš„ APIï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨å¯åŠ¨ Node.js ç¨‹åºæ—¶åŠ ä¸Š <code>--no-experimental-fetch</code> è¿™ä¸ªé€‰é¡¹ã€‚</p><p>è®©æˆ‘ä»¬ç”¨å‡ ä¸ªä¾‹å­æ¥è¯´æ˜è¿™ä¸€ç‚¹ï¼š</p><p><strong>ä¾‹å­ 1ï¼šå¯åŠ¨ Node.js åº”ç”¨æ—¶ç¦ç”¨ <code>fetch</code></strong><br> å‡è®¾ä½ æœ‰ä¸€ä¸ªåä¸º <code>app.js</code> çš„ Node.js åº”ç”¨ç¨‹åºæ–‡ä»¶ï¼Œå¹¶ä¸”ä½ ä¸æƒ³åœ¨å…¶ä¸­ä½¿ç”¨å®éªŒæ€§çš„ <code>fetch</code> APIã€‚ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯åŠ¨åº”ç”¨ç¨‹åºï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --no-experimental-fetch</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œå³ä½¿ <code>app.js</code> é‡Œé¢æœ‰ä»£ç å°è¯•è°ƒç”¨ <code>fetch</code>ï¼Œä¹Ÿä¼šå¤±è´¥ï¼Œå› ä¸º <code>fetch</code> API å·²ç»è¢«ç¦ç”¨äº†ã€‚</p><p><strong>ä¾‹å­ 2ï¼šåœ¨è„šæœ¬ä¸­æ£€æŸ¥æ˜¯å¦å¯ä»¥ä½¿ç”¨ <code>fetch</code></strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// app.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">globalThis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fetch is available&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fetch is not available&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ ç›´æ¥è¿è¡Œ <code>node app.js</code>ï¼Œæ§åˆ¶å°ä¼šè¾“å‡º &quot;fetch is available&quot;ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ <code>fetch</code> æ˜¯å¼€å¯çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ åŠ ä¸Š <code>--no-experimental-fetch</code> è¿è¡Œ <code>node --no-experimental-fetch app.js</code>ï¼Œæ§åˆ¶å°å°†è¾“å‡º &quot;fetch is not available&quot;ã€‚</p><p><strong>ä¾‹å­ 3ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹åº“è€Œé <code>fetch</code></strong></p><p>å¦‚æœä½ éœ€è¦åœ¨ Node.js ä¸­å‘èµ· HTTP è¯·æ±‚ï¼Œä½†åˆä¸æƒ³ç”¨å®éªŒæ€§çš„ <code>fetch</code> APIï¼Œä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨å…¶ä»–çš„ç¨³å®šç¬¬ä¸‰æ–¹åº“ï¼Œæ¯”å¦‚ <code>axios</code> æˆ–è€… <code>request</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> axios</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;axios&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">axios</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://api.example.com/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ— è®ºä½ æ˜¯å¦æŒ‡å®š <code>--no-experimental-fetch</code>ï¼Œéƒ½ä¸ä¼šå½±å“ <code>axios</code> çš„ä½¿ç”¨ï¼Œå› ä¸ºå®ƒæ˜¯ç‹¬ç«‹äº Node.js å†…ç½® <code>fetch</code> å®ç°çš„ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>--no-experimental-fetch</code> æ˜¯ä¸€ä¸ªç”¨äºç¦ç”¨ Node.js ä¸­å®éªŒæ€§ <code>fetch</code> API çš„å‘½ä»¤è¡Œé€‰é¡¹ã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥é¿å…åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ä¸ç¨³å®šçš„åŠŸèƒ½ï¼Œæˆ–è€…å¦‚æœä½ æ›´å€¾å‘äºä½¿ç”¨å…¶ä»–æˆç†Ÿçš„ HTTP å®¢æˆ·ç«¯åº“æ¥å¤„ç†ç½‘ç»œè¯·æ±‚ã€‚</p><h3 id="no-experimental-global-customevent" tabindex="-1"><a class="header-anchor" href="#no-experimental-global-customevent"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--no-experimental-global-customevent" target="_blank" rel="noopener noreferrer">--no-experimental-global-customevent</a></span></a></h3><p><code>--no-experimental-global-customevent</code> æ˜¯ Node.js å‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰ä¸­çš„ä¸€ä¸ªé€‰é¡¹ï¼Œå®ƒå¯¹äºä½ ä½œä¸ºç¼–ç¨‹æ–°æ‰‹äº†è§£ Node.js å¹¶ä¸æ˜¯éå¸¸å…³é”®ï¼Œä½†æˆ‘ä¼šå°½é‡é€šä¿—æ˜“æ‡‚åœ°è§£é‡Šå®ƒã€‚</p><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“è¿è¡Œ JavaScript ä»£ç çš„ç¯å¢ƒã€‚å®ƒé€šå¸¸ç”¨äºåˆ›å»ºæœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºã€‚Node.js æœ‰å¾ˆå¤šçš„ç‰¹æ€§å’Œå®éªŒæ€§åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½éƒ½åœ¨ä¸æ–­çš„è¿›åŒ–å’Œæ”¹å–„ä¸­ã€‚</p><p>åœ¨ Node.js çš„æŸäº›ç‰ˆæœ¬ä¸­ï¼Œå¼€å‘è€…å¯èƒ½ä¼šå¼•å…¥ä¸€äº›å®éªŒæ€§çš„å…¨å±€å¯¹è±¡æˆ–æ–¹æ³•ï¼Œç›®çš„æ˜¯ä¸ºäº†æµ‹è¯•è¿™äº›åŠŸèƒ½èƒ½å¦åœ¨æœªæ¥ç‰ˆæœ¬ä¸­æ­£å¼é‡‡çº³å¹¶æˆä¸ºæ ‡å‡†ç‰¹æ€§ã€‚å…¨å±€å¯¹è±¡å°±åƒæ˜¯ Node.js æä¾›ç»™æ‰€æœ‰æ¨¡å—ä½¿ç”¨çš„å…¬å…±èµ„æºï¼Œè€Œä¸éœ€è¦è¿›è¡Œä»»ä½•æ¨¡å—å¯¼å…¥ã€‚</p><p><code>CustomEvent</code> æ˜¯ Web æµè§ˆå™¨ä¸­å·²ç»å­˜åœ¨çš„ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œç”¨æ¥åˆ›å»ºè‡ªå®šä¹‰äº‹ä»¶ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ JavaScript è§¦å‘è¿™äº›äº‹ä»¶ã€‚è¿™äº›è‡ªå®šä¹‰äº‹ä»¶å¯ä»¥å¸®åŠ©ä½ ç»„ç»‡å’Œå¤„ç†å¤æ‚çš„äº¤äº’é€»è¾‘ï¼Œæ¯”å¦‚å½“ç”¨æˆ·å®Œæˆäº†æŸä¸ªæ“ä½œæˆ–è€…æŸä¸ªå¼‚æ­¥ä»»åŠ¡å®Œæˆæ—¶é€šçŸ¥å…¶ä»–éƒ¨åˆ†çš„ä»£ç ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>CustomEvent</code> å¯¹è±¡åŸæœ¬ä¸å­˜åœ¨ï¼Œå› ä¸ºå®ƒä¸»è¦æ˜¯æµè§ˆå™¨çš„ä¸€éƒ¨åˆ†ã€‚ä½†æ˜¯ï¼Œåœ¨ Node.js çš„æŸäº›ç‰ˆæœ¬ä¸­ï¼Œå¯èƒ½ä¼šä»¥å®éªŒæ€§è´¨å¼•å…¥ç±»ä¼¼çš„åŠŸèƒ½ã€‚</p><p>å¦‚æœä½ è¿è¡Œ Node.js ç¨‹åºæ—¶åŠ ä¸Š <code>--no-experimental-global-customevent</code> è¿™ä¸ªé€‰é¡¹ï¼Œå°±æ„å‘³ç€å³ä½¿ Node.js ç‰ˆæœ¬ä¸­åŒ…å«äº†å®éªŒæ€§çš„ <code>CustomEvent</code> å…¨å±€å¯¹è±¡ï¼Œä½ ä¹Ÿé€‰æ‹©ä¸åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­å¯ç”¨å®ƒã€‚è¿™æ ·åšçš„ç†ç”±å¯èƒ½æ˜¯å› ä¸ºå®éªŒæ€§ç‰¹æ€§å¯èƒ½ä¸ç¨³å®šæˆ–è€…åœ¨å°†æ¥çš„ Node.js æ›´æ–°ä¸­å‘ç”Ÿæ”¹å˜ï¼Œè¿™å¯èƒ½ä¼šå½±å“åˆ°ä½ çš„åº”ç”¨ç¨‹åºã€‚</p><p>å®é™…åº”ç”¨çš„ä¾‹å­ï¼š</p><ol><li>å‡è®¾åœ¨ Node.js ä¸­å®éªŒæ€§åœ°å¼•å…¥äº† <code>CustomEvent</code>ï¼Œä¸€ä¸ªä½¿ç”¨è¯¥ç‰¹æ€§çš„ç®€å•ä»£ç ç‰‡æ®µå¯èƒ½é•¿è¿™æ ·ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> CustomEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;test-event&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">detail</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;test-event&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">detail</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º &#39;Hello, World!&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dispatchEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>å¦‚æœä½ ä¸æƒ³åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨è¿™ä¸ªå®éªŒæ€§ç‰¹æ€§ï¼Œå½“ä½ æ‰§è¡Œä½ çš„ Node.js åº”ç”¨æ—¶ï¼Œä½ å¯èƒ½ä¼šåœ¨å‘½ä»¤è¡Œä¸­å†™å…¥ï¼š</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node --no-experimental-global-customevent myApp.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¼šç¡®ä¿å³ä¾¿ Node.js æ”¯æŒ <code>CustomEvent</code>ï¼Œè¯¥åŠŸèƒ½ä¹Ÿä¸ä¼šåœ¨ä½ çš„åº”ç”¨ä¸­è¢«æ¿€æ´»ã€‚</p><p>è¯·æ³¨æ„ï¼Œç”±äº <code>--no-experimental-global-customevent</code> æ˜¯ä¸€ä¸ªé«˜åº¦ä¸“ä¸šåŒ–çš„é€‰é¡¹ï¼Œå¹¶ä¸”å¤§å¤šæ•° Node.js åº”ç”¨ä¸ä¼šç”¨åˆ°è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥ä½œä¸ºä¸€ä¸ªç¼–ç¨‹æ–°æ‰‹ï¼Œä½ ä¸éœ€è¦è¿‡åˆ†å…³æ³¨è¿™ä¸ªé€‰é¡¹ã€‚éšç€ä½ å¯¹ Node.js çš„å­¦ä¹ é€æ¸æ·±å…¥ï¼Œä½ ä¼šå¼€å§‹ç†è§£æ›´å¤šå…³äºå¦‚ä½•é…ç½®å’Œä¼˜åŒ–ä½ çš„ Node.js åº”ç”¨çš„çŸ¥è¯†ï¼Œè¿™æ—¶å€™å†å»äº†è§£è¿™æ ·çš„é«˜çº§é€‰é¡¹ä¹Ÿä¸è¿Ÿã€‚</p><h3 id="no-experimental-global-navigator" tabindex="-1"><a class="header-anchor" href="#no-experimental-global-navigator"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--no-experimental-global-navigator" target="_blank" rel="noopener noreferrer">--no-experimental-global-navigator</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚é€šå¸¸ï¼Œåœ¨æµè§ˆå™¨ä¸­æˆ‘ä»¬ç»å¸¸ä¼šç”¨åˆ° <code>window</code> æˆ– <code>navigator</code> è¿™æ ·çš„å…¨å±€å¯¹è±¡æ¥è·å–ç”¨æˆ·çš„ä¸€äº›ä¿¡æ¯æˆ–è€…æ‰§è¡Œä¸€äº›ä¸ç¯å¢ƒç›¸å…³çš„æ“ä½œã€‚åœ¨ä¼ ç»Ÿçš„ Node.js ç¯å¢ƒä¸­ï¼Œå¹¶æ²¡æœ‰åƒæµè§ˆå™¨é‚£æ ·çš„å…¨å±€å¯¹è±¡ï¼Œå› ä¸º Node.js ä¸»è¦ç”¨äºæœåŠ¡ç«¯ï¼Œä¸éœ€è¦ä¸æµè§ˆå™¨çª—å£æ‰“äº¤é“ã€‚</p><p>ç„¶è€Œï¼Œéšç€æŠ€æœ¯çš„å‘å±•å’Œç¤¾åŒºéœ€æ±‚çš„å˜åŒ–ï¼ŒNode.js å¼€å§‹å®éªŒæ€§åœ°æ·»åŠ ä¸€äº›åŸæœ¬åªå­˜åœ¨äºæµè§ˆå™¨ç¯å¢ƒä¸­çš„å…¨å±€å¯¹è±¡ã€‚è¿™æ„å‘³ç€å¼€å‘è€…å¯ä»¥åœ¨ Node.js ä»£ç ä¸­ä½¿ç”¨è¿™äº›å¯¹è±¡ï¼Œä½¿å¾—åœ¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´å…±äº«ä»£ç å˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>--no-experimental-global-navigator</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨æ¥åœ¨ Node.js ç¨‹åºå¯åŠ¨æ—¶å…³é—­è¿™ç§å®éªŒæ€§åŠŸèƒ½ã€‚å½“ä½ ä½¿ç”¨äº†è¿™ä¸ªé€‰é¡¹åï¼Œç¨‹åºå°±æ— æ³•è®¿é—® <code>navigator</code> è¿™ä¸ªå…¨å±€å¯¹è±¡äº†ï¼Œå³ä¾¿å®ƒåœ¨è¿™ä¸ªç‰ˆæœ¬çš„ Node.js ä¸­å·²ç»æ˜¯ä¸€ä¸ªå®éªŒæ€§ç‰¹æ€§ã€‚</p><p>ä¸‹é¢æ˜¯ä¸åŒæƒ…å¢ƒä¸‹çš„ä¾‹å­ï¼š</p><ol><li><p><strong>ä¸ä½¿ç”¨è¯¥é€‰é¡¹</strong>ï¼š</p><p>å‡å¦‚ä½ æ­£åœ¨å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œå¹¶ä¸”æƒ³è¦æ£€æŸ¥ä¸€äº›ä¸ç¯å¢ƒç›¸å…³çš„ç‰¹æ€§æˆ–è€…æ¨¡æ‹Ÿä¸€äº›æµè§ˆå™¨ç¯å¢ƒçš„è¡Œä¸ºï¼Œä½ å¯èƒ½ä¼šæƒ³è¦è®¿é—® <code>navigator</code> å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³è¦æ ¹æ® user-agent å­—ç¬¦ä¸²æ¥åšå‡ºæŸäº›å†³ç­–ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">navigator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">userAgent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç å°†ä¼šè¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯´æ˜äº†å½“å‰ç¯å¢ƒçš„ä¸€äº›ä¿¡æ¯ã€‚</p></li><li><p><strong>ä½¿ç”¨è¯¥é€‰é¡¹</strong>ï¼š</p><p>å¦‚æœä½ å‡ºäºæŸäº›åŸå› ä¸å¸Œæœ›ä½ çš„ Node.js åº”ç”¨ä½¿ç”¨ <code>navigator</code> å¯¹è±¡ï¼Œå¯èƒ½æ˜¯å‡ºäºå®‰å…¨è€ƒè™‘æˆ–è€…ä½ æƒ³ç¡®ä¿ä»£ç çš„å¯ç§»æ¤æ€§ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨ Node.js åº”ç”¨æ—¶æ·»åŠ  <code>--no-experimental-global-navigator</code> é€‰é¡¹ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --no-experimental-global-navigator</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å½“ä½ åœ¨åº”ç”¨ä¸­å°è¯•è®¿é—® <code>navigator</code> å¯¹è±¡æ—¶ï¼Œä½ å°†ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸ºè¿™ä¸ªå¯¹è±¡å·²ç»è¢«ç¦ç”¨äº†ã€‚</p></li></ol><p>æ€»çš„æ¥è¯´ï¼Œ<code>--no-experimental-global-navigator</code> é€‰é¡¹æä¾›äº†ä¸€ç§å¼€å…³æ§åˆ¶ï¼Œå…è®¸å¼€å‘è€…é€‰æ‹©æ˜¯å¦åœ¨ Node.js ç¨‹åºä¸­å¯ç”¨ <code>navigator</code> è¿™ä¸ªå®éªŒæ€§çš„å…¨å±€å¯¹è±¡ã€‚å¦‚æœä½ æƒ³è¦å†™å‡ºæ›´çº¯ç²¹çš„æœåŠ¡ç«¯ä»£ç ï¼Œæˆ–è€…æƒ³é¿å…ä½¿ç”¨å°šæœªå¹¿æ³›æ”¯æŒçš„ç‰¹æ€§ï¼Œä½ å¯èƒ½ä¼šé€‰æ‹©ä½¿ç”¨è¿™ä¸ªé€‰é¡¹æ¥å…³é—­ <code>navigator</code> å¯¹è±¡ã€‚</p><h3 id="no-experimental-global-webcrypto" tabindex="-1"><a class="header-anchor" href="#no-experimental-global-webcrypto"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--no-experimental-global-webcrypto" target="_blank" rel="noopener noreferrer">--no-experimental-global-webcrypto</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨æµè§ˆå™¨ä¸­ã€‚Node.js çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯å®ƒæœ‰å¤§é‡å†…ç½®æ¨¡å—å’Œç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œè¿™äº›æ¨¡å—å¯ä»¥ç”¨æ¥æ‰§è¡Œå„ç§ä»»åŠ¡ï¼Œæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿæ“ä½œã€ç½‘ç»œé€šä¿¡ã€æ•°æ®åŠ å¯†ç­‰ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>--no-experimental-global-webcrypto</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨æ¥æ§åˆ¶æ˜¯å¦å¯ç”¨å®éªŒæ€§çš„å…¨å±€ <code>webcrypto</code> APIã€‚Web Crypto API æ˜¯ä¸€ä¸ªæä¾›åŠ å¯†åŠŸèƒ½çš„ Web æ ‡å‡†ï¼ŒåŸæœ¬è®¾è®¡ç”¨äºæµè§ˆå™¨ç¯å¢ƒï¼Œä½†ä¹Ÿè¢« Node.js å®éªŒæ€§åœ°å¼•å…¥åˆ°å…¨å±€å¯¹è±¡ä¸­ã€‚</p><p>å½“ä½ è¿è¡Œ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹å¯ç”¨äº†å®éªŒæ€§çš„ <code>webcrypto</code> å…¨å±€å¯¹è±¡ã€‚å¦‚æœä½ æƒ³å…³é—­è¿™ä¸ªåŠŸèƒ½ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨ Node.js æ—¶ä½¿ç”¨ <code>--no-experimental-global-webcrypto</code> å‚æ•°ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><ol><li>ä½¿ç”¨ <code>webcrypto</code> åŠ å¯†ä¸€æ®µæ–‡å­—ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">subtle</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;crypto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">webcrypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> encryptText</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">plainText</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">password</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> enc</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> TextEncoder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encodedMessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> enc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">encode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">plainText</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> key</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> subtle</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">importKey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;raw&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    enc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">encode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">password</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;AES-GCM&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;encrypt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encrypted</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> subtle</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">encrypt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;AES-GCM&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      iv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">window</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">crypto</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getRandomValues</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Uint8Array</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">12</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    encodedMessage</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> encrypted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>å¦‚æœä½ æƒ³å…³é—­è¿™ä¸ªå®éªŒæ€§åŠŸèƒ½ï¼Œå¹¶ä¿è¯ä½ çš„ä»£ç åªåœ¨ç¨³å®šçš„ API ä¸Šè¿è¡Œï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶æ·»åŠ  <code>--no-experimental-global-webcrypto</code> å‚æ•°ï¼š</li></ol><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --no-experimental-global-webcrypto</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä½ çš„ <code>app.js</code> ä¾èµ–äº <code>webcrypto</code> APIï¼Œé‚£ä¹ˆä½ çš„åº”ç”¨ç¨‹åºä¼šæŠ›å‡ºé”™è¯¯ï¼Œå› ä¸º <code>webcrypto</code> å°†ä¸å†ä½œä¸ºå…¨å±€å˜é‡å¯ç”¨ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>--no-experimental-global-webcrypto</code> æ˜¯ä¸€ä¸ªç”¨äºæ§åˆ¶æ˜¯å¦å¯ç”¨å®éªŒæ€§ <code>webcrypto</code> API çš„èŠ‚ç‚¹å‘½ä»¤è¡Œå¼€å…³ã€‚è™½ç„¶ <code>webcrypto</code> æä¾›äº†å¼ºå¤§çš„åŠ å¯†èƒ½åŠ›ï¼Œä½†ç”±äºå…¶å®éªŒæ€§è´¨ï¼ŒæŸäº›ç”Ÿäº§ç¯å¢ƒå¯èƒ½ä¼šé€‰æ‹©å…³é—­å®ƒä»¥ç¡®ä¿æ›´é«˜çš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚</p><h3 id="no-experimental-repl-await" tabindex="-1"><a class="header-anchor" href="#no-experimental-repl-await"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--no-experimental-repl-await" target="_blank" rel="noopener noreferrer">--no-experimental-repl-await</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒä½¿å¾—å¼€å‘è€…å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚å½“ä½ ä½¿ç”¨ Node.js çš„ REPL (Read-Eval-Print Loopï¼Œå³äº¤äº’å¼è§£é‡Šå™¨) æ¨¡å¼æ—¶ï¼Œä½ å¯ä»¥è¾“å…¥ JavaScript ä»£ç ï¼Œå¹¶ç«‹å³çœ‹åˆ°æ‰§è¡Œç»“æœã€‚è¿™å¯¹äºæµ‹è¯•ä»£ç ç‰‡æ®µã€å­¦ä¹ è¯­æ³•æˆ–è€…åšä¸€äº›å¿«é€Ÿçš„è®¡ç®—å’Œå®éªŒéå¸¸æœ‰ç”¨ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼ŒREPL æä¾›äº†ä¸€ä¸ªç§°ä¸º <code>await</code> çš„å…³é”®å­—æ”¯æŒã€‚åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œ<code>await</code> å…³é”®å­—ç”¨æ¥ç­‰å¾…ä¸€ä¸ª <code>Promise</code>ï¼ˆæ‰¿è¯ºï¼‰å¯¹è±¡çš„ç»“æœï¼Œä»è€Œå¯ä»¥å†™å‡ºæ›´åŠ ç›´è§‚å’ŒåŒæ­¥é£æ ¼çš„ä»£ç ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨ JavaScript ä¸­ä½¿ç”¨ <code>await</code> å¿…é¡»åœ¨ä¸€ä¸ª <code>async</code> å‡½æ•°å†…éƒ¨ã€‚ä½†æ˜¯ï¼Œåœ¨ Node.js çš„ REPL æ¨¡å¼ä¸­ï¼Œä½ å¯ä»¥ä¸å¿…å°† <code>await</code> æ”¾åœ¨ <code>async</code> å‡½æ•°é‡Œé¢ï¼Œå› ä¸º REPL ä¼šè‡ªåŠ¨å¤„ç†å®ƒã€‚è¿™è¢«ç§°ä¸º &quot;top-level await&quot;ï¼ˆé¡¶å±‚ç­‰å¾…ï¼‰ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š<br> å‡è®¾æˆ‘ä»¬æƒ³è¦ä»ä¸€ä¸ª API è·å–ä¸€äº› JSON æ•°æ®ã€‚åœ¨ Node.js REPL ä¸­ï¼Œä½ é€šå¸¸ä¼šè¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fetch</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node-fetch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://api.example.com/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ï¼Œåœ¨æ”¯æŒ top-level await çš„ REPL ç¯å¢ƒä¸­ï¼Œä½ å¯ä»¥ç®€åŒ–ä¸Šé¢çš„ä»£ç ï¼Œç›´æ¥è¿™æ ·å†™ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fetch</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node-fetch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://api.example.com/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·çš„ä»£ç æ›´åŠ ç®€æ´ç›´è§‚ï¼Œæ²¡æœ‰å¿…è¦å®šä¹‰ä¸€ä¸ª <code>async</code> å‡½æ•°å»åŒ…è£¹ <code>await</code> è°ƒç”¨ã€‚</p><p>ç„¶è€Œï¼Œå¦‚æœä½ ä¸å¸Œæœ›å¯ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨ REPL æ—¶ä½¿ç”¨ <code>--no-experimental-repl-await</code> è¿™ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ã€‚è¿™æ ·ï¼Œåœ¨ REPL ä¸­ï¼Œå°±ä¸èƒ½å†ä½¿ç”¨é¡¶å±‚çš„ <code>await</code>ï¼Œå¹¶ä¸”éœ€è¦å›åˆ°ä¼ ç»Ÿçš„æ¨¡å¼ï¼Œå³åœ¨ <code>async</code> å‡½æ•°å†…éƒ¨ä½¿ç”¨ <code>await</code>ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ å¯åŠ¨ Node.js REPL å¹¶åŠ ä¸Šè¿™ä¸ªæ ‡å¿—ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --no-experimental-repl-await</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç„¶åå°è¯•åœ¨ä¸åœ¨ <code>async</code> å‡½æ•°å†…éƒ¨ä½¿ç”¨ <code>await</code>ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯æç¤ºï¼Œå‘Šè¯‰ä½  <code>await</code> åªèƒ½åœ¨ <code>async</code> å‡½æ•°å†…ä½¿ç”¨ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>--no-experimental-repl-await</code> æ˜¯ä¸€ä¸ªç”¨äºå…³é—­ Node.js REPL ä¸­çš„ top-level await åŠŸèƒ½çš„å‘½ä»¤è¡Œé€‰é¡¹ã€‚é€šè¿‡ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œä½ å¯ä»¥é¿å…åœ¨ REPL ä¸­ä½¿ç”¨é¡¶å±‚ <code>await</code>ï¼Œå¹¶ä¿ç•™ä¼ ç»Ÿçš„ <code>async/await</code> ä½¿ç”¨æ–¹å¼ã€‚</p><h3 id="no-extra-info-on-fatal-exception" tabindex="-1"><a class="header-anchor" href="#no-extra-info-on-fatal-exception"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--no-extra-info-on-fatal-exception" target="_blank" rel="noopener noreferrer">--no-extra-info-on-fatal-exception</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå½“ç¨‹åºé‡åˆ°ä¸€ä¸ªæ— æ³•æ¢å¤çš„é”™è¯¯ï¼Œå³è‡´å‘½å¼‚å¸¸ï¼ˆfatal exceptionï¼‰æ—¶ï¼Œé€šå¸¸ Node ä¼šæ‰“å°å‡ºé”™è¯¯ä¿¡æ¯å¹¶é€€å‡ºè¿è¡Œã€‚è¿™ä¸ªé”™è¯¯ä¿¡æ¯é€šå¸¸åŒ…æ‹¬é”™è¯¯çš„ç±»å‹ã€æè¿°ã€å †æ ˆè·Ÿè¸ªç­‰é‡è¦ä¿¡æ¯ï¼Œå¸®åŠ©å¼€å‘è€…å®šä½å’Œç†è§£é”™è¯¯ã€‚</p><p>ä» Node.js v12.17.0 å’Œ v14.0.0 å¼€å§‹ï¼ŒNode.js å¢åŠ äº†ä¸€ä¸ªé»˜è®¤å¯ç”¨çš„åŠŸèƒ½ï¼Œå®ƒä¼šåœ¨è¿™ç§è‡´å‘½å¼‚å¸¸å‘ç”Ÿæ—¶é¢å¤–æ‰“å°ä¸€äº›è¯Šæ–­ä¿¡æ¯ã€‚è¿™äº›é¢å¤–çš„ä¿¡æ¯å¯èƒ½åŒ…æ‹¬èµ„æºä½¿ç”¨æƒ…å†µã€æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ã€ç½‘ç»œçŠ¶æ€ç­‰ï¼Œåœ¨è°ƒè¯•å¤æ‚çš„é—®é¢˜æ—¶éå¸¸æœ‰ç”¨ã€‚</p><p>ç„¶è€Œï¼ŒæŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¸æƒ³è®©è¿™äº›é¢å¤–ä¿¡æ¯è¢«æ‰“å°å‡ºæ¥ã€‚å¯èƒ½æ˜¯å› ä¸ºè¿™äº›ä¿¡æ¯å¤ªå¤šæˆ–è€…åŒ…å«æ•æ„Ÿæ•°æ®ã€‚è¿™æ—¶å€™ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>--no-extra-info-on-fatal-exception</code>è¿™ä¸ªå‘½ä»¤è¡Œé€‰é¡¹æ¥å…³é—­è¿™ä¸ªç‰¹æ€§ã€‚</p><p>è®©æˆ‘ä»¬ä¸¾å‡ ä¸ªä¾‹å­æ¥è¯´æ˜è¿™ä¸ªé€‰é¡¹çš„ä½œç”¨ï¼š</p><p><strong>ä¾‹å­ 1: é»˜è®¤è¡Œä¸º</strong><br> å‡è®¾ä½ æœ‰å¦‚ä¸‹ç®€å•çš„ Node.js åº”ç”¨ç¨‹åºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// app.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™é‡Œæ•…æ„å†™ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶è·¯å¾„å¼•å‘é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/nonexistent/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ ç›´æ¥è¿è¡Œè¿™ä¸ªç¨‹åºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä½ å°†çœ‹åˆ°ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ï¼Œè¯´æ— æ³•æ‰¾åˆ°æ–‡ä»¶ã€‚ä½†è¿˜ä¼šæœ‰ä¸€äº›é¢å¤–çš„è¯Šæ–­ä¿¡æ¯ï¼Œæ¯”å¦‚å½“å‰çš„èµ„æºä½¿ç”¨çŠ¶å†µã€‚</p><p><strong>ä¾‹å­ 2: ä½¿ç”¨<code>--no-extra-info-on-fatal-exception</code></strong></p><p>å¦‚æœä½ æƒ³å…³é—­è¿™äº›é¢å¤–çš„è¯Šæ–­ä¿¡æ¯ï¼Œä½ å¯ä»¥è¿™æ ·è¿è¡Œç¨‹åºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node --no-extra-info-on-fatal-exception app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¬¡ï¼Œå½“ç¨‹åºå› ä¸ºåŒæ ·çš„é”™è¯¯é€€å‡ºæ—¶ï¼Œä½ åªä¼šçœ‹åˆ°åŸºæœ¬çš„é”™è¯¯æ¶ˆæ¯ï¼Œæ²¡æœ‰é‚£äº›é¢å¤–çš„è¯Šæ–­ä¿¡æ¯ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>--no-extra-info-on-fatal-exception</code>è¿™ä¸ªå‘½ä»¤è¡Œé€‰é¡¹å°±æ˜¯ç”¨æ¥æ§åˆ¶æ˜¯å¦è¾“å‡ºé¢å¤–çš„è¯Šæ–­ä¿¡æ¯çš„ã€‚å¦‚æœä½ ç”±äºæŸç§åŸå› ä¸éœ€è¦è¿™äº›ä¿¡æ¯ï¼Œæˆ–è€…æƒ³è¦æ›´ç²¾ç®€çš„é”™è¯¯è¾“å‡ºï¼Œå°±å¯ä»¥ç”¨è¿™ä¸ªé€‰é¡¹æ¥å…³é—­è¿™ä¸ªåŠŸèƒ½ã€‚</p><h3 id="no-force-async-hooks-checks" tabindex="-1"><a class="header-anchor" href="#no-force-async-hooks-checks"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--no-force-async-hooks-checks" target="_blank" rel="noopener noreferrer">--no-force-async-hooks-checks</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>--no-force-async-hooks-checks</code> æ˜¯ä¸€ä¸ªå¯åŠ¨æ—¶ï¼ˆCLIï¼‰é€‰é¡¹ï¼Œå®ƒå½±å“çš„æ˜¯å¼‚æ­¥é’©å­ï¼ˆasync hooksï¼‰çš„è¡Œä¸ºã€‚è¦ç†è§£è¿™ä¸ªé€‰é¡¹ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯å¼‚æ­¥é’©å­ã€‚</p><h3 id="å¼‚æ­¥é’©å­-async-hooks" tabindex="-1"><a class="header-anchor" href="#å¼‚æ­¥é’©å­-async-hooks"><span>å¼‚æ­¥é’©å­ï¼ˆAsync Hooksï¼‰</span></a></h3><p>Node.js æ˜¯ä»¥äº‹ä»¶é©±åŠ¨å’Œéé˜»å¡ I/O æ¨¡å‹è€Œé—»åï¼Œè¿™æ„å‘³ç€å¾ˆå¤šæ“ä½œæ˜¯å¼‚æ­¥è¿›è¡Œçš„ï¼Œæ¯”å¦‚è¯»å†™æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ã€‚å½“ä½ å¯åŠ¨è¿™äº›å¼‚æ­¥æ“ä½œæ—¶ï¼ŒNode.js ä¼šç«‹å³è¿›å…¥ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œè€Œä¸æ˜¯ç­‰å¾…è¿™äº›æ“ä½œå®Œæˆã€‚è¿™å°±å¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœä½ æƒ³è¦è·Ÿè¸ªä¸€ä¸ªè¯·æ±‚æˆ–è€…ä¸€ä¸ªä»»åŠ¡çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œä¼ ç»Ÿçš„æ–¹æ³•ï¼ˆä¾‹å¦‚åœ¨åŒæ­¥ç¼–ç¨‹ä¸­ç”¨æ ˆè¿½è¸ªï¼‰å°±ä¼šå¤±æ•ˆã€‚</p><p>è¿™æ—¶å€™å°±éœ€è¦å¼‚æ­¥é’©å­æŠ€æœ¯ã€‚å®ƒå…è®¸æˆ‘ä»¬åœ¨å¼‚æ­¥èµ„æºçš„ç”Ÿå‘½å‘¨æœŸä¸­çš„å…³é”®ç‚¹ä¸Šæ‰§è¡Œä¸€äº›ä»£ç ï¼Œè¿™äº›å…³é”®ç‚¹åŒ…æ‹¬ï¼š</p><ul><li><code>init</code>ï¼šä¸€ä¸ªå¼‚æ­¥æ“ä½œè¢«åˆå§‹åŒ–æ—¶ã€‚</li><li><code>before</code>ï¼šä¸€ä¸ªå¼‚æ­¥æ“ä½œå›è°ƒä¹‹å‰ã€‚</li><li><code>after</code>ï¼šä¸€ä¸ªå¼‚æ­¥æ“ä½œå›è°ƒä¹‹åã€‚</li><li><code>destroy</code>ï¼šä¸€ä¸ªå¼‚æ­¥æ“ä½œå·²ç»å®Œæˆå¹¶ä¸”å¯ä»¥è¢«åƒåœ¾å›æ”¶æ—¶ã€‚</li></ul><p>é€šè¿‡åœ¨è¿™äº›å…³é”®ç‚¹æ¤å…¥é€»è¾‘ï¼Œå¼€å‘äººå‘˜å¯ä»¥æ›´å¥½åœ°ç†è§£å’Œç›‘æ§ç¨‹åºä¸­çš„å¼‚æ­¥æµã€‚</p><h3 id="no-force-async-hooks-checks-1" tabindex="-1"><a class="header-anchor" href="#no-force-async-hooks-checks-1"><span>--no-force-async-hooks-checks</span></a></h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js ä¼šå¼ºåˆ¶æ‰§è¡Œä¸€äº›æ£€æŸ¥ä»¥ç¡®ä¿å¼‚æ­¥é’©å­æ­£ç¡®å·¥ä½œï¼Œä½†è¿™å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½æœ‰æ‰€ä¸‹é™ã€‚å¦‚æœä½ ç¡®å®šä½ çš„ä»£ç ä¸­æ²¡æœ‰å¯¹å¼‚æ­¥èµ„æºï¼ˆå¦‚ Promiseã€Timeout ç­‰ï¼‰çš„çŠ¶æ€åšéæ³•æ“ä½œï¼Œå¹¶ä¸”æ„¿æ„æ‰¿æ‹…å› æ­¤å¯èƒ½å¸¦æ¥çš„é£é™©ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>--no-force-async-hooks-checks</code> é€‰é¡¹æ¥å…³é—­è¿™äº›å¼ºåˆ¶æ€§æ£€æŸ¥ï¼Œä»¥æé«˜æ€§èƒ½ã€‚</p><h4 id="å®é™…è¿ç”¨å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨å®ä¾‹"><span>å®é™…è¿ç”¨å®ä¾‹ï¼š</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å†™ä¸€ä¸ª Node.js Web æœåŠ¡å™¨ï¼Œæ¯å½“æœ‰æ–°çš„ HTTP è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œä½ éƒ½æƒ³è·Ÿè¸ªè¯·æ±‚çš„å¤„ç†æ—¶é—´ã€‚ä½ å¯ä»¥ä½¿ç”¨å¼‚æ­¥é’©å­æ¥è®°å½•è¯·æ±‚å¼€å§‹å’Œç»“æŸçš„æ—¶é—´ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> async_hooks</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;async_hooks&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ª Map æ¥å­˜å‚¨è¯·æ±‚çš„æ—¶é—´ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> requestTimes</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆå§‹åŒ–å¼‚æ­¥é’©å­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> hook</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> async_hooks</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createHook</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  init</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">asyncId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">triggerAsyncId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;HTTPINCOMINGMESSAGE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // å½“æœ‰ HTTP è¯·æ±‚æ—¶ï¼Œè®°å½•å®ƒçš„å¼€å§‹æ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      requestTimes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">asyncId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">asyncId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> timeInfo</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> requestTimes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">asyncId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">timeInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // å½“è¯·æ±‚ç»“æŸæ—¶ï¼Œè®¡ç®—æŒç»­æ—¶é—´å¹¶è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> duration</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> timeInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Request took </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">duration</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">ms`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      requestTimes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">delete</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">asyncId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¿€æ´»é’©å­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">hook</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">enable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º HTTP æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ³¨å†Œäº†ä¸¤ä¸ªé’©å­å‡½æ•°ï¼Œ<code>init</code> ç”¨æ¥åœ¨ HTTP è¯·æ±‚åˆå§‹åŒ–æ—¶è®°å½•å¼€å§‹æ—¶é—´ï¼Œ<code>destroy</code> ç”¨æ¥åœ¨è¯·æ±‚å¯¹è±¡è¢«é”€æ¯æ—¶è¾“å‡ºæ€»è€—æ—¶ã€‚è¿™æ ·å°±å¯ä»¥åœ¨æ¯ä¸ªè¯·æ±‚å¤„ç†å®Œæ¯•åå¾—åˆ°å…¶å¤„ç†æ—¶é—´çš„ç»Ÿè®¡ä¿¡æ¯ã€‚</p><p>ç°åœ¨å‡å®šä½ çŸ¥é“ä½ çš„ä»£ç éå¸¸ç¨³å®šï¼Œå¼‚æ­¥èµ„æºç®¡ç†å¾—å½“ï¼Œå¹¶ä¸”ä½ éœ€è¦æå‡ç³»ç»Ÿæ€§èƒ½ï¼Œä½ å¯ä»¥å¯åŠ¨ Node.js åº”ç”¨æ—¶åŠ ä¸Š <code>--no-force-async-hooks-checks</code> é€‰é¡¹ï¼Œæ¥é™ä½å¼‚æ­¥é’©å­å¯èƒ½å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚</p><p>ä½ å¯ä»¥è¿™æ ·å¯åŠ¨ä½ çš„ Node.js åº”ç”¨ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --no-force-async-hooks-checks</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤å°†å…³é—­ Node.js é»˜è®¤çš„æŸäº›å¼‚æ­¥é’©å­æ£€æŸ¥ï¼Œå¯èƒ½ä¼šæé«˜åº”ç”¨æ€§èƒ½ï¼Œä½†è¯·æ³¨æ„ï¼Œè¿™æ ·åšå¯èƒ½ä¼šå¢åŠ å‡ºé”™çš„é£é™©ï¼Œå› ä¸ºä¸€æ—¦ä½ çš„ä»£ç ä¸­å­˜åœ¨å¼‚æ­¥èµ„æºçš„éæ³•æ“ä½œï¼Œå®ƒä»¬å°†ä¸å†è¢« Node.js æ•è·ã€‚</p><h3 id="no-global-search-paths" tabindex="-1"><a class="header-anchor" href="#no-global-search-paths"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--no-global-search-paths" target="_blank" rel="noopener noreferrer">--no-global-search-paths</a></span></a></h3><p><code>--no-global-search-paths</code> æ˜¯ Node.js å‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰çš„ä¸€ä¸ªé€‰é¡¹ï¼Œç”¨æ¥å‘Šè¯‰ Node.js åœ¨å¯»æ‰¾å…¨å±€å®‰è£…çš„æ¨¡å—æ—¶ä¸è¦åŒ…æ‹¬é»˜è®¤çš„å…¨å±€è·¯å¾„ã€‚</p><p>åœ¨è¯¦ç»†è§£é‡Šä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€äº›èƒŒæ™¯ä¿¡æ¯ï¼š</p><p>å½“ä½ åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä¸€ä¸ª Node.js ç¨‹åºæ—¶ï¼ŒNode.js éœ€è¦çŸ¥é“ä»å“ªé‡ŒåŠ è½½æ‰€éœ€çš„æ¨¡å—ã€‚æ¨¡å—æœ‰å‡ ç§ä¸åŒçš„æ¥æºï¼š</p><ol><li><strong>å†…ç½®æ¨¡å—</strong>ï¼šè¿™äº›æ˜¯ Node.js è‡ªå¸¦çš„æ¨¡å—ï¼Œä¾‹å¦‚ <code>fs</code> (æ–‡ä»¶ç³»ç»Ÿ), <code>http</code> (HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯)ç­‰ã€‚</li><li><strong>æœ¬åœ°æ¨¡å—</strong>ï¼šè¿™äº›æ¨¡å—å­˜å‚¨åœ¨ä½ çš„é¡¹ç›®ç›®å½•é‡Œï¼Œé€šå¸¸ä½äº <code>node_modules</code> æ–‡ä»¶å¤¹ã€‚</li><li><strong>å…¨å±€æ¨¡å—</strong>ï¼šè¿™äº›æ˜¯ä½¿ç”¨ npm (Node.js çš„åŒ…ç®¡ç†å·¥å…·) å®‰è£…åœ¨ä½ çš„ç³»ç»Ÿçš„ç‰¹å®šä½ç½®çš„æ¨¡å—ï¼Œè¿™æ ·ä½ å¯ä»¥åœ¨ä»»ä½•é¡¹ç›®ä¸­ä½¿ç”¨å®ƒä»¬ï¼Œæ— éœ€åœ¨æ¯ä¸ªé¡¹ç›®ä¸­å•ç‹¬å®‰è£…ã€‚</li></ol><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ Node.js éœ€è¦åŠ è½½ä¸€ä¸ªæ¨¡å—ä½†åœ¨æœ¬åœ°æ²¡æœ‰æ‰¾åˆ°æ—¶ï¼Œå®ƒä¼šå°è¯•åœ¨ä¸€äº›é¢„è®¾çš„å…¨å±€è·¯å¾„æŸ¥æ‰¾ã€‚è¿™äº›è·¯å¾„é€šå¸¸åŒ…æ‹¬ä½ ç”¨æˆ·ç›®å½•ä¸‹çš„å…¨å±€ <code>node_modules</code> æ–‡ä»¶å¤¹ï¼Œä»¥åŠå¯èƒ½ç”± Node.js ç‰ˆæœ¬ç®¡ç†å™¨ç®¡ç†çš„å…¶ä»–è·¯å¾„ã€‚</p><p>ç„¶è€Œï¼Œæœ‰æ—¶å€™ä½ å¯èƒ½ä¸æƒ³è¦ Node.js æŸ¥æ‰¾å…¨å±€è·¯å¾„ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœä½ æ­£åœ¨æ„å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œä½ å¸Œæœ›ç¡®ä¿åªä½¿ç”¨è¯¥åº”ç”¨ç¨‹åºä¸­æŒ‡å®šçš„ä¾èµ–ï¼Œè€Œä¸æ˜¯æ„å¤–åœ°ä½¿ç”¨åˆ°å…¨å±€å®‰è£…çš„æ¨¡å—ç‰ˆæœ¬ã€‚è¿™å°±æ˜¯ <code>--no-global-search-paths</code> é€‰é¡¹æ´¾ä¸Šç”¨åœºçš„æ—¶å€™ã€‚</p><p>ä½¿ç”¨ <code>--no-global-search-paths</code> é€‰é¡¹å¯ä»¥é˜²æ­¢ Node.js è‡ªåŠ¨åœ°å°†è¿™äº›å…¨å±€è·¯å¾„çº³å…¥æœç´¢èŒƒå›´ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå¦‚æœç¼ºå°‘æŸä¸ªæ¨¡å—ï¼Œä½ çš„ç¨‹åºä¼šç«‹å³æŠ¥é”™ï¼Œè€Œä¸æ˜¯æ— æ„ä¸­ä½¿ç”¨å…¨å±€å®‰è£…çš„æ¨¡å—ã€‚</p><p>å®é™…è¿ç”¨ä¾‹å­ï¼š<br> å‡è®¾ä½ æœ‰ä¸€ä¸ª Node.js é¡¹ç›®ï¼Œåœ¨é¡¹ç›®çš„ <code>package.json</code> æ–‡ä»¶ä¸­ä½ å·²ç»å£°æ˜äº†æ‰€æœ‰éœ€è¦çš„ä¾èµ–ã€‚ä¸ºäº†ç¡®ä¿é¡¹ç›®ä¸ä¼šä¾èµ–äºå¼€å‘æœºå™¨ä¸Šçš„å…¨å±€æ¨¡å—ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨ <code>--no-global-search-paths</code> é€‰é¡¹ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --no-global-search-paths</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœä½ çš„ <code>app.js</code> æ–‡ä»¶æˆ–è€…å…¶ä¸­çš„ä»»ä½•æ¨¡å—å°è¯•å¼•å…¥ä¸€ä¸ªæœªåœ¨æœ¬åœ° <code>node_modules</code> ä¸­å­˜åœ¨çš„æ¨¡å—ï¼ŒNode.js å°†ä¸ä¼šå»å…¨å±€è·¯å¾„ä¸­æœç´¢ï¼Œè€Œæ˜¯ç›´æ¥æŠ›å‡ºé”™è¯¯ã€‚è¿™æœ‰åŠ©äºç»´æŠ¤è½¯ä»¶ä¾èµ–çš„æ¸…æ™°åº¦å’Œä¸€è‡´æ€§ã€‚</p><h3 id="no-network-family-autoselection" tabindex="-1"><a class="header-anchor" href="#no-network-family-autoselection"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--no-network-family-autoselection" target="_blank" rel="noopener noreferrer">--no-network-family-autoselection</a></span></a></h3><p>Node.js ä¸­çš„<code>--no-network-family-autoselection</code>æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼ˆCLIï¼‰ï¼Œå®ƒç”¨äºæ§åˆ¶ Node.js å¦‚ä½•é€‰æ‹©ç½‘ç»œåœ°å€æ—ï¼ˆIPv4 æˆ– IPv6ï¼‰å½“ä½ æ²¡æœ‰æ˜ç¡®æŒ‡å®šè¦ä½¿ç”¨çš„åœ°å€æ—æ—¶ã€‚</p><p>é€šå¸¸ï¼Œå½“ Node.js åº”ç”¨ç¨‹åºéœ€è¦è¿æ¥åˆ°ç½‘ç»œä¸Šçš„æŸä¸ªæœåŠ¡æ—¶ï¼Œæ¯”å¦‚ä½ è¦åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨æˆ–è€…å‘èµ·ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œå®ƒä¼šæ ¹æ®æ“ä½œç³»ç»Ÿæä¾›çš„ä¿¡æ¯æ¥è‡ªåŠ¨å†³å®šä½¿ç”¨ IPv4 è¿˜æ˜¯ IPv6ã€‚å¦‚æœä½ çš„ç³»ç»ŸåŒæ—¶æ”¯æŒ IPv4 å’Œ IPv6ï¼Œé‚£ä¹ˆ Node.js å¯èƒ½ä¼šæ ¹æ®ä¸€å®šçš„é€»è¾‘æ¥é€‰æ‹©ä½¿ç”¨å“ªä¸ªã€‚</p><p>ä¸¾ä¸ªå®é™…çš„ä¾‹å­ï¼š<br> å‡è®¾ä½ ç¼–å†™äº†ä¸€ä¸ªç®€å•çš„ Node.js Web æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä½ æƒ³è®©å®ƒåœ¨æœ¬æœºå¯ç”¨ï¼Œæ‰€ä»¥ä½ å¯èƒ½ä¼šç”¨ä¸‹é¢è¿™æ ·çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server is running on http://localhost:3000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä½ è¿è¡Œè¿™æ®µä»£ç æ—¶ï¼ŒNode.js ä¼šé»˜è®¤å»ç›‘å¬ IPv6 æˆ– IPv4 åœ°å€ï¼Œå–å†³äºä½ çš„æ“ä½œç³»ç»Ÿé…ç½®å’Œç½‘ç»œç¯å¢ƒã€‚ä½†å¦‚æœä½ çš„ç½‘ç»œç¯å¢ƒæœ‰äº›å¤æ‚æˆ–è€…ç‰¹æ®Šï¼Œè‡ªåŠ¨é€‰æ‹©å¯èƒ½å¹¶ä¸æ˜¯ä½ æƒ³è¦çš„ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½è¿æ¥ä¸ç¨³å®šæˆ–è€…æ ¹æœ¬æ²¡æœ‰ IPv6 è¿æ¥ï¼Œä½†æ˜¯ Node.js ä»ç„¶å¯èƒ½å°è¯•å»ä½¿ç”¨ IPv6ï¼Œä»è€Œå¯¼è‡´ä½ çš„æœåŠ¡å™¨å¯¹äºéƒ¨åˆ†ç”¨æˆ·ä¸å¯è¾¾ã€‚</p><p>ä½¿ç”¨<code>--no-network-family-autoselection</code>é€‰é¡¹ï¼Œå¯ä»¥ç¦æ­¢è¿™ç§è‡ªåŠ¨é€‰æ‹©è¡Œä¸ºã€‚ä½ å¯ä»¥é€šè¿‡åœ¨å¯åŠ¨ Node.js åº”ç”¨æ—¶æ·»åŠ è¿™ä¸ªæ ‡å¿—æ¥æ˜ç¡®å‘Šè¯‰ Node.js ä¸è¦è‡ªåŠ¨é€‰æ‹©ç½‘ç»œåœ°å€æ—ï¼Œè€Œæ˜¯è®©ä½ è‡ªå·±åœ¨ä»£ç ä¸­æŒ‡å®šè¦ä½¿ç”¨ IPv4 è¿˜æ˜¯ IPv6ã€‚</p><p>ä¾‹å¦‚ï¼Œä½ å¯ä»¥è¿™æ ·å¯åŠ¨ä½ çš„ Node.js åº”ç”¨ç¨‹åºï¼Œç¡®ä¿å®ƒåªä½¿ç”¨ IPv4ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --no-network-family-autoselection</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨ä½ çš„åº”ç”¨ä»£ç ä¸­ï¼Œä½ å¯ä»¥æ˜¾å¼åœ°æŒ‡å®š IP ç‰ˆæœ¬ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;0.0.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¼ºåˆ¶ä½¿ç”¨IPv4åœ°å€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server is running on http://localhost:3000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>&#39;0.0.0.0&#39;</code>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ IPv4 åœ°å€ï¼Œå®ƒå‘Šè¯‰ Node.js ç›‘å¬æ‰€æœ‰å¯ç”¨çš„ IPv4 åœ°å€ã€‚å¦‚æœä½ æƒ³è¦å¼ºåˆ¶æœåŠ¡å™¨åªç›‘å¬ IPv6 åœ°å€ï¼Œä½ å¯ä»¥ç”¨<code>&#39;::&#39;</code>è¿™ä¸ªç‰¹æ®Šçš„ IPv6 åœ°å€ä»£æ›¿ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œ<code>--no-network-family-autoselection</code>è¿™ä¸ªé€‰é¡¹ç»™äº†ä½ æ›´å¤šçš„æ§åˆ¶æƒï¼Œå…è®¸ä½ ç¡®åˆ‡åœ°æŒ‡å®šä½ çš„ Node.js åº”ç”¨ç¨‹åºåº”è¯¥ä½¿ç”¨å“ªä¸ªç½‘ç»œåœ°å€æ—ï¼Œè¿™åœ¨å¤„ç†ç‰¹å®šçš„ç½‘ç»œé…ç½®æ—¶éå¸¸æœ‰ç”¨ã€‚</p><h3 id="no-warnings" tabindex="-1"><a class="header-anchor" href="#no-warnings"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--no-warnings" target="_blank" rel="noopener noreferrer">--no-warnings</a></span></a></h3><p>å¥½çš„ï¼ŒNode.js çš„ <code>--no-warnings</code> æ˜¯ä¸€ä¸ªå¯åŠ¨æ—¶çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼ˆflagï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨ä½ è¿è¡Œ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œè®© Node.js ä¸è¦æ˜¾ç¤ºä»»ä½•çš„è­¦å‘Šæ¶ˆæ¯ã€‚</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“ä½ çš„ Node.js ç¨‹åºä¸­å‡ºç°ä¸€äº›æ½œåœ¨é—®é¢˜æ—¶ï¼Œæ¯”å¦‚ä½¿ç”¨äº†ä¸æ¨èä½¿ç”¨çš„ç‰¹æ€§ï¼ˆdeprecated featuresï¼‰æˆ–è€…å…¶ä»–å¯èƒ½ä¼šå½±å“ç¨‹åºè¿è¡Œçš„é—®é¢˜ï¼ŒNode.js ä¼šåœ¨æ§åˆ¶å°ä¸­æ‰“å°å‡ºè­¦å‘Šä¿¡æ¯ã€‚è¿™äº›è­¦å‘Šä¿¡æ¯é€šå¸¸æ˜¯ä¸ºäº†å¸®åŠ©å¼€å‘è€…æ³¨æ„åˆ°å¹¶ä¿®å¤æ½œåœ¨çš„é—®é¢˜ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¼€å‘è€…å¯èƒ½å·²ç»æ„è¯†åˆ°è¿™äº›è­¦å‘Šä½†æš‚æ—¶ä¸æƒ³å¤„ç†å®ƒä»¬ï¼Œæˆ–è€…æƒ³è¦ä¸€ä¸ªæ›´å¹²å‡€çš„æ—¥å¿—è¾“å‡ºï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ <code>--no-warnings</code> é€‰é¡¹æ¥ç¦æ­¢è¿™äº›è­¦å‘Šä¿¡æ¯çš„æ˜¾ç¤ºã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><ol><li>å‡è®¾ä½ æœ‰ä¸€ä¸ªç®€å•çš„ Node.js ç¨‹åº <code>app.js</code>ï¼Œé‡Œé¢ä½¿ç”¨äº†ä¸€ä¸ª Node.js è®¤ä¸ºåº”è¯¥é¿å…ä½¿ç”¨çš„ç‰¹æ€§ï¼ˆä¾‹å¦‚è¿‡æ—¶çš„ APIï¼‰ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// app.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">existsSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™æ˜¯ä¸€ä¸ªä¸æ¨èä½¿ç”¨çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒæ˜¯åŒæ­¥çš„ï¼Œå¯èƒ½ä¼šé˜»å¡äº‹ä»¶å¾ªç¯ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç¨‹åºæ‰§è¡Œå®Œæ¯•ï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>å½“ä½ åœ¨ç»ˆç«¯ï¼ˆå‘½ä»¤è¡Œç•Œé¢ï¼‰è¿è¡Œè¿™ä¸ªç¨‹åºæ—¶ï¼Œä½ é€šå¸¸ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„è­¦å‘Šæ¶ˆæ¯ï¼š</li></ol><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node:12345</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) [DEP0123] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">DeprecationWarning:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fs.existsSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">is</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> deprecated,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> use</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fs.statSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">instead</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ç¨‹åºæ‰§è¡Œå®Œæ¯•ï¼</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>å¦‚æœä½ ä¸æƒ³çœ‹åˆ°è¿™ä¸ªè­¦å‘Šæ¶ˆæ¯ï¼Œä½ å¯ä»¥åœ¨è¿è¡Œç¨‹åºæ—¶åŠ ä¸Š <code>--no-warnings</code> é€‰é¡¹ï¼š</li></ol><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --no-warnings</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ç¨‹åºæ‰§è¡Œå®Œæ¯•ï¼</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œå³ä½¿ä½ çš„ç¨‹åºä¸­ä½¿ç”¨äº†ä¸æ¨èçš„ç‰¹æ€§ï¼ŒNode.js ä¹Ÿä¸ä¼šåœ¨æ§åˆ¶å°ä¸­è¾“å‡ºè­¦å‘Šæ¶ˆæ¯äº†ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ <code>--no-warnings</code> é€‰é¡¹å¯ä»¥éšè—è­¦å‘Šä¿¡æ¯ï¼Œä½†å¹¶ä¸æ„å‘³ç€ä½ åº”è¯¥å¿½è§†è¿™äº›è­¦å‘Šã€‚åœ¨å¼€å‘é˜¶æ®µï¼Œæœ€ä½³å®è·µè¿˜æ˜¯åº”è¯¥å…³æ³¨å¹¶è§£å†³è¿™äº›è­¦å‘Šæ‰€æŒ‡å‡ºçš„é—®é¢˜ã€‚ä½¿ç”¨ <code>--no-warnings</code> æ›´å¤šçš„æ˜¯åœ¨ç‰¹å®šåœºæ™¯ä¸‹ï¼Œæ¯”å¦‚ç”Ÿäº§ç¯å¢ƒæ—¥å¿—è¾“å‡ºæˆ–è€…æµ‹è¯•è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªä¸´æ—¶è§£å†³æ–¹æ¡ˆã€‚</p><h3 id="node-memory-debug" tabindex="-1"><a class="header-anchor" href="#node-memory-debug"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--node-memory-debug" target="_blank" rel="noopener noreferrer">--node-memory-debug</a></span></a></h3><p>Node.js <code>--node-memory-debug</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨äºå¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œå¢åŠ å†…å­˜ç›¸å…³çš„è°ƒè¯•ä¿¡æ¯è¾“å‡ºã€‚è¿™ä¸ªé€‰é¡¹å¯¹äºé‚£äº›éœ€è¦è¯Šæ–­å’Œè§£å†³å†…å­˜ä½¿ç”¨é—®é¢˜æˆ–å†…å­˜æ³„éœ²çš„å¼€å‘è€…éå¸¸æœ‰å¸®åŠ©ã€‚</p><p>å½“ä½ ä½¿ç”¨äº† <code>--node-memory-debug</code> é€‰é¡¹æ¥è¿è¡Œä½ çš„ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼ŒNode.js ä¼šåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰“å°é¢å¤–çš„å†…å­˜ç›¸å…³çš„è°ƒè¯•ä¿¡æ¯ã€‚è¿™åŒ…æ‹¬äº†ä¸€äº›è¯¦ç»†çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š</p><ul><li>å †å†…å­˜çš„ä½¿ç”¨æƒ…å†µ</li><li>å†…å­˜åˆ†é…å’Œå›æ”¶çš„æ“ä½œ</li><li>å¯èƒ½å­˜åœ¨çš„å†…å­˜æ³„æ¼è­¦å‘Š</li></ul><p>è®©æˆ‘ä»¬çœ‹å‡ ä¸ªå®é™…çš„åº”ç”¨ä¾‹å­ï¼š</p><h3 id="å®ä¾‹-1-è·Ÿè¸ªæ™®é€šçš„-node-js-åº”ç”¨ç¨‹åºå†…å­˜ä½¿ç”¨æƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-1-è·Ÿè¸ªæ™®é€šçš„-node-js-åº”ç”¨ç¨‹åºå†…å­˜ä½¿ç”¨æƒ…å†µ"><span>å®ä¾‹ 1ï¼šè·Ÿè¸ªæ™®é€šçš„ Node.js åº”ç”¨ç¨‹åºå†…å­˜ä½¿ç”¨æƒ…å†µ</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªç®€å•çš„ Node.js è„šæœ¬ï¼Œå«åš <code>app.js</code>ï¼Œé‡Œé¢æœ‰ä¸€äº›å¤„ç†æ•°æ®çš„é€»è¾‘ã€‚å¦‚æœä½ æƒ³è¦æŸ¥çœ‹è¿™ä¸ªè„šæœ¬åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --node-memory-debug</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç„¶åä½ ä¼šåœ¨å‘½ä»¤è¡Œä¸­çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„è¾“å‡ºï¼š</p><div class="language-plaintext line-numbers-mode" data-highlighter="shiki" data-ext="plaintext" data-title="plaintext" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[12345:0x3300000]    10 ms: Scavenge 2.3 (3.0) -&gt; 1.7 (3.0) MB, 1.2 / 0 ms  (average mu = 0.132, current mu = 0.245)</span></span>
<span class="line"><span>...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªå†…å­˜æ“ä½œçš„è®°å½•ï¼Œå®ƒæ˜¾ç¤ºäº†å‘ç”Ÿæ—¶é—´ã€æ“ä½œç±»å‹ï¼ˆå¦‚ Scavengeï¼Œæ˜¯ V8 åƒåœ¾æ”¶é›†å™¨çš„ä¸€ç§ç®—æ³•ï¼‰ã€ä»¥åŠå†…å­˜å¤§å°ç­‰ä¿¡æ¯ã€‚</p><h3 id="å®ä¾‹-2-è°ƒè¯•å†…å­˜æ³„éœ²" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹-2-è°ƒè¯•å†…å­˜æ³„éœ²"><span>å®ä¾‹ 2ï¼šè°ƒè¯•å†…å­˜æ³„éœ²</span></a></h3><p>å¦‚æœä½ æ€€ç–‘ä½ çš„ Node.js åº”ç”¨æœ‰å†…å­˜æ³„éœ²ï¼Œå³å†…å­˜éšç€æ—¶é—´çš„æ¨ç§»ä¸æ–­å¢åŠ ä½†æ²¡æœ‰æœ‰æ•ˆé‡Šæ”¾ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨åº”ç”¨æ—¶åŠ ä¸Š <code>--node-memory-debug</code> é€‰é¡¹ã€‚è¿™æ ·ï¼Œä½ å¯ä»¥è§‚å¯Ÿåˆ°å†…å­˜ä½¿ç”¨æƒ…å†µæ˜¯å¦éšç€æ—¶é—´å¢åŠ è€Œä¸é™ä½ï¼Œä»è€Œåˆ¤æ–­æ˜¯å¦å¯èƒ½å­˜åœ¨å†…å­˜æ³„éœ²ã€‚</p><h3 id="æ³¨æ„äº‹é¡¹-2" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-2"><span>æ³¨æ„äº‹é¡¹</span></a></h3><p>è™½ç„¶ <code>--node-memory-debug</code> æä¾›äº†å¾ˆå¤šæœ‰ç”¨çš„ä¿¡æ¯ï¼Œä½†å®ƒä¹Ÿä¼šäº§ç”Ÿå¤§é‡çš„è¾“å‡ºï¼Œå¯èƒ½ä¼šè®©æ–°æ‰‹æ„Ÿåˆ°å›°æƒ‘ã€‚æ­¤å¤–ï¼Œå› ä¸ºè®°å½•äº†å¤§é‡çš„å†…å­˜æ“ä½œä¿¡æ¯ï¼Œå®ƒå¯èƒ½ä¼šå¯¹ç¨‹åºçš„æ€§èƒ½é€ æˆå½±å“ï¼Œæ‰€ä»¥è¿™ä¸ªé€‰é¡¹æ›´å¤šæ˜¯åœ¨å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œè€Œä¸æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒã€‚</p><p>åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œä½ å¯èƒ½éœ€è¦ç»“åˆå…¶ä»–å·¥å…·å’ŒæŠ€å·§æ¥æ›´å¥½åœ°ç†è§£è¿™äº›è°ƒè¯•ä¿¡æ¯ï¼Œå¹¶å®šä½å†…å­˜ä½¿ç”¨é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨å †å¿«ç…§ï¼ˆheap snapshotï¼‰å’Œåˆ†æå™¨ï¼ˆprofilerï¼‰æ¥è¯¦ç»†äº†è§£å†…å­˜åˆ†é…å’Œå›æ”¶çš„æƒ…å†µã€‚</p><p>æ€»ä¹‹ï¼Œ<code>--node-memory-debug</code> æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„é€‰é¡¹ï¼Œå®ƒèƒ½å¸®åŠ©ä½ æ·±å…¥äº†è§£ä½ çš„åº”ç”¨ç¨‹åºå¦‚ä½•ä½¿ç”¨å’Œç®¡ç†å†…å­˜ã€‚é€šè¿‡è¿™äº›ä¿¡æ¯ï¼Œä½ å°±èƒ½æ›´å¥½åœ°ä¼˜åŒ–ä½ çš„åº”ç”¨ï¼Œç¡®ä¿å®ƒè¿è¡Œå¾—æ›´ç¨³å®šã€æ›´é«˜æ•ˆã€‚</p><h3 id="openssl-config-file" tabindex="-1"><a class="header-anchor" href="#openssl-config-file"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--openssl-configfile" target="_blank" rel="noopener noreferrer">--openssl-config=file</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªèƒ½å¤Ÿè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ã€‚å®ƒä½¿ç”¨äº†è°·æ­Œ Chrome æµè§ˆå™¨çš„ V8 å¼•æ“æ¥è§£é‡Šå’Œæ‰§è¡Œ JavaScript ä»£ç ã€‚ç”±äº Node.js æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨å’Œéé˜»å¡ I/O æ¨¡å‹ï¼Œæ‰€ä»¥å®ƒç‰¹åˆ«é€‚åˆå¤„ç†å¤§é‡çš„å¹¶å‘è¿æ¥ï¼Œè¿™ä½¿å¾— Node.js æˆä¸ºå¼€å‘å¦‚å®æ—¶åº”ç”¨ç¨‹åºï¼ˆæ¯”å¦‚èŠå¤©åº”ç”¨æˆ–æ¸¸æˆï¼‰ä»¥åŠæ„å»ºæœåŠ¡ç«¯ API çš„æµè¡Œé€‰æ‹©ã€‚</p><p>åœ¨ä½ ç»™å‡ºçš„é“¾æ¥ä¸­æåˆ°çš„<code>--openssl-config=file</code>æ˜¯ Node.js å‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰çš„ä¸€ä¸ªé€‰é¡¹ï¼Œå®ƒå…è®¸ä½ æŒ‡å®šä¸€ä¸ª OpenSSL çš„é…ç½®æ–‡ä»¶ã€‚ç°åœ¨æˆ‘ä¼šè¯¦ç»†è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ OpenSSLï¼Œä»¥åŠæ€æ ·ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œå¹¶ä¸¾ä¾‹è¯´æ˜ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-openssl" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-openssl"><span>ä»€ä¹ˆæ˜¯ OpenSSLï¼Ÿ</span></a></h3><p>OpenSSL æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæä¾›äº†å¼ºå¤§çš„åŠ å¯†åº“ï¼Œæ”¯æŒä¼—å¤šåŠ å¯†ç®—æ³•ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº SSL å’Œ TLS åè®®ã€‚è¿™äº›åè®®åœ¨äº’è”ç½‘é€šä¿¡ä¸­éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒä»¬å¸®åŠ©ç¡®ä¿æ•°æ®çš„å®‰å…¨ä¼ è¾“ã€‚</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦æŒ‡å®š-openssl-é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦æŒ‡å®š-openssl-é…ç½®æ–‡ä»¶"><span>ä¸ºä»€ä¹ˆéœ€è¦æŒ‡å®š OpenSSL é…ç½®æ–‡ä»¶ï¼Ÿ</span></a></h3><p>æœ‰æ—¶ï¼Œåœ¨ä½¿ç”¨ Node.js è¿›è¡Œå¼€å‘æ—¶ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨ç‰¹å®šçš„åŠ å¯†è®¾ç½®ï¼Œæ¯”å¦‚è‡ªå®šä¹‰è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰åˆ—è¡¨ã€ç‰¹æ®Šçš„åŠ å¯†ç®—æ³•é€‰é¡¹ç­‰ã€‚OpenSSL é…ç½®æ–‡ä»¶å…è®¸ä½ ç²¾ç»†åœ°æ§åˆ¶è¿™äº›è®¾ç½®ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-openssl-config-file" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-openssl-config-file"><span>å¦‚ä½•ä½¿ç”¨<code>--openssl-config=file</code>ï¼Ÿ</span></a></h3><p>å½“ä½ å¯åŠ¨ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œé€šå¸¸ä¼šåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ç±»ä¼¼äº<code>node app.js</code>çš„å‘½ä»¤ã€‚å¦‚æœä½ éœ€è¦è‡ªå®šä¹‰ OpenSSL è®¾ç½®ï¼Œä½ å¯ä»¥æ·»åŠ <code>--openssl-config</code>é€‰é¡¹ï¼Œåé¢è·Ÿä¸Šé…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œä¾‹å¦‚ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --openssl-config=./path/to/openssl.cnf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™é‡Œçš„<code>./path/to/openssl.cnf</code>å°±æ˜¯ä½ çš„ OpenSSL é…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚è¿™ä¸ªæ–‡ä»¶åŒ…å«äº† OpenSSL çš„é…ç½®æŒ‡ä»¤ã€‚</p><h3 id="å®é™…ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-3"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦åŠ å¯†çš„ HTTPS æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä½ å¸Œæœ›ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼ŒåŒæ—¶è¿˜æƒ³è¦æŒ‡å®šæŸäº›åŠ å¯†åè®®å’Œå¯†ç å¥—ä»¶ã€‚ä½ å¯èƒ½ä¼šåˆ›å»ºä¸€ä¸ª<code>openssl.cnf</code>æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†ä»¥ä¸‹å†…å®¹ï¼š</p><div class="language-cnf line-numbers-mode" data-highlighter="shiki" data-ext="cnf" data-title="cnf" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[ req ]</span></span>
<span class="line"><span>distinguished_name = req_distinguished_name</span></span>
<span class="line"><span>x509_extensions = v3_req</span></span>
<span class="line"><span>prompt = no</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[ req_distinguished_name ]</span></span>
<span class="line"><span>C = US</span></span>
<span class="line"><span>ST = California</span></span>
<span class="line"><span>L = San Francisco</span></span>
<span class="line"><span>O = My Company Name</span></span>
<span class="line"><span>CN = localhost</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[ v3_req ]</span></span>
<span class="line"><span>keyUsage = keyEncipherment, dataEncipherment</span></span>
<span class="line"><span>extendedKeyUsage = serverAuth</span></span>
<span class="line"><span>subjectAltName = @alt_names</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[ alt_names ]</span></span>
<span class="line"><span>DNS.1 = localhost</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨ä½ çš„ Node.js æœåŠ¡å™¨æ—¶ä½¿ç”¨è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --openssl-config=./path/to/openssl.cnf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> server.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™å°†å‘Šè¯‰ Node.js ä½¿ç”¨ä½ å®šä¹‰çš„ OpenSSL é…ç½®æ¥å¯åŠ¨ HTTPS æœåŠ¡å™¨ï¼Œä»è€Œå®ç°è‡ªå®šä¹‰çš„åŠ å¯†è®¾ç½®ã€‚è¿™å¯¹äºæµ‹è¯•ç¯å¢ƒæˆ–è€…éœ€è¦é«˜åº¦å®šåˆ¶åŒ–åŠ å¯†éœ€æ±‚çš„åœºæ™¯æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p><p>è¯·æ³¨æ„ï¼Œä½¿ç”¨è‡ªå®šä¹‰ OpenSSL é…ç½®å¯èƒ½ä¼šå¢åŠ å®‰å…¨é£é™©ï¼Œå› ä¸ºé”™è¯¯çš„é…ç½®å¯èƒ½å¯¼è‡´åŠ å¯†æªæ–½è¢«å‰Šå¼±ã€‚å› æ­¤ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¿®æ”¹é»˜è®¤åŠ å¯†è®¾ç½®æ—¶åº”è¯¥æ ¼å¤–å°å¿ƒï¼Œå¹¶ç¡®ä¿æ‚¨å®Œå…¨ç†è§£é…ç½®æ–‡ä»¶ä¸­å„ä¸ªé€‰é¡¹çš„æ„ä¹‰ã€‚</p><h3 id="openssl-legacy-provider" tabindex="-1"><a class="header-anchor" href="#openssl-legacy-provider"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--openssl-legacy-provider" target="_blank" rel="noopener noreferrer">--openssl-legacy-provider</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªç”¨æ¥å¼€å‘æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºçš„å¹³å°ï¼Œå®ƒä½¿ç”¨ JavaScript è¯­è¨€ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰æ—¶ä½ éœ€è¦å¤„ç†å®‰å…¨é€šä¿¡ï¼Œå¦‚ HTTPS è¯·æ±‚æˆ–æ•°æ®åŠ å¯†ç­‰æ“ä½œã€‚ä¸ºäº†å®Œæˆè¿™äº›ä»»åŠ¡ï¼ŒNode.js ä½¿ç”¨äº† OpenSSL è¿™ä¸ªå¹¿æ³›é‡‡ç”¨çš„å®‰å…¨é€šä¿¡åº“ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥è°ˆè°ˆ <code>--openssl-legacy-provider</code> è¿™ä¸ªé€‰é¡¹ã€‚</p><p>OpenSSL åº“éšç€æ—¶é—´çš„æ¨ç§»åœ¨ä¸æ–­æ›´æ–°å’Œæ”¹è¿›ï¼Œä»¥æä¾›æ›´å¥½çš„å®‰å…¨æ€§ã€‚æŸäº›æ—§ç‰ˆæœ¬çš„åŠ å¯†ç®—æ³•å› ä¸ºä¸å¤Ÿå®‰å…¨ï¼Œé€æ¸è¢«æ·˜æ±°ï¼Œå¹¶ä¸”åœ¨æ–°ç‰ˆæœ¬çš„åº“ä¸­ä¸å†é»˜è®¤åŒ…å«ã€‚ç„¶è€Œï¼Œä¸€äº›æ—§çš„åº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿå¯èƒ½ä»ç„¶ä¾èµ–è¿™äº›ä¸å†æ¨èä½¿ç”¨çš„åŠ å¯†ç®—æ³•ã€‚</p><p>å½“ä½ åœ¨ä½¿ç”¨ Node.js v21.7.1 æˆ–å…¶ä»–å…·æœ‰ç±»ä¼¼æ”¯æŒçš„ç‰ˆæœ¬æ—¶ï¼Œå‡å¦‚ä½ çš„åº”ç”¨ç¨‹åºéœ€è¦ä½¿ç”¨åˆ°è¿™äº›å·²ç»ä¸è¢«æ¨èçš„è€æ—§ç®—æ³•ï¼Œä½ å°±ä¼šéœ€è¦ç”¨åˆ° <code>--openssl-legacy-provider</code> è¿™ä¸ªå‘½ä»¤è¡Œæ ‡å¿—ã€‚</p><p>é€šè¿‡æ·»åŠ  <code>--openssl-legacy-provider</code> å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºï¼Œä½ å‘Šè¯‰ Node.js å…è®¸ä½¿ç”¨ OpenSSL çš„ legacy providerï¼ˆä¼ ç»Ÿä¾›åº”è€…ï¼‰ï¼Œå³å…è®¸ä½¿ç”¨é‚£äº›è¢«è®¤ä¸ºä¸å¤Ÿå®‰å…¨ä½†å‡ºäºæŸäº›ç†ç”±éœ€è¦ç»´æŒå‘åå…¼å®¹æ€§çš„ç®—æ³•ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-4"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p><strong>ä¾‹å­ 1ï¼šå¯åŠ¨è„šæœ¬</strong><br> å‡è®¾ä½ æœ‰ä¸€ä¸ª Node.js è„šæœ¬ <code>server.js</code>ï¼Œå®ƒä½¿ç”¨äº†ä¸æ¨èçš„åŠ å¯†ç®—æ³•ã€‚ä¸ºäº†è®©è¿™ä¸ªè„šæœ¬æ­£å¸¸å·¥ä½œï¼Œä½ å¯ä»¥åœ¨ç»ˆç«¯è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --openssl-legacy-provider</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> server.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œä½ çš„ <code>server.js</code> åœ¨æ‰§è¡Œæ—¶å°±èƒ½å¤Ÿä½¿ç”¨é‚£äº›æ—§çš„åŠ å¯†ç®—æ³•äº†ã€‚</p><p><strong>ä¾‹å­ 2ï¼šnpm è„šæœ¬</strong><br> å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ npm å¹¶ä¸”å¸Œæœ›åœ¨ <code>package.json</code> ä¸­è®¾ç½®å¯åŠ¨å‘½ä»¤ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;scripts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node --openssl-legacy-provider server.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åä½ åªéœ€è¦åœ¨ç»ˆç«¯è¿è¡Œ <code>npm start</code> å°±å¯ä»¥å¯åŠ¨ä½ çš„åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”å…è®¸ä½¿ç”¨è€æ—§çš„åŠ å¯†ç®—æ³•ã€‚</p><p>è¯·æ³¨æ„ï¼Œä¾èµ–è€æ—§åŠ å¯†ç®—æ³•æ˜¯ä¸€ä¸ªæ½œåœ¨çš„å®‰å…¨é£é™©ï¼Œæ‰€ä»¥åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œä½ åº”å½“å°½é‡å‡çº§ä½ çš„ä»£ç ä»¥ä½¿ç”¨æ›´ç°ä»£ã€å®‰å…¨çš„ç®—æ³•ã€‚ä½¿ç”¨ <code>--openssl-legacy-provider</code> åº”å½“æ˜¯ä¸€ä¸ªä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼Œè€Œä¸æ˜¯é•¿æœŸçš„å®è·µã€‚</p><h3 id="openssl-shared-config" tabindex="-1"><a class="header-anchor" href="#openssl-shared-config"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--openssl-shared-config" target="_blank" rel="noopener noreferrer">--openssl-shared-config</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 JavaScript å¼•æ“æ„å»ºçš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒã€‚å®ƒé€šå¸¸è¢«ç”¨äºåˆ›å»ºæœåŠ¡å™¨ç«¯çš„åº”ç”¨ç¨‹åºï¼Œä½†ä¹Ÿå¯ä»¥åœ¨å…¶ä»–å„ç§åœºæ™¯ä¸‹ä½¿ç”¨ã€‚</p><p>åœ¨ Node.js ä¸­ï¼ŒOpenSSL æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ç»„ä»¶ï¼Œå› ä¸ºå®ƒæä¾›äº†åŠ å¯†åŠŸèƒ½ï¼Œè¿™ä½¿å¾—å¯ä»¥é€šè¿‡ HTTPS å®‰å…¨åœ°å¤„ç†ç½‘ç»œé€šä¿¡ï¼Œå­˜å‚¨æ•°æ®ç­‰ã€‚ç®€å•æ¥è¯´ï¼ŒOpenSSL å°±æ˜¯ä¸ªå¸®åŠ©ä½ åœ¨åº”ç”¨ä¸­å®æ–½å®‰å…¨æ ‡å‡†çš„å·¥å…·åº“ã€‚</p><p><code>--openssl-shared-config</code> æ˜¯ Node.js åœ¨å¯åŠ¨æ—¶å¯ä»¥æ¥å—çš„ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼ˆæˆ–è€…ç§°ä¹‹ä¸ºâ€œæ ‡å¿—â€ï¼‰ã€‚è¿™ä¸ªé€‰é¡¹å‘Šè¯‰ Node.js ä½¿ç”¨ç³»ç»Ÿå…±äº«çš„ OpenSSL é…ç½®æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ Node.js è‡ªèº«å†…ç½®çš„ OpenSSL é…ç½®ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js ä¼šä½¿ç”¨å®ƒè‡ªå·±çš„ OpenSSL é…ç½®æ–‡ä»¶ï¼Œè¿™äº›é…ç½®æ–‡ä»¶æ˜¯åœ¨ç¼–è¯‘ Node.js æ—¶ä¸€èµ·æ‰“åŒ…è¿›å»çš„ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½æƒ³è¦è®© Node.js ä½¿ç”¨ç³»ç»Ÿçº§åˆ«çš„ã€å…±äº«çš„ OpenSSL é…ç½®ã€‚è¿™æ ·åšçš„åŸå› å¯èƒ½åŒ…æ‹¬ï¼š</p><ol><li>ç»Ÿä¸€ç®¡ç†ï¼šç³»ç»Ÿç®¡ç†å‘˜å¸Œæœ›èƒ½å¤Ÿç»Ÿä¸€ç®¡ç†æ‰€æœ‰åº”ç”¨ç¨‹åºçš„åŠ å¯†è®¾ç½®ã€‚</li><li>ç‰¹å®šéœ€æ±‚ï¼šæŸäº›åº”ç”¨å¯èƒ½éœ€è¦ç‰¹æ®Šçš„åŠ å¯†ç®—æ³•æˆ–ç­–ç•¥ï¼Œè¿™äº›å¯ä»¥åœ¨ç³»ç»Ÿçš„ OpenSSL é…ç½®ä¸­è®¾ç½®ï¼Œä½†ä¸åœ¨ Node.js å†…ç½®çš„é…ç½®ä¸­ã€‚</li><li>å…¼å®¹æ€§ï¼šåœ¨ä¸ç³»ç»Ÿä¸Šå…¶ä»–è½¯ä»¶é›†æˆæ—¶ï¼Œç¡®ä¿åŠ å¯†è¡Œä¸ºçš„ä¸€è‡´æ€§ã€‚</li></ol><p>å¦‚ä½•ä½¿ç”¨è¿™ä¸ªé€‰é¡¹çš„ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œå½“ä½ åœ¨å‘½ä»¤è¡Œä¸­å¯åŠ¨ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --openssl-shared-config</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¸Šé¢çš„å‘½ä»¤ä¸­ï¼Œ<code>your-app.js</code> æ˜¯ä½ çš„ Node.js åº”ç”¨ç¨‹åºçš„å…¥å£æ–‡ä»¶ã€‚åŠ ä¸Š <code>--openssl-shared-config</code> æ ‡å¿—åï¼ŒNode.js å°±ä¼šå¯»æ‰¾å¹¶ä½¿ç”¨ç³»ç»Ÿçš„ OpenSSL é…ç½®æ–‡ä»¶ã€‚</p><p>è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªé€‰é¡¹å¯¹äºå¤§å¤šæ•°å¼€å‘è€…å’Œåº”ç”¨æ¥è¯´å¯èƒ½å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œè€Œä¸”å®ƒçš„ä½¿ç”¨ä¹Ÿå–å†³äºå…·ä½“çš„ç³»ç»Ÿç¯å¢ƒå’Œé…ç½®ã€‚å¦‚æœä½ ä¸éœ€è¦ç‰¹å®šçš„ OpenSSL é…ç½®ï¼Œæˆ–è€…ä½ ä¸æ˜¯å¾ˆç†Ÿæ‚‰ OpenSSL å’Œç³»ç»Ÿçš„åŠ å¯†ç­–ç•¥ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¸éœ€è¦ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚</p><h3 id="pending-deprecation" tabindex="-1"><a class="header-anchor" href="#pending-deprecation"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--pending-deprecation" target="_blank" rel="noopener noreferrer">--pending-deprecation</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚å®ƒä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç ã€‚åœ¨ Node.js çš„ä¸åŒç‰ˆæœ¬ä¸­ï¼Œä¼šæœ‰å¾ˆå¤šåŠŸèƒ½æ›´æ–°å’Œå˜åŒ–ã€‚</p><p><code>--pending-deprecation</code> æ˜¯ Node.js å‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰ä¸­çš„ä¸€ä¸ªå‚æ•°é€‰é¡¹ã€‚å½“ä½ ä½¿ç”¨è¿™ä¸ªå‚æ•°è¿è¡Œ Node.js åº”ç”¨æ—¶ï¼Œå®ƒä¼šè®©ä¸€äº›å³å°†è¢«åºŸå¼ƒä½†è¿˜æ²¡æœ‰æ­£å¼è¢«æ ‡è®°ä¸ºåºŸå¼ƒçš„ API å‘å‡ºè­¦å‘Šä¿¡æ¯ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒä¼šè®©ä½ æå‰çŸ¥é“æŸäº›åŠŸèƒ½åœ¨æœªæ¥ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤æˆ–æ›´æ”¹ï¼Œå³ä½¿åœ¨å½“å‰ç‰ˆæœ¬ä¸­è¿™äº›åŠŸèƒ½è¿˜æœªè¢«å®˜æ–¹æ ‡è®°ä¸ºâ€œå·²åºŸå¼ƒâ€ã€‚è¿™å¯¹äºå¼€å‘è€…åœ¨ç»´æŠ¤å’Œæ›´æ–°ä»£ç æ—¶éå¸¸æœ‰å¸®åŠ©ï¼Œå¯ä»¥ææ—©åšå¥½å‡†å¤‡ï¼Œé¿å…æœªæ¥çš„ä»£ç å…¼å®¹æ€§é—®é¢˜ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œå‡è®¾ Node.js æ ¸å¿ƒå›¢é˜Ÿè®¡åˆ’åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­åºŸå¼ƒ <code>fs.readFileSync()</code> æ–¹æ³•ï¼ˆä»…ä½œç¤ºä¾‹ï¼Œå®é™…ä¸Šè¿™ä¸ªæ–¹æ³•ç°åœ¨æ²¡è¢«åºŸå¼ƒï¼‰ã€‚å¦‚æœä½ åœ¨ä»£ç ä¸­å¹¿æ³›ä½¿ç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼Œè€Œä¸”ä½ å¹¶ä¸çŸ¥é“å®ƒå³å°†è¢«åºŸå¼ƒï¼Œé‚£ä¹ˆåœ¨ Node.js æ›´æ–°åï¼Œä½ çš„åº”ç”¨å¯èƒ½å°±ä¼šå› ä¸ºè¿™ä¸ªå˜åŒ–è€Œå‡ºç°é—®é¢˜ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœä½ åœ¨è¿è¡Œä½ çš„åº”ç”¨æ—¶åŠ ä¸Šäº† <code>--pending-deprecation</code> è¿™ä¸ªå‚æ•°ï¼ŒNode.js å°±ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºè­¦å‘Šä¿¡æ¯ï¼Œæç¤ºä½  <code>fs.readFileSync()</code> æ–¹æ³•å°†åœ¨æœªæ¥è¢«åºŸå¼ƒã€‚è­¦å‘Šä¿¡æ¯å¯èƒ½ç±»ä¼¼äºè¿™æ ·ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>(node:12345) [DEP00XX] DeprecationWarning: fs.readFileSync() is deprecated and will be removed in a future version.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šå…¶ä¸­ <code>[DEP00XX]</code> æ˜¯ä¸€ä¸ªå‡æƒ³çš„åºŸå¼ƒä»£ç ï¼Œå®é™…è¿è¡Œæ—¶ä¼šè¢«æ›¿æ¢ä¸ºçœŸå®çš„åºŸå¼ƒé€šå‘Šä»£å·ã€‚</p><p>é€šè¿‡è¿™äº›è­¦å‘Šï¼Œä½ å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„ä»£ç ï¼Œæ‰¾åˆ°æ‰€æœ‰ä½¿ç”¨è¯¥æ–¹æ³•çš„åœ°æ–¹ï¼Œå¹¶å¼€å§‹å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆæˆ–æ›´æ–°ä½ çš„ä»£ç ï¼Œä»¥ç¡®ä¿å½“ Node.js æ›´æ–°åï¼Œä½ çš„åº”ç”¨ä¾ç„¶èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚</p><p>å¦‚ä½•ä½¿ç”¨ <code>--pending-deprecation</code> å‚æ•°ï¼š</p><ol><li>æ‰“å¼€å‘½ä»¤è¡Œå·¥å…·ï¼ˆä¾‹å¦‚ï¼šCMDã€Terminal ç­‰ï¼‰ã€‚</li><li>è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥è¿è¡Œä½ çš„ Node.js åº”ç”¨ï¼š</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --pending-deprecation</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="3"><li>å¦‚æœä½ çš„åº”ç”¨ä¸­ä½¿ç”¨äº†å³å°†åºŸå¼ƒçš„ APIï¼Œä½ å°±ä¼šçœ‹åˆ°ç›¸åº”çš„è­¦å‘Šä¿¡æ¯ã€‚</li></ol><p>æ€»ç»“èµ·æ¥ï¼Œ<code>--pending-deprecation</code> æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å‚æ•°é€‰é¡¹ï¼Œå®ƒå¸®åŠ©å¼€å‘è€…æå‰æ„è¯†åˆ°å³å°†å‘ç”Ÿçš„å˜åŒ–ï¼Œä»è€Œæå‰é‡‡å–è¡ŒåŠ¨ï¼Œä¿è¯ä»£ç çš„é¡ºåˆ©è¿ç§»å’Œé•¿æœŸç»´æŠ¤ã€‚</p><h3 id="policy-integrity-sri" tabindex="-1"><a class="header-anchor" href="#policy-integrity-sri"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--policy-integritysri" target="_blank" rel="noopener noreferrer">--policy-integrity=sri</a></span></a></h3><p>å½“ä½ ä¸‹è½½æˆ–ä½¿ç”¨äº’è”ç½‘ä¸Šçš„æ–‡ä»¶æ—¶ï¼Œä½ å¯èƒ½æƒ³ç¡®å®šè¿™äº›æ–‡ä»¶æ²¡æœ‰è¢«ç¯¡æ”¹ï¼Œå®ƒä»¬æ˜¯åŸå§‹ä½œè€…å‘å¸ƒçš„é‚£ä¸ªç‰ˆæœ¬ã€‚ä¸ºæ­¤ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ç§å«åšâ€œå­èµ„æºå®Œæ•´æ€§â€ï¼ˆSubresource Integrity, SRIï¼‰çš„æŠ€æœ¯ï¼Œé€šè¿‡å®ƒå¯ä»¥éªŒè¯æ–‡ä»¶çš„å®Œæ•´æ€§ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>--policy-integrity=sri</code>é€‰é¡¹æ­£æ˜¯ç”¨æ¥è®¾ç½® SRI ç­–ç•¥çš„ã€‚è¿™ä¸ªé€‰é¡¹å…è®¸ä½ ä¸ºå¯¼å…¥çš„æ¨¡å—æˆ–åŒ…æŒ‡å®šä¸€ä¸ªåŠ å¯†æ•£åˆ—å€¼ã€‚å¦‚æœå®é™…åŠ è½½çš„ä»£ç çš„æ•£åˆ—å€¼ä¸ä½ æä¾›çš„ä¸åŒ¹é…ï¼ŒNode.js ä¼šæ‹’ç»æ‰§è¡Œè¿™æ®µä»£ç ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢æ¶æ„ä»£ç è¢«æ‰§è¡Œã€‚</p><p>SRI é€šå¸¸æ˜¯ä¸€ä¸ª Base64 ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œå¯¹åº”äºæ–‡ä»¶å†…å®¹ç»è¿‡ç‰¹å®šå“ˆå¸Œç®—æ³•ï¼ˆå¦‚ SHA-256ï¼ŒSHA-384 ç­‰ï¼‰å¤„ç†åå¾—åˆ°çš„å€¼ã€‚</p><p>ä»¥ä¸‹æ˜¯å¦‚ä½•åœ¨å®é™…ä¸­ä½¿ç”¨<code>--policy-integrity=sri</code>é€‰é¡¹çš„ä¸€äº›ä¾‹å­ï¼š</p><ol><li><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œä¾‹å¦‚ lodashï¼Œä½ é€šè¿‡ npm ä¸‹è½½å¹¶ä¸”æƒ³ç¡®ä¿åœ¨ä½ çš„åº”ç”¨ä¸­ä½¿ç”¨çš„æ˜¯æ­£ç¡®ã€æœªè¢«ç¯¡æ”¹è¿‡çš„ç‰ˆæœ¬ã€‚é¦–å…ˆï¼Œä½ éœ€è¦è®¡ç®— lodash æ–‡ä»¶çš„ SRI å“ˆå¸Œã€‚</p></li><li><p>ä½¿ç”¨ä¸€ä¸ªå·¥å…·æˆ–å‘½ä»¤è¡Œç”Ÿæˆåº“æ–‡ä»¶çš„ SRI å“ˆå¸Œå€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ lodash çš„æ–‡ä»¶åæ˜¯<code>lodash.min.js</code>ï¼Œä½ å¯ä»¥ä½¿ç”¨ linux å‘½ä»¤è¡Œå·¥å…·<code>shasum</code>ç”Ÿæˆå…¶å“ˆå¸Œå€¼ï¼š</p></li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">shasum</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -b</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 256</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> lodash.min.js</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> xxd</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> base64</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="3"><li><p>è¿™æ¡å‘½ä»¤ä¼šè¾“å‡ºä¸€ä¸ª Base64 ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œè¿™å°±æ˜¯è¿™ä¸ª lodash ç‰ˆæœ¬çš„ SRI å“ˆå¸Œå€¼ã€‚</p></li><li><p>æ¥ä¸‹æ¥ï¼Œåœ¨å¯åŠ¨ Node.js åº”ç”¨æ—¶ï¼Œä½¿ç”¨<code>--policy-integrity</code>é€‰é¡¹ï¼Œå¹¶å°†åˆšæ‰ç”Ÿæˆçš„å“ˆå¸Œå€¼ä½œä¸ºå‚æ•°ä¼ é€’ã€‚</p></li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --policy-integrity=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sha256-ä½ çš„å“ˆå¸Œå€¼&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="5"><li><p>å¦‚æœæœ‰äººå°è¯•ç¯¡æ”¹äº†<code>lodash.min.js</code>æ–‡ä»¶ï¼Œå…¶å“ˆå¸Œå€¼ä¼šå˜åŒ–ï¼ŒNode.js ä¼šæ‹’ç»åŠ è½½è¿™ä¸ªæ–‡ä»¶ï¼Œå› ä¸ºæä¾›çš„ SRI å“ˆå¸Œå€¼å’Œæ–‡ä»¶å®é™…çš„å“ˆå¸Œå€¼ä¸åŒ¹é…ã€‚</p></li><li><p>å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ„å‘³ç€æ–‡ä»¶æ˜¯å®Œæ•´æ— æŸçš„ï¼ŒNode.js ä¼šåƒå¾€å¸¸ä¸€æ ·åŠ è½½å¹¶è¿è¡Œä½ çš„ä»£ç ã€‚</p></li></ol><p>ä½¿ç”¨ SRI æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å®‰å…¨å®è·µï¼Œå°¤å…¶æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå®ƒå¯ä»¥å¢åŠ ä½ åº”ç”¨çš„å®‰å…¨æ€§ï¼Œå‡å°‘ç”±äºç¬¬ä¸‰æ–¹åº“è¢«ç¯¡æ”¹è€Œå¯èƒ½å¸¦æ¥çš„é£é™©ã€‚</p><h3 id="preserve-symlinks" tabindex="-1"><a class="header-anchor" href="#preserve-symlinks"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--preserve-symlinks" target="_blank" rel="noopener noreferrer">--preserve-symlinks</a></span></a></h3><p>Node.js ä¸­çš„<code>--preserve-symlinks</code>æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨äºæ”¹å˜ Node.js å¦‚ä½•å¤„ç†ç¬¦å·é“¾æ¥ï¼ˆsymlinksï¼‰ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ Node.js é‡åˆ°æ¨¡å—å¼•ç”¨æˆ–è€…æ–‡ä»¶å¼•ç”¨æ—¶ï¼Œå¦‚æœè¿™ä¸ªå¼•ç”¨æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼ŒNode.js ä¼šè§£æè¿™ä¸ªé“¾æ¥ï¼Œæ‰¾åˆ°é“¾æ¥æ‰€æŒ‡å‘çš„çœŸå®è·¯å¾„ã€‚ä½¿ç”¨<code>--preserve-symlinks</code>é€‰é¡¹å¯ä»¥å‘Šè¯‰ Node.js ä¸è¦è§£æç¬¦å·é“¾æ¥ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨è¿™ä¸ªç¬¦å·é“¾æ¥ã€‚</p><p>ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ˜ç™½ä»€ä¹ˆæ˜¯ç¬¦å·é“¾æ¥ã€‚åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œç¬¦å·é“¾æ¥æ˜¯ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†å¯¹å¦ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•çš„å¼•ç”¨ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªå¿«æ·æ–¹å¼ï¼Œç‚¹å‡»è¿™ä¸ªå¿«æ·æ–¹å¼å°±å¯ä»¥è®¿é—®åˆ°å®ƒæŒ‡å‘çš„åŸå§‹æ–‡ä»¶æˆ–ç›®å½•ã€‚</p><p>åœ¨ Node.js çš„åº”ç”¨ä¸­ï¼Œ<code>--preserve-symlinks</code>é€‰é¡¹é€šå¸¸ä¸æ¨¡å—åŠ è½½æœ‰å…³ã€‚æ¨¡å—æ˜¯ Node.js ä¸­å¯ä»¥é‡å¤ä½¿ç”¨çš„ä»£ç ç‰‡æ®µæˆ–åº“ï¼Œå®ƒä»¬å¯ä»¥è¢«å®‰è£…åœ¨é¡¹ç›®çš„<code>node_modules</code>ç›®å½•ä¸‹ã€‚å¦‚æœä½ ä½¿ç”¨äº† npm æˆ–è€…å…¶ä»–åŒ…ç®¡ç†å™¨æ¥å®‰è£…ä¾èµ–ï¼Œæœ‰æ—¶å€™è¿™äº›ä¾èµ–ä¼šé€šè¿‡ç¬¦å·é“¾æ¥çš„å½¢å¼å‡ºç°åœ¨<code>node_modules</code>ç›®å½•ä¸­ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹å‡ ä¸ªå…·ä½“çš„ä¾‹å­ï¼š</p><p><strong>ä¾‹å­ 1ï¼šæœ¬åœ°æ¨¡å—å¼€å‘</strong><br> å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸¤ä¸ªé¡¹ç›®ï¼Œ<code>project-a</code>å’Œ<code>project-b</code>ã€‚<code>project-a</code>ä¾èµ–äº<code>project-b</code>ï¼Œè€Œ<code>project-b</code>è¿˜åœ¨å¼€å‘é˜¶æ®µï¼Œä½ å¸Œæœ›åœ¨<code>project-a</code>ä¸­ä½¿ç”¨æœ¬åœ°çš„<code>project-b</code>ç‰ˆæœ¬è¿›è¡Œæµ‹è¯•ã€‚ä½ å¯ä»¥åœ¨<code>project-a</code>çš„<code>node_modules</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæŒ‡å‘æœ¬åœ°<code>project-b</code>ç›®å½•çš„ç¬¦å·é“¾æ¥ã€‚å¦‚æœä¸ä½¿ç”¨<code>--preserve-symlinks</code>ï¼Œå½“ä½ åœ¨<code>project-a</code>ä¸­<code>require(&#39;project-b&#39;)</code>æ—¶ï¼ŒNode.js å°†ä¼šæŸ¥æ‰¾å¹¶åŠ è½½<code>project-b</code>çš„çœŸå®è·¯å¾„ï¼Œå¯èƒ½å¯¼è‡´è·¯å¾„é—®é¢˜ã€‚å¦‚æœä½¿ç”¨<code>--preserve-symlinks</code>ï¼ŒNode.js ä¼šä¿æŒå¯¹<code>project-b</code>çš„ç¬¦å·é“¾æ¥ï¼Œä½¿å¾—å¼€å‘æµ‹è¯•æ›´åŠ æ–¹ä¾¿ã€‚</p><p><strong>ä¾‹å­ 2ï¼šå…¨å±€æ¨¡å—é“¾æ¥</strong><br> å‡è®¾ä½ å®‰è£…äº†ä¸€ä¸ªå…¨å±€æ¨¡å—ï¼Œæ¯”å¦‚<code>mymodule</code>ï¼Œå¹¶ä¸”ä½ æƒ³åœ¨ä½ çš„é¡¹ç›®ä¸­å»å¼•ç”¨å®ƒï¼Œä½†ä¸æƒ³æ¯ä¸ªé¡¹ç›®éƒ½å•ç‹¬å®‰è£…ä¸€æ¬¡ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æ¥ä»ä½ çš„é¡¹ç›®çš„<code>node_modules</code>æŒ‡å‘å…¨å±€å®‰è£…çš„<code>mymodule</code>ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸ä½¿ç”¨<code>--preserve-symlinks</code>ï¼ŒNode.js åŠ è½½æ¨¡å—æ—¶ä¼šå¯»æ‰¾å…¨å±€æ¨¡å—çš„çœŸå®ä½ç½®ï¼Œè¿™æ ·å¯èƒ½å¯¼è‡´ç¯å¢ƒå·®å¼‚å’Œä¸å¯é¢„è§çš„é”™è¯¯ã€‚ä½¿ç”¨<code>--preserve-symlinks</code>å¯ä»¥è®© Node.js æ­£ç¡®åœ°å¤„ç†è¿™ç§æƒ…å†µã€‚</p><p><strong>ä¾‹å­ 3ï¼šæ–‡ä»¶ç³»ç»Ÿå±‚çº§</strong><br> åœ¨æŸäº›å¤æ‚çš„éƒ¨ç½²ç¯å¢ƒä¸­ï¼Œå¯èƒ½åˆ©ç”¨ç¬¦å·é“¾æ¥åˆ›å»ºäº†å¤šå±‚æ–‡ä»¶ç³»ç»Ÿç»“æ„æ¥ç»„ç»‡èµ„æºå’Œå…±äº«é€šç”¨æ¨¡å—ã€‚å¦‚æœ Node.js ä¸ä¿ç•™è¿™äº›ç¬¦å·é“¾æ¥ï¼Œé‚£ä¹ˆæ¨¡å—å°†æ— æ³•æŒ‰é¢„æœŸè¢«å‘ç°å’ŒåŠ è½½ï¼Œå› ä¸ºå®ƒä¼šç›´æ¥è·³è½¬åˆ°æœ€ç»ˆçš„ç‰©ç†ä½ç½®ã€‚ä½¿ç”¨<code>--preserve-symlinks</code>åˆ™å¯ä»¥ç¡®ä¿å³ä½¿åœ¨è¿™æ ·çš„å±‚çº§ç»“æ„ä¸­ï¼Œæ¨¡å—ä¹Ÿèƒ½è¢«æ­£ç¡®åœ°åŠ è½½ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>--preserve-symlinks</code>é€‰é¡¹å…è®¸å¼€å‘è€…æ›´ç²¾ç¡®åœ°æ§åˆ¶æ¨¡å—å¦‚ä½•è¢«åŠ è½½ï¼Œå°¤å…¶åœ¨æ¶‰åŠç¬¦å·é“¾æ¥æ—¶ã€‚è¿™åœ¨ç‰¹å®šçš„å¼€å‘å’Œéƒ¨ç½²åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ï¼Œä½†åŒæ—¶ä¹Ÿéœ€è¦å¼€å‘è€…ç†è§£å¦‚ä½•åˆç†åœ°ä½¿ç”¨è¿™ä¸€é€‰é¡¹ä»¥é¿å…æ½œåœ¨çš„é—®é¢˜ã€‚</p><h3 id="preserve-symlinks-main" tabindex="-1"><a class="header-anchor" href="#preserve-symlinks-main"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--preserve-symlinks-main" target="_blank" rel="noopener noreferrer">--preserve-symlinks-main</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œç¬¦å·é“¾æ¥ï¼ˆsymlinksï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„æ–‡ä»¶ï¼Œå®ƒåŒ…å«å¯¹å…¶ä»–æ–‡ä»¶æˆ–ç›®å½•çš„å¼•ç”¨è·¯å¾„ã€‚åœ¨æ“ä½œç³»ç»Ÿå±‚é¢ï¼Œå½“ä½ å°è¯•è®¿é—®ä¸€ä¸ªç¬¦å·é“¾æ¥æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨é‡å®šå‘åˆ°å®ƒæŒ‡å‘çš„é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ Node.js åŠ è½½ä¸»æ¨¡å—ï¼ˆå³å¯åŠ¨ç¨‹åºçš„é‚£ä¸ªæ–‡ä»¶ï¼‰æ—¶ï¼Œå¦‚æœè¿™ä¸ªæ–‡ä»¶æ˜¯é€šè¿‡ç¬¦å·é“¾æ¥æ¥è®¿é—®çš„ï¼ŒNode.js ä¼šè§£æè¿™ä¸ªç¬¦å·é“¾æ¥ï¼Œç„¶åä½¿ç”¨å®é™…æ–‡ä»¶çš„è·¯å¾„æ¥åŠ è½½å’Œæ‰§è¡Œä»£ç ã€‚è¿™æ„å‘³ç€ï¼Œæ— è®ºä½ çš„ä»£ç è®¤ä¸ºè‡ªå·±ä½äºä»€ä¹ˆä½ç½®ï¼Œåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„çœŸå®ä½ç½®éƒ½æ˜¯è¢«æ‰§è¡Œçš„ä»£ç ã€‚</p><p><code>--preserve-symlinks-main</code>é€‰é¡¹å‘Šè¯‰ Node.js åœ¨åŠ è½½ä¸»æ¨¡å—æ—¶åº”è¯¥ä¿ç•™ç¬¦å·é“¾æ¥çš„è·¯å¾„ï¼Œè€Œä¸æ˜¯è§£æå®ƒä»¬ã€‚è¿™å¯ä»¥å½±å“æ¨¡å—è§£æã€æ–‡ä»¶è·¯å¾„å¤„ç†å’Œæ¨¡å—ç¼“å­˜ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šè¿™ä¸ªé€‰é¡¹ï¼š</p><p>å‡è®¾ä½ æœ‰ä»¥ä¸‹çš„ç›®å½•ç»“æ„ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>/project</span></span>
<span class="line"><span>  /real_location</span></span>
<span class="line"><span>    - main.js</span></span>
<span class="line"><span>  /symlink</span></span>
<span class="line"><span>    - main.js -&gt; /project/real_location/main.js (è¿™æ˜¯ä¸€ä¸ªæŒ‡å‘real_location/main.jsçš„ç¬¦å·é“¾æ¥)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œå¦‚æœä½ åœ¨<code>/project/symlink</code>ç›®å½•ä¸‹è¿è¡Œ<code>node main.js</code>ï¼Œé»˜è®¤æƒ…å†µä¸‹ Node.js ä¼šè§£æè¿™ä¸ªç¬¦å·é“¾æ¥å¹¶å®é™…ä»<code>/project/real_location/main.js</code>åŠ è½½å’Œæ‰§è¡Œä»£ç ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœä½ è¿è¡Œ<code>node --preserve-symlinks-main main.js</code>ï¼ŒNode.js å°†ä¼šä½¿ç”¨<code>/project/symlink/main.js</code>è¿™ä¸ªè·¯å¾„æ¥åŠ è½½æ‰§è¡Œã€‚è¿™æ ·åšçš„ç»“æœå¯èƒ½å¯¼è‡´æ¨¡å—è§£æçš„ä¸åŒï¼Œå› ä¸º Node.js åœ¨è§£ææ¨¡å—æ—¶ä¼šè€ƒè™‘è°ƒç”¨è€…çš„ä½ç½®ã€‚</p><p>ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼š</p><p>åœ¨<code>main.js</code>ä¸­ï¼Œä½ å¯èƒ½æœ‰å¦‚ä¸‹ä»£ç å»åŠ è½½ä¸€ä¸ªæ¨¡å—ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> someModule</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./some-module&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœ<code>main.js</code>æ˜¯é€šè¿‡ç¬¦å·é“¾æ¥æ¥è®¿é—®çš„ï¼Œå¹¶ä¸”æ²¡æœ‰ä½¿ç”¨<code>--preserve-symlinks-main</code>é€‰é¡¹ï¼ŒNode.js å°†ä¼šåœ¨<code>/project/real_location</code>ç›®å½•ä¸‹å¯»æ‰¾è¿™ä¸ªæ¨¡å—ã€‚</p><p>ä½†å¦‚æœä½¿ç”¨äº†<code>--preserve-symlinks-main</code>é€‰é¡¹ï¼ŒNode.js åˆ™ä¼šåœ¨<code>/project/symlink</code>ç›®å½•ä¸‹å¯»æ‰¾æ¨¡å—ã€‚å¦‚æœ<code>some-module</code>å°±åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œä½†ä¸åœ¨<code>/project/real_location</code>ç›®å½•ä¸‹ï¼Œå®ƒåœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯æ‰¾ä¸åˆ°çš„ï¼Œä½†åœ¨ä½¿ç”¨äº†<code>--preserve-symlinks-main</code>é€‰é¡¹æ—¶å¯ä»¥è¢«æ­£ç¡®åœ°åŠ è½½ã€‚</p><p>è¿™ä¸ªé€‰é¡¹åœ¨ç®¡ç†å¤æ‚çš„é¡¹ç›®ç»“æ„æ—¶å¾ˆæœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯å½“ä½ éœ€è¦ä¿æŒæ–‡ä»¶å¼•ç”¨çš„ä¸€è‡´æ€§ï¼Œæˆ–è€…åœ¨ä½¿ç”¨åŒ…å«ç¬¦å·é“¾æ¥çš„æ–‡ä»¶ç³»ç»Ÿå·¥ä½œæ—¶ã€‚</p><h3 id="p-print-script" tabindex="-1"><a class="header-anchor" href="#p-print-script"><span><a href="https://nodejs.org/docs/latest/api/cli.html#-p---print-script" target="_blank" rel="noopener noreferrer">-p, --print &quot;script&quot;</a></span></a></h3><p>Node.js çš„<code>-p</code>æˆ–<code>--print</code>æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒè®©ä½ å¯ä»¥ç›´æ¥åœ¨ç»ˆç«¯ï¼ˆå‘½ä»¤æç¤ºç¬¦ã€æ§åˆ¶å°ï¼‰ä¸­æ‰§è¡Œä¸€æ®µ JavaScript ä»£ç ï¼Œå¹¶å°†ç»“æœè¾“å‡ºæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚</p><p>å½“ä½ åœ¨ä½¿ç”¨ Node.js æ—¶ï¼Œåœ¨å‘½ä»¤è¡Œä¸­åŠ ä¸Š<code>-p</code>æˆ–<code>--print</code>åé¢è·Ÿç€ä¸€æ®µ JavaScript ä»£ç ï¼ŒNode.js ä¼šç«‹å³æ‰§è¡Œè¿™æ®µä»£ç å¹¶æŠŠè®¡ç®—çš„ç»“æœæ‰“å°å‡ºæ¥ã€‚</p><p><strong>å®é™…åº”ç”¨ä¾‹å­:</strong></p><ol><li><p><strong>åŸºæœ¬ä½¿ç”¨ï¼š</strong><br> å‡è®¾ä½ åªæ˜¯æƒ³å¿«é€Ÿæ£€æŸ¥å½“å‰æ—¥æœŸï¼Œä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;new Date()&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ‰§è¡Œå®Œæ¯•åï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>2023-04-08T12:34:56.789Z</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™å°±æ˜¯å½“å‰çš„æ—¥æœŸå’Œæ—¶é—´ã€‚</p></li><li><p><strong>æ•°å­¦è®¡ç®—ï¼š</strong><br> å¦‚æœä½ æƒ³è¦å¿«é€Ÿåœ°åšä¸ªæ•°å­¦è¿ç®—ï¼Œæ¯”å¦‚åŠ æ³•ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;1 + 1&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç»“æœä¼šç›´æ¥æ˜¾ç¤ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>æ£€æŸ¥ Node.js ç‰ˆæœ¬ï¼š</strong><br> ä½ å¯ä»¥ä½¿ç”¨<code>process.version</code>å±æ€§æ¥æ‰“å°å‡ºä½ æ­£åœ¨ä½¿ç”¨çš„ Node.js ç‰ˆæœ¬ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;process.version&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¾“å‡ºçš„ç»“æœå¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>v21.7.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>æ£€æŸ¥ç¯å¢ƒå˜é‡ï¼š</strong><br> æœ‰æ—¶å€™ï¼Œä½ å¯èƒ½éœ€è¦æŸ¥çœ‹è®¾ç½®åœ¨ç³»ç»Ÿä¸­çš„ç¯å¢ƒå˜é‡ã€‚ä¾‹å¦‚ï¼Œæƒ³æŸ¥çœ‹<code>HOME</code>ç¯å¢ƒå˜é‡å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;process.env.HOME&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸Šï¼Œå®ƒä¼šè¾“å‡ºå½“å‰ç”¨æˆ·çš„å®¶ç›®å½•è·¯å¾„ã€‚</p></li><li><p><strong>JSON å¤„ç†ï¼š</strong><br> å‡è®¾ä½ æœ‰ä¸ª JSON å­—ç¬¦ä¸²ï¼Œæƒ³å¿«é€Ÿæ ¼å¼åŒ–æˆ–è€…æå–å…¶ä¸­çš„ä¿¡æ¯ï¼Œä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¿™æ ·æ“ä½œï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&#39;{</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">name</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">Alice</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">age</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:30}&#39;.replace(/Alice/g, &#39;Bob&#39;)&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœä¼šæ˜¯è¿™æ ·çš„ä¸€ä¸ªæ–°çš„ JSON å­—ç¬¦ä¸²ï¼Œå°†åå­— Alice æ›¿æ¢ä¸º Bobï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>{&quot;name&quot;:&quot;Bob&quot;,&quot;age&quot;:30}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹å‡º<code>-p</code>æˆ–<code>--print</code>åœ¨æ—¥å¸¸å·¥ä½œä¸­å¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿæ‰§è¡Œä¸€äº›ç®€å•çš„ä»»åŠ¡ï¼Œè€Œæ— éœ€ç¼–å†™å®Œæ•´çš„è„šæœ¬æ–‡ä»¶ã€‚å¯¹äºç¼–ç¨‹æ–°æ‰‹æ¥è¯´ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„å·¥å…·æ¥å°è¯•å’Œå­¦ä¹  JavaScript ä»£ç ç‰‡æ®µã€‚</p><h3 id="prof" tabindex="-1"><a class="header-anchor" href="#prof"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--prof" target="_blank" rel="noopener noreferrer">--prof</a></span></a></h3><p>Node.js çš„ <code>--prof</code> é€‰é¡¹æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼Œç”¨äºå¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶æ¿€æ´» V8 JavaScript å¼•æ“çš„æ€§èƒ½åˆ†æå™¨ï¼ˆProfilerï¼‰ã€‚è¿™ä¸ªåˆ†æå™¨å¯ä»¥è·Ÿè¸ªå’Œè®°å½•ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚å‡½æ•°è°ƒç”¨çš„æ¬¡æ•°ã€è°ƒç”¨çš„æŒç»­æ—¶é—´ç­‰ã€‚è¿™äº›ä¿¡æ¯é€šå¸¸ç”¨äºåˆ†æå’Œä¼˜åŒ–åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-prof" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-prof"><span>å¦‚ä½•ä½¿ç”¨ <code>--prof</code>?</span></a></h3><p>è¦ä½¿ç”¨ <code>--prof</code> å‚æ•°ï¼Œä½ éœ€è¦åœ¨å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶ä»å‘½ä»¤è¡ŒåŠ ä¸Šå®ƒã€‚ä¾‹å¦‚ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --prof</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™é‡Œçš„ <code>app.js</code> æ˜¯ä½ çš„ Node.js åº”ç”¨ç¨‹åºçš„å…¥å£æ–‡ä»¶ã€‚</p><p>å½“ä½ çš„ç¨‹åºè¿è¡Œå®Œæ¯•åï¼ŒV8 å¼•æ“ä¼šç”Ÿæˆä¸€ä¸ªåä¸º <code>v8.log</code> çš„æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­åŒ…å«äº†æ€§èƒ½åˆ†æçš„æ•°æ®ã€‚å®ƒä¸æ˜¯ç›´æ¥å¯è¯»çš„ï¼Œå¹¶ä¸”éœ€è¦é€šè¿‡ä¸“é—¨çš„å·¥å…·æ¥å¤„ç†ã€‚</p><h3 id="æ€æ ·é˜…è¯»-v8-log-æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#æ€æ ·é˜…è¯»-v8-log-æ–‡ä»¶"><span>æ€æ ·é˜…è¯» <code>v8.log</code> æ–‡ä»¶ï¼Ÿ</span></a></h3><p>ä¸ºäº†é˜…è¯»è¿™ä¸ªæ–‡ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ Node.js çš„å†…ç½®æ¨¡å— <code>--prof-process</code> å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚åƒè¿™æ ·ä½¿ç”¨ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --prof-process</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> v8.log</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> processed.txt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤ä¼šå¤„ç† <code>v8.log</code> æ–‡ä»¶ï¼Œå¹¶å°†æ˜“äºé˜…è¯»çš„ç‰ˆæœ¬è¾“å‡ºåˆ° <code>processed.txt</code> æ–‡ä»¶ä¸­ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-5"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªç®€å•çš„ Node.js ç¨‹åºï¼Œå®ƒåŒ…å«ä¸€äº›å¤æ‚çš„è®¡ç®—æˆ–è€…æ“ä½œæ•°æ®åº“çš„ä»£ç ï¼Œä½ å‘ç°ç¨‹åºè¿è¡Œèµ·æ¥æ¯”é¢„æœŸçš„æ…¢ã€‚ä¸ºäº†æ‰¾å‡ºé€ æˆå»¶è¿Ÿçš„åŸå› ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>--prof</code> æ¥å¯åŠ¨ä½ çš„ç¨‹åºï¼Œå¹¶åˆ†ææ€§èƒ½ç“¶é¢ˆã€‚</p><ol><li><p><strong>å¯åŠ¨å¸¦æ€§èƒ½åˆ†æçš„åº”ç”¨ç¨‹åº</strong>:</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --prof</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·åº”ç”¨ç¨‹åºå°±ä¼šæ­£å¸¸è¿è¡Œï¼ŒåŒæ—¶æ”¶é›†æ€§èƒ½æ•°æ®ã€‚</p></li><li><p><strong>åº”ç”¨ç¨‹åºè¿è¡Œå®Œæ¯•å</strong>:<br> å½“ç¨‹åºæ‰§è¡Œå®Œæ¯•ï¼Œä½ ä¼šåœ¨å½“å‰ç›®å½•ä¸‹æ‰¾åˆ°ä¸€ä¸ª <code>v8.log</code> æ–‡ä»¶ã€‚</p></li><li><p><strong>å¤„ç†æ€§èƒ½æ•°æ®æ–‡ä»¶</strong>:</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --prof-process</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> v8.log</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> processed.txt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤ä¼šåˆ†æ <code>v8.log</code> å¹¶åˆ›å»ºä¸€ä¸ªæ›´æ˜“é˜…è¯»çš„æ–‡ä»¶ <code>processed.txt</code>ã€‚</p></li><li><p><strong>åˆ†ææ€§èƒ½æŠ¥å‘Š</strong>:<br> æ‰“å¼€ <code>processed.txt</code>ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ç³»åˆ—çš„æ€§èƒ½æ•°æ®ï¼ŒåŒ…æ‹¬å„ä¸ªå‡½æ•°çš„è°ƒç”¨æ¬¡æ•°ã€æ€»æ‰§è¡Œæ—¶é—´ã€å¹³å‡æ‰§è¡Œæ—¶é—´ç­‰ã€‚é€šè¿‡è¿™äº›æ•°æ®ï¼Œä½ å¯ä»¥å¼€å§‹ç†è§£å“ªäº›éƒ¨åˆ†çš„ä»£ç å¯èƒ½å¯¼è‡´äº†æ€§èƒ½é—®é¢˜ã€‚</p></li><li><p><strong>ä¼˜åŒ–ä»£ç </strong>:<br> æ ¹æ® <code>processed.txt</code> ä¸­çš„ä¿¡æ¯ï¼Œä½ å¯ä»¥å¯¹ç¨‹åºä¸­çš„ä½æ•ˆä»£ç è¿›è¡Œé‡å†™æˆ–ä¼˜åŒ–ï¼Œç„¶åå†æ¬¡ä½¿ç”¨ <code>--prof</code> è¿è¡Œç¨‹åºï¼Œæ£€éªŒä¼˜åŒ–æ˜¯å¦æœ‰æ•ˆã€‚</p></li></ol><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>--prof</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå®ƒèƒ½å¸®åŠ©å¼€å‘è€…è¯Šæ–­å’Œä¼˜åŒ– Node.js åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚é€šè¿‡å¯¹ä»£ç çš„æ€§èƒ½ç“¶é¢ˆè¿›è¡Œåˆ†æï¼Œå¼€å‘è€…å¯ä»¥ä½œå‡ºç›¸åº”çš„ä¼˜åŒ–æ¥æé«˜åº”ç”¨ç¨‹åºçš„æ•ˆç‡ã€‚</p><h3 id="prof-process" tabindex="-1"><a class="header-anchor" href="#prof-process"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--prof-process" target="_blank" rel="noopener noreferrer">--prof-process</a></span></a></h3><p>å¥½çš„ï¼Œé‚£æˆ‘ä»¬å°±ç›´æ¥æ¥è°ˆè°ˆ Node.js ä¸­çš„ <code>--prof-process</code> è¿™ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªé‡è¦çš„è¯¾é¢˜ã€‚æƒ³è¦ä¼˜åŒ–ä½ çš„åº”ç”¨ï¼Œé¦–å…ˆéœ€è¦äº†è§£å®ƒåœ¨è¿è¡Œæ—¶çš„è¡¨ç°ã€‚è¿™å…¶ä¸­ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡ç”Ÿæˆå’Œåˆ†ææ€§èƒ½å‰–ææ–‡ä»¶ï¼ˆå³ï¼šprofilingï¼‰ï¼Œè€Œ <code>--prof-process</code> å°±æ˜¯ä¸æ­¤ç›¸å…³çš„å·¥å…·ã€‚</p><p>å½“ä½ è¿è¡Œä¸€ä¸ª Node.js åº”ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥å¯ç”¨ V8 å¼•æ“çš„æ€§èƒ½å‰–æåŠŸèƒ½ã€‚è¿™é€šå¸¸ä¼šç”Ÿæˆä¸€ä¸ªåç¼€ä¸º <code>.log</code> çš„å‰–ææ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«äº†å…³äºä½ çš„ Node.js ç¨‹åºè¿è¡ŒæœŸé—´çš„å„ç§ä¿¡æ¯ï¼Œæ¯”å¦‚å‡½æ•°è°ƒç”¨çš„æ¬¡æ•°ã€æ¶ˆè€—çš„æ—¶é—´ç­‰ã€‚ä½†è¿™ä¸ªæ–‡ä»¶æ˜¯åŸå§‹æ•°æ®ï¼Œæ ¼å¼å¯¹äººç±»æ¥è¯´ä¸å¤ªå‹å¥½ï¼Œå› æ­¤éœ€è¦è¿›ä¸€æ­¥å¤„ç†æ‰èƒ½é˜…è¯»ã€‚</p><p>è¿™å°±æ˜¯ <code>--prof-process</code> å‘æŒ¥ä½œç”¨çš„åœ°æ–¹äº†ã€‚ä½¿ç”¨è¿™ä¸ªé€‰é¡¹å¯ä»¥å°†åŸå§‹çš„æ€§èƒ½å‰–ææ–‡ä»¶è½¬æ¢æˆä¸€ç§æ›´åŠ å¯è¯»çš„æ ¼å¼ã€‚</p><p>ä¸¾ä¸ªå®é™…çš„ä¾‹å­ï¼š</p><ol><li><p>é¦–å…ˆï¼Œä½ éœ€è¦è¿è¡Œä½ çš„ Node.js åº”ç”¨å¹¶å¼€å¯æ€§èƒ½å‰–æã€‚è¿™å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®Œæˆï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --prof</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å‡è®¾ä½ çš„åº”ç”¨ç¨‹åºå«åš <code>your-app.js</code>ã€‚è¿™æ¡å‘½ä»¤ä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆä¸€ä¸ªåä¸º <code>isolate-0xnnnnnnnnnnnn-v8.log</code> çš„æ–‡ä»¶ï¼ˆå…¶ä¸­ <code>0xnnnnnnnnnnnn</code> æ˜¯åŠ¨æ€ç”Ÿæˆçš„åœ°å€ï¼‰ã€‚</p></li><li><p>æ¥ä¸‹æ¥ï¼Œä½ éœ€è¦å¤„ç†è¿™ä¸ªå‰–ææ–‡ä»¶ä»¥å¾—åˆ°æœ‰ç”¨çš„ä¿¡æ¯ã€‚è¿™æ—¶ä½ å¯ä»¥ä½¿ç”¨ <code>--prof-process</code> é€‰é¡¹ã€‚å‡è®¾ä½ çš„å‰–ææ–‡ä»¶åä¸º <code>isolate-0xnnnnnnnnnnnn-v8.log</code>ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥å¤„ç†å®ƒï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --prof-process</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> isolate-0xnnnnnnnnnnnn-v8.log</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> processed.txt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤ä¼šè¯»å–å‰–ææ—¥å¿—æ–‡ä»¶ï¼Œå¹¶è¾“å‡ºå¤„ç†è¿‡åçš„ä¿¡æ¯åˆ° <code>processed.txt</code> æ–‡ä»¶ä¸­ã€‚</p></li></ol><p>å¤„ç†åçš„æ–‡ä»¶ä¼šåŒ…å«è¯¸å¦‚ JavaScript å‡½æ•°æ‰§è¡Œæ—¶é—´ã€è¢«è°ƒç”¨æ¬¡æ•°ç­‰ä¿¡æ¯ï¼Œä»¥åŠå¯èƒ½å­˜åœ¨çš„æ€§èƒ½ç“¶é¢ˆæç¤ºã€‚</p><p>è¯·æ³¨æ„ï¼Œ<code>--prof-process</code> é€‰é¡¹åœ¨ä¸åŒç‰ˆæœ¬çš„ Node.js ä¸­å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œå› æ­¤æˆ‘æä¾›çš„ä¿¡æ¯æ˜¯åŸºäºä½ æåˆ°çš„ Node.js v21.7.1 ç‰ˆæœ¬ã€‚åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œå‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•å’Œè¾“å‡ºæ ¼å¼å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>--prof-process</code> æ˜¯ä¸€ä¸ªç”¨äºå¤„ç† Node.js æ€§èƒ½å‰–ææ–‡ä»¶çš„å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ å°†å¤æ‚çš„æ€§èƒ½æ•°æ®è½¬æ¢æˆæ›´å®¹æ˜“ç†è§£çš„æ ¼å¼ï¼Œä»è€Œè®©ä½ å¯¹ç¨‹åºçš„æ€§èƒ½æœ‰æ›´æ¸…æ™°çš„è®¤è¯†ï¼Œå¹¶ä¼˜åŒ–ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</p><h3 id="redirect-warnings-file" tabindex="-1"><a class="header-anchor" href="#redirect-warnings-file"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--redirect-warningsfile" target="_blank" rel="noopener noreferrer">--redirect-warnings=file</a></span></a></h3><p>å½“ä½ è¿è¡Œ Node.js ç¨‹åºæ—¶ï¼Œç»å¸¸ä¼šé‡åˆ°å„ç§è­¦å‘Šä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯é»˜è®¤æ˜¯è¾“å‡ºåˆ°æ§åˆ¶å°ï¼ˆé€šå¸¸å°±æ˜¯ä½ çš„ç»ˆç«¯æˆ–å‘½ä»¤è¡Œç•Œé¢ï¼‰çš„ã€‚è¿™äº›è­¦å‘Šå¯èƒ½æ¥è‡ªäº Node.js å†…æ ¸ï¼Œä¹Ÿå¯èƒ½æ˜¯ä½ ä½¿ç”¨çš„æŸä¸ªæ¨¡å—æˆ–è€…åº”ç”¨ç¨‹åºæœ¬èº«çš„ä»£ç ï¼Œä¾‹å¦‚ï¼šä½¿ç”¨äº†å·²ç»åºŸå¼ƒï¼ˆdeprecatedï¼‰çš„ APIã€‚</p><p>åœ¨å¼€å‘é˜¶æ®µï¼Œå°†è­¦å‘Šç›´æ¥æ‰“å°åˆ°æ§åˆ¶å°æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ï¼Œå› ä¸ºå®ƒå¯ä»¥è®©ä½ å³æ—¶çœ‹åˆ°é—®é¢˜å¹¶ä¸”åŠæ—¶å¤„ç†ã€‚ç„¶è€Œï¼Œåœ¨ä¸€ä¸ªç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ–è€…å½“ä½ æƒ³è¦è®©ç¨‹åºçš„è¾“å‡ºæ›´åŠ æ¸…æ™°æ—¶ï¼Œä½ å¯èƒ½å¸Œæœ›ä¸è¦åœ¨æ§åˆ¶å°ä¸­æ˜¾ç¤ºè¿™äº›è­¦å‘Šï¼Œè€Œæ˜¯æŠŠå®ƒä»¬è®°å½•åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œå»ã€‚</p><p>è¿™æ—¶å€™ï¼ŒNode.js æä¾›çš„<code>--redirect-warnings=file</code>é€‰é¡¹å°±æ´¾ä¸Šç”¨åœºäº†ã€‚é€šè¿‡è¿™ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªæ–‡ä»¶æ¥è®°å½•æ‰€æœ‰çš„è­¦å‘Šä¿¡æ¯ï¼Œè€Œä¸æ˜¯å°†å®ƒä»¬å‘é€åˆ°æ§åˆ¶å°ã€‚</p><p>ä¾‹å¦‚ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --redirect-warnings=warnings.txt</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªå«<code>app.js</code>çš„ Node.js ç¨‹åºæ–‡ä»¶ï¼Œä½ æƒ³è¦æŠŠæ‰€æœ‰çš„è­¦å‘Šä¿¡æ¯é‡å®šå‘åˆ°å½“å‰ç›®å½•ä¸‹çš„<code>warnings.txt</code>æ–‡ä»¶ä¸­ã€‚ä½ åªéœ€è¦åœ¨å¯åŠ¨ Node.js ç¨‹åºæ—¶æ·»åŠ <code>--redirect-warnings=warnings.txt</code>å‚æ•°ã€‚å½“ç¨‹åºè¿è¡Œåï¼Œæ‰€æœ‰çš„è­¦å‘Šä¿¡æ¯å°±ä¼šå†™å…¥<code>warnings.txt</code>ï¼Œè€Œä¸ä¼šå‡ºç°åœ¨æ§åˆ¶å°ã€‚</p><p>ä½¿ç”¨è¿™ä¸ªç‰¹æ€§çš„å®é™…ä¾‹å­åŒ…æ‹¬ï¼š</p><ol><li><p><strong>æœåŠ¡å™¨æ—¥å¿—è®°å½•</strong>ï¼šåœ¨ç”Ÿäº§æœåŠ¡å™¨è¿è¡Œçš„åº”ç”¨é€šå¸¸éœ€è¦è®°å½•è¯¦å°½çš„æ—¥å¿—ä¿¡æ¯ï¼ŒåŒ…æ‹¬è­¦å‘Šã€‚ç®¡ç†å‘˜å¯èƒ½ä¼šå°†è­¦å‘Šé‡å®šå‘åˆ°æ—¥å¿—æ–‡ä»¶ä»¥ä¾¿åç»­åˆ†æã€‚</p></li><li><p><strong>è°ƒè¯•é•¿æœŸè¿è¡Œçš„æœåŠ¡</strong>ï¼šå¯¹äºéœ€è¦é•¿æ—¶é—´è¿è¡Œçš„æœåŠ¡ï¼Œå¦‚ Web æœåŠ¡å™¨ï¼Œå°†è­¦å‘Šè¾“å‡ºåˆ°æ–‡ä»¶å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å›é¡¾å†å²è­¦å‘Šä¿¡æ¯ï¼Œè¿›è¡Œé—®é¢˜è¯Šæ–­ã€‚</p></li><li><p><strong>è‡ªåŠ¨åŒ–è„šæœ¬å’Œå·¥å…·</strong>ï¼šå¦‚æœä½ æ˜¯åœ¨è‡ªåŠ¨åŒ–è„šæœ¬ä¸­ä½¿ç”¨ Node.jsï¼ˆæ¯”å¦‚ CI/CD æµç¨‹ï¼‰ï¼Œå¯èƒ½ä¼šå¸Œæœ›æ•è·æ‰€æœ‰è­¦å‘Šè€Œä¸å¹²æ‰°æ ‡å‡†è¾“å‡ºæµã€‚æ­¤æ—¶ï¼Œå°†è­¦å‘Šé‡å®šå‘åˆ°æ–‡ä»¶å¯ä»¥ä½¿è‡ªåŠ¨åŒ–æµç¨‹çš„è¾“å‡ºä¿æŒæ¸…æ™°ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œ<code>--redirect-warnings</code>é€‰é¡¹æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç®¡ç†å’Œè®°å½•ç¨‹åºçš„è­¦å‘Šä¿¡æ¯ã€‚</p><h3 id="report-compact" tabindex="-1"><a class="header-anchor" href="#report-compact"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--report-compact" target="_blank" rel="noopener noreferrer">--report-compact</a></span></a></h3><p><code>--report-compact</code> æ˜¯ Node.js å‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰çš„ä¸€ä¸ªé€‰é¡¹ï¼Œå®ƒå½±å“ Node.js è¯Šæ–­æŠ¥å‘Šçš„è¾“å‡ºæ ¼å¼ã€‚Node.js è¯Šæ–­æŠ¥å‘Šæ˜¯ä¸€ç§ä¸ºäº†è°ƒæŸ¥å’Œè§£å†³åº”ç”¨ç¨‹åºé—®é¢˜è€Œæä¾›è¯¦ç»†è¿è¡Œæ—¶ä¿¡æ¯çš„å·¥å…·ã€‚</p><p>å½“ä½ åœ¨å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨ <code>--report-compact</code> é€‰é¡¹ï¼ŒNode.js å°†ç”Ÿæˆè¯Šæ–­æŠ¥å‘Šçš„æ—¶å€™ä¼šé‡‡ç”¨ä¸€ç§æ›´åŠ ç´§å‡‘çš„ JSON æ ¼å¼ã€‚è¿™æ„å‘³ç€æŠ¥å‘Šä¸­ä¸ä¼šåŒ…å«é¢å¤–çš„ç©ºç™½å­—ç¬¦å¦‚ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦æˆ–æ¢è¡Œç¬¦ï¼Œè¿™æ ·åšèƒ½å¤Ÿå‡å°‘æŠ¥å‘Šæ–‡ä»¶çš„å¤§å°ï¼Œä½¿å…¶æ›´é€‚åˆç½‘ç»œä¼ è¾“æˆ–è€…å­˜å‚¨åœ¨æœ‰é™çš„ç©ºé—´å†…ã€‚</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ²¡æœ‰æŒ‡å®š <code>--report-compact</code> çš„æ—¶å€™ï¼ŒNode.js ç”Ÿæˆçš„è¯Šæ–­æŠ¥å‘Šå°†æ˜¯æ ¼å¼åŒ–å¥½çš„ï¼Œæ˜“äºé˜…è¯»çš„ JSON æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;header&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;event&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Allocation failed - JavaScript heap out of memory&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;trigger&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;FatalError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">    ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;javascriptStack&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;JavaScript call stack&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;stack&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      &quot;at SomeFunction (somefile.js:10:20)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">      ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">  ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä½¿ç”¨ <code>--report-compact</code> åï¼Œç›¸åŒçš„æŠ¥å‘Šå¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">&quot;header&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:{</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">&quot;event&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Allocation failed - JavaScript heap out of memory&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">&quot;trigger&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;FatalError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">},</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">&quot;javascriptStack&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:{</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;JavaScript call stack&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">&quot;stack&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:[</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;at SomeFunction (somefile.js:10:20)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]},</span><span style="--shiki-light:#B31D28;--shiki-dark:#FFFFFF;--shiki-light-font-style:italic;--shiki-dark-font-style:inherit;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¯·æ³¨æ„ï¼Œç¬¬äºŒä¸ªä¾‹å­ä¸­æ‰€æœ‰çš„æ•°æ®éƒ½æŒ¤åœ¨ä¸€èµ·äº†ï¼Œæ²¡æœ‰äº†å¯è¯»æ€§ï¼Œä½†æ˜¯å®ƒä»¬å ç”¨çš„ç©ºé—´è¾ƒå°ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-6" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-6"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><ol><li><p><strong>é”™è¯¯è¿½è¸ª</strong>ï¼šå¦‚æœä½ çš„ Node.js åº”ç”¨å‘ç”Ÿäº†å´©æºƒæˆ–è€…å‡ºç°äº†å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>--report-compact</code> æ¥ç”Ÿæˆä¸€ä¸ªç´§å‡‘çš„è¯Šæ–­æŠ¥å‘Šï¼Œç„¶åå°†è¿™ä¸ªæŠ¥å‘Šå‘é€åˆ°å¼€å‘å›¢é˜Ÿæˆ–è€…é€šè¿‡æŸç§è‡ªåŠ¨åŒ–å·¥å…·è¿›è¡Œåˆ†æã€‚</p></li><li><p><strong>æ—¥å¿—èšåˆ</strong>ï¼šåœ¨å¤§å‹ç³»ç»Ÿä¸­ï¼Œå¯èƒ½éœ€è¦æ”¶é›†å¤šä¸ªæœåŠ¡çš„è¯Šæ–­æŠ¥å‘Šï¼Œå¹¶ä¸”æ±‡æ€»åˆ°ä¸€ä¸ªä¸­å¿ƒåŒ–çš„æ—¥å¿—ç³»ç»Ÿé‡Œã€‚å› ä¸ºç´§å‡‘çš„æŠ¥å‘Šæ›´å°ï¼Œå®ƒä»¬å¯ä»¥æ›´å¿«åœ°è¢«ä¼ è¾“ï¼Œå¹¶ä¸”å‡å°‘å­˜å‚¨æˆæœ¬ã€‚</p></li><li><p><strong>ç›‘æ§ç³»ç»Ÿ</strong>ï¼šåœ¨ç›‘æ§ç³»ç»Ÿä¸­ï¼Œå¯èƒ½éœ€è¦å‘¨æœŸæ€§åœ°æ”¶é›†è¯Šæ–­ä¿¡æ¯æ¥åˆ†æç³»ç»Ÿå¥åº·çŠ¶å†µã€‚ç”±äºç´§å‡‘çš„æ ¼å¼æ›´é€‚åˆæœºå™¨è§£æï¼Œæ‰€ä»¥å®ƒå¯èƒ½è¢«ç›´æ¥ç”¨äºè‡ªåŠ¨åŒ–çš„ç›‘æ§å·¥å…·ä¸­ã€‚</p></li></ol><p>è¦å¯ç”¨ç´§å‡‘çš„è¯Šæ–­æŠ¥å‘Šï¼Œä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­å¯åŠ¨ä½ çš„ Node.js åº”ç”¨ç¨‹åºæ—¶åŠ ä¸Š <code>--report-compact</code> é€‰é¡¹ï¼Œæ¯”å¦‚ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --report-compact</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å…¶ä¸­ <code>app.js</code> æ˜¯ä½ çš„ Node.js åº”ç”¨ç¨‹åºçš„å…¥å£æ–‡ä»¶ã€‚å¦‚æœåº”ç”¨ç¨‹åºé‡åˆ°äº†é…ç½®çš„è¯Šæ–­äº‹ä»¶ï¼ˆå¦‚æœªæ•è·çš„å¼‚å¸¸ã€è‡´å‘½é”™è¯¯ç­‰ï¼‰ï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªç´§å‡‘æ ¼å¼çš„è¯Šæ–­æŠ¥å‘Šã€‚</p><h3 id="report-dir-directory-report-directory-directory" tabindex="-1"><a class="header-anchor" href="#report-dir-directory-report-directory-directory"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--report-dirdirectory-report-directorydirectory" target="_blank" rel="noopener noreferrer">--report-dir=directory, report-directory=directory</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>--report-dir=directory</code> æˆ–è€… <code>report-directory=directory</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒå…è®¸ä½ æŒ‡å®šä¸€ä¸ªç›®å½•ï¼ˆæ–‡ä»¶å¤¹ï¼‰ï¼Œç”¨æ¥å­˜æ”¾å„ç§è¯Šæ–­æŠ¥å‘Šã€‚Node.js çš„è¯Šæ–­æŠ¥å‘Šæ˜¯ä¸€ç³»åˆ—åŒ…å«äº†å…³äºåº”ç”¨æ€§èƒ½å’Œé”™è¯¯ä¿¡æ¯çš„ JSON æ ¼å¼æ–‡ä»¶ï¼Œè¿™äº›æŠ¥å‘Šå¯¹äºè°ƒè¯•å’Œç†è§£åº”ç”¨åœ¨è¿è¡Œæ—¶çš„è¡Œä¸ºéå¸¸æœ‰å¸®åŠ©ã€‚</p><p>å½“ä½ åœ¨å¯åŠ¨ä½ çš„ Node.js åº”ç”¨æ—¶ä½¿ç”¨äº† <code>--report-dir</code> é€‰é¡¹ï¼Œä½ å°±å¯ä»¥è®¾å®šè¯Šæ–­æŠ¥å‘Šè¦è¢«å†™å…¥çš„ç‰¹å®šç›®å½•ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šè¿™ä¸ªé€‰é¡¹ï¼Œé‚£ä¹ˆ Node.js å°†ä¼šæŠŠæŠ¥å‘Šè¾“å‡ºåˆ°å½“å‰å·¥ä½œç›®å½•ä¸­ã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡å‡ ä¸ªå®é™…çš„ä¾‹å­æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼š</p><p><strong>ä¾‹å­ 1ï¼šè®¾ç½®æŠ¥å‘Šç›®å½•</strong><br> å‡è®¾æˆ‘ä»¬è¦è¿è¡Œä¸€ä¸ªåä¸º <code>app.js</code> çš„ Node.js åº”ç”¨ï¼Œå¹¶ä¸”æˆ‘ä»¬æƒ³è¦æ‰€æœ‰ç”Ÿæˆçš„æŠ¥å‘Šéƒ½å­˜å‚¨åœ¨ <code>/var/reports</code> ç›®å½•ä¸‹ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·å¯åŠ¨åº”ç”¨ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --report-dir=/var/reports</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·åšä¹‹åï¼Œä¸€æ—¦åº”ç”¨è¿è¡ŒæœŸé—´ç”Ÿæˆäº†ä»»ä½•è¯Šæ–­æŠ¥å‘Šï¼Œè¿™äº›æŠ¥å‘Šå°±ä¼šè¢«ä¿å­˜åœ¨ <code>/var/reports</code> ç›®å½•ä¸‹ã€‚</p><p><strong>ä¾‹å­ 2ï¼šè§¦å‘å’Œç”ŸæˆæŠ¥å‘Š</strong><br> é€šå¸¸æƒ…å†µä¸‹ï¼Œè¯Šæ–­æŠ¥å‘Šåœ¨åº”ç”¨å‡ºç°å¼‚å¸¸ï¼ˆå¦‚æœªæ•è·çš„å¼‚å¸¸æˆ–è€…è‡´å‘½é”™è¯¯ï¼‰æ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆã€‚ä½†ä¹Ÿå¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼ä¸»åŠ¨ç”ŸæˆæŠ¥å‘Šï¼Œæ¯”å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨ app.js æ–‡ä»¶ä¸­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">report</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">report</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writeReport</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å½“æŸä¸ªç‰¹å®šæ¡ä»¶æ»¡è¶³æ—¶ï¼Œæ¯”å¦‚å†…å­˜ä½¿ç”¨è¿‡é«˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">memoryUsageTooHigh</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ç”Ÿæˆä¸€ä¸ªè¯Šæ–­æŠ¥å‘Š</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">report</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeReport</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/var/reports/report-&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šä»£ç æ£€æŸ¥å†…å­˜ä½¿ç”¨æ˜¯å¦è¿‡é«˜ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå°±åœ¨ <code>/var/reports</code> ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªä»¥å½“å‰æ—¶é—´æˆ³å‘½åçš„è¯Šæ–­æŠ¥å‘Šã€‚</p><p><strong>ä¾‹å­ 3ï¼šå°†æŠ¥å‘Šé…ç½®ä½œä¸ºç¯å¢ƒå˜é‡</strong><br> é™¤äº†å‘½ä»¤è¡Œé€‰é¡¹ï¼Œè¿˜å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡æ¥é…ç½®æŠ¥å‘Šç”Ÿæˆçš„è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œåœ¨ Linux æˆ– macOS ç³»ç»Ÿä¸­ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨åº”ç”¨å‰è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NODE_REPORT_DIR</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">reports</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ Windows ç³»ç»Ÿä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-cmd line-numbers-mode" data-highlighter="shiki" data-ext="cmd" data-title="cmd" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>set NODE_REPORT_DIR=C:\Path\To\Reports</span></span>
<span class="line"><span>node app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»¼ä¸Šæ‰€è¿°ï¼Œ<code>--report-dir</code> æˆ– <code>report-directory</code> é€‰é¡¹å°±æ˜¯ç”¨æ¥æŒ‡å®š Node.js åº”ç”¨ç”Ÿæˆçš„è¯Šæ–­æŠ¥å‘Šä¿å­˜çš„è·¯å¾„ã€‚é€šè¿‡ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œå¼€å‘è€…å¯ä»¥æ›´æ–¹ä¾¿åœ°æ”¶é›†å’Œç®¡ç†è¯Šæ–­ä¿¡æ¯ï¼Œä»è€Œæå‡åº”ç”¨çš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚</p><h3 id="report-filename-filename" tabindex="-1"><a class="header-anchor" href="#report-filename-filename"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--report-filenamefilename" target="_blank" rel="noopener noreferrer">--report-filename=filename</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>--report-filename=filename</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼ˆCLI Optionï¼‰ï¼Œå®ƒå…è®¸ä½ æŒ‡å®šè¯Šæ–­æŠ¥å‘Šæ–‡ä»¶çš„åç§°ã€‚è¿™ä¸ªåŠŸèƒ½å±äº Node.js çš„è¯Šæ–­æŠ¥å‘Šï¼ˆDiagnostic Reportï¼‰ç‰¹æ€§ï¼Œè¯Šæ–­æŠ¥å‘Šæ˜¯ä¸€ç§å¸®åŠ©ä½ åˆ†æåº”ç”¨é—®é¢˜çš„å·¥å…·ï¼Œæ¯”å¦‚å´©æºƒã€æ…¢æ‰§è¡Œã€å†…å­˜æ³„æ¼ç­‰ã€‚</p><h3 id="è¯Šæ–­æŠ¥å‘Šæ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#è¯Šæ–­æŠ¥å‘Šæ˜¯ä»€ä¹ˆ"><span>è¯Šæ–­æŠ¥å‘Šæ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>è¯Šæ–­æŠ¥å‘Šæä¾›äº†åœ¨ç‰¹å®šæ—¶é—´ç‚¹ Node.js è¿›ç¨‹çš„è¯¦ç»†çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š</p><ul><li>JavaScript å †æ ˆè·Ÿè¸ª</li><li>æ‰€æœ‰æ´»åŠ¨çš„å¥æŸ„ï¼ˆä¾‹å¦‚æ–‡ä»¶æè¿°ç¬¦ã€ç½‘ç»œç«¯å£ï¼‰</li><li>å†…å­˜åˆ†é…æƒ…å†µ</li><li>å‘½ä»¤è¡Œå‚æ•°å’Œç¯å¢ƒå˜é‡</li><li>Node.js å’Œ V8 çš„å†…éƒ¨çŠ¶æ€ä¿¡æ¯</li></ul><h3 id="å¦‚ä½•ä½¿ç”¨-report-filename" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-report-filename"><span>å¦‚ä½•ä½¿ç”¨ <code>--report-filename</code>ï¼Ÿ</span></a></h3><p>å½“ä½ è¿è¡Œä¸€ä¸ª Node.js åº”ç”¨æ—¶ï¼Œä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­æ·»åŠ  <code>--report-filename</code> å‚æ•°æ¥æŒ‡å®šç”ŸæˆæŠ¥å‘Šçš„æ–‡ä»¶åã€‚å¦‚æœä½ æ²¡æœ‰æŒ‡å®šè¿™ä¸ªé€‰é¡¹ï¼ŒNode.js å°†ä¼šä½¿ç”¨é»˜è®¤çš„æ–‡ä»¶åæ ¼å¼ï¼Œé€šå¸¸åŒ…å«æ—¥æœŸå’Œæ—¶é—´ã€‚</p><h4 id="ç¤ºä¾‹-æŒ‡å®šæŠ¥å‘Šæ–‡ä»¶å" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-æŒ‡å®šæŠ¥å‘Šæ–‡ä»¶å"><span>ç¤ºä¾‹ï¼šæŒ‡å®šæŠ¥å‘Šæ–‡ä»¶å</span></a></h4><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --report-filename=myapp-report.json</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> myapp.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœå‡ºç°ä¸€ä¸ªéœ€è¦ç”Ÿæˆè¯Šæ–­æŠ¥å‘Šçš„æƒ…å†µï¼Œæ¯”å¦‚ä¸€ä¸ªæœªæ•è·çš„å¼‚å¸¸æˆ–è€…æ‰‹åŠ¨è§¦å‘ï¼ŒæŠ¥å‘Šå°†ä¼šè¢«ä¿å­˜åˆ°åä¸º <code>myapp-report.json</code> çš„æ–‡ä»¶ä¸­ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-1"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª web æœåŠ¡ï¼Œä½ å¸Œæœ›å½“æœåŠ¡æ„å¤–å´©æºƒæ—¶èƒ½å¤Ÿè·å–ä¸€ä»½è¯Šæ–­æŠ¥å‘Šä»¥ä¾¿åç»­åˆ†æã€‚</p><h4 id="web-æœåŠ¡å™¨ä»£ç -myapp-js" tabindex="-1"><a class="header-anchor" href="#web-æœåŠ¡å™¨ä»£ç -myapp-js"><span>Web æœåŠ¡å™¨ä»£ç  (<code>myapp.js</code>)</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™é‡Œæ˜¯å¤„ç†è¯·æ±‚çš„é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running on port 3000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å¯åŠ¨æœåŠ¡å™¨å¹¶æŒ‡å®šæŠ¥å‘Šæ–‡ä»¶å" tabindex="-1"><a class="header-anchor" href="#å¯åŠ¨æœåŠ¡å™¨å¹¶æŒ‡å®šæŠ¥å‘Šæ–‡ä»¶å"><span>å¯åŠ¨æœåŠ¡å™¨å¹¶æŒ‡å®šæŠ¥å‘Šæ–‡ä»¶å</span></a></h4><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --report-filename=crash-report.json</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> myapp.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œå¦‚æœè¿™ä¸ª Node.js æœåŠ¡å™¨å› ä¸ºæŸäº›åŸå› å´©æºƒäº†ï¼Œæ¯”å¦‚ä¸€ä¸ªæœªå¤„ç†çš„å¼‚å¸¸æˆ–è€…æŸä¸ª API ä½¿ç”¨é”™è¯¯ï¼ŒNode.js å°†ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåä¸º <code>crash-report.json</code> çš„æ–‡ä»¶ã€‚ä½ å¯ä»¥åœ¨ä¹‹åæ‰“å¼€è¿™ä¸ªæ–‡ä»¶æ¥æŸ¥çœ‹è¯Šæ–­ä¿¡æ¯ï¼Œå¹¶åˆ†æå¯¼è‡´å´©æºƒçš„åŸå› ã€‚</p><p>è®°ä½ï¼Œè¯Šæ–­æŠ¥å‘Šä¼šåŒ…å«è¯¦ç»†çš„ç³»ç»Ÿå’Œåº”ç”¨çŠ¶æ€ä¿¡æ¯ï¼Œæ‰€ä»¥è¦ç¡®ä¿ä¸è¦æ— æ„ä¸­æ³„éœ²æ•æ„Ÿä¿¡æ¯ã€‚åœ¨å¤„ç†ç”Ÿäº§ç¯å¢ƒä¸­çš„æŠ¥å‘Šæ—¶ï¼Œæ€»æ˜¯è¦å°å¿ƒè°¨æ…ã€‚</p><h3 id="report-on-fatalerror" tabindex="-1"><a class="header-anchor" href="#report-on-fatalerror"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--report-on-fatalerror" target="_blank" rel="noopener noreferrer">--report-on-fatalerror</a></span></a></h3><p>Node.js ä¸­çš„ <code>--report-on-fatalerror</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå½“ä½ åœ¨å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨å®ƒï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ è¯Šæ–­åº”ç”¨ç¨‹åºå´©æºƒçš„åŸå› ã€‚å¦‚æœä½ çš„ Node.js åº”ç”¨ç¨‹åºé‡åˆ°äº†ä¸€ä¸ªè‡´å‘½é”™è¯¯ï¼ˆæ¯”å¦‚å†…å­˜ä¸è¶³æˆ–è€…æ— æ³•å¤„ç†çš„å¼‚å¸¸ï¼‰ï¼Œå¼€å¯è¿™ä¸ªé€‰é¡¹ä¼šè¦æ±‚ Node.js åœ¨å´©æºƒæ—¶ç”Ÿæˆä¸€ä¸ªè¯¦ç»†çš„è¯Šæ–­æŠ¥å‘Šã€‚</p><p>è¿™ä¸ªè¯Šæ–­æŠ¥å‘Šæ˜¯ä¸€ä¸ªåŒ…å«äº†å¾ˆå¤šä¿¡æ¯çš„æ–‡ä»¶ï¼Œæ¯”å¦‚å †æ ˆè¿½è¸ªã€å·²åŠ è½½çš„æ¨¡å—åˆ—è¡¨ã€èµ„æºä½¿ç”¨æƒ…å†µç­‰ç­‰ã€‚é€šè¿‡é˜…è¯»è¿™ä»½æŠ¥å‘Šï¼Œå¼€å‘è€…å¯ä»¥æ›´å®¹æ˜“åœ°ç†è§£å¯¼è‡´å´©æºƒçš„æƒ…å†µï¼Œä»è€Œæ‰¾åˆ°é—®é¢˜çš„æ ¹æºï¼Œå¹¶è¿›è¡Œä¿®å¤ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªä¾‹å­ï¼š</p><h3 id="ç¤ºä¾‹-1-å¯ç”¨æŠ¥å‘Šç”Ÿæˆ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-å¯ç”¨æŠ¥å‘Šç”Ÿæˆ"><span>ç¤ºä¾‹ 1ï¼šå¯ç”¨æŠ¥å‘Šç”Ÿæˆ</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªç®€å•çš„ Node.js è„šæœ¬ï¼Œå«åš <code>app.js</code>ï¼Œé‡Œé¢æœ‰ä¸€æ®µå¯èƒ½ä¼šè§¦å‘å´©æºƒçš„ä»£ç ã€‚ä¸ºäº†ç¡®ä¿åœ¨è¿™ä¸ªè„šæœ¬å‘ç”Ÿè‡´å‘½é”™è¯¯æ—¶èƒ½å¤Ÿå¾—åˆ°è¯¦ç»†æŠ¥å‘Šï¼Œä½ å¯ä»¥åƒè¿™æ ·å¯åŠ¨ä½ çš„åº”ç”¨ç¨‹åºï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --report-on-fatalerror</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœ <code>app.js</code> è¿è¡Œæ—¶å‡ºç°äº†è‡´å‘½é”™è¯¯ï¼ŒNode.js å°†ä¼šåœ¨å½“å‰å·¥ä½œç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæŠ¥å‘Šæ–‡ä»¶ï¼Œä¾‹å¦‚ <code>report.20210326.182120.1780.0.json</code>ã€‚</p><h3 id="ç¤ºä¾‹-2-åˆ†ææŠ¥å‘Šå†…å®¹" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-åˆ†ææŠ¥å‘Šå†…å®¹"><span>ç¤ºä¾‹ 2ï¼šåˆ†ææŠ¥å‘Šå†…å®¹</span></a></h3><p>å½“ä½ çš„åº”ç”¨ç¨‹åºå› ä¸ºæŸäº›ä¸¥é‡é—®é¢˜æ¯”å¦‚ <code>SEGFAULT</code> ï¼ˆæ®µé”™è¯¯ï¼‰å´©æºƒæ—¶ï¼ŒæŠ¥å‘Šä¼šåŒ…å«ç±»ä¼¼å¦‚ä¸‹çš„ä¿¡æ¯ï¼š</p><ul><li>JavaScript å †æ ˆè¿½è¸ªï¼ˆå“ªä¸ªå‡½æ•°æ­£åœ¨æ‰§è¡Œï¼Œè°ƒç”¨é¡ºåºæ˜¯ä»€ä¹ˆï¼‰</li><li>åŸç”Ÿå †æ ˆè¿½è¸ªï¼ˆC++ å±‚é¢çš„å‡½æ•°è°ƒç”¨ï¼‰</li><li>å †çš„æ‘˜è¦ä¿¡æ¯ï¼ˆå†…å­˜ä¸­å¯¹è±¡çš„ç»Ÿè®¡ä¿¡æ¯ï¼‰</li><li>ç³»ç»Ÿä¿¡æ¯ï¼ˆæ“ä½œç³»ç»Ÿç‰ˆæœ¬ï¼Œæ¶æ„ç­‰ï¼‰</li><li>èµ„æºä½¿ç”¨æƒ…å†µï¼ˆCPU, å†…å­˜ä½¿ç”¨é‡ï¼‰</li></ul><p>é€šè¿‡è¿™äº›ä¿¡æ¯ï¼Œä½ æˆ–è®¸èƒ½å‘ç°é—®é¢˜æ˜¯ç”±äºæŸä¸ªç‰¹å®šæ¨¡å—æˆ–ä»£ç å¼•èµ·çš„ï¼Œä¹Ÿå¯èƒ½å‘ç°æ˜¯ç”±äºèµ„æºä¸è¶³é€ æˆçš„ã€‚</p><h3 id="ç¤ºä¾‹-3-åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ•è·è‡´å‘½é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-3-åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ•è·è‡´å‘½é”™è¯¯"><span>ç¤ºä¾‹ 3ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ•è·è‡´å‘½é”™è¯¯</span></a></h3><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä½ å¯èƒ½å¸Œæœ›è‡ªåŠ¨æ”¶é›†ä»»ä½•å¯èƒ½å¯¼è‡´ Node.js åº”ç”¨ç¨‹åºå´©æºƒçš„è‡´å‘½é”™è¯¯æŠ¥å‘Šï¼Œä»¥ä¾¿åç»­åˆ†æã€‚ä½ å¯ä»¥é€šè¿‡å°† <code>--report-on-fatalerror</code> åŠ å…¥åˆ°ä½ çš„å¯åŠ¨å‘½ä»¤ä¸­æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œè­¬å¦‚ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --report-on-fatalerror</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --max-old-space-size=1024</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™è¡Œå‘½ä»¤ä¸ä»…è®¾ç½®äº†å´©æºƒæ—¶çš„æŠ¥å‘Šç”Ÿæˆï¼Œè¿˜è®¾ç½®äº† Node.js ä½¿ç”¨çš„æœ€å¤§è€å¹´ä»£å†…å­˜å¤§å°ä¸º 1024MBï¼Œè¿™æœ‰åŠ©äºå¤„ç†å†…å­˜é™åˆ¶çš„é—®é¢˜ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>--report-on-fatalerror</code> æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„è°ƒè¯•å·¥å…·ï¼Œå®ƒå¯ä»¥åœ¨ä½ çš„ Node.js åº”ç”¨ç¨‹åºé‡åˆ°æ— æ³•æ¢å¤çš„é”™è¯¯æ—¶æä¾›è¯¦ç»†çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¸®åŠ©ä½ å¿«é€Ÿå®šä½å¹¶è§£å†³é—®é¢˜ã€‚</p><h3 id="report-on-signal" tabindex="-1"><a class="header-anchor" href="#report-on-signal"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--report-on-signal" target="_blank" rel="noopener noreferrer">--report-on-signal</a></span></a></h3><p>Node.js çš„ <code>--report-on-signal</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒå…è®¸ä½ åœ¨ Node.js åº”ç”¨ç¨‹åºæ¥æ”¶åˆ°ç‰¹å®šçš„ä¿¡å·æ—¶ç”Ÿæˆä¸€ä¸ªè¯Šæ–­æŠ¥å‘Šã€‚è¯Šæ–­æŠ¥å‘Šæ˜¯ä¸€ä¸ªåŒ…å«äº†ä½ çš„åº”ç”¨çŠ¶æ€ä¿¡æ¯çš„æ–‡ä»¶ï¼Œè¿™å¯¹äºç†è§£å’Œè°ƒè¯•åº”ç”¨ç¨‹åºä¸­å‡ºç°çš„é—®é¢˜éå¸¸æœ‰å¸®åŠ©ã€‚</p><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä½ ä½¿ç”¨ <code>--report-on-signal</code> é€‰é¡¹æ—¶ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ”¶åˆ°äº†ä¸€ä¸ª SIGUSR2 ä¿¡å·ï¼ˆè¿™æ˜¯ä¸€ä¸ªç”±ç”¨æˆ·å®šä¹‰çš„ä¿¡å·ï¼Œé€šå¸¸ä¸ä¼šè¢«ç³»ç»Ÿä½¿ç”¨ï¼‰ï¼ŒNode.js å°†ä¼šç”Ÿæˆä¸€ä¸ªè¯Šæ–­æŠ¥å‘Šã€‚è¿™ä¸ªæŠ¥å‘Šæ–‡ä»¶å°†åŒ…å«å¾ˆå¤šæœ‰å…³å½“å‰è¿è¡Œçš„ Node.js è¿›ç¨‹çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p><ul><li>å †æ ˆè¿½è¸ª</li><li>JavaScript å’ŒåŸç”Ÿå †çš„ç»Ÿè®¡</li><li>ç³»ç»Ÿä¿¡æ¯</li><li>èµ„æºåˆ©ç”¨æƒ…å†µ</li><li>å¼€æ”¾çš„å¥æŸ„åˆ—è¡¨</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå¤æ‚çš„ Node.js åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”å¶å°”ä¼šé‡åˆ°æ€§èƒ½é—®é¢˜æˆ–è€…æ„å¤–å´©æºƒã€‚é€šè¿‡å¯ç”¨ <code>--report-on-signal</code>ï¼Œä½ å¯ä»¥åœ¨è¿è¡Œåº”ç”¨æ—¶éšæ—¶ç”ŸæˆæŠ¥å‘Šï¼Œä»¥ä¾¿åˆ†æåº”ç”¨çš„çŠ¶æ€å’Œè¡Œä¸ºã€‚</p><p>å¦‚ä½•ä½¿ç”¨ï¼š</p><ol><li><p>åœ¨å¯åŠ¨ä½ çš„ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œæ·»åŠ  <code>--report-on-signal</code> é€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ é€šå¸¸é€šè¿‡ <code>node app.js</code> æ¥è¿è¡Œä½ çš„åº”ç”¨ï¼Œæ”¹ä¸ºä½¿ç”¨ <code>node --report-on-signal app.js</code>ã€‚</p></li><li><p>å½“ä½ çš„åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œå¹¶ä¸”ä½ æƒ³è¦ç”ŸæˆæŠ¥å‘Šæ—¶ï¼Œä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­å‘é€ SIGUSR2 ä¿¡å·ç»™ Node.js è¿›ç¨‹ã€‚åœ¨ Unix ç³»ç»Ÿä¸Šï¼Œä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>kill -SIGUSR2 `&lt;`pid&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å…¶ä¸­ <code>&lt;`pid`&gt;</code>æ˜¯ä½ çš„ Node.js åº”ç”¨è¿›ç¨‹çš„è¿›ç¨‹ IDã€‚ä½ å¯ä»¥é€šè¿‡<code>ps</code>ã€<code>top</code> æˆ–å…¶ä»–å·¥å…·æŸ¥è¯¢åˆ°è¿™ä¸ª IDã€‚</p></li><li><p>ä¸€æ—¦æ¥æ”¶åˆ°ä¿¡å·ï¼ŒNode.js å°†åœ¨å½“å‰å·¥ä½œç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>.json</code> æˆ– <code>.html</code> æ ¼å¼çš„æŠ¥å‘Šæ–‡ä»¶ï¼ˆå–å†³äºé…ç½®ï¼‰ã€‚</p></li><li><p>æ‰¾åˆ°å¹¶æ‰“å¼€è¿™ä¸ªæŠ¥å‘Šæ–‡ä»¶ï¼ŒæŸ¥çœ‹ç›¸å…³çš„è¯Šæ–­ä¿¡æ¯æ¥å¸®åŠ©ä½ ç†è§£å’Œè§£å†³é—®é¢˜ã€‚</p></li></ol><p>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</p><ul><li><p><strong>æ€§èƒ½è°ƒä¼˜</strong>ï¼šå¦‚æœä½ çš„ Node.js åº”ç”¨ç¨‹åºè¿è¡Œç¼“æ…¢æˆ–å“åº”è¿Ÿé’ï¼Œä½ å¯èƒ½æƒ³çŸ¥é“æ˜¯å“ªäº›å‡½æ•°è€—è´¹äº†å¤§é‡æ—¶é—´ã€‚ç”ŸæˆæŠ¥å‘Šåï¼Œä½ å¯ä»¥åˆ†æè°ƒç”¨æ ˆä¿¡æ¯æ¥è¯†åˆ«ç“¶é¢ˆã€‚</p></li><li><p><strong>å†…å­˜æ³„æ¼</strong>ï¼šå¦‚æœä½ æ€€ç–‘åº”ç”¨ä¸­å­˜åœ¨å†…å­˜æ³„æ¼ï¼Œç”ŸæˆæŠ¥å‘Šåï¼Œä½ å¯ä»¥æŸ¥çœ‹å †å†…å­˜çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œæ‰¾åˆ°å“ªäº›å¯¹è±¡å æ®äº†è¿‡å¤šçš„å†…å­˜ã€‚</p></li><li><p><strong>å¼‚å¸¸è°ƒè¯•</strong>ï¼šå½“åº”ç”¨å¼‚å¸¸ç»ˆæ­¢æ—¶ï¼Œå¯èƒ½å¾ˆéš¾å¤ç°å’Œè°ƒè¯•è¯¥é—®é¢˜ã€‚ä½ å¯ä»¥åœ¨å¼‚å¸¸å‘ç”Ÿæ—¶ç”Ÿæˆä¸€ä¸ªæŠ¥å‘Šï¼Œä»¥è·å–å½“æ—¶çš„ç¯å¢ƒçŠ¶æ€ï¼ŒåŒ…æ‹¬é”™è¯¯æ ˆå’Œèµ„æºä½¿ç”¨æƒ…å†µã€‚</p></li></ul><p>è¯·æ³¨æ„ï¼Œç”ŸæˆæŠ¥å‘Šçš„åŠŸèƒ½éœ€è¦ Node.js ç‰ˆæœ¬æ”¯æŒï¼Œå¹¶ä¸”å¯èƒ½ä¼šå¯¹æ€§èƒ½æœ‰è½»å¾®å½±å“ï¼Œå› æ­¤å»ºè®®åªåœ¨è°ƒè¯•å’Œå¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</p><h3 id="report-signal-signal" tabindex="-1"><a class="header-anchor" href="#report-signal-signal"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--report-signalsignal" target="_blank" rel="noopener noreferrer">--report-signal=signal</a></span></a></h3><p>Node.js çš„ <code>--report-signal</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒç”¨äºé…ç½® Node.js ç”Ÿæˆè¯Šæ–­æŠ¥å‘Šçš„æ—¶æœºã€‚è¯Šæ–­æŠ¥å‘Šæ˜¯ä¸€ä»½åŒ…å«äº† Node.js è¿›ç¨‹çŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯çš„è¯¦ç»†æ–‡æ¡£ï¼Œå®ƒå¯ä»¥åœ¨è°ƒè¯•æˆ–åˆ†æåº”ç”¨ç¨‹åºé—®é¢˜æ—¶éå¸¸æœ‰ç”¨ã€‚</p><p>å½“ä½ å¯åŠ¨ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œé€šå¸¸ä¼šç›´æ¥è¿è¡Œ <code>node</code> å‘½ä»¤åé¢è·Ÿç€ä½ çš„è„šæœ¬æ–‡ä»¶åã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ª <code>app.js</code> æ–‡ä»¶ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·è¿è¡Œå®ƒï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œå‡è®¾åœ¨æŸä¸ªåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬æƒ³è¦åœ¨ Node.js è¿›ç¨‹æ¥æ”¶åˆ°ç‰¹å®šçš„ä¿¡å·æ—¶ï¼ˆä¾‹å¦‚ <code>SIGUSR2</code>ï¼‰ï¼Œè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªè¯Šæ–­æŠ¥å‘Šã€‚ä¿¡å·æ˜¯æ“ä½œç³»ç»Ÿç”¨æ¥ä¸è¿›ç¨‹é€šä¿¡çš„ä¸€ç§æœºåˆ¶ï¼Œä¸åŒçš„ä¿¡å·å¯ä»¥æŒ‡ç¤ºä¸åŒçš„æ“ä½œæˆ–äº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œ<code>SIGINT</code> é€šå¸¸è¡¨ç¤ºä¸­æ–­ä¿¡å·ï¼Œè€Œ <code>SIGUSR2</code> æ˜¯ç”¨æˆ·å®šä¹‰çš„ä¿¡å·ä¹‹ä¸€ï¼Œå¼€å‘è€…å¯ä»¥åœ¨åº”ç”¨ç¨‹åºé‡Œè‡ªå®šä¹‰å®ƒçš„è¡Œä¸ºã€‚</p><p>ä½¿ç”¨ <code>--report-signal</code> é€‰é¡¹ï¼Œä½ å¯ä»¥æŒ‡å®šå½“å“ªä¸ªä¿¡å·è¢«æ¥æ”¶æ—¶ç”ŸæˆæŠ¥å‘Šã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä½ æƒ³åœ¨æ¥æ”¶åˆ° <code>SIGUSR2</code> ä¿¡å·æ—¶ç”ŸæˆæŠ¥å‘Šï¼Œä½ å¯ä»¥è¿™æ ·è¿è¡Œä½ çš„ Node.js åº”ç”¨ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --report-signal=SIGUSR2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¸‹é¢æ˜¯å…·ä½“çš„å®é™…è¿ç”¨ä¾‹å­ï¼š</p><h3 id="ä¾‹å­-1-è§¦å‘ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-è§¦å‘ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š"><span>ä¾‹å­ 1ï¼šè§¦å‘ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨è°ƒè¯•ä¸€ä¸ª Node.js åº”ç”¨ï¼Œå¹¶ä¸”å¶å°”é‡åˆ°äº†æ€§èƒ½é—®é¢˜ã€‚ä½ ä¸ç¡®å®šæ˜¯ä»€ä¹ˆåŸå› ï¼Œæ‰€ä»¥ä½ å†³å®šåœ¨é‡åˆ°é—®é¢˜æ—¶ç”Ÿæˆä¸€ä¸ªè¯Šæ–­æŠ¥å‘Šã€‚</p><p>é¦–å…ˆï¼Œä½ éœ€è¦å¯åŠ¨åº”ç”¨å¹¶åŠ å…¥ <code>--report-signal</code> é€‰é¡¹ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --report-signal=SIGUSR2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç„¶åï¼Œå½“åº”ç”¨è¿è¡Œæ—¶ï¼Œä½ å¯ä»¥ä»å¦ä¸€ä¸ªç»ˆç«¯å‘é€ <code>SIGUSR2</code> ä¿¡å·ç»™åº”ç”¨è¿›ç¨‹ï¼Œè¿™æ · Node.js å°±ä¼šç”Ÿæˆè¯Šæ–­æŠ¥å‘Šã€‚Linux æˆ– macOS ç³»ç»Ÿä¸Šå¯ä»¥ä½¿ç”¨ <code>kill</code> å‘½ä»¤å‘é€ä¿¡å·ï¼Œä½ éœ€è¦çŸ¥é“ä½ çš„ Node.js è¿›ç¨‹çš„ PID (è¿›ç¨‹ ID)ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">kill</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -SIGUSR2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Node.js</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> è¿›ç¨‹çš„PI</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">D</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ›¿æ¢ <code>&lt;`Node.js è¿›ç¨‹çš„ PID`&gt;</code> ä¸ºå®é™…çš„è¿›ç¨‹ IDï¼Œæ‰§è¡Œè¯¥å‘½ä»¤åï¼ŒNode.js ä¼šç”Ÿæˆä¸€ä¸ªè¯Šæ–­æŠ¥å‘Šã€‚</p><h3 id="ä¾‹å­-2-è‡ªåŠ¨åŒ–å¤„ç†" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-è‡ªåŠ¨åŒ–å¤„ç†"><span>ä¾‹å­ 2ï¼šè‡ªåŠ¨åŒ–å¤„ç†</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªé•¿æœŸè¿è¡Œçš„ Node.js æœåŠ¡å™¨ï¼Œä½ æƒ³è®©å®ƒåœ¨ CPU ä½¿ç”¨ç‡è¿‡é«˜æ—¶è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Šã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>--report-signal</code> ä¸ä¸€äº›ç³»ç»Ÿç›‘æ§å·¥å…·é…åˆä½¿ç”¨ã€‚</p><p>é¦–å…ˆï¼Œå¯åŠ¨ä½ çš„ Node.js åº”ç”¨æ—¶åŒ…å« <code>--report-signal</code> é€‰é¡¹ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --report-signal=SIGUSR2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> server.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç„¶åï¼Œä½ å¯ä»¥è®¾ç½®ä¸€ä¸ªç›‘æ§è„šæœ¬æˆ–æœåŠ¡æ¥æ£€æµ‹ CPU ä½¿ç”¨æƒ…å†µã€‚å½“æ£€æµ‹åˆ° CPU ä½¿ç”¨ç‡å¼‚å¸¸æ—¶ï¼Œç›‘æ§å·¥å…·å¯ä»¥è‡ªåŠ¨å‘ Node</p><h3 id="report-uncaught-exception" tabindex="-1"><a class="header-anchor" href="#report-uncaught-exception"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--report-uncaught-exception" target="_blank" rel="noopener noreferrer">--report-uncaught-exception</a></span></a></h3><p><code>--report-uncaught-exception</code> æ˜¯ Node.js å‘½ä»¤è¡Œæ¥å£çš„ä¸€ä¸ªå‚æ•°é€‰é¡¹ï¼Œå®ƒè®© Node.js åœ¨é‡åˆ°æœªæ•è·å¼‚å¸¸æ—¶ç”Ÿæˆä¸€ä¸ªè¯¦ç»†çš„è¯Šæ–­æŠ¥å‘Šã€‚è¿™ä¸ªè¯Šæ–­æŠ¥å‘Šé€šå¸¸åŒ…å«äº†åœ¨å¼‚å¸¸å‘ç”Ÿæ—¶çš„ JavaScript è°ƒç”¨æ ˆã€å¼€æ”¾çš„å¥æŸ„ã€ç½‘ç»œè¯·æ±‚çŠ¶æ€å’Œå…¶ä»–ç³»ç»Ÿä¿¡æ¯ã€‚</p><p>æœªæ•è·çš„å¼‚å¸¸æŒ‡çš„æ˜¯åœ¨ Node.js åº”ç”¨ç¨‹åºä»£ç ä¸­æ²¡æœ‰è¢« try/catch è¯­å¥æ•è·çš„é”™è¯¯ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“è¿™ç±»é”™è¯¯å‘ç”Ÿæ—¶ï¼ŒNode.js ä¼šæ‰“å°é”™è¯¯å †æ ˆå¹¶é€€å‡ºè¿›ç¨‹ã€‚ä½¿ç”¨ <code>--report-uncaught-exception</code> é€‰é¡¹èƒ½å¤Ÿè®©ä½ åœ¨åº”ç”¨å´©æºƒæ—¶å¾—åˆ°æ›´å¤šçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»è€Œå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£é—®é¢˜å‘ç”Ÿçš„åŸå› ã€‚</p><p><strong>ä¸¾ä¾‹è¯´æ˜ï¼š</strong></p><p>æ¯”å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„ Node.js åº”ç”¨ç¨‹åºï¼Œå®ƒæ‰§è¡Œäº†ä¸€æ®µå¯èƒ½ä¼šæŠ›å‡ºé”™è¯¯çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// example.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™é‡Œå°è¯•è¯»å–ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œå°†ä¼šå¯¼è‡´ä¸€ä¸ªæœªæ•è·çš„å¼‚å¸¸</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/non-existent-file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­£å¸¸è¿è¡Œè¿™æ®µä»£ç ï¼ˆä¸å¸¦ <code>--report-uncaught-exception</code>ï¼‰ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ï¼Œå‘Šè¯‰ä½ æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¹¶ä¸”ä¼šæ˜¾ç¤ºé”™è¯¯çš„å †æ ˆè¿½è¸ªã€‚å¦‚æœç¨‹åºä¸­å…¶ä»–åœ°æ–¹æ²¡æœ‰å¯¹è¿™ä¸ªé”™è¯¯è¿›è¡Œå¤„ç†ï¼ŒNode.js è¿›ç¨‹å°†ä¼šé€€å‡ºã€‚</p><p>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å¯åŠ¨è¿™ä¸ªç¨‹åºæ—¶æ·»åŠ äº† <code>--report-uncaught-exception</code> å‚æ•°ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --report-uncaught-exception</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> example.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å½“æœªæ•è·çš„å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œé™¤äº†æ ‡å‡†çš„é”™è¯¯å †æ ˆï¼ŒNode.js ä¹Ÿä¼šåœ¨å½“å‰å·¥ä½œç›®å½•ç”Ÿæˆä¸€ä¸ªè¯Šæ–­æŠ¥å‘Šæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶åé€šå¸¸ä»¥ <code>report.</code> å¼€å¤´ï¼Œåé¢è·Ÿç€æ—¥æœŸã€æ—¶é—´å’Œ JSON æ–‡ä»¶æ‰©å±•åã€‚ä¾‹å¦‚ï¼š<code>report.20230101.123456.1234.0.json</code>ã€‚</p><p>æ‰“å¼€è¿™ä¸ª JSON æŠ¥å‘Šæ–‡ä»¶ï¼Œä½ ä¼šçœ‹åˆ°å®ƒåŒ…å«äº†å¾ˆå¤šå…³äºå¼‚å¸¸å‘ç”Ÿæ—¶çš„ç¯å¢ƒä¿¡æ¯ï¼Œå¦‚å †æ ˆè¿½è¸ªã€èµ„æºä½¿ç”¨æƒ…å†µï¼ˆåŒ…æ‹¬å†…å­˜å’Œ CPUï¼‰ã€æ“ä½œç³»ç»Ÿä¿¡æ¯ç­‰ã€‚åˆ©ç”¨è¿™äº›ä¿¡æ¯ï¼Œä½ å¯ä»¥æ›´å‡†ç¡®åœ°å®šä½é—®é¢˜æ‰€åœ¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤æ‚çš„ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œè¿™å¯ä»¥å¸®åŠ©å¿«é€Ÿè¯Šæ–­é—®é¢˜ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶æŠ¥å‘Šéå¸¸æœ‰ç”¨ï¼Œä½†æ˜¯å®ƒåŒ…å«äº†å…³äºåº”ç”¨å’Œç¯å¢ƒçš„è¯¦ç»†ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨å¤„ç†æ•æ„Ÿæ•°æ®æ—¶è¦å°å¿ƒè°¨æ…ï¼Œé¿å…æ³„éœ²éšç§ä¿¡æ¯ã€‚</p><h3 id="r-require-module" tabindex="-1"><a class="header-anchor" href="#r-require-module"><span><a href="https://nodejs.org/docs/latest/api/cli.html#-r---require-module" target="_blank" rel="noopener noreferrer">-r, --require module</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>-r</code> æˆ–è€… <code>--require</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼ˆCLIï¼‰ï¼Œå®ƒå…è®¸ä½ åœ¨å®é™…è¿è¡Œä½ çš„ä¸»åº”ç”¨ç¨‹åºä»£ç ä¹‹å‰å…ˆé¢„åŠ è½½ä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡å—ã€‚å½“ä½ ä½¿ç”¨è¿™ä¸ªé€‰é¡¹æ—¶ï¼ŒNode.js ä¼šåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­æœ€æ—©çš„é˜¶æ®µè½½å…¥æŒ‡å®šçš„æ¨¡å—ã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯"><span>ä½¿ç”¨åœºæ™¯ï¼š</span></a></h3><ol><li><p><strong>è®¾ç½®ç¯å¢ƒ</strong>ï¼šæ¯”å¦‚ä½ æƒ³è¦åœ¨ä½ çš„åº”ç”¨å¼€å§‹è¿è¡Œå‰è®¾ç½®ç¯å¢ƒå˜é‡æˆ–è¿›è¡Œä¸€äº›å…¨å±€é…ç½®ã€‚</p></li><li><p><strong>Polyfills</strong>: å¦‚æœä½ éœ€è¦æŸäº›ä¸æ˜¯å†…å»ºåœ¨ä½ å½“å‰ç‰ˆæœ¬çš„ Node.js ä¸­çš„åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡é¢„åŠ è½½ä¸€ä¸ª polyfill æ¥æ·»åŠ è¿™äº›ç‰¹æ€§ã€‚</p></li><li><p><strong>é’©å­å’Œæ’ä»¶</strong>: åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½ä½ æƒ³è¦åŠ è½½ä¸€äº›é’©å­æ¥ä¿®æ”¹åŸç”Ÿå¯¹è±¡çš„è¡Œä¸ºï¼Œæˆ–è€…æä¾›ä¸€äº›åœ¨å®é™…åº”ç”¨è¿è¡Œå‰å°±éœ€è¦çš„æ’ä»¶åŠŸèƒ½ã€‚</p></li><li><p><strong>è°ƒè¯•å’Œæµ‹è¯•</strong>: å½“è¿›è¡Œè°ƒè¯•æˆ–æµ‹è¯•æ—¶ï¼Œä½ å¯èƒ½æƒ³è¦é¢„åŠ è½½ä¸€äº›å·¥å…·æ¥å¸®åŠ©ç›‘æ§ä½ çš„åº”ç”¨è¡¨ç°æˆ–å¤„ç†æµ‹è¯•è®¾ç½®ã€‚</p></li></ol><h3 id="å®é™…ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-4"><span>å®é™…ä¾‹å­ï¼š</span></a></h3><ol><li><strong>ç¯å¢ƒè®¾ç½®</strong>: æ¯”å¦‚è¯´ï¼Œä½ æœ‰ä¸€ä¸ªå«åš <code>dotenv</code> çš„æ¨¡å—ï¼Œå®ƒç”¨äºä» <code>.env</code> æ–‡ä»¶ä¸­åŠ è½½é…ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­ã€‚ä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ <code>-r</code> é€‰é¡¹:</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dotenv/config</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤ä¼šåœ¨å¯åŠ¨ <code>your-app.js</code> ä¹‹å‰åŠ è½½ <code>dotenv</code> æ¨¡å—ï¼Œå¹¶å°† <code>.env</code> æ–‡ä»¶ä¸­çš„é…ç½®å¯¼å…¥ç¯å¢ƒå˜é‡ã€‚</p><ol start="2"><li><strong>åŠ è½½ babel-polyfill</strong>: å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ Babel æ¥æ”¯æŒ ES6+ çš„æ–°ç‰¹æ€§ã€‚ä½ å¯ä»¥åœ¨è¿è¡Œä½ çš„ Node åº”ç”¨ä¹‹å‰é¢„åŠ è½½è¿™ä¸ª polyfill:</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> babel-register</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> babel-polyfill</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-es6-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="3"><li><strong>ä½¿ç”¨ä¸“é—¨çš„æµ‹è¯•å·¥å…·</strong>: å¦‚æœä½ åœ¨åšå•å…ƒæµ‹è¯•ï¼Œå¯èƒ½ä¼šä½¿ç”¨åƒ <code>mocha</code> è¿™æ ·çš„æµ‹è¯•æ¡†æ¶ã€‚è€Œ <code>mocha</code> å…è®¸ä½ é¢„åŠ è½½æ¨¡å—ï¼Œè¿™å¯ä»¥é€šè¿‡ <code>-r</code> é€‰é¡¹å®Œæˆ:</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mocha</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> chai/register-expect</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tests.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä»¥ä¸Šä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•åœ¨å®é™…æ‰§è¡Œæµ‹è¯•æ–‡ä»¶ <code>tests.js</code> ä¹‹å‰ï¼ŒåŠ è½½ <code>chai</code> æ–­è¨€åº“ä¸­çš„ <code>expect</code> æ¥å£ã€‚</p><p>ä½¿ç”¨ <code>-r</code> é€‰é¡¹çš„ä¸»è¦å¥½å¤„æ˜¯å¯ä»¥åœ¨ä½ çš„åº”ç”¨ä»£ç æ‰§è¡Œä¹‹å‰å…ˆè®¾ç½®å¥½ç¯å¢ƒï¼Œç¡®ä¿æ‰€æœ‰å¿…é¡»çš„æ¨¡å—éƒ½å·²ç»åŠ è½½å¹¶ä¸”å¯ç”¨ã€‚è¿™ä½¿å¾—ä½ èƒ½å¤Ÿç¼–å†™æ›´åŠ å¹²å‡€å’Œæ¨¡å—åŒ–çš„ä»£ç ï¼Œå› ä¸ºä½ ä¸éœ€è¦åœ¨ä½ çš„æ¯ä¸ªæ–‡ä»¶ä¸­é‡å¤å¯¼å…¥ç›¸åŒçš„æ¨¡å—æˆ–é…ç½®ã€‚</p><h3 id="secure-heap-n" tabindex="-1"><a class="header-anchor" href="#secure-heap-n"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--secure-heapn" target="_blank" rel="noopener noreferrer">--secure-heap=n</a></span></a></h3><p><code>--secure-heap=n</code> æ˜¯ Node.js è¿è¡Œæ—¶çš„ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨äºåœ¨å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶é…ç½®å®‰å…¨å †çš„å¤§å°ã€‚è¿™ä¸ªé€‰é¡¹ä¸»è¦æ˜¯ä¸ºäº†å¢å¼ºåº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚</p><p>é¦–å…ˆæ¥ç†è§£ä¸€ä¸‹â€œå †â€ï¼ˆheapï¼‰è¿™ä¸ªæ¦‚å¿µã€‚åœ¨è®¡ç®—æœºå†…å­˜ç®¡ç†ä¸­ï¼Œå †æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨å¯¹è±¡å’Œå˜é‡çš„å†…å­˜åŒºåŸŸï¼Œç¨‹åºå¯ä»¥åŠ¨æ€åœ°åˆ†é…å’Œé‡Šæ”¾å…¶ä¸­çš„ç©ºé—´ã€‚ä¸å †ç›¸å¯¹çš„æ˜¯æ ˆï¼ˆstackï¼‰ï¼Œå®ƒé€šå¸¸ç”¨æ¥å­˜å‚¨å‡½æ•°è°ƒç”¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ä»¥åŠå±€éƒ¨å˜é‡ã€‚</p><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯â€œå®‰å…¨å †â€ï¼ˆsecure heapï¼‰å‘¢ï¼Ÿå®‰å…¨å †æ˜¯ä¸“é—¨è®¾è®¡ç”¨æ¥å­˜å‚¨æ•æ„Ÿæ•°æ®ï¼ˆæ¯”å¦‚å¯†ç ã€å¯†é’¥ç­‰ï¼‰çš„å†…å­˜åŒºåŸŸã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯åœ¨ä½¿ç”¨åä¼šè¢«æ¸…é™¤æˆ–é”€æ¯ï¼Œé˜²æ­¢æ•æ„Ÿä¿¡æ¯è¢«æœªæˆæƒè®¿é—®ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®‰å…¨å †è¿˜ä¼šä½¿ç”¨åŠ å¯†æˆ–å…¶ä»–ä¿æŠ¤æªæ–½æ¥å¢å¼ºå®‰å…¨æ€§ã€‚</p><p>å½“ä½ åœ¨å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨ <code>--secure-heap=n</code> é€‰é¡¹ï¼Œä½ å®é™…ä¸Šæ˜¯æŒ‡å®šäº†å®‰å…¨å †çš„å¤§å°ï¼Œå•ä½ä¸ºå­—èŠ‚ã€‚å‚æ•° <code>n</code> å°±æ˜¯ä½ æƒ³è¦è®¾ç½®çš„å®‰å…¨å †çš„å¤§å°ã€‚ä¾‹å¦‚ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node --secure-heap=8192 your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¸ªå‘½ä»¤å°†ä¸ºä½ çš„ Node.js åº”ç”¨ç¨‹åº <code>your-app.js</code> åˆ†é… 8192 å­—èŠ‚ï¼ˆä¹Ÿå°±æ˜¯ 8KBï¼‰çš„å®‰å…¨å †ç©ºé—´ã€‚è¿™æ„å‘³ç€ä½ çš„åº”ç”¨ç¨‹åºå¯ä»¥åœ¨è¿™å—ä¸“é—¨çš„å†…å­˜åŒºåŸŸä¸­å­˜å‚¨æ•æ„Ÿæ•°æ®ï¼Œå¹¶ä¸”å¸Œæœ›è¿™éƒ¨åˆ†å†…å­˜åœ¨ä¸å†éœ€è¦çš„æ—¶å€™æ›´å®‰å…¨åœ°å¤„ç†ã€‚</p><p>å®é™…è¿ç”¨çš„ä¾‹å­å¯èƒ½æ¶‰åŠåŠ å¯†åº“çš„ä½¿ç”¨ï¼Œæ¯”å¦‚åœ¨å¤„ç†åŠ å¯†æ“ä½œæ—¶ï¼Œç›¸å…³çš„å¯†é’¥å’Œæ•æ„Ÿä¿¡æ¯éƒ½å¯ä»¥å­˜å‚¨åœ¨å®‰å…¨å †ä¸­ã€‚è¿™æ ·å³ä½¿ç³»ç»Ÿå…¶å®ƒéƒ¨åˆ†å‡ºç°å®‰å…¨æ¼æ´ï¼Œå­˜å‚¨åœ¨å®‰å…¨å †ä¸­çš„æ•°æ®ä¹Ÿæœ‰æ›´é«˜æœºç‡ä¸è¢«æ³„éœ²ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>--secure-heap=n</code> é€‰é¡¹å¹¶ä¸å¸¸è§ï¼Œè€Œä¸”åœ¨ç¼–å†™æ™®é€šçš„ Web åº”ç”¨æˆ– API æœåŠ¡æ—¶å¾ˆå°‘ç›´æ¥ä½¿ç”¨åˆ°ã€‚é€šå¸¸ï¼ŒNode.js çš„æ ¸å¿ƒæ¨¡å—å’Œç¬¬ä¸‰æ–¹åŠ å¯†æ¨¡å—å·²ç»åŒ…å«äº†å¿…è¦çš„å®‰å…¨æ€§è€ƒè™‘ï¼Œå¼€å‘è€…æ— éœ€é¢å¤–é…ç½®å®‰å…¨å †ã€‚å¦‚æœä½ åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ç¡®å®éœ€è¦æ›´é«˜çº§çš„å®‰å…¨æ€§é…ç½®ï¼Œé€šå¸¸å»ºè®®æŸ¥é˜…ç›¸å…³æ¨¡å—çš„æ–‡æ¡£æˆ–å¯»æ±‚ä¸“ä¸šå®‰å…¨äººå‘˜çš„å»ºè®®ã€‚</p><h3 id="secure-heap-min-n" tabindex="-1"><a class="header-anchor" href="#secure-heap-min-n"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--secure-heap-minn" target="_blank" rel="noopener noreferrer">--secure-heap-min=n</a></span></a></h3><p>Node.js ä¸­çš„ <code>--secure-heap-min=n</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨äºé…ç½®æ‰€è°“çš„â€œå®‰å…¨å †â€(secure heap) çš„æœ€å°å¤§å°ã€‚ä¸ºäº†ç†è§£è¿™ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ä¸€äº›èƒŒæ™¯ä¿¡æ¯ã€‚</p><p>åœ¨ç¼–ç¨‹ä¸­ï¼Œ&quot;å †&quot;ï¼ˆheapï¼‰é€šå¸¸æŒ‡çš„æ˜¯ä¸€ç§åŠ¨æ€åˆ†é…å†…å­˜çš„åŒºåŸŸï¼Œè€Œä¸æ˜¯ç¨‹åºå¼€å§‹æ—¶å°±å›ºå®šå¤§å°çš„æ ˆå†…å­˜(stack memory)ã€‚å¼€å‘è€…å¯ä»¥åœ¨è¿è¡ŒæœŸé—´ä»å †ä¸­åˆ†é…æˆ–é‡Šæ”¾å†…å­˜æ¥å­˜å‚¨æ•°æ®ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬èŠèŠâ€œå®‰å…¨å †â€ã€‚å®‰å…¨å †æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å †å†…å­˜ï¼ŒNode.js ç”¨å®ƒæ¥å­˜æ”¾åŠ å¯†æ“ä½œä¸­çš„æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚å¯†ç ã€ç§é’¥ç­‰ã€‚è¯¥éƒ¨åˆ†å†…å­˜è¢«è®¾è®¡æˆè¦å°½é‡å®‰å…¨ï¼Œä»¥é˜²æ­¢å¯èƒ½çš„å†…å­˜æ³„éœ²å’Œå…¶ä»–å®‰å…¨é—®é¢˜ã€‚</p><p><code>--secure-heap-min=n</code> è¿™ä¸ªå‚æ•°å…è®¸ä½ è®¾ç½®å®‰å…¨å †çš„æœ€å°å­—èŠ‚å¤§å°ã€‚å…¶ä¸­ <code>n</code> å°±æ˜¯ä½ æƒ³è¦è®¾ç½®çš„å­—èŠ‚æ•°ã€‚é€šè¿‡è¿™ä¸ªé€‰é¡¹ï¼Œä½ å¯ä»¥ç¡®ä¿å³ä½¿æ˜¯åœ¨å†…å­˜è´Ÿè½½è¾ƒä½çš„æƒ…å†µä¸‹ï¼Œä¹Ÿæœ‰è¶³å¤Ÿçš„å®‰å…¨å †ç©ºé—´å¯ç”¨äºå¤„ç†æ•æ„Ÿæ•°æ®ã€‚</p><h3 id="å®è·µä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®è·µä¾‹å­"><span>å®è·µä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªä½¿ç”¨ Node.js çš„ Web æœåŠ¡ï¼Œè¯¥æœåŠ¡éœ€è¦å¤„ç†ç”¨æˆ·çš„æ”¯ä»˜ä¿¡æ¯ã€‚å› ä¸ºæ¶‰åŠåˆ°é‡‘èæ•°æ®ï¼Œè¿™äº›ä¿¡æ¯åº”è¯¥æ˜¯é«˜åº¦ä¿å¯†çš„ã€‚</p><ol><li><p><strong>å¯åŠ¨å¸¦æœ‰å®‰å…¨å †çš„ Node.js åº”ç”¨ç¨‹åºï¼š</strong></p><p>å‡è®¾ä½ æƒ³è¦ç¡®ä¿è‡³å°‘æœ‰ 4 MB (å³ 4 _ 1024 _ 1024 å­—èŠ‚) çš„å®‰å…¨å †ç©ºé—´ã€‚å½“ä½ å¯åŠ¨ä½ çš„ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œä½ ä¼šåœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --secure-heap-min=4194304</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œï¼Œ<code>app.js</code> æ˜¯ä½ çš„ä¸»åº”ç”¨ç¨‹åºæ–‡ä»¶ï¼Œè€Œ <code>4194304</code> æ˜¯ 4 MB ç©ºé—´å¯¹åº”çš„å­—èŠ‚æ•°ã€‚</p></li><li><p><strong>å¤„ç†æ•æ„Ÿä¿¡æ¯ï¼š</strong></p><p>åœ¨ä½ çš„ä»£ç ä¸­ï¼Œå½“ä½ éœ€è¦å¤„ç†ä¾‹å¦‚ç”¨æˆ·çš„ä¿¡ç”¨å¡ä¿¡æ¯æ—¶ï¼Œè¿™äº›æ•°æ®å°†ä¼šè¢«å­˜å‚¨åœ¨ç”± Node.js ç®¡ç†çš„å®‰å…¨å †å†…å­˜ä¸­ã€‚æ­¤æ—¶ï¼Œå³ä½¿æ˜¯é€šè¿‡æŸç§æ–¹å¼è·å–äº†åº”ç”¨ç¨‹åºçš„å†…å­˜å¿«ç…§ï¼ˆmemory dumpï¼‰ï¼Œé»‘å®¢ä¹Ÿå¾ˆéš¾ä»ä¸­æå–å‡ºæ•æ„Ÿä¿¡æ¯ã€‚</p></li><li><p><strong>è°ƒä¼˜æ€§èƒ½å’Œå®‰å…¨æ€§ï¼š</strong></p><p>å¦‚æœä½ æ³¨æ„åˆ°åº”ç”¨ç¨‹åºåœ¨åŠ å¯†ä»»åŠ¡ä¸Šè¡¨ç°ä¸ä½³ï¼Œä½ å¯èƒ½éœ€è¦å¢åŠ å®‰å…¨å €çš„å¤§å°ï¼Œä»¥æä¾›æ›´å¤šçš„å†…å­˜ç»™è¿™äº›æ“ä½œã€‚åŒæ ·åœ°ï¼Œå¦‚æœä½ çš„æœåŠ¡å™¨èµ„æºæœ‰é™ï¼Œä½ å¯èƒ½éœ€è¦å‡å°‘è¿™ä¸ªå€¼ï¼Œä½†åŒæ—¶è¦æ„è¯†åˆ°è¿™å¯èƒ½ä¼šå½±å“åˆ°å®‰å…¨æ€§ã€‚</p></li></ol><p>è¯·æ³¨æ„ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ Node.js åº”ç”¨éƒ½éœ€è¦é…ç½®å®‰å…¨å †ã€‚è¿™æ˜¯ä¸€ä¸ªé«˜çº§åŠŸèƒ½ï¼Œä¸»è¦é’ˆå¯¹é‚£äº›éœ€è¦é¢å¤–å®‰å…¨æªæ–½æ¥å¤„ç†æ•æ„Ÿæ•°æ®çš„åœºæ™¯ã€‚å¦‚æœä½ çš„åº”ç”¨ç¨‹åºä¸æ¶‰åŠæ•æ„Ÿä¿¡æ¯å¤„ç†ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¸éœ€è¦æ‹…å¿ƒè¿™ä¸ªé…ç½®é€‰é¡¹ã€‚</p><h3 id="snapshot-blob-path" tabindex="-1"><a class="header-anchor" href="#snapshot-blob-path"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--snapshot-blobpath" target="_blank" rel="noopener noreferrer">--snapshot-blob=path</a></span></a></h3><p>Node.js ä¸­çš„ <code>--snapshot-blob=path</code> è¿™ä¸ªå‘½ä»¤è¡Œé€‰é¡¹æ˜¯ç”¨æ¥æŒ‡å®šä¸€ä¸ªå¿«ç…§æ–‡ä»¶çš„è·¯å¾„ï¼Œè¿™ä¸ªå¿«ç…§æ–‡ä»¶åŒ…å«äº† Node.js è¿›ç¨‹å¯åŠ¨æ—¶å°±åŠ è½½çš„ V8 å¼•æ“å†…å­˜å¿«ç…§ã€‚åœ¨æ­¤ä¸Šä¸‹æ–‡ä¸­ï¼Œâ€œå¿«ç…§â€æŒ‡çš„æ˜¯ä¸€ç§å¯ä»¥è®©ä½ ä¿å­˜å’Œé‡ç”¨ JavaScript VMï¼ˆè™šæ‹Ÿæœºï¼‰çŠ¶æ€çš„æŠ€æœ¯ã€‚</p><p>è®©æˆ‘ä»¬åˆ†æ­¥éª¤è§£é‡Šè¿™ä¸ªç‰¹æ€§ï¼š</p><ol><li><p><strong>V8 å¼•æ“ä¸å†…å­˜å¿«ç…§ (Snapshot)</strong>ï¼š</p><ul><li>V8 æ˜¯ Google å¼€å‘çš„å¼€æº JavaScript å¼•æ“ï¼Œå®ƒåœ¨ Node.js å’Œ Chrome æµè§ˆå™¨ä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚</li><li>å†…å­˜å¿«ç…§æ˜¯ V8 å¼•æ“åœ¨æŸä¸€æ—¶åˆ»çš„å†…å­˜çŠ¶æ€çš„åºåˆ—åŒ–è¡¨ç¤ºã€‚é€šè¿‡åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œä½ å¯ä»¥æ•è·ä¸€ç»„é¢„å…ˆåŠ è½½å’Œé¢„ç¼–è¯‘çš„ä»£ç ï¼Œä»¥åŠåœ¨æ‰§è¡Œè¿™äº›ä»£ç æ—¶ç”Ÿæˆçš„å„ç§å¯¹è±¡å’Œå‡½æ•°çŠ¶æ€ã€‚</li></ul></li><li><p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨å¿«ç…§ï¼Ÿ</strong>ï¼š</p><ul><li>ä½¿ç”¨å¿«ç…§çš„ä¸€ä¸ªä¸»è¦ä¼˜åŠ¿æ˜¯æé«˜å¯åŠ¨é€Ÿåº¦ã€‚å½“ä½ ä½¿ç”¨äº†ä¸€ä¸ªå¿«ç…§ï¼ŒNode.js åœ¨å¯åŠ¨æ—¶ä¸éœ€è¦é‡æ–°ç¼–è¯‘å’Œæ‰§è¡Œæ‰€æœ‰çš„åˆå§‹åŒ–ä»£ç ï¼Œå› ä¸ºè¿™äº›éƒ½å·²ç»åœ¨å¿«ç…§ä¸­å®Œæˆäº†ã€‚è¿™å¯¹äºå¤§å‹åº”ç”¨æˆ–è€…å·¥å…·ï¼ˆæ¯”å¦‚ CLI å·¥å…·ï¼‰æ¥è¯´ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºä»–ä»¬å¯èƒ½æœ‰å¤§é‡çš„å¯åŠ¨è„šæœ¬ã€‚</li></ul></li><li><p><strong>å¦‚ä½•ä½¿ç”¨ <code>--snapshot-blob=path</code></strong>ï¼š</p><ul><li>é€šè¿‡è¿™ä¸ªé€‰é¡¹ï¼Œä½ å¯ä»¥å‘Šè¯‰ Node.js åœ¨å¯åŠ¨æ—¶ä»æŒ‡å®šè·¯å¾„åŠ è½½ä¸€ä¸ªå¿«ç…§æ–‡ä»¶ã€‚è¿™ä¸ªè·¯å¾„æ˜¯å¿«ç…§æ–‡ä»¶çš„ä½ç½®ã€‚</li></ul></li><li><p><strong>å®é™…ä½¿ç”¨çš„ä¾‹å­</strong>ï¼š</p><p>å‡è®¾ä½ å·²ç»æœ‰äº†ä¸€ä¸ªåä¸º <code>snapshot.blob</code> çš„å¿«ç…§æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ä½ ä¹‹å‰åˆ›å»ºå¹¶ä¿å­˜äº†ä½ åº”ç”¨çš„åˆå§‹åŒ–çŠ¶æ€ã€‚</p><p>å½“ä½ æƒ³è¦å¯åŠ¨ä½ çš„ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --snapshot-blob=snapshot.blob</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤ä¼šå‘Šè¯‰ Node.js å¯åŠ¨æ—¶ä» <code>snapshot.blob</code> æ–‡ä»¶ä¸­åŠ è½½å†…å­˜å¿«ç…§ã€‚é‚£ä¹ˆå®ƒå°†ä¼šåŠ è½½è¯¥å¿«ç…§ï¼Œå¹¶ä¸”ç«‹å³æä¾›é‚£ä¸ªçŠ¶æ€ä¸‹çš„ç¯å¢ƒç»™ä½ çš„ <code>your-script.js</code> è„šæœ¬ï¼Œè¿™æ ·ä½ çš„è„šæœ¬å°±èƒ½ç›´æ¥ä½¿ç”¨å¿«ç…§ä¸­çš„ä»£ç å’Œæ•°æ®ç»“æ„ï¼Œä»è€Œå‡å°‘å¯åŠ¨æ—¶é—´ã€‚</p></li><li><p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p><ul><li>åˆ›å»ºå¿«ç…§æ˜¯ä¸€ä¸ªç›¸å¯¹é«˜çº§çš„æ“ä½œï¼Œé€šå¸¸éœ€è¦æ·±å…¥äº†è§£ V8 å’Œ Node.js çš„å·¥ä½œåŸç†ã€‚</li><li>å¿«ç…§åº”è¯¥ä¸ç”Ÿæˆå®ƒä»¬çš„ Node.js ç‰ˆæœ¬å…¼å®¹ã€‚å¦‚æœ Node.js ç‰ˆæœ¬æ›´æ–°äº†ï¼Œæ—§çš„å¿«ç…§å¯èƒ½ä¸å†é€‚ç”¨ã€‚</li></ul></li></ol><p>ç»¼ä¸Šæ‰€è¿°ï¼Œ<code>--snapshot-blob=path</code> è®©é«˜çº§ç”¨æˆ·å¯ä»¥ä¼˜åŒ–å¯åŠ¨æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨é‚£äº›å¯åŠ¨æ€§èƒ½å¾ˆå…³é”®çš„åœºæ™¯ã€‚ç„¶è€Œï¼Œè¿™ä¸ªåŠŸèƒ½çš„ä½¿ç”¨é—¨æ§›è¾ƒé«˜ï¼Œå› ä¸ºå®ƒæ¶‰åŠåˆ°å¯¹ Node.js å†…éƒ¨å·¥ä½œæœºåˆ¶çš„æ·±å…¥ç†è§£ã€‚</p><h3 id="test" tabindex="-1"><a class="header-anchor" href="#test"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--test" target="_blank" rel="noopener noreferrer">--test</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ <code>--test</code> è¿™ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>--test</code> å‘½ä»¤è¡Œé€‰é¡¹æ˜¯ç”¨æ¥å¯åŠ¨ V8 å¼•æ“çš„æµ‹è¯•åŠŸèƒ½ã€‚è¿™ä¸ªé€‰é¡¹å¹¶ä¸æ˜¯ç»™æ™®é€šå¼€å‘è€…ä½¿ç”¨çš„ï¼Œè€Œæ˜¯ä¸ºäº†å¸®åŠ© Node.js çš„è´¡çŒ®è€…å’Œå¼€å‘è€…è¿›è¡Œåº•å±‚çš„ JavaScript å¼•æ“æµ‹è¯•ã€‚å½“ä½ åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ Node.js æ—¶ï¼ŒåŠ ä¸Š <code>--test</code> å‚æ•°åï¼ŒNode.js å°†ä»¥ä¸€ç§ç‰¹åˆ«çš„æ¨¡å¼è¿è¡Œï¼Œè¿™ç§æ¨¡å¼ä¼šè§¦å‘ V8 å¼•æ“å†…éƒ¨çš„ä¸€äº›æµ‹è¯•ç”¨ä¾‹ã€‚</p><p>ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œå¯¹äºå¤§å¤šæ•° Node.js ç”¨æˆ·æ¥è¯´ï¼Œä»–ä»¬ç”¨ä¸åˆ° <code>--test</code> é€‰é¡¹ã€‚æ­£å¸¸çš„åº”ç”¨å¼€å‘å’Œæµ‹è¯•ä¸éœ€è¦ä½¿ç”¨åˆ°å®ƒã€‚å› æ­¤ï¼Œå¦‚æœä½ æ˜¯ç¼–ç¨‹æ–°æ‰‹ï¼Œä½ å¯èƒ½æ°¸è¿œéƒ½ç”¨ä¸åˆ°è¿™ä¸ªå‘½ä»¤ã€‚</p><p>å³ä¾¿å¦‚æ­¤ï¼Œæˆ‘è¿˜æ˜¯ä¸¾ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜å…¶ç”¨æ³•ï¼Œä½†è¯·è®°ä½è¿™åªæ˜¯ä¸ºäº†å±•ç¤ºï¼š</p><p>å‡è®¾ä½ åœ¨ Node.js çš„æºç ä¸­å·¥ä½œï¼Œä½ æƒ³è¦ç¡®ä¿ä¿®æ”¹åçš„ä»£ç æ²¡æœ‰ç ´å V8 å¼•æ“çš„æŸäº›å†…éƒ¨æœºåˆ¶ã€‚é‚£ä¹ˆä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¿™æ ·è¿è¡Œ Node.jsï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --test</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤ä¼šå¯åŠ¨ Node.jsï¼Œå¹¶å‘Šè¯‰ V8 å¼•æ“è¿è¡Œå…¶å†…ç½®çš„æµ‹è¯•å¥—ä»¶ã€‚è¿™äº›æµ‹è¯•å°†ä¼šæ‰§è¡Œï¼Œå¹¶ç»™å‡ºé€šè¿‡æˆ–å¤±è´¥çš„ç»“æœã€‚å¦‚æœæ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡ï¼Œè¿™è¡¨æ˜ä½ çš„æ›´æ”¹å¾ˆå¯èƒ½æ²¡æœ‰ç ´åå¼•æ“çš„æ ¸å¿ƒåŠŸèƒ½ã€‚</p><p>å†æ¬¡å¼ºè°ƒï¼Œæ™®é€šç”¨æˆ·ä¸éœ€è¦ä¹Ÿä¸åº”è¯¥ä½¿ç”¨ <code>--test</code> é€‰é¡¹ã€‚è¿™ä¸ªé€‰é¡¹ä¸»è¦æ˜¯ä¸ºäº† Node.js å’Œ V8 å¼•æ“çš„ç»´æŠ¤è€…è®¾è®¡çš„ã€‚</p><p>ä½œä¸ºä¸€ä¸ªç¼–ç¨‹æ–°æ‰‹ï¼Œä½ æ›´å¤šçš„ä¼šæ¥è§¦åˆ°å…¶ä»–å‘½ä»¤è¡Œé€‰é¡¹ï¼Œæ¯”å¦‚ <code>--version</code> æ¥æŸ¥çœ‹ Node.js çš„ç‰ˆæœ¬ï¼Œæˆ–è€… <code>--help</code> æ¥è·å–å¯ç”¨å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ã€‚å¼€å‘æ—¶ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨<code>npm test</code>æ¥è¿è¡Œä½ åº”ç”¨ä¸­çš„æµ‹è¯•ï¼Œè¿™äº›æµ‹è¯•æ˜¯ç”±ä½ è‡ªå·±æˆ–ä½ çš„å›¢é˜Ÿç¼–å†™çš„ï¼Œç”¨äºç¡®ä¿ä½ çš„ä»£ç æŒ‰é¢„æœŸå·¥ä½œã€‚</p><p>æ€»ä¹‹ï¼Œ<code>--test</code> æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äº Node.js å†…éƒ¨å¼€å‘çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œæ™®é€šå¼€å‘è€…å‡ ä¹ä¸ä¼šç”¨åˆ°å®ƒã€‚ä½ ä½œä¸ºç¼–ç¨‹æ–°æ‰‹ï¼Œå¯ä»¥ä¸“æ³¨äºå­¦ä¹  Node.js çš„åŸºç¡€çŸ¥è¯†å’Œå¼€å‘æŠ€èƒ½ï¼Œæ¯”å¦‚åˆ›å»ºæœåŠ¡å™¨ã€å¤„ç† HTTP è¯·æ±‚ç­‰ã€‚</p><h3 id="test-concurrency" tabindex="-1"><a class="header-anchor" href="#test-concurrency"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--test-concurrency" target="_blank" rel="noopener noreferrer">--test-concurrency</a></span></a></h3><p>Node.js ä¸­çš„ <code>--test-concurrency</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰é€‰é¡¹ï¼Œç”¨äºè®¾ç½®åœ¨è¿è¡Œ Node.js çš„è‡ªå¸¦æµ‹è¯•å¥—ä»¶æ—¶å¯ä»¥å¹¶å‘æ‰§è¡Œçš„æµ‹è¯•æ•°é‡ã€‚è¿™ä¸ªé€‰é¡¹ä¸»è¦ç”¨äº Node.js è‡ªå·±çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ™®é€šç”¨æˆ·å’Œå¼€å‘è€…ä¸€èˆ¬ä¸ä¼šç”¨åˆ°è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>é¦–å…ˆï¼Œéœ€è¦äº†è§£çš„æ˜¯ï¼Œå¹¶å‘ï¼ˆConcurrencyï¼‰æ˜¯æŒ‡è®¡ç®—æœºåŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡çš„èƒ½åŠ›ã€‚åœ¨æµ‹è¯•åœºæ™¯ä¸­ï¼Œå¹¶å‘æ‰§è¡Œé€šå¸¸æ„å‘³ç€åŒæ—¶è¿è¡Œå¤šä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œç›®çš„æ˜¯ä¸ºäº†å‡å°‘æ•´ä½“çš„æµ‹è¯•æ—¶é—´ã€‚</p><p>ä¸¾ä¸ªå®é™…çš„ä¾‹å­ï¼š</p><p>å‡è®¾ä½ æ˜¯ Node.js çš„ä¸€ä¸ªè´¡çŒ®è€…æˆ–è€…ä½ æ­£åœ¨ä¸º Node.js ç¼–å†™è‡ªå®šä¹‰çš„æµ‹è¯•ç”¨ä¾‹ã€‚ä½ æƒ³è¦å¿«é€Ÿåœ°è¿è¡Œå…¨éƒ¨çš„æµ‹è¯•ï¼Œä»¥ç¡®ä¿ä½ çš„ä»£ç æ›´æ”¹æ²¡æœ‰å¼•å…¥ä»»ä½•é”™è¯¯ã€‚æ­¤æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>--test-concurrency</code> é€‰é¡¹æ¥æé«˜æµ‹è¯•çš„æ•ˆç‡ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªå››æ ¸çš„ CPUï¼Œå¹¶å¸Œæœ›æ¯ä¸ªæ ¸å¿ƒåŒæ—¶å¤„ç†ä¸€ä¸ªæµ‹è¯•ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·è¿è¡Œ Node.js çš„æµ‹è¯•ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test.js</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --test-concurrency=4</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¸Šè¿°å‘½ä»¤å°†åŒæ—¶è¿è¡Œå››ä¸ªæµ‹è¯•ï¼Œæ¯ä¸ªæµ‹è¯•å ç”¨ä¸€ä¸ª CPU æ ¸å¿ƒã€‚å¦‚æœä½ ä¸è®¾ç½®è¯¥é€‰é¡¹ï¼ŒNode.js å¯èƒ½ä¼šé»˜è®¤ä»¥ä¸²è¡Œæ–¹å¼è¿è¡Œæµ‹è¯•ï¼Œå³ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ‰§è¡Œï¼Œä»è€Œå¯¼è‡´æµ‹è¯•æ—¶é—´è¾ƒé•¿ã€‚</p><p>å†è¯´æ˜ä¸€ä¸‹ï¼Œ<code>--test-concurrency</code> å¹¶ä¸æ˜¯ç”¨äºæé«˜ä½ çš„æ—¥å¸¸ Node.js åº”ç”¨ç¨‹åºæ€§èƒ½çš„é€‰é¡¹ï¼Œå®ƒæ˜¯ä¸“é—¨ä¸ºäº†æ§åˆ¶ Node.js è‡ªå¸¦æµ‹è¯•å¥—ä»¶çš„å¹¶å‘æ‰§è¡Œè€Œè®¾è®¡çš„ã€‚æ‰€ä»¥ï¼Œå¯¹äºå¤§å¤šæ•°ç¼–ç¨‹æ–°æ‰‹æ¥è¯´ï¼Œä½ å¯èƒ½æ°¸è¿œéƒ½ä¸éœ€è¦ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚å½“ç„¶ï¼Œå¦‚æœä½ å¯¹ Node.js å†…éƒ¨æ„Ÿå…´è¶£ï¼Œæƒ³è¦å‚ä¸åˆ° Node.js çš„å¼€å‘æˆ–è€…æµ‹è¯•å·¥ä½œä¸­ï¼Œé‚£ä¹ˆç†è§£å¹¶ä½¿ç”¨è¿™ä¸ªé€‰é¡¹å°±æ˜¾å¾—éå¸¸é‡è¦äº†ã€‚</p><h3 id="test-name-pattern" tabindex="-1"><a class="header-anchor" href="#test-name-pattern"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--test-name-pattern" target="_blank" rel="noopener noreferrer">--test-name-pattern</a></span></a></h3><p>Node.js çš„ <code>--test-name-pattern</code> æ˜¯ç”¨äº Node.js è‡ªèº«çš„æµ‹è¯•å¥—ä»¶çš„ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ã€‚Node.js æœ‰è‡ªå·±çš„ä¸€å¥—æµ‹è¯•ï¼Œæ¥ç¡®ä¿å®ƒçš„å„ä¸ªéƒ¨åˆ†éƒ½æŒ‰é¢„æœŸå·¥ä½œã€‚è¿™äº›æµ‹è¯•é€šå¸¸ç”±å¼€å‘è€…å’Œè´¡çŒ®è€…åœ¨åšæ›´æ”¹æˆ–è€…æ–°å¢åŠŸèƒ½æ—¶è¿è¡Œï¼Œä»¥ç¡®ä¿æ²¡æœ‰å¼•å…¥ä»»ä½•é”™è¯¯ã€‚</p><p>å½“ä½ è¿è¡Œ Node.js çš„æµ‹è¯•å¥—ä»¶æ—¶ï¼Œå¯èƒ½ä¼šå‘ç°æœ‰æˆç™¾ä¸Šåƒçš„æµ‹è¯•ç”¨ä¾‹ã€‚æœ‰æ—¶å€™ï¼Œä½ å¯èƒ½åªæƒ³è¦è¿è¡Œä¸€å°éƒ¨åˆ†ç›¸å…³çš„æµ‹è¯•ï¼Œå°¤å…¶æ˜¯å½“ä½ æ­£åœ¨å¼€å‘æˆ–è°ƒè¯•æŸä¸ªç‰¹å®šçš„åŠŸèƒ½æ—¶ã€‚è¿™æ—¶å€™ï¼Œ<code>--test-name-pattern</code> å‚æ•°å°±éå¸¸æœ‰ç”¨äº†ã€‚</p><p>ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‚æ•°æ¥æŒ‡å®šä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼ˆregexï¼‰ï¼Œæµ‹è¯•è¿è¡Œå™¨ï¼ˆtest runnerï¼‰å°†åªä¼šè¿è¡Œé‚£äº›åå­—åŒ¹é…è¿™ä¸ªæ¨¡å¼çš„æµ‹è¯•ã€‚</p><p>ä»¥ä¸‹æ˜¯å‡ ä¸ªå®é™…çš„è¿ç”¨ä¾‹å­ï¼š</p><p>ä¾‹å­ 1: å‡è®¾ä½ åªæƒ³è¿è¡Œæ‰€æœ‰ä¸ HTTP ç›¸å…³çš„æµ‹è¯•ç”¨ä¾‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tools/test.py</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --test-name-pattern</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;.*http.*&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™é‡Œ <code>.*http.*</code> æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œå®ƒä¼šåŒ¹é…ä»»ä½•åŒ…å« &quot;http&quot; æ–‡æœ¬çš„æµ‹è¯•ç”¨ä¾‹åç§°ã€‚</p><p>ä¾‹å­ 2: å¦‚æœä½ æ­£åœ¨ä¿®æ”¹ Node.js ä¸­çš„ Promise åŠŸèƒ½ï¼Œå¹¶ä¸”å¸Œæœ›ä»…è¿è¡Œä¸ Promise ç›¸å…³çš„æµ‹è¯•ï¼Œä½ å¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tools/test.py</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --test-name-pattern</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;.*promise.*&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¾‹å­ 3: ä¹Ÿè®¸ä½ å¯¹æŸä¸ªå…·ä½“çš„æµ‹è¯•ç”¨ä¾‹æ„Ÿå…´è¶£ï¼Œé‚£ä¸ªæµ‹è¯•ç”¨ä¾‹çš„åç§°åŒ…å« &quot;stream&quot;ï¼Œä½†æ˜¯åˆä¸åŒ…å« &quot;http&quot;ï¼Œä½ å¯ä»¥æ„é€ å¦‚ä¸‹çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tools/test.py</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --test-name-pattern</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;^((?!http).)*stream.*$&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ <code>--test-name-pattern</code> éœ€è¦ä½ æœ‰ Python ç¯å¢ƒï¼Œå¹¶ä¸”è¦åœ¨ Node.js æºç çš„æ ¹ç›®å½•ä¸‹ã€‚è¿™ä¸æ˜¯ç¼–å†™ Node.js åº”ç”¨æ—¶å¸¸ç”¨çš„åŠŸèƒ½ï¼Œå®ƒæ›´å¤šçš„æ˜¯ Node.js å¼€å‘è€…å†…éƒ¨ä½¿ç”¨çš„å·¥å…·ã€‚å¦‚æœä½ æ˜¯åœ¨å­¦ä¹ å¦‚ä½•å¼€å‘ Node.js åº”ç”¨ç¨‹åºï¼Œä½ å¯èƒ½ä¸éœ€è¦ç›´æ¥ä¸è¿™ä¸ªå‚æ•°æ‰“äº¤é“ã€‚</p><h3 id="test-only" tabindex="-1"><a class="header-anchor" href="#test-only"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--test-only" target="_blank" rel="noopener noreferrer">--test-only</a></span></a></h3><p>Node.js çš„ <code>--test-only</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼Œå®ƒç”¨äºåœ¨å¯åŠ¨ Node.js è¿›ç¨‹æ—¶å‘Šè¯‰ Node.js æ‰§è¡Œä¸€äº›ä¸“é—¨ä¸ºå†…éƒ¨æµ‹è¯•å‡†å¤‡çš„ä»£ç è·¯å¾„ã€‚è¿™ä¸ªæ ‡å¿—ä¸»è¦æ˜¯ Node.js çš„å¼€å‘è€…å’Œç»´æŠ¤è€…ä½¿ç”¨ï¼Œåœ¨æ—¥å¸¸å¼€å‘ä¸­å¾ˆå°‘ç”¨åˆ°ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œå½“ä½ åœ¨å‘½ä»¤è¡Œä¸­å¯åŠ¨ Node.js ç¨‹åºæ—¶ï¼Œé€šå¸¸ä¼šè¿™æ ·å†™ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> myScript.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœä½ æ·»åŠ äº† <code>--test-only</code> æ ‡å¿—ï¼Œé‚£ä¹ˆå‘½ä»¤çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --test-only</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> myScript.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åŠ ä¸Šè¿™ä¸ªæ ‡å¿—åï¼ŒNode.js ä¼šæ‰§è¡Œä¸€äº›é¢å¤–çš„æ£€æŸ¥æˆ–è€…è¿è¡Œä¸€äº›åªæœ‰åœ¨æµ‹è¯•ç¯å¢ƒä¸‹æ‰éœ€è¦è¿è¡Œçš„ä»£ç ã€‚è¿™å¯¹äºæ™®é€šç”¨æˆ·æ¥è¯´å¹¶ä¸é‡è¦ï¼Œå› ä¸ºå®ƒæ¶‰åŠåˆ° Node.js å†…éƒ¨çš„æµ‹è¯•æœºåˆ¶ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬å¹³æ—¶å¼€å‘ä¸­ç”¨åˆ°çš„åŠŸèƒ½ã€‚</p><p>å®é™…ä¾‹å­ï¼šå‡è®¾ä½ æ˜¯ Node.js çš„æ ¸å¿ƒå¼€å‘è€…ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªæ–°åŠŸèƒ½æˆ–ä¿®å¤ä¸€ä¸ª bugï¼Œå¹¶ä¸”ä¸ºæ­¤ç¼–å†™äº†ä¸€äº›æµ‹è¯•ä»£ç æ¥ç¡®ä¿ä½ çš„æ”¹åŠ¨ä¸ä¼šç ´åå…¶ä»–éƒ¨åˆ†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¼šåœ¨æœ¬åœ°æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ <code>--test-only</code> æ ‡å¿—æ¥ç¡®ä¿ä½ çš„æµ‹è¯•ä»£ç è¢«æ‰§è¡Œï¼Œå¹¶ä¸”èƒ½å¤ŸéªŒè¯ä½ æ‰€åšçš„æ”¹åŠ¨ã€‚</p><p>ä½†å¯¹äºä¸€èˆ¬çš„ Node.js ç”¨æˆ·æˆ–ç¼–ç¨‹æ–°æ‰‹æ¥è¯´ï¼Œä½ å¹¶ä¸éœ€è¦æ‹…å¿ƒè¿™ä¸ªæ ‡å¿—ï¼Œå› ä¸ºå®ƒä¸ä½ ç¼–å†™ Web åº”ç”¨ç¨‹åºã€API æˆ–ä»»ä½•å…¶ä»–å¸¸è§ Node.js é¡¹ç›®æ— å…³ã€‚è¿™ä¸ªæ ‡å¿—ä¸»è¦æ˜¯ä¸º Node.js çš„å†…éƒ¨æµ‹è¯•æµç¨‹è®¾è®¡çš„ï¼Œæ‰€ä»¥é™¤éä½ å‚ä¸åˆ° Node.js çš„è´¡çŒ®æˆ–è€…æ·±å…¥ç ”ç©¶ Node.js çš„å†…éƒ¨å·¥ä½œåŸç†ï¼Œå¦åˆ™ä½ å¯èƒ½æ°¸è¿œä¸ä¼šç”¨åˆ°å®ƒã€‚</p><h3 id="test-reporter" tabindex="-1"><a class="header-anchor" href="#test-reporter"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--test-reporter" target="_blank" rel="noopener noreferrer">--test-reporter</a></span></a></h3><p>Node.js v21.7.1 ä¸­çš„<code>--test-reporter</code>é€‰é¡¹æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰å‚æ•°ï¼Œå®ƒè¢«ç”¨äºåœ¨è¿è¡Œ Node.js å†…ç½®çš„æµ‹è¯•æ¡†æ¶æ—¶æŒ‡å®šæµ‹è¯•æŠ¥å‘Šçš„ç”Ÿæˆæ–¹å¼ã€‚è¿™ä¸ªé€‰é¡¹å¯ä»¥å¸®åŠ©å¼€å‘è€…ä»¥ä¸åŒçš„æ ¼å¼è¾“å‡ºæµ‹è¯•ç»“æœï¼Œä½¿å¾—ç»“æœæ›´å®¹æ˜“ç†è§£å’Œåˆ†æã€‚</p><p>é€šå¸¸ï¼Œå½“ä½ è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•æ—¶ï¼Œæ¯”å¦‚å•å…ƒæµ‹è¯•æˆ–é›†æˆæµ‹è¯•ï¼Œæµ‹è¯•æ¡†æ¶ä¼šç”Ÿæˆä¸€ä¸ªæŠ¥å‘Šæ¥æ¦‚è¿°æµ‹è¯•çš„ç»“æœã€‚è¿™ä¸ªæŠ¥å‘Šå¯èƒ½åŒ…å«æˆåŠŸå’Œå¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹æ•°é‡ã€é”™è¯¯çš„è¯¦ç»†ä¿¡æ¯ã€æµ‹è¯•è¦†ç›–ç‡ç­‰ã€‚</p><p>å®é™…ä¸Šï¼Œ<code>--test-reporter</code>é€‰é¡¹ä¸»è¦ç”¨äºé‚£äº›ä½¿ç”¨ Node.js å†…ç½®æµ‹è¯•è¿è¡Œå™¨çš„é«˜çº§ç”¨æˆ·æˆ–åº“ä½œè€…ã€‚å¤§å¤šæ•°æ™®é€šç”¨æˆ·å¯èƒ½ä¼šä½¿ç”¨åƒ Mochaã€Jest è¿™æ ·çš„ç¬¬ä¸‰æ–¹æµ‹è¯•æ¡†æ¶ï¼Œå®ƒä»¬æœ‰è‡ªå·±çš„æŠ¥å‘Šç”Ÿæˆæ–¹å¼ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€äº›å…³äºæ€ä¹ˆä½¿ç”¨<code>--test-reporter</code>å‚æ•°çš„å®é™…ä¾‹å­ï¼š</p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ª Node.js é¡¹ç›®ï¼Œå¹¶ä¸”ä½ åœ¨è¯¥é¡¹ç›®ä¸­ç¼–å†™äº†ä¸€äº›æµ‹è¯•ã€‚ä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œè¿™äº›æµ‹è¯•ï¼Œå¹¶ä¸”ä½¿ç”¨<code>--test-reporter</code>é€‰é¡¹æ¥å®šä¹‰ä½ æƒ³è¦çš„æŠ¥å‘Šç±»å‹ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --test-reporter=list</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°å‘½ä»¤ä¸­ï¼Œæˆ‘ä»¬è¿è¡Œäº†<code>test.js</code>æ–‡ä»¶ä¸­çš„æµ‹è¯•ï¼Œå¹¶é€šè¿‡<code>--test-reporter=list</code>æŒ‡å®šæµ‹è¯•æŠ¥å‘Šåº”è¯¥ä»¥åˆ—è¡¨çš„å½¢å¼è¾“å‡ºã€‚</p><p>å¦‚æœä½ æƒ³è¦ä¸€ä¸ªæ›´ä¸ºç»“æ„åŒ–çš„è¾“å‡ºæ ¼å¼ï¼Œæ¯”å¦‚ JUnitï¼Œä½ å¯ä»¥ä½¿ç”¨ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --test-reporter=junit</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ—¶ï¼Œæµ‹è¯•æŠ¥å‘Šå°†ä¼šä»¥ JUnit å…¼å®¹çš„ XML æ ¼å¼è¾“å‡ºï¼Œè¿™ç§æ ¼å¼ç»å¸¸ç”¨äºæŒç»­é›†æˆç³»ç»Ÿä¸­ï¼Œä»¥ä¾¿è‡ªåŠ¨åˆ†ææµ‹è¯•ç»“æœã€‚</p><p>å†æä¾›ä¸€ä¸ªç¤ºä¾‹ï¼Œå¦‚æœä½ æƒ³è¦ä¸€ä¸ªç®€æ˜æ‰¼è¦çš„æ€»ç»“æŠ¥å‘Šï¼Œä½ å¯ä»¥ä½¿ç”¨<code>summary</code>ä½œä¸ºæŠ¥å‘Šå™¨ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --test-reporter=summary</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™å°†ä¼šè¾“å‡ºä¸€ä¸ªæ€»ç»“æŠ¥å‘Šï¼Œæ˜¾ç¤ºæµ‹è¯•çš„æ€»ä½“æƒ…å†µï¼Œå¦‚æ€»æµ‹è¯•æ•°ã€é€šè¿‡æ•°ã€å¤±è´¥æ•°ç­‰ã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™é‡Œçš„<code>test.js</code>ä»£è¡¨ç€ä½ çš„æµ‹è¯•è„šæœ¬æ–‡ä»¶åï¼Œä½ éœ€è¦æ ¹æ®è‡ªå·±çš„å®é™…æ–‡ä»¶åæ›¿æ¢å®ƒã€‚</p><p>æœ€åï¼Œè®°ä½<code>--test-reporter</code>å¯¹äºå¤§å¤šæ•°åˆå­¦è€…è€Œè¨€å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œé™¤éä½ æ­£åœ¨ä½¿ç”¨ Node.js çš„ç‰¹å®šæµ‹è¯•å·¥å…·æˆ–è€…æƒ³è¦è‡ªå®šä¹‰æµ‹è¯•è¾“å‡ºæ ¼å¼ã€‚å¦åˆ™ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨æ›´æµè¡Œçš„æµ‹è¯•æ¡†æ¶ï¼Œæ¯”å¦‚ Mocha æˆ– Jestï¼Œå®ƒä»¬æä¾›äº†æ›´ç›´è§‚å’Œç”¨æˆ·å‹å¥½çš„æµ‹è¯•æŠ¥å‘Šã€‚</p><h3 id="test-reporter-destination" tabindex="-1"><a class="header-anchor" href="#test-reporter-destination"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--test-reporter-destination" target="_blank" rel="noopener noreferrer">--test-reporter-destination</a></span></a></h3><p>Node.js çš„ <code>--test-reporter-destination</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒå…è®¸ä½ æŒ‡å®šæµ‹è¯•æŠ¥å‘Šçš„è¾“å‡ºè·¯å¾„ã€‚åœ¨ Node.js ä¸­ï¼Œå½“ä½ è¿è¡Œæµ‹è¯•æ—¶ï¼Œå¯èƒ½ä¼šæƒ³è¦ç”Ÿæˆä¸€ä¸ªæŠ¥å‘Šæ¥æŸ¥çœ‹æµ‹è¯•ç»“æœã€‚è¿™ä¸ªæŠ¥å‘Šå¯ä»¥æ˜¯æ–‡æœ¬æ ¼å¼ã€JSON æ ¼å¼æˆ–è€…å…¶ä»–æ ¼å¼ï¼Œç”¨äºè®°å½•å“ªäº›æµ‹è¯•é€šè¿‡äº†ï¼Œå“ªäº›å¤±è´¥äº†ï¼Œä»¥åŠå¯èƒ½çš„é”™è¯¯ä¿¡æ¯ç­‰ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæµ‹è¯•æ¡†æ¶ä¼šæœ‰è‡ªå·±é»˜è®¤çš„æ–¹å¼æ¥æ˜¾ç¤ºæµ‹è¯•ç»“æœã€‚ä½¿ç”¨ <code>--test-reporter-destination</code> é€‰é¡¹ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰è¿™ä¸ªæŠ¥å‘Šè¾“å‡ºçš„ä½ç½®ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤çš„æ§åˆ¶å°ï¼ˆç»ˆç«¯ï¼‰æˆ–è€…é»˜è®¤æ–‡ä»¶ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œå¦‚æœä½ æœ‰å¦‚ä¸‹çš„æµ‹è¯•è„šæœ¬ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// test.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> assert</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;assert&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">describe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Array&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  describe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;#indexOf()&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    it</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;should return -1 when the value is not present&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      assert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">equal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">([</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">].</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">indexOf</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ²¡æœ‰ä½¿ç”¨ <code>--test-reporter-destination</code> æ—¶ï¼Œä½ å¯èƒ½ä¼šç›´æ¥è°ƒç”¨ä½ çš„æµ‹è¯•æ¡†æ¶æ¥è¿è¡Œè¿™äº›æµ‹è¯•ï¼Œå¹¶ä¸”ç»“æœä¼šè¾“å‡ºåˆ°æ§åˆ¶å°ã€‚</p><p>ä½†å¦‚æœä½ å¸Œæœ›è¿™äº›ç»“æœè¢«å†™å…¥åˆ°ä¸€ä¸ªç‰¹å®šçš„æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ <code>--test-reporter-destination</code> é€‰é¡¹ã€‚ä¾‹å¦‚ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --test-reporter-destination=./reports/test-results.txt</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä¾‹å­å°†æµ‹è¯•ç»“æœè¾“å‡ºåˆ°å½“å‰ç›®å½•ä¸‹çš„ <code>reports</code> æ–‡ä»¶å¤¹ä¸­çš„ <code>test-results.txt</code> æ–‡ä»¶é‡Œã€‚</p><p>è®°ä½ï¼Œ<code>--test-reporter-destination</code> æ˜¯ Node.js v21.7.1 ç‰ˆæœ¬ä¸­çš„æ–°ç‰¹æ€§ï¼Œæ‰€ä»¥ç¡®ä¿ä½ çš„ Node.js ç‰ˆæœ¬è‡³å°‘æ˜¯ v21.7.1ã€‚</p><p>è¯·æ³¨æ„ï¼Œæ ¹æ®ä½ ä½¿ç”¨çš„æµ‹è¯•æ¡†æ¶å’Œç‰ˆæœ¬ï¼Œå…·ä½“çš„å‘½ä»¤è¡Œé€‰é¡¹å’Œè¯­æ³•å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ä¸Šé¢çš„ä¾‹å­æ˜¯ä¸€ä¸ªå‡è®¾æ€§çš„ç¤ºä¾‹ï¼ŒçœŸå®çš„ä½¿ç”¨éœ€è¦å‚ç…§ä½ æ‰€ä½¿ç”¨çš„æµ‹è¯•æ¡†æ¶å’Œ Node.js æ–‡æ¡£ã€‚</p><p>æœ€åï¼Œè¯·è®°å¾—ï¼Œä¸ºäº†ä½¿ <code>--test-reporter-destination</code> èµ·ä½œç”¨ï¼Œä½ è¿˜éœ€è¦æŒ‡å®šä¸€ä¸ªæµ‹è¯•æŠ¥å‘Šå™¨ï¼ˆreporterï¼‰ï¼Œå®ƒè´Ÿè´£ç”Ÿæˆæµ‹è¯•ç»“æœæŠ¥å‘Šã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€äº›æµ‹è¯•æ¡†æ¶ä¸­ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨ç±»ä¼¼ <code>--reporter=json</code> è¿™æ ·çš„é€‰é¡¹æ¥ç”Ÿæˆ JSON æ ¼å¼çš„æŠ¥å‘Šã€‚</p><h3 id="test-shard" tabindex="-1"><a class="header-anchor" href="#test-shard"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--test-shard" target="_blank" rel="noopener noreferrer">--test-shard</a></span></a></h3><p><code>--test-shard</code> æ˜¯ Node.js å‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰ä¸­çš„ä¸€ä¸ªé«˜çº§é€‰é¡¹ï¼Œå®ƒä¸æ˜¯æ™®é€šç”¨æˆ·æ—¥å¸¸ä½¿ç”¨çš„åŠŸèƒ½ï¼Œè€Œæ˜¯åœ¨ Node.js çš„å¼€å‘è¿‡ç¨‹ä¸­ç”¨æ¥å¸®åŠ©æµ‹è¯•å’Œè°ƒè¯•çš„ã€‚è¿™ä¸ªé€‰é¡¹ä¸»è¦ç”¨äº Node.js è‡ªå·±çš„æµ‹è¯•å¥—ä»¶ï¼Œå…è®¸å¼€å‘è€…å°†æµ‹è¯•åˆ†æˆå‡ ä¸ªéƒ¨åˆ†ï¼ˆç¢ç‰‡ï¼‰ï¼Œå¹¶ä¸”åªè¿è¡Œå…¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚è¿™æ ·åšå¯ä»¥èŠ‚çœæ—¶é—´ï¼Œç‰¹åˆ«æ˜¯å½“ä½ åªæƒ³è¦è¿è¡Œæµ‹è¯•é›†ä¸­çš„ä¸€å°éƒ¨åˆ†æˆ–è€…å½“ä½ åœ¨å¤šæ ¸å¿ƒå¤„ç†å™¨ä¸Šå¹¶è¡Œè¿è¡Œå¤šä¸ªæµ‹è¯•é›†æ—¶ã€‚</p><p>æ ¼å¼ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node --test-shard=`&lt;`shard&gt;/`&lt;`total&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å…¶ä¸­ <code>&lt;`shard&gt;` è¡¨ç¤ºä½ æƒ³è¦æ‰§è¡Œçš„æµ‹è¯•ç¢ç‰‡çš„ç¼–å·ï¼Œè€Œ</code> &lt;<code>total</code>&gt; `` è¡¨ç¤ºæ€»å…±æœ‰å¤šå°‘ç¢ç‰‡ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ 100 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶ä¸”ä½ æƒ³è¦å°†å®ƒä»¬åˆ†ä¸º 10 ä¸ªç¢ç‰‡æ¥å¹¶è¡Œæµ‹è¯•ã€‚ä½ å¯ä»¥è¿™æ ·æ¥è¿è¡Œç¬¬ä¸€ä¸ªç¢ç‰‡çš„æµ‹è¯•ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node --test-shard=1/10 test.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç„¶ååœ¨å¦å¤–ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œè¦è¿è¡Œç¬¬äºŒä¸ªç¢ç‰‡çš„æµ‹è¯•ï¼Œä½ ä¼šè¿™æ ·åšï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node --test-shard=2/10 test.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°ä½ æœ‰ 10 ä¸ªè¿›ç¨‹åˆ†åˆ«è¿è¡Œç€ä¸€ä¸ªä¸åŒçš„æµ‹è¯•ç¢ç‰‡ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸ªç¢ç‰‡å¹¶ä¸ä¿è¯åŒ…å«ç›¸åŒæ•°é‡çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå®ƒä»¬åªæ˜¯å°½å¯èƒ½åœ°å¹³å‡åˆ†é…ã€‚æ­¤å¤–ï¼Œæ­£å¦‚å‰æ–‡æ‰€è¿°ï¼Œè¿™ä¸ªé€‰é¡¹ä¸»è¦ç”¨äº Node.js è‡ªèº«çš„æµ‹è¯•å·¥ä½œï¼Œæ™®é€šå¼€å‘è€…åœ¨æ„å»ºè‡ªå·±çš„åº”ç”¨æ—¶ä¸å¤ªå¯èƒ½ç›´æ¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚</p><p>å¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œä½ æ›´æœ‰å¯èƒ½ä½¿ç”¨åƒ Mocha, Jest è¿™æ ·çš„æµ‹è¯•æ¡†æ¶æ¥ç¼–å†™å’Œè¿è¡Œä½ çš„ JavaScript ä»£ç çš„æµ‹è¯•ã€‚è¿™äº›æ¡†æ¶æä¾›äº†æ›´å‹å¥½ã€æ›´é€‚åˆé¡¹ç›®å¼€å‘çš„æµ‹è¯•å·¥å…·å’ŒåŠŸèƒ½ã€‚<code>--test-shard</code> æ›´åƒæ˜¯ Node.js å¼€å‘å†…éƒ¨çš„å·¥å…·ï¼Œäº†è§£å®ƒå­˜åœ¨å³å¯ï¼Œä¸éœ€æ·±å…¥äº†è§£é™¤éä½ å‚ä¸åˆ° Node.js æ ¸å¿ƒçš„å¼€å‘æˆ–è€…å¯¹æ•´ä¸ªæµ‹è¯•åŸºç¡€è®¾æ–½æ„Ÿå…´è¶£ã€‚</p><h3 id="test-timeout" tabindex="-1"><a class="header-anchor" href="#test-timeout"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--test-timeout" target="_blank" rel="noopener noreferrer">--test-timeout</a></span></a></h3><p><code>--test-timeout</code> æ˜¯ Node.js å‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰çš„ä¸€ä¸ªå‚æ•°ï¼Œå®ƒå…è®¸ä½ è®¾ç½®åœ¨è¿è¡Œæµ‹è¯•æ—¶çš„è¶…æ—¶æ—¶é—´ã€‚è¿™é€šå¸¸ç”¨äºè‡ªåŠ¨åŒ–æµ‹è¯•åœºæ™¯ï¼Œä¾‹å¦‚å•å…ƒæµ‹è¯•æˆ–é›†æˆæµ‹è¯•ã€‚</p><p>å½“ä½ åœ¨è¿›è¡Œè½¯ä»¶å¼€å‘çš„æ—¶å€™ï¼Œä¼šç¼–å†™å¾ˆå¤šå°çš„æµ‹è¯•ç¨‹åºæ¥ç¡®ä¿ä½ çš„ä»£ç æŒ‰ç…§é¢„æœŸå·¥ä½œã€‚è¿™äº›æµ‹è¯•å¯ä»¥æ£€æŸ¥å‡½æ•°æ˜¯å¦è¿”å›æ­£ç¡®çš„ç»“æœï¼Œæˆ–è€…æŸä¸ªåŠŸèƒ½æ˜¯å¦æŒ‰ç…§è®¾è®¡æ‰§è¡Œã€‚æœ‰æ—¶å€™ï¼Œä»£ç ä¸­å¯èƒ½å­˜åœ¨æ°¸è¿œä¸ç»“æŸçš„å¾ªç¯æˆ–æ˜¯æ‰§è¡Œæ—¶é—´è¿‡é•¿çš„æ“ä½œï¼Œè¿™æ—¶å€™å°±éœ€è¦ä¸€ä¸ªè¶…æ—¶æœºåˆ¶æ¥ç»ˆæ­¢é‚£äº›é•¿æ—¶é—´è¿è¡Œæ²¡æœ‰å“åº”çš„æµ‹è¯•ã€‚</p><p>ä½¿ç”¨ <code>--test-timeout</code> å‚æ•°å¯ä»¥å¸®åŠ©ä½ æ§åˆ¶æµ‹è¯•åº”è¯¥åœ¨å¤šä¹…æ—¶é—´å†…å®Œæˆã€‚å¦‚æœæµ‹è¯•è¶…å‡ºäº†è¿™ä¸ªæ—¶é—´é™åˆ¶ï¼ŒNode.js å°†ä¼šè‡ªåŠ¨åœæ­¢æµ‹è¯•å¹¶ä¸”æŠ¥å‘Šå®ƒæœªèƒ½åœ¨æŒ‡å®šæ—¶é—´å†…å®Œæˆã€‚</p><p>ä¾‹å¦‚ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --test-timeout=1000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-test-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¸Šé¢çš„å‘½ä»¤å°†ä¼šè¿è¡Œ <code>my-test-script.js</code> æ–‡ä»¶ï¼Œå¹¶ä¸”è®¾ç½®æµ‹è¯•è¶…æ—¶ä¸º 1000 æ¯«ç§’ï¼ˆ1 ç§’ï¼‰ã€‚å¦‚æœ <code>my-test-script.js</code> ä¸­çš„æµ‹è¯•è¿è¡Œè¶…è¿‡äº† 1 ç§’ï¼Œæµ‹è¯•å°±ä¼šè¢«ä¸­æ–­ï¼Œå¹¶ä¸”ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯æç¤ºæµ‹è¯•å› ä¸ºè¶…æ—¶è€Œå¤±è´¥ã€‚</p><p>å®é™…ä¾‹å­ï¼š</p><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç½‘ç»œè¯·æ±‚çš„åº“ï¼Œå¹¶ä¸”ä½ æƒ³è¦æµ‹è¯•å‘é€ HTTP è¯·æ±‚åèƒ½å¦åœ¨ 2 ç§’å†…æ”¶åˆ°å“åº”ã€‚ä½ å¯ä»¥å†™ä¸€ä¸ªæµ‹è¯•è„šæœ¬ï¼Œç„¶åä½¿ç”¨ <code>--test-timeout</code> è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// http-test.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> testHttpRequest</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`STATUS: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">statusCode</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`BODY: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No more data in response.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Got error: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">e</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">testHttpRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æµ‹è¯•è¿™ä¸ªè„šæœ¬ï¼Œç¡®ä¿å®ƒåœ¨ 2 ç§’å†…å®Œæˆï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --test-timeout=2000</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http-test.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœç”±äºç½‘ç»œå»¶è¿Ÿæˆ–å…¶ä»–åŸå› å¯¼è‡´æµ‹è¯•è¿è¡Œè¶…è¿‡ 2 ç§’ï¼ŒNode.js å°±ä¼šè‡ªåŠ¨ç»ˆæ­¢æµ‹è¯•ï¼Œå¹¶æ ‡è®°ä¸ºè¶…æ—¶å¤±è´¥ã€‚è¿™æ ·å¯ä»¥é¿å…ç­‰å¾…å¤ªé•¿æ—¶é—´æ— å“åº”çš„æµ‹è¯•ï¼Œå¹¶ä¸”è®©ä½ çŸ¥é“éœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥å’Œè°ƒè¯•ä»£ç ã€‚</p><h3 id="throw-deprecation" tabindex="-1"><a class="header-anchor" href="#throw-deprecation"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--throw-deprecation" target="_blank" rel="noopener noreferrer">--throw-deprecation</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘ç›´æ¥æ¥è§£é‡Š <code>--throw-deprecation</code> è¿™ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œå½“ä½¿ç”¨å·²ç»è¢«åºŸå¼ƒï¼ˆdeprecatedï¼‰çš„åŠŸèƒ½æˆ–è€…æ–¹æ³•æ—¶ï¼Œé€šå¸¸ Node.js ä¼šæ‰“å°ä¸€ä¸ªè­¦å‘Šä¿¡æ¯åˆ°æ§åˆ¶å°ï¼Œå‘Šè¯‰ä½ è¿™ä¸ªåŠŸèƒ½æœªæ¥å¯èƒ½ä¼šè¢«ç§»é™¤ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯è®©å¼€å‘è€…çŸ¥é“ä»–ä»¬æ­£åœ¨ä½¿ç”¨çš„æŸäº›éƒ¨åˆ†åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯èƒ½ä¸å†å¯ç”¨ï¼Œä»è€Œé¼“åŠ±ä»–ä»¬æ›´æ–°ä»£ç ï¼Œä»¥å…å°†æ¥å‡çº§ Node.js ç‰ˆæœ¬æ—¶é‡åˆ°é—®é¢˜ã€‚</p><p><code>--throw-deprecation</code> æ˜¯ä¸€ä¸ªå¯ä»¥åœ¨å¯åŠ¨ Node.js ç¨‹åºæ—¶åŠ ä¸Šçš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œä½œç”¨å°±æ˜¯æ”¹å˜ä¸Šè¿°é»˜è®¤è¡Œä¸ºã€‚å¦‚æœä½ åœ¨è¿è¡Œ Node.js ç¨‹åºæ—¶åŠ ä¸Šäº†è¿™ä¸ªé€‰é¡¹ï¼Œé‚£ä¹ˆå½“ç¨‹åºä¸­ä½¿ç”¨åˆ°è¢«åºŸå¼ƒçš„åŠŸèƒ½æ—¶ï¼ŒNode.js ä¸å†åªæ˜¯æ‰“å°è­¦å‘Šä¿¡æ¯ï¼Œè€Œæ˜¯ç›´æ¥æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚è¿™ä¸ªå¼‚å¸¸å¦‚æœæ²¡æœ‰è¢«æ•è·å¤„ç†ï¼Œå°±ä¼šå¯¼è‡´ç¨‹åºé€€å‡ºã€‚</p><p>ä½¿ç”¨è¿™ä¸ªé€‰é¡¹çš„å¥½å¤„æ˜¯ï¼Œå®ƒå¯ä»¥è®©ä½ éå¸¸æ˜æ˜¾åœ°æ³¨æ„åˆ°å¹¶ä¸”å¤„ç†é‚£äº›è¢«åºŸå¼ƒçš„åŠŸèƒ½ï¼Œå› ä¸ºç¨‹åºä¼šå› ä¸ºå¼‚å¸¸è€Œåœæ­¢è¿è¡Œï¼Œè¿«ä½¿ä½ å»ä¿®æ­£æˆ–è€…æ›´æ–°è¢«åºŸå¼ƒçš„ä»£ç éƒ¨åˆ†ã€‚</p><p>ä¸‹é¢ä¸¾ä¸¤ä¸ªä¾‹å­ï¼š</p><ol><li><p>å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªè€ç‰ˆæœ¬çš„ Node.js API <code>fs.existsSync()</code>ï¼Œè™½ç„¶æˆªè‡³ç›®å‰è¿™ä¸ª API è¿˜æ²¡æœ‰è¢«åºŸå¼ƒï¼Œä½†æ˜¯ä¸ºäº†ä¸¾ä¾‹ï¼Œæˆ‘ä»¬å‡è®¾åœ¨æ–°ç‰ˆæœ¬ä¸­å®ƒè¢«æ ‡è®°ä¸ºåºŸå¼ƒäº†ã€‚å¹³æ—¶è¿è¡Œä»£ç ä½ å¯èƒ½çœ‹åˆ°ä¸€ä¸ªè­¦å‘Šè¯´è¿™ä¸ªæ–¹æ³•å°†æ¥ä¼šè¢«ç§»é™¤ã€‚ä½†æ˜¯å¦‚æœä½ è¿è¡Œ node çš„æ—¶å€™åŠ ä¸Š <code>--throw-deprecation</code>ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --throw-deprecation</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¸€æ—¦ä½ çš„è„šæœ¬æ‰§è¡Œåˆ° <code>fs.existsSync()</code> è¿™ä¸ªè°ƒç”¨ï¼ŒNode.js å°†æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œç¨‹åºç«‹å³åœæ­¢ï¼Œè¿™è¿«ä½¿ä½ é©¬ä¸Šå¤„ç†è¿™ä¸ªé—®é¢˜ã€‚</p></li><li><p>å¦å¤–ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œæœ‰æ—¶ Node.js çš„æŸäº›æ¨¡å—ä¼šæ›´æ–° APIï¼Œå¹¶ä¸”æä¾›æ–°çš„æ–¹æ³•æ›¿ä»£æ—§çš„æ–¹æ³•ã€‚æ¯”å¦‚ <code>crypto.createCipher()</code> å·²ç»è¢«åºŸå¼ƒï¼Œåº”è¯¥ä½¿ç”¨ <code>crypto.createCipheriv()</code>ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨ <code>--throw-deprecation</code> é€‰é¡¹ï¼Œä½ å¯èƒ½åªä¼šæ”¶åˆ°ä¸€æ¡è­¦å‘Šæ¶ˆæ¯ï¼Œç¨‹åºè¿˜ä¼šç»§ç»­æ‰§è¡Œã€‚ä½†å¦‚æœä½ å¼€å¯äº†è¿™ä¸ªé€‰é¡¹ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --throw-deprecation</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-crypto-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å½“ä½ çš„ä»£ç å°è¯•è°ƒç”¨ <code>crypto.createCipher()</code>ï¼ŒNode.js å°†ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œä½ çš„ç¨‹åºå°†ä¸ä¼šç»§ç»­è¿è¡Œä¸‹å»ã€‚è¿™æ ·ä¸€æ¥ï¼Œä½ å°±å¿…é¡»å»ä¿®æ”¹ä½ çš„ä»£ç ï¼Œä½¿ç”¨æ¨èçš„æ–° API <code>crypto.createCipheriv()</code>ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œä½¿ç”¨ <code>--throw-deprecation</code> é€‰é¡¹æ˜¯ä¸€ç§æ›´åŠ ç§¯æä¸»åŠ¨åœ°å¤„ç†æ—§ä»£ç çš„æ–¹å¼ï¼Œç¡®ä¿ä½ åŠæ—¶æ›´æ–°ä¸åºŸå¼ƒç‰¹æ€§ç›¸å…³çš„ä»£ç ï¼Œé¿å…å°†æ¥åœ¨ Node.js å‡çº§åå‡ºç°ä¸å¯é¢„æœŸçš„é—®é¢˜ã€‚</p><h3 id="title-title" tabindex="-1"><a class="header-anchor" href="#title-title"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--titletitle" target="_blank" rel="noopener noreferrer">--title=title</a></span></a></h3><p><code>--title=title</code> è¿™ä¸ªå‘½ä»¤è¡Œé€‰é¡¹å…è®¸ä½ ä¸º Node.js è¿›ç¨‹è®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰çš„æ ‡é¢˜ã€‚è¿™åœ¨ä½ æŸ¥çœ‹ç³»ç»Ÿç›‘æ§å·¥å…·æˆ–ä»»åŠ¡ç®¡ç†å™¨æ—¶å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©ä½ æ›´å®¹æ˜“åœ°è¯†åˆ«ä¸åŒçš„ Node.js è¿›ç¨‹ã€‚</p><p>åœ¨æ²¡æœ‰ä½¿ç”¨ <code>--title</code> é€‰é¡¹çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½ å¯èƒ½ä¼šçœ‹åˆ°æ‰€æœ‰ Node.js è¿›ç¨‹éƒ½æ˜¾ç¤ºä¸º <code>node</code>ã€‚å½“ä½ æœ‰å¤šä¸ª Node.js åº”ç”¨ç¨‹åºè¿è¡Œåœ¨åŒä¸€å°æœºå™¨ä¸Šæ—¶ï¼ŒåŒºåˆ†å®ƒä»¬åªé€šè¿‡æŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨å˜å¾—éå¸¸å›°éš¾ã€‚</p><p>ä½¿ç”¨ <code>--title</code> é€‰é¡¹åï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªæ›´æè¿°æ€§çš„åç§°ã€‚è¿™ä¸ªåç§°å°†å‡ºç°åœ¨ç±»ä¼¼äº Windows çš„ä»»åŠ¡ç®¡ç†å™¨ã€Linux çš„ <code>top</code> æˆ– <code>ps</code> å‘½ä»¤ç­‰å·¥å…·ä¸­ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸¤ä¸ª Node.js åº”ç”¨ç¨‹åºï¼š</p><ol><li>ä¸€ä¸ªæ˜¯ç½‘ç«™çš„åç«¯æœåŠ¡ã€‚</li><li>å¦ä¸€ä¸ªæ˜¯ä¸ºæŸäº›æ•°æ®åˆ†æä»»åŠ¡è¿è¡Œçš„è„šæœ¬ã€‚</li></ol><p>ä¸ä½¿ç”¨ <code>--title</code> é€‰é¡¹ï¼Œä½ å¯èƒ½ä¼šåœ¨è¿›ç¨‹åˆ—è¡¨ä¸­çœ‹åˆ°ä¸¤ä¸ªåä¸º <code>node</code> çš„æ¡ç›®ã€‚è¿™æ ·å°±å¾ˆéš¾çŸ¥é“å“ªä¸ªæ˜¯ä½ çš„ç½‘ç«™åç«¯ï¼Œå“ªä¸ªæ˜¯æ•°æ®åˆ†æè„šæœ¬ã€‚</p><p>ç°åœ¨ï¼Œä½¿ç”¨ <code>--title</code> é€‰é¡¹ï¼Œä½ å¯ä»¥å¯åŠ¨è¿™ä¸¤ä¸ªåº”ç”¨ç¨‹åºï¼Œç»™å®ƒä»¬å‘½åï¼Œä»¥ä¾¿èƒ½å¤Ÿè½»æ¾åŒºåˆ†å®ƒä»¬ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --title=web-backend</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> server.js</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --title=data-analysis-script</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> analysis.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ä¸Šè¿°å‘½ä»¤åï¼Œåœ¨è¿›ç¨‹åˆ—è¡¨ä¸­ä½ ä¼šçœ‹åˆ° <code>web-backend</code> å’Œ <code>data-analysis-script</code> è€Œä¸æ˜¯ç®€å•çš„ <code>node</code>ï¼Œä»è€Œå¯ä»¥å¿«é€Ÿè¯†åˆ«æ¯ä¸ªè¿›ç¨‹è´Ÿè´£çš„ä»»åŠ¡ã€‚</p><p>è¯·æ³¨æ„ï¼Œè™½ç„¶ <code>--title</code> å¯ä»¥å¸®åŠ©ä½ åœ¨å¯è§†åŒ–å·¥å…·ä¸­æ›´å¥½åœ°è¯†åˆ«è¿›ç¨‹ï¼Œä½†å®ƒä¸ä¼šå½±å“ç¨‹åºçš„å…¶ä»–æ–¹é¢ï¼Œæ¯”å¦‚æ€§èƒ½æˆ–åŠŸèƒ½ã€‚å®ƒä»…ä»…æ˜¯ä½œä¸ºä¸€ä¸ªæ ‡è¯†ç¬¦å­˜åœ¨ã€‚</p><h3 id="tls-cipher-list-list" tabindex="-1"><a class="header-anchor" href="#tls-cipher-list-list"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--tls-cipher-listlist" target="_blank" rel="noopener noreferrer">--tls-cipher-list=list</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼ŒTLSï¼ˆä¼ è¾“å±‚å®‰å…¨æ€§ï¼‰æ˜¯ä¸€ç§åè®®ï¼Œç”¨äºåœ¨ç½‘ç»œè¿æ¥ä¸­æä¾›åŠ å¯†ï¼Œä¿éšœæ•°æ®ä¼ è¾“çš„å®‰å…¨ã€‚<code>--tls-cipher-list=list</code> æ˜¯ Node.js çš„ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒå…è®¸ä½ æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„å¯†ç å¥—ä»¶åˆ—è¡¨ï¼Œè¿™ä¸ªåˆ—è¡¨å‘Šè¯‰ Node.js ä½¿ç”¨å“ªäº›åŠ å¯†ç®—æ³•å’Œå¯†é’¥äº¤æ¢åè®®æ¥å»ºç«‹å®‰å…¨çš„ TLS è¿æ¥ã€‚</p><h3 id="è¯¦ç»†è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#è¯¦ç»†è§£é‡Š"><span>è¯¦ç»†è§£é‡Š</span></a></h3><p>å½“ä½ å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œå¯ä»¥ç»™ Node.js æä¾›ä¸€ç³»åˆ—å‘½ä»¤è¡Œå‚æ•°æ¥æ”¹å˜å…¶é»˜è®¤è¡Œä¸ºã€‚å…¶ä¸­çš„ <code>--tls-cipher-list=list</code> å°±æ˜¯è¿™æ ·ä¸€ä¸ªå‚æ•°ã€‚å¯†ç å¥—ä»¶ï¼ˆcipher suiteï¼‰æ˜¯ä¸€ç»„åŠ å¯†ç®—æ³•ï¼Œé€šå¸¸åŒ…æ‹¬ï¼š</p><ol><li><strong>å¯†é’¥äº¤æ¢ç®—æ³•</strong>ï¼šå¦‚ RSAã€DHã€ECDH ç­‰ï¼Œç”¨æ¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®‰å…¨åœ°äº¤æ¢å¯†é’¥ã€‚</li><li><strong>åŠ å¯†ç®—æ³•</strong>ï¼šæ¯”å¦‚ AES æˆ–è€… ChaCha20ï¼Œç”¨æ¥å®é™…åŠ å¯†ä¼ è¾“çš„æ•°æ®ã€‚</li><li><strong>æ¶ˆæ¯è®¤è¯ç ç®—æ³•</strong>ï¼šå¦‚ HMACï¼Œç”¨æ¥éªŒè¯ä¿¡æ¯çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚</li></ol><p>åœ¨ TLS æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¼šæ ¹æ®å„è‡ªæ”¯æŒçš„å¯†ç å¥—ä»¶åˆ—è¡¨æ¥å†³å®šæœ€ç»ˆä½¿ç”¨çš„å¥—ä»¶ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-1"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æƒ³è¿è¡Œä¸€ä¸ª Node.js HTTPS æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä½ åªæƒ³ä½¿ç”¨æœ€å¼ºçš„åŠ å¯†ç®—æ³•æ¥ç¡®ä¿æœ€é«˜çº§åˆ«çš„å®‰å…¨æ€§ã€‚é¦–å…ˆï¼Œä½ éœ€è¦äº†è§£å½“å‰è¢«è®¤ä¸ºæ˜¯å¼ºåº¦é«˜çš„å¯†ç å¥—ä»¶ï¼Œç„¶åæ„é€ å‡ºä¸€ä¸ªåŒ…å«è¿™äº›å¥—ä»¶åç§°çš„å­—ç¬¦ä¸²ï¼Œç”¨å†’å·ï¼ˆ:ï¼‰åˆ†éš”ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ ç¡®å®š <code>&quot;ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384&quot;</code> æ˜¯ä½ å¸Œæœ›ä½¿ç”¨çš„å¼ºåº¦é«˜çš„å¯†ç å¥—ä»¶åˆ—è¡¨ï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨å¯åŠ¨ä½ çš„ Node.js åº”ç”¨æ—¶è¿™æ ·ä½¿ç”¨ <code>--tls-cipher-list</code> å‚æ•°ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --tls-cipher-list=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¸Šé¢çš„å‘½ä»¤å°†å‘Šè¯‰ Node.js åªä½¿ç”¨è¿™ä¸¤ä¸ªæŒ‡å®šçš„å¯†ç å¥—ä»¶ä¸å®¢æˆ·ç«¯è¿›è¡Œå®‰å…¨é€šä¿¡ã€‚</p><h3 id="æ³¨æ„äº‹é¡¹-3" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-3"><span>æ³¨æ„äº‹é¡¹</span></a></h3><ul><li>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ ä¸éœ€è¦ä¿®æ”¹é»˜è®¤çš„å¯†ç å¥—ä»¶åˆ—è¡¨ï¼Œå› ä¸º Node.js å·²ç»æä¾›äº†ä¸€ä¸ªç»è¿‡ç²¾å¿ƒæŒ‘é€‰ä¸”æ›´æ–°çš„åˆ—è¡¨ï¼Œä»¥ä¿è¯è‰¯å¥½çš„å®‰å…¨æ€§å’Œå…¼å®¹æ€§ã€‚</li><li>åœ¨é€‰æ‹©å’Œé…ç½®å¯†ç å¥—ä»¶æ—¶è¦å°å¿ƒï¼Œé”™è¯¯çš„é…ç½®å¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿä¸å®‰å…¨æˆ–è€…è¿æ¥é—®é¢˜ã€‚</li><li>å¯†ç å¥—ä»¶æ ‡å‡†å’Œæ¨èåšæ³•ä¼šéšç€æ—¶é—´å˜åŒ–ï¼Œæ‰€ä»¥åœ¨é…ç½®å‰ï¼Œè¯·ç¡®ä¿å‚è€ƒæœ€æ–°çš„å®‰å…¨æŒ‡å—å’Œæ–‡æ¡£ã€‚</li><li>å¦‚æœä½ ä¸ç†Ÿæ‚‰ TLS å’Œå¯†ç å­¦ï¼Œé€šå¸¸æœ€å¥½ä¸è¦è‡ªå·±é…ç½®è¿™äº›é€‰é¡¹ï¼Œé¿å…é™ä½ä½ çš„ç³»ç»Ÿå®‰å…¨æ€§ã€‚</li></ul><h3 id="tls-keylog-file" tabindex="-1"><a class="header-anchor" href="#tls-keylog-file"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--tls-keylogfile" target="_blank" rel="noopener noreferrer">--tls-keylog=file</a></span></a></h3><p>Node.js çš„ <code>--tls-keylog=file</code> é€‰é¡¹å…è®¸ä½ å°† TLS ä¼šè¯å¯†é’¥è®°å½•åˆ°ä¸€ä¸ªæŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚TLS å³ä¼ è¾“å±‚å®‰å…¨åè®®ï¼ˆTransport Layer Securityï¼‰ï¼Œå®ƒç”¨äºåœ¨ä¸¤ä¸ªé€šä¿¡å®ä½“ä¹‹é—´æä¾›åŠ å¯†çš„é€šä¿¡ã€‚å½“ä½¿ç”¨ HTTPSã€WSSï¼ˆWebSocket Secureï¼‰ç­‰å®‰å…¨åè®®æ—¶ï¼Œæ•°æ®ä¼šé€šè¿‡ TLS è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚</p><p>ä¸ºä»€ä¹ˆè¦è®°å½• TLS å¯†é’¥å‘¢ï¼Ÿè¿™é€šå¸¸å‡ºäºè°ƒè¯•å’Œåˆ†æç›®çš„ã€‚æ¯”å¦‚ï¼Œç½‘ç»œå·¥ç¨‹å¸ˆæˆ–è€…å®‰å…¨ç ”ç©¶äººå‘˜å¯èƒ½éœ€è¦æ£€æŸ¥åŠ å¯†çš„ç½‘ç»œé€šä¿¡å†…å®¹æ¥è¯Šæ–­é—®é¢˜æˆ–ç†è§£é€šä¿¡è¿‡ç¨‹ã€‚ç”±äºæ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯åŠ å¯†çš„ï¼Œæ‰€ä»¥ä¸å¯èƒ½ç›´æ¥æŸ¥çœ‹ã€‚ä½†å¦‚æœæœ‰äº†åŠ å¯†è¿‡ç¨‹ä¸­ä½¿ç”¨çš„å¯†é’¥ï¼Œå°±å¯ä»¥åœ¨ç½‘ç»œåˆ†æå·¥å…·ï¼ˆä¾‹å¦‚ Wiresharkï¼‰ä¸­ä½¿ç”¨è¿™äº›å¯†é’¥æ¥è§£å¯†æµé‡å¹¶æŸ¥çœ‹å…¶å†…å®¹ã€‚</p><p>è¯·æ³¨æ„ï¼Œè®°å½• TLS å¯†é’¥å¯¹ç³»ç»Ÿå®‰å…¨æ€§æ¥è¯´æ˜¯éå¸¸å±é™©çš„åšæ³•ï¼Œå› ä¸ºä»»ä½•è·å–åˆ°è¿™äº›å¯†é’¥çš„äººéƒ½èƒ½è§£å¯†é€šä¿¡å†…å®¹ã€‚å› æ­¤ï¼Œè¿™ä¸ªåŠŸèƒ½åº”è¯¥åªåœ¨å®‰å…¨ç¯å¢ƒä¸­ï¼Œä¸”å‡ºäºæµ‹è¯•æˆ–è°ƒè¯•çš„ç›®çš„æ—¶ä½¿ç”¨ã€‚</p><p>è®©æˆ‘ä»¬ä¸¾å‡ ä¸ªå®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><h3 id="ç¤ºä¾‹-1-è°ƒè¯•-https-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-è°ƒè¯•-https-æœåŠ¡å™¨"><span>ç¤ºä¾‹ 1ï¼šè°ƒè¯• HTTPS æœåŠ¡å™¨</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªä½¿ç”¨ HTTPS åè®®çš„ Node.js web æœåŠ¡å™¨ï¼Œå¹¶ä¸”é‡åˆ°äº†ä¸€äº›å¥‡æ€ªçš„é—®é¢˜ï¼Œä½ æ€€ç–‘å¯èƒ½ä¸ TLS åŠ å¯†æœ‰å…³ã€‚ä¸ºäº†è°ƒè¯•è¿™ä¸ªé—®é¢˜ï¼Œä½ æƒ³æŸ¥çœ‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„åŠ å¯†é€šä¿¡å†…å®¹ã€‚</p><p>ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨ Node.js æœåŠ¡å™¨æ—¶æ·»åŠ  <code>--tls-keylog</code> å‚æ•°ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªè®°å½•å¯†é’¥çš„æ–‡ä»¶è·¯å¾„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --tls-keylog=tls-keys.txt</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-https-server.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œæ¯å½“ TLS ä¼šè¯å»ºç«‹æ—¶ï¼Œä½¿ç”¨çš„å¯†é’¥ä¿¡æ¯å°±ä¼šè¢«å†™å…¥ <code>tls-keys.txt</code> æ–‡ä»¶ä¸­ã€‚</p><h3 id="ç¤ºä¾‹-2-åˆ†æ-websocket-secure-wss-é€šä¿¡" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-åˆ†æ-websocket-secure-wss-é€šä¿¡"><span>ç¤ºä¾‹ 2ï¼šåˆ†æ WebSocket Secure (WSS) é€šä¿¡</span></a></h3><p>WebSocket æŠ€æœ¯å…è®¸åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´åˆ›å»ºä¸€ä¸ªæŒä¹…åŒ–çš„è¿æ¥ï¼Œè€Œ WSS æ˜¯ WebSocket çš„å®‰å…¨ç‰ˆæœ¬ã€‚åœ¨å¼€å‘å…·æœ‰å®æ—¶åŠŸèƒ½çš„ç½‘ç«™æˆ–åº”ç”¨ç¨‹åºæ—¶ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨ WSSã€‚</p><p>å¦‚æœä½ éœ€è¦åˆ†æé€šè¿‡ WSS å‘é€å’Œæ¥æ”¶çš„æ•°æ®åŒ…ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨åº”ç”¨æ—¶ä½¿ç”¨ <code>--tls-keylog</code> å‚æ•°ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --tls-keylog=wss-keys.txt</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-wss-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œæ‰€æœ‰çš„ TLS å¯†é’¥éƒ½ä¼šè®°å½•åœ¨ <code>wss-keys.txt</code> ä¸­ï¼Œä½ å¯ä»¥å°†è¿™ä¸ªæ–‡ä»¶å¯¼å…¥åˆ° Wireshark ç­‰åˆ†æå·¥å…·ä¸­ï¼Œç„¶åè§£å¯†æ•è·çš„ WSS æµé‡ï¼Œä»¥ä¾¿è¯¦ç»†åˆ†æé€šä¿¡å†…å®¹ã€‚</p><p>å†æ¬¡å¼ºè°ƒï¼Œåªæœ‰åœ¨ç¡®ä¿¡å¯†é’¥ä¸ä¼šæ³„éœ²ç»™æœªæˆæƒäººå‘˜çš„æƒ…å†µä¸‹ï¼Œæ‰åº”è¯¥ä½¿ç”¨ <code>--tls-keylog</code> åŠŸèƒ½ã€‚å¼€å‘å®Œæˆåï¼Œåº”ç«‹å³åœæ­¢ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œå¹¶ç¡®ä¿æ¶‰åŠçš„å¯†é’¥æ–‡ä»¶å¾—åˆ°å¦¥å–„å¤„ç†ï¼Œä¾‹å¦‚åˆ é™¤æˆ–ä¿è¯å…¶å®‰å…¨ã€‚</p><h3 id="tls-max-v1-2" tabindex="-1"><a class="header-anchor" href="#tls-max-v1-2"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--tls-max-v12" target="_blank" rel="noopener noreferrer">--tls-max-v1.2</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 JavaScript å¼•æ“è¿è¡Œçš„ JavaScript ç¯å¢ƒã€‚å®ƒè®©æˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚å½“ä½ åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ç½‘é¡µæ—¶ï¼ŒJavaScript è´Ÿè´£ä½¿å¾—é¡µé¢æœ‰äº¤äº’æ€§ï¼›è€Œ Node.js åˆ™æ˜¯è®©æˆ‘ä»¬èƒ½åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨ JavaScriptã€‚</p><p>åœ¨è°ˆè®º <code>--tls-max-v1.2</code> å‚æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£ TLSã€‚TLSï¼ˆä¼ è¾“å±‚å®‰å…¨æ€§åè®®ï¼ŒTransport Layer Securityï¼‰æ˜¯ç”¨äºåœ¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºé—´æä¾›é€šä¿¡å®‰å…¨å’Œæ•°æ®å®Œæ•´æ€§çš„æ ‡å‡†åè®®ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå½“ä½ åœ¨æµè§ˆå™¨é‡Œè®¿é—®ä¸€ä¸ªç½‘ç«™ï¼Œæ¯”å¦‚è¾“å…¥ <a href="https://www.google.com" target="_blank" rel="noopener noreferrer">https://www.google.com</a>ï¼ŒTLS ç¡®ä¿ä½ å’Œ Google æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ˜¯åŠ å¯†ä¸”æ— æ³•è¢«ç¬¬ä¸‰æ–¹è½»æ˜“çªƒå¬æˆ–ç¯¡æ”¹çš„ã€‚</p><p>ç°åœ¨ï¼Œæ¥è¯´è¯´ä»€ä¹ˆæ˜¯ <code>--tls-max-v1.2</code>ã€‚è¿™æ˜¯ä¸€ä¸ªå¯åŠ¨ Node.js åº”ç”¨æ—¶å¯ä»¥ä½¿ç”¨çš„å‘½ä»¤è¡Œå‚æ•°ã€‚å®ƒæŒ‡å®šäº†åœ¨ä½¿ç”¨ TLS è¿›è¡ŒåŠ å¯†é€šä¿¡æ—¶æ‰€å…è®¸çš„æœ€å¤§ TLS ç‰ˆæœ¬ã€‚TLS åè®®éšç€æ—¶é—´å·²ç»ç»å†äº†å‡ ä¸ªç‰ˆæœ¬ï¼Œä»æ—§çš„ v1.0 åˆ°è¾ƒæ–°çš„ v1.3ã€‚æ¯ä¸ªæ–°ç‰ˆæœ¬éƒ½ä¼šå¢åŠ æ–°åŠŸèƒ½å¹¶ä¿®å¤æ—§ç‰ˆæœ¬çš„å®‰å…¨æ¼æ´ã€‚</p><p>è¿™ä¸ªå‚æ•° <code>--tls-max-v1.2</code> çš„æ„æ€å°±æ˜¯å‘Šè¯‰ Node.js ä½¿ç”¨ TLS åè®®æ—¶ï¼Œæœ€é«˜åªèƒ½ä½¿ç”¨åˆ°ç‰ˆæœ¬ 1.2ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä¾¿ç³»ç»Ÿæ”¯æŒæ›´æ–°çš„ TLS ç‰ˆæœ¬ï¼ˆæ¯”å¦‚ TLS v1.3ï¼‰ï¼Œè‹¥ä½¿ç”¨äº†è¿™ä¸ªå‚æ•°ï¼ŒNode.js ä¼šé™åˆ¶å®ƒçš„ TLS æ”¯æŒä¸ä¼šè¶…è¿‡ v1.2ã€‚</p><p>ä¸ºä½•è¦é™åˆ¶ TLS ç‰ˆæœ¬å‘¢ï¼Ÿå¯èƒ½çš„åŸå› åŒ…æ‹¬ï¼š</p><ol><li>å…¼å®¹æ€§ï¼šå¯èƒ½ä½ çš„ Node.js åº”ç”¨éœ€è¦ä¸ä¸€äº›åªæ”¯æŒ TLS v1.2 æˆ–æ›´ä½ç‰ˆæœ¬çš„ç³»ç»Ÿè¿›è¡Œé€šä¿¡ã€‚</li><li>å®‰å…¨ç­–ç•¥ï¼šæŸäº›ç»„ç»‡å¯èƒ½è¿˜æ²¡æœ‰å‡†å¤‡å¥½å°†ä»–ä»¬çš„ç³»ç»Ÿå‡çº§åˆ°æœ€æ–°çš„ TLS ç‰ˆæœ¬ï¼Œæˆ–è€…ç”±äºå„ç§è§„å®šéœ€è¦ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬çš„ TLSã€‚</li></ol><p>ä½¿ç”¨ä¾‹å­ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node --tls-max-v1.2 your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>your-app.js</code> æ˜¯ä½ çš„ Node.js åº”ç”¨çš„å…¥å£æ–‡ä»¶ã€‚é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸­æ·»åŠ  <code>--tls-max-v1.2</code> å‚æ•°ï¼Œä½ çš„åº”ç”¨åœ¨å»ºç«‹ TLS è¿æ¥æ—¶ä¸ä¼šä½¿ç”¨ TLSv1.3ï¼Œå³ä½¿ Node.js å’Œæ“ä½œç³»ç»Ÿæ”¯æŒå®ƒã€‚</p><p>è¯·æ³¨æ„ï¼Œé™åˆ¶ TLS ç‰ˆæœ¬å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é£é™©ï¼Œå› ä¸ºé€šå¸¸æœ€æ–°çš„ç‰ˆæœ¬ä¼šä¿®å¤å…ˆå‰ç‰ˆæœ¬çš„å®‰å…¨é—®é¢˜ã€‚å› æ­¤ï¼Œé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œå¦åˆ™å»ºè®®ä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆçš„ TLSã€‚</p><h3 id="tls-max-v1-3" tabindex="-1"><a class="header-anchor" href="#tls-max-v1-3"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--tls-max-v13" target="_blank" rel="noopener noreferrer">--tls-max-v1.3</a></span></a></h3><p><code>--tls-max-v1.3</code> æ˜¯ Node.js è¿è¡Œæ—¶çš„ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒç”¨äºæŒ‡å®šåœ¨ Node.js åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨æ€§ï¼‰æ—¶å¯ä»¥æ”¯æŒçš„æœ€é«˜ç‰ˆæœ¬ã€‚TLS æ˜¯ä¸€ç§åè®®ï¼Œæ—¨åœ¨ä¸ºç½‘ç»œé€šä¿¡æä¾›å®‰å…¨å’Œæ•°æ®å®Œæ•´æ€§ä¿æŠ¤ã€‚</p><p>å½“ä½ å¯åŠ¨ Node.js ç¨‹åºæ—¶ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ·»åŠ å‚æ•°æ¥é…ç½®ä¸åŒçš„è¡Œä¸ºã€‚<code>--tls-max-v1.3</code> å°±æ˜¯è¿™æ ·ä¸€ä¸ªå‚æ•°ï¼Œå®ƒä¼šå‘Šè¯‰ Node.js åœ¨å¤„ç† TLS åŠ å¯†è¿æ¥æ—¶ï¼Œåº”è¯¥ä½¿ç”¨ TLS ç‰ˆæœ¬ 1.3 ä½œä¸ºæœ€é«˜å…è®¸çš„ç‰ˆæœ¬ã€‚</p><p>å…·ä½“è€Œè¨€ï¼ŒTLS æœ‰å‡ ä¸ªç‰ˆæœ¬ï¼Œå¸¸è§çš„åŒ…æ‹¬ TLS 1.0, 1.1, 1.2, å’Œè¾ƒæ–°çš„ 1.3ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ¯ä¸ªç‰ˆæœ¬éƒ½åœ¨å¢åŠ æ›´å¤šçš„å®‰å…¨ç‰¹æ€§ï¼ŒåŒæ—¶æ·˜æ±°äº†ä¸€äº›ä¸å†å®‰å…¨çš„ç®—æ³•ã€‚ç°ä»£çš„äº’è”ç½‘å®‰å…¨å»ºè®®ä½¿ç”¨æœ€æ–°çš„ TLS ç‰ˆæœ¬ï¼Œå³ TLS 1.3ï¼Œå› ä¸ºå®ƒæä¾›äº†æ”¹è¿›çš„å®‰å…¨æ€§ã€æ€§èƒ½å’Œéšç§ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-7" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-7"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œè¯¥ç¨‹åºéœ€è¦ä¸å…¶ä»–æœåŠ¡å™¨å®‰å…¨åœ°é€šä¿¡ï¼Œä¾‹å¦‚ï¼Œä½ å¯èƒ½æ­£åœ¨åˆ›å»ºä¸€ä¸ªç½‘é¡µæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œéœ€è¦é€šè¿‡ HTTPS åè®®å‘é€è¯·æ±‚ã€‚</p><p>ä»¥ä¸‹æ˜¯å¦‚ä½•åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨ <code>--tls-max-v1.3</code> é€‰é¡¹çš„ç¤ºä¾‹ï¼š</p><h4 id="å¯åŠ¨ä¸€ä¸ª-https-æœåŠ¡å™¨" tabindex="-1"><a class="header-anchor" href="#å¯åŠ¨ä¸€ä¸ª-https-æœåŠ¡å™¨"><span>å¯åŠ¨ä¸€ä¸ª HTTPS æœåŠ¡å™¨</span></a></h4><p>å¦‚æœä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª HTTPS æœåŠ¡å™¨ï¼Œä½ å¯èƒ½ä¼šæœ‰ç±»ä¼¼ä»¥ä¸‹çš„ä»£ç ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// SSL/TLS è¯ä¹¦çš„é…ç½®é€‰é¡¹ã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º HTTPS æœåŠ¡å™¨ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä½ é€šè¿‡å‘½ä»¤è¡Œå¯åŠ¨è¿™ä¸ªæœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥æ·»åŠ  <code>--tls-max-v1.3</code> å‚æ•°ç¡®ä¿ TLS çš„æœ€é«˜ç‰ˆæœ¬æ˜¯ 1.3ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --tls-max-v1.3</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> server.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œå³ä½¿ä½ çš„ Node.js ç¯å¢ƒé»˜è®¤æ”¯æŒæ›´è€çš„ TLS ç‰ˆæœ¬ï¼Œä½ ä¹Ÿæ˜ç¡®æŒ‡å®šäº†ä½¿ç”¨ TLS æœ€æ–°æ ‡å‡†ã€‚</p><h4 id="ä½¿ç”¨-https-æ¨¡å—å‘èµ·è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-https-æ¨¡å—å‘èµ·è¯·æ±‚"><span>ä½¿ç”¨ HTTPS æ¨¡å—å‘èµ·è¯·æ±‚</span></a></h4><p>å½“ä½ ä½¿ç”¨ Node.js çš„ <code>https</code> æ¨¡å—å‘å…¶ä»–æœåŠ¡å™¨å‘èµ·è¯·æ±‚æ—¶ï¼Œä½ å¸Œæœ›ç¡®ä¿ä½¿ç”¨çš„æ˜¯å®‰å…¨çš„ TLS ç‰ˆæœ¬ã€‚åŒæ ·ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨è„šæœ¬æ—¶æ·»åŠ  <code>--tls-max-v1.3</code> å‚æ•°ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://example.com/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†å“åº”...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯åŠ¨æ—¶:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --tls-max-v1.3</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> client.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>--tls-max-v1.3</code> æ˜¯ä¸€ä¸ªç”¨äºè®¾ç½®åœ¨ Node.js ç¨‹åºä¸­å»ºç«‹çš„ TLS è¿æ¥å¯ä½¿ç”¨çš„æœ€é«˜ç‰ˆæœ¬å·çš„é€‰é¡¹ã€‚åœ¨ç°ä»£ç½‘ç»œåº”ç”¨ä¸­ï¼Œæ¨èä½¿ç”¨æœ€æ–°çš„ TLS ç‰ˆæœ¬æ¥ä¿è¯æœ€é«˜æ°´å¹³çš„å®‰å…¨æ€§ã€‚</p><h3 id="tls-min-v1-0" tabindex="-1"><a class="header-anchor" href="#tls-min-v1-0"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--tls-min-v10" target="_blank" rel="noopener noreferrer">--tls-min-v1.0</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Web åº”ç”¨å’Œå…¶ä»–ç½‘ç»œåº”ç”¨ä¸­ï¼Œå®‰å…¨ä¼ è¾“å±‚ï¼ˆTLSï¼‰ç”¨æ¥åŠ å¯†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œç¡®ä¿æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ã€‚</p><p><code>--tls-min-v1.0</code> æ˜¯ Node.js è¿è¡Œæ—¶çš„ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œè¯¥é€‰é¡¹ç”¨äºæŒ‡å®š Node.js åº”ç”¨ç¨‹åºæ¥å—çš„æœ€ä½ TLS ç‰ˆæœ¬ã€‚TLS åè®®æœ‰å‡ ä¸ªç‰ˆæœ¬ï¼Œæ¯”å¦‚ TLS v1.0, TLS v1.1, TLS v1.2 å’Œ TLS v1.3ã€‚éšç€æ—¶é—´å‘å±•ï¼Œè€ç‰ˆæœ¬çš„ TLS å› ä¸ºå®‰å…¨æ¼æ´è¢«é€æ­¥æ·˜æ±°ï¼Œæ–°ç‰ˆæœ¬çš„ TLS æä¾›äº†æ›´å¼ºçš„å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚</p><h3 id="è§£é‡Š-tls-min-v1-0" tabindex="-1"><a class="header-anchor" href="#è§£é‡Š-tls-min-v1-0"><span>è§£é‡Š <code>--tls-min-v1.0</code></span></a></h3><p>ä½¿ç”¨ <code>--tls-min-v1.0</code> é€‰é¡¹æ„å‘³ç€ä½ å‘Šè¯‰ Node.js è‡³å°‘è¦ä½¿ç”¨ TLS ç‰ˆæœ¬ 1.0ã€‚æ¢å¥è¯è¯´ï¼Œå³ä¾¿æœ‰æ›´æ—§çš„åè®®ç‰ˆæœ¬ï¼ˆå¦‚ SSLv3ï¼‰ï¼ŒNode.js ä¸ä¼šä½¿ç”¨è¿™äº›ä¸å¤Ÿå®‰å…¨çš„è€ç‰ˆæœ¬ï¼Œä½†æ˜¯ä¼šæ¥å—æ‰€æœ‰ TLS 1.0 æˆ–ä»¥ä¸Šç‰ˆæœ¬çš„è¿æ¥ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-4"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª HTTPS æœåŠ¡å™¨ï¼Œè¦æ±‚è‡³å°‘ä½¿ç”¨ TLS 1.0 ç‰ˆæœ¬è¿›è¡ŒåŠ å¯†é€šä¿¡ã€‚è¿™æ˜¯ä¸€æ®µç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºå¦‚ä½•ç¼–å†™è¿™æ ·çš„æœåŠ¡å™¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼•å…¥ https æ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½® HTTPS æœåŠ¡å™¨é€‰é¡¹ï¼ŒåŒ…æ‹¬è¯ä¹¦å’Œç§é’¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;your-private-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;your-certificate.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // åœ¨è¿™é‡Œæˆ‘ä»¬ä¸è®¾ç½® minVersionï¼Œå› ä¸ºæˆ‘ä»¬å°†é€šè¿‡å‘½ä»¤è¡Œå‚æ•°è®¾ç½®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º HTTPS æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;HTTPS server running on https://localhost:8000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä½ å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>--tls-min-v1.0</code> è¡¨æ˜ä½ çš„æœåŠ¡å™¨ä¸æ¥å—å°äº TLS v1.0 çš„è¿æ¥ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨æœåŠ¡å™¨ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --tls-min-v1.0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-server-file.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆªè‡³æˆ‘çš„çŸ¥è¯†æ›´æ–°æ—¥æœŸï¼ŒTLS v1.0 å’Œ v1.1 éƒ½å·²ä¸å†è¢«æ¨èä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬ä¸å¤Ÿå®‰å…¨ã€‚å®é™…ä¸Šï¼Œä½ åº”è¯¥è€ƒè™‘ä½¿ç”¨ <code>--tls-min-v1.2</code> æˆ–æ›´é«˜çš„ç‰ˆæœ¬ï¼Œä»¥ç¡®ä¿è‰¯å¥½çš„å®‰å…¨æ€§æ°´å¹³ã€‚</p><p>æ­¤å¤–ï¼Œå¦‚æœä½ æ­£åœ¨æ„å»ºä¸€ä¸ªé¢å‘å…¬ä¼—çš„æœåŠ¡ï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®æœ€æ–°çš„å®‰å…¨æ ‡å‡†é…ç½®ä½ çš„ Node.js æœåŠ¡å™¨ä»¥æ”¯æŒæ›´é«˜ç‰ˆæœ¬çš„ TLSã€‚åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼ŒTLS v1.3 æ˜¯æœ€å®‰å…¨ã€æœ€å…ˆè¿›çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”å·²ç»è·å¾—äº†å¹¿æ³›çš„æ”¯æŒå’Œæ¨èä½¿ç”¨ã€‚</p><h3 id="tls-min-v1-1" tabindex="-1"><a class="header-anchor" href="#tls-min-v1-1"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--tls-min-v11" target="_blank" rel="noopener noreferrer">--tls-min-v1.1</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡ç«¯ä»£ç ã€‚Node.js æä¾›äº†ä¸€ç³»åˆ—å†…ç½®æ¨¡å—ï¼Œå…¶ä¸­ <code>tls</code> æ¨¡å—ç”¨äºå¤„ç† TLS/SSL åè®®ï¼Œå³ä¼ è¾“å±‚å®‰å…¨åè®®ï¼Œè¿™æ˜¯ç”¨äºåœ¨ä¸¤ä¸ªé€šä¿¡åº”ç”¨ç¨‹åºä¹‹é—´æä¾›ä¿å¯†æ€§å’Œæ•°æ®å®Œæ•´æ€§çš„æ ‡å‡†åè®®ã€‚</p><p>å½“ä½ çœ‹åˆ° <code>--tls-min-v1.1</code> è¿™æ ·çš„å‘½ä»¤è¡Œé€‰é¡¹æ—¶ï¼Œè¿™æ˜¯æŒ‡å®šäº†åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ <code>tls</code> æ¨¡å—æ—¶ï¼Œå¯ä»¥æ¥å—çš„æœ€ä½ç‰ˆæœ¬çš„ TLS åè®®ã€‚å…·ä½“æ¥è¯´ï¼Œ<code>--tls-min-v1.1</code> è¡¨ç¤ºç¨‹åºå°†æ‹’ç»å»ºç«‹ä»»ä½•ä½¿ç”¨æ—©äº TLS ç‰ˆæœ¬ 1.1 çš„å®‰å…¨è¿æ¥ã€‚</p><p>è¿™ä¸ªè®¾ç½®å½±å“äº†æ‰€æœ‰é€šè¿‡ Node.js åˆ›å»ºçš„ TLS å®‰å…¨è¿æ¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª HTTPS æœåŠ¡å™¨æˆ–æ˜¯å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”å¸Œæœ›ç¡®ä¿ä¸æ¥å—æ¯” TLS 1.1 æ—§çš„åè®®ç‰ˆæœ¬è¿›è¡Œå®‰å…¨é€šä¿¡ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨ Node.js ç¨‹åºæ—¶æ·»åŠ è¿™ä¸ªé€‰é¡¹ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€äº›å®é™…ä½¿ç”¨çš„ä¾‹å­ï¼š</p><ol><li>åˆ›å»º HTTPS æœåŠ¡å™¨ï¼š<br> å‡è®¾ä½ è¦åˆ›å»ºä¸€ä¸ªç®€å•çš„ HTTPS æœåŠ¡å™¨ï¼Œé€šå¸¸ä½ ä¼šè¿™æ ·å†™ä»£ç ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ æƒ³ç¡®ä¿è¿™ä¸ªæœåŠ¡å™¨ä¸æ¥å— TLS 1.0 æˆ–æ›´æ—©ç‰ˆæœ¬çš„è¿æ¥ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨æœåŠ¡å™¨çš„æ—¶å€™åŠ ä¸Š <code>--tls-min-v1.1</code> å‚æ•°ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --tls-min-v1.1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> server.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li>ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·å‘é€ HTTPS è¯·æ±‚ï¼š<br> å¦‚æœä½ åœ¨ä½¿ç”¨å¦‚ <code>curl</code> è¿™æ ·çš„å‘½ä»¤è¡Œå·¥å…·å‘é€ HTTPS è¯·æ±‚åˆ°ä¸€ä¸ª Node.js æœåŠ¡å™¨ï¼Œä½ å¯èƒ½éœ€è¦ç¡®ä¿ä½ çš„å®¢æˆ·ç«¯ä¹Ÿæ”¯æŒå¯¹åº”ç‰ˆæœ¬çš„ TLSã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è¿™æ ·è°ƒç”¨ <code>curl</code> å·¥å…·æ¥å‘èµ·è¯·æ±‚ï¼š</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --tlsv1.1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://localhost:8000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™å‘Šè¯‰ <code>curl</code> ä½¿ç”¨è‡³å°‘æ˜¯ TLS 1.1 ç‰ˆæœ¬çš„åè®®æ¥è¿›è¡Œé€šä¿¡ã€‚</p><p>é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼ŒTLS 1.0 å’Œ 1.1 éƒ½è¢«è®¤ä¸ºæ˜¯ä¸å†å®‰å…¨çš„ï¼Œå› æ­¤ç°ä»£çš„å®‰å…¨æœ€ä½³å®è·µæ¨èä½¿ç”¨ TLS 1.2 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚å› æ­¤ï¼Œè™½ç„¶ä½ å¯ä»¥è®¾ç½® <code>--tls-min-v1.1</code> æ¥é™åˆ¶æœ€è€çš„åè®®ç‰ˆæœ¬ï¼Œä½†åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä½ å¯èƒ½ä¼šæƒ³è¦ä½¿ç”¨æ›´é«˜ç‰ˆæœ¬çš„åè®®ï¼Œæ¯”å¦‚ <code>--tls-min-v1.2</code>ã€‚</p><h3 id="tls-min-v1-2" tabindex="-1"><a class="header-anchor" href="#tls-min-v1-2"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--tls-min-v12" target="_blank" rel="noopener noreferrer">--tls-min-v1.2</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡ç«¯ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ç½‘ç»œåŠŸèƒ½å¦‚ HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€æ–‡ä»¶ç³»ç»Ÿæ“ä½œç­‰ã€‚</p><p>åœ¨ç½‘ç»œé€šä¿¡ä¸­å°¤å…¶æ˜¯æ¶‰åŠæ•æ„Ÿæ•°æ®ä¼ è¾“æ—¶ï¼Œå®‰å…¨æ€§å˜å¾—éå¸¸é‡è¦ã€‚è¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ° TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰ï¼Œå®ƒä¸»è¦ç›®çš„æ˜¯æä¾›éšç§ä¿æŠ¤å’Œæ•°æ®å®Œæ•´æ€§ã€‚TLS æœ‰ä¸åŒçš„ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬ TLS 1.0ã€TLS 1.1ã€TLS 1.2 å’Œ TLS 1.3 ç­‰ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ–°çš„ç‰ˆæœ¬ä¿®å¤äº†æ—§ç‰ˆæœ¬ä¸­çš„å®‰å…¨é—®é¢˜ï¼Œå¹¶æä¾›äº†æ›´å¥½çš„åŠ å¯†ç®—æ³•ã€‚</p><p><code>--tls-min-v1.2</code> æ˜¯ä¸€ä¸ª Node.js çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒå¼ºåˆ¶ Node.js çš„ TLS æ”¯æŒè‡³å°‘ä» TLS v1.2 ç‰ˆæœ¬å¼€å§‹ã€‚å½“ä½ ä½¿ç”¨è¿™ä¸ªé€‰é¡¹æ—¶ï¼Œä»»ä½•é€šè¿‡ Node.js å»ºç«‹çš„ TLS è¿æ¥éƒ½ä¼šè‡³å°‘ä½¿ç”¨ TLS v1.2ï¼Œè€Œä¸ä¼šä½¿ç”¨æ›´æ—§çš„ã€å¯èƒ½ä¸å¤Ÿå®‰å…¨çš„ç‰ˆæœ¬å¦‚ TLS 1.0 æˆ– TLS 1.1ã€‚</p><p>ç°å®ä¸­çš„ä¾‹å­ï¼š</p><ol><li><p><strong>å»ºç«‹ä¸€ä¸ª HTTPS æœåŠ¡å™¨</strong>: å½“ä½ åœ¨ Node.js ä¸­åˆ›å»ºä¸€ä¸ª HTTPS æœåŠ¡å™¨æ—¶ï¼Œä½ å¸Œæœ›ç¡®ä¿ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„é€šä¿¡æ˜¯å®‰å…¨çš„ã€‚å¦‚æœä½ ä½¿ç”¨äº† <code>--tls-min-v1.2</code> é€‰é¡¹ï¼Œé‚£ä¹ˆå³ä½¿å®¢æˆ·ç«¯è¯•å›¾ä½¿ç”¨ TLS 1.0 æˆ– 1.1 è¿æ¥åˆ°ä½ çš„æœåŠ¡å™¨ï¼Œè¿æ¥ä¹Ÿä¼šå¤±è´¥ï¼Œå› ä¸ºä½ çš„æœåŠ¡å™¨é…ç½®ä¸ºè‡³å°‘ä½¿ç”¨ TLS 1.2ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¯»å–å¯†é’¥å’Œè¯ä¹¦æ•°æ®ï¼Œè¿™äº›æ˜¯å»ºç«‹ HTTPS æœåŠ¡å™¨æ‰€éœ€è¦çš„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/your-key.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/your-cert.pem&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server listening on port 8000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å¯åŠ¨è¿™æ®µè„šæœ¬ä¹‹å‰ï¼Œå¦‚æœä½ åœ¨å‘½ä»¤è¡Œä¸­åŠ å…¥äº† <code>--tls-min-v1.2</code>ï¼Œé‚£ä¹ˆè¿™ä¸ª HTTPS æœåŠ¡å™¨å°†åªæ¥å—ä½¿ç”¨è‡³å°‘æ˜¯ TLS v1.2 ç‰ˆæœ¬çš„è¿æ¥ã€‚</p></li><li><p><strong>å‘èµ· HTTPS å®¢æˆ·ç«¯è¯·æ±‚</strong>: å¦‚æœä½ æƒ³è¦ç¼–å†™ä¸€ä¸ªåº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦å®‰å…¨åœ°è¿æ¥åˆ°ç¬¬ä¸‰æ–¹çš„ HTTPS æœåŠ¡ï¼Œå¹¶ä¸”ä½ æƒ³è¦ç¡®ä¿ä½¿ç”¨çš„æ˜¯å®‰å…¨çš„ TLS ç‰ˆæœ¬ï¼Œä½ å¯ä»¥åœ¨è¿è¡Œä½ çš„å®¢æˆ·ç«¯ä»£ç æ—¶ä½¿ç”¨ <code>--tls-min-v1.2</code> é€‰é¡¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://example.com/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // A chunk of data has been received.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // The whole response has been received. Print out the result.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Error: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŒæ ·ï¼Œåœ¨è¿è¡Œä¸Šè¿°å®¢æˆ·ç«¯ä»£ç æ—¶ï¼Œå¦‚æœä½¿ç”¨äº† <code>--tls-min-v1.2</code> é€‰é¡¹ï¼Œä½ çš„å®¢æˆ·ç«¯è¯·æ±‚ä¼šç¡®ä¿è‡³å°‘é‡‡ç”¨ TLS v1.2 åè®®è¿›è¡Œé€šä¿¡ã€‚</p></li></ol><p>è¯·æ³¨æ„ï¼Œéšç€æŠ€æœ¯çš„æ¼”è¿›ï¼Œå»ºè®®å§‹ç»ˆå…³æ³¨å¹¶ä½¿ç”¨å½“å‰è¢«è®¤ä¸ºæœ€å®‰å…¨çš„ TLS ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œæˆªè‡³æˆ‘çŸ¥è¯†æ›´æ–°æ—¶ï¼ŒTLS 1.3 è¢«è®¤ä¸ºæ˜¯æ›´å®‰å…¨çš„é€‰æ‹©ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œå»ºè®®ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ TLS åè®®æ¥ä¿æŒæœ€ä½³çš„å®‰å…¨æ€§ã€‚</p><h3 id="tls-min-v1-3" tabindex="-1"><a class="header-anchor" href="#tls-min-v1-3"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--tls-min-v13" target="_blank" rel="noopener noreferrer">--tls-min-v1.3</a></span></a></h3><p><code>--tls-min-v1.3</code> æ˜¯ä¸€ä¸ªåœ¨å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶å¯ä»¥ä½¿ç”¨çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼ˆæˆ–ç§°ä¸ºâ€œæ ‡å¿—â€ï¼‰ã€‚è¿™ä¸ªé€‰é¡¹ç”¨äºè®¾ç½®æœ€å°çš„ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰ç‰ˆæœ¬ï¼ŒNode.js æœåŠ¡å™¨å°†å…è®¸å®¢æˆ·ç«¯ä½¿ç”¨è¿›è¡Œå®‰å…¨é€šä¿¡ã€‚TLS æ˜¯ä¸€ç§åè®®ï¼Œå®ƒæä¾›äº†åœ¨äº’è”ç½‘ä¸Šè¿›è¡Œå®‰å…¨é€šä¿¡çš„æ–¹å¼ï¼Œå¸¸ç”¨äº HTTPSã€FTPS ç­‰ã€‚</p><p>Node.js ä¸­çš„ <code>--tls-min-v1.3</code> é€‰é¡¹æŒ‡å®šäº† TLS ç‰ˆæœ¬ 1.3 ä½œä¸ºä¸å®¢æˆ·ç«¯æ²Ÿé€šæ—¶æ‰€èƒ½æ¥å—çš„æœ€ä½æ ‡å‡†ã€‚TLS 1.3 æ˜¯ç›¸å¯¹è¾ƒæ–°çš„ TLS ç‰ˆæœ¬ï¼Œå®ƒæ¯”ä¹‹å‰çš„ç‰ˆæœ¬ï¼ˆå¦‚ TLS 1.2ï¼‰æä¾›äº†æ›´å¥½çš„å®‰å…¨æ€§å’Œæ€§èƒ½ä¼˜åŠ¿ã€‚</p><p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šè¿™ä¸ªé€‰é¡¹çš„å…·ä½“åº”ç”¨ï¼š</p><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª HTTPS æœåŠ¡å™¨ï¼Œè¿™ä¸ªæœåŠ¡å™¨ç”¨äºå¤„ç†æ•æ„Ÿçš„ç”¨æˆ·æ•°æ®ï¼Œæ¯”å¦‚ç”µå•†ç½‘ç«™çš„æ”¯ä»˜æµç¨‹ã€‚å› ä¸ºæ¶‰åŠåˆ°é‡‘èäº¤æ˜“ï¼Œæ‰€ä»¥éœ€è¦ä¿è¯å°½å¯èƒ½é«˜çš„å®‰å…¨æ ‡å‡†ã€‚</p><p>åœ¨ç¼–å†™ Node.js ä»£ç å‰ï¼Œä½ å¯èƒ½ä¼šæœ‰ç±»ä¼¼ä»¥ä¸‹çš„ç®€å• HTTPS æœåŠ¡å™¨ä»£ç ç‰‡æ®µï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é…ç½® HTTPS æœåŠ¡å™¨çš„é€‰é¡¹ï¼ŒåŒ…æ‹¬ SSL è¯ä¹¦å’Œå¯†é’¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç§é’¥æ–‡ä»¶è·¯å¾„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  cert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯ä¹¦æ–‡ä»¶è·¯å¾„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»º HTTPS æœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œåœ¨å¯åŠ¨æ­¤ HTTPS æœåŠ¡å™¨æ—¶ï¼Œä½ å¸Œæœ›ç¡®ä¿ä»…å…è®¸ä½¿ç”¨ TLS 1.3 åè®®çš„å®¢æˆ·ç«¯è¿æ¥ã€‚è¿™æ—¶å€™å°±å¯ä»¥åœ¨å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨ <code>--tls-min-v1.3</code> é€‰é¡¹ã€‚ä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­æŒ‰ç…§ä»¥ä¸‹æ–¹å¼è¿è¡Œä½ çš„ Node.js åº”ç”¨ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --tls-min-v1.3</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-server-file.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤å‘Šè¯‰ Node.jsï¼Œå½“ HTTPS æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯å»ºç«‹è¿æ¥æ—¶ï¼Œåªèƒ½å¤Ÿæ¥å—ä½¿ç”¨è‡³å°‘æ˜¯ TLS 1.3 ç‰ˆæœ¬çš„è¿æ¥è¯·æ±‚ã€‚å¦‚æœæœ‰å®¢æˆ·ç«¯å°è¯•ä½¿ç”¨ TLS 1.2 æˆ–æ›´æ—©çš„ç‰ˆæœ¬æ¥è¿›è¡Œè¿æ¥ï¼Œåˆ™è¿æ¥å°†è¢«æ‹’ç»ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>--tls-min-v1.3</code> æ˜¯ä¸€ä¸ªå¯åŠ¨å‚æ•°ï¼Œç”¨äºè®¾ç½® Node.js åº”ç”¨ç¨‹åºæ¥å—çš„æœ€ä½ TLS ç‰ˆæœ¬ã€‚ä½¿ç”¨æ­¤å‚æ•°å¯ä»¥å¢å¼ºåº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ï¼Œå°¤å…¶é€‚åˆé‚£äº›è¦æ±‚é«˜å®‰å…¨æ ‡å‡†çš„ç¯å¢ƒï¼Œå¦‚é‡‘èæœåŠ¡ã€åŒ»ç–—æ•°æ®å¤„ç†ç­‰åœºæ™¯ã€‚</p><h3 id="trace-atomics-wait" tabindex="-1"><a class="header-anchor" href="#trace-atomics-wait"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--trace-atomics-wait" target="_blank" rel="noopener noreferrer">--trace-atomics-wait</a></span></a></h3><p>Node.js çš„ <code>--trace-atomics-wait</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒç”¨äºè·Ÿè¸ªç¨‹åºä¸­åŸå­æ“ä½œçš„ç­‰å¾…äº‹ä»¶ã€‚åœ¨è¯¦ç»†è§£é‡Šè¿™ä¸ªé€‰é¡¹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ Node.js ä¸­çš„å‡ ä¸ªæ¦‚å¿µï¼šåŸå­æ“ä½œã€Atomics å’Œ SharedArrayBufferã€‚</p><p><strong>åŸå­æ“ä½œ (Atomic operations)</strong>ï¼š<br> åŸå­æ“ä½œæ˜¯ä¸å¯åˆ†å‰²çš„æ“ä½œï¼Œå®ƒä»¬åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šè¢«å…¶ä»–ä»£ç å¹²æ‰°ã€‚å½“å¤šä¸ªçº¿ç¨‹æˆ–è€…å·¥ä½œè¿›ç¨‹å°è¯•åŒæ—¶ä¿®æ”¹åŒä¸€æ•°æ®æ—¶ï¼ŒåŸå­æ“ä½œç¡®ä¿äº†æ•°æ®çš„å®Œæ•´æ€§ã€‚</p><p><strong>Atomics</strong>ï¼š<br> Atomics æ˜¯ä¸€ä¸ª JavaScript çš„å†…ç½®å¯¹è±¡ï¼Œæä¾›äº†ä¸€ç»„é™æ€æ–¹æ³•ç”¨äºåœ¨ <code>SharedArrayBuffer</code> ä¸Šæ‰§è¡ŒåŸå­æ“ä½œã€‚ä¾‹å¦‚ï¼Œ<code>Atomics.add</code> å¯ä»¥å®‰å…¨åœ°å¯¹å…±äº«å†…å­˜ä¸­çš„å€¼è¿›è¡ŒåŠ æ³•æ“ä½œï¼Œè€Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹å¹²æ‰°ã€‚</p><p><strong>SharedArrayBuffer</strong>ï¼š<br><code>SharedArrayBuffer</code> æ˜¯ JavaScript çš„ä¸€ä¸ªå…¨å±€æ„é€ å‡½æ•°ï¼Œå®ƒç”¨äºåˆ›å»ºä¸€ä¸ªå¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å…±äº«çš„å›ºå®šé•¿åº¦çš„äºŒè¿›åˆ¶æ•°æ®ç¼“å†²åŒºã€‚</p><p>åœ¨ä¸€äº›å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¯èƒ½å‡ºç°ä¸€ä¸ªçº¿ç¨‹éœ€è¦ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒæŸäº›æ“ä½œåå†ç»§ç»­æ‰§è¡Œçš„æƒ…å½¢ã€‚è¿™å°±æ¶‰åŠåˆ°äº†åŸå­æ€§çš„â€œç­‰å¾…â€æœºåˆ¶ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªå·¥ä½œè€…çº¿ç¨‹ä¸­ï¼Œä½ å¯èƒ½æƒ³è¦ç­‰å¾…å¦ä¸€ä¸ªå·¥ä½œè€…çº¿ç¨‹å°†æŸä¸ªå…±äº«çš„ <code>SharedArrayBuffer</code> ä¸­çš„å€¼æ›´æ–°ä¸ºç‰¹å®šçš„æ•°å€¼ã€‚</p><p>ä½¿ç”¨ <code>Atomics.wait</code> æ–¹æ³•å¯ä»¥å®ç°è¿™æ ·çš„ç­‰å¾…æœºåˆ¶ã€‚<code>Atomics.wait</code> ä¼šé˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹é€šè¿‡ <code>Atomics.notify</code> æ–¹æ³•é€šçŸ¥å®ƒç»§ç»­æ‰§è¡Œæˆ–è€…è¶…æ—¶ã€‚</p><p>ç°åœ¨æ¥çœ‹ <code>--trace-atomics-wait</code> é€‰é¡¹ï¼š</p><p>å½“ä½ è¿è¡Œä¸€ä¸ª Node.js ç¨‹åºæ—¶ï¼Œå¦‚æœä½ åŠ ä¸Šäº† <code>--trace-atomics-wait</code> é€‰é¡¹ï¼Œé‚£ä¹ˆæ¯å½“ç¨‹åºä¸­å‡ºç° <code>Atomics.wait</code> è¢«è°ƒç”¨çš„æƒ…å†µï¼ŒNode.js å°±ä¼šæ‰“å°ç›¸å…³ä¿¡æ¯åˆ°æ§åˆ¶å°ã€‚è¿™æœ‰åŠ©äºå¼€å‘è€…äº†è§£ç¨‹åºä¸­çš„åŸå­ç­‰å¾…äº‹ä»¶ä½•æ—¶å‘ç”Ÿï¼Œä»¥åŠå®ƒä»¬çš„æ‰§è¡Œæƒ…å†µã€‚</p><p>å®é™…ä¾‹å­ï¼š<br> å‡è®¾ä½ æœ‰ä¸€ä¸ª Node.js ç¨‹åºï¼Œå®ƒä½¿ç”¨ä¸¤ä¸ªå·¥ä½œè€…çº¿ç¨‹ï¼ˆWorker threadsï¼‰ï¼Œä¸€ä¸ªè´Ÿè´£å†™å…¥å…±äº«æ•°æ®ï¼Œå¦ä¸€ä¸ªåœ¨æ•°æ®å†™å…¥åè¿›è¡Œå¤„ç†ã€‚ç¬¬äºŒä¸ªçº¿ç¨‹éœ€è¦ç­‰å¾…ç¬¬ä¸€ä¸ªçº¿ç¨‹å†™å…¥å®Œæˆåå†å¼€å§‹å·¥ä½œã€‚ä»£ç å¤§è‡´å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">  Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">  isMainThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">  parentPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">  workerData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;worker_threads&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Atomics</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">SharedArrayBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;atomic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">isMainThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä¸»çº¿ç¨‹ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> sharedBuffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> SharedArrayBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ†é…å…±äº«å†…å­˜</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> sharedArray</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Int32Array</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">sharedBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> worker</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">__filename</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">workerData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">sharedArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è®¾ç½®å…±äº«æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  Atomics</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">store</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">sharedArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">123</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // é€šçŸ¥å·¥ä½œè€…çº¿ç¨‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  Atomics</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">notify</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">sharedArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å·¥ä½œè€…çº¿ç¨‹ä»£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> sharedArray</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> workerData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Worker waiting...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  Atomics</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">wait</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">sharedArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ç»è¿‡ notify å”¤é†’åç»§ç»­æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Worker woke up:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Atomics</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">load</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">sharedArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿è¡Œè¯¥ç¨‹åºæ—¶ï¼Œä½¿ç”¨ --trace-atomics-wait:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// node --trace-atomics-wait myProgram.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœä½ åœ¨è¿è¡Œè¿™ä¸ªç¨‹åºæ—¶åŠ ä¸Š <code>--trace-atomics-wait</code> é€‰é¡¹ï¼Œé‚£ä¹ˆæ¯å½“ <code>Atomics.wait</code> è¢«è°ƒç”¨æ—¶ï¼Œä½ å°†ä¼šåœ¨æ§åˆ¶å°çœ‹åˆ°ç›¸å…³çš„è·Ÿè¸ªä¿¡æ¯ã€‚è¿™æœ‰åŠ©äºä½ ç†è§£å·¥ä½œè€…çº¿ç¨‹æ˜¯å¦‚ä½•è¢«é˜»å¡å’Œå”¤é†’çš„ï¼Œä»è€Œå¸®åŠ©è°ƒè¯•å¹¶å‘ç›¸å…³çš„é—®é¢˜ã€‚</p><h3 id="trace-deprecation" tabindex="-1"><a class="header-anchor" href="#trace-deprecation"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--trace-deprecation" target="_blank" rel="noopener noreferrer">--trace-deprecation</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ JavaScript ä»£ç ã€‚åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ä¸€äº›æ–¹æ³•æˆ–è€…åŠŸèƒ½ï¼Œéšç€ Node.js ç‰ˆæœ¬çš„æ›´æ–°ï¼Œæœ‰äº›æ–¹æ³•å¯èƒ½ä¼šè¢«åºŸå¼ƒï¼ˆdeprecateï¼‰ï¼Œæ„å‘³ç€å®ƒä»¬ä¸å†æ¨èä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æœªæ¥å¯èƒ½ä¼šè¢«å½»åº•ç§»é™¤ã€‚</p><p>å½“ä½ åœ¨ Node.js ä¸­ä½¿ç”¨äº†ä¸€ä¸ªå·²ç»è¢«æ ‡è®°ä¸ºåºŸå¼ƒçš„ç‰¹æ€§æˆ–è€…æ–¹æ³•æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js ä¸ä¼šç»™å‡ºä»»ä½•æç¤ºã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³è¦è¿½è¸ªè¿™äº›åºŸå¼ƒçš„ç‰¹æ€§ï¼Œä»¥ä¾¿çŸ¥é“è‡ªå·±çš„ä»£ç ä¸­å“ªäº›éƒ¨åˆ†éœ€è¦æ›´æ–°æˆ–æ›¿æ¢ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>--trace-deprecation</code>è¿™ä¸ªå‘½ä»¤è¡Œæ ‡å¿—ã€‚</p><p>å½“ä½ å¯åŠ¨ Node.js ç¨‹åºæ—¶ï¼Œåœ¨å‘½ä»¤è¡Œä¸­åŠ ä¸Š<code>--trace-deprecation</code>æ ‡å¿—ï¼Œå¦‚æœç¨‹åºä¸­ç”¨åˆ°äº†åºŸå¼ƒçš„ç‰¹æ€§ï¼ŒNode.js å°†ä¼šæ‰“å°ä¸€ä¸ªæ ˆè·Ÿè¸ªåˆ°æ§åˆ¶å°ã€‚è¿™ä¸ªæ ˆè·Ÿè¸ªä¼šå‘Šè¯‰ä½ åºŸå¼ƒç‰¹æ€§æ˜¯åœ¨å“ªé‡Œè¢«è°ƒç”¨çš„ï¼Œå¸®åŠ©ä½ å¿«é€Ÿå®šä½é—®é¢˜æ‰€åœ¨ã€‚</p><p>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š<br> å‡è®¾ä½ çš„ Node.js åº”ç”¨ç¨‹åºå«<code>app.js</code>ï¼Œè€Œä¸”ä½ æ€€ç–‘å®ƒç”¨åˆ°äº† Node.js ä¸­å·²ç»åºŸå¼ƒçš„ APIã€‚ä¸ºäº†ç¡®è®¤è¿™ä¸€ç‚¹å¹¶æ‰¾åˆ°å…·ä½“ä½ç½®ï¼Œä½ å¯ä»¥è¿™æ ·å¯åŠ¨ä½ çš„åº”ç”¨ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --trace-deprecation</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœ<code>app.js</code>ä¸­æœ‰åºŸå¼ƒçš„ API è¢«è°ƒç”¨ï¼Œä½ ä¼šåœ¨å‘½ä»¤è¡Œè¾“å‡ºä¸­çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„ä¿¡æ¯ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>(node:12345) [DEP0005] DeprecationWarning: Buffer() is deprecated due to security and usability issues. Please use the Buffer.alloc(), Buffer.allocUnsafe(), or Buffer.from() methods instead.</span></span>
<span class="line"><span>    at showDeprecation (internal/process/warning.js:181:19)</span></span>
<span class="line"><span>    at new Buffer (internal/buffer.js:188:5)</span></span>
<span class="line"><span>    at Object.`&lt;`anonymous&gt; (/path/to/app.js:2:14)</span></span>
<span class="line"><span>    at Module._compile (module.js:652:30)</span></span>
<span class="line"><span>    ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªè¾“å‡ºä¸­ï¼Œ<code>(node:12345)</code> æ˜¯è¿›ç¨‹ IDï¼Œ<code>[DEP0005]</code> æ˜¯ç‰¹å®šçš„åºŸå¼ƒè­¦å‘Šç ï¼Œ<code>DeprecationWarning</code> åé¢çš„æ–‡æœ¬ä¼šå‘Šè¯‰ä½ å“ªä¸ª API æˆ–åŠŸèƒ½è¢«åºŸå¼ƒä»¥åŠæ¨èçš„æ›¿ä»£æ–¹æ¡ˆã€‚åé¢è·Ÿç€çš„æ ˆè·Ÿè¸ªä¼šæ˜¾ç¤ºå‡ºè°ƒç”¨åºŸå¼ƒ API çš„ç¡®åˆ‡ä½ç½®ã€‚</p><p>é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œä½ å¯ä»¥æ›´å®¹æ˜“åœ°ç»´æŠ¤å’Œæ›´æ–°ä½ çš„ Node.js åº”ç”¨ç¨‹åºï¼Œä¿æŒä»£ç çš„ç°ä»£æ€§å’Œå®‰å…¨æ€§ã€‚</p><h3 id="trace-event-categories" tabindex="-1"><a class="header-anchor" href="#trace-event-categories"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--trace-event-categories" target="_blank" rel="noopener noreferrer">--trace-event-categories</a></span></a></h3><p>Node.js çš„ <code>--trace-event-categories</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨äºå¯åŠ¨ Node.js åº”ç”¨æ—¶è¿½è¸ªç‰¹å®šçš„äº‹ä»¶ç±»å‹ã€‚è¿™ä¸ªåŠŸèƒ½é€‚ç”¨äºéœ€è¦è¯Šæ–­æ€§èƒ½é—®é¢˜æˆ–è€…ç†è§£åº”ç”¨åœ¨è¿è¡Œæ—¶å‘ç”Ÿäº†ä»€ä¹ˆçš„åœºæ™¯ã€‚</p><p>å½“ä½ è¿è¡Œä¸€ä¸ª Node.js åº”ç”¨æ—¶ï¼Œå®ƒä¼šè¿›è¡Œå¾ˆå¤šå†…éƒ¨æ“ä½œï¼Œæ¯”å¦‚æ‰§è¡Œ JavaScript ä»£ç ã€è¿›è¡Œåƒåœ¾å›æ”¶ã€å¤„ç†å¼‚æ­¥æ“ä½œç­‰ã€‚è¿™äº›æ“ä½œéƒ½å¯ä»¥åˆ†æˆä¸åŒçš„â€œç±»åˆ«â€æˆ–â€œäº‹ä»¶â€ã€‚ä½¿ç”¨ <code>--trace-event-categories</code> å¯ä»¥è®©ä½ é€‰æ‹©æ€§åœ°è®°å½•è¿™äº›äº‹ä»¶çš„ä¿¡æ¯ï¼Œç”Ÿæˆä¸€ä¸ªè¿½è¸ªæ—¥å¿—æ–‡ä»¶ï¼Œç„¶åä½ å¯ä»¥ç”¨å„ç§å·¥å…·æ¥åˆ†æè¿™ä¸ªæ–‡ä»¶ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£åº”ç”¨çš„è¿è¡Œç»†èŠ‚ã€‚</p><p>ä½¿ç”¨å®ä¾‹ï¼š</p><ol><li><p><strong>æ€§èƒ½è°ƒä¼˜</strong>ï¼šå‡è®¾ä½ æœ‰ä¸€ä¸ª Node.js ç¨‹åºï¼Œå®ƒè¿è¡Œå¾—æ¯”é¢„æœŸæ…¢ã€‚ä½ æƒ³è¦äº†è§£æ˜¯å“ªä¸€éƒ¨åˆ†ä»£ç å¯¼è‡´äº†æ€§èƒ½ç“¶é¢ˆã€‚ä½ å¯ä»¥å¼€å¯å‡½æ•°è°ƒç”¨çš„è¿½è¸ªæ¥æŸ¥çœ‹æ¯ä¸ªå‡½æ•°è°ƒç”¨å’Œè€—æ—¶ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --trace-event-categories</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> v8,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> node.async_hooks</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¸ªå‘½ä»¤ä¼šè®°å½•ä¸ V8 å¼•æ“ç›¸å…³çš„äº‹ä»¶ï¼ˆæ¯”å¦‚åƒåœ¾å›æ”¶ã€JIT ç¼–è¯‘ç­‰ï¼‰å’Œå¼‚æ­¥é’©å­çš„äº‹ä»¶ï¼Œå¹¶æŠŠå®ƒä»¬å†™å…¥åˆ°ä¸€ä¸ªè¿½è¸ªæ—¥å¿—ä¸­ã€‚éšåï¼Œä½ å¯ä»¥ä½¿ç”¨è¯¸å¦‚ Chrome å¼€å‘è€…å·¥å…·ä¸­çš„ Performance æˆ–è€… Trace Event Profiling Tool æ¥åˆ†æè¿™äº›äº‹ä»¶ã€‚</p></li><li><p><strong>è°ƒè¯•å¼‚æ­¥æ“ä½œ</strong>ï¼šNode.js ä¸­å¤§é‡ä½¿ç”¨å¼‚æ­¥æ“ä½œï¼Œæœ‰æ—¶å€™ä½ å¯èƒ½ä¼šé‡åˆ°è¯¸å¦‚&quot;callback hell&quot;æˆ–è€…å¼‚æ­¥æ“ä½œé¡ºåºæ··ä¹±çš„é—®é¢˜ã€‚é€šè¿‡è¿½è¸ªå¼‚æ­¥æ“ä½œçš„ç±»åˆ«ï¼Œä½ å¯ä»¥æ›´å¥½åœ°ç†è§£è¿™äº›æ“ä½œçš„æ‰§è¡Œé¡ºåºå’Œæ—¶é—´çº¿ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --trace-event-categories</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> node.async_hooks</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨åˆ†æå®Œç”Ÿæˆçš„è¿½è¸ªæ–‡ä»¶åï¼Œä½ å°†èƒ½å¤Ÿçœ‹åˆ°å„ç§å¼‚æ­¥äº‹ä»¶ä½•æ—¶å¼€å§‹ã€ä½•æ—¶ç»“æŸï¼Œä»è€Œå¸®åŠ©ä½ å®šä½é—®é¢˜æ‰€åœ¨ã€‚</p></li><li><p><strong>ç›‘æ§ç½‘ç»œæ´»åŠ¨</strong>ï¼šå¦‚æœä½ çš„åº”ç”¨æ¶‰åŠåˆ°ç½‘ç»œè¯·æ±‚ï¼Œä½ å¯èƒ½æƒ³è¦è¿½è¸ªç½‘ç»œæ´»åŠ¨æ¥ç¡®è®¤è¯·æ±‚æ˜¯å¦æˆåŠŸã€è€—æ—¶å¤šå°‘ä»¥åŠå¯èƒ½å­˜åœ¨çš„æ€§èƒ½é—®é¢˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥æŒ‡å®šç½‘ç»œç›¸å…³çš„äº‹ä»¶ç±»åˆ«ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --trace-event-categories</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> node.http,node.net</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ä¼šè®°å½•æ‰€æœ‰ HTTP å’Œåº•å±‚ç½‘ç»œçš„ç›¸å…³äº‹ä»¶ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œ<code>--trace-event-categories</code> æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„é€‰é¡¹ï¼Œå®ƒå…è®¸ä½ æ ¹æ®éœ€æ±‚é€‰æ‹©è¦è¿½è¸ªçš„äº‹ä»¶ç±»åˆ«ã€‚é€šè¿‡åˆ†æè¿™äº›è¿½è¸ªæ•°æ®ï¼Œä½ å¯ä»¥æ·±å…¥äº†è§£ä½ çš„åº”ç”¨çš„è¿è¡Œæœºåˆ¶ï¼Œä¼˜åŒ–æ€§èƒ½ï¼Œæˆ–è€…è§£å†³å¤æ‚çš„ bugã€‚</p><h3 id="trace-event-file-pattern" tabindex="-1"><a class="header-anchor" href="#trace-event-file-pattern"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--trace-event-file-pattern" target="_blank" rel="noopener noreferrer">--trace-event-file-pattern</a></span></a></h3><p><code>--trace-event-file-pattern</code> æ˜¯ Node.js å‘½ä»¤è¡Œé€‰é¡¹ï¼ˆCLIï¼‰ä¹‹ä¸€ï¼Œç”¨äºé…ç½®ç”Ÿæˆçš„ trace äº‹ä»¶æ—¥å¿—æ–‡ä»¶çš„å‘½åæ¨¡å¼ã€‚Node.js çš„ trace äº‹ä»¶æ—¥å¿—åŠŸèƒ½å…è®¸ä½ è®°å½• Node.js è¿è¡Œæ—¶å‘ç”Ÿçš„å„ç§ç³»ç»Ÿçº§æˆ–åº”ç”¨çº§äº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶å¯ä»¥å¸®åŠ©ä½ è¿›è¡Œæ€§èƒ½åˆ†ææˆ–è°ƒè¯•ã€‚</p><p>åœ¨ Node.js ä¸­ä½¿ç”¨ <code>--trace-event-file-pattern</code> æ—¶ï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªåŒ…å«å ä½ç¬¦çš„å­—ç¬¦ä¸²ï¼ŒNode.js ä¼šæ ¹æ®è¿™ä¸ªæ¨¡å¼æ¥ä¸ºæ¯ä¸ªè¾“å‡ºçš„ trace æ–‡ä»¶å‘½åã€‚è¯¥åŠŸèƒ½åœ¨ Node.js v10.10.0 ä¸­å¼•å…¥ï¼Œä»¥æ›´çµæ´»åœ°ç®¡ç† trace æ—¥å¿—æ–‡ä»¶çš„åç§°å’Œå­˜å‚¨ä½ç½®ã€‚</p><h3 id="å ä½ç¬¦" tabindex="-1"><a class="header-anchor" href="#å ä½ç¬¦"><span>å ä½ç¬¦</span></a></h3><p>ä»¥ä¸‹æ˜¯å‡ ä¸ªå¯ç”¨çš„å ä½ç¬¦ï¼š</p><ul><li><code>%p</code> - è¿›ç¨‹ ID (PID)</li><li><code>%t</code> - æ—¶é—´æˆ³</li><li><code>%%</code> - ç™¾åˆ†å·å­—ç¬¦ (<code>%</code>)</li><li><code>%h</code> - ä¸»æœºå</li><li><code>%m</code> - å†…å­˜ä½¿ç”¨é‡</li></ul><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ è®¾ç½® <code>--trace-event-file-pattern</code> ä¸º <code>node_trace.%p.log</code>ï¼Œé‚£ä¹ˆ Node.js å°†ä¼šæŠŠ trace æ—¥å¿—è®°å½•åˆ°ç±»ä¼¼ <code>node_trace.12345.log</code> çš„æ–‡ä»¶ä¸­ï¼Œå…¶ä¸­ <code>12345</code> å°±æ˜¯è¿›ç¨‹ IDã€‚</p><h3 id="ä½¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ç¤ºä¾‹"><span>ä½¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ åœ¨è¿›è¡Œ Node.js åº”ç”¨çš„æ€§èƒ½åˆ†æï¼Œä½ æƒ³è¦æ”¶é›† trace äº‹ä»¶æ•°æ®ã€‚è¿™é‡Œæœ‰å‡ ä¸ªå¦‚ä½•ä½¿ç”¨ <code>--trace-event-file-pattern</code> çš„ä¾‹å­ï¼š</p><ol><li><p><strong>åŸºæœ¬ä½¿ç”¨ï¼š</strong></p><p>å‘½ä»¤è¡Œå¯åŠ¨ Node.js åº”ç”¨å¹¶æŒ‡å®š trace æ–‡ä»¶çš„å‘½åæ¨¡å¼ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --trace-events-enabled</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --trace-event-file-pattern=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;trace.%p.%t.log&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™å°†æ ¹æ®å½“å‰çš„è¿›ç¨‹ ID å’Œæ—¶é—´æˆ³ç”Ÿæˆä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œæ¯”å¦‚ <code>trace.12345.1611691023963.log</code>ã€‚</p></li><li><p><strong>è¯¦ç»†é…ç½®ï¼š</strong></p><p>å¦‚æœä½ è¿è¡Œå¤šä¸ª Node.js åº”ç”¨å®ä¾‹ï¼Œå¹¶ä¸”å®ƒä»¬éƒ½éƒ¨ç½²åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œä½ å¯èƒ½æƒ³è¦åŒæ—¶åŒ…æ‹¬ä¸»æœºåå’Œ PID æ¥ç¡®ä¿æ–‡ä»¶åå”¯ä¸€ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --trace-events-enabled</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --trace-event-file-pattern=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/var/log/nodejs/trace-%h-%p.log&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¸ªå‘½ä»¤ä¼šåœ¨ <code>/var/log/nodejs/</code> ç›®å½•ä¸‹åˆ›å»ºç±»ä¼¼ <code>trace-myserver-12345.log</code> çš„æ–‡ä»¶åã€‚</p></li><li><p><strong>ç¯å¢ƒé…åˆï¼š</strong></p><p>åœ¨å¤æ‚çš„éƒ¨ç½²ç¯å¢ƒä¸­ï¼Œä½ å¯èƒ½æƒ³è¦é€šè¿‡å¤–éƒ¨è„šæœ¬è®¾ç½® trace æ–‡ä»¶çš„è·¯å¾„å’Œæ¨¡å¼ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">NODE_TRACE_EVENTS_ENABLED</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NODE_TRACE_EVENT_FILE_PATTERN</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/logs/trace-%p-%m.log&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¸ªç¯å¢ƒå˜é‡çš„è®¾ç½®å°†ä¼šåˆ›å»ºåƒ <code>/logs/trace-12345-456789.log</code> è¿™æ ·çš„æ–‡ä»¶åï¼Œå…¶ä¸­ <code>456789</code> å¯èƒ½æ˜¯å†…å­˜ä½¿ç”¨é‡çš„æŒ‡æ ‡ã€‚</p></li></ol><h3 id="æ³¨æ„äº‹é¡¹-4" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-4"><span>æ³¨æ„äº‹é¡¹</span></a></h3><ul><li>ç¡®ä¿æŒ‡å®šçš„ç›®å½•å­˜åœ¨ï¼Œå¦åˆ™ Node.js å¯èƒ½æ— æ³•å†™å…¥ trace æ–‡ä»¶ã€‚</li><li>ä½¿ç”¨ trace äº‹ä»¶æ—¥å¿—æ—¶ï¼Œéœ€äº†è§£è¿™å¯èƒ½ä¼šå½±å“åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œå› ä¸ºè®°å½•å’Œå†™å…¥æ–‡ä»¶éœ€è¦æ¶ˆè€—é¢å¤–èµ„æºã€‚</li><li>åˆ†æç”Ÿæˆçš„ trace äº‹ä»¶æ—¥å¿—æ–‡ä»¶ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨ä¸“é—¨çš„å·¥å…·æˆ–åº“ï¼Œå¦‚ Chrome DevToolsã€<code>trace_events</code> æ¨¡å—ç­‰ã€‚</li></ul><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>--trace-event-file-pattern</code> æ˜¯ä¸€ä¸ªç”¨äºè‡ªå®šä¹‰ Node.js äº‹ä»¶è·Ÿè¸ªæ—¥å¿—æ–‡ä»¶åçš„å¼ºå¤§å·¥å…·ï¼Œé€šè¿‡åˆç†é…ç½®å¯ä»¥æœ‰æ•ˆåœ°å¸®åŠ©å¼€å‘è€…ç»„ç»‡å’Œæ£€ç´¢æ€§èƒ½æ•°æ®ã€‚</p><h3 id="trace-events-enabled" tabindex="-1"><a class="header-anchor" href="#trace-events-enabled"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--trace-events-enabled" target="_blank" rel="noopener noreferrer">--trace-events-enabled</a></span></a></h3><p><code>--trace-events-enabled</code> æ˜¯ Node.js å‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰çš„ä¸€ä¸ªé€‰é¡¹ï¼Œå®ƒå…è®¸ä½ å¯ç”¨è·Ÿè¸ªäº‹ä»¶ã€‚å½“ä½ åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ è¿™ä¸ªé€‰é¡¹æ¥æ”¶é›†åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œè¯Šæ–­ä¿¡æ¯ã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹â€œè·Ÿè¸ªäº‹ä»¶â€æ˜¯ä»€ä¹ˆï¼š</p><p>è·Ÿè¸ªäº‹ä»¶æ˜¯æŒ‡åº”ç”¨ç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸€ç³»åˆ—è®°å½•ç‚¹ï¼Œè¿™äº›è®°å½•ç‚¹åŒ…å«äº†å„ç§ä¿¡æ¯ï¼Œæ¯”å¦‚å‡½æ•°è°ƒç”¨çš„æ—¶é—´ã€æŒç»­æ—¶é—´ã€èµ„æºä½¿ç”¨æƒ…å†µç­‰ã€‚é€šè¿‡åˆ†æè¿™äº›è®°å½•ç‚¹ï¼Œå¼€å‘äººå‘˜å¯ä»¥äº†è§£åˆ°åº”ç”¨ç¨‹åºçš„è¿è¡ŒçŠ¶å†µï¼Œå¹¶æ‰¾å‡ºæ½œåœ¨çš„æ€§èƒ½ç“¶é¢ˆæˆ–é—®é¢˜æ‰€åœ¨ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œå¯ç”¨ <code>--trace-events-enabled</code> ä¼šç”Ÿæˆä¸€ä¸ªåä¸º <code>trace_events.json</code> çš„æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«äº†è·Ÿè¸ªäº‹ä»¶çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘å°†é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­å±•ç¤ºå¦‚ä½•ä½¿ç”¨ <code>--trace-events-enabled</code>ï¼š</p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªç®€å•çš„ Node.js è„šæœ¬ <code>app.js</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> doWork</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™ä¸ªå‡½æ•°æ¨¡æ‹Ÿäº†ä¸€äº›å·¥ä½œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sum</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `&lt;`</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1e6</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    sum</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sum</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å¼€å§‹å·¥ä½œ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> doWork</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å·¥ä½œå®Œæˆï¼Œç»“æœæ˜¯: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ç»ˆç«¯ä¸­ï¼Œä½ é€šå¸¸ä¼šåƒä¸‹é¢è¿™æ ·è¿è¡Œä½ çš„è„šæœ¬ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœè¦å¯ç”¨è·Ÿè¸ªäº‹ä»¶ï¼Œä½ éœ€è¦åœ¨è¿è¡Œè„šæœ¬æ—¶æ·»åŠ  <code>--trace-events-enabled</code> é€‰é¡¹ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --trace-events-enabled</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿è¡Œä¸Šè¿°å‘½ä»¤åï¼ŒNode.js ä¼šåœ¨è„šæœ¬æ‰§è¡Œçš„åŒæ—¶æ”¶é›†è·Ÿè¸ªä¿¡æ¯ï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨å½“å‰ç›®å½•ä¸‹çš„ <code>trace_events.json</code> æ–‡ä»¶ä¸­ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸åŒçš„å·¥å…·æ¥æŸ¥çœ‹å’Œåˆ†æè¿™ä¸ª <code>trace_events.json</code> æ–‡ä»¶ï¼Œä¸€ä¸ªå¸¸ç”¨çš„å·¥å…·æ˜¯ Chrome æµè§ˆå™¨çš„ Chrome DevToolsï¼š</p><ol><li>æ‰“å¼€ Chrome æµè§ˆå™¨ã€‚</li><li>æŒ‰ F12 æ‰“å¼€ Chrome DevToolsã€‚</li><li>è½¬åˆ° &quot;Performance&quot; æ ‡ç­¾ã€‚</li><li>ç‚¹å‡» &quot;Load profile&quot; æŒ‰é’®ï¼ŒåŠ è½½ä¹‹å‰ç”Ÿæˆçš„ <code>trace_events.json</code> æ–‡ä»¶ã€‚</li></ol><p>é€šè¿‡åˆ†æåŠ è½½åçš„è·Ÿè¸ªæ•°æ®ï¼Œä½ å°±å¯ä»¥çœ‹åˆ°è„šæœ¬è¿è¡ŒæœŸé—´çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚æ¯ä¸ªå‡½æ•°è°ƒç”¨çš„æ—¶é—´å’ŒæŒç»­æ—¶é—´ç­‰ã€‚åˆ©ç”¨è¿™äº›ä¿¡æ¯ï¼Œä½ å¯ä»¥å¼€å§‹ä¼˜åŒ–ä½ çš„ä»£ç ï¼Œæé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚</p><p>è®°ä½ï¼Œè·Ÿè¸ªäº‹ä»¶å¯èƒ½ä¼šäº§ç”Ÿå¤§é‡æ•°æ®ï¼Œå› æ­¤æœ€å¥½ä»…åœ¨è°ƒè¯•æˆ–æ€§èƒ½åˆ†ææ—¶å¯ç”¨æ­¤åŠŸèƒ½ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é¢‘ç¹ä½¿ç”¨å¯èƒ½ä¼šå½±å“åº”ç”¨ç¨‹åºæ€§èƒ½ã€‚</p><h3 id="trace-exit" tabindex="-1"><a class="header-anchor" href="#trace-exit"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--trace-exit" target="_blank" rel="noopener noreferrer">--trace-exit</a></span></a></h3><p>Node.js ä¸­çš„ <code>--trace-exit</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œä½ å¯ä»¥åœ¨è¿è¡Œ Node.js ç¨‹åºæ—¶ä½¿ç”¨å®ƒã€‚å½“ä½ æ·»åŠ è¿™ä¸ªå‚æ•°åï¼Œæ¯å½“ Node.js çš„è¿›ç¨‹å³å°†é€€å‡ºæ—¶ï¼Œå®ƒä¼šæ‰“å°ä¸€æ¡æ—¥å¿—æ¶ˆæ¯åˆ°æ§åˆ¶å°ï¼Œå‘Šè¯‰ä½ ç¨‹åºæ˜¯åœ¨å“ªä¸ªç‚¹å³å°†åœæ­¢æ‰§è¡Œã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œç¨‹åºå¯èƒ½ç”±äºå¤šç§åŸå› ç»“æŸè¿è¡Œï¼Œä¾‹å¦‚ï¼š</p><ul><li>ç¨‹åºæ‰§è¡Œå®Œæ¯•è‡ªç„¶é€€å‡ºã€‚</li><li>ä»£ç ä¸­æœ‰ <code>process.exit()</code> è¢«è°ƒç”¨ã€‚</li><li>å‘ç”Ÿæœªæ•è·çš„å¼‚å¸¸å¯¼è‡´è¿›ç¨‹é€€å‡ºã€‚</li></ul><p>æœ‰æ—¶å€™ï¼Œäº†è§£ç¨‹åºä¸ºä»€ä¹ˆä¼šé€€å‡ºå¾ˆé‡è¦ï¼Œç‰¹åˆ«æ˜¯åœ¨è°ƒè¯•å¤æ‚åº”ç”¨æˆ–è€…æœåŠ¡æ—¶ã€‚å¦‚æœä½ ä¸ç¡®å®šä¸ºä»€ä¹ˆä½ çš„ Node.js åº”ç”¨ç¨‹åºåœ¨æŸä¸ªç‰¹å®šç‚¹é€€å‡ºäº†ï¼Œ<code>--trace-exit</code> å¯ä»¥å¸®åŠ©ä½ æ‰¾åˆ°åŸå› ã€‚</p><h3 id="å®é™…ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-5"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªç®€å•çš„ Node.js è„šæœ¬ï¼Œå«åš <code>app.js</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿä¸€äº›å¤„ç†è¿‡ç¨‹</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Timeout finished.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾åœ¨æŸå¤„æœ‰æ„æˆ–æ— æ„åœ°è°ƒç”¨äº† process.exit()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">exit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ ç›´æ¥è¿è¡Œè¿™ä¸ªè„šæœ¬ï¼Œåªä¼šçœ‹åˆ° &quot;Hello, World!&quot; è¢«æ‰“å°å‡ºæ¥ï¼Œç„¶åç¨‹åºå°±é€€å‡ºäº†ï¼Œè€Œä¸”ä½ ä¸ä¼šçœ‹åˆ° &quot;Timeout finished.&quot;ï¼Œå› ä¸º <code>setTimeout</code> è¿˜æ²¡æœ‰å®Œæˆï¼Œç¨‹åºå·²ç»é€€å‡ºã€‚</p><p>ä½†æ˜¯å¦‚æœä½ æƒ³çŸ¥é“ä¸ºä»€ä¹ˆç¨‹åºé€€å‡ºäº†ï¼Œä½ å¯ä»¥åœ¨ Node.js å¯åŠ¨æ—¶åŠ ä¸Š <code>--trace-exit</code> å‚æ•°ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --trace-exit</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å½“ä½ è¿™æ ·è¿è¡Œè„šæœ¬æ—¶ï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>Hello, World!</span></span>
<span class="line"><span>(node:12345) WARNING: Exited the environment with code 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œçš„ <code>(node:12345)</code> æ˜¯ä½ çš„è¿›ç¨‹ IDï¼ˆPIDï¼‰ï¼Œå®ƒå‘Šè¯‰ä½ ä½ çš„ Node.js è¿›ç¨‹åœ¨æ­£å¸¸é€€å‡ºä¹‹å‰æ‰“å°äº†é€€å‡ºè­¦å‘Šã€‚è¿™ä¸ªä¿¡æ¯è¡¨æ˜ <code>process.exit()</code> è¢«è°ƒç”¨äº†ï¼Œå› æ­¤ç¨‹åºæå‰é€€å‡ºã€‚</p><p>é€šè¿‡ä½¿ç”¨ <code>--trace-exit</code>ï¼Œä½ èƒ½æ›´å®¹æ˜“åœ°è¯†åˆ«å’Œè°ƒè¯•ç¨‹åºçš„éæ­£å¸¸é€€å‡ºé—®é¢˜ã€‚è¿™ä¸ªé€‰é¡¹åœ¨å¼€å‘å¤§å‹åº”ç”¨æˆ–è¿›è¡Œå¤æ‚ç³»ç»Ÿç»´æŠ¤æ—¶å°¤å…¶æœ‰ç”¨ã€‚</p><h3 id="trace-sigint" tabindex="-1"><a class="header-anchor" href="#trace-sigint"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--trace-sigint" target="_blank" rel="noopener noreferrer">--trace-sigint</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ JavaScript ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨ JavaScript æ¥ç¼–å†™èƒ½å¤Ÿå¤„ç†ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶ç³»ç»Ÿæ“ä½œç­‰åå°ä»»åŠ¡çš„ç¨‹åºã€‚å…¶ä¸­ï¼ŒNode.js æä¾›äº†ä¸€ç³»åˆ—çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼ˆCLI optionsï¼‰ï¼Œå…è®¸å¼€å‘è€…æ›´ç²¾ç»†åœ°æ§åˆ¶å…¶è¡Œä¸ºã€‚</p><p><code>--trace-sigint</code> æ˜¯ Node.js çš„ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨äºè¿½è¸ª <code>SIGINT</code> ä¿¡å·ã€‚åœ¨è®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸­ï¼Œ<code>SIGINT</code> ä¿¡å·é€šå¸¸æ˜¯ç”±ç”¨æˆ·å‘é€çš„ï¼Œæ¯”å¦‚å½“ç”¨æˆ·æŒ‰ä¸‹ <code>Ctrl+C</code> æ—¶ï¼Œå®ƒä¼šå‘ŠçŸ¥æ­£åœ¨è¿è¡Œçš„ç¨‹åºè¦è¿›è¡Œä¸­æ–­æ“ä½œã€‚</p><p>é‚£ä¹ˆåœ¨ Node.js ä¸­ï¼Œå½“ä½ ä½¿ç”¨ <code>--trace-sigint</code> é€‰é¡¹å¯åŠ¨åº”ç”¨æ—¶ï¼Œæ¯å½“ Node.js æ¥æ”¶åˆ° <code>SIGINT</code> ä¿¡å·ï¼ŒNode.js å°±ä¼šæ‰“å°å‡ºä¸€ä¸ªå †æ ˆè·Ÿè¸ªï¼ˆstack traceï¼‰ã€‚è¿™ä¸ªå †æ ˆè·Ÿè¸ªå¯ä»¥å¸®åŠ©ä½ äº†è§£åœ¨æ¥æ”¶åˆ°ä¸­æ–­ä¿¡å·æ—¶ç¨‹åºçš„çŠ¶æ€ï¼Œç‰¹åˆ«æ˜¯å¯¹äºè°ƒè¯•æŸäº›å¯èƒ½å“åº” <code>SIGINT</code> çš„å¼‚æ­¥æ“ä½œæˆ–é•¿æ—¶é—´è¿è¡Œçš„å¤„ç†è¿‡ç¨‹éå¸¸æœ‰ç”¨ã€‚</p><p>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><ol><li><strong>è°ƒè¯•é•¿æ—¶é—´è¿è¡Œçš„æœåŠ¡å™¨</strong>ï¼š<br> å‡è®¾ä½ ç¼–å†™äº†ä¸€ä¸ª Node.js æœåŠ¡å™¨ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œå®ƒä¼šä¸åœåœ°è¿è¡Œï¼Œå¤„ç†è¿›æ¥çš„ç½‘ç»œè¯·æ±‚ã€‚å¦‚æœä½ æƒ³è¦åœ¨æœåŠ¡å™¨æ„å¤–ä¸­æ–­æ—¶ï¼ˆæ¯”å¦‚æŒ‰ä¸‹ <code>Ctrl+C</code>ï¼‰äº†è§£å…¶å½“æ—¶çš„çŠ¶æ€ï¼Œä½ å¯ä»¥å¯åŠ¨æœåŠ¡å™¨æ—¶åŠ ä¸Š <code>--trace-sigint</code> é€‰é¡¹ï¼š</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --trace-sigint</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> server.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å½“ä½ æŒ‰ä¸‹ <code>Ctrl+C</code> æ—¶ï¼ŒNode.js ä¼šæ‰“å°å‡ºæ­¤æ—¶çš„å †æ ˆè·Ÿè¸ªï¼Œæ˜¾ç¤ºå“ªäº›å‡½æ•°æ­£åœ¨æ‰§è¡Œï¼Œä»è€Œå¸®åŠ©ä½ ç†è§£ä¸­æ–­æ—¶çš„ç¨‹åºçŠ¶æ€ã€‚</p><ol start="2"><li><strong>å¼€å‘é˜¶æ®µçš„è„šæœ¬ç›‘æ§</strong>ï¼š<br> å¦‚æœä½ åœ¨å¼€å‘ä¸€ä¸ªè„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬æ¶‰åŠåˆ°å¤æ‚çš„å¼‚æ­¥æ“ä½œå¦‚æ•°æ®åº“äº¤äº’ã€æ–‡ä»¶è¯»å†™ç­‰ï¼Œå¹¶ä¸”è¿™ä¸ªè„šæœ¬å¶å°”ä¼šå› ä¸ºæœªçŸ¥åŸå› â€œæŒ‚èµ·â€æˆ–å“åº”å˜æ…¢ï¼Œä½ å¯ä»¥åœ¨è¿è¡Œè„šæœ¬æ—¶æ·»åŠ  <code>--trace-sigint</code>ï¼š</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --trace-sigint</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> myscript.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œå½“è„šæœ¬è¿è¡Œç¼“æ…¢æˆ–â€œæŒ‚èµ·â€æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡ <code>Ctrl+C</code> å¼ºåˆ¶ä¸­æ–­è„šæœ¬ï¼Œå¹¶ç«‹å³çœ‹åˆ°æ­¤æ—¶çš„å †æ ˆè·Ÿè¸ªï¼Œåˆ†æå½“å‰æ‰§è¡Œåˆ°å“ªé‡Œï¼Œå¯èƒ½æ˜¯å“ªéƒ¨åˆ†ä»£ç å¯¼è‡´äº†æ€§èƒ½é—®é¢˜æˆ–æ­»é”ã€‚</p><ol start="3"><li><strong>å­¦ä¹ å’Œæ•™è‚²</strong>ï¼š<br> å¦‚æœä½ åœ¨æ•™å­¦æˆ–å­¦ä¹ å¦‚ä½•å¤„ç† Node.js ä¸­çš„ä¿¡å·äº‹ä»¶ï¼Œä½¿ç”¨ <code>--trace-sigint</code> å¯ä»¥å¸®åŠ©å­¦ç”Ÿç†è§£ <code>SIGINT</code> ä¿¡å·è¢«æ•è·æ—¶ç¨‹åºå†…éƒ¨çš„æƒ…å†µï¼Œä¾‹å¦‚ä»–ä»¬å¯ä»¥ç¼–å†™ä¸€äº›å¤„ç† <code>SIGINT</code> çš„é€»è¾‘ï¼Œå¹¶é€šè¿‡ <code>--trace-sigint</code> è§‚å¯Ÿå’ŒéªŒè¯è¿™äº›é€»è¾‘æ˜¯å¦æŒ‰é¢„æœŸæ‰§è¡Œã€‚</li></ol><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>--trace-sigint</code> æ˜¯ä¸€ä¸ªç”¨äºè°ƒè¯•ç›®çš„çš„å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç†è§£å’Œå¤„ç† Node.js åº”ç”¨ç¨‹åºåœ¨æ¥æ”¶åˆ° <code>SIGINT</code> ä¸­æ–­ä¿¡å·æ—¶çš„è¡Œä¸ºã€‚é€šè¿‡æ‰“å°å †æ ˆè·Ÿè¸ªï¼Œå®ƒæä¾›äº†ä¸€ç§ç›´è§‚çš„æ–¹å¼æ¥æŸ¥çœ‹ç¨‹åºçš„å½“å‰çŠ¶æ€å’Œæ‰§è¡Œæµç¨‹ï¼Œè¿™å¯¹äºå¼€å‘å’Œç»´æŠ¤å¤§å‹æˆ–å¤æ‚çš„ Node.js åº”ç”¨ç¨‹åºéå¸¸æœ‰å¸®åŠ©ã€‚</p><h3 id="trace-sync-io" tabindex="-1"><a class="header-anchor" href="#trace-sync-io"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--trace-sync-io" target="_blank" rel="noopener noreferrer">--trace-sync-io</a></span></a></h3><p>Node.js ä¸­çš„<code>--trace-sync-io</code>æ˜¯ä¸€ä¸ªç”¨äºå¯åŠ¨æ—¶ä¼ é€’ç»™ Node.js çš„å‘½ä»¤è¡Œå‚æ•°ï¼ˆCLI å‚æ•°ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¸®åŠ©å¼€å‘è€…æ£€æµ‹å’Œè¿½è¸ªåº”ç”¨ç¨‹åºä¸­çš„åŒæ­¥ I/O æ“ä½œã€‚åœ¨ Node.js çš„ç¼–ç¨‹å®è·µä¸­ï¼ŒåŒæ­¥ I/O æ“ä½œé€šå¸¸è¢«è®¤ä¸ºæ˜¯ä¸€ç§ä¸ä½³çš„åšæ³•ï¼Œå› ä¸ºå®ƒä»¬ä¼šé˜»å¡äº‹ä»¶å¾ªç¯ï¼Œå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å¯èƒ½ä¼šå¼•èµ·ä¸¥é‡çš„æ€§èƒ½ç“¶é¢ˆã€‚</p><h3 id="ä»€ä¹ˆæ˜¯åŒæ­¥-i-o-æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯åŒæ­¥-i-o-æ“ä½œ"><span>ä»€ä¹ˆæ˜¯åŒæ­¥ I/O æ“ä½œï¼Ÿ</span></a></h3><p>I/Oï¼Œå³è¾“å…¥/è¾“å‡ºï¼Œé€šå¸¸æ¶‰åŠåˆ°æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆæ¯”å¦‚è¯»å†™æ–‡ä»¶ï¼‰ã€ç½‘ç»œè¯·æ±‚ç­‰ã€‚åœ¨ Node.js ä¸­ï¼Œè¿™äº›æ“ä½œå¯ä»¥ä»¥åŒæ­¥æˆ–å¼‚æ­¥çš„æ–¹å¼è¿›è¡Œã€‚åŒæ­¥ I/O æ“ä½œä¼šç­‰å¾…æ“ä½œå®Œæˆæ‰ç»§ç»­æ‰§è¡Œåç»­çš„ä»£ç ï¼Œè€Œå¼‚æ­¥ I/O æ“ä½œåˆ™ä¸ä¼šç­‰å¾…ï¼Œä¼šç«‹å³è¿”å›ï¼Œå¹¶é€šè¿‡å›è°ƒå‡½æ•°ã€Promise æˆ– async/await æ¥å¤„ç†ç»“æœã€‚</p><h3 id="ä¸ºä½•éœ€è¦é¿å…åŒæ­¥-i-o" tabindex="-1"><a class="header-anchor" href="#ä¸ºä½•éœ€è¦é¿å…åŒæ­¥-i-o"><span>ä¸ºä½•éœ€è¦é¿å…åŒæ­¥ I/Oï¼Ÿ</span></a></h3><p>Node.js æ˜¯å»ºç«‹åœ¨éé˜»å¡ I/O æ¨¡å‹ä¸Šçš„ï¼Œè¿™æ„å‘³ç€å®ƒæ˜¯è®¾è®¡æ¥å¤„ç†å¤§é‡å¹¶å‘æ“ä½œè€Œä¸ä¼šè¢«å•ä¸ªä»»åŠ¡æ‰€é˜»å¡çš„ã€‚å¦‚æœä½ åœ¨ä»£ç ä¸­ä½¿ç”¨äº†åŒæ­¥ I/O æ“ä½œï¼Œé‚£ä¹ˆåœ¨è¯¥æ“ä½œå®Œæˆå‰ï¼Œæ•´ä¸ª Node.js è¿›ç¨‹å°†æ— æ³•å¤„ç†å…¶ä»–ä»»ä½•ä»»åŠ¡ï¼ŒåŒ…æ‹¬å“åº”æ–°çš„ç”¨æˆ·è¯·æ±‚ã€‚è¿™å¯¼è‡´æ•ˆç‡ä½ä¸‹ï¼Œç‰¹åˆ«æ˜¯å¯¹äºéœ€è¦åŒæ—¶å¤„ç†è®¸å¤šè¯·æ±‚çš„æœåŠ¡å™¨åº”ç”¨ç¨‹åºæ¥è¯´ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-trace-sync-ioæ ‡å¿—" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-trace-sync-ioæ ‡å¿—"><span>å¦‚ä½•ä½¿ç”¨<code>--trace-sync-io</code>æ ‡å¿—ï¼Ÿ</span></a></h3><p>å½“ä½ æ€€ç–‘ä½ çš„ Node.js åº”ç”¨ç¨‹åºä¸­å­˜åœ¨åŒæ­¥ I/O è°ƒç”¨å¯¼è‡´æ€§èƒ½é—®é¢˜æ—¶ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶åŠ ä¸Š<code>--trace-sync-io</code>æ ‡å¿—ã€‚ä¾‹å¦‚ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --trace-sync-io</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤ä¼šå¯åŠ¨åä¸º<code>app.js</code>çš„ Node.js åº”ç”¨ç¨‹åºï¼Œå¹¶æ¿€æ´»åŒæ­¥ I/O è¿½è¸ªåŠŸèƒ½ã€‚å½“åº”ç”¨ç¨‹åºæ‰§è¡Œä»»ä½•åŒæ­¥ I/O æ“ä½œæ—¶ï¼ŒNode.js ä¼šæ‰“å°ä¸€ä¸ªè­¦å‘Šåˆ°æ ‡å‡†é”™è¯¯è¾“å‡ºï¼ˆstderrï¼‰ï¼Œå‘Šè¯‰ä½ æ˜¯å“ªæ®µä»£ç è§¦å‘äº†åŒæ­¥ I/O æ“ä½œã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-8" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-8"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªç®€å•çš„ Node.js è„šæœ¬ï¼Œå®ƒè¯»å–ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åŒæ­¥è¯»å–æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/config.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™æ®µä»£ç ä¼šå·¥ä½œå¾—å¾ˆå¥½ã€‚ä½†æ˜¯å¦‚æœè¿™ä¸ªæ“ä½œå‘ç”Ÿåœ¨ä¸€ä¸ª Web æœåŠ¡å™¨çš„è¯·æ±‚å¤„ç†æµç¨‹ä¸­ï¼Œæ¯æ¬¡è¯»å–éƒ½ä¼šè®©æœåŠ¡å™¨æš‚åœå¤„ç†å…¶ä»–è¯·æ±‚ï¼Œç›´åˆ°æ–‡ä»¶è¯»å–å®Œæ¯•ã€‚</p><p>å¦‚æœä½ åœ¨å¯åŠ¨æ—¶ä½¿ç”¨äº†<code>--trace-sync-io</code>æ ‡å¿—ï¼ŒNode.js ä¼šå‘ä½ è­¦å‘Šè¿™ä¸ªåŒæ­¥ I/O æ“ä½œï¼Œåƒè¿™æ ·ï¼š</p><div class="language-plaintext line-numbers-mode" data-highlighter="shiki" data-ext="plaintext" data-title="plaintext" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>WARNING: Detected use of sync API</span></span>
<span class="line"><span>    at Function.readFileSync (fs.js:471:3)</span></span>
<span class="line"><span>    at Object.`&lt;`anonymous&gt; (/path/to/your-script.js:3:17)</span></span>
<span class="line"><span>    ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªè­¦å‘Šå¸®åŠ©ä½ å®šä½äº†ä»£ç ä¸­çš„æ€§èƒ½éšæ‚£ã€‚è¦ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥æ”¹ç”¨å¼‚æ­¥ç‰ˆæœ¬çš„æ–‡ä»¶è¯»å–å‡½æ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼‚æ­¥è¯»å–æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/config.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œå³ä½¿æ–‡ä»¶è¯»å–æ“ä½œæœªå®Œæˆï¼Œä½ çš„ Web æœåŠ¡å™¨ä¹Ÿå¯ä»¥ç»§ç»­å¤„ç†å…¶ä»–è¯·æ±‚ï¼Œæœ‰æ•ˆæå‡åº”ç”¨æ€§èƒ½ã€‚</p><h3 id="trace-tls" tabindex="-1"><a class="header-anchor" href="#trace-tls"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--trace-tls" target="_blank" rel="noopener noreferrer">--trace-tls</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒã€‚å®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ JavaScriptï¼Œè¿™ä½¿å¾—å¯ä»¥æ„å»ºå¿«é€Ÿã€å¯æ‰©å±•çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰å„ç§å†…ç½®æ¨¡å—å’Œå‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰é€‰é¡¹æ¥å¸®åŠ©å¼€å‘è€…è°ƒè¯•å’Œä¼˜åŒ–ä»–ä»¬çš„åº”ç”¨ã€‚</p><p><code>--trace-tls</code> æ˜¯ Node.js å‘½ä»¤è¡Œæ¥å£çš„ä¸€ä¸ªé€‰é¡¹ï¼Œç”¨äºå¯ç”¨ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨åè®®ï¼‰å’Œ SSLï¼ˆå®‰å…¨å¥—æ¥å±‚ï¼‰çš„è·Ÿè¸ªä¿¡æ¯ã€‚TLS/SSL æ˜¯ç”¨äºä¿æŠ¤ç½‘ç»œé€šä¿¡çš„æ ‡å‡†æŠ€æœ¯ï¼Œç¡®ä¿æ•°æ®åœ¨ä»ä¸€ä¸ªç½‘ç»œèŠ‚ç‚¹ä¼ è¾“åˆ°å¦ä¸€ä¸ªç½‘ç»œèŠ‚ç‚¹æ—¶çš„å®‰å…¨æ€§ä¸å®Œæ•´æ€§ã€‚</p><p>å½“ä½ åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ <code>--trace-tls</code> é€‰é¡¹æ—¶ï¼Œå®ƒä¼šæ‰“å°å‡ºå…³äº TLS æ¡æ‰‹ã€è¿æ¥ä»¥åŠä½¿ç”¨çš„å¯†é’¥ç­‰è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ã€‚è¿™å¯¹äºç†è§£å’Œè¯Šæ–­ä¸ TLS ç›¸å…³çš„é—®é¢˜éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚è¯ä¹¦é”™è¯¯ã€è¿æ¥é—®é¢˜æˆ–è€…åŠ å¯†ç›¸å…³çš„æ¼æ´ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>--trace-tls</code> é€‰é¡¹çš„ä¾‹å­ï¼š</p><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªä½¿ç”¨ HTTPS çš„ Web åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”é‡åˆ°äº†ä¸€äº›ä¸ TLS ç›¸å…³çš„é”™è¯¯ï¼Œä½ ä¸ç¡®å®šæ˜¯å“ªä¸ªéƒ¨åˆ†å‡ºäº†é—®é¢˜ï¼Œå¯ä»¥åœ¨å¯åŠ¨ Node.js ç¨‹åºæ—¶ä½¿ç”¨ <code>--trace-tls</code> é€‰é¡¹ï¼Œåƒè¿™æ ·ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --trace-tls</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> index.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™é‡Œ <code>index.js</code> æ˜¯ä½ çš„ Node.js åº”ç”¨ç¨‹åºå…¥å£æ–‡ä»¶ã€‚å½“ä½ è¿™æ ·åšæ—¶ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­å­˜åœ¨ TLS ç›¸å…³æ“ä½œï¼ŒNode.js å°†åœ¨æ§åˆ¶å°ä¸­è¾“å‡º TLS å±‚é¢çš„è°ƒè¯•ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯èƒ½è¾“å‡º TLS æ¡æ‰‹çš„è¯¦ç»†è¿‡ç¨‹ï¼Œæ˜¾ç¤ºæ¯ä¸€æ­¥çš„ç»†èŠ‚ï¼ŒåŒ…æ‹¬å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´äº¤æ¢çš„æ¶ˆæ¯ç±»å‹ã€é€‰æ‹©çš„å¯†ç å¥—ä»¶ã€ä»¥åŠä½¿ç”¨çš„è¯ä¹¦ä¿¡æ¯ç­‰ã€‚</p><p>é€šè¿‡é˜…è¯»è¿™äº›è¾“å‡ºä¿¡æ¯ï¼Œä½ å¯ä»¥æ›´å®¹æ˜“åœ°æ‰¾åˆ°é—®é¢˜æ‰€åœ¨ï¼Œå¦‚ï¼š</p><ul><li>æ˜¯å¦æ‰€æœ‰å¿…è¦çš„ TLS æ¡æ‰‹æ¶ˆæ¯éƒ½å·²æ­£ç¡®å‘é€å’Œæ¥æ”¶ï¼Ÿ</li><li>é€‰ç”¨çš„å¯†ç å¥—ä»¶æ˜¯å¦å®‰å…¨ï¼Œæ˜¯å¦ç¬¦åˆå½“å‰çš„å®‰å…¨æ ‡å‡†ï¼Ÿ</li><li>ä½¿ç”¨çš„è¯ä¹¦æ˜¯å¦æœ‰æ•ˆï¼Œæ˜¯å¦è¢«æ­£ç¡®åœ°éªŒè¯ï¼Ÿ</li></ul><p>æ€»çš„æ¥è¯´ï¼Œ<code>--trace-tls</code> é€‰é¡¹æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºè°ƒè¯•å’Œä¼˜åŒ–æ¶‰åŠ TLS/SSL çš„ Node.js åº”ç”¨ç¨‹åºã€‚ç„¶è€Œï¼Œç”±äºè¾“å‡ºçš„ä¿¡æ¯å¯èƒ½éå¸¸åºå¤§ä¸”æŠ€æœ¯æ€§å¾ˆå¼ºï¼Œæ‰€ä»¥é€šå¸¸åªæœ‰åœ¨éœ€è¦æ·±åº¦è°ƒè¯•æ—¶æ‰ä¼šä½¿ç”¨æ­¤é€‰é¡¹ã€‚</p><h3 id="trace-uncaught" tabindex="-1"><a class="header-anchor" href="#trace-uncaught"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--trace-uncaught" target="_blank" rel="noopener noreferrer">--trace-uncaught</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚Node.js è¢«è®¾è®¡ä¸ºè½»é‡çº§çš„ï¼Œå¹¶ä¸”ä»¥å•çº¿ç¨‹ã€éé˜»å¡ I/O æ¨¡å‹ä¸ºç‰¹ç‚¹ï¼Œè¿™è®©å®ƒéå¸¸é€‚åˆå¤„ç†é«˜å¹¶å‘çš„åœºæ™¯ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥èŠä¸€èŠ <code>--trace-uncaught</code> è¿™ä¸ªé€‰é¡¹ã€‚</p><p>å½“ä½ åœ¨ Node.js ä¸­è¿è¡Œä¸€ä¸ªç¨‹åºæ—¶ï¼Œå¦‚æœå…¶ä¸­æœ‰é”™è¯¯æ²¡æœ‰è¢«æ•è·ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œä»£ç ä¸­æ²¡æœ‰ç”¨é€‚å½“çš„ try...catch å—æ¥å¤„ç†é”™è¯¯ï¼‰ï¼Œç¨‹åºé€šå¸¸ä¼šæ‰“å°å‡ºé”™è¯¯ä¿¡æ¯ç„¶åé€€å‡ºã€‚æœ‰æ—¶å€™ï¼Œä»…ä»…çŸ¥é“å‘ç”Ÿäº†ä¸€ä¸ªæœªæ•è·çš„é”™è¯¯å¹¶ä¸å¤Ÿã€‚ä½ å¯èƒ½è¿˜æƒ³è¦çŸ¥é“é”™è¯¯æ˜¯å¦‚ä½•å‘ç”Ÿçš„ï¼Œä¹Ÿå°±æ˜¯é”™è¯¯å‘ç”Ÿæ—¶çš„â€œè°ƒç”¨æ ˆâ€ã€‚è°ƒç”¨æ ˆæ˜¯ä¸€ä¸ªè®°å½•å‡½æ•°è°ƒç”¨å†å²çš„åˆ—è¡¨ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ ç†è§£é”™è¯¯å‘ç”Ÿçš„è¿‡ç¨‹ã€‚</p><p><code>--trace-uncaught</code> å°±æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œç”¨äºå‘Šè¯‰ Node.jsï¼šå½“å‘ç”Ÿæœªæ•è·çš„å¼‚å¸¸æ—¶ï¼Œåº”è¯¥æ‰“å°å‡ºè¯¦ç»†çš„è°ƒç”¨æ ˆè·Ÿè¸ªä¿¡æ¯ã€‚è¿™æ ·åšå¯ä»¥å¸®åŠ©å¼€å‘è€…æ›´å¿«åœ°å®šä½é—®é¢˜æ‰€åœ¨ï¼Œå› æ­¤è¿™ä¸ªé€‰é¡¹éå¸¸æœ‰ç”¨äºè°ƒè¯•ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸‹é¢è¿™æ ·ä¸€ä¸ªç®€å•çš„ Node.js ç¨‹åº <code>example.js</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> aFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™é‡Œå‡ºé”™äº†ï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> anotherFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  aFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">anotherFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¨‹åºä¸­ï¼Œå‡½æ•° <code>aFunction</code> æŠ›å‡ºäº†ä¸€ä¸ªé”™è¯¯ï¼Œè€Œè¿™ä¸ªé”™è¯¯æ²¡æœ‰è¢«æ•è·ã€‚å¦‚æœä½ ç›´æ¥è¿è¡Œè¿™ä¸ªç¨‹åºï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> example.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä½ ä¼šå¾—åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¾“å‡ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>/Users/yourusername/path/to/example.js:2</span></span>
<span class="line"><span>    throw new Error(&#39;è¿™é‡Œå‡ºé”™äº†ï¼&#39;);</span></span>
<span class="line"><span>    ^</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Error: è¿™é‡Œå‡ºé”™äº†ï¼</span></span>
<span class="line"><span>    at aFunction (/Users/yourusername/path/to/example.js:2:11)</span></span>
<span class="line"><span>    at anotherFunction (/Users/yourusername/path/to/example.js:6:5)</span></span>
<span class="line"><span>    at Object.`&lt;`anonymous&gt; (/Users/yourusername/path/to/example.js:9:1)</span></span>
<span class="line"><span>    ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯å¦‚æœä½ ä½¿ç”¨ <code>--trace-uncaught</code> é€‰é¡¹è¿è¡Œè¿™ä¸ªç¨‹åºï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --trace-uncaught</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> example.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä½ å°†ä¼šçœ‹åˆ°åŒ…å«äº†æ›´å¤šè¯¦ç»†ä¿¡æ¯çš„è¾“å‡ºï¼Œç‰¹åˆ«æ˜¯å…³äºé”™è¯¯å‘ç”Ÿæ—¶çš„è°ƒç”¨æ ˆçš„ä¿¡æ¯ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>Trace: Error: è¿™é‡Œå‡ºé”™äº†ï¼</span></span>
<span class="line"><span>    at aFunction (/Users/yourusername/path/to/example.js:2:11)</span></span>
<span class="line"><span>    at anotherFunction (/Users/yourusername/path/to/example.js:6:5)</span></span>
<span class="line"><span>    at Object.`&lt;`anonymous&gt; (/Users/yourusername/path/to/example.js:9:1)</span></span>
<span class="line"><span>    ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼Œåœ¨å®é™…è¾“å‡ºä¸­ï¼Œä½ ä¼šçœ‹åˆ°è°ƒç”¨æ ˆçš„æ¯ä¸€æ¡è®°å½•å‰éƒ½ä¼šæœ‰ &quot;at&quot; å­—æ ·ï¼Œæ ‡æ˜è¿™ä¸ªé”™è¯¯æ˜¯åœ¨å“ªä¸ªæ–‡ä»¶çš„å“ªä¸€è¡Œå“ªä¸€åˆ—äº§ç”Ÿçš„ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>--trace-uncaught</code> é€‰é¡¹å¯¹äºè°ƒè¯• Node.js ç¨‹åºä¸­çš„æœªæ•è·å¼‚å¸¸éå¸¸æœ‰å¸®åŠ©ï¼Œå®ƒæä¾›äº†é¢å¤–çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè®©ä½ èƒ½å¤Ÿæ›´å¿«åœ°æ‰¾åˆ°å¹¶è§£å†³é—®é¢˜ã€‚</p><h3 id="trace-warnings" tabindex="-1"><a class="header-anchor" href="#trace-warnings"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--trace-warnings" target="_blank" rel="noopener noreferrer">--trace-warnings</a></span></a></h3><p>Node.js ä¸­çš„ <code>--trace-warnings</code> æ˜¯ä¸€ä¸ªå¯åŠ¨é€‰é¡¹ï¼ˆcommand-line flagï¼‰ï¼Œç”¨æ¥åœ¨ Node.js è¿è¡Œæ—¶äº§ç”Ÿè­¦å‘Šæ—¶æä¾›é¢å¤–çš„è°ƒè¯•ä¿¡æ¯ã€‚è¿™äº›è­¦å‘Šé€šå¸¸æ˜¯ç”±äºä»£ç ä¸­å­˜åœ¨æ½œåœ¨é—®é¢˜é€ æˆçš„ï¼Œæ¯”å¦‚ä½¿ç”¨äº†å³å°†åºŸå¼ƒçš„ API æˆ–è€…æŸäº›æ“ä½œå¯èƒ½ä¼šå¯¼è‡´æ½œåœ¨çš„æ€§èƒ½é—®é¢˜ç­‰ã€‚</p><p>å½“ä½ åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ Node.js åº”ç”¨æ—¶åŠ ä¸Š <code>--trace-warnings</code> é€‰é¡¹ï¼Œå¦‚æœç¨‹åºä¸­æœ‰ä»»ä½•è§¦å‘è­¦å‘Šçš„æƒ…å†µï¼ŒNode.js ä¸ä»…ä¼šè¾“å‡ºè­¦å‘Šæœ¬èº«ï¼Œè¿˜ä¼šæ˜¾ç¤ºä¸€ä¸ªå †æ ˆè¿½è¸ª(stack trace)ï¼Œè¿™æ ·å¯ä»¥å¸®åŠ©å¼€å‘è€…å®šä½åˆ°å…·ä½“æ˜¯å“ªä¸€éƒ¨åˆ†çš„ä»£ç è§¦å‘äº†è­¦å‘Šã€‚</p><p>å †æ ˆè¿½è¸ªæä¾›äº†ä¸€ä¸ªä»è­¦å‘Šå‘å‡ºç‚¹å›æº¯åˆ°ç¨‹åºå…¥å£ç‚¹çš„å‡½æ•°è°ƒç”¨è·¯å¾„ã€‚æ¯ä¸€å±‚éƒ½åŒ…å«äº†å‡½æ•°åç§°ã€æ–‡ä»¶è·¯å¾„å’Œè¡Œå·ï¼Œè¿™å¯¹äºè°ƒæŸ¥å’Œä¿®å¤ä»£ç é—®é¢˜éå¸¸æœ‰ç”¨ã€‚</p><h3 id="å®é™…ä¾‹å­-6" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-6"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æœ‰ä»¥ä¸‹ç®€å•çš„ Node.js è„šæœ¬ï¼Œå®ƒä½¿ç”¨äº†ä¸€ä¸ªå·²è¢«å¼ƒç”¨çš„ APIï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// example.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨äº†å¼ƒç”¨çš„åŒæ­¥å†™æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;File has been written.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç›´æ¥è¿è¡Œè¿™ä¸ªè„šæœ¬å¯èƒ½ä¸ä¼šæœ‰ä»»ä½•è­¦å‘Šï¼Œå› ä¸º <code>fs.writeFileSync</code> æ–¹æ³•è™½ç„¶è¢«è®¤ä¸ºåº”è¯¥é¿å…ä½¿ç”¨ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹å®ƒå¹¶ä¸ä¼šè§¦å‘è­¦å‘Šã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬æ•…æ„è§¦å‘ä¸€ä¸ªè­¦å‘Šã€‚ä¸ºäº†è¿™ä¸ªä¾‹å­ï¼Œå‡è®¾ Node.js æœ‰ä¸€ä¸ªæœªæ¥ç‰ˆæœ¬ä¸­å°†ä¼šå¼ƒç”¨çš„æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿè¿™ç§è¡Œä¸ºçš„ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// exampleWarning.js</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;warning&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">warning</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Custom Warning: &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">warning</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è§¦å‘ä¸€ä¸ªè­¦å‘Šäº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">emitWarning</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;This is a deprecated feature.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;DeprecationWarning&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­£å¸¸è¿è¡Œè¿™æ®µä»£ç åªä¼šè¾“å‡ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>Custom Warning:  DeprecationWarning</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä½†æ˜¯ï¼Œå¦‚æœä½ åœ¨å‘½ä»¤è¡Œä½¿ç”¨ <code>--trace-warnings</code> è¿è¡Œç›¸åŒçš„è„šæœ¬ï¼Œä¾‹å¦‚ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --trace-warnings</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> exampleWarning.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä½ å¯èƒ½ä¼šå¾—åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>Custom Warning:  DeprecationWarning</span></span>
<span class="line"><span>(Use `node --trace-warnings ...` to show where the warning was created)</span></span>
<span class="line"><span>Trace:</span></span>
<span class="line"><span>    at Object.`&lt;`anonymous&gt; (/path/to/your/exampleWarning.js:6:9)</span></span>
<span class="line"><span>    at Module._compile (internal/modules/cjs/loader.js:1137:30)</span></span>
<span class="line"><span>    ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªå †æ ˆè¿½è¸ªæ˜¾ç¤ºäº†è­¦å‘Šæ˜¯åœ¨ <code>exampleWarning.js</code> çš„ç¬¬ 6 è¡Œä»£ç å¤„è§¦å‘çš„ï¼Œå¹¶ä¸”æä¾›äº†ä»é‚£é‡Œåˆ°ç¨‹åºå¼€å§‹æ‰§è¡Œçš„æ•´ä¸ªè°ƒç”¨å †æ ˆã€‚</p><p>ä½¿ç”¨ <code>--trace-warnings</code> å¯¹äºå¼€å‘å’Œç»´æŠ¤å¤§å‹é¡¹ç›®éå¸¸æœ‰ç›Šï¼Œå› ä¸ºå®ƒä»¬ç»å¸¸éœ€è¦è·Ÿè¸ªå¯èƒ½éšè—åœ¨æ·±å±‚æ¬¡ä»£ç ä¸­çš„è­¦å‘Šå’Œé—®é¢˜ã€‚é€šè¿‡æä¾›è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼Œå¼€å‘è€…å¯ä»¥æ›´å¿«åœ°è¯Šæ–­å’Œè§£å†³è¿™äº›é—®é¢˜ã€‚</p><h3 id="track-heap-objects" tabindex="-1"><a class="header-anchor" href="#track-heap-objects"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--track-heap-objects" target="_blank" rel="noopener noreferrer">--track-heap-objects</a></span></a></h3><p><code>--track-heap-objects</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒç”¨äºå¯åŠ¨ V8 JavaScript å¼•æ“çš„å †è¿½è¸ªåŠŸèƒ½ã€‚å½“ä½ åœ¨è¿è¡Œ Node.js ç¨‹åºæ—¶ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼ŒV8 å¼•æ“ä¼šè®°å½•å †å†…å­˜ä¸­æ¯ä¸ªå¯¹è±¡çš„åˆ†é…æƒ…å†µã€‚</p><p>å †ï¼ˆHeapï¼‰æ˜¯è®¡ç®—æœºå†…å­˜ä¸­çš„ä¸€ä¸ªåŒºåŸŸï¼Œç”¨äºåŠ¨æ€åˆ†é…å†…å­˜ç©ºé—´ï¼Œå³åœ¨ç¨‹åºè¿è¡Œæ—¶åˆ†é…å’Œé‡Šæ”¾å†…å­˜ã€‚JavaScript ä¸­çš„å¯¹è±¡ã€æ•°ç»„ç­‰éƒ½æ˜¯å­˜å‚¨åœ¨å †å†…å­˜ä¸­çš„ã€‚éšç€ä½ çš„åº”ç”¨è¿è¡Œå’Œå¤„ç†æ•°æ®ï¼Œå †å†…å­˜ä¸­çš„å¯¹è±¡æ•°é‡å’Œå¤§å°å¯èƒ½ä¼šå¢é•¿ã€‚å¦‚æœä¸é€‚å½“ç®¡ç†ï¼Œä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå³ä¸å†éœ€è¦çš„å†…å­˜æ²¡æœ‰è¢«æ­£ç¡®é‡Šæ”¾ï¼Œéšæ—¶é—´æ¨ç§»è¿™ä¼šæ¶ˆè€—æ‰æ‰€æœ‰å¯ç”¨çš„å†…å­˜èµ„æºï¼Œä»è€Œå¯èƒ½å¯¼è‡´åº”ç”¨å´©æºƒæˆ–æ€§èƒ½é—®é¢˜ã€‚</p><p>ä½¿ç”¨ <code>--track-heap-objects</code> é€‰é¡¹å¯ä»¥å¸®åŠ©ä½ ç›‘æ§å’Œè¯Šæ–­å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå°¤å…¶æ˜¯å½“ä½ æ€€ç–‘æœ‰å†…å­˜æ³„æ¼æ—¶ã€‚å¼€å¯è¿™ä¸ªé€‰é¡¹åï¼Œä½ å¯ä»¥ä½¿ç”¨ Node.js çš„å†…ç½®å·¥å…·å¦‚ <code>heapdump</code> æˆ–ç¬¬ä¸‰æ–¹å·¥å…·æ¥æ£€æŸ¥å†…å­˜å¿«ç…§ï¼Œå¹¶æ‰¾å‡ºå“ªäº›å¯¹è±¡æ­£åœ¨è¢«åˆ†é…å’ŒæŒæœ‰å†…å­˜ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªå®é™…çš„ä¾‹å­ï¼š</p><ol><li><p>è°ƒè¯•å†…å­˜æ³„æ¼ï¼š<br> å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œä½ æ³¨æ„åˆ°éšç€æ—¶é—´çš„æ¨ç§»ï¼Œåº”ç”¨å ç”¨çš„å†…å­˜è¶Šæ¥è¶Šå¤šï¼Œè¿™å¯èƒ½è¡¨æ˜å­˜åœ¨å†…å­˜æ³„æ¼ã€‚ä¸ºäº†è°ƒæŸ¥è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨ Node.js ç¨‹åºæ—¶æ·»åŠ  <code>--track-heap-objects</code> é€‰é¡¹ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --track-heap-objects</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·ï¼ŒV8 å¼•æ“å°±ä¼šè·Ÿè¸ªå †å†…å­˜åˆ†é…ï¼Œç„¶åä½ å¯ä»¥åˆ›å»ºå †å¿«ç…§å¹¶ä½¿ç”¨å·¥å…·åˆ†æå“ªäº›å¯¹è±¡æ²¡æœ‰è¢«åƒåœ¾å›æ”¶ï¼Œä»è€Œå®šä½å†…å­˜æ³„æ¼æºå¤´ã€‚</p></li><li><p>æ€§èƒ½ä¼˜åŒ–ï¼š<br> åœ¨å¦ä¸€ç§æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½å¹¶ä¸ç¡®å®šæ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼ï¼Œä½†æ˜¯æƒ³è¦ä¼˜åŒ–åº”ç”¨çš„å†…å­˜ä½¿ç”¨æ•ˆç‡ã€‚é€šè¿‡å¼€å¯å¯¹è±¡è¿½è¸ªï¼Œä½ å¯ä»¥å¾—åˆ°å…³äºå¯¹è±¡åˆ†é…æ¨¡å¼çš„ä¿¡æ¯ï¼Œè¿™æœ‰åŠ©äºä½ ç†è§£åº”ç”¨æ˜¯å¦‚ä½•ä½¿ç”¨å†…å­˜çš„ï¼Œä¹Ÿè®¸ä½ ä¼šå‘ç°æŸäº›å¯¹è±¡å¯ä»¥é‡ç”¨è€Œä¸æ˜¯é¢‘ç¹åˆ›å»ºæ–°çš„ï¼Œä»è€Œå‡å°‘å†…å­˜åˆ†é…æ¬¡æ•°å’Œæé«˜æ€§èƒ½ã€‚</p></li><li><p>å­¦ä¹ å’Œæ•™è‚²ï¼š<br> å¦‚æœä½ æ˜¯ä¸€åå­¦ç”Ÿæˆ–è€…æ­£åœ¨è‡ªå·±å­¦ä¹  Node.js ä¸­çš„å†…å­˜ç®¡ç†ï¼Œå°è¯•ä½¿ç”¨ <code>--track-heap-objects</code> é€‰é¡¹å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ JavaScript å¼•æ“æ˜¯å¦‚ä½•å¤„ç†å†…å­˜åˆ†é…çš„ã€‚è§‚å¯Ÿä¸åŒä»£ç å¯¹å†…å­˜å½±å“çš„å®éªŒå¯ä»¥åŠ æ·±ä½ å¯¹ JavaScript å†…å­˜ç®¡ç†å’Œåƒåœ¾å›æ”¶æœºåˆ¶çš„ç†è§£ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œ<code>--track-heap-objects</code> æ˜¯ä¸€ä¸ªç”¨äºå†…å­˜åˆ†æç›®çš„çš„é«˜çº§å·¥å…·ã€‚å¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œç†è§£å’Œä½¿ç”¨å®ƒå¯èƒ½æ¯”è¾ƒå¤æ‚ï¼Œä½†æ˜¯å½“ä½ å¼€å§‹æ„å»ºæ›´å¤§å‹çš„ Node.js åº”ç”¨ï¼Œå¹¶éœ€è¦æ·±å…¥äº†è§£å†…å­˜ä½¿ç”¨æƒ…å†µæ—¶ï¼Œè¿™ä¸ªå·¥å…·å°†éå¸¸æœ‰ç”¨ã€‚</p><h3 id="unhandled-rejections-mode" tabindex="-1"><a class="header-anchor" href="#unhandled-rejections-mode"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--unhandled-rejectionsmode" target="_blank" rel="noopener noreferrer">--unhandled-rejections=mode</a></span></a></h3><p>å½“ä½ åœ¨ä½¿ç”¨ Node.js ç¼–ç¨‹æ—¶ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°â€œPromiseâ€çš„æ¦‚å¿µã€‚ä¸€ä¸ª Promise æ˜¯ä¸€ç§è¡¨ç¤ºå¼‚æ­¥æ“ä½œæœ€ç»ˆå®Œæˆæˆ–å¤±è´¥çš„å¯¹è±¡ã€‚æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™ä»£ç æ—¶å¯èƒ½ä¼šå¿˜è®°å¤„ç† Promise å¤±è´¥çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ²¡æœ‰ä¸ºè¿™ä¸ª Promise æŒ‡å®š<code>.catch()</code>æ–¹æ³•æˆ–åœ¨ä¸€ä¸ª<code>async</code>å‡½æ•°ä¸­ä½¿ç”¨<code>try...catch</code>æ¥æ•è·é”™è¯¯ã€‚è¿™ç§æƒ…å†µè¢«ç§°ä¸ºâ€œæœªå¤„ç†çš„æ‹’ç»â€ï¼ˆUnhandled Rejectionï¼‰ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œå¦‚æœå‡ºç°äº†æœªå¤„ç†çš„æ‹’ç»ï¼ŒNode.js å¯ä»¥ç”¨ä¸åŒçš„æ–¹å¼å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚è¿™ç§å¤„ç†æ–¹å¼å¯ä»¥é€šè¿‡è¿è¡Œæ—¶é€‰é¡¹<code>--unhandled-rejections=mode</code>æ¥é…ç½®ï¼Œå…¶ä¸­<code>mode</code>å¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§ä¹‹ä¸€ï¼š</p><ol><li><code>strict</code>ï¼šåº”ç”¨ç¨‹åºä¼šç«‹å³ä»¥é€€å‡ºç  1 é€€å‡ºï¼Œè¿™æ„å‘³ç€ Node.js å°†ä¼šç«‹åˆ»åœæ­¢æ‰§è¡Œã€‚</li><li><code>warn</code>ï¼ˆé»˜è®¤ï¼‰ï¼šNode.js ä¼šæ‰“å°ä¸€ä¸ªè­¦å‘Šä¿¡æ¯ï¼Œä½†ä¸ä¼šå½±å“ç¨‹åºçš„ç»§ç»­æ‰§è¡Œã€‚</li><li><code>warn-with-error-code</code>ï¼šç±»ä¼¼äº<code>warn</code>ï¼Œä½†ç¨‹åºä¼šæœ€ç»ˆä»¥é€€å‡ºç  1 é€€å‡ºã€‚</li><li><code>none</code>ï¼šæ²¡æœ‰ä»»ä½•è­¦å‘Šæˆ–é”™è¯¯æç¤ºï¼ŒNode.js ä¼šå¿½ç•¥æœªå¤„ç†çš„æ‹’ç»ã€‚</li></ol><p>ä¸‹é¢ä¸¾å‡ ä¸ªä¾‹å­æ¥è¯´æ˜è¿™äº›æ¨¡å¼çš„åº”ç”¨åœºæ™¯ã€‚</p><h3 id="strict-æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#strict-æ¨¡å¼"><span>strict æ¨¡å¼ï¼š</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ª Web æœåŠ¡å™¨ï¼Œä½ å¸Œæœ›å®ƒåœ¨å‘ç”Ÿä»»ä½•æœªå¤„ç†çš„ Promise æ‹’ç»æ—¶ç«‹å³åœæ­¢ï¼Œå› ä¸ºè¿™å¯èƒ½è¡¨æ˜ç¨‹åºä¸­å­˜åœ¨ä¸¥é‡çš„é—®é¢˜ã€‚ä½ å¯ä»¥åœ¨å¯åŠ¨æœåŠ¡å™¨æ—¶ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --unhandled-rejections=strict</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> server.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœåœ¨<code>server.js</code>ä¸­æœ‰ä»»ä½•æœªå¤„ç†çš„æ‹’ç»å‘ç”Ÿï¼Œæ¯”å¦‚ä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢å¤±è´¥äº†ï¼Œä½†æ˜¯æ²¡è¢«æ­£ç¡®æ•è·å’Œå¤„ç†ï¼ŒNode.js å°±ä¼šç«‹å³åœæ­¢è¿è¡Œè¯¥åº”ç”¨ç¨‹åºã€‚</p><h3 id="warn-æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#warn-æ¨¡å¼"><span>warn æ¨¡å¼ï¼š</span></a></h3><p>å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨ï¼Œå¹¶æƒ³è¦ç¡®ä¿çœ‹åˆ°ä½ å¯èƒ½ç–å¿½çš„æ‰€æœ‰æœªå¤„ç†çš„æ‹’ç»ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¨¡å¼å¾ˆæœ‰ç”¨ã€‚å› ä¸ºé»˜è®¤æ¨¡å¼å°±æ˜¯<code>warn</code>ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦ç‰¹åˆ«æŒ‡å®šå®ƒã€‚ä½†å¦‚æœä½ æƒ³æ˜¾å¼æŒ‡å®šï¼Œå¯ä»¥åƒè¿™æ ·è¿è¡Œä½ çš„åº”ç”¨ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --unhandled-rejections=warn</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¦‚æœ<code>app.js</code>ä¸­å‡ºç°äº†æœªå¤„ç†çš„æ‹’ç»ï¼ŒNode.js ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºä¸€ä¸ªè­¦å‘Šï¼Œä½†ç¨‹åºä»ç„¶ä¼šç»§ç»­è¿è¡Œã€‚</p><h3 id="none-æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#none-æ¨¡å¼"><span>none æ¨¡å¼ï¼š</span></a></h3><p>è®¾æƒ³ä½ å·²ç»æœ‰äº†å®Œå¤‡çš„é”™è¯¯å¤„ç†ç­–ç•¥ï¼Œå¹¶ä¸”ä½ å¸Œæœ›å®Œå…¨ç¦æ­¢ Node.js å¯¹æœªå¤„ç†æ‹’ç»çš„ä»»ä½•å¹²é¢„ã€‚è¿™æ—¶ä½ å¯ä»¥ä½¿ç”¨<code>none</code>æ¨¡å¼ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --unhandled-rejections=none</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå¦‚æœ<code>script.js</code>é‡Œæœ‰æœªå¤„ç†çš„æ‹’ç»ï¼ŒNode.js ä¸ä¼šè¿›è¡Œä»»ä½•è­¦å‘Šæˆ–é”™è¯¯æç¤ºï¼Œä¹Ÿä¸ä¼šæ”¹å˜ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚</p><p>é€‰æ‹©åˆé€‚çš„<code>--unhandled-rejections</code>æ¨¡å¼å¯¹äºç†è§£ä½ çš„åº”ç”¨å¦‚ä½•å“åº”æœªå¤„ç†çš„é”™è¯¯éå¸¸é‡è¦ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½å¸Œæœ›è®© Node.js æé†’ä½ æ‰€æœ‰çš„æœªå¤„ç†æ‹’ç»ï¼ˆä½¿ç”¨<code>warn</code>ï¼‰ï¼Œè€Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä½ å¯èƒ½æ›´æ„¿æ„é‡‡ç”¨ä¸¥æ ¼æ¨¡å¼ï¼ˆ<code>strict</code>ï¼‰æ¥ç¡®ä¿ç¨³å®šæ€§ã€‚</p><h3 id="use-bundled-ca-use-openssl-ca" tabindex="-1"><a class="header-anchor" href="#use-bundled-ca-use-openssl-ca"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--use-bundled-ca---use-openssl-ca" target="_blank" rel="noopener noreferrer">--use-bundled-ca, --use-openssl-ca</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥è°ˆè°ˆ Node.js ä¸­çš„ <code>--use-bundled-ca</code> å’Œ <code>--use-openssl-ca</code> è¿™ä¸¤ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ã€‚</p><p>å½“ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºéœ€è¦é€šè¿‡ HTTPS åè®®ä¸å¤–éƒ¨æœåŠ¡è¿›è¡Œå®‰å…¨é€šä¿¡æ—¶ï¼Œå®ƒéœ€è¦éªŒè¯å¯¹æ–¹çš„è¯ä¹¦æ˜¯æœ‰æ•ˆä¸”å¯ä¿¡èµ–çš„ã€‚è¯ä¹¦éªŒè¯æ˜¯é€šè¿‡è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰çš„ä¸€å¥—å—ä¿¡ä»»çš„æ ¹è¯ä¹¦æ¥å®Œæˆçš„ã€‚Node.js ä¸ºäº†èƒ½å¤Ÿæ‰§è¡Œè¿™äº›éªŒè¯ï¼Œå†…ç½®äº†ä¸€ç³»åˆ—æ¥è‡ªäº Mozilla çš„å—ä¿¡ä»»çš„ CA æ ¹è¯ä¹¦åˆ—è¡¨ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ &quot;bundled&quot; CAï¼ˆæ‰“åŒ…åœ¨ä¸€èµ·çš„ CA åˆ—è¡¨ï¼‰ã€‚</p><p>ç„¶è€Œï¼Œåœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¸æƒ³ä½¿ç”¨ Node.js å†…ç½®çš„è¿™ä¸ªè¯ä¹¦åˆ—è¡¨ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœä½ çš„åº”ç”¨ç¨‹åºè¿è¡Œåœ¨ä¸€ä¸ªä¼ä¸šç¯å¢ƒä¸­ï¼Œè¯¥ç¯å¢ƒå¯èƒ½æœ‰è‡ªå·±çš„ CA æ ¹è¯ä¹¦ï¼Œæˆ–è€…æœ‰ä¸€äº›ç‰¹æ®Šçš„è¯ä¹¦éœ€æ±‚ï¼Œé‚£ä¹ˆä½ å¯èƒ½å°±éœ€è¦ä½¿ç”¨ç³»ç»Ÿä¸­çš„ CA æ ¹è¯ä¹¦ï¼Œæˆ–è€… OpenSSL æä¾›çš„è¯ä¹¦åˆ—è¡¨äº†ã€‚</p><p>è®©æˆ‘ä»¬åˆ†åˆ«äº†è§£ä»¥ä¸‹ä¸¤ä¸ªé€‰é¡¹ï¼š</p><ol><li><p><code>--use-bundled-ca</code>: è¿™ä¸ªé€‰é¡¹å‘Šè¯‰ Node.js ä½¿ç”¨å†…ç½®çš„ Mozilla CA æ ¹è¯ä¹¦åˆ—è¡¨ã€‚å¦‚æœä¸æŒ‡å®šè¿™ä¸ªé€‰é¡¹ï¼ŒNode.js å°†é»˜è®¤ä½¿ç”¨è¿™ä¸ªåˆ—è¡¨æ¥éªŒè¯ HTTPS è¿æ¥ã€‚</p></li><li><p><code>--use-openssl-ca</code>: ä½¿ç”¨è¿™ä¸ªé€‰é¡¹åˆ™è¡¨ç¤ºä½ å¸Œæœ› Node.js ä½¿ç”¨ OpenSSL çš„ CA æ ¹è¯ä¹¦åˆ—è¡¨è¿›è¡ŒéªŒè¯ã€‚å…·ä½“æ¥è¯´ï¼ŒNode.js å°†ä¼šä½¿ç”¨å®‰è£…åœ¨ä½ çš„ç³»ç»Ÿä¸Šçš„ OpenSSL åº“ä¸­çš„ CA æ ¹è¯ä¹¦åˆ—è¡¨ã€‚</p></li></ol><p>å®é™…ä½¿ç”¨ä¾‹å­ï¼š</p><ul><li><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦è¿æ¥åˆ°ä¸€ä¸ªç¬¬ä¸‰æ–¹ HTTPS APIã€‚å¦‚æœä½ å¯¹è¯ä¹¦éªŒè¯æ²¡æœ‰ç‰¹å®šçš„è¦æ±‚ï¼Œä½ ä¸éœ€è¦åšä»»ä½•é¢å¤–çš„äº‹æƒ…ï¼›Node.js å°†ä¼šä½¿ç”¨å®ƒå†…ç½®çš„ CA åˆ—è¡¨æ¥ç¡®ä¿ API çš„è¯ä¹¦æ˜¯æœ‰æ•ˆçš„ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://api.third-party-service.com/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">resp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // A chunk of data has been received.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    resp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // The whole response has been received. Print out the result.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    resp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">explanation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Error: &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å¦‚æœä½ åœ¨ä¸€ä¸ªä¼ä¸šç¯å¢ƒä¸­å·¥ä½œï¼Œå¹¶ä¸”ä½ çš„ä¼ä¸šæœ‰è‡ªå·±çš„ CA æ ¹è¯ä¹¦ï¼Œä½ å¯èƒ½éœ€è¦é…ç½®ä½ çš„åº”ç”¨æ¥ä½¿ç”¨ä¼ä¸šçš„è¯ä¹¦ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥å‘Šè¯‰ Node.js ä½¿ç”¨ç³»ç»Ÿçš„ OpenSSL è¯ä¹¦åˆ—è¡¨ï¼Œé€šè¿‡å¯åŠ¨ä½ çš„åº”ç”¨ç¨‹åºæ—¶åŠ ä¸Š <code>--use-openssl-ca</code> é€‰é¡¹ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --use-openssl-ca</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><p>åœ¨å¤§å¤šæ•°æ—¥å¸¸çš„å¼€å‘ä»»åŠ¡ä¸­ï¼Œé»˜è®¤ä½¿ç”¨ Node.js å†…ç½®çš„è¯ä¹¦åˆ—è¡¨å·²ç»è¶³å¤Ÿäº†ã€‚åªæœ‰åœ¨ç‰¹å®šçš„ç¯å¢ƒå’Œå®‰å…¨è¦æ±‚ä¸‹ï¼Œä½ æ‰éœ€è¦è€ƒè™‘ä½¿ç”¨ <code>--use-openssl-ca</code> æ¥ä½¿ç”¨ä¸åŒçš„è¯ä¹¦ã€‚</p><h3 id="use-largepages-mode" tabindex="-1"><a class="header-anchor" href="#use-largepages-mode"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--use-largepagesmode" target="_blank" rel="noopener noreferrer">--use-largepages=mode</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ <code>--use-largepages</code> é€‰é¡¹ã€‚</p><p>é¦–å…ˆï¼Œè¦ç†è§£è¿™ä¸ªé€‰é¡¹ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯ &quot;large pages&quot;ï¼ˆå¤§é¡µï¼‰ã€‚åœ¨è®¡ç®—æœºå†…å­˜ç®¡ç†ä¸­ï¼Œæ“ä½œç³»ç»Ÿé€šå¸¸ä½¿ç”¨å«åšâ€œé¡µâ€çš„æ•°æ®å—æ¥ç®¡ç†å’Œæ˜ å°„è¿›ç¨‹çš„å†…å­˜ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›é¡µçš„å¤§å°æ˜¯ç›¸å¯¹è¾ƒå°çš„ï¼ˆä¾‹å¦‚ï¼Œåœ¨å¾ˆå¤šç³»ç»Ÿä¸Šæ˜¯ 4KBï¼‰ã€‚å½“å¤„ç†å¤§é‡æ•°æ®æˆ–è€…è¿è¡Œå†…å­˜å¯†é›†å‹åº”ç”¨æ—¶ï¼Œé¢‘ç¹åœ°å¯¹è¿™äº›å°çš„å†…å­˜é¡µè¿›è¡Œè¯»å–å’Œå†™å…¥å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚</p><p>ä¸ºäº†æå‡æ€§èƒ½ï¼Œç°ä»£æ“ä½œç³»ç»Ÿæ”¯æŒâ€œå¤§é¡µâ€æŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨æ›´å¤§çš„å†…å­˜é¡µï¼ˆæ¯”å¦‚ 2MB æˆ–è€…æ›´å¤§ï¼‰ï¼Œè¿™æ ·å¯ä»¥å‡å°‘é¡µè¡¨çš„æ•°é‡ï¼Œé™ä½å†…å­˜ç®¡ç†å¼€é”€ï¼Œå¹¶ä¸”æé«˜ CPU ç¼“å­˜çš„æ•ˆç‡ã€‚</p><p>Node.js çš„ <code>--use-largepages</code> é€‰é¡¹å…è®¸ Node.js åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ä½¿ç”¨å¤§é¡µç‰¹æ€§ã€‚è¿™ä¸ªé€‰é¡¹çš„å‚æ•° <code>mode</code> è¡¨ç¤ºå¤§é¡µçš„ä½¿ç”¨æ¨¡å¼ï¼Œå…·ä½“å¯ä»¥æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li><strong>disabled</strong>ï¼šä¸ä½¿ç”¨å¤§é¡µã€‚è¿™æ˜¯é»˜è®¤å€¼ã€‚</li><li><strong>warn</strong>ï¼šå°è¯•ä½¿ç”¨å¤§é¡µï¼Œä½†å¦‚æœå¤±è´¥ä¸ä¼šé˜»æ­¢åº”ç”¨å¯åŠ¨ï¼Œåªä¼šæ˜¾ç¤ºä¸€æ¡è­¦å‘Šä¿¡æ¯ã€‚</li><li><strong>silent</strong>ï¼šå°è¯•ä½¿ç”¨å¤§é¡µï¼Œå¦‚æœå¤±è´¥åˆ™é»˜é»˜å›é€€åˆ°æ­£å¸¸é¡µï¼Œä¸ä¼šæ˜¾ç¤ºä»»ä½•è­¦å‘Šæˆ–é”™è¯¯ä¿¡æ¯ã€‚</li></ul><p>è®©æˆ‘ä»¬ä¸¾ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼Œå‡è®¾ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ª Node.js ç¼–å†™çš„ Web æœåŠ¡å™¨ï¼Œå®ƒéœ€è¦å¤„ç†å¤§é‡å¹¶å‘è¯·æ±‚ï¼ŒåŒæ—¶åœ¨å†…å­˜ä¸­ç»´æŠ¤å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œå¯èƒ½ä¼šä»å¤§é¡µä¸­è·ç›Šã€‚ä½ å¯ä»¥åœ¨å¯åŠ¨è¯¥ Node.js åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¡Œå‚æ•°ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --use-largepages=warn</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> server.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·ï¼ŒèŠ‚ç‚¹å°†å°è¯•ä»¥å¤§é¡µæ¨¡å¼å¯åŠ¨ä½ çš„ web æœåŠ¡å™¨ã€‚å¦‚æœæ“ä½œç³»ç»Ÿé…ç½®æ­£ç¡®ï¼Œå¹¶ä¸”æœ‰è¶³å¤Ÿçš„å¤§é¡µå†…å­˜å¯ç”¨ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä¼šå¾—åˆ°æ€§èƒ½æå‡ã€‚å¦‚æœå› ä¸ºæŸäº›åŸå› æ— æ³•ä½¿ç”¨å¤§é¡µï¼Œä½ å°†çœ‹åˆ°ä¸€æ¡è­¦å‘Šä¿¡æ¯ï¼Œä½†ä½ çš„åº”ç”¨è¿˜æ˜¯ä¼šç»§ç»­è¿è¡Œï¼Œåªæ˜¯ä¸ä¼šä½¿ç”¨å¤§é¡µç‰¹æ€§ã€‚</p><p>è¯·æ³¨æ„ï¼Œåœ¨ä½¿ç”¨å¤§é¡µä¹‹å‰ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®ä½ çš„æ“ä½œç³»ç»Ÿè¿›è¡Œä¸€äº›é¢å¤–çš„é…ç½®ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œå¤§é¡µå¯èƒ½ä¸ä¼šç«‹å³å¯ç”¨æˆ–é…ç½®ä¸å½“å¯èƒ½ä¼šå½±å“ç³»ç»Ÿç¨³å®šæ€§ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>--use-largepages</code> æ˜¯ä¸€ä¸ªé«˜çº§çš„æ€§èƒ½ä¼˜åŒ–é€‰é¡¹ï¼Œå®ƒè®© Node.js åº”ç”¨ç¨‹åºæœ‰å¯èƒ½é€šè¿‡ä½¿ç”¨å¤§é¡µæå‡æ€§èƒ½ã€‚ä¸è¿‡ï¼Œè¿™ç§æå‡å–å†³äºåº”ç”¨ç¨‹åºçš„ç‰¹ç‚¹ä»¥åŠæ“ä½œç³»ç»Ÿçš„æ”¯æŒæƒ…å†µã€‚</p><h3 id="v8-options" tabindex="-1"><a class="header-anchor" href="#v8-options"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--v8-options" target="_blank" rel="noopener noreferrer">--v8-options</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚V8 æ˜¯ Google å¼€å‘çš„å¼€æº JavaScript å¼•æ“ï¼Œç”¨äº Chrome æµè§ˆå™¨å’Œ Node.js ç­‰é¡¹ç›®ã€‚</p><p>å½“ä½ è¿è¡Œä¸€ä¸ª Node.js åº”ç”¨æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨ä½¿ç”¨ V8 å¼•æ“æ¥è§£é‡Šå’Œæ‰§è¡Œä½ çš„ JavaScript ä»£ç ã€‚V8 å¼•æ“æœ‰å¾ˆå¤šå†…ç½®çš„é€‰é¡¹å’Œé…ç½®ï¼Œè¿™äº›å¯ä»¥å¸®åŠ©ä½ ä¼˜åŒ–æ€§èƒ½ï¼Œè¿›è¡Œè°ƒè¯•ï¼Œæˆ–è€…æ˜¯å¯ç”¨æŸäº›å®éªŒæ€§çš„ç‰¹æ€§ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‚æ•° <code>--v8-options</code> æ¥æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„ V8 å‘½ä»¤è¡Œé€‰é¡¹ã€‚è¿™ä¸ªå‘½ä»¤ä¼šåˆ—å‡ºæ‰€æœ‰ V8 å¼•æ“æ”¯æŒçš„æ ‡å¿—å’Œå®ƒä»¬çš„æè¿°ã€‚ä½¿ç”¨è¿™äº›æ ‡å¿—ï¼Œä½ å¯ä»¥è°ƒæ•´ V8 çš„è¡Œä¸ºä»¥é€‚åº”ä½ çš„å…·ä½“éœ€æ±‚ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾ä½ æƒ³è¦æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„ V8 é€‰é¡¹ï¼Œä½ å¯ä»¥åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --v8-options</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™å°†è¾“å‡ºä¸€å¤§å †æ–‡æœ¬ï¼Œå±•ç¤ºäº†æ‰€æœ‰çš„ V8 é€‰é¡¹åŠå…¶è¯´æ˜ã€‚å› ä¸ºè¿™äº›é€‰é¡¹é€šå¸¸æ˜¯ç»™é«˜çº§ç”¨æˆ·ä½¿ç”¨çš„ï¼Œæ‰€ä»¥å¯¹æ–°æ‰‹æ¥è¯´å¯èƒ½ä¼šæœ‰ç‚¹å¤æ‚ã€‚</p><p>ç°åœ¨ä¸¾ä¸€äº›ä¾‹å­ï¼š</p><ol><li><p><strong>åƒåœ¾å›æ”¶æ§åˆ¶</strong>:</p><ul><li>å‡å¦‚ä½ æƒ³è¦è°ƒæ•´ V8 åƒåœ¾å›æ”¶å™¨çš„è¡Œä¸ºï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨åƒ <code>--max-old-space-size</code> æˆ– <code>--max-new-space-size</code> è¿™æ ·çš„é€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¦å¢åŠ  Node.js åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨çš„æ—§ç”Ÿä»£å †ç©ºé—´çš„å¤§å°ï¼ˆåœ¨ 64 ä½ç³»ç»Ÿä¸Šé»˜è®¤çº¦ä¸º 1.4GBï¼‰ï¼Œä½ å¯ä»¥è®¾ç½®ï¼š<div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --max-old-space-size=4096</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>è¿™ä¼šå°†æœ€å¤§è€å¹´ä»£å †å†…å­˜è®¾ç½®ä¸ºå¤§çº¦ 4GBã€‚</li></ul></li><li><p><strong>æ€§èƒ½åˆ†æ</strong>:</p><ul><li>å¦‚æœä½ æƒ³è¦å¯ç”¨ä¸€äº›æ€§èƒ½åˆ†æå·¥å…·ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨ <code>--prof</code> æ ‡å¿—ã€‚è¿™å°†ä½¿å¾— V8 å¼•æ“è®°å½•æ€§èƒ½é…ç½®æ–‡ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å·¥å…·æ¥åˆ†æä½ çš„åº”ç”¨åœ¨å“ªé‡ŒèŠ±è´¹äº†æœ€å¤šçš„æ—¶é—´ã€‚<div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --prof</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul></li></ol><p>è®°ä½ï¼Œè¿™äº›é€‰é¡¹é€šå¸¸æ˜¯ä¸ºäº†è§£å†³å…·ä½“çš„é«˜çº§é—®é¢˜è€Œè®¾è®¡çš„ã€‚ä½œä¸ºä¸€ä¸ªç¼–ç¨‹æ–°æ‰‹ï¼Œé€šå¸¸ä½ ä¸éœ€è¦è¿‡å¤šå…³æ³¨è¿™äº› V8 å¼•æ“çš„å†…éƒ¨é€‰é¡¹ã€‚ä½†æ˜¯ï¼Œéšç€ä½ å¯¹ Node.js çš„è¿›ä¸€æ­¥å­¦ä¹ å’Œæ·±å…¥ï¼Œäº†è§£å¹¶åˆ©ç”¨è¿™äº›é€‰é¡¹å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ä¼˜åŒ–å’Œè°ƒè¯•ä½ çš„åº”ç”¨ç¨‹åºã€‚</p><h3 id="v8-pool-size-num" tabindex="-1"><a class="header-anchor" href="#v8-pool-size-num"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--v8-pool-sizenum" target="_blank" rel="noopener noreferrer">--v8-pool-size=num</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå®ƒå…è®¸åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚ç†è§£ Node.js çš„ä¸€éƒ¨åˆ†æ¶‰åŠäº†è§£å®ƒæ˜¯å¦‚ä½•åˆ©ç”¨ V8 å¼•æ“æ¥æ‰§è¡Œä»£ç çš„ã€‚</p><p>V8 å¼•æ“å†…éƒ¨æœ‰å¾ˆå¤šå¤æ‚çš„æœºåˆ¶æ¥ä¼˜åŒ–æ€§èƒ½ï¼Œå…¶ä¸­ä¹‹ä¸€å°±æ˜¯â€œV8 å †å¤–å†…å­˜æ± â€ï¼ˆV8 non-heap memory poolï¼‰ã€‚è¿™å—å†…å­˜æ± è¢«ç”¨ä½œå­˜æ”¾ JavaScript å¯¹è±¡å’Œå‡½æ•°ä¸Šä¸‹æ–‡ç­‰ä¸åœ¨ JavaScript å †ä¸­ç®¡ç†çš„å†…å­˜ã€‚</p><p><code>--v8-pool-size=num</code> æ˜¯ä¸€ä¸ª Node.js çš„å¯åŠ¨å‚æ•°ï¼Œå®ƒå…è®¸å¼€å‘è€…æŒ‡å®š V8 å†…å­˜æ± çš„å¤§å°ã€‚è¿™ä¸ªå‚æ•°åé¢è·Ÿç€çš„ <code>num</code> å°±æ˜¯ä½ æƒ³è¦è®¾ç½®çš„å†…å­˜æ± çš„å¤§å°ï¼Œå•ä½æ˜¯ MBï¼ˆå…†å­—èŠ‚ï¼‰ã€‚</p><p>ä»¥ä¸‹ä¸¾å‡ ä¸ªå®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><ol><li><p><strong>é»˜è®¤æƒ…å†µ</strong>:<br> é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä½ ä¸æŒ‡å®š <code>--v8-pool-size</code> å‚æ•°ï¼ŒNode.js/V8 å°†è‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªå†…å­˜æ± çš„å¤§å°ï¼Œå®ƒä¼šæ ¹æ®å¯ç”¨ç³»ç»Ÿå†…å­˜å’Œåº”ç”¨çš„éœ€æ±‚æ¥å†³å®šã€‚</p></li><li><p><strong>å°å‹æœåŠ¡æˆ–èµ„æºå—é™çš„ç¯å¢ƒ</strong>:<br> å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç®€å•çš„æœåŠ¡ï¼Œæˆ–è€…ä½ çš„åº”ç”¨è¿è¡Œåœ¨å†…å­˜éå¸¸å—é™çš„ç¯å¢ƒï¼ˆæ¯”å¦‚æŸäº›äº‘æœåŠ¡æä¾›å•†çš„å¾®å‹å®ä¾‹ï¼‰ï¼Œä½ å¯èƒ½æƒ³è¦é™ä½å†…å­˜æ± çš„å¤§å°ä»¥å‡å°‘æ•´ä½“çš„å†…å­˜å ç”¨ã€‚ä¾‹å¦‚ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --v8-pool-size=16</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¸ªå‘½ä»¤å°† V8 å†…å­˜æ± çš„å¤§å°è®¾ç½®ä¸º 16MBï¼Œä»è€Œå¯èƒ½å¸®åŠ©é™ä½æ•´ä½“å†…å­˜ä½¿ç”¨ã€‚</p></li><li><p><strong>é«˜æ€§èƒ½è¦æ±‚çš„å¤§å‹åº”ç”¨</strong>:<br> ç›¸åï¼Œå¦‚æœä½ çš„åº”ç”¨æ˜¯ CPU å¯†é›†å‹çš„æˆ–è€…å¤„ç†å¤§é‡çš„å¹¶å‘ä»»åŠ¡ï¼Œå¢åŠ å†…å­˜æ± çš„å¤§å°å¯ä»¥æé«˜æ€§èƒ½ï¼Œå› ä¸ºå®ƒå‡å°‘äº† V8 è¿›è¡Œåƒåœ¾å›æ”¶çš„é¢‘ç‡ã€‚ä¾‹å¦‚ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --v8-pool-size=128</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> my-large-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™å°†å†…å­˜æ± çš„å¤§å°è°ƒæ•´ä¸º 128MBï¼Œå¯èƒ½ä¼šå¯¹æ€§èƒ½æœ‰ç§¯æå½±å“ï¼Œç‰¹åˆ«æ˜¯å½“ä½ çš„åº”ç”¨æ­£åœ¨å¤„ç†å¤§é‡è®¡ç®—å¯†é›†å‹ä»»åŠ¡æ—¶ã€‚</p></li></ol><p>è¯·æ³¨æ„ï¼Œè°ƒæ•´ <code>--v8-pool-size</code> ä¸æ˜¯é€šå¸¸ä¼˜åŒ– Node.js åº”ç”¨æ€§èƒ½çš„é¦–é€‰æ–¹æ³•ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½æ°¸è¿œä¸éœ€è¦ä¿®æ”¹è¿™ä¸ªå€¼ã€‚åªæœ‰åœ¨ä½ ç¡®ä¿¡åº”ç”¨çš„æ€§èƒ½ç“¶é¢ˆä¸ V8 çš„å†…å­˜ç®¡ç†æœ‰å…³æ—¶ï¼Œæ‰è€ƒè™‘è°ƒæ•´æ­¤è®¾ç½®ã€‚æ­¤å¤–ï¼Œè®¾ç½®è¿‡å°å¯èƒ½å¯¼è‡´åº”ç”¨æ€§èƒ½ä¸‹é™ï¼Œå› ä¸º V8 éœ€è¦æ›´é¢‘ç¹åœ°è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œè®¾ç½®è¿‡å¤§åˆ™å¯èƒ½ä¼šæµªè´¹å†…å­˜èµ„æºã€‚</p><h3 id="v-version" tabindex="-1"><a class="header-anchor" href="#v-version"><span><a href="https://nodejs.org/docs/latest/api/cli.html#-v---version" target="_blank" rel="noopener noreferrer">-v, --version</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥è°ˆè°ªå…³äº Node.js ä¸­çš„<code>-v</code>æˆ–è€…<code>--version</code>é€‰é¡¹ã€‚</p><p>å½“ä½ åœ¨å‘½ä»¤è¡Œï¼ˆä¹Ÿå«ç»ˆç«¯æˆ–æ§åˆ¶å°ï¼‰ä¸­è¿è¡Œ<code>node -v</code>æˆ–è€…<code>node --version</code>æ—¶ï¼Œè¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯æ˜¾ç¤ºä½ å½“å‰å®‰è£…çš„ Node.js çš„ç‰ˆæœ¬å·ã€‚äº†è§£ä½ æ­£åœ¨ä½¿ç”¨çš„ Node.js ç‰ˆæœ¬æ˜¯å¾ˆé‡è¦çš„ï¼Œå› ä¸ºä¸åŒçš„ç‰ˆæœ¬å¯èƒ½æœ‰ä¸åŒçš„ç‰¹æ€§å’Œ Bug ä¿®å¤ã€‚çŸ¥é“ç‰ˆæœ¬å¯ä»¥å¸®åŠ©ä½ è¿½è¸ªç‰¹æ€§å’Œç¡®ä¿ä½ çš„ä»£ç èƒ½åœ¨ä½ æ‰€ä½¿ç”¨çš„ç‰ˆæœ¬ä¸Šæ­£å¸¸å·¥ä½œã€‚</p><p>ä¸‹é¢ä¸¾å‡ ä¸ªä¾‹å­æ¥è¯´æ˜è¿™ä¸ªå‘½ä»¤çš„å®é™…åº”ç”¨ï¼š</p><h3 id="ä¾‹å­-1-æ£€æŸ¥-node-js-ç‰ˆæœ¬" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-æ£€æŸ¥-node-js-ç‰ˆæœ¬"><span>ä¾‹å­ 1ï¼šæ£€æŸ¥ Node.js ç‰ˆæœ¬</span></a></h3><p>å‡å¦‚ä½ åˆšåˆšåœ¨ä½ çš„è®¡ç®—æœºä¸Šå®‰è£…æˆ–æ›´æ–°äº† Node.jsï¼Œä½ å¯èƒ½æƒ³ç¡®è®¤å®‰è£…æˆ–æ›´æ–°æ˜¯å¦æˆåŠŸã€‚æ‰“å¼€ä½ çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -v</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æˆ–è€…</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --version</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç„¶åæŒ‰å›è½¦é”®ã€‚ä½ ä¼šçœ‹åˆ°ä¸€ä¸ªä»¥<code>v</code>å¼€å¤´çš„ç‰ˆæœ¬å·ï¼Œæ¯”å¦‚<code>v21.7.1</code>ï¼Œè¿™è¡¨æ˜ä½ å½“å‰å®‰è£…çš„ Node.js ç‰ˆæœ¬æ˜¯ 21.7.1ã€‚</p><h3 id="ä¾‹å­-2-ç¼–å†™è„šæœ¬æ£€æµ‹-node-js-ç‰ˆæœ¬" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ç¼–å†™è„šæœ¬æ£€æµ‹-node-js-ç‰ˆæœ¬"><span>ä¾‹å­ 2ï¼šç¼–å†™è„šæœ¬æ£€æµ‹ Node.js ç‰ˆæœ¬</span></a></h3><p>å¦‚æœä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªéœ€è¦ç‰¹å®š Node.js ç‰ˆæœ¬æ‰èƒ½è¿è¡Œçš„ç¨‹åºï¼Œä½ å¯ä»¥åœ¨ç¨‹åºå¼€å§‹æ—¶æ£€æŸ¥ Node.js ç‰ˆæœ¬ã€‚è¿™æ ·å¯ä»¥åœ¨ç¨‹åºè¿è¡Œä¹‹å‰å°±é¿å…ç”±äºç‰ˆæœ¬ä¸åŒ¹é…è€Œå¯¼è‡´çš„é—®é¢˜ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> execSync</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;child_process&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">execSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> version</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> execSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node -v&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">trim</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`æ‚¨çš„Node.jsç‰ˆæœ¬æ˜¯ï¼š</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;v21.7.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ­¤ç¨‹åºéœ€è¦Node.js v21.7.1æ‰èƒ½è¿è¡Œã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">exit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç ä½¿ç”¨ Node.js å†…ç½®çš„<code>child_process</code>æ¨¡å—æ‰§è¡Œ<code>node -v</code>å‘½ä»¤ï¼Œè·å–å½“å‰çš„ Node.js ç‰ˆæœ¬ï¼Œå¹¶å°†å…¶ä¸æ‰€éœ€çš„ç‰ˆæœ¬è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œå®ƒå°†æ‰“å°ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯å¹¶é€€å‡ºç¨‹åºã€‚</p><h3 id="ä¾‹å­-3-åˆ›å»ºå®‰è£…è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-3-åˆ›å»ºå®‰è£…è„šæœ¬"><span>ä¾‹å­ 3ï¼šåˆ›å»ºå®‰è£…è„šæœ¬</span></a></h3><p>å¦‚æœä½ åœ¨ä¸ºå¤šäººå¼€å‘è½¯ä»¶ï¼Œä½ å¯èƒ½éœ€è¦ç¡®ä¿æ¯ä¸ªäººéƒ½åœ¨ç”¨ç›¸åŒç‰ˆæœ¬çš„ Node.js æ¥é¿å…ä¸ä¸€è‡´ã€‚ä½ å¯ä»¥å†™ä¸€ä¸ªç®€å•çš„å®‰è£…è„šæœ¬ï¼Œåœ¨ç”¨æˆ·å°è¯•å®‰è£…ä½ çš„è½¯ä»¶æ—¶æ£€æŸ¥ä»–ä»¬çš„ Node.js ç‰ˆæœ¬ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">##!/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">REQUIRED_NODE_VERSION</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;v21.7.1&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">current_version</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -v</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [ </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$current_version</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$REQUIRED_NODE_VERSION</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ]; </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;é”™è¯¯ï¼šéœ€è¦Node.jsç‰ˆæœ¬</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$REQUIRED_NODE_VERSION</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">ã€‚&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;å½“å‰ç‰ˆæœ¬æ˜¯</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$current_version</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">ã€‚&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">    exit</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;æ£€æµ‹åˆ°æ­£ç¡®çš„Node.jsç‰ˆæœ¬ï¼š</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$current_version</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">ã€‚&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    # åœ¨æ­¤å¤„æ”¾ç½®å…¶ä»–å®‰è£…æ­¥éª¤</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">fi</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ª Bash è„šæœ¬é¦–å…ˆå®šä¹‰äº†æ‰€éœ€çš„ Node.js ç‰ˆæœ¬ï¼Œç„¶åé€šè¿‡è°ƒç”¨<code>node -v</code>è·å–å½“å‰ç‰ˆæœ¬ï¼Œæ¥ç€å°†ä¸¤è€…è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœç‰ˆæœ¬ä¸æ­£ç¡®ï¼Œè„šæœ¬å°†æ‰“å°é”™è¯¯ä¿¡æ¯å¹¶é€€å‡ºï¼›å¦‚æœç‰ˆæœ¬æ­£ç¡®ï¼Œè„šæœ¬å°†ç»§ç»­å…¶ä»–çš„å®‰è£…æ­¥éª¤ã€‚</p><p>å¸Œæœ›è¿™äº›ä¾‹å­èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£<code>node -v</code>æˆ–<code>node --version</code>å‘½ä»¤æ˜¯å¦‚ä½•åœ¨å®è·µä¸­è¢«ä½¿ç”¨çš„ã€‚</p><h3 id="watch" tabindex="-1"><a class="header-anchor" href="#watch"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--watch" target="_blank" rel="noopener noreferrer">--watch</a></span></a></h3><p>Node.js çš„ <code>--watch</code> é€‰é¡¹æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼Œå®ƒå…è®¸ä½ åœ¨å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶ç›‘è§†æ–‡ä»¶çš„å˜åŒ–ã€‚ä¸€æ—¦ä½ å¯ç”¨äº†è¿™ä¸ªå‚æ•°ï¼Œå¦‚æœç›‘è§†çš„æ–‡ä»¶æœ‰ä»»ä½•çš„ä¿®æ”¹ï¼ŒNode.js å°±ä¼šè‡ªåŠ¨é‡å¯åº”ç”¨ç¨‹åºã€‚è¿™ä¸ªåŠŸèƒ½å°¤å…¶æœ‰åŠ©äºå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºå®ƒçœå»äº†æ¯æ¬¡æ‰‹åŠ¨é‡æ–°å¯åŠ¨æœåŠ¡å™¨æ¥æŸ¥çœ‹æ›´æ”¹æ•ˆæœçš„éº»çƒ¦ã€‚</p><p>è¦ä½¿ç”¨ <code>--watch</code> å‚æ•°ï¼Œé€šå¸¸å¯ä»¥åœ¨è¿è¡Œ node å‘½ä»¤çš„æ—¶å€™ç›´æ¥åŠ ä¸Šå®ƒï¼Œåƒè¿™æ ·ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --watch</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤ä¼šå¯åŠ¨åä¸º <code>app.js</code> çš„ Node.js åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”ä¼šç›‘è§†åº”ç”¨ç¨‹åºä¸­çš„æ–‡ä»¶å˜åŒ–ã€‚å¦‚æœ <code>app.js</code> æˆ–è€…å®ƒå¼•ç”¨çš„ä»»ä½•æ–‡ä»¶è¢«ä¿®æ”¹äº†ï¼ŒNode.js å°±ä¼šè‡ªåŠ¨é‡å¯è¿™ä¸ªåº”ç”¨ç¨‹åºã€‚</p><p>è¿™é‡Œæ˜¯ä¸€äº›å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><ol><li><p><strong>å¼€å‘ API</strong>: å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª RESTful APIï¼Œä½ å¯èƒ½éœ€è¦é¢‘ç¹ä¿®æ”¹ä½ çš„è·¯ç”±å¤„ç†å‡½æ•°æˆ–è€…æ•°æ®åº“æŸ¥è¯¢é€»è¾‘ã€‚ä¸ºäº†çœ‹åˆ°è¿™äº›æ›´æ”¹çš„æ•ˆæœï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>--watch</code> æ¥è‡ªåŠ¨é‡å¯æœåŠ¡å™¨ï¼Œè¿™æ ·ä½ æ¯æ¬¡ä¿®æ”¹ä»£ç åå°±æ— éœ€æ‰‹åŠ¨é‡å¯äº†ã€‚</p></li><li><p><strong>åˆ¶ä½œç½‘ç«™</strong>: å¦‚æœä½ åœ¨ç”¨ Node.js å¼€å‘ä¸€ä¸ªç½‘ç«™ï¼Œé‚£ä¹ˆæ¯æ¬¡ä½ æ›´æ”¹æ¨¡æ¿æˆ–è€…æ ·å¼è¡¨çš„æ—¶å€™ï¼Œéƒ½å¸Œæœ›ç«‹å³çœ‹åˆ°ç»“æœã€‚é€šè¿‡ä½¿ç”¨ <code>--watch</code>ï¼Œä½ çš„æœåŠ¡å™¨ä¼šåœ¨è¿™äº›é™æ€èµ„æºè¢«ä¿®æ”¹åè‡ªåŠ¨é‡æ–°åŠ è½½ï¼Œå¸®åŠ©ä½ å¿«é€Ÿè¿­ä»£å¼€å‘ã€‚</p></li><li><p><strong>å®éªŒæ€§ä»£ç æ›´æ”¹</strong>: å½“ä½ åœ¨å°è¯•ä¸åŒçš„ç®—æ³•æˆ–åŠŸèƒ½å®ç°æ—¶ï¼Œä½ å¯èƒ½éœ€è¦é¢‘ç¹é‡å¯åº”ç”¨ç¨‹åºä»¥æµ‹è¯•æ–°ä»£ç ã€‚<code>--watch</code> é€‰é¡¹åœ¨è¿™ç§æƒ…å†µä¸‹ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒèŠ‚çœäº†ä½ é‡å¤æ‰§è¡Œé‡å¯å‘½ä»¤çš„æ—¶é—´ã€‚</p></li></ol><p>è¯·æ³¨æ„ï¼Œ<code>--watch</code> åŠŸèƒ½è™½ç„¶å¾ˆæ–¹ä¾¿ï¼Œä½†å®ƒå¹¶ä¸æ˜¯ç”¨æ¥æ›¿ä»£ç”Ÿäº§ç¯å¢ƒä¸­çš„æŒç»­é›†æˆ/æŒç»­éƒ¨ç½² (CI/CD) æµç¨‹çš„ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä½ åº”è¯¥ä½¿ç”¨ä¸“é—¨çš„å·¥å…·æ¥ç®¡ç†åº”ç”¨ç¨‹åºçš„éƒ¨ç½²å’Œæ›´æ–°ã€‚</p><p>å¦å¤–ï¼Œå¯¹äºè¾ƒå¤§çš„é¡¹ç›®ï¼Œ<code>--watch</code> åŠŸèƒ½å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºå®ƒéœ€è¦è·Ÿè¸ªå¾ˆå¤šæ–‡ä»¶çš„å˜åŒ–ã€‚å¦‚æœä½ é‡åˆ°è¿™ç§æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨åƒ <code>nodemon</code> è¿™æ ·çš„å·¥å…·ï¼Œå®ƒæä¾›äº†æ›´é«˜çº§çš„ç›‘è§†åŠŸèƒ½å’Œé…ç½®é€‰é¡¹ã€‚</p><h3 id="watch-path" tabindex="-1"><a class="header-anchor" href="#watch-path"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--watch-path" target="_blank" rel="noopener noreferrer">--watch-path</a></span></a></h3><p><code>--watch-path</code> æ˜¯ Node.js å‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰ä¸­çš„ä¸€ä¸ªé€‰é¡¹ï¼Œå®ƒå…è®¸ä½ æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å®šçš„æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶æ¥ç›‘è§†å®ƒä»¬çš„å˜åŒ–ã€‚å½“ä½ åœ¨è¿™äº›æŒ‡å®šçš„è·¯å¾„ä¸Šè¿è¡Œ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œå¦‚æœç›‘è§†çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æœ‰ä»»ä½•å˜åŒ–ï¼ŒNode.js å°†ä¼šé‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºã€‚</p><p>è¿™ä¸ªåŠŸèƒ½å¯¹äºå¼€å‘æœŸé—´éå¸¸å®ç”¨ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿåœ¨ä½ ä¿®æ”¹äº†ä»£ç ä¹‹åè‡ªåŠ¨é‡å¯åº”ç”¨ï¼Œè¿™æ ·ä½ å°±å¯ä»¥ç›´æ¥çœ‹åˆ°æ›´æ”¹åçš„æ•ˆæœï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨åœæ­¢å¹¶é‡æ–°å¼€å§‹ä½ çš„åº”æœåŠ¡ã€‚</p><p>ä½¿ç”¨ <code>--watch-path</code> çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --watch-path</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> path1[,path2,...]</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™é‡Œæ˜¯ä¸€äº›å…·ä½“çš„ä¾‹å­ï¼š</p><ol><li><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘ç»œåº”ç”¨ï¼Œä½ çš„åº”ç”¨ä»£ç ä½äº <code>app.js</code> æ–‡ä»¶ä¸­ã€‚ä½ å¸Œæœ›æ¯å½“è¿™ä¸ªæ–‡ä»¶è¢«ä¿®æ”¹åéƒ½èƒ½è‡ªåŠ¨é‡å¯æœåŠ¡å™¨ä»¥æŸ¥çœ‹æœ€æ–°çš„æ›´æ”¹ã€‚ä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --watch-path</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™è¡Œå‘½ä»¤å°†ç›‘è§† <code>app.js</code> æ–‡ä»¶ï¼Œä¸€æ—¦ä½ ä¿å­˜äº†å¯¹ <code>app.js</code> çš„æ›´æ”¹ï¼ŒNode.js ä¼šè‡ªåŠ¨é‡æ–°å¯åŠ¨å®ƒã€‚</p></li><li><p>å¦‚æœä½ æœ‰ä¸€ä¸ªé¡¹ç›®ï¼Œå…¶ä¸­åŒ…å«äº†å¤šä¸ªéœ€è¦ç›‘æ§çš„ç›®å½•ï¼Œæ¯”å¦‚ <code>src</code> å’Œ <code>lib</code>ï¼Œä½ å¯ä»¥åŒæ—¶ç›‘æ§å®ƒä»¬ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --watch-path</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> src,lib</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¼šç›‘è§† <code>src</code> å’Œ <code>lib</code> æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶ã€‚å½“ä½ ä¿®æ”¹è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹ä¸­çš„ä»»ä½•æ–‡ä»¶æ—¶ï¼Œåº”ç”¨éƒ½ä¼šé‡æ–°å¯åŠ¨ã€‚</p></li><li><p>å¯¹äºå¤§å‹é¡¹ç›®ï¼Œå¯èƒ½åªæƒ³ç›‘è§†éƒ¨åˆ†æ–‡ä»¶å¤¹æˆ–æŒ‡å®šç±»å‹çš„æ–‡ä»¶ï¼Œæ¯”å¦‚æ‰€æœ‰çš„ JavaScript æ–‡ä»¶(<code>*.js</code>)ã€‚æ­¤æ—¶ï¼Œä½ å¯èƒ½éœ€è¦ç»“åˆä½¿ç”¨å…¶ä»–å·¥å…·æˆ–è„šæœ¬æ¥å¸®åŠ©ç­›é€‰å“ªäº›æ–‡ä»¶éœ€è¦è¢«ç›‘è§†ï¼Œå› ä¸º <code>--watch-path</code> æœ¬èº«ä¸æ”¯æŒåƒæ–‡ä»¶é€šé…ç¬¦é‚£æ ·çš„æ¨¡å¼åŒ¹é…ã€‚</p></li></ol><p>æ€»ç»“èµ·æ¥ï¼Œ<code>--watch-path</code> æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„åŠŸèƒ½ï¼Œå®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…æå‡æ•ˆç‡ï¼Œé€šè¿‡å‡å°‘é‡å¯æœåŠ¡å™¨çš„æ‰‹åŠ¨æ“ä½œï¼Œè‡ªåŠ¨åŒ–åœ°æŸ¥çœ‹ä»£ç æ›´æ”¹åçš„ç»“æœã€‚ä½†è¯·æ³¨æ„ï¼Œè¿™ä¸ªåŠŸèƒ½å¯èƒ½ä¸é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œå› ä¸ºç”Ÿäº§ç¯å¢ƒé€šå¸¸éœ€è¦ç¨³å®šä¸”å—æ§çš„éƒ¨ç½²æµç¨‹ã€‚</p><h3 id="watch-preserve-output" tabindex="-1"><a class="header-anchor" href="#watch-preserve-output"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--watch-preserve-output" target="_blank" rel="noopener noreferrer">--watch-preserve-output</a></span></a></h3><p>Node.js ä¸­çš„ <code>--watch-preserve-output</code> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ï¼Œå®ƒç”¨äº Node.js çš„â€œç›‘è§†â€æ¨¡å¼ã€‚ç›‘è§†æ¨¡å¼å…è®¸ä½ åœ¨å¼€å‘è¿‡ç¨‹ä¸­è‡ªåŠ¨é‡å¯ä½ çš„åº”ç”¨ç¨‹åºï¼Œæ¯å½“ä½ ä¿®æ”¹å¹¶ä¿å­˜äº†ä»£ç æ–‡ä»¶æ—¶ã€‚è¿™ä¸ªé€‰é¡¹æ˜¯ <code>node --watch</code> æˆ– <code>-w</code> çš„ä¸€éƒ¨åˆ†ã€‚</p><p>é€šå¸¸ä¸å¸¦ <code>--watch-preserve-output</code> é€‰é¡¹æ—¶ï¼Œæ¯æ¬¡åº”ç”¨ç¨‹åºé‡æ–°å¯åŠ¨ï¼Œä¹‹å‰çš„æ§åˆ¶å°è¾“å‡ºéƒ½ä¼šè¢«æ¸…é™¤ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªæ–°çš„å¹²å‡€çš„æ§åˆ¶å°ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶å€™ä½ å¯èƒ½æƒ³è¦ä¿ç•™ä¹‹å‰çš„è¾“å‡ºï¼Œä»¥ä¾¿å¯¹ç…§æ—§çš„è¾“å‡ºç»“æœè°ƒè¯•æˆ–è€…æ¯”è¾ƒå˜åŒ–ã€‚è¿™å°±æ˜¯ <code>--watch-preserve-output</code> å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚</p><p>ä½¿ç”¨ <code>--watch-preserve-output</code> æ—¶ï¼Œå³ä½¿åº”ç”¨ç¨‹åºé‡æ–°å¯åŠ¨ï¼Œä¹‹å‰çš„è¾“å‡ºä¹Ÿä¼šä¿ç•™åœ¨ç»ˆç«¯æˆ–å‘½ä»¤æç¤ºç¬¦çª—å£ä¸­ã€‚</p><p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼š</p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªç®€å•çš„ Node.js åº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºåœ¨æ–‡ä»¶ <code>app.js</code> ä¸­å®šä¹‰ï¼Œå¹¶ä¸”ä¼šè¾“å‡ºå½“å‰æ—¶é—´ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// app.js</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toISOString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><p>ä¸ä½¿ç”¨ <code>--watch-preserve-output</code> é€‰é¡¹ï¼š<br> å½“ä½ è¿è¡Œä»¥ä¸‹å‘½ä»¤æ—¶ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --watch</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ¯æ¬¡ä½ ä¿®æ”¹å¹¶ä¿å­˜ <code>app.js</code> æ–‡ä»¶ï¼Œåº”ç”¨ç¨‹åºå°†è‡ªåŠ¨é‡å¯ï¼Œä½ ä¼šçœ‹åˆ°ç»ˆç«¯ä¸Šåªæ˜¾ç¤ºæœ€æ–°çš„æ—¶é—´ï¼Œå…ˆå‰çš„è¾“å‡ºéƒ½ä¼šæ¶ˆå¤±ã€‚</p></li><li><p>ä½¿ç”¨ <code>--watch-preserve-output</code> é€‰é¡¹ï¼š<br> å½“ä½ è¿è¡Œä»¥ä¸‹å‘½ä»¤æ—¶ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --watch</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --watch-preserve-output</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¬¡ï¼Œå½“ä½ ä¿®æ”¹å¹¶ä¿å­˜ <code>app.js</code> æ–‡ä»¶ï¼Œåº”ç”¨ç¨‹åºå°†è‡ªåŠ¨é‡å¯ï¼Œä½†ä½ ä¼šçœ‹åˆ°ç»ˆç«¯ä¸Šä¿ç•™äº†ä¹‹å‰æ‰€æœ‰çš„è¾“å‡ºã€‚æ¯æ¬¡é‡å¯åï¼Œæ–°çš„æ—¶é—´ä¼šæ·»åŠ åˆ°ç»ˆç«¯è¾“å‡ºçš„æœ«å°¾ï¼Œä¸ä¼šæ¸…é™¤ä¹‹å‰çš„å†…å®¹ã€‚</p></li></ol><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªé€‰é¡¹æ›´å¤šåœ°ç”¨äºå¼€å‘è°ƒè¯•åœºæ™¯ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¾ˆå°‘ä½¿ç”¨ã€‚å®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…æŸ¥çœ‹éšæ—¶é—´å˜åŒ–çš„è¾“å‡ºï¼Œè€Œä¸ä¼šä¸¢å¤±ä»»ä½•é‡è¦çš„è°ƒè¯•ä¿¡æ¯ã€‚</p><h3 id="zero-fill-buffers" tabindex="-1"><a class="header-anchor" href="#zero-fill-buffers"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--zero-fill-buffers" target="_blank" rel="noopener noreferrer">--zero-fill-buffers</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œbuffer æ˜¯ä¸€ç§ç”¨äºå­˜å‚¨æ•°æ®çš„å¯¹è±¡ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ®µåŸå§‹å†…å­˜çš„ç›´æ¥è¡¨ç¤ºã€‚å½“ä½ åˆ›å»ºä¸€ä¸ªæ–°çš„ buffer æ—¶ï¼Œå®ƒä¼šè¢«åˆ†é…æŒ‡å®šå¤§å°çš„å†…å­˜ç©ºé—´ã€‚ä¸è¿‡ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›å†…å­˜ç©ºé—´çš„å†…å®¹æ˜¯æœªåˆå§‹åŒ–çš„ï¼Œä¹Ÿå°±æ˜¯è¯´é‡Œé¢å¯èƒ½åŒ…å«ä»»ä½•ä¹‹å‰ç•™åœ¨é‚£é‡Œçš„æ•°æ®ã€‚è¿™ä¸ªç‰¹æ€§æœ‰æ—¶å€™ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºä¸€ä¸ª buffer å¯èƒ½æ„å¤–åœ°æš´éœ²æ—§çš„ã€æ•æ„Ÿçš„æ•°æ®ã€‚</p><p><code>--zero-fill-buffers</code> æ˜¯ Node.js åœ¨å¯åŠ¨æ—¶å¯ä»¥ä½¿ç”¨çš„å‘½ä»¤è¡Œé€‰é¡¹ã€‚å½“ä½ åœ¨è¿è¡Œ Node.js ç¨‹åºæ—¶ä½¿ç”¨äº†è¿™ä¸ªé€‰é¡¹ï¼Œå®ƒä¼šæ”¹å˜é»˜è®¤è¡Œä¸ºï¼šæ‰€æœ‰æ–°åˆ†é…çš„ buffers éƒ½ä¼šè‡ªåŠ¨ç”¨ 0 å¡«å……ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æ²¡æœ‰æ—§æ•°æ®æ³„éœ²ç»™æ–°åˆ›å»ºçš„ bufferã€‚</p><p>è®©æˆ‘ä»¬ä¸¾å‡ ä¸ªä¾‹å­æ¥è¯´æ˜è¿™ä¸ªé€‰é¡¹çš„å½±å“ï¼š</p><h3 id="ç¤ºä¾‹-1-æœªä½¿ç”¨-zero-fill-buffers" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-æœªä½¿ç”¨-zero-fill-buffers"><span>ç¤ºä¾‹ 1ï¼šæœªä½¿ç”¨ <code>--zero-fill-buffers</code></span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> buffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">allocUnsafe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ†é…äº†ä¸€ä¸ªé•¿åº¦ä¸º10çš„buffer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯èƒ½ä¼šè¾“å‡ºéšæœºæ•°æ®</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>Buffer.allocUnsafe</code> æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ª <code>buffer</code>ã€‚è¿™ä¸ªæ–¹æ³•æ¯” <code>Buffer.alloc</code> å¿«ï¼Œå› ä¸ºå®ƒä¸ä¼šæ¸…é™¤å†…å­˜åŒºåŸŸï¼Œå³æ‰€è°“çš„ &quot;unsafe&quot;ï¼ˆä¸å®‰å…¨ï¼‰ã€‚æ‰€ä»¥æ‰“å°å‡ºçš„ <code>buffer</code> å¯èƒ½ä¼šåŒ…å«ä»»æ„çš„ã€é¢„å…ˆå­˜åœ¨çš„æ•°æ®ã€‚</p><h3 id="ç¤ºä¾‹-2-ä½¿ç”¨-zero-fill-buffers" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ä½¿ç”¨-zero-fill-buffers"><span>ç¤ºä¾‹ 2ï¼šä½¿ç”¨ <code>--zero-fill-buffers</code></span></a></h3><p>å¯åŠ¨ Node.js ç¨‹åºæ—¶ä½¿ç”¨ <code>--zero-fill-buffers</code>ï¼š</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --zero-fill-buffers</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> myscript.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>myscript.js</code> çš„å†…å®¹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> buffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">allocUnsafe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†è¾“å‡ºå…¨éƒ¨å¡«å……ä¸º0çš„buffer</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå³ä½¿æˆ‘ä»¬ä½¿ç”¨äº† <code>Buffer.allocUnsafe</code> æ–¹æ³•ï¼Œç”±äºå¯åŠ¨æ—¶å¸¦ä¸Šäº† <code>--zero-fill-buffers</code>ï¼Œæ–°åˆ›å»ºçš„ buffer å†…å®¹å°†è‡ªåŠ¨å¡«å……ä¸º 0ï¼Œä¸ä¼šæ˜¾ç¤ºä»»ä½•éšæœºçš„æ•°æ®ã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯-1" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯-1"><span>ä½¿ç”¨åœºæ™¯</span></a></h3><p>åœ¨å¤§å¤šæ•°åº”ç”¨ä¸­ï¼Œä½ ä¸éœ€è¦ç”¨åˆ° <code>--zero-fill-buffers</code>ï¼Œå› ä¸ºå¦‚æœä½ éœ€è¦å®‰å…¨çš„ bufferï¼Œä½ åº”è¯¥ä½¿ç”¨ <code>Buffer.alloc</code> è€Œé <code>Buffer.allocUnsafe</code>ã€‚ä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> safeBuffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">alloc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®‰å…¨åœ°åˆ†é…å¹¶è‡ªåŠ¨ç”¨0å¡«å……</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">safeBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºå…¨éƒ¨å¡«å……ä¸º0çš„buffer</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ï¼Œå¦‚æœä½ æ­£åœ¨æ‰§è¡Œå¤§é‡çš„ buffer åˆ†é…ï¼Œè€Œæ€§èƒ½æ˜¯ä¸ªå…³é”®è€ƒè™‘ç‚¹ï¼Œå¹¶ä¸”ä½ å·²ç»æœ‰ç­–ç•¥æ¥å¤„ç†åˆå§‹åŒ–åçš„ buffer æ•°æ®ï¼Œé‚£ä¹ˆ<code>--zero-fill-buffers</code>é€‰é¡¹å¯èƒ½å¯¹ä½ æœ‰ç”¨ã€‚å®ƒå¯ä»¥ç¡®ä¿ä½ çš„åº”ç”¨ä¸ä¼šæ„å¤–åœ°æ³„éœ²æ•æ„Ÿä¿¡æ¯ï¼ŒåŒæ—¶åˆå¯ä»¥åˆ©ç”¨ <code>Buffer.allocUnsafe</code> çš„æ€§èƒ½ä¼˜åŠ¿ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>--zero-fill-buffers</code> æ˜¯ä¸€ä¸ªæä¾›é¢å¤–æ•°æ®å®‰å…¨å±‚çš„é€‰é¡¹ï¼Œå®ƒç¡®ä¿äº†æ–°åˆ†é…çš„ buffer è¢«è‡ªåŠ¨æ¸…é›¶ï¼Œä»è€Œé¿å…äº†æ½œåœ¨çš„æ•°æ®æ³„æ¼é£é™©ã€‚åœ¨å¤„ç†æ•æ„Ÿæ•°æ®æˆ–è€…æƒ³è¦ç¡®ä¿å†…å­˜ä¸­æ²¡æœ‰æ®‹ç•™æ•°æ®æ—¶ï¼Œè¿™ä¸ªé€‰é¡¹ç‰¹åˆ«æœ‰ç”¨ã€‚</p><h2 id="environment-variables" tabindex="-1"><a class="header-anchor" href="#environment-variables"><span><a href="https://nodejs.org/docs/latest/api/cli.html#environment-variables" target="_blank" rel="noopener noreferrer">Environment variables</a></span></a></h2><p>åœ¨ Node.js ä¸­ï¼Œç¯å¢ƒå˜é‡æ˜¯ä¸€ç§ç”¨æ¥å®šä¹‰ç¨‹åºè¿è¡Œæ—¶ç¯å¢ƒä¿¡æ¯çš„æœºåˆ¶ã€‚è¿™äº›å˜é‡å¯ä»¥ç”¨æ¥æ§åˆ¶ç¨‹åºçš„è¡Œä¸ºæˆ–è€…å¸®åŠ©ç¨‹åºæ›´å¥½åœ°äº†è§£å®ƒæ‰€åœ¨çš„ç³»ç»Ÿç¯å¢ƒã€‚æ¯”å¦‚ï¼Œå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®æ—¥å¿—çº§åˆ«ã€æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€æœåŠ¡ç«¯å£å·ç­‰ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€äº› Node.js ä¸­å¸¸è§çš„ç¯å¢ƒå˜é‡å’Œå®ƒä»¬çš„ä½œç”¨ï¼š</p><ol><li><p><code>NODE_ENV</code>: è¿™ä¸ªç¯å¢ƒå˜é‡é€šå¸¸ç”¨æ¥æŒ‡å®š Node.js åº”ç”¨ç¨‹åºçš„è¿è¡Œæ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œå½“<code>NODE_ENV</code>è¢«è®¾ç½®ä¸º<code>production</code>æ—¶ï¼Œè¡¨ç¤ºåº”ç”¨ç¨‹åºæ­£åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œï¼Œå¾ˆå¤šåº“ä¼šæ ¹æ®è¿™ä¸ªå€¼è°ƒæ•´è¿è¡Œæ–¹å¼ï¼Œæ¯”å¦‚å‡å°‘æ—¥å¿—è¾“å‡ºã€ä¼˜åŒ–æ€§èƒ½ç­‰ã€‚</p><p><strong>ä¾‹å­</strong>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">NODE_ENV</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;production&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Running in production mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Running in development mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>PORT</code>: å¸¸ç”¨äºæŒ‡å®šåº”ç”¨ç¨‹åºç›‘å¬çš„ç«¯å£å·ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®è¿™ä¸ªå˜é‡ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä¼šä½¿ç”¨é»˜è®¤çš„ç«¯å£å·ï¼Œæ¯”å¦‚ 3000ã€‚</p><p><strong>ä¾‹å­</strong>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> express</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;express&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> app</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> express</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> port</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ||</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">app</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Server listening on port </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>DATABASE_URL</code>: å¯ç”¨æ¥æŒ‡æ˜æ•°æ®åº“çš„è¿æ¥ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ•°æ®åº“ç±»å‹ã€åœ°å€ã€ç«¯å£å·ã€ç”¨æˆ·åå’Œå¯†ç ç­‰ã€‚</p><p><strong>ä¾‹å­</strong>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> mongoose</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;mongoose&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">mongoose</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">DATABASE_URL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  useNewUrlParser</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  useUnifiedTopology</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>DEBUG</code>: è¿™ä¸ªç¯å¢ƒå˜é‡ç”¨æ¥å¯åŠ¨è°ƒè¯•æ—¥å¿—ã€‚è®¸å¤š Node.js æ¨¡å—ï¼ˆç‰¹åˆ«æ˜¯ä¸­é—´ä»¶ï¼‰ä½¿ç”¨<code>debug</code>æ¨¡å—æ¥è¾“å‡ºè°ƒè¯•ä¿¡æ¯ï¼Œé€šè¿‡è®¾ç½®æ­¤å˜é‡å¯ä»¥æ§åˆ¶å“ªäº›è°ƒè¯•ä¿¡æ¯è¢«æ‰“å°å‡ºæ¥ã€‚</p><p><strong>ä¾‹å­</strong>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®ç¯å¢ƒå˜é‡ DEBUG=app:* å¯ä»¥æ‰“å°æ‰€æœ‰ä»¥appå¼€å¤´çš„è°ƒè¯•æ—¥å¿—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> debug</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;debug&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;app:startup&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Starting the application...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>è¦è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ç›´æ¥è®¾ç½®ï¼Œä¹Ÿå¯ä»¥åœ¨è„šæœ¬æ–‡ä»¶ä¸­è®¾å®šï¼Œæˆ–è€…ä½¿ç”¨.env æ–‡ä»¶å’Œ dotenv åº“åœ¨ Node.js é¡¹ç›®ä¸­ç®¡ç†ç¯å¢ƒå˜é‡ã€‚</p><p><strong>å‘½ä»¤è¡Œè®¾ç½®ç¯å¢ƒå˜é‡çš„ä¾‹å­</strong>ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## åœ¨Linuxæˆ–macOSä¸­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NODE_ENV</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">production</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## åœ¨Windows CMDä¸­</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> NODE_ENV=production</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> PORT=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## åœ¨Windows PowerShellä¸­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$env</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">NODE_ENV</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;production&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$env</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;5000&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶ååœ¨ä½ çš„ Node.js ä»£ç ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>process.env</code>å¯¹è±¡æ¥è¯»å–è¿™äº›ç¯å¢ƒå˜é‡çš„å€¼ã€‚ä¾‹å¦‚ï¼Œ<code>process.env.NODE_ENV</code>ä¼šå¾—åˆ°<code>&#39;production&#39;</code>å­—ç¬¦ä¸²ï¼Œ<code>process.env.PORT</code>ä¼šå¾—åˆ°<code>&#39;5000&#39;</code>å­—ç¬¦ä¸²ã€‚</p><p>è®°ä½ï¼Œç¯å¢ƒå˜é‡æ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼Œæ‰€ä»¥<code>NODE_ENV</code>å’Œ<code>node_env</code>æ˜¯ä¸åŒçš„ç¯å¢ƒå˜é‡ã€‚åœ¨ Node.js v21.7.1 ç‰ˆæœ¬çš„æ–‡æ¡£ä¸­ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°å…·ä½“çš„ç¯å¢ƒå˜é‡åŠå…¶è¯´æ˜ï¼Œè¿™äº›éƒ½æ˜¯ç”¨äºé…ç½® Node.js è¿è¡Œæ—¶çš„ç‰¹å®šå‚æ•°ã€‚</p><h3 id="force-color-1-2-3" tabindex="-1"><a class="header-anchor" href="#force-color-1-2-3"><span><a href="https://nodejs.org/docs/latest/api/cli.html#force_color1-2-3" target="_blank" rel="noopener noreferrer">FORCE_COLOR=[1, 2, 3]</a></span></a></h3><p><code>FORCE_COLOR=[1, 2, 3]</code> æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨äºåœ¨ Node.js åº”ç”¨ç¨‹åºä¸­å¼ºåˆ¶å¯ç”¨æˆ–æ§åˆ¶é¢œè‰²è¾“å‡ºã€‚å½“ä½ åœ¨ç»ˆç«¯ï¼ˆå‘½ä»¤è¡Œç•Œé¢ï¼‰è¿è¡Œ Node.js ç¨‹åºæ—¶ï¼Œæœ‰äº›æ–‡æœ¬ä¼šä»¥ä¸åŒçš„é¢œè‰²æ˜¾ç¤ºï¼Œä»¥æé«˜å¯è¯»æ€§æˆ–çªå‡ºæŸäº›ä¿¡æ¯ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js ä¼šæ£€æµ‹å®ƒæ˜¯å¦ç›´æ¥è¿æ¥åˆ°ç»ˆç«¯ï¼Œå¹¶ä¸”å¦‚æœæ˜¯ï¼Œå®ƒä¼šè‡ªåŠ¨å¯ç”¨é¢œè‰²è¾“å‡ºã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¯”å¦‚å°†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶æˆ–è€…é€šè¿‡ç®¡é“ä¼ é€’ç»™å…¶ä»–ç¨‹åºæ—¶ï¼ŒNode.js å¯èƒ½ä¼šç¦ç”¨é¢œè‰²è¾“å‡ºã€‚ä½¿ç”¨ <code>FORCE_COLOR</code> ç¯å¢ƒå˜é‡å¯ä»¥è¦†ç›–è¿™ç§è‡ªåŠ¨æ£€æµ‹æœºåˆ¶ã€‚</p><p><code>FORCE_COLOR</code> å¯ä»¥è®¾ç½®ä¸ºä»¥ä¸‹å€¼ä¹‹ä¸€ï¼š</p><ul><li><code>0</code> æˆ–ä¸è®¾ç½®ï¼šå…³é—­å¼ºåˆ¶é¢œè‰²è¾“å‡ºã€‚</li><li><code>1</code>ï¼šå¯ç”¨åŸºæœ¬çš„ 16 è‰²æ¨¡å¼ã€‚</li><li><code>2</code>ï¼šå¯ç”¨æ›´å¹¿æ³›çš„ 256 è‰²æ¨¡å¼ã€‚</li><li><code>3</code>ï¼šå¯ç”¨å…¨å½© TrueColor æ¨¡å¼ï¼Œæ”¯æŒå¤§çº¦ 1600 ä¸‡ç§é¢œè‰²ã€‚</li></ul><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-9" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-9"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="ç¤ºä¾‹-1-å¼ºåˆ¶å¼€å¯åŸºæœ¬çš„é¢œè‰²è¾“å‡º" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-å¼ºåˆ¶å¼€å¯åŸºæœ¬çš„é¢œè‰²è¾“å‡º"><span>ç¤ºä¾‹ 1ï¼šå¼ºåˆ¶å¼€å¯åŸºæœ¬çš„é¢œè‰²è¾“å‡º</span></a></h4><p>å¦‚æœä½ çš„ Node.js è„šæœ¬ä¸­ä½¿ç”¨äº†æŸä¸ªæ”¯æŒé¢œè‰²çš„åº“æ¥è¾“å‡ºå½©è‰²æ–‡æœ¬ï¼Œä½†ä½ å‘ç°åœ¨æŸäº›æƒ…å†µä¸‹é¢œè‰²æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ï¼Œä½ å¯ä»¥å°è¯•å¼ºåˆ¶å¯ç”¨é¢œè‰²è¾“å‡ºï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">FORCE_COLOR</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">1</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your_script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><code>your_script.js</code> å°†ä¼šä»¥åŸºæœ¬çš„ 16 è‰²æ¨¡å¼æ˜¾ç¤ºé¢œè‰²ï¼Œå³ä½¿è¾“å‡ºè¢«é‡å®šå‘åˆ°æ–‡ä»¶ä¸­ã€‚</p><h4 id="ç¤ºä¾‹-2-åœ¨è„šæœ¬ä¸­æ£€æµ‹é¢œè‰²æ”¯æŒ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-åœ¨è„šæœ¬ä¸­æ£€æµ‹é¢œè‰²æ”¯æŒ"><span>ç¤ºä¾‹ 2ï¼šåœ¨è„šæœ¬ä¸­æ£€æµ‹é¢œè‰²æ”¯æŒ</span></a></h4><p>è®¸å¤š Node.js çš„æ—¥å¿—åº“æˆ–å‘½ä»¤è¡Œå·¥å…·åº“ï¼ˆä¾‹å¦‚ chalk, colorsï¼‰éƒ½ä¼šæ ¹æ®ç¯å¢ƒå˜é‡æ¥ç¡®å®šæ˜¯å¦è¾“å‡ºé¢œè‰²ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå‡è®¾çš„ Node.js è„šæœ¬ç¤ºä¾‹ï¼Œå®ƒä½¿ç”¨ <code>chalk</code> æ¥è¾“å‡ºå½©è‰²æ–‡æœ¬ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> chalk</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;chalk&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chalk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">green</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç»¿è‰²æ–‡æœ¬&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chalk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">blue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è“è‰²æ–‡æœ¬&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chalk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">red</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;çº¢è‰²æ–‡æœ¬&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ æƒ³ç¡®ä¿ä¸Šè¿°è„šæœ¬æ€»æ˜¯è¾“å‡ºé¢œè‰²ï¼Œæ— è®ºå…¶æ‰§è¡Œç¯å¢ƒå¦‚ä½•ï¼Œä½ å¯ä»¥åœ¨è¿è¡Œå®ƒä¹‹å‰è®¾ç½® <code>FORCE_COLOR</code> ç¯å¢ƒå˜é‡ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">FORCE_COLOR</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä»¥ä¸Šå‘½ä»¤å°†ä»¥ 256 è‰²æ¨¡å¼å¼ºåˆ¶è¾“å‡ºé¢œè‰²ã€‚</p><h4 id="ç¤ºä¾‹-3-é…ç½®-npm-è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-3-é…ç½®-npm-è„šæœ¬"><span>ç¤ºä¾‹ 3ï¼šé…ç½® npm è„šæœ¬</span></a></h4><p>å¦‚æœä½ åœ¨ <code>package.json</code> ä¸­æœ‰ä¸€ä¸ª npm è„šæœ¬å¹¶ä¸”æƒ³è¦ç¡®ä¿å®ƒæ€»æ˜¯å¸¦é¢œè‰²è¾“å‡ºï¼Œä½ å¯ä»¥åƒè¿™æ ·é…ç½®ï¼š</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;scripts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;start&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;FORCE_COLOR=3 node app.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä½ è¿è¡Œ <code>npm start</code> æ—¶ï¼Œ<code>app.js</code> å°†ä¼šä»¥ TrueColor æ¨¡å¼è¾“å‡ºæ‰€æœ‰é¢œè‰²ï¼Œæ”¯æŒå¤§çº¦ 1600 ä¸‡ç§é¢œè‰²ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯ <code>FORCE_COLOR</code> ç¯å¢ƒå˜é‡çš„ä½œç”¨å’Œå®é™…åº”ç”¨åœºæ™¯ã€‚é€šè¿‡è®¾ç½®å®ƒï¼Œä½ å¯ä»¥æ§åˆ¶ä½ çš„ Node.js ç¨‹åºçš„é¢œè‰²è¾“å‡ºï¼Œå¢å¼ºæ—¥å¿—ä¿¡æ¯çš„å¯è¯»æ€§å’Œç¾è§‚æ€§ã€‚</p><h3 id="no-color-any" tabindex="-1"><a class="header-anchor" href="#no-color-any"><span><a href="https://nodejs.org/docs/latest/api/cli.html#no_colorany" target="_blank" rel="noopener noreferrer">NO_COLOR=<code>&lt;`any`&gt;</code></a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬èŠä¸€èŠ Node.js ä¸­çš„ <code>NO_COLOR</code> ç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸”äº†è§£å®ƒæ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚</p><p>é¦–å…ˆï¼Œä½ éœ€è¦äº†è§£ Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒã€‚å®ƒä½¿å¾—å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨æµè§ˆå™¨ä¸­ã€‚</p><p>åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬è¿è¡Œ Node.js åº”ç”¨ç¨‹åºæˆ–è€…ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·æ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°æœ‰å½©è‰²çš„è¾“å‡ºã€‚è¿™äº›å½©è‰²è¾“å‡ºå¸®åŠ©æˆ‘ä»¬åŒºåˆ†ä¸åŒç±»å‹çš„ä¿¡æ¯ï¼Œæ¯”å¦‚é”™è¯¯é€šå¸¸æ˜¯çº¢è‰²çš„ï¼Œè­¦å‘Šå¯èƒ½æ˜¯é»„è‰²çš„ï¼Œç­‰ç­‰ã€‚ç„¶è€Œï¼Œæœ‰äº›åœºåˆæˆ‘ä»¬å¯èƒ½ä¸å¸Œæœ›çœ‹åˆ°è¿™äº›é¢œè‰²ï¼Œæ¯”å¦‚å½“æˆ‘ä»¬è¦å°†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ä¸­æˆ–è€…åœ¨åªæ”¯æŒæ–‡æœ¬çš„ç¯å¢ƒä¸­æŸ¥çœ‹è¾“å‡ºæ—¶ï¼ˆä¾‹å¦‚æŸäº›æ—¥å¿—ç³»ç»Ÿï¼‰ï¼Œæ­¤æ—¶é¢œè‰²ç¼–ç å¯èƒ½ä¼šå¯¼è‡´é˜…è¯»å›°éš¾ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒNode.js å®ç°äº†å¯¹ <code>NO_COLOR</code> ç¯å¢ƒå˜é‡çš„æ”¯æŒã€‚è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„çº¦å®šï¼Œè¢«å¾ˆå¤šåº”ç”¨ç¨‹åºå’Œå·¥å…·éµå¾ªï¼Œæ„åœ¨æä¾›ä¸€ä¸ªç®€å•çš„æ–¹å¼æ¥ç¦æ­¢å½©è‰²è¾“å‡ºã€‚</p><p>å½“ä½ åœ¨ç³»ç»Ÿä¸­è®¾ç½®äº† <code>NO_COLOR</code> ç¯å¢ƒå˜é‡ï¼ˆå…¶å€¼å¯ä»¥æ˜¯ä»»ä½•å†…å®¹ï¼ŒåŒ…æ‹¬ç©ºå­—ç¬¦ä¸²ï¼‰ï¼Œå¹¶è¿è¡Œ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼ŒNode.js ä¼šæ£€æµ‹åˆ°è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œå¹¶è‡ªåŠ¨å…³é—­æ‰€æœ‰å½©è‰²è¾“å‡ºã€‚è¿™æ„å‘³ç€æ‰€æœ‰æœ¬æ¥ä¼šä»¥å½©è‰²æ˜¾ç¤ºçš„æ–‡æœ¬éƒ½ä¼šä»¥æ™®é€šæ–‡æœ¬å½¢å¼å±•ç¤ºã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªå…·ä½“çš„ä¾‹å­ï¼š</p><ol><li>å‡è®¾ä½ åœ¨ç»ˆç«¯ï¼ˆå‘½ä»¤è¡Œç•Œé¢ï¼‰ä¸­è¿è¡Œä¸€ä¸ª Node.js è„šæœ¬ï¼Œè¯¥è„šæœ¬é€šå¸¸ä¼šæ‰“å°å‡ºå½©è‰²æ—¥å¿—ä¿¡æ¯ã€‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æ‰§è¡Œè¿™ä¸ªè„šæœ¬ï¼Œå¹¶ä¸”ç¦ç”¨å½©è‰²è¾“å‡ºï¼š</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">NO_COLOR</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">1</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œï¼Œ<code>NO_COLOR=1</code> è®¾ç½®äº†ç¯å¢ƒå˜é‡ <code>NO_COLOR</code>ï¼Œå¹¶ç»™å®ƒèµ‹äº†å€¼ <code>1</code>ã€‚å®é™…ä¸Šï¼Œèµ‹ç»™ <code>NO_COLOR</code> çš„å€¼å¹¶ä¸é‡è¦ï¼Œåªè¦è¿™ä¸ªå˜é‡è¢«è®¾ç½®äº†ï¼Œå½©è‰²è¾“å‡ºå°±ä¼šè¢«ç¦ç”¨ã€‚</p><ol start="2"><li>å¦‚æœä½ æƒ³åœ¨å…¨å±€èŒƒå›´å†…ç¦ç”¨æ‰€æœ‰ Node.js åº”ç”¨ç¨‹åºçš„å½©è‰²è¾“å‡ºï¼Œä½ å¯ä»¥åœ¨ä½ çš„ shell é…ç½®æ–‡ä»¶ï¼ˆä¾‹å¦‚ <code>.bashrc</code> æˆ– <code>.zshrc</code>ï¼‰ä¸­æ·»åŠ ä»¥ä¸‹è¡Œï¼š</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NO_COLOR</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·æ— è®ºä½•æ—¶å½“ä½ å¯åŠ¨ä¸€ä¸ªæ–°çš„ç»ˆç«¯ä¼šè¯å¹¶è¿è¡Œä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºæ—¶ï¼Œå½©è‰²è¾“å‡ºéƒ½ä¼šè¢«è‡ªåŠ¨ç¦ç”¨ã€‚</p><ol start="3"><li>åœ¨ä¸€äº›å¤æ‚çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¦‚æœå¼€å‘è€…æ­£ç¡®å¤„ç†äº† <code>NO_COLOR</code>ï¼Œé‚£ä¹ˆå³ä½¿å½©è‰²è¾“å‡ºè¢«ç¦ç”¨ï¼Œè¿˜æ˜¯å¯ä»¥ä¿ç•™ä¸€äº›æ ¼å¼åŒ–æ•ˆæœï¼Œåªæ˜¯é¢œè‰²è¢«ç§»é™¤ã€‚ä¾‹å¦‚ï¼Œç²—ä½“æˆ–æ–œä½“æ–‡æœ¬å¯èƒ½ä»ç„¶å­˜åœ¨ï¼Œä½†æ˜¯æ²¡æœ‰çº¢è‰²ã€ç»¿è‰²æˆ–è“è‰²ç­‰é¢œè‰²ã€‚</li></ol><p>é€šè¿‡ä½¿ç”¨ <code>NO_COLOR</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å®¹æ˜“åœ°å°†å‘½ä»¤è¡Œè¾“å‡ºçš„æ–‡æœ¬æ•´ç†åˆ°å…¶ä»–ç³»ç»Ÿä¸­ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä¸ºé‚£äº›éœ€è¦æ— é¢œè‰²è¾“å‡ºçš„ç”¨æˆ·æä¾›ä¸€ä¸ªæ›´ç®€æ´çš„è§†å›¾ã€‚</p><h3 id="node-debug-module" tabindex="-1"><a class="header-anchor" href="#node-debug-module"><span><a href="https://nodejs.org/docs/latest/api/cli.html#node_debugmodule" target="_blank" rel="noopener noreferrer">NODE_DEBUG=module[,â€¦]</a></span></a></h3><p><code>NODE_DEBUG=module[,â€¦]</code> æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨äºåœ¨ Node.js è¿è¡Œæ—¶å¯åŠ¨è°ƒè¯•åŠŸèƒ½ã€‚å½“ä½ è®¾ç½®è¿™ä¸ªå˜é‡æ—¶ï¼ŒNode.js ä¼šè¾“å‡ºæ›´å¤šçš„è°ƒè¯•ä¿¡æ¯ï¼Œå¸®åŠ©ä½ äº†è§£ç‰¹å®šæ¨¡å—çš„å†…éƒ¨å·¥ä½œæƒ…å†µã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæ¨¡å—æŒ‡çš„æ˜¯å¯é‡ç”¨ä»£ç çš„å•å…ƒï¼Œä¾‹å¦‚æ–‡ä»¶ç³»ç»Ÿæ¨¡å— (<code>fs</code>)ã€HTTP æ¨¡å— (<code>http</code>) ç­‰ã€‚æ¯ä¸ªæ¨¡å—éƒ½æœ‰ç‰¹å®šçš„åŠŸèƒ½ï¼Œå¹¶ä¸”å¯ä»¥è¢«å…¶ä»– JavaScript æ–‡ä»¶é€šè¿‡ <code>require</code> å‡½æ•°å¼•å…¥ä½¿ç”¨ã€‚</p><p>å¦‚æœä½ åœ¨å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°äº†é—®é¢˜ï¼Œæ¯”å¦‚ä¸æ¸…æ¥šæŸä¸ªæ¨¡å—æ˜¯å¦‚ä½•è¿ä½œçš„ï¼Œæˆ–è€…ä¸ºä»€ä¹ˆå¾—åˆ°äº†éé¢„æœŸçš„è¾“å‡ºç»“æœï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>NODE_DEBUG</code> ç¯å¢ƒå˜é‡æ¥è·å–æ¨¡å—çš„å†…éƒ¨è°ƒè¯•ä¿¡æ¯ã€‚</p><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><p>ä½ éœ€è¦åœ¨å‘½ä»¤è¡Œä¸­è®¾ç½® <code>NODE_DEBUG</code> ç¯å¢ƒå˜é‡ï¼Œå¹¶æŒ‡å®šä½ æƒ³è¦è°ƒè¯•çš„æ¨¡å—åç§°ã€‚è¿™é‡Œçš„ <code>module</code> å ä½ç¬¦è¡¨ç¤ºå®é™…çš„æ¨¡å—åç§°ã€‚å¦‚æœä½ æƒ³åŒæ—¶è°ƒè¯•å¤šä¸ªæ¨¡å—ï¼Œå¯ä»¥ç”¨é€—å·åˆ†éš”å®ƒä»¬çš„åç§°ã€‚</p><p>å®ä¾‹ï¼š</p><ol><li><p><strong>è°ƒè¯• HTTP æ¨¡å—</strong>ï¼šå‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªä½¿ç”¨ Node.js çš„ HTTP æœåŠ¡å™¨ï¼Œä½†æ˜¯æœåŠ¡å™¨æ²¡æœ‰æŒ‰ç…§é¢„æœŸå·¥ä½œã€‚ä¸ºäº†çœ‹åˆ° HTTP æ¨¡å—å†…éƒ¨çš„è°ƒè¯•ä¿¡æ¯ï¼Œä½ å¯ä»¥åœ¨è¿è¡Œä½ çš„æœåŠ¡å™¨è„šæœ¬ä¹‹å‰è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>NODE_DEBUG=http node your_server_script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œå½“ä½ çš„æœåŠ¡å™¨è¿è¡Œæ—¶ï¼Œä½ å°†çœ‹åˆ°å…³äº HTTP è¯·æ±‚å’Œå“åº”å¤„ç†çš„è¯¦å°½ä¿¡æ¯ã€‚</p></li><li><p><strong>è°ƒè¯•å¤šä¸ªæ¨¡å—</strong>ï¼šå¦‚æœä½ æƒ³åŒæ—¶è°ƒè¯• HTTP å’Œ netï¼ˆä¸€ä¸ªæä¾›äº†å¼‚æ­¥ç½‘ç»œåŒ…è£…çš„æ¨¡å—ï¼‰æ¨¡å—ï¼Œä½ å¯ä»¥è¿™æ ·è®¾ç½®ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>NODE_DEBUG=http,net node your_server_script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¼šæ‰“å°å‡ºè¿™ä¸¤ä¸ªæ¨¡å—ç›¸å…³çš„è°ƒè¯•ä¿¡æ¯ã€‚</p></li></ol><p>è¯·æ³¨æ„ï¼Œè°ƒè¯•è¾“å‡ºå¯èƒ½ä¼šéå¸¸è¯¦ç»†ï¼Œå› æ­¤å»ºè®®åªåœ¨å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”ä»…åœ¨éœ€è¦è§£å†³ç‰¹å®šé—®é¢˜æ—¶å¯ç”¨ã€‚å¤§é‡çš„è°ƒè¯•è¾“å‡ºå¯èƒ½ä¼šè®©æ‰¾å‡ºé—®é¢˜å˜å¾—æ›´åŠ å›°éš¾ï¼Œä¹Ÿå¯èƒ½å½±å“åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>NODE_DEBUG</code> ç¯å¢ƒå˜é‡æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ä½ åœ¨å¼€å‘ Node.js åº”ç”¨æ—¶æ·±å…¥ç†è§£æ¨¡å—çš„è¡Œä¸ºå’Œæ½œåœ¨çš„é—®é¢˜æ‰€åœ¨ã€‚é€šè¿‡åˆç†ä½¿ç”¨å®ƒï¼Œä½ å¯ä»¥åŠ é€Ÿå¼€å‘å¹¶æ”¹å–„ä»£ç è´¨é‡ã€‚</p><h3 id="node-debug-native-module" tabindex="-1"><a class="header-anchor" href="#node-debug-native-module"><span><a href="https://nodejs.org/docs/latest/api/cli.html#node_debug_nativemodule" target="_blank" rel="noopener noreferrer">NODE_DEBUG_NATIVE=module[,â€¦]</a></span></a></h3><p><code>NODE_DEBUG_NATIVE</code> æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå®ƒç”¨äºåœ¨ Node.js è¿è¡Œæ—¶å¼€å¯å¯¹ç‰¹å®šåŸç”Ÿæ¨¡å—ï¼ˆå¦‚ HTTPã€NET ç­‰ï¼‰çš„è°ƒè¯•è¾“å‡ºã€‚é€šå¸¸æ¥è¯´ï¼ŒNode.js çš„å¾ˆå¤šæ ¸å¿ƒåŠŸèƒ½æ˜¯é€šè¿‡ C++ ç¼–å†™çš„åŸç”Ÿæ¨¡å—å®ç°çš„ï¼Œè€Œ <code>NODE_DEBUG_NATIVE</code> ç¯å¢ƒå˜é‡å°±æ˜¯ç”¨æ¥å¸®åŠ©å¼€å‘è€…è·å–è¿™äº›åŸç”Ÿæ¨¡å—å†…éƒ¨è¿ä½œçš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p>å½“ä½ è®¾ç½®äº† <code>NODE_DEBUG_NATIVE</code> ç¯å¢ƒå˜é‡åï¼ŒNode.js å°±ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºç›¸å…³æ¨¡å—çš„è°ƒè¯•ä¿¡æ¯ï¼Œè¿™æœ‰åŠ©äºç†è§£æ¨¡å—çš„å†…éƒ¨è¡Œä¸ºæˆ–è€…è°ƒè¯•å¯èƒ½å­˜åœ¨çš„é—®é¢˜ã€‚</p><p>ä½¿ç”¨ <code>NODE_DEBUG_NATIVE</code> çš„æ ¼å¼å¦‚ä¸‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>NODE_DEBUG_NATIVE=module1[,module2[,...]]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä½ å¯ä»¥å°† <code>module1</code>, <code>module2</code> æ›¿æ¢ä¸ºä½ æƒ³è°ƒè¯•çš„å…·ä½“æ¨¡å—åç§°ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>å‡è®¾ä½ åœ¨å¼€å‘ä¸€ä¸ªä½¿ç”¨äº† Node.js å†…ç½® <code>http</code> æ¨¡å—çš„ Web æœåŠ¡å™¨ï¼Œä½†æ˜¯ä½ å‘ç°æœåŠ¡å™¨åœ¨æŸäº›æƒ…å†µä¸‹æ²¡æœ‰æ­£ç¡®å¤„ç†è¯·æ±‚ã€‚ä½ æ€€ç–‘é—®é¢˜å‡ºåœ¨ Node.js çš„åº•å±‚ HTTP å¤„ç†ä¸Šï¼Œæ‰€ä»¥æƒ³è¦çœ‹åˆ°æ›´å¤šå…³äº <code>http</code> æ¨¡å—å†…éƒ¨è¡Œä¸ºçš„ä¿¡æ¯ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºä¹‹å‰è®¾ç½®ç¯å¢ƒå˜é‡ <code>NODE_DEBUG_NATIVE=http</code>ã€‚å¦‚æœä½ æ˜¯åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œç¨‹åºï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¾ç½®è¯¥ç¯å¢ƒå˜é‡ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## Linux æˆ– macOS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NODE_DEBUG_NATIVE</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">http</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## Windows</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> NODE_DEBUG_NATIVE=http</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## ç„¶åè¿è¡Œä½ çš„ Node.js åº”ç”¨ç¨‹åº</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸€æ—¦ä½ è®¾ç½®äº†è¿™ä¸ªç¯å¢ƒå˜é‡å¹¶è¿è¡Œåº”ç”¨ç¨‹åºï¼Œä½ çš„æ§åˆ¶å°ä¼šå¼€å§‹æ˜¾ç¤º <code>http</code> æ¨¡å—çš„è°ƒè¯•ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å¯èƒ½åŒ…æ‹¬è¯·æ±‚å’Œå“åº”çš„è¯¦ç»†è¿‡ç¨‹ï¼Œé”™è¯¯æ—¥å¿—ç­‰ï¼Œè¿™å°†å¸®åŠ©ä½ è¯Šæ–­é—®é¢˜ã€‚</p><p>è¦æ³¨æ„çš„æ˜¯ï¼Œäº§ç”Ÿçš„è°ƒè¯•ä¿¡æ¯å¯èƒ½éå¸¸è¯¦ç»†ä¸”éš¾ä»¥ç†è§£ï¼Œä¸»è¦é¢å‘æœ‰ç»éªŒçš„å¼€å‘è€…æˆ–è€… Node.js çš„è´¡çŒ®è€…ã€‚å¯¹äºç¼–ç¨‹æ–°æ‰‹æ¥è¯´ï¼Œè¿™äº›ä¿¡æ¯å¯èƒ½ä¸æ˜¯é‚£ä¹ˆç›´æ¥æœ‰ç”¨ï¼Œå› ä¸ºå®ƒéœ€è¦æ·±å…¥ç†è§£ Node.js çš„å†…éƒ¨åŸç†ã€‚</p><p>æ­¤å¤–ï¼Œé¢‘ç¹åœ°è¾“å‡ºè°ƒè¯•ä¿¡æ¯å¯èƒ½ä¼šå½±å“åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œå› æ­¤ä»…å»ºè®®åœ¨å¼€å‘é˜¶æ®µæˆ–è€…è¯Šæ–­ç‰¹å®šé—®é¢˜æ—¶ä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨é—®é¢˜è§£å†³åå…³é—­ç›¸åº”çš„è°ƒè¯•è¾“å‡ºã€‚</p><h3 id="node-disable-colors-1" tabindex="-1"><a class="header-anchor" href="#node-disable-colors-1"><span><a href="https://nodejs.org/docs/latest/api/cli.html#node_disable_colors1" target="_blank" rel="noopener noreferrer">NODE_DISABLE_COLORS=1</a></span></a></h3><p><code>NODE_DISABLE_COLORS=1</code> è¿™ä¸ªè®¾ç½®æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨äºæ§åˆ¶ Node.js åœ¨å…¶è¾“å‡ºä¸­æ˜¯å¦ä½¿ç”¨é¢œè‰²ã€‚å½“ä½ åœ¨å‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰è¿è¡Œ Node.js ç¨‹åºæ—¶ï¼Œæœ‰æ—¶å€™ç¨‹åºçš„è¾“å‡ºä¼šåŒ…å«é¢œè‰²ï¼Œè¿™å¯ä»¥å¸®åŠ©åŒºåˆ†ä¸åŒç§ç±»çš„ä¿¡æ¯ï¼Œä¾‹å¦‚é”™è¯¯ã€è­¦å‘Šå’Œæ—¥å¿—ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js ä¼šæ£€æµ‹å®ƒçš„è¾“å‡ºæ˜¯å¦ç›´æ¥æ˜¾ç¤ºåœ¨ä¸€ä¸ªæ”¯æŒé¢œè‰²çš„ç»ˆç«¯ä¸Šï¼Œå¹¶ä¸”å¦‚æœæ˜¯çš„è¯ï¼Œå®ƒå¯èƒ½ä¼šè¾“å‡ºå¸¦é¢œè‰²çš„æ–‡æœ¬ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¸å¸Œæœ›çœ‹åˆ°è¿™äº›é¢œè‰²ï¼Œæ¯”å¦‚ï¼š</p><ol><li>å½“ä½ å°†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶æ—¶ï¼Œé¢œè‰²ç¼–ç å¯èƒ½ä¼šä½¿å¾—æ–‡ä»¶å†…å®¹éš¾ä»¥è¯»æ‡‚ã€‚</li><li>å¦‚æœä½ åœ¨ä¸€ä¸ªä¸æ”¯æŒé¢œè‰²çš„ç»ˆç«¯ç¯å¢ƒä¸­è¿è¡Œ Node.jsã€‚</li><li>å¯¹äºè§†è§‰éšœç¢äººå£«ä½¿ç”¨å±å¹•é˜…è¯»å™¨æ—¶ï¼Œé¢œè‰²ç¼–ç å¯èƒ½æ˜¯å¤šä½™çš„ã€‚</li></ol><p>å¦‚æœä½ æƒ³ç¦ç”¨é¢œè‰²è¾“å‡ºï¼Œå¯ä»¥åœ¨è¿è¡Œ Node.js ç¨‹åºä¹‹å‰è®¾ç½® <code>NODE_DISABLE_COLORS=1</code> ç¯å¢ƒå˜é‡ã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›å®é™…çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨è¿™ä¸ªç¯å¢ƒå˜é‡ï¼š</p><h3 id="ç¤ºä¾‹-1-åœ¨å‘½ä»¤è¡Œä¸­ä¸´æ—¶ç¦ç”¨é¢œè‰²" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-åœ¨å‘½ä»¤è¡Œä¸­ä¸´æ—¶ç¦ç”¨é¢œè‰²"><span>ç¤ºä¾‹ 1ï¼šåœ¨å‘½ä»¤è¡Œä¸­ä¸´æ—¶ç¦ç”¨é¢œè‰²</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªåä¸º <code>script.js</code> çš„ Node.js è„šæœ¬ï¼Œå®ƒåœ¨æ§åˆ¶å°ä¸­æ‰“å°å¸¦é¢œè‰²çš„æ–‡å­—ã€‚ä½ å¯ä»¥è¿™æ ·è¿è¡Œå®ƒè€Œä¸å¸¦é¢œè‰²ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">NODE_DISABLE_COLORS</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">1</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªå‘½ä»¤ä¸­ï¼Œæˆ‘ä»¬åœ¨è¿è¡Œ <code>node script.js</code> å‘½ä»¤ä¹‹å‰è®¾ç½®äº† <code>NODE_DISABLE_COLORS=1</code>ã€‚è¿™å°†ä»…å¯¹å½“å‰çš„å‘½ä»¤ç”Ÿæ•ˆã€‚</p><h3 id="ç¤ºä¾‹-2-åœ¨-windows-ç³»ç»Ÿä¸­æ°¸ä¹…ç¦ç”¨é¢œè‰²" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-åœ¨-windows-ç³»ç»Ÿä¸­æ°¸ä¹…ç¦ç”¨é¢œè‰²"><span>ç¤ºä¾‹ 2ï¼šåœ¨ Windows ç³»ç»Ÿä¸­æ°¸ä¹…ç¦ç”¨é¢œè‰²</span></a></h3><p>å¦‚æœä½ æ˜¯ Windows ç”¨æˆ·å¹¶ä¸”æƒ³è¦æ°¸ä¹…ç¦ç”¨é¢œè‰²ï¼Œä½ å¯ä»¥è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼š</p><ol><li>æ‰“å¼€â€œæ§åˆ¶é¢æ¿â€ã€‚</li><li>ç‚¹å‡»â€œç³»ç»Ÿå’Œå®‰å…¨â€ï¼Œç„¶åç‚¹å‡»â€œç³»ç»Ÿâ€ã€‚</li><li>ç‚¹å‡»â€œé«˜çº§ç³»ç»Ÿè®¾ç½®â€é“¾æ¥ã€‚</li><li>åœ¨â€œç³»ç»Ÿå±æ€§â€çª—å£ä¸­åˆ‡æ¢åˆ°â€œé«˜çº§â€é€‰é¡¹å¡ã€‚</li><li>ç‚¹å‡»â€œç¯å¢ƒå˜é‡â€æŒ‰é’®ã€‚</li><li>åœ¨â€œç³»ç»Ÿå˜é‡â€åŒºåŸŸï¼Œç‚¹å‡»â€œæ–°å»ºâ€ã€‚</li><li>è¾“å…¥å˜é‡å <code>NODE_DISABLE_COLORS</code> å’Œå˜é‡å€¼ <code>1</code>ã€‚</li><li>ç‚¹å‡»ç¡®å®šæ¥ä¿å­˜æ›´æ”¹ã€‚</li></ol><p>ä¹‹åï¼Œæ— è®ºä½•æ—¶ä½ åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä»»ä½• Node.js ç¨‹åºï¼Œé¢œè‰²éƒ½å°†è¢«ç¦ç”¨ã€‚</p><h3 id="ç¤ºä¾‹-3-åœ¨-unix-like-ç³»ç»Ÿä¸­æ°¸ä¹…ç¦ç”¨é¢œè‰²" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-3-åœ¨-unix-like-ç³»ç»Ÿä¸­æ°¸ä¹…ç¦ç”¨é¢œè‰²"><span>ç¤ºä¾‹ 3ï¼šåœ¨ Unix-like ç³»ç»Ÿä¸­æ°¸ä¹…ç¦ç”¨é¢œè‰²</span></a></h3><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ macOS æˆ– Linuxï¼Œå¯ä»¥é€šè¿‡ç¼–è¾‘ <code>~/.bashrc</code> æˆ– <code>~/.bash_profile</code> æ–‡ä»¶ï¼ˆå–å†³äºä½ çš„æ“ä½œç³»ç»Ÿå’Œé…ç½®ï¼‰æ¥æ°¸ä¹…è®¾ç½®è¿™ä¸ªç¯å¢ƒå˜é‡ã€‚</p><p>æ‰“å¼€ä½ çš„ç»ˆç«¯ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nano</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~/.bashrc</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">   # æˆ–è€… ~/.bash_profile</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç„¶åæ·»åŠ ä¸‹é¢çš„è¡Œï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NODE_DISABLE_COLORS</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¿å­˜å¹¶å…³é—­æ–‡ä»¶ã€‚æœ€åï¼Œä½¿æ›´æ”¹ç”Ÿæ•ˆï¼Œé€šè¿‡è¿è¡Œï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ~/.bashrc</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">   # æˆ–è€… source ~/.bash_profile</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç°åœ¨æ¯å½“ä½ åœ¨è¿™ä¸ªç»ˆç«¯é‡Œè¿è¡Œ Node.js ç¨‹åºæ—¶ï¼Œæ‰€æœ‰è¾“å‡ºéƒ½ä¸ä¼šåŒ…å«é¢œè‰²ã€‚</p><h3 id="node-extra-ca-certs-file" tabindex="-1"><a class="header-anchor" href="#node-extra-ca-certs-file"><span><a href="https://nodejs.org/docs/latest/api/cli.html#node_extra_ca_certsfile" target="_blank" rel="noopener noreferrer">NODE_EXTRA_CA_CERTS=file</a></span></a></h3><p>Node.js v21.7.1 ä¸­çš„ <code>NODE_EXTRA_CA_CERTS</code> æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨äºæŒ‡å®šä¸€ä¸ªé¢å¤–çš„è¯ä¹¦æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«äº†ä½ æƒ³è¦ Node.js åœ¨å»ºç«‹å®‰å…¨è¿æ¥æ—¶ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCertificate Authorities, CAsï¼‰çš„è¯ä¹¦ã€‚å½“ä½ ä½¿ç”¨ HTTPS æˆ–å…¶ä»–éœ€è¦åŠ å¯†å’ŒéªŒè¯è¯ä¹¦çš„é€šä¿¡åè®®æ—¶ï¼Œå°±ä¼šæ¶‰åŠåˆ°è¿™äº› CA è¯ä¹¦ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js å†…ç½®äº†ä¸€ä»½å—ä¿¡ä»»çš„ CA è¯ä¹¦åˆ—è¡¨ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦ç”¨è‡ªå·±çš„è¯ä¹¦æ¥è¦†ç›–æˆ–æ‰©å±•è¿™ä¸ªåˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œå½“ä½ åœ¨ä¼ä¸šç¯å¢ƒä¸­å·¥ä½œï¼Œå¹¶ä¸”å…¬å¸ä½¿ç”¨äº†è‡ªç­¾åçš„è¯ä¹¦æˆ–è€…ç§æœ‰çš„ CA ç­¾å‘çš„è¯ä¹¦ï¼Œè¿™äº›è¯ä¹¦ä¸ä¼šè¢«å¹¿æ³›ä¿¡ä»»ï¼Œæ‰€ä»¥ä½ éœ€è¦è®©ä½ çš„ Node.js åº”ç”¨ç¨‹åºä¹Ÿä¿¡ä»»å®ƒä»¬ã€‚</p><p>è¦ä½¿ç”¨ <code>NODE_EXTRA_CA_CERTS</code> ç¯å¢ƒå˜é‡ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ª.pem æ ¼å¼çš„æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«äº†æ‰€æœ‰é™„åŠ çš„ CA è¯ä¹¦ã€‚ç„¶åï¼Œåœ¨å¯åŠ¨ Node.js ç¨‹åºä¹‹å‰è®¾ç½®è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œä½¿å¾—å…¶æŒ‡å‘è¯¥æ–‡ä»¶çš„è·¯å¾„ã€‚</p><p>ä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨ <code>NODE_EXTRA_CA_CERTS</code> çš„å…·ä½“æ­¥éª¤ï¼š</p><ol><li><p>å‡†å¤‡è¯ä¹¦æ–‡ä»¶ï¼šä½ éœ€è¦ä¸€ä¸ª.pem æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†æ‰€æœ‰é™„åŠ çš„ CA è¯ä¹¦ã€‚å‡è®¾æ–‡ä»¶åä¸º <code>extra-cas.pem</code>ã€‚</p></li><li><p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼šä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¾ç½®è¿™ä¸ªç¯å¢ƒå˜é‡ï¼ˆä»¥ Unix ç³»ç»Ÿä¸ºä¾‹ï¼‰ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NODE_EXTRA_CA_CERTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">to</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">extra-cas</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">pem</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœæ˜¯ Windows ç³»ç»Ÿï¼Œå¯ä»¥è¿™æ ·è®¾ç½®ï¼š</p><div class="language-cmd line-numbers-mode" data-highlighter="shiki" data-ext="cmd" data-title="cmd" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>set NODE_EXTRA_CA_CERTS=C:\path\to\extra-cas.pem</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>è¿è¡Œ Node.js ç¨‹åºï¼šä¸€æ—¦è®¾ç½®äº†ç¯å¢ƒå˜é‡ï¼Œä½ å°±å¯ä»¥æ­£å¸¸è¿è¡Œä½ çš„ Node.js åº”ç”¨ç¨‹åºäº†ã€‚å½“åº”ç”¨ç¨‹åºå°è¯•å»ºç«‹å®‰å…¨è¿æ¥æ—¶ï¼ŒNode.js ä¼šè€ƒè™‘åˆ° <code>extra-cas.pem</code> æ–‡ä»¶ä¸­çš„è¯ä¹¦ã€‚</p></li></ol><p>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><ul><li><p>ä¾‹ 1ï¼šå‡è®¾ä½ åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œéœ€è¦è¿æ¥åˆ°ä½ å…¬å¸å†…éƒ¨çš„ APIï¼Œè¯¥ API ä½¿ç”¨äº†å…¬å¸è‡ªå·±çš„ CA ç­¾å‘çš„è¯ä¹¦ã€‚ä½ å¯ä»¥å°†å…¬å¸ CA çš„è¯ä¹¦æ·»åŠ åˆ° <code>extra-cas.pem</code> æ–‡ä»¶ä¸­ï¼Œå¹¶è®¾ç½® <code>NODE_EXTRA_CA_CERTS</code> ç¯å¢ƒå˜é‡ï¼Œç„¶åä½ çš„ Node.js åº”ç”¨å°±å¯ä»¥æˆåŠŸåœ°ä¸ API å»ºç«‹å®‰å…¨è¿æ¥äº†ã€‚</p></li><li><p>ä¾‹ 2ï¼šå¦‚æœä½ æ˜¯ä¸€ä¸ªè½¯ä»¶å¼€å‘å•†ï¼Œä½ çš„äº§å“éœ€è¦åœ¨å®¢æˆ·çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œè€Œæ¯ä¸ªå®¢æˆ·å¯èƒ½éƒ½æœ‰è‡ªå·±çš„ CA è¯ä¹¦ã€‚ä½ å¯ä»¥æä¾›ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œå…è®¸å®¢æˆ·æŒ‡å®šä»–ä»¬è‡ªå·±çš„è¯ä¹¦æ–‡ä»¶è·¯å¾„ï¼Œå¹¶åœ¨å¯åŠ¨ç¨‹åºæ—¶ï¼Œå°†å…¶è®¾ç½®ä¸º <code>NODE_EXTRA_CA_CERTS</code> çš„å€¼ã€‚</p></li></ul><p>è¯·è®°ä½ï¼Œåªæœ‰åœ¨ä½ å®Œå…¨ä¿¡ä»»è¿™äº›é¢å¤–çš„ CA è¯ä¹¦æ—¶ï¼Œæ‰åº”è¯¥ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå› ä¸ºå®ƒä¼šå½±å“ SSL/TLS çš„å®‰å…¨æ€§ã€‚</p><h3 id="node-icu-data-file" tabindex="-1"><a class="header-anchor" href="#node-icu-data-file"><span><a href="https://nodejs.org/docs/latest/api/cli.html#node_icu_datafile" target="_blank" rel="noopener noreferrer">NODE_ICU_DATA=file</a></span></a></h3><p>å¥½çš„ã€‚Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ JavaScript ç¯å¢ƒï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨ JavaScript æ¥ç¼–å†™èƒ½å¤Ÿè¿›è¡Œæ–‡ä»¶æ“ä½œã€ç½‘ç»œé€šä¿¡ç­‰æœåŠ¡å™¨çº§åˆ«åŠŸèƒ½çš„ä»£ç ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªåä¸º International Components for Unicode (ICU) çš„åº“ï¼Œå®ƒç”¨äºæä¾› Unicode å’Œå›½é™…åŒ–æ”¯æŒï¼Œæ¯”å¦‚æ—¥æœŸã€æ—¶é—´ã€æ•°å­—æ ¼å¼åŒ–å’Œå­—ç¬¦é›†è½¬æ¢ã€‚è¿™ä¸ªåº“å¯ä»¥å¸®åŠ©ä½ çš„åº”ç”¨ç¨‹åºæ›´å¥½åœ°æ”¯æŒå¤šè¯­è¨€ç¯å¢ƒã€‚</p><p><code>NODE_ICU_DATA</code> æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå®ƒç”¨æ¥æŒ‡å®šå­˜å‚¨ ICU æ•°æ®çš„æ–‡ä»¶è·¯å¾„ã€‚ICU æ•°æ®é€šå¸¸åŒ…æ‹¬äº†ç”¨äºå­—ç¬¦ç¼–ç ã€æ’åºè§„åˆ™ã€æ—¥æœŸã€æ—¶é—´å’Œæ•°å­—æ ¼å¼åŒ–çš„æ•°æ®ã€‚å½“ Node.js è¿›ç¨‹å¯åŠ¨æ—¶ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ ICU åŠŸèƒ½ï¼ˆæ¯”å¦‚å¤„ç†ä¸åŒçš„è¯­è¨€ï¼‰ï¼Œå®ƒä¼šæŸ¥æ‰¾è¿™ä¸ªç¯å¢ƒå˜é‡æŒ‡å‘çš„æ–‡ä»¶æ¥è·å–å¿…è¦çš„æ•°æ®ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå¤šè¯­è¨€ç½‘ç«™ï¼Œå¯èƒ½éœ€è¦æ ¹æ®ç”¨æˆ·çš„åå¥½æ˜¾ç¤ºä¸åŒçš„æ—¥æœŸæ ¼å¼ã€‚è‹±è¯­ç”¨æˆ·å¯èƒ½ä¹ æƒ¯ MM/DD/YYYY çš„æ ¼å¼ï¼Œè€Œå¾·è¯­ç”¨æˆ·å¯èƒ½ä¹ æƒ¯ DD.MM.YYYYã€‚ä½¿ç”¨ ICUï¼Œä½ å¯ä»¥è½»æ¾åœ°æ ¹æ®ç”¨æˆ·çš„è¯­è¨€åå¥½æ¥æ ¼å¼åŒ–æ—¥æœŸã€‚</p><p>ä¸‹é¢æ˜¯å‡ ä¸ªå®é™…çš„ä¾‹å­ï¼š</p><ol><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js åŒ…å«äº†ä¸€å°éƒ¨åˆ† ICU æ•°æ®ï¼Œä»¥æ”¯æŒæœ€å¸¸è§çš„åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ éœ€è¦æ›´å®Œæ•´çš„ ICU æ”¯æŒï¼Œæ¯”å¦‚æ”¯æŒæ›´å¤šçš„è¯­è¨€å’Œåœ°åŒºï¼Œä½ å¯èƒ½éœ€è¦æŒ‡å®šä¸€ä¸ªåŒ…å«å®Œæ•´ ICU æ•°æ®é›†çš„æ–‡ä»¶ã€‚è¿™å°±æ˜¯ <code>NODE_ICU_DATA</code> å˜é‡çš„ç”¨æ­¦ä¹‹åœ°ã€‚</p></li><li><p>å‡è®¾åœ¨æœåŠ¡å™¨ä¸Šæœ‰ä¸€ä¸ª ICU æ•°æ®æ–‡ä»¶ä½äº <code>/path/to/icu/data/icudt62l.dat</code>ã€‚é‚£ä¹ˆï¼Œåœ¨å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œä½ å¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NODE_ICU_DATA</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">to</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">icu</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">icudt62l</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dat</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç„¶åå¯åŠ¨ä½ çš„ Node.js åº”ç”¨ç¨‹åºã€‚è¿™æ ·ï¼ŒICU ç›¸å…³çš„åŠŸèƒ½å°±ä¼šä½¿ç”¨è¿™ä¸ªæ–‡ä»¶ä¸­çš„æ•°æ®ã€‚</p></li><li><p>å¦‚æœä½ æŠŠåº”ç”¨ç¨‹åºæ‰“åŒ…æˆä¸€ä¸ª Docker å®¹å™¨ï¼Œå¹¶ä¸”æƒ³è¦ç¡®ä¿å®¹å™¨å†…éƒ¨ä½¿ç”¨çš„ ICU æ•°æ®æ˜¯å®Œæ•´çš„ï¼Œä½ å¯ä»¥åœ¨ Dockerfile ä¸­è®¾ç½® <code>NODE_ICU_DATA</code> ç¯å¢ƒå˜é‡ï¼Œç„¶åå°†åŒ…å« ICU æ•°æ®çš„æ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨ä¸­å¯¹åº”çš„ä½ç½®ã€‚</p></li><li><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¸å¸Œæœ› Node.js ä½¿ç”¨ä»»ä½•å¤–éƒ¨çš„ ICU æ•°æ®æ–‡ä»¶ï¼ˆå¯èƒ½å› ä¸ºå¤§å°æˆ–å…¶ä»–é™åˆ¶ï¼‰ï¼Œä½ å¯ä»¥é€šè¿‡å°† <code>NODE_ICU_DATA</code> è®¾ç½®ä¸ºç©ºæ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NODE_ICU_DATA</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¼šå‘Šè¯‰ Node.js ä¸è¦åŠ è½½ä»»ä½• ICU æ•°æ®æ–‡ä»¶ï¼Œåªä½¿ç”¨å†…å»ºçš„æœ‰é™åŠŸèƒ½ã€‚</p></li></ol><p>æ€»ä½“æ¥è¯´ï¼Œ<code>NODE_ICU_DATA</code> ç¯å¢ƒå˜é‡ç»™äº†ä½ çµæ´»æ€§ï¼Œè®©ä½ å¯ä»¥æ ¹æ®åº”ç”¨ç¨‹åºçš„éœ€æ±‚å’Œéƒ¨ç½²ç¯å¢ƒæ¥ç¡®å®š ICU æ•°æ®çš„æ¥æºã€‚è¿™å¯¹äºå¼€å‘å…·æœ‰å›½é™…åŒ–æ”¯æŒçš„åº”ç”¨ç¨‹åºéå¸¸é‡è¦ã€‚</p><h3 id="node-no-warnings-1" tabindex="-1"><a class="header-anchor" href="#node-no-warnings-1"><span><a href="https://nodejs.org/docs/latest/api/cli.html#node_no_warnings1" target="_blank" rel="noopener noreferrer">NODE_NO_WARNINGS=1</a></span></a></h3><p>å½“ä½ ä½¿ç”¨ Node.js è¿›è¡Œç¼–ç¨‹æ—¶ï¼Œæœ‰æ—¶å€™å¯èƒ½ä¼šçœ‹åˆ°æ§åˆ¶å°æ‰“å°å‡ºä¸€äº›è­¦å‘Šä¿¡æ¯ã€‚è¿™äº›è­¦å‘Šä¿¡æ¯å¯èƒ½æ˜¯å› ä¸ºä½ ä½¿ç”¨äº†æŸä¸ªä¸æ¨èä½¿ç”¨çš„åŠŸèƒ½ (deprecated feature)ï¼Œæˆ–è€…æ˜¯ä½ çš„ä»£ç åœ¨æŸä¸ªåœ°æ–¹å¯èƒ½å­˜åœ¨æ½œåœ¨é—®é¢˜ã€‚ç„¶è€Œï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶å€™ä½ å¯èƒ½æ¸…æ¥šä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„è­¦å‘Šï¼Œå¹¶ä¸”æš‚æ—¶ä¸æƒ³å®ƒä»¬å¹²æ‰°ä½ çš„æ§åˆ¶å°è¾“å‡ºã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>NODE_NO_WARNINGS=1</code> æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨æ¥é˜»æ­¢ Node.js åœ¨è¿è¡Œæ—¶æ‰“å°è¿™äº›è­¦å‘Šä¿¡æ¯ã€‚è®¾ç½®è¿™ä¸ªå€¼ä¸º 1ï¼Œå°±èƒ½å¤Ÿå…³é—­å¤§éƒ¨åˆ†çš„ Node.js æ ¸å¿ƒæ¨¡å—äº§ç”Ÿçš„è­¦å‘Šã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-node-no-warnings-1" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-node-no-warnings-1"><span>å¦‚ä½•ä½¿ç”¨ <code>NODE_NO_WARNINGS=1</code></span></a></h3><p>åœ¨å‘½ä»¤è¡Œä¸­è®¾ç½®è¿™ä¸ªç¯å¢ƒå˜é‡éå¸¸ç®€å•ã€‚ä»¥ä¸‹æ˜¯å‡ ç§åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸­è®¾ç½® <code>NODE_NO_WARNINGS=1</code> å¹¶è¿è¡Œ Node.js åº”ç”¨ç¨‹åºçš„æ–¹å¼ï¼š</p><h4 id="åœ¨-linux-æˆ–-macos-ä¸Š" tabindex="-1"><a class="header-anchor" href="#åœ¨-linux-æˆ–-macos-ä¸Š"><span>åœ¨ Linux æˆ– macOS ä¸Š</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">NODE_NO_WARNINGS</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">1</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your_app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="åœ¨-windows-ä¸Š" tabindex="-1"><a class="header-anchor" href="#åœ¨-windows-ä¸Š"><span>åœ¨ Windows ä¸Š</span></a></h4><p>åœ¨å‘½ä»¤æç¤ºç¬¦ä¸‹ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> NODE_NO_WARNINGS=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your_app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ–è€…ä½¿ç”¨ PowerShellï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$env</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">NODE_NO_WARNINGS</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your_app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…ä¾‹å­-7" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-7"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªç®€å•çš„ Node.js è„šæœ¬ <code>deprecation_warning.js</code>ï¼Œå®ƒä½¿ç”¨äº†ä¸€ä¸ªè¢«æ ‡è®°ä¸ºå³å°†åºŸå¼ƒï¼ˆå³ä¸å»ºè®®ä½¿ç”¨ï¼Œå¹¶å¯èƒ½åœ¨æœªæ¥çš„ Node.js ç‰ˆæœ¬ä¸­åˆ é™¤ï¼‰çš„ APIã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// deprecation_warning.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨äº†ä¸€ä¸ªå³å°†åºŸå¼ƒçš„æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä½ è¿è¡Œè¿™ä¸ªè„šæœ¬ <code>node deprecation_warning.js</code> æ—¶ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°å¦‚ä¸‹çš„è¾“å‡ºï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>(node:12345) DeprecationWarning: util.print is deprecated. Use console.log instead.</span></span>
<span class="line"><span>Hello, World!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ å·²ç»æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ç”±äºæŸäº›åŸå› ä½ ç›®å‰è¿˜ä¸èƒ½ä¿®æ”¹è¿™æ®µä»£ç ï¼Œé‚£ä¹ˆä½ å¯ä»¥é€šè¿‡è®¾ç½® <code>NODE_NO_WARNINGS=1</code> æ¥ç¦æ­¢æ˜¾ç¤ºè¿™äº›è­¦å‘Šã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">NODE_NO_WARNINGS</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">1</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> deprecation_warning.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿è¡Œä¸Šè¿°å‘½ä»¤åï¼Œä½ ä¼šæ³¨æ„åˆ°æ²¡æœ‰ä»»ä½•è­¦å‘Šä¿¡æ¯è¢«æ‰“å°ï¼Œåªè¾“å‡ºäº† &quot;Hello, World!&quot;ã€‚</p><h3 id="æ³¨æ„äº‹é¡¹-5" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-5"><span>æ³¨æ„äº‹é¡¹</span></a></h3><p>è™½ç„¶ä½¿ç”¨ <code>NODE_NO_WARNINGS=1</code> å¯ä»¥è®©ä½ çš„å¼€å‘è¿‡ç¨‹ä¸­æ§åˆ¶å°è¾“å‡ºæ›´åŠ æ¸…çˆ½ï¼Œä½†æ˜¯é•¿æœŸå¿½è§†è­¦å‘Šä¿¡æ¯å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚è¿™äº›è­¦å‘Šå¯èƒ½æ˜¯æé†’ä½ éœ€è¦æ›´æ–°æˆ–ä¿®å¤ä»£ç ï¼Œé¿å…åœ¨å°†æ¥çš„ Node.js ç‰ˆæœ¬ä¸­é‡åˆ°é—®é¢˜ã€‚æ‰€ä»¥ï¼Œå»ºè®®åªåœ¨æœ‰æ˜ç¡®éœ€æ±‚æ—¶ï¼Œä¸´æ—¶ä½¿ç”¨ <code>NODE_NO_WARNINGS=1</code>ï¼Œå¹¶ä¸”è®°å¾—å›å¤´å¤„ç†è¿™äº›è­¦å‘Šä¿¡æ¯ã€‚</p><h3 id="node-options-options" tabindex="-1"><a class="header-anchor" href="#node-options-options"><span><a href="https://nodejs.org/docs/latest/api/cli.html#node_optionsoptions" target="_blank" rel="noopener noreferrer">NODE_OPTIONS=options...</a></span></a></h3><p><code>NODE_OPTIONS</code>æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå®ƒå…è®¸ä½ åœ¨å‘½ä»¤è¡Œå¯åŠ¨ Node.js ç¨‹åºæ—¶é¢„å…ˆè®¾å®šä¸€ç³»åˆ— Node.js çš„è¿è¡Œé€‰é¡¹ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨ä¸ä¿®æ”¹ç¨‹åºä»£ç çš„æƒ…å†µä¸‹ï¼Œç»™ Node.js è¿›ç¨‹æŒ‡å®šé¢å¤–çš„å¯åŠ¨å‚æ•°æˆ–è€…è°ƒæ•´å…¶è¡Œä¸ºã€‚</p><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°éœ€è¦è°ƒæ•´ Node.js è¿è¡Œé…ç½®çš„åœºæ™¯ï¼Œä¾‹å¦‚è®¾ç½®å†…å­˜é™åˆ¶ã€é¢„åŠ è½½æ¨¡å—ã€é€‰æ‹©åƒåœ¾å›æ”¶ç­–ç•¥ç­‰ã€‚ä½¿ç”¨<code>NODE_OPTIONS</code>å¯ä»¥è®©ä½ æ–¹ä¾¿åœ°åœ¨å¯åŠ¨æ—¶è¿›è¡Œè¿™äº›è®¾ç½®ã€‚</p><p>ä¸‹é¢é€šè¿‡å‡ ä¸ªå®é™…çš„ä¾‹å­æ¥è¯´æ˜<code>NODE_OPTIONS</code>çš„ç”¨æ³•ï¼š</p><h3 id="_1-è®¾ç½®æœ€å¤§å†…å­˜" tabindex="-1"><a class="header-anchor" href="#_1-è®¾ç½®æœ€å¤§å†…å­˜"><span>1. è®¾ç½®æœ€å¤§å†…å­˜</span></a></h3><p>å¦‚æœä½ çš„ Node.js åº”ç”¨éœ€è¦å¤„ç†å¤§é‡æ•°æ®ï¼Œå¯èƒ½ä¼šè¶…å‡ºé»˜è®¤çš„å†…å­˜é™åˆ¶ï¼Œè¿™æ—¶å€™å°±éœ€è¦å¢åŠ  V8 å¼•æ“çš„æœ€å¤§å†…å­˜å¤§å°ã€‚å‡è®¾ä½ æƒ³å°†æœ€å¤§å†…å­˜è®¾ç½®ä¸º 4GBï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">NODE_OPTIONS</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;--max-old-space-size=4096&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™è¡Œå‘½ä»¤è®¾ç½®äº†<code>NODE_OPTIONS</code>ç¯å¢ƒå˜é‡ï¼Œå¢åŠ äº†<code>--max-old-space-size=4096</code>ï¼ˆå•ä½æ˜¯ MBï¼‰ï¼Œç„¶åå¯åŠ¨äº†<code>app.js</code>æ–‡ä»¶ã€‚</p><h3 id="_2-å¯ç”¨-es6-æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#_2-å¯ç”¨-es6-æ¨¡å—"><span>2. å¯ç”¨ ES6 æ¨¡å—</span></a></h3><p>å¦‚æœä½ çš„ Node.js ç‰ˆæœ¬æ”¯æŒ ES6 æ¨¡å—ç‰¹æ€§ï¼Œä½†é»˜è®¤æ²¡æœ‰å¼€å¯ï¼Œä½ å¯ä»¥é€šè¿‡<code>NODE_OPTIONS</code>å¯ç”¨è¯¥ç‰¹æ€§ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">NODE_OPTIONS</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;--experimental-modules&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>--experimental-modules</code>é€‰é¡¹è¢«æ·»åŠ åˆ° Node.js è¿›ç¨‹ä¸­ï¼Œä»è€Œå¯ç”¨äº†å®éªŒæ€§çš„ ES6 æ¨¡å—ç‰¹æ€§ã€‚</p><h3 id="_3-é¢„åŠ è½½æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#_3-é¢„åŠ è½½æ¨¡å—"><span>3. é¢„åŠ è½½æ¨¡å—</span></a></h3><p>æœ‰æ—¶å€™ï¼Œä½ å¸Œæœ›åœ¨æ¯ä¸ª Node.js ç¨‹åºå¼€å§‹æ‰§è¡Œå‰è‡ªåŠ¨åŠ è½½ä¸€äº›æ¨¡å—ï¼Œæ¯”å¦‚ä¸€äº›é…ç½®æ–‡ä»¶æˆ–è€…è¡¥ä¸åº“ã€‚å¯ä»¥ä½¿ç”¨<code>-r</code>ï¼ˆæˆ–è€…<code>--require</code>ï¼‰é€‰é¡¹æ¥å®ç°ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">NODE_OPTIONS</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;-r dotenv/config -r module-alias/register&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>dotenv/config</code>å’Œ<code>module-alias/register</code>ä¸¤ä¸ªæ¨¡å—ä¼šåœ¨<code>app.js</code>æ‰§è¡Œä¹‹å‰è¢«åŠ è½½ã€‚</p><h3 id="_4-è°ƒè¯•å’Œæ€§èƒ½åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_4-è°ƒè¯•å’Œæ€§èƒ½åˆ†æ"><span>4. è°ƒè¯•å’Œæ€§èƒ½åˆ†æ</span></a></h3><p>å¦‚æœä½ æƒ³è¦è°ƒè¯•æˆ–è€…å¯¹ Node.js åº”ç”¨åšæ€§èƒ½åˆ†æï¼Œä½ å¯èƒ½éœ€è¦æ‰“å¼€æŸäº›è¯Šæ–­åŠŸèƒ½ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">NODE_OPTIONS</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;--inspect=0.0.0.0:9229&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¸Šè¿°å‘½ä»¤å¯ç”¨äº† Node.js çš„è°ƒè¯•å™¨ï¼Œå¹¶ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ä¸Šçš„ 9229 ç«¯å£ï¼Œå…è®¸ä½ è¿œç¨‹è¿æ¥è°ƒè¯•å™¨ã€‚</p><h3 id="æ³¨æ„äº‹é¡¹-6" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-6"><span>æ³¨æ„äº‹é¡¹ï¼š</span></a></h3><ul><li>ä¸æ˜¯æ‰€æœ‰çš„ Node.js å‘½ä»¤è¡Œé€‰é¡¹éƒ½å¯ä»¥é€šè¿‡<code>NODE_OPTIONS</code>è®¾ç½®ã€‚æœ‰äº›å…·æœ‰å®‰å…¨é£é™©æˆ–å½±å“å­è¿›ç¨‹è¡Œä¸ºçš„é€‰é¡¹ä¸èƒ½é€šè¿‡è¿™ç§æ–¹å¼è®¾ç½®ã€‚</li><li>ä½¿ç”¨<code>NODE_OPTIONS</code>æ—¶ï¼Œç¡®ä¿åªåŒ…å«é€‚åˆå½“å‰ Node.js ç‰ˆæœ¬çš„é€‰é¡¹ï¼Œä»¥é¿å…éå…¼å®¹é—®é¢˜ã€‚</li><li>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¿®æ”¹<code>NODE_OPTIONS</code>éœ€è¦è°¨æ…ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šå½±å“åº”ç”¨çš„æ€§èƒ½å’Œè¡Œä¸ºã€‚</li><li>ç¡®ä¿åœ¨è®¾ç½®ç¯å¢ƒå˜é‡æ—¶ä¸è¦åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºè¿™äº›ä¿¡æ¯å¯èƒ½ä¼šæ³„éœ²ç»™æ—¥å¿—æ–‡ä»¶æˆ–ç›‘æ§å·¥å…·ã€‚</li></ul><p>é€šè¿‡ä»¥ä¸Šä¾‹å­å’Œæ³¨æ„äº‹é¡¹ï¼Œä½ åº”è¯¥èƒ½å¤Ÿç†è§£å¹¶å¼€å§‹ä½¿ç”¨<code>NODE_OPTIONS</code>ç¯å¢ƒå˜é‡æ¥è°ƒæ•´ Node.js åº”ç”¨çš„è¿è¡Œæ–¹å¼äº†ã€‚</p><h3 id="node-path-path" tabindex="-1"><a class="header-anchor" href="#node-path-path"><span><a href="https://nodejs.org/docs/latest/api/cli.html#node_pathpath" target="_blank" rel="noopener noreferrer">NODE_PATH=path[:â€¦]</a></span></a></h3><p><code>NODE_PATH</code> æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œåœ¨ Node.js ä¸­ä½¿ç”¨å®ƒå¯ä»¥æŒ‡å®šé¢å¤–çš„ç›®å½•è·¯å¾„ï¼Œè¿™äº›ç›®å½•å°†è¢«æ·»åŠ åˆ° Node.js æ¨¡å—æŸ¥æ‰¾è·¯å¾„ä¸­ã€‚å½“ä½ ä½¿ç”¨ `</p><h3 id="node-pending-deprecation-1" tabindex="-1"><a class="header-anchor" href="#node-pending-deprecation-1"><span><a href="https://nodejs.org/docs/latest/api/cli.html#node_pending_deprecation1" target="_blank" rel="noopener noreferrer">NODE_PENDING_DEPRECATION=1</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„â€œå¾…å®šå¼ƒç”¨ï¼ˆPending Deprecationï¼‰â€æ—¶ï¼Œæˆ‘ä»¬æ˜¯åœ¨æåˆ°ä¸€ä¸ªç‰¹æ®Šçš„æ ‡è®°æˆ–è€…è®¾ç½®ï¼Œè¿™ä¸ªè®¾ç½®å¯ä»¥è®©ä½ æå‰å¾—çŸ¥æŸäº› Node.js çš„åŠŸèƒ½å°†ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­è¢«å¼ƒç”¨ã€‚</p><p>ä¸ºäº†ç†è§£è¿™ä¸€ç‚¹ï¼Œé¦–å…ˆéœ€è¦æ˜ç™½ä»€ä¹ˆæ˜¯â€œå¼ƒç”¨ï¼ˆDeprecationï¼‰â€ã€‚åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œâ€œå¼ƒç”¨â€æ˜¯æŒ‡å¯¹æŸä¸ªåŠŸèƒ½ã€æ–¹æ³•æˆ–å±æ€§çš„ä¸æ¨èä½¿ç”¨çš„çŠ¶æ€ã€‚é€šå¸¸å®ƒæ„å‘³ç€è¿™é¡¹åŠŸèƒ½åœ¨æœªæ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«ç§»é™¤æˆ–æ›¿æ¢ï¼Œå› æ­¤å¼€å‘è€…åº”è¯¥é¿å…ä½¿ç”¨å¹¶å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæœ‰æ—¶å€™å¼€å‘å›¢é˜Ÿå¯èƒ½å†³å®šæŸä¸ª API æˆ–è€…åŠŸèƒ½ä¸å†é€‚åˆå½“å‰å’Œæœªæ¥çš„é¡¹ç›®éœ€æ±‚ï¼Œå› æ­¤ä»–ä»¬ä¼šæ‰“ä¸Šâ€œå¼ƒç”¨â€çš„æ ‡ç­¾ã€‚ä½†åœ¨æ­£å¼æˆä¸ºâ€œå¼ƒç”¨â€ä¹‹å‰ï¼Œè¿™äº›åŠŸèƒ½ä¸€èˆ¬ä¼šè¿›å…¥ä¸€ä¸ªâ€œå¾…å®šå¼ƒç”¨â€çš„çŠ¶æ€ï¼Œè¿™å°±æ˜¯ NODE_PENDING_DEPRECATION ç¯å¢ƒå˜é‡å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚</p><p>è¿™ä¸ªç¯å¢ƒå˜é‡æ˜¯é€šè¿‡å‘½ä»¤è¡Œä¼ é€’ç»™ Node.js ç¨‹åºçš„ï¼Œå¦‚æœè®¾ç½®ä¸º 1ï¼Œåˆ™ Node.js å°†ä¼šæ˜¾ç¤ºå‡ºæ‰€æœ‰çš„â€œå¾…å®šå¼ƒç”¨â€çš„è­¦å‘Šä¿¡æ¯ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾ Node.js çš„å›¢é˜Ÿå†³å®šåœ¨æœªæ¥æŸä¸ªç‰ˆæœ¬ä¸­è¦å¼ƒç”¨<code>process.env()</code>æ–¹æ³•ï¼Œå¹¶ä¸”ç›®å‰è¿™ä¸ªæ–¹æ³•å¤„äºå¾…å®šå¼ƒç”¨çŠ¶æ€ã€‚å¦‚æœä½ çš„ä»£ç ä¸­ç”¨åˆ°äº†è¿™ä¸ªæ–¹æ³•ï¼Œå¹³å¸¸è¿è¡Œæ—¶ï¼ŒNode.js å¯èƒ½ä¸ä¼šå‘Šè¯‰ä½ ä»»ä½•äº‹æƒ…ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å¯åŠ¨ Node.js æ—¶è®¾ç½®äº†<code>NODE_PENDING_DEPRECATION=1</code>ï¼Œé‚£ä¹ˆæ¯æ¬¡è°ƒç”¨<code>process.env()</code>æ—¶ï¼ŒNode.js éƒ½ä¼šè¾“å‡ºä¸€æ¡è­¦å‘Šä¿¡æ¯ï¼Œæç¤ºä½ è¿™ä¸ªæ–¹æ³•å³å°†è¢«å¼ƒç”¨ï¼Œå»ºè®®ä½ å°½æ—©ä¿®æ”¹ä½ çš„ä»£ç ã€‚</p><p>æ“ä½œç¤ºä¾‹ï¼š</p><ol><li>æ‰“å¼€ä½ çš„å‘½ä»¤è¡Œç»ˆç«¯ã€‚</li><li>è¾“å…¥ä»¥ä¸‹å‘½ä»¤è¡Œå‚æ•°ï¼Œå…¶ä¸­<code>app.js</code>æ˜¯ä½ çš„ Node.js ç¨‹åºæ–‡ä»¶åã€‚</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">NODE_PENDING_DEPRECATION</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">1</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="3"><li>è¿è¡Œä½ çš„ç¨‹åºï¼Œå¦‚æœç¨‹åºä¸­ä½¿ç”¨äº†å³å°†è¢«å¼ƒç”¨çš„åŠŸèƒ½ï¼Œä½ å°†çœ‹åˆ°ç›¸åº”çš„è­¦å‘Šä¿¡æ¯ã€‚</li></ol><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯å¼€å‘è€…å¯ä»¥æå‰å¾—çŸ¥å“ªäº›åŠŸèƒ½å°†è¦æ”¹å˜ï¼Œå¹¶ä¸”æœ‰è¶³å¤Ÿçš„æ—¶é—´å»æ›´æ–°å’Œç»´æŠ¤è‡ªå·±çš„ä»£ç ï¼Œä»¥ç¡®ä¿åœ¨æœªæ¥ Node.js çš„æ–°ç‰ˆæœ¬å‘å¸ƒåï¼Œä»£ç ä»ç„¶èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚</p><h3 id="node-pending-pipe-instances-instances" tabindex="-1"><a class="header-anchor" href="#node-pending-pipe-instances-instances"><span><a href="https://nodejs.org/docs/latest/api/cli.html#node_pending_pipe_instancesinstances" target="_blank" rel="noopener noreferrer">NODE_PENDING_PIPE_INSTANCES=instances</a></span></a></h3><p><code>NODE_PENDING_PIPE_INSTANCES</code> æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨åœ¨ Windows ç³»ç»Ÿä¸Šã€‚è¿™ä¸ªå˜é‡å‘Šè¯‰ Node.js åº”è¯¥ä¸ºå‘½åç®¡é“ï¼ˆnamed pipeï¼‰æˆ–åŸŸå¥—æ¥å­—ï¼ˆUnix domain socketï¼‰å‡†å¤‡å¤šå°‘ä¸ªæŒ‚èµ·è¿æ¥ã€‚æŒ‚èµ·è¿æ¥æ˜¯é‚£äº›å·²ç»å®Œæˆäº†æ¡æ‰‹ä½†è¿˜æ²¡æœ‰è¢«æœåŠ¡å™¨ç«¯çš„åº”ç”¨ç¨‹åºå¤„ç†çš„è¿æ¥ã€‚</p><p>åœ¨ Windows ä¸Šï¼Œå½“ä½¿ç”¨å‘½åç®¡é“æ—¶ï¼Œæ¯”å¦‚é€šè¿‡ <code>\\.\pipe\mypipe</code> è¿™æ ·çš„è·¯å¾„åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ï¼Œä½ å¯ä»¥è®¾ç½®è¿™ä¸ªç¯ä»¶å˜é‡æ¥è°ƒæ•´æœåŠ¡å™¨èƒ½å¤Ÿå¤„ç†çš„å¹¶å‘è¿æ¥æ•°é‡ã€‚é»˜è®¤å€¼æ˜¯ 511ï¼Œè¿™æ„å‘³ç€è¶…è¿‡è¿™ä¸ªæ•°ç›®çš„è¿æ¥ä¼šè¢«æ‹’ç»ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾ä½ åœ¨è¿è¡Œä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œå®ƒä½¿ç”¨å‘½åç®¡é“æ¥è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰ã€‚å¦‚æœä½ é¢„æœŸä¼šæœ‰å¤§é‡çš„å¹¶å‘è¿æ¥ï¼Œä½ å¯èƒ½éœ€è¦æé«˜æŒ‚èµ·è¿æ¥çš„æ•°é‡ä»¥é¿å…è¿æ¥è¢«æ‹’ç»ã€‚æ­¤æ—¶ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºä¹‹å‰è®¾ç½® <code>NODE_PENDING_PIPE_INSTANCES</code> ç¯å¢ƒå˜é‡ã€‚</p><p>ä¸‹é¢æ˜¯å‡ ä¸ªå®é™…è¿ç”¨çš„ä¾‹å­ï¼š</p><ol><li><p><strong>ç®€å•çš„ç¯å¢ƒå˜é‡è®¾ç½®</strong>ï¼š<br> å‡è®¾ä½ æƒ³è®¾ç½®è¿™ä¸ªç¯å¢ƒå˜é‡çš„å€¼ä¸º 1000ã€‚åœ¨ Windows å‘½ä»¤æç¤ºç¬¦ä¸­ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼ˆåœ¨è¿è¡Œä½ çš„ Node.js åº”ç”¨ä¹‹å‰ï¼‰ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>set NODE_PENDING_PIPE_INSTANCES=1000</span></span>
<span class="line"><span>node myapp.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Node.js åº”ç”¨ä¸­è¯»å–ç¯å¢ƒå˜é‡</strong>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// myapp.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> pipeName</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">pipe</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">mypipe&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  `Pending pipe instances: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">NODE_PENDING_PIPE_INSTANCES</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">pipeName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Server is listening on </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">pipeName</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªåº”ç”¨ä¸­ï¼ŒæœåŠ¡å™¨ä¼šåœ¨æŒ‡å®šçš„å‘½åç®¡é“ä¸Šç›‘å¬è¯·æ±‚ï¼Œå¹¶ä¸”é€šè¿‡ <code>process.env</code> è®¿é—® <code>NODE_PENDING_PIPE_INSTANCES</code> çš„å€¼ã€‚</p></li><li><p><strong>ä½¿ç”¨è„šæœ¬æ¥è®¾ç½®ç¯å¢ƒå˜é‡å’Œå¯åŠ¨åº”ç”¨</strong>ï¼š<br> ä½ å¯ä»¥å†™ä¸€ä¸ªæ‰¹å¤„ç†è„šæœ¬ (<code>start.bat</code>) æ¥è‡ªåŠ¨è®¾ç½®è¿™ä¸ªå˜é‡å¹¶å¯åŠ¨åº”ç”¨ï¼š</p><div class="language-batch line-numbers-mode" data-highlighter="shiki" data-ext="batch" data-title="batch" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>@echo off</span></span>
<span class="line"><span>SET NODE_PENDING_PIPE_INSTANCES=1000</span></span>
<span class="line"><span>node myapp.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>è¯·è®°ä½ï¼Œè¿™ä¸ªç¯å¢ƒå˜é‡é€šå¸¸åªå¯¹å¼€å‘åœ¨ Windows ä¸Šè¿›è¡Œ IPC é€šä¿¡çš„ Node.js åº”ç”¨ç¨‹åºæœ‰å…³ã€‚åœ¨å¤§å¤šæ•°æ—¥å¸¸å¼€å‘åœºæ™¯ä¸­ï¼Œä½ å¯èƒ½ä¸éœ€è¦ä¿®æ”¹å®ƒï¼Œé™¤éä½ çš„åº”ç”¨éœ€è¦å¤„ç†å¤§é‡çš„å¹¶å‘è¿æ¥ã€‚</p><h3 id="node-preserve-symlinks-1" tabindex="-1"><a class="header-anchor" href="#node-preserve-symlinks-1"><span><a href="https://nodejs.org/docs/latest/api/cli.html#node_preserve_symlinks1" target="_blank" rel="noopener noreferrer">NODE_PRESERVE_SYMLINKS=1</a></span></a></h3><p>åœ¨è§£é‡Š <code>NODE_PRESERVE_SYMLINKS=1</code> è¿™ä¸ªç¯å¢ƒå˜é‡ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸¤ä¸ªæ¦‚å¿µï¼šNode.js å’Œç¬¦å·é“¾æ¥ï¼ˆsymlinksï¼‰ã€‚</p><p><strong>Node.js ç®€ä»‹</strong>ï¼š<br> Node.js æ˜¯ä¸€ä¸ªå¼€æºçš„ã€è·¨å¹³å°çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œè®©å¼€å‘è€…å¯ä»¥ç”¨ JavaScript æ¥ç¼–</p><h3 id="node-redirect-warnings-file" tabindex="-1"><a class="header-anchor" href="#node-redirect-warnings-file"><span><a href="https://nodejs.org/docs/latest/api/cli.html#node_redirect_warningsfile" target="_blank" rel="noopener noreferrer">NODE_REDIRECT_WARNINGS=file</a></span></a></h3><p>Node.js ä¸­çš„<code>NODE_REDIRECT_WARNINGS</code>ç¯å¢ƒå˜é‡æ˜¯ç”¨æ¥æ§åˆ¶ Node.js åœ¨è¿è¡Œæ—¶äº§ç”Ÿçš„è­¦å‘Šä¿¡æ¯è¾“å‡ºä½ç½®çš„ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›è­¦å‘Šä¼šç›´æ¥æ‰“å°åˆ°æ§åˆ¶å°ï¼ˆé€šå¸¸æ˜¯ä½ çš„å‘½ä»¤è¡Œç•Œé¢æˆ–è€…ç»ˆç«¯ç•Œé¢ï¼‰ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¯”å¦‚å½“ä½ æ­£åœ¨è¿è¡Œä¸€ä¸ªé•¿æ—¶é—´æ‰§è¡Œçš„åº”ç”¨æˆ–è€…æœåŠ¡ï¼Œå¹¶ä¸”ä¸å¸Œæœ›ç”¨æˆ·ç•Œé¢è¢«è¿™äº›è­¦å‘Šä¿¡æ¯å¹²æ‰°æ—¶ï¼Œä½ å¯èƒ½æƒ³æŠŠè¿™äº›è­¦å‘Šé‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ è®¾ç½®äº†<code>NODE_REDIRECT_WARNINGS</code>ç¯å¢ƒå˜é‡ï¼ŒNode.js å°†ä¼šæŠŠæ‰€æœ‰çš„è­¦å‘Šä¿¡æ¯å†™å…¥åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼ˆå³æ§åˆ¶å°ï¼‰ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›å…·ä½“çš„ä¾‹å­ï¼š</p><p><strong>ä¾‹å­ 1ï¼šè®¾ç½®ç¯å¢ƒå˜é‡é‡å®šå‘è­¦å‘Šåˆ°æ–‡ä»¶</strong></p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªç®€å•çš„ Node.js è„šæœ¬ <code>app.js</code>ï¼Œé‡Œé¢æœ‰ä¸€æ®µä»£ç å¯èƒ½ä¼šè§¦å‘ Node.js çš„è­¦å‘Šä¿¡æ¯ï¼Œä¾‹å¦‚ä½¿ç”¨äº†æŸä¸ªåºŸå¼ƒçš„ APIã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// app.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">existsSync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™ä¸ªæ–¹æ³•åœ¨æœªæ¥çš„Node.jsç‰ˆæœ¬ä¸­è¢«åºŸå¼ƒ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;åº”ç”¨æ­£åœ¨è¿è¡Œ...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œå‡è®¾ä½ ä¸æƒ³è®©è­¦å‘Šä¿¡æ¯æ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸Šï¼Œä½ å¯ä»¥åœ¨è¿è¡Œè„šæœ¬ä¹‹å‰è®¾ç½®<code>NODE_REDIRECT_WARNINGS</code>ç¯å¢ƒå˜é‡å¹¶æŒ‡å®šä¸€ä¸ªæ–‡ä»¶åã€‚</p><p>åœ¨ Unix-like ç³»ç»Ÿï¼ˆæ¯”å¦‚ Linux æˆ– macOSï¼‰ä¸Šï¼Œä½ å¯ä»¥åœ¨ç»ˆç«¯ä¸­è¿™æ ·åšï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">NODE_REDIRECT_WARNINGS</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">warnings.txt</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨ Windows ç³»ç»Ÿä¸Šï¼Œä½ å¯ä»¥ä½¿ç”¨å‘½ä»¤æç¤ºç¬¦ï¼ˆcmdï¼‰æ¥è¿™æ ·åšï¼š</p><div class="language-cmd line-numbers-mode" data-highlighter="shiki" data-ext="cmd" data-title="cmd" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>set NODE_REDIRECT_WARNINGS=warnings.txt</span></span>
<span class="line"><span>node app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™å°†ä¼šæŠŠæ‰€æœ‰ Node.js ç”Ÿæˆçš„è­¦å‘Šä¿¡æ¯é‡å®šå‘åˆ°å½“å‰ç›®å½•ä¸‹çš„<code>warnings.txt</code>æ–‡ä»¶ä¸­ã€‚</p><p><strong>ä¾‹å­ 2ï¼šä½¿ç”¨<code>.env</code>æ–‡ä»¶è®¾ç½®ç¯å¢ƒå˜é‡</strong></p><p>å¦‚æœä½ ä¸æƒ³æ¯æ¬¡è¿è¡Œè„šæœ¬æ—¶éƒ½æ‰‹åŠ¨è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåä¸º<code>.env</code>çš„æ–‡ä»¶æ¥å­˜å‚¨ç¯å¢ƒå˜é‡ï¼Œç„¶åé€šè¿‡æŸäº›åº“ï¼ˆæ¯”å¦‚<code>dotenv</code>ï¼‰ï¼Œåœ¨è„šæœ¬å¯åŠ¨æ—¶åŠ è½½è¿™äº›ç¯å¢ƒå˜é‡ã€‚</p><p>é¦–å…ˆï¼Œå®‰è£…<code>dotenv</code>åº“ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dotenv</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç„¶åï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª<code>.env</code>æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>NODE_REDIRECT_WARNINGS=warnings.txt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æœ€åï¼Œåœ¨ä½ çš„è„šæœ¬<code>app.js</code>çš„æœ€é¡¶éƒ¨åŠ å…¥ä»¥ä¸‹ä»£ç æ¥åŠ è½½<code>.env</code>æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;dotenv&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">config</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ...ä½ çš„å…¶ä»–ä»£ç ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œæ¯æ¬¡è¿è¡Œ<code>app.js</code>æ—¶ï¼Œ<code>NODE_REDIRECT_WARNINGS</code>éƒ½ä¼šè‡ªåŠ¨è¢«è®¾ç½®ï¼Œå¹¶ä¸”è­¦å‘Šä¿¡æ¯ä¼šè¢«å†™å…¥åˆ°<code>warnings.txt</code>æ–‡ä»¶ä¸­ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>NODE_REDIRECT_WARNINGS</code>ç¯å¢ƒå˜é‡æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œå®ƒå…è®¸ä½ æ§åˆ¶ Node.js è­¦å‘Šä¿¡æ¯çš„è¾“å‡ºï¼Œä½¿å¾—ä½ å¯ä»¥æ›´å¥½åœ°ç®¡ç†æ—¥å¿—ä¿¡æ¯æˆ–ä¿æŒç”¨æˆ·ç•Œé¢çš„æ¸…æ´ã€‚</p><h3 id="node-repl-external-module-file" tabindex="-1"><a class="header-anchor" href="#node-repl-external-module-file"><span><a href="https://nodejs.org/docs/latest/api/cli.html#node_repl_external_modulefile" target="_blank" rel="noopener noreferrer">NODE_REPL_EXTERNAL_MODULE=file</a></span></a></h3><p><code>NODE_REPL_EXTERNAL_MODULE=file</code> æ˜¯ Node.js ç¯å¢ƒä¸­ç”¨äºé…ç½® REPL (Read-Eval-Print Loop) è¡Œä¸ºçš„ä¸€ä¸ªç¯å¢ƒå˜é‡ã€‚REPL æ˜¯ä¸€ä¸ªç®€å•çš„ã€äº¤äº’å¼çš„ç¼–ç¨‹ç¯å¢ƒï¼Œå…è®¸ç”¨æˆ·è¾“å…¥ä»£ç ï¼Œå¹¶ç«‹å³æ‰§è¡Œè¿™äº›ä»£ç ï¼Œç„¶åæ‰“å°ç»“æœã€‚</p><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥è®¾ç½® <code>NODE_REPL_EXTERNAL_MODULE</code> ç¯å¢ƒå˜é‡æ¥æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å°†åœ¨ REPL å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½ã€‚è¿™æ ·åšæœ‰å‡ ä¸ªå¥½å¤„ï¼šä½ å¯ä»¥é¢„å…ˆå®šä¹‰ä¸€äº›å‡½æ•°æˆ–æ¨¡å—ï¼Œä»¥ä¾¿åœ¨ REPL ä¼šè¯ä¸­ç›´æ¥ä½¿ç”¨å®ƒä»¬ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡éƒ½æ‰‹åŠ¨åŠ è½½ã€‚</p><p>ä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨ <code>NODE_REPL_EXTERNAL_MODULE</code> çš„æ­¥éª¤å’Œç¤ºä¾‹ï¼š</p><h3 id="_1-åˆ›å»ºä¸€ä¸ª-node-js-æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºä¸€ä¸ª-node-js-æ–‡ä»¶"><span>1. åˆ›å»ºä¸€ä¸ª Node.js æ–‡ä»¶</span></a></h3><p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªåä¸º &quot;myreplinit.js&quot; çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«äº†ä½ æƒ³è¦åœ¨ REPL ä¸­é¢„å…ˆåŠ è½½çš„ä»»ä½•ä»£ç ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€äº›è¾…åŠ©å‡½æ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// myreplinit.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> greet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Hello, </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">!`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">exports</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">greet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> };</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-è®¾ç½®ç¯å¢ƒå˜é‡" tabindex="-1"><a class="header-anchor" href="#_2-è®¾ç½®ç¯å¢ƒå˜é‡"><span>2. è®¾ç½®ç¯å¢ƒå˜é‡</span></a></h3><p>ç„¶åï¼Œåœ¨å¯åŠ¨ REPL ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸­è®¾å®šç¯å¢ƒå˜é‡æ¥å‘Šè¯‰ Node.js åŠ è½½è¿™ä¸ªæ–‡ä»¶ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Unix-like ç³»ç»Ÿï¼ˆä¾‹å¦‚ Linux æˆ– macOSï¼‰ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¿™æ ·è®¾ç½®ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NODE_REPL_EXTERNAL_MODULE</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myreplinit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">js</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ åœ¨ Windows ä¸Šï¼Œåˆ™è¿™æ ·è®¾ç½®ï¼š</p><div class="language-cmd line-numbers-mode" data-highlighter="shiki" data-ext="cmd" data-title="cmd" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>set NODE_REPL_EXTERNAL_MODULE=myreplinit.js</span></span>
<span class="line"><span>node</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-ä½¿ç”¨-repl" tabindex="-1"><a class="header-anchor" href="#_3-ä½¿ç”¨-repl"><span>3. ä½¿ç”¨ REPL</span></a></h3><p>è®¾ç½®å¥½ç¯å¢ƒå˜é‡åï¼Œå½“ä½ å¯åŠ¨ Node.js çš„ REPL æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨åŠ è½½&quot;myreplinit.js&quot;æ–‡ä»¶ï¼Œå¹¶ä¸”ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨å…¶ä¸­å®šä¹‰çš„å‡½æ•°ï¼Œè€Œä¸éœ€è¦é‡æ–°è¦æ±‚æˆ–è€…å®šä¹‰å®ƒä»¬ã€‚</p><p>åœ¨ REPL ä¸­ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> .</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">load</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> myreplinit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">js</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">   // å¦‚æœæ²¡æœ‰é€šè¿‡ç¯å¢ƒå˜é‡æŒ‡å®šï¼Œä¹Ÿå¯ä»¥åœ¨REPLä¸­æ‰‹åŠ¨åŠ è½½æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">Loading</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> myreplinit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">js</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">...</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">undefined</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> greet</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;Alice&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">Hello</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">Alice</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">undefined</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">15</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ³¨æ„ï¼Œ<code>.load</code> å‘½ä»¤æ˜¯å¦ä¸€ç§åœ¨ REPL ä¼šè¯ä¸­åŠ è½½æ–‡ä»¶çš„æ–¹æ³•ï¼Œå¦‚æœä½ æ²¡æœ‰é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®ï¼Œå¯ä»¥æ‰‹åŠ¨ä½¿ç”¨å®ƒã€‚</p><p>è¿™ä¸ªåŠŸèƒ½ç‰¹åˆ«æœ‰ç”¨ï¼Œå½“ä½ æœ‰ä¸€äº›å¸¸ç”¨çš„åº“æˆ–è€…å·¥å…·å‡½æ•°æ—¶ï¼Œä½ å¯ä»¥å°†å®ƒä»¬æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶é€šè¿‡è®¾ç½® <code>NODE_REPL_EXTERNAL_MODULE</code> å¿«é€Ÿåœ°åœ¨æ¯æ¬¡ REPL ä¼šè¯ä¸­è°ƒç”¨ã€‚è¿™æ ·å¯ä»¥èŠ‚çœæ—¶é—´ï¼Œæé«˜æ•ˆç‡ã€‚</p><h3 id="node-repl-history-file" tabindex="-1"><a class="header-anchor" href="#node-repl-history-file"><span><a href="https://nodejs.org/docs/latest/api/cli.html#node_repl_historyfile" target="_blank" rel="noopener noreferrer">NODE_REPL_HISTORY=file</a></span></a></h3><p><code>NODE_REPL_HISTORY=file</code> æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨æ¥æŒ‡å®šåœ¨ä½¿ç”¨ Node.js çš„ REPL ç¯å¢ƒæ—¶ä¿å­˜å†å²å‘½ä»¤çš„æ–‡ä»¶è·¯å¾„ã€‚REPL æ˜¯â€œRead-Eval-Print Loopâ€çš„ç¼©å†™ï¼ŒæŒ‡çš„æ˜¯ä¸€ä¸ªäº¤äº’å¼è§£é‡Šå™¨ç¯å¢ƒï¼Œå¯ä»¥è¾“å…¥ JavaScript ä»£ç å¹¶ç«‹å³æ‰§è¡Œçœ‹åˆ°ç»“æœï¼Œè¿™å¯¹äºå¿«é€Ÿæµ‹è¯•ä»£ç æˆ–å­¦ä¹  JavaScript è¯­è¨€éå¸¸æœ‰ç”¨ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js çš„ REPL ä¼šå°†ä½ è¾“å…¥çš„å†å²å‘½ä»¤ä¿å­˜åœ¨ç”¨æˆ·ç›®å½•ä¸‹çš„ä¸€ä¸ªéšè—æ–‡ä»¶ä¸­ï¼ˆé€šå¸¸æ˜¯<code>.node_repl_history</code>ï¼‰ï¼Œè¿™æ ·ä¸‹æ¬¡ä½ å†å¯åŠ¨ REPL çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨ä¸Šä¸‹é”®ç¿»é˜…ä»¥å‰è¾“å…¥è¿‡çš„å‘½ä»¤ï¼Œä¾¿äºé‡å¤æ‰§è¡Œæˆ–ä¿®æ”¹ä¹‹å‰çš„ä»£ç ç‰‡æ®µã€‚</p><p>é‚£ä¹ˆï¼Œæ¥çœ‹çœ‹ <code>NODE_REPL_HISTORY=file</code> å…·ä½“æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p><ol><li><p><strong>è®¾ç½®ç¯å¢ƒå˜é‡</strong>ï¼šé€šè¿‡è®¾ç½® <code>NODE_REPL_HISTORY</code> ç¯å¢ƒå˜é‡ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰ REPL å†å²å‘½ä»¤è¦ä¿å­˜çš„æ–‡ä»¶è·¯å¾„ã€‚å¦‚æœä½ ä¸æƒ³è®© REPL ä¿å­˜å†å²ï¼Œä¹Ÿå¯ä»¥å°†è¿™ä¸ªå˜é‡è®¾ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ <code>NODE_REPL_HISTORY=</code>ï¼‰ã€‚</p></li><li><p><strong>ä½¿ç”¨æ–¹å¼</strong>ï¼šä½ å¯ä»¥åœ¨å¯åŠ¨ Node.js REPL ä¹‹å‰åœ¨ç»ˆç«¯ï¼ˆå‘½ä»¤è¡Œç•Œé¢ï¼‰è®¾ç½®è¿™ä¸ªç¯å¢ƒå˜é‡ã€‚</p><ul><li><p>åœ¨ <strong>Unix-like ç³»ç»Ÿ</strong>ï¼ˆæ¯”å¦‚ Linux æˆ– macOSï¼‰ä¸­ï¼Œä½ å¯ä»¥è¿™æ ·è®¾ç½®ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NODE_REPL_HISTORY</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">to</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">your</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">history</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">file</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åœ¨ <strong>Windows ç³»ç»Ÿ</strong>ä¸­ï¼Œä½ å¯ä»¥è¿™æ ·è®¾ç½®ï¼š</p><div class="language-cmd line-numbers-mode" data-highlighter="shiki" data-ext="cmd" data-title="cmd" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>set NODE_REPL_HISTORY=C:\path\to\your\history\file</span></span>
<span class="line"><span>node</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p><strong>å®é™…è¿ç”¨ç¤ºä¾‹</strong>ï¼š</p><p>å‡è®¾ä½ æ­£åœ¨è¿›è¡Œä¸€ä¸ªé¡¹ç›®ï¼Œå¹¶ä¸”ç»å¸¸éœ€è¦å¯åŠ¨ REPL æ¥åšä¸€äº›é¡¹ç›®ç›¸å…³çš„è®¡ç®—ã€‚ä½ å¸Œæœ›è¿™ä¸ªé¡¹ç›®çš„ REPL å†å²èƒ½å•ç‹¬ä¿å­˜ï¼Œå¥½å’Œå…¶ä»–é¡¹ç›®åŒºåˆ†å¼€ã€‚ä½ å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤æ“ä½œï¼š</p><ul><li><p>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ç”¨äºä¿å­˜è¯¥é¡¹ç›®çš„ REPL å†å²ï¼Œæ¯”å¦‚ <code>/myproject/repl_history.txt</code>ã€‚</p></li><li><p>æ¯æ¬¡å¯åŠ¨ REPL ä¹‹å‰ï¼Œå…ˆè®¾ç½®ç¯å¢ƒå˜é‡ <code>NODE_REPL_HISTORY</code> æŒ‡å‘è¯¥æ–‡ä»¶ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NODE_REPL_HISTORY</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myproject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">repl_history</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">txt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>è¿™æ ·ï¼Œæ­¤é¡¹ç›®çš„ REPL å†å²å°±ä¼šè¢«ä¿å­˜åœ¨ <code>/myproject/repl_history.txt</code> æ–‡ä»¶ä¸­ï¼Œè€Œä¸ä¼šå½±å“åˆ°å…¶ä»–é¡¹ç›®æˆ–å…¨å±€çš„ REPL å†å²ã€‚</p></li><li><p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p><ul><li>é€‰æ‹©çš„æ–‡ä»¶è·¯å¾„éœ€è¦ç¡®ä¿æœ‰æ­£ç¡®çš„è¯»å†™æƒé™ã€‚</li><li>å¦‚æœæŒ‡å®šçš„æ–‡ä»¶ä¸å­˜åœ¨ï¼ŒNode.js å°†å°è¯•åˆ›å»ºå®ƒã€‚</li><li>å¦‚æœç¯å¢ƒå˜é‡æœªè®¾ç½®æˆ–è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²ï¼ŒNode.js å°†ä½¿ç”¨é»˜è®¤çš„å†å²æ–‡ä»¶ä½ç½®ã€‚</li></ul></li></ol><p>é€šè¿‡ä¸Šè¿°æ–¹å¼ï¼Œ<code>NODE_REPL_HISTORY=file</code> çš„æœºåˆ¶å…è®¸å¼€å‘è€…æ›´çµæ´»åœ°ç®¡ç† REPL çš„å†å²è®°å½•ï¼Œé€‚åº”ä¸åŒé¡¹ç›®æˆ–ä¸ªäººåå¥½çš„éœ€æ±‚ã€‚</p><h3 id="node-skip-platform-check-value" tabindex="-1"><a class="header-anchor" href="#node-skip-platform-check-value"><span><a href="https://nodejs.org/docs/latest/api/cli.html#node_skip_platform_checkvalue" target="_blank" rel="noopener noreferrer">NODE_SKIP_PLATFORM_CHECK=value</a></span></a></h3><p><code>NODE_SKIP_PLATFORM_CHECK</code> æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œåœ¨ Node.js ä¸­ç”¨æ¥æ§åˆ¶æ˜¯å¦è¦æ£€æŸ¥äºŒè¿›åˆ¶æ’ä»¶ï¼ˆæ¯”å¦‚é‚£äº›ä½¿ç”¨ node-gyp ç¼–è¯‘çš„ native addon æ¨¡å—ï¼‰æ˜¯å¦ä¸å½“å‰ Node.js ç‰ˆæœ¬å…¼å®¹ã€‚</p><p>é€šå¸¸è€Œè¨€ï¼Œå½“ä½ åœ¨ Node.js ç¨‹åºä¸­å¯¼å…¥ä¸€ä¸ªåŒ…å«åŸç”Ÿä»£ç çš„æ¨¡å—æ—¶ï¼ŒNode.js ä¼šæ£€æŸ¥è¿™ä¸ªæ¨¡å—æ˜¯å¦æ˜¯é’ˆå¯¹å½“å‰è¿è¡Œçš„ Node.js ç‰ˆæœ¬ç¼–è¯‘çš„ã€‚å¦‚æœä¸æ˜¯ï¼Œå¯èƒ½ä¼šå‡ºç°å…¼å®¹æ€§é—®é¢˜ï¼Œå¯¼è‡´ç¨‹åºæ— æ³•æ­£å¸¸è¿è¡Œã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼ŒNode.js å°†é˜»æ­¢åŠ è½½ä¸å…¼å®¹çš„æ¨¡å—ï¼Œå¹¶æŠ›å‡ºé”™è¯¯ã€‚</p><p>æœ‰æ—¶å€™ï¼Œå¼€å‘è€…å¯èƒ½éœ€è¦ç»•è¿‡è¿™ä¸ªæ£€æŸ¥ï¼Œå°¤å…¶æ˜¯åœ¨ä»–ä»¬ç¡®ä¿¡å³ä½¿æ²¡æœ‰é’ˆå¯¹å½“å‰ç‰ˆæœ¬ç¼–è¯‘ï¼Œæ¨¡å—ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œçš„æƒ…å†µä¸‹ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥è®¾ç½® <code>NODE_SKIP_PLATFORM_CHECK</code> ç¯å¢ƒå˜é‡ã€‚</p><p>ä½¿ç”¨æ–¹æ³•éå¸¸ç®€å•ï¼Œé€šè¿‡åœ¨å¯åŠ¨ Node.js ä¹‹å‰è®¾ç½®ç¯å¢ƒå˜é‡ä¸º <code>1</code> æ¥è·³è¿‡å¹³å°æ£€æŸ¥ã€‚</p><p>åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šè®¾ç½®ç¯å¢ƒå˜é‡çš„å‘½ä»¤å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼š</p><ul><li><p>åœ¨ Unix-like ç³»ç»Ÿï¼ˆå¦‚ Linux æˆ– macOSï¼‰ä¸Šï¼Œä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ <code>export</code> å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NODE_SKIP_PLATFORM_CHECK</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your_script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åœ¨ Windows ä¸Šï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>set</code> å‘½ä»¤ï¼š</p><div class="language-cmd line-numbers-mode" data-highlighter="shiki" data-ext="cmd" data-title="cmd" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>set NODE_SKIP_PLATFORM_CHECK=1</span></span>
<span class="line"><span>node your_script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>å®é™…è¿ç”¨ä¾‹å­ï¼š</p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªé¡¹ç›®ä¾èµ–äºä¸€ä¸ªåä¸º <code>awesome-native-module</code> çš„ Node.js åŸç”Ÿæ¨¡å—ã€‚è¿™ä¸ªæ¨¡å—æœ€åä¸€æ¬¡ç¼–è¯‘æ˜¯é’ˆå¯¹ Node.js v20.0.0ï¼Œè€Œä½ å½“å‰å®‰è£…çš„ Node.js ç‰ˆæœ¬æ˜¯ v21.7.1ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ä½ è¯•å›¾åœ¨ä½ çš„ä»£ç ä¸­ <code>require(&#39;awesome-native-module&#39;)</code> æ—¶ï¼ŒNode.js ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå› ä¸ºå®ƒä¼šæ£€æµ‹åˆ°æ¨¡å—æ²¡æœ‰é’ˆå¯¹å½“å‰ç‰ˆæœ¬ç¼–è¯‘ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœä½ ä»ç¤¾åŒºå¾—åˆ°æ¶ˆæ¯è¯´è¿™ä¸ªæ¨¡å—è™½ç„¶æ²¡æœ‰é’ˆå¯¹ v21.7.1 å®˜æ–¹ç¼–è¯‘ï¼Œä½†å®æµ‹åœ¨è¿™ä¸ªç‰ˆæœ¬ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œï¼Œä½ å°±å¯ä»¥å†³å®šè·³è¿‡å¹³å°æ£€æŸ¥ï¼Œä»¥ä¾¿èƒ½å¤Ÿåœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨è¯¥æ¨¡å—ã€‚</p><p>è¿™æ—¶ä½ å¯ä»¥åœ¨å¯åŠ¨ä½ çš„ Node.js åº”ç”¨ç¨‹åºå‰è®¾ç½® <code>NODE_SKIP_PLATFORM_CHECK=1</code>ï¼Œä¾‹å¦‚ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## åœ¨ Linux æˆ– macOS ä¸Š</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NODE_SKIP_PLATFORM_CHECK</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> index.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-cmd line-numbers-mode" data-highlighter="shiki" data-ext="cmd" data-title="cmd" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>:: åœ¨ Windows ä¸Š</span></span>
<span class="line"><span>set NODE_SKIP_PLATFORM_CHECK=1</span></span>
<span class="line"><span>node index.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ä¸€æ¥ï¼Œå½“ä½ çš„åº”ç”¨ç¨‹åºæ‰§è¡Œå¹¶åŠ è½½ <code>awesome-native-module</code> æ—¶ï¼ŒNode.js å°†ä¸ä¼šè¿›è¡Œå¹³å°å…¼å®¹æ€§æ£€æŸ¥ï¼Œä»è€Œå…è®¸ç¨‹åºç»§ç»­è¿è¡Œã€‚ä¸è¿‡è¦æ³¨æ„ï¼Œè¿™ç§åšæ³•é™„å¸¦ç€é£é™©ï¼Œå› ä¸ºå¦‚æœæ¨¡å—ç¡®å®ä¸æ–°ç‰ˆæœ¬ä¸å…¼å®¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸å¯é¢„çŸ¥çš„è¡Œä¸ºç”šè‡³ç¨‹åºå´©æºƒã€‚</p><h3 id="node-test-context-value" tabindex="-1"><a class="header-anchor" href="#node-test-context-value"><span><a href="https://nodejs.org/docs/latest/api/cli.html#node_test_contextvalue" target="_blank" rel="noopener noreferrer">NODE_TEST_CONTEXT=value</a></span></a></h3><p><code>NODE_TEST_CONTEXT</code>æ˜¯ Node.js çš„ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨äºåœ¨ Node.js çš„å†…éƒ¨æµ‹è¯•ä¸­è®¾ç½®ç‰¹å®šç¯å¢ƒå‚æ•°ã€‚å¯¹äºå¤§å¤šæ•°å¼€å‘è€…æ¥è¯´ï¼Œäº†è§£è¿™ä¸ªç¯å¢ƒå˜é‡å¹¶ä¸æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºå®ƒä¸»è¦æ˜¯ Node.js å†…éƒ¨å¼€å‘å’Œè°ƒè¯•æ—¶ä½¿ç”¨ã€‚å¦‚æœä½ ä¸æ˜¯æ­£åœ¨ç ”ç©¶æˆ–å‚ä¸ Node.js æ ¸å¿ƒåº“çš„å¼€å‘ï¼Œé‚£ä¹ˆä½ å¯èƒ½æ°¸è¿œéƒ½ä¸éœ€è¦ç›´æ¥ä½¿ç”¨è¿™ä¸ªç¯å¢ƒå˜é‡ã€‚</p><p>ç„¶è€Œï¼Œä¸ºäº†è§£é‡Šå…¶ä½œç”¨ï¼Œè®©æˆ‘ä»¬é¦–å…ˆç†è§£ä»€ä¹ˆæ˜¯ç¯å¢ƒå˜é‡ã€‚ç¯å¢ƒå˜é‡æ˜¯åœ¨æ“ä½œç³»ç»Ÿçº§åˆ«ä¸Šå®šä¹‰çš„å˜é‡ï¼Œå¯ä»¥å½±å“ç¨‹åºçš„è¡Œä¸ºã€‚åœ¨ Node.js ä¸­ï¼Œç¯å¢ƒå˜é‡å¸¸ç”¨äºæ§åˆ¶åº”ç”¨ç¨‹åºçš„é…ç½®ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€ç«¯å£å·ç­‰ã€‚</p><p><code>NODE_TEST_CONTEXT=value</code>è¿™ç§æ ¼å¼è¡¨æ˜æˆ‘ä»¬è®¾ç½®äº†åä¸º<code>NODE_TEST_CONTEXT</code>çš„ç¯å¢ƒå˜é‡ï¼Œå¹¶ç»™å®ƒèµ‹äºˆäº†ä¸€ä¸ªå€¼<code>value</code>ã€‚è¿™é‡Œçš„<code>value</code>é€šå¸¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒä¼šå½±å“ Node.js è¿è¡Œæµ‹è¯•æ—¶çš„ä¸€äº›è¡Œä¸ºã€‚</p><p>å¦‚æœä½ æ˜¯ç¼–ç¨‹æ–°æ‰‹ï¼Œä¸¾ä¾‹è¯´æ˜å¯èƒ½æ¯”è¾ƒå›°éš¾ï¼Œå› ä¸ºè¿™ä¸ªç‰¹å®šçš„ç¯å¢ƒå˜é‡æ¶‰åŠåˆ° Node.js å†…éƒ¨çš„æµ‹è¯•æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯ç”¨æ¥æ£€æŸ¥ Node.js è‡ªèº«ä»£ç æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œçš„ä¸€ç§æ–¹å¼ï¼Œè€Œä¸æ˜¯ç”¨åœ¨å¼€å‘æ™®é€šåº”ç”¨ç¨‹åºæ—¶ã€‚</p><p>ä»¥ä¸€ä¸ªéå¸¸ç®€åŒ–çš„ç±»æ¯”æ¥è¯´ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå­¦æ ¡ï¼Œå­¦æ ¡æƒ³è¦æµ‹è¯•ä»–ä»¬çš„å¹¿æ’­ç³»ç»Ÿæ˜¯å¦æ­£å¸¸å·¥ä½œã€‚ä¸ºæ­¤ï¼Œå­¦æ ¡ç®¡ç†å‘˜å¯èƒ½ä¼šä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„å¼€å…³ï¼ˆåœ¨è¿™é‡Œï¼Œç›¸å½“äº<code>NODE_TEST_CONTEXT</code>ç¯å¢ƒå˜é‡ï¼‰ï¼Œç„¶åæ ¹æ®å¼€å…³çš„ä½ç½®ï¼ˆä¹Ÿå°±æ˜¯<code>value</code>ï¼‰ï¼Œå¹¿æ’­ç³»ç»Ÿä¼šåœ¨ä¸åŒçš„æ¨¡å¼ä¸‹å·¥ä½œï¼ˆä¾‹å¦‚ï¼Œæµ‹è¯•éŸ³é‡ã€æµ‹è¯•æ¸…æ™°åº¦ç­‰ï¼‰ã€‚ä½†æ˜¯ï¼Œå­¦ç”Ÿå’Œè€å¸ˆå¹¶ä¸éœ€è¦å…³å¿ƒè¿™ä¸ªå¼€å…³ï¼Œå› ä¸ºå®ƒåªå’Œå¹¿æ’­ç³»ç»Ÿçš„å†…éƒ¨æµ‹è¯•ç›¸å…³ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>NODE_TEST_CONTEXT</code>æ˜¯ä¸€ä¸ªé’ˆå¯¹ Node.js å†…éƒ¨æµ‹è¯•ç”¨çš„ç¯å¢ƒå˜é‡ã€‚å¯¹äºæ™®é€šåº”ç”¨ç¨‹åºå¼€å‘è€Œè¨€ï¼Œä½ ä¸éœ€è¦æ‹…å¿ƒæˆ–ä½¿ç”¨è¿™ä¸ªå˜é‡ã€‚ä½œä¸ºæ–°æ‰‹ï¼Œä½ åº”è¯¥æ›´å¤šåœ°å…³æ³¨å…¶ä»–åŸºç¡€çŸ¥è¯†ï¼Œä¾‹å¦‚ JavaScript è¯­æ³•ã€Node.js æ¨¡å—ç³»ç»Ÿã€å¼‚æ­¥ç¼–ç¨‹å’Œç½‘ç»œç¼–ç¨‹ç­‰ã€‚</p><h3 id="node-tls-reject-unauthorized-value" tabindex="-1"><a class="header-anchor" href="#node-tls-reject-unauthorized-value"><span><a href="https://nodejs.org/docs/latest/api/cli.html#node_tls_reject_unauthorizedvalue" target="_blank" rel="noopener noreferrer">NODE_TLS_REJECT_UNAUTHORIZED=value</a></span></a></h3><p><code>NODE_TLS_REJECT_UNAUTHORIZED=value</code> æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨äºæ§åˆ¶ Node.js åº”ç”¨ç¨‹åºå¦‚ä½•å¤„ç† TLSï¼ˆä¼ è¾“å±‚å®‰å…¨æ€§ï¼‰/ SSLï¼ˆå®‰å…¨å¥—æ¥å±‚ï¼‰è¯ä¹¦ã€‚åœ¨ç½‘ç»œé€šä¿¡ä¸­ï¼ŒTLS/SSL ç”¨äºç¡®ä¿å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®ä¼ è¾“æ˜¯åŠ å¯†å’Œå®‰å…¨çš„ã€‚</p><h3 id="å€¼è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#å€¼è§£é‡Š"><span>å€¼è§£é‡Šï¼š</span></a></h3><p>è¿™ä¸ªç¯å¢ƒå˜é‡çš„å€¼å¯ä»¥è®¾ç½®ä¸ºä»¥ä¸‹ä¸¤ä¸ªé€‰é¡¹ä¹‹ä¸€ï¼š</p><ul><li><code>0</code>ï¼šå½“è®¾ç½®ä¸º <code>0</code> æ—¶ï¼ŒNode.js å°†ä¸ä¼šæ‹’ç»ä»»ä½•æ— æ•ˆæˆ–è‡ªç­¾åçš„è¯ä¹¦ã€‚è¿™æ„å‘³ç€å³ä½¿è¯ä¹¦æœ‰é—®é¢˜ï¼ŒNode.js ä¹Ÿä¼šç»§ç»­æ‰§è¡Œè¯·æ±‚å¹¶å¿½ç•¥å®‰å…¨è­¦å‘Šã€‚</li><li><code>1</code>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šå¦‚æœè®¾ç½®ä¸º <code>1</code> æˆ–æœªè®¾ç½®æ­¤ç¯å¢ƒå˜é‡ï¼ŒNode.js å°†ä¼šéªŒè¯æœåŠ¡å™¨çš„ TLS/SSL è¯ä¹¦ã€‚å¦‚æœè¯ä¹¦æ— æ•ˆã€è¿‡æœŸã€è‡ªç­¾åã€æˆ–è€…ä¸è¢«ä¿¡ä»»ï¼Œé‚£ä¹ˆ Node.js å°†ä¼šæ‹’ç»è¿æ¥å¹¶æŠ›å‡ºé”™è¯¯ã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹"><span>ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹ï¼š</span></a></h3><ol><li><p><strong>å¼€å‘ç¯å¢ƒæµ‹è¯•</strong>ï¼š<br> åœ¨å¼€å‘é˜¶æ®µï¼Œä½ å¯èƒ½ä½¿ç”¨è‡ªç­¾åè¯ä¹¦æ¥æ¨¡æ‹Ÿ HTTPS è¿æ¥ï¼Œå› ä¸ºé¢å‘æœºæ„çš„è¯ä¹¦å¯èƒ½å¾ˆè´µæˆ–è€…ä¸æ–¹ä¾¿è·å–ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ <code>NODE_TLS_REJECT_UNAUTHORIZED=0</code> æ¥å‘Šè¯‰ä½ çš„ Node.js åº”ç”¨å¿½ç•¥è¯ä¹¦éªŒè¯ï¼Œè®©ä½ çš„æµ‹è¯•æ›´åŠ é¡ºç•…ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨è¿è¡Œåº”ç”¨ä¹‹å‰è®¾ç½®ç¯å¢ƒå˜é‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">NODE_TLS_REJECT_UNAUTHORIZED</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘èµ·ä¸€ä¸ªåˆ°è‡ªç­¾å HTTPS æœåŠ¡å™¨çš„è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://localhost:8000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;çŠ¶æ€ç :&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">statusCode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç”Ÿäº§ç¯å¢ƒ</strong>ï¼š<br> åœ¨ç”Ÿäº§ç¯å¢ƒï¼Œå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä½ åº”è¯¥å§‹ç»ˆå…è®¸ Node.js éªŒè¯ TLS/SSL è¯ä¹¦ã€‚è¿™æ„å‘³ç€ä¸è¦è®¾ç½® <code>NODE_TLS_REJECT_UNAUTHORIZED</code> ç¯å¢ƒå˜é‡ä¸º <code>0</code>ï¼Œæˆ–è€…ç¡®ä¿å®ƒçš„å€¼ä¸º <code>1</code>ã€‚</p><p>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œå› ä¸ºå…¶é»˜è®¤å€¼æä¾›äº†é€‚å½“çš„å®‰å…¨çº§åˆ«ã€‚</p></li></ol><h3 id="æ³¨æ„äº‹é¡¹-7" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-7"><span>æ³¨æ„äº‹é¡¹ï¼š</span></a></h3><p>å°† <code>NODE_TLS_REJECT_UNAUTHORIZED</code> è®¾ç½®ä¸º <code>0</code> å¯èƒ½ä¼šå¯¼è‡´ä¸¥é‡çš„å®‰å…¨éšæ‚£ï¼Œå› ä¸ºå®ƒå…è®¸ Node.js æ¥å—æ‰€æœ‰è¯ä¹¦ï¼ŒåŒ…æ‹¬é‚£äº›å¯èƒ½ç”±æ”»å‡»è€…ä¼ªé€ çš„ã€‚æ‰€ä»¥ï¼Œé™¤éæ˜¯åœ¨å®‰å…¨çš„å¼€å‘ç¯å¢ƒä¸­ä¸”å®Œå…¨æ¸…æ¥šåæœï¼Œå¦åˆ™ä¸å»ºè®®è¿™æ ·åšã€‚</p><p>å¸Œæœ›è¿™æ ·çš„è§£é‡Šèƒ½å¤Ÿå¸®åŠ©ä½ ç†è§£ <code>NODE_TLS_REJECT_UNAUTHORIZED</code> è¿™ä¸ªç¯å¢ƒå˜é‡çš„ä½œç”¨ï¼Œä»¥åŠåœ¨å®é™…å¼€å‘ä¸­å¦‚ä½•æ­£ç¡®åœ°ä½¿ç”¨å®ƒã€‚</p><h3 id="node-v8-coverage-dir" tabindex="-1"><a class="header-anchor" href="#node-v8-coverage-dir"><span><a href="https://nodejs.org/docs/latest/api/cli.html#node_v8_coveragedir" target="_blank" rel="noopener noreferrer">NODE_V8_COVERAGE=dir</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œ<code>NODE_V8_COVERAGE</code> æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨äºç”Ÿæˆå…³äºä½ çš„ JavaScript ä»£ç æ‰§è¡Œæƒ…å†µçš„è¦†ç›–ç‡æŠ¥å‘Šã€‚</p><p>å½“ä½ è®¾ç½®äº†è¿™ä¸ªç¯å¢ƒå˜é‡å¹¶è¿è¡Œä½ çš„ Node.js åº”ç”¨ç¨‹åºæ—¶ï¼ŒV8 å¼•æ“ï¼ˆè¿™æ˜¯ Node.js ä½¿ç”¨çš„ JavaScript å¼•æ“ï¼‰ä¼šè®°å½•å“ªäº›ä»£ç å·²ç»è¢«æ‰§è¡Œï¼Œå“ªäº›ä»£ç æ²¡æœ‰è¢«æ‰§è¡Œã€‚è¿™ä¸ªä¿¡æ¯å¯¹äºæµ‹è¯•å’Œä¼˜åŒ–ä½ çš„ä»£ç éå¸¸æœ‰ä»·å€¼ï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©ä½ ç¡®å®šå“ªäº›éƒ¨åˆ†çš„ä»£ç æ²¡æœ‰è¢«æµ‹è¯•åˆ°æˆ–è€…æ ¹æœ¬å°±æ²¡æœ‰è¿è¡Œè¿‡ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œ<code>NODE_V8_COVERAGE=dir</code> è¿™ä¸ªç¯å¢ƒå˜é‡è®¾ç½®äº†è¾“å‡ºè¦†ç›–ç‡æŠ¥å‘Šçš„ç›®å½•è·¯å¾„ã€‚è¿™é‡Œçš„ <code>dir</code> æ˜¯ä½ æƒ³è¦ä¿å­˜è¦†ç›–ç‡æ•°æ®æ–‡ä»¶çš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-1"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js çš„é¡¹ç›®ï¼Œå¹¶ä¸”ä½ æƒ³ç¡®ä¿ä½ çš„ä»£ç å°½å¯èƒ½å¤šåœ°è¢«æµ‹è¯•è¦†ç›–åˆ°ã€‚ä½ å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ä½¿ç”¨ <code>NODE_V8_COVERAGE</code>ï¼š</p><ol><li>åˆ›å»ºä¸€ä¸ªåä¸º <code>coverage</code> çš„ç›®å½•åœ¨ä½ çš„é¡¹ç›®ä¸­ï¼Œç”¨æ¥å­˜æ”¾è¦†ç›–ç‡æ•°æ®ã€‚</li><li>åœ¨å¯åŠ¨ä½ çš„ Node.js åº”ç”¨ä¹‹å‰ï¼Œé€šè¿‡å‘½ä»¤è¡Œè®¾ç½® <code>NODE_V8_COVERAGE</code> ç¯å¢ƒå˜é‡ï¼š<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NODE_V8_COVERAGE</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">./</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">coverage</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>æˆ–è€…åœ¨ Windows ç³»ç»Ÿä¸Š:<div class="language-cmd line-numbers-mode" data-highlighter="shiki" data-ext="cmd" data-title="cmd" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>set NODE_V8_COVERAGE=./coverage</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li>è¿è¡Œä½ çš„ Node.js åº”ç”¨ç¨‹åºï¼š<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li>æ‰§è¡Œä½ çš„æµ‹è¯•å¥—ä»¶ï¼Œè¿™æ ·å°±ä¼šè§¦å‘ä»£ç çš„æ‰§è¡Œã€‚</li><li>å®Œæˆåï¼Œä½ ä¼šåœ¨ <code>coverage</code> ç›®å½•ä¸‹æ‰¾åˆ°è¦†ç›–ç‡æ•°æ®æ–‡ä»¶ã€‚</li><li>ä½¿ç”¨å·¥å…·ï¼ˆå¦‚ <code>c8</code>ï¼‰æ¥ç”Ÿæˆæ˜“è¯»çš„è¦†ç›–ç‡æŠ¥å‘Šï¼š<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> c8</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> report</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><p>è¿™é‡Œçš„ <code>npx c8 report</code> å‘½ä»¤ä¼šè¯»å–è¦†ç›–ç‡æ•°æ®ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæŠ¥å‘Šï¼Œé€šå¸¸åŒ…å«æ¯ä¸ªæ–‡ä»¶çš„è¡Œè¦†ç›–ç‡ã€å‡½æ•°è¦†ç›–ç‡ã€åˆ†æ”¯è¦†ç›–ç‡ç­‰ä¿¡æ¯ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ äº†è§£å“ªäº›ä»£ç æ²¡æœ‰è¢«æµ‹è¯•åˆ°ï¼Œä»è€Œæ”¹è¿›ä½ çš„æµ‹è¯•æ¡ˆä¾‹ã€‚</p><h4 id="coverage-output" tabindex="-1"><a class="header-anchor" href="#coverage-output"><span><a href="https://nodejs.org/docs/latest/api/cli.html#coverage-output" target="_blank" rel="noopener noreferrer">Coverage output</a></span></a></h4><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹ Node.js ä¸­çš„ &quot;Coverage output&quot; æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-coverage-output" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-coverage-output"><span>ä»€ä¹ˆæ˜¯ Coverage outputï¼Ÿ</span></a></h3><p>åœ¨ç¼–ç¨‹ä¸­ï¼Œ&quot;coverage&quot; ï¼ˆä»£ç è¦†ç›–ç‡ï¼‰é€šå¸¸æŒ‡çš„æ˜¯å¯¹ä»£ç ä¸­å„ä¸ªéƒ¨åˆ†æ‰§è¡Œæµ‹è¯•çš„ç¨‹åº¦ã€‚ä¸€ä¸ªé«˜çš„ä»£ç è¦†ç›–ç‡ç™¾åˆ†æ¯”æ„å‘³ç€ä»£ç çš„å¤§éƒ¨åˆ†éƒ½ç»è¿‡äº†æµ‹è¯•ï¼Œè¿™é€šå¸¸å¯ä»¥å¢åŠ è½¯ä»¶è´¨é‡å’Œå¯é æ€§ã€‚</p><p>Node.js ä¸­çš„ &quot;Coverage output&quot; æŒ‡çš„æ˜¯å½“ä½ è¿è¡Œæµ‹è¯•æ—¶ï¼ŒNode.js èƒ½å¤Ÿç”Ÿæˆä¸€ä¸ªæŠ¥å‘Šæ¥æ˜¾ç¤ºå“ªäº›ä»£ç å·²ç»è¢«æµ‹è¯•äº†ï¼Œå“ªäº›æ²¡æœ‰ã€‚è¿™ä¸ªæŠ¥å‘Šå¯ä»¥å¸®åŠ©å¼€å‘è€…äº†è§£ä»–ä»¬å¯èƒ½éœ€è¦ç¼–å†™æ›´å¤šæµ‹è¯•çš„åœ°æ–¹ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-node-js-çš„-coverage-output" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-node-js-çš„-coverage-output"><span>å¦‚ä½•ä½¿ç”¨ Node.js çš„ Coverage outputï¼Ÿ</span></a></h3><p>åœ¨ Node.js ç‰ˆæœ¬ 21.7.1 ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨å†…ç½®çš„æµ‹è¯•è¦†ç›–ç‡å·¥å…·ã€‚è¦ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Šï¼Œä½ éœ€è¦åœ¨è¿è¡Œä½ çš„æµ‹è¯•è„šæœ¬æ—¶å¯ç”¨ Node.js çš„è¦†ç›–ç‡è·Ÿè¸ªã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªåä¸º <code>test-script.js</code> çš„æµ‹è¯•è„šæœ¬ï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥è¿è¡Œå®ƒï¼Œå¹¶ç”Ÿæˆè¦†ç›–ç‡è¾“å‡ºï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --coverage</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --coverage-directory=/path/to/coverage-directory</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œï¼Œ<code>--coverage</code> æ˜¯å‘Šè¯‰ Node.js å¼€å§‹è·Ÿè¸ªè¦†ç›–ç‡ä¿¡æ¯ï¼Œè€Œ <code>--coverage-directory</code> å‚æ•°æŒ‡å®šäº†è¦†ç›–ç‡æŠ¥å‘Šåº”è¯¥ä¿å­˜åˆ°å“ªä¸ªç›®å½•ã€‚</p><h3 id="å®é™…ä¾‹å­-8" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-8"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªç®€å•çš„ Node.js åº”ç”¨ç¨‹åºæ–‡ä»¶ <code>app.js</code> å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> subtract</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">exports</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">subtract</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> };</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åä½ æœ‰ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ <code>test.js</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> assert</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;assert&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">assert</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">strictEqual</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™å°†æ£€æŸ¥ add å‡½æ•°æ˜¯å¦åƒé¢„æœŸé‚£æ ·å·¥ä½œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ³¨æ„ï¼šæˆ‘ä»¬æ²¡æœ‰æµ‹è¯• subtract å‡½æ•°</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œå¦‚æœä½ æƒ³çœ‹çœ‹ <code>app.js</code> ä¸­çš„ä»£ç è¦†ç›–ç‡æƒ…å†µï¼Œä½ å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --coverage</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --coverage-directory=./coverage</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿è¡Œä¸Šè¿°å‘½ä»¤åï¼ŒNode.js ä¼šåœ¨ <code>./coverage</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªè¦†ç›–ç‡æŠ¥å‘Šã€‚è¿™ä¸ªæŠ¥å‘Šé€šå¸¸åŒ…å«å‡ ç§æ ¼å¼ï¼ŒåŒ…æ‹¬ HTMLã€‚æ‰“å¼€ HTML æŠ¥å‘Šï¼ˆä¸€èˆ¬æ˜¯ <code>index.html</code>ï¼‰ï¼Œä½ ä¼šçœ‹åˆ° <code>add</code> å‡½æ•°è¢«æµ‹è¯•äº†ï¼Œå› ä¸ºä½ åœ¨ <code>test.js</code> ä¸­è°ƒç”¨äº†å®ƒï¼Œä½† <code>subtract</code> å‡½æ•°æ²¡æœ‰è¢«æµ‹è¯•ã€‚è¿™ä¸ªæŠ¥å‘Šä¼šç»™å‡ºç±»ä¼¼äºä»£ç è¡Œã€å‡½æ•°å’Œåˆ†æ”¯è¦†ç›–ç‡çš„ç»†èŠ‚ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼ŒNode.js ä¸­çš„ &quot;Coverage output&quot; åŠŸèƒ½å°±æ˜¯ç”¨æ¥è¿½è¸ªå’ŒæŠ¥å‘Šä½ çš„ä»£ç æµ‹è¯•è¦†ç›–æƒ…å†µçš„ï¼Œä»¥æ­¤å¸®åŠ©ä½ ç¡®ä¿ä»£ç å°½å¯èƒ½å¤šåœ°è¢«è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–ã€‚</p><h4 id="source-map-cache" tabindex="-1"><a class="header-anchor" href="#source-map-cache"><span><a href="https://nodejs.org/docs/latest/api/cli.html#source-map-cache" target="_blank" rel="noopener noreferrer">Source map cache</a></span></a></h4><p>Node.js ä¸­çš„ &quot;Source map cache&quot; æ˜¯æŒ‡æºä»£ç æ˜ å°„æ–‡ä»¶ï¼ˆsource mapsï¼‰çš„ç¼“å­˜æœºåˆ¶ã€‚åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªåŠŸèƒ½å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ¥å£ (CLI) è¿›è¡Œé…ç½®ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç†è§£â€œæºä»£ç æ˜ å°„æ–‡ä»¶ï¼ˆsource mapsï¼‰â€æ˜¯ä»€ä¹ˆã€‚æºä»£ç æ˜ å°„æ–‡ä»¶æ˜¯ä¸€ç§ä½¿å¾—ç¼–è¯‘åçš„ä»£ç å¯ä»¥æ˜ å°„å›åŸå§‹æºä»£ç çš„æŠ€æœ¯ã€‚è¿™å¯¹äºè°ƒè¯•å‹ç¼©ã€æ··æ·†æˆ–è€…è½¬è¯‘ï¼ˆæ¯”å¦‚ TypeScript æˆ– Babel ç¼–è¯‘è¿‡çš„ JavaScriptï¼‰çš„ä»£ç éå¸¸æœ‰å¸®åŠ©ã€‚å½“ä½ åœ¨è°ƒè¯•å™¨ä¸­è®¾ç½®æ–­ç‚¹æˆ–è€…æŸ¥çœ‹å †æ ˆè·Ÿè¸ªæ—¶ï¼Œæºä»£ç æ˜ å°„å¯ä»¥å¸®åŠ©ä½ çœ‹åˆ°åŸå§‹çš„ã€äººç±»å¯è¯»çš„ä»£ç ï¼Œè€Œä¸æ˜¯è¿è¡Œæ—¶å®é™…æ‰§è¡Œçš„è½¬æ¢åçš„ä»£ç ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œå¯ç”¨æºä»£ç æ˜ å°„æ—¶ï¼Œå¼•æ“éœ€è¦è§£æå¹¶å¤„ç†è¿™äº›æ˜ å°„æ–‡ä»¶ã€‚å¦‚æœä½ çš„åº”ç”¨ç¨‹åºå¾ˆå¤§æˆ–è€…åŒ…å«å¤§é‡çš„æºä»£ç æ˜ å°„æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šæ¯”è¾ƒæ¶ˆè€—æ—¶é—´å’Œèµ„æºã€‚ä¸ºäº†ä¼˜åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼ŒNode.js æä¾›äº†ä¸€ä¸ªç¼“å­˜æœºåˆ¶ï¼Œå…è®¸å®ƒä¿å­˜è§£æåçš„æ˜ å°„ä¿¡æ¯ï¼Œä»è€Œåœ¨ä¸‹æ¬¡éœ€è¦ç›¸åŒæºä»£ç æ˜ å°„æ—¶åŠ å¿«åŠ è½½é€Ÿåº¦ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªä½¿ç”¨ TypeScript çš„ Node.js åº”ç”¨ç¨‹åºã€‚TypeScript ä»£ç ç»è¿‡ tsc å‘½ä»¤ç¼–è¯‘æˆ JavaScript ä»£ç åï¼Œä¼šç”Ÿæˆé…å¥—çš„ <code>.js.map</code> æ–‡ä»¶ï¼Œå³æºä»£ç æ˜ å°„æ–‡ä»¶ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>--enable-source-maps</code> æ ‡å¿—æ¥å¯åŠ¨ä½ çš„ Node.js åº”ç”¨ï¼Œä»¥ç¡®ä¿ Node.js èƒ½å¤Ÿåˆ©ç”¨è¿™äº›æºä»£ç æ˜ å°„æ–‡ä»¶è¿›è¡Œè°ƒè¯•ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --enable-source-maps</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœä½ å¸Œæœ›å¯ç”¨æºä»£ç æ˜ å°„ç¼“å­˜ï¼Œä»¥æé«˜é‡å¤ç¼–è¯‘æˆ–å¤šæ¬¡å¯åŠ¨åŒä¸€åº”ç”¨çš„æ•ˆç‡ï¼Œä½ å¯ä»¥å°† <code>NODE_V8_COVERAGE</code> ç¯å¢ƒå˜é‡æŒ‡å‘ä¸€ä¸ªç›®å½•ï¼ŒNode.js å°†ä¼šåœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºå’Œç»´æŠ¤æºä»£ç æ˜ å°„çš„ç¼“å­˜ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NODE_V8_COVERAGE</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">to</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">coverage-directory</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --enable-source-maps</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä½ å†æ¬¡è¿è¡Œä½ çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œå¦‚æœæºä»£ç æ˜ å°„æ–‡ä»¶æ²¡æœ‰æ”¹å˜ï¼ŒNode.js å°†ä¼šä½¿ç”¨ä¹‹å‰ç¼“å­˜çš„æºä»£ç æ˜ å°„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯é‡æ–°è§£æ <code>.js.map</code> æ–‡ä»¶ï¼Œä»è€ŒèŠ‚çº¦æ—¶é—´å’Œç³»ç»Ÿèµ„æºã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œæºä»£ç æ˜ å°„ç¼“å­˜æ˜¯ä¸€ä¸ªæ€§èƒ½ä¼˜åŒ–ç‰¹æ€§ï¼Œå®ƒé€šè¿‡ç¼“å­˜è§£æè¿‡çš„æºä»£ç æ˜ å°„ä¿¡æ¯ï¼Œå‡å°‘äº†é‡å¤å·¥ä½œï¼Œæé«˜äº†å¼€å‘å’Œè°ƒè¯•è¿‡ç¨‹ä¸­çš„æ•ˆç‡ã€‚</p><h3 id="openssl-conf-file" tabindex="-1"><a class="header-anchor" href="#openssl-conf-file"><span><a href="https://nodejs.org/docs/latest/api/cli.html#openssl_conffile" target="_blank" rel="noopener noreferrer">OPENSSL_CONF=file</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œæ—¶ï¼Œå…è®¸å¼€å‘è€…åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚å®ƒåŒ…å«äº†ä¸€ä¸ªå†…ç½®çš„åº“æ¥å¤„ç† HTTP è¯·æ±‚å’Œå“åº”ï¼Œæ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼Œä»¥åŠå…¶ä»–åç«¯åŠŸèƒ½ã€‚</p><p>Node.js ä½¿ç”¨ OpenSSL æ¥å¤„ç†ä¸åŠ å¯†ç›¸å…³çš„ä»»åŠ¡ï¼Œå¦‚å®‰å…¨åœ°ä¼ è¾“æ•°æ®ï¼ˆé€šè¿‡ HTTPSï¼‰ã€åŠ å¯†å­˜å‚¨çš„æ•°æ®ã€éªŒè¯æ•°æ®çš„å®Œæ•´æ€§ç­‰ã€‚OpenSSL æ˜¯ä¸€ä¸ªå¼ºå¤§çš„åŠ å¯†åº“ï¼Œæä¾›äº†å¤šç§åŠ å¯†ç®—æ³•å’Œåè®®ï¼Œç”¨äºç¡®ä¿ç½‘ç»œé€šä¿¡çš„å®‰å…¨ã€‚</p><p>å½“ä½ åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ Node.js æ—¶ï¼Œæœ‰æ—¶ä½ å¯èƒ½éœ€è¦æŒ‡å®šä¸€ä¸ªç‰¹å®šçš„ OpenSSL é…ç½®æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†ä¸€ç³»åˆ—çš„æŒ‡ä»¤å’Œé…ç½®ä¿¡æ¯ï¼Œå‘Šè¯‰ OpenSSL å¦‚ä½•æ‰§è¡Œå…¶ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯èƒ½å®šä¹‰äº†è¦ä½¿ç”¨çš„è¯ä¹¦ã€åŠ å¯†åå¥½ã€è·¯å¾„ç­‰ã€‚</p><p><code>OPENSSL_CONF=file</code> æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œä½ å¯ä»¥è®¾ç½®å®ƒæ¥æŒ‡å®š OpenSSL é…ç½®æ–‡ä»¶çš„ä½ç½®ã€‚åœ¨ Node.js v21.7.1 æ–‡æ¡£ä¸­æåˆ°çš„ <code>OPENSSL_CONF=file</code> å°±æ˜¯è¿™ä¸ªç›®çš„ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼š</p><ul><li><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦è‡ªç­¾åè¯ä¹¦çš„ HTTPS æœåŠ¡å™¨ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ª OpenSSL é…ç½®æ–‡ä»¶æ¥ç”Ÿæˆè¿™äº›è¯ä¹¦ã€‚ç„¶åå¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ <code>OPENSSL_CONF</code> æ¥è®© Node.js çŸ¥é“ä½ çš„è‡ªå®šä¹‰é…ç½®ã€‚</p></li><li><p>å¦‚æœä½ éœ€è¦åœ¨ä¸åŒçš„ç¯å¢ƒï¼ˆä¾‹å¦‚ï¼Œæœ¬åœ°å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒï¼‰ä¹‹é—´åˆ‡æ¢ä¸åŒçš„åŠ å¯†ç­–ç•¥æˆ–è¯ä¹¦é“¾ï¼Œä½ å¯ä»¥ä¸ºæ¯ä¸ªç¯å¢ƒå‡†å¤‡ä¸€ä¸ªä¸åŒçš„ OpenSSL é…ç½®æ–‡ä»¶ï¼Œå¹¶åœ¨å¯åŠ¨ Node.js åº”ç”¨ç¨‹åºæ—¶ç›¸åº”åœ°æ”¹å˜ <code>OPENSSL_CONF</code> ç¯å¢ƒå˜é‡çš„å€¼ã€‚</p></li></ul><p>å…·ä½“ä½¿ç”¨ç¤ºä¾‹ï¼š</p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ª OpenSSL é…ç½®æ–‡ä»¶å« <code>myapp_openssl.cnf</code>ï¼Œå¹¶ä¸”è¿™ä¸ªæ–‡ä»¶ä½äº <code>/etc/ssl/</code> ç›®å½•ä¸‹ã€‚</p><p>ä½ å¯ä»¥åœ¨ Unix-like ç³»ç»Ÿï¼ˆå¦‚ Linux æˆ– macOSï¼‰çš„ç»ˆç«¯ä¸­è¿™æ ·è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> OPENSSL_CONF</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">etc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ssl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">myapp_openssl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">cnf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æˆ–è€…åœ¨ Windows å‘½ä»¤æç¤ºç¬¦ä¸­è¿™æ ·è®¾ç½®ï¼š</p><div class="language-cmd line-numbers-mode" data-highlighter="shiki" data-ext="cmd" data-title="cmd" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>set OPENSSL_CONF=C:\path\to\your\myapp_openssl.cnf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è®¾ç½®è¯¥ç¯å¢ƒå˜é‡åï¼Œå½“ä½ è¿è¡Œ Node.js åº”ç”¨æ—¶ï¼Œå®ƒä¼šä½¿ç”¨æŒ‡å®šè·¯å¾„çš„ OpenSSL é…ç½®æ–‡ä»¶ã€‚è¿™å…è®¸ä½ æ§åˆ¶ OpenSSL çš„è¡Œä¸ºï¼Œè€Œæ— éœ€æ›´æ”¹ä»£ç ä¸­çš„é»˜è®¤é…ç½®ã€‚</p><p>è®°å¾—ï¼Œä¿®æ”¹ç¯å¢ƒå˜é‡è¦å°å¿ƒï¼Œå› ä¸ºå®ƒå¯èƒ½å½±å“æ‰€æœ‰ä¾èµ–äº OpenSSL çš„åº”ç”¨ç¨‹åºã€‚å§‹ç»ˆç¡®ä¿ä½ ç†è§£é…ç½®æ–‡ä»¶ä¸­çš„å„é¡¹è®¾ç½®ï¼Œå¹¶ä¸”åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡Œå……åˆ†çš„æµ‹è¯•ã€‚</p><h3 id="ssl-cert-dir-dir" tabindex="-1"><a class="header-anchor" href="#ssl-cert-dir-dir"><span><a href="https://nodejs.org/docs/latest/api/cli.html#ssl_cert_dirdir" target="_blank" rel="noopener noreferrer">SSL_CERT_DIR=dir</a></span></a></h3><p>å¥½çš„ï¼Œæˆ‘ä»¬æ¥èŠèŠ Node.js ä¸­çš„<code>SSL_CERT_DIR</code>è¿™ä¸ªç¯å¢ƒå˜é‡ã€‚é¦–å…ˆï¼Œä½ éœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯ SSL å’Œè¯ä¹¦ã€‚</p><h3 id="ssl-å’Œè¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#ssl-å’Œè¯ä¹¦"><span>SSL å’Œè¯ä¹¦</span></a></h3><p>SSLï¼ˆSecure Sockets Layerï¼‰æ˜¯ä¸€ç§å®‰å…¨åè®®ï¼Œå®ƒç”¨äºåœ¨äº’è”ç½‘ä¸Šçš„ä¸¤ä¸ªç«¯ç‚¹ä¹‹é—´å»ºç«‹åŠ å¯†é“¾æ¥ï¼Œç¡®ä¿æ•°æ®ä¼ è¾“çš„å®‰å…¨ã€‚å½“ä½ è®¿é—®ä¸€ä¸ªä»¥<code>https://</code>å¼€å¤´çš„ç½‘ç«™æ—¶ï¼Œå°±æ˜¯åœ¨ä½¿ç”¨ SSL/TLSï¼ˆTransport Layer Securityï¼ŒTLS æ˜¯ SSL çš„åç»§è€…ï¼‰ã€‚</p><p>ä¸ºäº†å»ºç«‹è¿™æ ·çš„å®‰å…¨è¿æ¥ï¼ŒæœåŠ¡å™¨éœ€è¦æœ‰ä¸€ä»½æ•°å­—è¯ä¹¦ã€‚è¿™ä¸ªè¯ä¹¦å¯ä»¥è¯æ˜è¯¥æœåŠ¡å™¨æ˜¯åˆæ³•çš„ï¼Œå¹¶éä¸€ä¸ªå†’å……è€…ã€‚æ•°å­—è¯ä¹¦é€šå¸¸ç”±è¯ä¹¦é¢å‘æœºæ„ï¼ˆCertificate Authority, CAï¼‰ç­¾å‘ï¼Œè€Œæ“ä½œç³»ç»Ÿå’Œæµè§ˆå™¨ä¼šå†…ç½®ä¸€æ‰¹å—ä¿¡ä»»çš„ CA åˆ—è¡¨ã€‚</p><h3 id="ç¯å¢ƒå˜é‡-ssl-cert-dir" tabindex="-1"><a class="header-anchor" href="#ç¯å¢ƒå˜é‡-ssl-cert-dir"><span>ç¯å¢ƒå˜é‡ <code>SSL_CERT_DIR</code></span></a></h3><p>åœ¨ Node.js åº”ç”¨ä¸­ï¼Œå¦‚æœä½ éœ€è¦ä¸å¤–éƒ¨æœåŠ¡è¿›è¡Œå®‰å…¨çš„ SSL/TLS é€šä¿¡ï¼ŒNode.js éœ€è¦çŸ¥é“å“ªäº› CA æ˜¯å¯ä¿¡çš„ï¼Œä»¥åŠä»–ä»¬çš„è¯ä¹¦åœ¨å“ªé‡Œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js ä¼šä½¿ç”¨å†…ç½®çš„ CA åˆ—è¡¨ï¼Œä½†æ˜¯æœ‰æ—¶å€™ä½ å¯èƒ½éœ€è¦æ·»åŠ é¢å¤–çš„è¯ä¹¦ï¼Œæˆ–è€…å®Œå…¨ä½¿ç”¨è‡ªå®šä¹‰çš„ CA è¯ä¹¦é›†ã€‚</p><p>è¿™æ—¶ï¼Œ<code>SSL_CERT_DIR</code>ç¯å¢ƒå˜é‡å°±æ´¾ä¸Šç”¨åœºäº†ã€‚é€šè¿‡è®¾ç½®è¿™ä¸ªå˜é‡ï¼Œä½ å¯ä»¥å‘Šè¯‰ Node.js å»å“ªä¸ªæ–‡ä»¶å¤¹é‡ŒæŸ¥æ‰¾ CA è¯ä¹¦ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªåä¸º<code>/etc/ssl/certs</code>çš„ç›®å½•ï¼Œé‡Œé¢å­˜æ”¾ç€æ‰€æœ‰éœ€è¦çš„ CA è¯ä¹¦æ–‡ä»¶ã€‚ä½ å¯ä»¥åœ¨å¯åŠ¨ Node.js åº”ç”¨ä¹‹å‰è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> SSL_CERT_DIR</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">etc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">ssl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">certs</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨ Unix-like ç³»ç»Ÿä¸­ï¼ˆæ¯”å¦‚ Linux æˆ– macOSï¼‰ï¼Œä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä¸Šè¿°å‘½ä»¤ã€‚åœ¨ Windows ç³»ç»Ÿä¸­ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡â€œç¯å¢ƒå˜é‡â€è®¾ç½®è¿™ä¸ªå€¼ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-5"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>ä¼ä¸šå†…éƒ¨ä½¿ç”¨</strong>: å‡è®¾ä½ åœ¨ä¸€ä¸ªä¼ä¸šå·¥ä½œï¼Œä¼ä¸šå†…éƒ¨æœ‰è‡ªå·±çš„ CA æ¥ç­¾å‘è¯ä¹¦ã€‚ä½ çš„ Node.js åº”ç”¨éœ€è¦ä¸ä¼ä¸šå†…å…¶ä»–ä½¿ç”¨è‡ªç­¾åè¯ä¹¦çš„æœåŠ¡é€šä¿¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¿…é¡»è®©ä½ çš„åº”ç”¨çŸ¥é“ä¼ä¸šè‡ªç­¾åçš„è¯ä¹¦åœ¨å“ªé‡Œã€‚ä½ å¯ä»¥è®¾ç½®<code>SSL_CERT_DIR</code>æŒ‡å‘åŒ…å«è¿™äº›è¯ä¹¦çš„ç›®å½•ã€‚</p></li><li><p><strong>å¼€å‘ä¸æµ‹è¯•</strong>: å½“ä½ åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­å·¥ä½œæ—¶ï¼Œå¯èƒ½ä¼šä½¿ç”¨è‡ªç­¾åçš„è¯ä¹¦æ¥æ¨¡æ‹Ÿ HTTPS æœåŠ¡ã€‚ä¸ºäº†é¿å… SSL/TLS é”™è¯¯ï¼Œä½ å¯ä»¥å°†<code>SSL_CERT_DIR</code>è®¾ç½®ä¸ºä½ çš„æœ¬åœ°è¯ä¹¦å­˜å‚¨ä½ç½®ã€‚</p></li><li><p><strong>ç‰¹å®šé¡¹ç›®éœ€æ±‚</strong>: å¦‚æœä½ æ­£åœ¨å¤„ç†ä¸€ä¸ª Node.js é¡¹ç›®ï¼Œè¯¥é¡¹ç›®éœ€è¦ä¸å¤šä¸ªä½¿ç”¨ä¸åŒ CA ç­¾å‘çš„ HTTPS æœåŠ¡é€šä¿¡ï¼Œæœ‰äº›è¯ä¹¦å¯èƒ½ä¸åœ¨é»˜è®¤çš„ CA åˆ—è¡¨å†…ã€‚æ­¤æ—¶ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªåŒ…å«è¿™äº›ç‰¹æ®Šè¯ä¹¦çš„ç›®å½•ï¼Œå¹¶é€šè¿‡<code>SSL_CERT_DIR</code>æŒ‡å‘å®ƒã€‚</p></li></ol><p>è®°ä½ï¼Œä½¿ç”¨<code>SSL_CERT_DIR</code>è¦ç¡®ä¿æŒ‡å‘çš„ç›®å½•ä¸­åŒ…å«æ ¼å¼æ­£ç¡®ã€æœ‰æ•ˆçš„ CA è¯ä¹¦æ–‡ä»¶ï¼Œå¦åˆ™ä½ çš„ Node.js åº”ç”¨å¯èƒ½æ— æ³•æˆåŠŸå»ºç«‹å®‰å…¨çš„ SSL/TLS è¿æ¥ã€‚</p><h3 id="ssl-cert-file-file" tabindex="-1"><a class="header-anchor" href="#ssl-cert-file-file"><span><a href="https://nodejs.org/docs/latest/api/cli.html#ssl_cert_filefile" target="_blank" rel="noopener noreferrer">SSL_CERT_FILE=file</a></span></a></h3><p><code>SSL_CERT_FILE=file</code> æ˜¯ Node.js ç¯å¢ƒä¸­çš„ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼Œå®ƒå…è®¸ä½ æŒ‡å®šä¸€ä¸ªåŒ…å«ä¸€ç³»åˆ—å¯ä¿¡ä»» SSL è¯ä¹¦çš„æ–‡ä»¶ã€‚è¿™ä¸ªåŠŸèƒ½åœ¨ Node.js åº”ç”¨ç¨‹åºéœ€è¦ä¸ä½¿ç”¨ SSLï¼ˆå®‰å…¨å¥—æ¥å­—å±‚ï¼‰æˆ– TLSï¼ˆä¼ è¾“å±‚å®‰å…¨ï¼‰åŠ å¯†çš„å¤–éƒ¨æœåŠ¡è¿›è¡Œå®‰å…¨é€šä¿¡æ—¶å°¤å…¶æœ‰ç”¨ã€‚</p><p>é¦–å…ˆï¼Œäº†è§£ SSL å’Œ TLS æ˜¯ä»€ä¹ˆå¾ˆé‡è¦ã€‚SSL å’Œ TLS éƒ½æ˜¯ä¸ºç½‘ç»œé€šä¿¡æä¾›å®‰å…¨å’Œæ•°æ®åŠ å¯†çš„æ ‡å‡†æŠ€æœ¯ã€‚å½“ä½ çš„æµè§ˆå™¨è¿æ¥åˆ°ä¸€ä¸ªä½¿ç”¨ HTTPS çš„ç½‘ç«™æ—¶ï¼Œè¯¥ç½‘ç«™å°±æ˜¯ä½¿ç”¨ SSL/TLS æ¥ä¿æŠ¤ä½ å’Œç½‘ç«™ä¹‹é—´çš„æ•°æ®äº¤æ¢ã€‚</p><p>ç°åœ¨æ¥è¯´è¯´è¯ä¹¦ã€‚SSL/TLS è¯ä¹¦æ˜¯ç”±è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ç­¾å‘çš„ï¼Œç”¨äºéªŒè¯æœåŠ¡å™¨çš„èº«ä»½ã€‚å½“å®¢æˆ·ç«¯ï¼ˆå¦‚æµè§ˆå™¨æˆ– Node.js åº”ç”¨ç¨‹åºï¼‰è¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæä¾›å…¶ SSL/TLS è¯ä¹¦ã€‚å®¢æˆ·ç«¯å°†æ£€æŸ¥æ­¤è¯ä¹¦æ˜¯å¦ç”±å—ä¿¡ä»»çš„ CA ç­¾å‘ï¼Œä»¥åŠè¯ä¹¦æ˜¯å¦æœ‰æ•ˆã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js å†…ç½®äº†ä¸€ç»„å—ä¿¡ä»»çš„ CA è¯ä¹¦åˆ—è¡¨ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦æ‰©å±•è¿™ä¸ªåˆ—è¡¨ï¼Œæ¯”å¦‚ï¼š</p><ol><li>å½“ä½ åœ¨ä¸€ä¸ªç‰¹æ®Šçš„ç¯å¢ƒä¸‹å·¥ä½œï¼Œæ¯”å¦‚ä¼ä¸šå†…éƒ¨ç½‘ç»œï¼Œé‚£é‡Œå¯èƒ½æœ‰è‡ªå·±çš„ç§æœ‰ CAã€‚</li><li>å½“ä½ éœ€è¦è¿æ¥åˆ°çš„æœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯è‡ªç­¾åè¯ä¹¦ã€‚</li><li>å½“é»˜è®¤åˆ—è¡¨ä¸­æ²¡æœ‰åŒ…å«ä½ éœ€è¦ä¿¡ä»»çš„ CAã€‚</li></ol><p>åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œ<code>SSL_CERT_FILE=file</code>å‚æ•°å°±å˜å¾—éå¸¸æœ‰ç”¨äº†ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰å¿…è¦å…¬å…± CA å’Œ/æˆ–ç§æœ‰ CA è¯ä¹¦çš„æ–‡ä»¶ï¼Œå¹¶ç”¨è¿™ä¸ªå‚æ•°å‘Šè¯‰ Node.js ç¨‹åºåœ¨å»ºç«‹ SSL/TLS è¿æ¥æ—¶ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªè‡ªå®šä¹‰çš„è¯ä¹¦æ–‡ä»¶<code>my_custom_certs.pem</code>ï¼Œå¯ä»¥åœ¨å¯åŠ¨ Node.js ç¨‹åºæ—¶é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡çš„æ–¹å¼æ¥ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">SSL_CERT_FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">my_custom_certs.pem</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your_node_app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¦‚æœä½ æ­£åœ¨ Windows æ“ä½œç³»ç»Ÿä¸Šå·¥ä½œï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> SSL_CERT_FILE=my_custom_certs.pem</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your_node_app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>å®é™…è¿ç”¨ä¾‹å­ï¼š</p><ol><li><p><strong>è¿æ¥åˆ°ä¼ä¸šå†…éƒ¨æœåŠ¡</strong>ï¼šä½ çš„ Node.js åº”ç”¨éœ€è¦è¿æ¥åˆ°åªæ¥å—å…¬å¸å†…éƒ¨ CA ç­¾åçš„ HTTPS æœåŠ¡ï¼Œä½ å¯ä»¥æŠŠä½ çš„å…¬å¸ CA è¯ä¹¦æ·»åŠ åˆ°ä¸€ä¸ª PEM æ–‡ä»¶ä¸­ï¼Œå¹¶ä½¿ç”¨<code>SSL_CERT_FILE</code>æ¥ç¡®ä¿ä½ çš„åº”ç”¨èƒ½å¤ŸæˆåŠŸå»ºç«‹å®‰å…¨è¿æ¥ã€‚</p></li><li><p><strong>å¼€å‘ç¯å¢ƒæµ‹è¯•</strong>ï¼šåœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­ï¼Œä½ å¯èƒ½ä½¿ç”¨è‡ªç­¾åè¯ä¹¦æ¥æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒä¸­çš„ HTTPS è®¾ç½®ã€‚ä½ å¯ä»¥å°†è‡ªç­¾åè¯ä¹¦æ”¾å…¥ä¸€ä¸ªæ–‡ä»¶ä¸­å¹¶é€šè¿‡<code>SSL_CERT_FILE</code>å‚æ•°æ¥ç¡®ä¿ä½ çš„å¼€å‘ç¯å¢ƒçš„ Node.js åº”ç”¨èƒ½å¤Ÿæ¥å—è¿™ä¸ªè¯ä¹¦ã€‚</p></li></ol><p>è®°ä½ï¼Œå°†è‡ªç­¾åè¯ä¹¦æˆ–ä¸å—ä¿¡ä»»çš„ CA è¯ä¹¦æ·»åŠ åˆ°ä½ çš„ä¿¡ä»»åˆ—è¡¨ä¸­ä¼šé™ä½å®‰å…¨æ€§ï¼Œå› æ­¤è°¨æ…æ“ä½œï¼Œå¹¶ç¡®ä¿è¿™æ ·åšæ˜¯åœ¨ä¸€ä¸ªå®‰å…¨çš„ç¯å¢ƒä¸‹è¿›è¡Œï¼Œå¹¶ä¸”ä½ çŸ¥é“æ‰€æ¶‰åŠçš„é£é™©ã€‚</p><h3 id="tz" tabindex="-1"><a class="header-anchor" href="#tz"><span><a href="https://nodejs.org/docs/latest/api/cli.html#tz" target="_blank" rel="noopener noreferrer">TZ</a></span></a></h3><p>Node.js ä¸­çš„ <code>TZ</code> ç¯å¢ƒå˜é‡æ˜¯ç”¨æ¥è®¾ç½®ç¨‹åºè¿è¡Œæ—¶æ‰€é‡‡ç”¨çš„æ—¶åŒºã€‚å½“æˆ‘ä»¬åœ¨ç¼–ç¨‹æ—¶å¤„ç†æ—¥æœŸå’Œæ—¶é—´ç›¸å…³çš„åŠŸèƒ½ï¼Œé€šå¸¸éœ€è¦è€ƒè™‘åˆ°æ—¶åŒºé—®é¢˜ã€‚ä¸åŒåœ°åŒºçš„æ—¶é—´å¯èƒ½ç›¸å·®å‡ ä¸ªå°æ—¶ç”šè‡³æ›´å¤šï¼Œè¿™å¯¹äºéœ€è¦å±•ç¤ºæœ¬åœ°åŒ–æ—¶é—´æˆ–è€…è¿›è¡Œæ—¶é—´è®¡ç®—çš„åº”ç”¨æ¥è¯´éå¸¸é‡è¦ã€‚</p><p>åœ¨ Node.js v21.7.1 çš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œ<code>TZ</code> æ˜¯ä½œä¸ºä¸€ä¸ªç¯å¢ƒå˜é‡æåŠçš„ã€‚ä½ å¯ä»¥åœ¨å¯åŠ¨ Node.js ç¨‹åºä¹‹å‰è®¾ç½®è¿™ä¸ªå˜é‡ï¼Œä»¥ç¡®ä¿ä½ çš„ç¨‹åºèƒ½å¤ŸæŒ‰ç…§ç‰¹å®šçš„æ—¶åŒºæ¥å¤„ç†æ—¶é—´ã€‚</p><h3 id="å®é™…ä¾‹å­-9" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-9"><span>å®é™…ä¾‹å­</span></a></h3><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªå…¨çƒæœåŠ¡çš„ç½‘ç«™åç«¯ï¼Œå¹¶éœ€è¦æ˜¾ç¤ºç”¨æˆ·çš„æœ¬åœ°æ—¶é—´ã€‚å¦‚æœæœåŠ¡å™¨ä½äºç¾å›½ä¸œéƒ¨ï¼ˆæ¯”å¦‚ä½¿ç”¨ä¸œéƒ¨æ—¶é—´ ESTï¼‰ï¼Œè€Œç”¨æˆ·åœ¨ä¸­å›½åŒ—äº¬ï¼ˆä½¿ç”¨ä¸­å›½æ ‡å‡†æ—¶é—´ CSTï¼‰ï¼Œç›´æ¥ä½¿ç”¨æœåŠ¡å™¨æ—¶é—´å°±ä¼šé€ æˆè¯¯è§£ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€äº›å¦‚ä½•ä½¿ç”¨ <code>TZ</code> ç¯å¢ƒå˜é‡çš„å…·ä½“æ­¥éª¤ï¼š</p><p><strong>è®¾ç½®æ—¶åŒºå¹¶è¿è¡Œåº”ç”¨</strong></p><p>åœ¨ Unix-like ç³»ç»Ÿï¼ˆå¦‚ macOS æˆ– Linuxï¼‰ä¸Šï¼Œä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¿™æ ·è®¾ç½®æ—¶åŒºï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">TZ</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;Asia/Shanghai&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨ Windows ç³»ç»Ÿä¸Šï¼Œä½ å¯ä»¥è¿™æ ·è®¾ç½®ï¼š</p><div class="language-cmd line-numbers-mode" data-highlighter="shiki" data-ext="cmd" data-title="cmd" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>set TZ=Asia/Shanghai</span></span>
<span class="line"><span>node app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œæ— è®ºæœåŠ¡å™¨å®é™…ä½äºä½•å¤„ï¼Œå½“ä½ åœ¨ä»£ç ä¸­åˆ›å»ºæ–°çš„ Date å¯¹è±¡æ—¶ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> now</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ˜¾ç¤ºçš„æ—¶é—´å°†æ˜¯ &#39;Asia/Shanghai&#39; æ—¶åŒºçš„æ—¶é—´ï¼Œè€Œä¸æ˜¯æœåŠ¡å™¨æœ¬åœ°æ—¶é—´ã€‚</p><p><strong>åœ¨ä»£ç ä¸­åŠ¨æ€è®¾ç½®</strong></p><p>ä½ ä¹Ÿå¯ä»¥åœ¨ Node.js ä»£ç ä¸­ç›´æ¥è®¾ç½® <code>process.env.TZ</code> ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">TZ</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Asia/Shanghai&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> now</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç ä¼šå°†æ—¶åŒºè®¾ç½®ä¸ºä¸Šæµ·æ—¶é—´ï¼Œå¹¶è¾“å‡ºå½“å‰çš„æœ¬åœ°æ—¶é—´ã€‚</p><p>è®°ä½ï¼Œä¸€æ—¦åœ¨ä»£ç ä¸­è®¾ç½®äº†æ—¶åŒºï¼Œè¿™ä¸ªè®¾ç½®å°†å½±å“è¯¥ Node.js è¿›ç¨‹çš„æ‰€æœ‰æ—¶é—´æ“ä½œã€‚è¿™æ˜¯å› ä¸º <code>TZ</code> ç¯å¢ƒå˜é‡ä¼šå½±å“ Node.js ä¸­æ—¶é—´ç›¸å…³å‡½æ•°çš„è¡Œä¸ºã€‚</p><h3 id="æ³¨æ„äº‹é¡¹-8" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-8"><span>æ³¨æ„äº‹é¡¹</span></a></h3><ul><li>è®¾ç½® <code>TZ</code> ç¯å¢ƒå˜é‡å¯¹äºè·¨æ—¶åŒºçš„åº”ç”¨å¾ˆæœ‰å¸®åŠ©ï¼Œä½†è®°å¾—æ—¶åŒºçš„è®¾ç½®ä»…å¯¹å½“å‰ Node.js è¿›ç¨‹æœ‰æ•ˆã€‚</li><li>å¦‚æœåº”ç”¨éœ€è¦å¤„ç†å¤šæ—¶åŒºï¼Œé‚£ä¹ˆå¯èƒ½éœ€è¦å…¶ä»–åº“ï¼Œæ¯”å¦‚ <code>moment-timezone</code>ï¼Œæ¥å¸®åŠ©ç®¡ç†ä¸åŒç”¨æˆ·çš„æ—¶åŒºé—®é¢˜ã€‚</li><li>è¦åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„æ—¶åŒºåç§°ï¼Œå¯ä»¥æŸ¥çœ‹ IANA æ—¶åŒºæ•°æ®åº“ï¼ˆäº’è”ç½‘æŒ‡æ´¾æ•°å­—æƒå¨æ•°æ®åº“ï¼‰ï¼Œè¿™æ˜¯å¤§å¤šæ•°æ“ä½œç³»ç»Ÿå’Œè¯­è¨€åº“ä½¿ç”¨çš„æ ‡å‡†æ¥æºã€‚</li></ul><h3 id="uv-threadpool-size-size" tabindex="-1"><a class="header-anchor" href="#uv-threadpool-size-size"><span><a href="https://nodejs.org/docs/latest/api/cli.html#uv_threadpool_sizesize" target="_blank" rel="noopener noreferrer">UV_THREADPOOL_SIZE=size</a></span></a></h3><p>å¥½çš„ï¼ŒNode.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ JavaScript ç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç ã€‚å…¶ä¸­ï¼Œ<code>UV_THREADPOOL_SIZE</code> æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨æ¥è®¾ç½® Node.js ä¸­ libuv åº“æä¾›çš„çº¿ç¨‹æ± çš„å¤§å°ã€‚</p><p>libuv æ˜¯ Node.js çš„æ ¸å¿ƒåº“ä¹‹ä¸€ï¼Œè´Ÿè´£æŠ½è±¡ä¸åŒæ“ä½œç³»ç»Ÿé—´çš„éé˜»å¡ I/O æ“ä½œã€‚ç®€å•åœ°è¯´ï¼Œå®ƒè®© Node.js å¯ä»¥å¼‚æ­¥åœ°å¤„ç†æ–‡ä»¶ç³»ç»Ÿæ“ä½œã€ç½‘ç»œè¯·æ±‚ç­‰ï¼Œè€Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± " tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± "><span>ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿ</span></a></h3><p>çº¿ç¨‹æ± æ˜¯ä¸€ç§çº¿ç¨‹ä½¿ç”¨æ¨¡å¼ï¼Œé¢„å…ˆåˆ›å»ºä¸€å®šæ•°é‡çš„çº¿ç¨‹å¹¶æ”¾åˆ°ä¸€ä¸ªæ± é‡Œï¼Œè¿™æ ·å°±å¯ä»¥åœ¨éœ€è¦è¿›è¡Œå¤šçº¿ç¨‹æ‰§è¡Œä»»åŠ¡æ—¶è¿…é€Ÿåœ°å€Ÿç”¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼Œé¿å…äº†é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹æ‰€å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚</p><h3 id="uv-threadpool-size-çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#uv-threadpool-size-çš„ä½œç”¨"><span><code>UV_THREADPOOL_SIZE</code> çš„ä½œç”¨</span></a></h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js çš„ libuv çº¿ç¨‹æ± å¤§å°æ˜¯ 4ã€‚è¿™æ„å‘³ç€æœ‰å››ä¸ªçº¿ç¨‹å¯ç”¨äºæ‰§è¡Œé‚£äº›è¢« offload åˆ°çº¿ç¨‹æ± çš„æ“ä½œï¼Œä¾‹å¦‚ï¼š</p><ul><li>æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆå¦‚è¯»å†™æ–‡ä»¶ï¼‰</li><li>DNS è§£æï¼ˆå¦‚æŸ¥æ‰¾åŸŸåå¯¹åº”çš„ IP åœ°å€ï¼‰</li></ul><p>å¦‚æœä½ çš„åº”ç”¨æ¶‰åŠå¤§é‡çš„æ–‡ä»¶æˆ–ç½‘ç»œ I/Oï¼Œå¹¶ä¸”ä½ è§‰å¾—æ€§èƒ½å—åˆ°çº¿ç¨‹æ± å¤§å°çš„é™åˆ¶ï¼Œä½ å¯ä»¥é€šè¿‡è®¾ç½® <code>UV_THREADPOOL_SIZE</code> ç¯å¢ƒå˜é‡æ¥å¢åŠ çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-2"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-è¯»å–å¤šä¸ªæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-è¯»å–å¤šä¸ªæ–‡ä»¶"><span>ä¾‹å­ 1ï¼šè¯»å–å¤šä¸ªæ–‡ä»¶</span></a></h4><p>å‡è®¾ä½ çš„ Node.js åº”ç”¨éœ€è¦åŒæ—¶è¯»å–å¤šä¸ªå¤§æ–‡ä»¶ï¼Œç”±äº I/O æ“ä½œé»˜è®¤æ˜¯é€šè¿‡ libuv çš„çº¿ç¨‹æ± æ¥å¤„ç†çš„ï¼Œå½“ä½ éœ€è¦åŒæ—¶è¯»å–è¶…è¿‡ 4 ä¸ªæ–‡ä»¶æ—¶ï¼Œé»˜è®¤çš„çº¿ç¨‹æ± å¤§å°å¯èƒ½å°±æˆäº†ç“¶é¢ˆã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥å°† <code>UV_THREADPOOL_SIZE</code> è®¾ç½®å¾—æ›´å¤§ä¸€äº›ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">UV_THREADPOOL_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">8</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤ä¼šå¯åŠ¨ä½ çš„ Node.js åº”ç”¨ï¼Œå¹¶ä¸” libuv çš„çº¿ç¨‹æ± ä¼šæœ‰ 8 ä¸ªçº¿ç¨‹å¯ä»¥ç”¨æ¥å¤„ç†æ–‡ä»¶è¯»å–ï¼Œä»è€Œæé«˜å¹¶å‘å¤„ç†çš„èƒ½åŠ›ã€‚</p><h4 id="ä¾‹å­-2-dns-æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-dns-æŸ¥è¯¢"><span>ä¾‹å­ 2ï¼šDNS æŸ¥è¯¢</span></a></h4><p>å‡è®¾ä½ çš„ Node.js åº”ç”¨éœ€è¦å¤„ç†å¤§é‡çš„ DNS æŸ¥è¯¢ï¼Œè‹¥è¦æ”¹å–„æ€§èƒ½ï¼Œä½ å¯ä»¥å¢åŠ çº¿ç¨‹æ± çš„å¤§å°ï¼š</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">UV_THREADPOOL_SIZE</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">10</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿è¡Œä¸Šé¢çš„å‘½ä»¤ï¼ŒDNS æŸ¥è¯¢ä¼šåˆ†å¸ƒåˆ° 10 ä¸ªçº¿ç¨‹ä¸Šå»æ‰§è¡Œï¼Œèƒ½å¤Ÿæ›´å¿«åœ°å®Œæˆå¤§é‡æŸ¥è¯¢ä»»åŠ¡ã€‚</p><h3 id="æ³¨æ„äº‹é¡¹-9" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-9"><span>æ³¨æ„äº‹é¡¹</span></a></h3><p>å½“ä½ è€ƒè™‘å¢åŠ  <code>UV_THREADPOOL_SIZE</code> çš„å€¼æ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¼‚æ­¥æ“ä½œéƒ½ä½¿ç”¨äº† libuv çº¿ç¨‹æ± ã€‚æ¯”å¦‚ï¼Œç½‘ç»œ I/Oï¼ˆåˆ›å»ºæœåŠ¡å™¨æˆ– socket è¿æ¥æ—¶ï¼‰é€šå¸¸æ˜¯ç›´æ¥ä½¿ç”¨ OS çš„å¼‚æ­¥æ¥å£çš„ï¼Œä¸ç»è¿‡çº¿ç¨‹æ± ã€‚</li><li>å¢åŠ çº¿ç¨‹æ± çš„å¤§å°å¯èƒ½ä¼šå¢åŠ å†…å­˜å ç”¨å’Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼Œç‰¹åˆ«æ˜¯å½“è®¾ç½®çš„å€¼å¾ˆå¤§æ—¶ã€‚</li><li>åœ¨æŸäº›ç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹æ± çš„å¤§å°å¯èƒ½å­˜åœ¨ä¸Šé™ã€‚</li></ul><p>æ‰€ä»¥ï¼Œåœ¨è°ƒæ•´ <code>UV_THREADPOOL_SIZE</code> æ—¶ï¼Œåº”è¯¥æ ¹æ®å®é™…åº”ç”¨çš„éœ€æ±‚å’Œç³»ç»Ÿèµ„æºæ¥é€‚åº¦è°ƒæ•´ã€‚</p><h3 id="uv-use-io-uring-value" tabindex="-1"><a class="header-anchor" href="#uv-use-io-uring-value"><span><a href="https://nodejs.org/docs/latest/api/cli.html#uv_use_io_uringvalue" target="_blank" rel="noopener noreferrer">UV_USE_IO_URING=value</a></span></a></h3><p>å½“ä½ åœ¨ç”µè„‘ä¸Šè¿è¡Œä¸€ä¸ªç¨‹åºæ—¶ï¼Œæ¯”å¦‚æµè§ˆç½‘é¡µæˆ–è€…ç¼–è¾‘æ–‡æ¡£ï¼Œè¿™ä¸ªç¨‹åºéœ€è¦å’Œç”µè„‘çš„å…¶ä»–éƒ¨åˆ†äº¤äº’ï¼Œç‰¹åˆ«æ˜¯å­˜å‚¨è®¾å¤‡ï¼ˆæ¯”å¦‚ç¡¬ç›˜ï¼‰å’Œç½‘ç»œã€‚ä¸ºäº†å®Œæˆè¿™ç§äº¤äº’ï¼Œç¨‹åºä¼šå‘é€ä¸€äº›å«åš I/O æ“ä½œçš„è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚å°±æ˜¯å‘Šè¯‰ç”µè„‘ï¼šâ€œå˜¿ï¼Œæˆ‘éœ€è¦è¯»å–è¿™ä¸ªæ–‡ä»¶çš„æ•°æ®â€æˆ–è€…â€œè¯·æŠŠè¿™äº›æ•°æ®å†™å…¥åˆ°ç½‘ç»œä¸­å»â€ã€‚</p><p>åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œæœ‰å¾ˆå¤šæ–¹æ³•æ¥å¤„ç†è¿™äº› I/O è¯·æ±‚ã€‚ä¼ ç»Ÿçš„æ–¹å¼ä¹‹ä¸€æ˜¯ä½¿ç”¨ä¸€ä¸ªå«åš<code>libuv</code>çš„åº“ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªé«˜æ•ˆçš„äº‹ä»¶é©±åŠ¨çš„æ¨¡å‹ï¼Œè®© Node.js å¯ä»¥éé˜»å¡åœ°æ‰§è¡Œ I/O æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ Node.js ä¸éœ€è¦ç­‰å¾…ä¸€ä¸ªæ“ä½œå®Œæˆæ‰èƒ½å¼€å§‹ä¸‹ä¸€ä¸ªæ“ä½œã€‚</p><p>æœ€è¿‘ï¼ŒLinux å¼•å…¥äº†ä¸€ç§æ–°çš„ I/O å¤„ç†æŠ€æœ¯å«ä½œ<code>io_uring</code>ã€‚<code>io_uring</code>æ˜¯ä¸€ç§æ›´åŠ ç°ä»£çš„æŠ€æœ¯ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæ›´é«˜æ•ˆã€æ›´ä½å»¶è¿Ÿçš„æ–¹å¼æ¥å¤„ç† I/O è¯·æ±‚ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>UV_USE_IO_URING</code>æ˜¯ä¸€ä¸ªå¯ä»¥è®¾ç½®çš„ç¯å¢ƒå˜é‡ï¼ˆEnvironment Variableï¼‰ï¼Œç”¨æ¥å‘Šè¯‰ Node.js æ˜¯å¦åº”è¯¥ä½¿ç”¨è¿™ä¸ªæ–°çš„<code>io_uring</code>æŠ€æœ¯æ¥å¤„ç† I/O æ“ä½œã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰å½“ä½ çš„ç³»ç»Ÿæ”¯æŒ<code>io_uring</code>æ—¶ï¼Œè®¾ç½®è¿™ä¸ªå˜é‡æ‰æœ‰æ„ä¹‰ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœä½ æƒ³è®© Node.js å°è¯•ä½¿ç”¨<code>io_uring</code>ï¼Œä½ å¯ä»¥åœ¨å¯åŠ¨ Node.js ç¨‹åºä¹‹å‰è®¾ç½®è¿™ä¸ªç¯å¢ƒå˜é‡ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">UV_USE_IO_URING</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">1</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> node</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your_script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å…¶ä¸­<code>1</code>è¡¨ç¤ºå¼€å¯<code>io_uring</code>ï¼Œå¦‚æœä½ ä¸æƒ³ä½¿ç”¨<code>io_uring</code>ï¼Œæˆ–è€…ä½ çš„ç³»ç»Ÿä¸æ”¯æŒï¼Œä½ å¯ä»¥å°†å€¼è®¾ç½®ä¸º<code>0</code>æˆ–è€…å®Œå…¨ä¸è®¾ç½®è¿™ä¸ªç¯å¢ƒå˜é‡ã€‚</p><h3 id="å®é™…ä¾‹å­-10" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-10"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js çš„ç½‘ç»œæœåŠ¡å™¨ï¼Œå®ƒéœ€è¦å¤„ç†å¤§é‡çš„ç½‘ç»œè¯·æ±‚ï¼Œå¹¶ä¸”åŒæ—¶è¯»å†™æ–‡ä»¶ã€‚åœ¨ä¼ ç»Ÿçš„<code>libuv</code>æ¨¡å¼ä¸‹ï¼ŒNode.js ä¼šä½¿ç”¨å…¶è‡ªå¸¦çš„æœºåˆ¶æ¥å¤„ç†æ‰€æœ‰è¿™äº›æ“ä½œï¼Œä½†å¯èƒ½ä¼šå› ä¸ºæ“ä½œç³»ç»Ÿåº•å±‚çš„é™åˆ¶è€Œä¸æ˜¯æœ€ä¼˜çš„æ€§èƒ½ã€‚</p><p>å¦‚æœä½ çš„æœåŠ¡å™¨è¿è¡Œåœ¨æ”¯æŒ<code>io_uring</code>çš„ Linux ç³»ç»Ÿä¸Šï¼Œé€šè¿‡è®¾ç½®<code>UV_USE_IO_URING=1</code>ï¼Œä½ çš„æœåŠ¡å™¨ç¨‹åºå¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–°æŠ€æœ¯æ¥æå‡å¤„ç† I/O æ“ä½œçš„æ•ˆç‡å’Œå“åº”é€Ÿåº¦ã€‚å¯¹äºé«˜è´Ÿè½½çš„ç”Ÿäº§ç¯å¢ƒï¼Œè¿™å¯èƒ½æ„å‘³ç€æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œæ›´é«˜çš„ååé‡ã€‚</p><p>ä¸è¿‡ï¼Œç”±äºè¿™æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°çš„æŠ€æœ¯ï¼Œå®ƒå¯èƒ½è¿˜æ²¡æœ‰è¢«å¹¿æ³›æµ‹è¯•å’Œä¼˜åŒ–ï¼Œæ‰€ä»¥åœ¨å°†å®ƒç”¨äºç”Ÿäº§ç¯å¢ƒä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œå……åˆ†çš„æµ‹è¯•æ¥ç¡®ä¿å®ƒçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚</p><h2 id="useful-v8-options" tabindex="-1"><a class="header-anchor" href="#useful-v8-options"><span><a href="https://nodejs.org/docs/latest/api/cli.html#useful-v8-options" target="_blank" rel="noopener noreferrer">Useful V8 options</a></span></a></h2><p>Node.js æ˜¯å»ºç«‹åœ¨ Chrome V8 JavaScript å¼•æ“ä¸Šçš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚V8 å¼•æ“æ˜¯ Google å¼€å‘çš„ï¼Œä¹Ÿæ˜¯ Chrome æµè§ˆå™¨ä½¿ç”¨çš„ JavaScript å¼•æ“ã€‚è¿™ä¸ªå¼•æ“è´Ÿè´£è§£é‡Šå’Œæ‰§è¡Œ JavaScript ä»£ç ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæœ‰å¾ˆå¤šå¯ä»¥ä¼ é€’ç»™ V8 å¼•æ“çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼ˆç§°ä¸º &quot;V8 é€‰é¡¹&quot;ï¼‰ï¼Œç”¨æ¥æ§åˆ¶ JavaScript çš„æ‰§è¡Œæˆ–æ”¹å˜ V8 çš„è¡Œä¸ºã€‚è¿™äº›é€‰é¡¹å¯¹äºè°ƒè¯•ã€æ€§èƒ½ä¼˜åŒ–æˆ–ç‰¹å®šç‰¹æ€§çš„å¯ç”¨éå¸¸æœ‰ç”¨ã€‚</p><p>ä¸‹é¢æˆ‘ä¼šè§£é‡Šä¸€äº›å®ç”¨çš„ V8 é€‰é¡¹ï¼Œå¹¶é€šè¿‡å®ä¾‹è¯´æ˜å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨å®ƒä»¬ï¼š</p><h3 id="_1-max-old-space-size" tabindex="-1"><a class="header-anchor" href="#_1-max-old-space-size"><span>1. <code>--max-old-space-size</code></span></a></h3><p>è¿™ä¸ªé€‰é¡¹ç”¨äºé™åˆ¶è€ç”Ÿä»£å†…å­˜çš„æœ€å¤§å¤§å°ã€‚è€ç”Ÿä»£å†…å­˜ä¸»è¦ç”¨æ¥å­˜å‚¨é•¿æ—¶é—´å­˜åœ¨çš„å¯¹è±¡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå€¼å¯èƒ½ä¸è¶³ä»¥å¤„ç†å¤§å‹æ•°æ®é›†æˆ–å†…å­˜å¯†é›†å‹ä»»åŠ¡ã€‚å¦‚æœä½ çš„åº”ç”¨ç»å¸¸é‡åˆ°å†…å­˜ä¸è¶³çš„é”™è¯¯ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹æ¥å¢åŠ å¯ç”¨å†…å­˜ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³å°†å¯ç”¨äº Node.js åº”ç”¨ç¨‹åºçš„å†…å­˜é™åˆ¶è®¾ç½®ä¸º 4GBï¼Œä½ å¯ä»¥åœ¨è¿è¡Œ Node.js åº„å‹‡æ—¶åŒ…æ‹¬ä»¥ä¸‹å‘½ä»¤ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --max-old-space-size=4096</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-optimize-for-size" tabindex="-1"><a class="header-anchor" href="#_2-optimize-for-size"><span>2. <code>--optimize-for-size</code></span></a></h3><p>æœ‰æ—¶å€™ï¼Œåœ¨å†…å­˜å—é™çš„ç¯å¢ƒä¸­ï¼ˆæ¯”å¦‚å¾®å‹äº‘æœåŠ¡æˆ–ç‰©è”ç½‘è®¾å¤‡ï¼‰ï¼Œä½ å¸Œæœ› V8 å°½å¯èƒ½å°‘åœ°ä½¿ç”¨å†…å­˜ï¼Œå³ä½¿è¿™æ ·åšä¼šç‰ºç‰²ä¸€äº›æ€§èƒ½ã€‚<code>--optimize-for-size</code> é€‰é¡¹å°±æ˜¯ç”¨æ¥æŒ‡ç¤º V8 å°è¯•é™ä½å…¶å†…å­˜å ç”¨ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --optimize-for-size</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_3-trace-deprecation" tabindex="-1"><a class="header-anchor" href="#_3-trace-deprecation"><span>3. <code>--trace-deprecation</code></span></a></h3><p>æ­¤é€‰é¡¹ç”¨äºè·Ÿè¸ªå³å°†åºŸå¼ƒçš„ç‰¹æ€§çš„ä½¿ç”¨æƒ…å†µã€‚å½“ä½ çš„ä»£ç ä¸­ä½¿ç”¨äº†æ—§çš„æˆ–å³å°†è¢«å¼ƒç”¨çš„ API æ—¶ï¼ŒNode.js ä¼šè®°å½•ä¸€æ¡è­¦å‘Šä¿¡æ¯ã€‚è¿™å¯¹äºç»´æŠ¤å’Œå‡çº§é¡¹ç›®éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥æé†’ä½ éœ€è¦æ›¿æ¢æˆ–æ›´æ–°ç›¸å…³ä»£ç ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --trace-deprecation</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_4-prof" tabindex="-1"><a class="header-anchor" href="#_4-prof"><span>4. <code>--prof</code></span></a></h3><p>å¼€å‘è€…å¯èƒ½éœ€è¦å¯¹åº”ç”¨ç¨‹åºçš„æ€§èƒ½è¿›è¡Œåˆ†æï¼Œäº†è§£å“ªäº›å‡½æ•°è°ƒç”¨æœ€é¢‘ç¹æˆ–è€—æ—¶æœ€é•¿ã€‚<code>--prof</code> é€‰é¡¹ä¼šç”Ÿæˆ V8 çš„æ€§èƒ½åˆ†ææ–‡ä»¶ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥è¯¦ç»†äº†è§£ä½ çš„åº”ç”¨åœ¨è¿è¡Œæ—¶çš„æ€§èƒ½æƒ…å†µã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --prof</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶å¯ä»¥ç”¨ä¸“é—¨çš„å·¥å…·è¿›è¡Œåˆ†æï¼Œä»¥ä¾¿æ‰¾å‡ºæ€§èƒ½ç“¶é¢ˆã€‚</p><h3 id="_5-allow-natives-syntax" tabindex="-1"><a class="header-anchor" href="#_5-allow-natives-syntax"><span>5. <code>--allow-natives-syntax</code></span></a></h3><p>æ­¤é€‰é¡¹ä½¿å¾—ä½ å¯ä»¥åœ¨ä½ çš„ä»£ç ä¸­ç›´æ¥ä½¿ç”¨ V8 å¼•æ“çš„å†…éƒ¨å‡½æ•°ã€‚é€šå¸¸è¿™ä¸æ˜¯æ¨èçš„åšæ³•ï¼Œå› ä¸ºå®ƒæ¶‰åŠåˆ°å¼•æ“çš„å†…éƒ¨ç»†èŠ‚ï¼Œå¯èƒ½ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­æ”¹å˜ã€‚ä½†æ˜¯ï¼Œå¯¹äºé«˜çº§ç”¨æˆ·æ¥è¯´ï¼Œè¿™å¯ä»¥ç”¨äºæµ‹è¯•æˆ–æ·±å…¥ç†è§£ V8 çš„è¡Œä¸ºã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --allow-natives-syntax</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> your-script.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šä½¿ç”¨ V8 é€‰é¡¹æ—¶ï¼Œä½ åº”è¯¥çŸ¥é“å®ƒä»¬é€šå¸¸æ˜¯é’ˆå¯¹é«˜çº§åœºæ™¯çš„ï¼Œå¹³å¸¸å¼€å‘ä¸­å¯èƒ½ä¸ä¼šç»å¸¸ç”¨åˆ°ã€‚æ€»æ˜¯è¦ç¡®ä¿ä½ ç†è§£æ¯ä¸ªé€‰é¡¹çš„å½±å“ï¼Œå°¤å…¶æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œåº”ç”¨ç¨‹åºä¹‹å‰ã€‚è€Œä¸”ï¼ŒV8 çš„æŸäº›é€‰é¡¹åœ¨ä¸åŒçš„ Node.js ç‰ˆæœ¬é—´å¯èƒ½ä¼šæœ‰æ‰€æ›´æ”¹ï¼Œå§‹ç»ˆå‚è€ƒç‰¹å®š Node.js ç‰ˆæœ¬çš„æ–‡æ¡£æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚</p><h3 id="max-old-space-size-size-in-megabytes" tabindex="-1"><a class="header-anchor" href="#max-old-space-size-size-in-megabytes"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--max-old-space-sizesize-in-megabytes" target="_blank" rel="noopener noreferrer">--max-old-space-size=SIZE (in megabytes)</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘æ¥è¯¦ç»†ä¸ºä½ è§£é‡Šä¸€ä¸‹ Node.js ä¸­çš„ <code>--max-old-space-size=SIZE</code> è¿™ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ã€‚</p><p>é¦–å…ˆï¼ŒNode.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚åœ¨ Node.js ä¸­ï¼ŒV8 å¼•æ“è´Ÿè´£ç¼–è¯‘å’Œæ‰§è¡Œ JavaScript ä»£ç ï¼Œå¹¶ä¸”å®ƒç®¡ç†ç€å†…å­˜åˆ†é…å’Œåƒåœ¾å›æ”¶ç­‰ä»»åŠ¡ã€‚V8 å¼•æ“å°†å†…å­˜åˆ†æˆå‡ ä¸ªä¸åŒçš„åŒºåŸŸï¼Œè€Œå…¶ä¸­æœ€é‡è¦çš„ä¸¤å—æ˜¯â€œæ–°ç”Ÿä»£â€ï¼ˆNew Spaceï¼‰å’Œâ€œè€ç”Ÿä»£â€ï¼ˆOld Spaceï¼‰ã€‚</p><ul><li><strong>æ–°ç”Ÿä»£</strong>ï¼šè¿™å—å†…å­˜ç”¨äºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸçŸ­çš„å¯¹è±¡ã€‚ä¸€æ—¦è¿™äº›å¯¹è±¡ç»å†è¿‡åƒåœ¾å›æ”¶æœºåˆ¶åä»ç„¶å­˜åœ¨ï¼Œå®ƒä»¬å°±å¯èƒ½è¢«ç§»åŠ¨åˆ°è€ç”Ÿä»£ç©ºé—´ã€‚</li><li><strong>è€ç”Ÿä»£</strong>ï¼šè¿™å—å†…å­˜ç”¨äºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸé•¿æˆ–è€…ç»å¸¸è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚è¿™é‡Œé¢çš„å¯¹è±¡ä¸ä¼šé‚£ä¹ˆé¢‘ç¹åœ°è¿›è¡Œåƒåœ¾å›æ”¶ã€‚</li></ul><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js åˆ†é…ç»™è€ç”Ÿä»£çš„å†…å­˜å¤§å°æ˜¯æœ‰é™åˆ¶çš„ã€‚åœ¨ä¸åŒæ“ä½œç³»ç»Ÿå’Œ Node.js ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªé™åˆ¶å¯èƒ½ä¸åŒï¼Œä½†é€šå¸¸å¯¹äº 64 ä½ç³»ç»Ÿï¼Œé»˜è®¤çš„è€ç”Ÿä»£å¤§å°çº¦ä¸º 1.4GBã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œé»˜è®¤çš„å†…å­˜é™åˆ¶å¯èƒ½ä¸è¶³ä»¥åº”å¯¹ä½ çš„åº”ç”¨ç¨‹åºæ‰€éœ€å¤„ç†çš„æ•°æ®é‡ï¼Œè¿™æ—¶ä½ å°±éœ€è¦æ‰‹åŠ¨è°ƒæ•´å®ƒã€‚</p><p><code>--max-old-space-size=SIZE</code> æ˜¯ä¸€ä¸ªå¯åŠ¨ Node.js æ—¶å¯ä»¥ä½¿ç”¨çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œç”¨äºæŒ‡å®šè€ç”Ÿä»£å†…å­˜åŒºåŸŸçš„æœ€å¤§å¤§å°ã€‚è¿™ä¸ªå€¼æ˜¯ä»¥å…†å­—èŠ‚ï¼ˆMBï¼‰ä¸ºå•ä½çš„ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¿è¡Œä¸€ä¸ª Node.js åº”ç”¨å¹¶ä¸”è®¾ç½®è€ç”Ÿä»£å†…å­˜ä¸Šé™ä¸º 4GBï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --max-old-space-size=4096</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™é‡Œ <code>4096</code> å°±æ˜¯ä½ è®¾ç½®çš„è€ç”Ÿä»£å†…å­˜å¤§å°ï¼Œå•ä½æ˜¯ MBã€‚é€šè¿‡è¿™æ ·è®¾ç½®ï¼Œä½ çš„ Node.js åº”ç”¨å°±å¯ä»¥ä½¿ç”¨å¤šè¾¾ 4GB çš„å†…å­˜æ¥å­˜å‚¨è€ç”Ÿä»£å¯¹è±¡äº†ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-10" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-10"><span>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</span></a></h3><ol><li><p><strong>å¤„ç†å¤§å‹æ•°æ®é›†</strong>ï¼š<br> å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œå®ƒéœ€è¦å¤„ç†ä¸€äº›å¤§å‹ JSON æ–‡ä»¶ã€‚å½“æ–‡ä»¶éå¸¸å¤§æ—¶ï¼ˆæ¯”å¦‚å‡  GBï¼‰ï¼Œé»˜è®¤çš„å†…å­˜é™åˆ¶å¯èƒ½ä¼šå¯¼è‡´ä½ çš„åº”ç”¨å› ä¸ºå†…å­˜ä¸è¶³è€Œå´©æºƒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥å¢åŠ è€ç”Ÿä»£çš„å¤§å°æ¥ç¡®ä¿åº”ç”¨èƒ½å¤Ÿé¡ºåˆ©è¿è¡Œã€‚</p></li><li><p><strong>é«˜æ€§èƒ½è®¡ç®—ä»»åŠ¡</strong>ï¼š<br> å¦‚æœä½ çš„ Node.js åº”ç”¨æ¶‰åŠåˆ°é«˜æ€§èƒ½è®¡ç®—ï¼Œå¦‚å›¾å½¢æ¸²æŸ“ã€ç§‘å­¦æ¨¡æ‹Ÿæˆ–æ•°æ®åˆ†æç­‰ï¼Œè¿™äº›ä»»åŠ¡å¯èƒ½ä¼šäº§ç”Ÿå¤§é‡çš„æŒä¹…å¯¹è±¡ã€‚å¢åŠ è€ç”Ÿä»£å†…å­˜å¯ä»¥é¿å…é¢‘ç¹çš„åƒåœ¾å›æ”¶ï¼Œæå‡åº”ç”¨æ€§èƒ½ã€‚</p></li><li><p><strong>å¤§è§„æ¨¡ç½‘ç»œåº”ç”¨</strong>ï¼š<br> å¯¹äºä¸€äº›å¤§è§„æ¨¡çš„ç½‘ç»œåº”ç”¨ï¼Œæ¯”å¦‚æ¸¸æˆæœåŠ¡å™¨æˆ–ç¤¾äº¤åª’ä½“å¹³å°ï¼ŒæœåŠ¡å™¨éœ€è¦ç®¡ç†å¤§é‡ç”¨æˆ·çš„çŠ¶æ€å’Œæ•°æ®ã€‚éšç€ç”¨æˆ·æ•°é‡çš„å¢åŠ ï¼ŒæœåŠ¡å™¨ä¸Šçš„è€ç”Ÿä»£å¯¹è±¡ä¹Ÿä¼šå¢åŠ ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´å†…å­˜ä¸Šé™æ¥åº”å¯¹è¿™ç§å¢é•¿ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œ<code>--max-old-space-size=SIZE</code> å‚æ•°æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°æ§åˆ¶ Node.js åº”ç”¨çš„å†…å­˜ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œå®ƒä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå¢åŠ å†…å­˜ä¸Šé™å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨ä¸Šå…¶ä»–åº”ç”¨çš„å¯ç”¨å†…å­˜å‡å°‘ï¼Œç”šè‡³å½±å“æ•´ä½“çš„ç³»ç»Ÿæ€§èƒ½ï¼Œå› æ­¤éœ€è¦è°¨æ…ä½¿ç”¨ã€‚</p><h3 id="max-semi-space-size-size-in-megabytes" tabindex="-1"><a class="header-anchor" href="#max-semi-space-size-size-in-megabytes"><span><a href="https://nodejs.org/docs/latest/api/cli.html#--max-semi-space-sizesize-in-megabytes" target="_blank" rel="noopener noreferrer">--max-semi-space-size=SIZE (in megabytes)</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨ JavaScript æ¥ç¼–å†™å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œçš„ä»£ç ã€‚äº†è§£ Node.js çš„å†…å­˜ç®¡ç†æ˜¯ä¼˜åŒ–ä½ çš„åº”ç”¨æ€§èƒ½çš„å…³é”®ä¹‹ä¸€ã€‚</p><p>åœ¨ Node.js ä¸­ï¼ŒV8 å¼•æ“ä½¿ç”¨äº†ä¸€ç§å«åšã€Œåƒåœ¾å›æ”¶ã€çš„æœºåˆ¶æ¥è‡ªåŠ¨ç®¡ç†å†…å­˜ã€‚åƒåœ¾å›æ”¶ä¸»è¦è´Ÿè´£æ‰¾åˆ°é‚£äº›ä¸å†è¢«ç¨‹åºä½¿ç”¨çš„å†…å­˜ç©ºé—´ï¼Œå¹¶å°†å…¶é‡Šæ”¾æ‰ï¼Œä½¿å¾—è¿™éƒ¨åˆ†å†…å­˜å¯è¢«é‡æ–°åˆ©ç”¨ã€‚</p><p>V8 å®ç°åƒåœ¾å›æ”¶çš„æ–¹å¼ä¹‹ä¸€æ˜¯é€šè¿‡åˆ†ä»£å¼åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå®ƒä¸»è¦åŒ…å«ä¸¤ä¸ªä»£ï¼ˆæˆ–è€…è¯´åŒºåŸŸï¼‰ï¼šæ–°ç”Ÿä»£å’Œè€ç”Ÿä»£ã€‚æ–°ç”Ÿä»£å­˜æ”¾çš„æ˜¯é‚£äº›å­˜æ´»æ—¶é—´çŸ­çš„å¯¹è±¡ï¼Œè€Œè€ç”Ÿä»£å­˜æ”¾çš„æ˜¯å­˜æ´»æ—¶é—´é•¿çš„å¯¹è±¡ã€‚</p><h3 id="æ–°ç”Ÿä»£å†…å­˜çš„ç»„æˆ" tabindex="-1"><a class="header-anchor" href="#æ–°ç”Ÿä»£å†…å­˜çš„ç»„æˆ"><span>æ–°ç”Ÿä»£å†…å­˜çš„ç»„æˆ</span></a></h3><p>æ–°ç”Ÿä»£å†…å­˜ç”±ä¸¤ä¸ªç›¸åŒå¤§å°çš„ç©ºé—´ç»„æˆï¼Œåˆ†åˆ«å«åš <code>From</code> ç©ºé—´å’Œ <code>To</code> ç©ºé—´ã€‚è¿™ä¸¤ä¸ªç©ºé—´æœ‰æ—¶ä¹Ÿè¢«ç»Ÿç§°ä¸ºåŠç©ºé—´ï¼ˆSemi-spacesï¼‰ã€‚åœ¨ä»»ä½•æ—¶é—´ç‚¹ï¼Œåªæœ‰ä¸€ä¸ªåŠç©ºé—´è¢«ä½¿ç”¨ï¼Œå¦ä¸€ä¸ªå¤„äºé—²ç½®çŠ¶æ€ã€‚åƒåœ¾å›æ”¶å‘ç”Ÿæ—¶ï¼Œå¯¹è±¡ä¼šä»å½“å‰çš„ <code>From</code> ç©ºé—´å¤åˆ¶åˆ° <code>To</code> ç©ºé—´ï¼Œå¦‚æœå¯¹è±¡è¿˜æ´»ç€çš„è¯ã€‚</p><h3 id="max-semi-space-size-å‚æ•°" tabindex="-1"><a class="header-anchor" href="#max-semi-space-size-å‚æ•°"><span>--max-semi-space-size å‚æ•°</span></a></h3><p>è¯¥å‚æ•° <code>--max-semi-space-size</code> å…è®¸ä½ è®¾ç½®æ–°ç”Ÿä»£ä¸­æ¯ä¸ªåŠç©ºé—´ï¼ˆSemi-spaceï¼‰çš„æœ€å¤§å¤§å°ï¼Œå•ä½æ˜¯å…†å­—èŠ‚ï¼ˆMBï¼‰ã€‚è°ƒæ•´è¿™ä¸ªå€¼å¯ä»¥å¯¹ä½ çš„åº”ç”¨çš„å†…å­˜ä½¿ç”¨å’Œåƒåœ¾å›æ”¶æ€§èƒ½äº§ç”Ÿå½±å“ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒV8 ä¼šè‡ªåŠ¨è®¾ç½®è¿™ä¸ªå¤§å°ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ä½ çš„åº”ç”¨åˆ›å»ºäº†å¤§é‡çš„å°ç”Ÿå‘½å‘¨æœŸå¯¹è±¡ï¼Œä½ å¯èƒ½éœ€è¦è°ƒæ•´è¿™ä¸ªå€¼ã€‚</p><p>å®é™…è¿ç”¨ä¾‹å­ï¼š</p><ol><li><p><strong>ä½å†…å­˜ç¯å¢ƒ</strong>ï¼šå¦‚æœä½ çš„ Node.js åº”ç”¨è¿è¡Œåœ¨å†…å­˜å—é™çš„ç¯å¢ƒä¸­ï¼ˆä¾‹å¦‚å¾®å‹æœåŠ¡æˆ–å®¹å™¨ï¼‰ï¼Œä½ å¯èƒ½å¸Œæœ›å‡å°‘æ–°ç”Ÿä»£åŠç©ºé—´çš„å¤§å°ä»¥å‡å°‘å†…å­˜ä½¿ç”¨ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --max-semi-space-size=8</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä¸Šé¢å‘½ä»¤ä¸­ <code>8</code> æ˜¯æŒ‡æˆ‘ä»¬è®¾ç½®æ¯ä¸ªåŠç©ºé—´çš„å¤§å°ä¸º 8MBã€‚</p></li><li><p><strong>é«˜ååé‡åº”ç”¨</strong>ï¼šå¦‚æœä½ çš„åº”ç”¨éœ€è¦å¤„ç†å¤§é‡çš„å¿«é€Ÿç”Ÿæˆä¸”ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ï¼Œå¯èƒ½ä¼šé¢‘ç¹è§¦å‘åƒåœ¾å›æ”¶ï¼Œå½±å“æ€§èƒ½ã€‚å¢åŠ åŠç©ºé—´çš„å¤§å°å¯èƒ½ä¼šæé«˜æ•ˆç‡ã€‚</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --max-semi-space-size=32</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.js</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æŠŠæ¯ä¸ªåŠç©ºé—´çš„å¤§å°å¢åŠ åˆ°äº† 32MBã€‚</p></li></ol><p>è®°ä½ï¼Œåœ¨è°ƒæ•´è¿™ä¸ªå‚æ•°æ—¶ï¼Œåº”è¯¥è°¨æ…è¿›è¡Œï¼Œå¹¶æ ¹æ®åº”ç”¨çš„å…·ä½“éœ€æ±‚å’Œè¡Œä¸ºä»¥åŠå¯ç”¨çš„ç³»ç»Ÿèµ„æºæ¥å†³å®šåˆé€‚çš„å¤§å°ã€‚è°ƒæ•´è¿™ä¸ªå€¼å¯èƒ½éœ€è¦è¿›è¡Œä¸€äº›æ€§èƒ½æµ‹è¯•æ¥è§‚å¯Ÿå†…å­˜ä½¿ç”¨å’Œåƒåœ¾å›æ”¶è¡Œä¸ºçš„å˜åŒ–ã€‚</p></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: kamiacgxu@gmail.com">kamishima-kaede</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/document/node-doc/Cluster.html" aria-label="Cluster"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Cluster</div></a><a class="route-link auto-link next" href="/document/node-doc/Console.html" aria-label="Console"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Console<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright Â© 2018-present hanekawa-shiki</div></footer></div><!--]--><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.e98858ae.js" defer></script><script src="/assets/js/9435.209d772b.js" defer></script><script src="/assets/js/app.604dc302.js" defer></script>
  </body>
</html>
