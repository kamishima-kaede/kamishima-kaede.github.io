<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.50" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://hanekawa.top/document/node-doc/Stream.html"><meta property="og:site_name" content="hanekawa-shiki"><meta property="og:title" content="Stream"><meta property="og:description" content="Stream Node.js ä¸­çš„ Streamï¼ˆæµï¼‰æ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œè®©æˆ‘ä»¬èƒ½ä»¥æŒç»­çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚æƒ³è±¡ä¸€ä¸‹æ°´ä»æ°´é¾™å¤´æµåˆ°æ°´æ§½çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªæµåŠ¨çš„è¿‡ç¨‹å°±åƒæ˜¯ Node.js ä¸­å¤„ç†æ•°æ®çš„â€œæµâ€ã€‚ä½¿ç”¨ Streamï¼Œä½ å¯ä»¥è¯»å–æˆ–å†™å…¥æ•°æ®ç‰‡æ®µè€Œä¸å¿…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®åˆ°å†…å­˜ä¸­ï¼Œè¿™åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–å®æ—¶æ•°æ®æ—¶éå¸¸æœ‰æ•ˆã€‚ Stream çš„ç±»å‹ Readab..."><meta property="og:type" content="website"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-06-21T09:46:17.000Z"><meta property="article:author" content="hanekawa-shiki"><meta property="article:modified_time" content="2024-06-21T09:46:17.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"WebPage","name":"Stream","description":"Stream Node.js ä¸­çš„ Streamï¼ˆæµï¼‰æ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œè®©æˆ‘ä»¬èƒ½ä»¥æŒç»­çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚æƒ³è±¡ä¸€ä¸‹æ°´ä»æ°´é¾™å¤´æµåˆ°æ°´æ§½çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªæµåŠ¨çš„è¿‡ç¨‹å°±åƒæ˜¯ Node.js ä¸­å¤„ç†æ•°æ®çš„â€œæµâ€ã€‚ä½¿ç”¨ Streamï¼Œä½ å¯ä»¥è¯»å–æˆ–å†™å…¥æ•°æ®ç‰‡æ®µè€Œä¸å¿…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®åˆ°å†…å­˜ä¸­ï¼Œè¿™åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–å®æ—¶æ•°æ®æ—¶éå¸¸æœ‰æ•ˆã€‚ Stream çš„ç±»å‹ Readab..."}</script><meta name="keywords" content="JavaScript,HTML,CSS"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icons/chrome-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icons/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icons/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#5c92d1"><link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="white"><meta name="msapplication-TileImage" content="/assets/icons/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><title>Stream | hanekawa-shiki</title><meta name="description" content="Stream Node.js ä¸­çš„ Streamï¼ˆæµï¼‰æ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œè®©æˆ‘ä»¬èƒ½ä»¥æŒç»­çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚æƒ³è±¡ä¸€ä¸‹æ°´ä»æ°´é¾™å¤´æµåˆ°æ°´æ§½çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªæµåŠ¨çš„è¿‡ç¨‹å°±åƒæ˜¯ Node.js ä¸­å¤„ç†æ•°æ®çš„â€œæµâ€ã€‚ä½¿ç”¨ Streamï¼Œä½ å¯ä»¥è¯»å–æˆ–å†™å…¥æ•°æ®ç‰‡æ®µè€Œä¸å¿…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®åˆ°å†…å­˜ä¸­ï¼Œè¿™åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–å®æ—¶æ•°æ®æ—¶éå¸¸æœ‰æ•ˆã€‚ Stream çš„ç±»å‹ Readab...">
    <link rel="stylesheet" href="/assets/css/styles.b040cee0.css">
    <link rel="preload" href="/assets/js/runtime~app.28bb228f.js" as="script"><link rel="preload" href="/assets/css/styles.b040cee0.css" as="style"><link rel="preload" href="/assets/js/6679.86a2b270.js" as="script"><link rel="preload" href="/assets/js/app.de91e5da.js" as="script">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo light" src="/assets/svg/logo.svg" alt><img class="vp-nav-logo dark" src="/assets/svg/logo.svg" alt><span class="vp-site-name hide-in-pad">hanekawa-shiki</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="åšå®¢ä¸»é¡µ"><!--[--><span class="font-icon icon home" style=""></span><!--]-->åšå®¢ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="å­¦ä¹ ç¬”è®°"><!--[--><span class="font-icon icon framework" style=""></span>å­¦ä¹ ç¬”è®°<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">å‰ç«¯æ¡†æ¶</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/vue3/" aria-label="Vue3ç¬”è®°"><!--[--><span class="font-icon icon vue" style=""></span><!--]-->Vue3ç¬”è®°<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/framework_front/react/" aria-label="Reactç¬”è®°"><!--[--><span class="font-icon icon react" style=""></span><!--]-->Reactç¬”è®°<!----></a></li></ul></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ–‡æ¡£"><!--[--><span class="font-icon icon framework" style=""></span>æ–‡æ¡£<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">æ¬è¿</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link route-link-active auto-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li></ul></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/hanekawa-shiki/hanekawa-shiki.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/" aria-label="Node.jsæ–‡æ¡£"><!--[--><span class="font-icon icon circle-info" style=""></span><!--]-->Node.jsæ–‡æ¡£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Assert.html" aria-label="Assert"><!---->Assert<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Async%20hooks.html" aria-label="Async hooks"><!---->Async hooks<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Asynchronous%20context%20tracking.html" aria-label="Asynchronous context tracking"><!---->Asynchronous context tracking<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Buffer.html" aria-label="Buffer"><!---->Buffer<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20addons.html" aria-label="C++ addons"><!---->C++ addons<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/C__%20embedder%20API.html" aria-label="C++ embedder API"><!---->C++ embedder API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Child%20process.html" aria-label="Child process"><!---->Child process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Cluster.html" aria-label="Cluster"><!---->Cluster<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Command-line%20API.html" aria-label="Command-line API"><!---->Command-line API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Console.html" aria-label="Console"><!---->Console<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Corepack.html" aria-label="Corepack"><!---->Corepack<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Crypto.html" aria-label="Crypto"><!---->Crypto<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Debugger.html" aria-label="Debugger"><!---->Debugger<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Deprecated%20APIs.html" aria-label="Deprecated APIs"><!---->Deprecated APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostic%20report.html" aria-label="Diagnostic report"><!---->Diagnostic report<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Diagnostics%20Channel.html" aria-label="Diagnostics Channel"><!---->Diagnostics Channel<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/DNS.html" aria-label="DNS"><!---->DNS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Domain.html" aria-label="Domain"><!---->Domain<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Errors.html" aria-label="Errors"><!---->Errors<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Events.html" aria-label="Events"><!---->Events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/File%20system.html" aria-label="File system"><!---->File system<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Global%20objects.html" aria-label="Global objects"><!---->Global objects<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTP.html" aria-label="HTTP"><!---->HTTP<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/HTTPS.html" aria-label="HTTPS"><!---->HTTPS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Inspector.html" aria-label="Inspector"><!---->Inspector<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Internationalization%20support.html" aria-label="Internationalization support"><!---->Internationalization support<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-CommonJS%20modules.html" aria-label="Modules: CommonJS modules"><!---->Modules: CommonJS modules<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-ECMAScript%20modules.html" aria-label="Modules: ECMAScript modules"><!---->Modules: ECMAScript modules<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-node_module%20API.html" aria-label="Modules: node:module API"><!---->Modules: node:module API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Modules-Packages.html" aria-label="Modules: Packages"><!---->Modules: Packages<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Net.html" aria-label="Net"><!---->Net<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Node-API.html" aria-label="Node-API"><!---->Node-API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/OS.html" aria-label="OS"><!---->OS<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Path.html" aria-label="Path"><!---->Path<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Performance%20measurement%20APIs.html" aria-label="Performance measurement APIs"><!---->Performance measurement APIs<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Permissions.html" aria-label="Permissions"><!---->Permissions<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Process.html" aria-label="Process"><!---->Process<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Punycode.html" aria-label="Punycode"><!---->Punycode<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Query%20string.html" aria-label="Query string"><!---->Query string<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Readline.html" aria-label="Readline"><!---->Readline<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/REPL.html" aria-label="REPL"><!---->REPL<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/document/node-doc/Stream.html" aria-label="Stream"><!---->Stream<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/String%20decoder.html" aria-label="String decoder"><!---->String decoder<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Test%20runner.html" aria-label="Test runner"><!---->Test runner<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Timers.html" aria-label="Timers"><!---->Timers<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TLS%20(SSL).html" aria-label="TLS (SSL)"><!---->TLS (SSL)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Trace%20events.html" aria-label="Trace events"><!---->Trace events<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/TTY.html" aria-label="TTY"><!---->TTY<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/URL.html" aria-label="URL"><!---->URL<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Util.html" aria-label="Util"><!---->Util<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/V8.html" aria-label="V8"><!---->V8<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/VM%20(executing%20JavaScript).html" aria-label="VM (executing JavaScript)"><!---->VM (executing JavaScript)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Crypto%20API.html" aria-label="Web Crypto API"><!---->Web Crypto API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Web%20Streams%20API.html" aria-label="Web Streams API"><!---->Web Streams API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/WebAssembly%20System%20Interface%20(WASI).html" aria-label="WebAssembly System Interface (WASI)"><!---->WebAssembly System Interface (WASI)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Worker%20threads.html" aria-label="Worker threads"><!---->Worker threads<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/document/node-doc/Zlib.html" aria-label="Zlib"><!---->Zlib<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Stream</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://hanekawa.top" target="_blank" rel="noopener noreferrer">hanekawa-shiki</a></span><span property="author" content="hanekawa-shiki"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-21T09:46:17.000Z"></span><!----><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 345 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT345M"></span><span class="page-word-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon" name="word"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 103544 å­—</span><meta property="wordCount" content="103544"></span><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-çš„ç±»å‹">Stream çš„ç±»å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#organization-of-this-document">Organization of this document</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ç®€ä»‹">Node.js ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#streams-çš„æ¦‚å¿µ">Streams çš„æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ–‡æ¡£ç»„ç»‡è§£é‡Š">æ–‡æ¡£ç»„ç»‡è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#types-of-streams">Types of streams</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#streams-promises-api">Streams Promises API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#streams-promises-api-æ˜¯ä»€ä¹ˆ">Streams Promises API æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨">å¦‚ä½•ä½¿ç”¨ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-1">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-pipeline-source-transforms-destination-options">stream.pipeline(source[, ...transforms], destination[, options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-stream">ä»€ä¹ˆæ˜¯ Streamï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-stream-pipeline">ä»€ä¹ˆæ˜¯ stream.pipeline?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š">å‚æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯ä¸ä¾‹å­">ä½¿ç”¨åœºæ™¯ä¸ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-pipeline-streams-options">stream.pipeline(streams[, options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-1">å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-finished-stream-options">stream.finished(stream[, options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-finished-stream-options-1">stream.finished(stream[, options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#object-mode">Object mode</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#object-mode-æ˜¯ä»€ä¹ˆ">Object mode æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#object-mode-çš„ä½¿ç”¨">Object mode çš„ä½¿ç”¨ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-2">å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#buffering">Buffering</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¼“å†²-buffering">ç¼“å†²ï¼ˆBufferingï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-3">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#api-for-stream-consumers">API for stream consumers</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#api-for-stream-consumers-1">API for stream consumers</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-4">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#writable-streams">Writable streams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯å†™æµ-writable-streams">å¯å†™æµï¼ˆWritable Streamsï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-2">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-1">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-streams-ç®€ä»‹">æµï¼ˆStreamsï¼‰ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-close-1">Event: &#39;close&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-streams-ç®€ä»‹-1">æµï¼ˆStreamsï¼‰ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#èƒŒå‹-backpressure">èƒŒå‹ï¼ˆBackpressureï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-drain-1">Event: &#39;drain&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-5">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#error-äº‹ä»¶ç®€ä»‹">&#39;error&#39; äº‹ä»¶ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ç›‘å¬å’Œå¤„ç†-error-äº‹ä»¶">å¦‚ä½•ç›‘å¬å’Œå¤„ç† &#39;error&#39; äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-1">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-streams-ç®€ä»‹-2">æµï¼ˆStreamsï¼‰ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#finish-äº‹ä»¶">finish äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-streams">æµï¼ˆStreamsï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#äº‹ä»¶-events">äº‹ä»¶ï¼ˆEventsï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-pipe-1">Event: &#39;pipe&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-2">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-2">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-unpipe-1">Event: &#39;unpipe&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#writable-destroy-error-1">writable.destroy([error])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-6">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-3">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-streams">ä»€ä¹ˆæ˜¯ Streamsï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#writable-streams-1">Writable Streams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-writable-closed">ä»€ä¹ˆæ˜¯ writable.closed?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-4">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-writable-destroyed">ä»€ä¹ˆæ˜¯ writable.destroyedï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆéœ€è¦-writable-destroyed">ä¸ºä»€ä¹ˆéœ€è¦ writable.destroyedï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-4">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬è§£é‡Š">åŸºæœ¬è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-5">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#writable-setdefaultencoding-encoding-1">writable.setDefaultEncoding(encoding)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-7">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-5">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-8">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-6">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#writable-writableaborted-1">writable.writableAborted</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯å†™æµ-writable-streams-1">å¯å†™æµï¼ˆWritable streamsï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#writable-writableended-1">writable.writableEnded</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-2">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-streams-1">æµï¼ˆStreamsï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯å†™æµ-writable-streams-2">å¯å†™æµï¼ˆWritable Streamsï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#corking-æ“ä½œ">Corking æ“ä½œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#writable-writablecorked-å±æ€§">writable.writableCorked å±æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ä¾‹è¿ç”¨">å®ä¾‹è¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-writable-errored">ä»€ä¹ˆæ˜¯ writable.erroredï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•ä½¿ç”¨-writable-errored">å¦‚ä½•ä½¿ç”¨ writable.erroredï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-3">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-1-å‘æ–‡ä»¶å†™å…¥æ•°æ®">ä¾‹å­ 1ï¼šå‘æ–‡ä»¶å†™å…¥æ•°æ®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­-2-http-å“åº”">ä¾‹å­ 2ï¼šHTTP å“åº”</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#writablehighwatermarkè¯¦è§£">writableHighWaterMarkè¯¦è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-4">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-7">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯å†™æµ-writable-streams-3">å¯å†™æµï¼ˆWritable Streamsï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#writable-writablelength-1">writable.writableLength</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-5">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-stream-åŸºç¡€">æµï¼ˆStreamï¼‰åŸºç¡€</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯å†™æµ-writable-stream">å¯å†™æµï¼ˆWritable Streamï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¼“å†²åŒºå’Œ-drain-äº‹ä»¶">ç¼“å†²åŒºå’Œ drain äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#writable-writableneeddrain-å±æ€§">writable.writableNeedDrain å±æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹">ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£é‡Š">è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-6">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#writable-write-æ–¹æ³•çš„ä½œç”¨">writable.write æ–¹æ³•çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-7">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-8">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-streams">Readable streams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-1">åŸºæœ¬æ¦‚å¿µï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-9">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-9">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#éæµåŠ¨æ¨¡å¼-non-flowing-mode">éæµåŠ¨æ¨¡å¼ï¼ˆNon-Flowing Modeï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµåŠ¨æ¨¡å¼-flowing-mode">æµåŠ¨æ¨¡å¼ï¼ˆFlowing Modeï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-3">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-å¯è¯»-readable-stream-api">1. å¯è¯»ï¼ˆReadableï¼‰Stream API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-å¯å†™-writable-stream-api">2. å¯å†™ï¼ˆWritableï¼‰Stream API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-åŒå·¥-duplex-å’Œè½¬æ¢-transform-stream-api">3. åŒå·¥ï¼ˆDuplexï¼‰å’Œè½¬æ¢ï¼ˆTransformï¼‰ Stream API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€ç†è§£">åŸºç¡€ç†è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-10">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-close-3">Event: &#39;close&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-data-1">Event: &#39;data&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-1">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-10">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯event-end">ä»€ä¹ˆæ˜¯Event: &#39;end&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆevent-end-é‡è¦">ä¸ºä»€ä¹ˆEvent: &#39;end&#39;é‡è¦</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¸¾ä¾‹">å®é™…åº”ç”¨ä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-11">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-1">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-error-çš„ä½œç”¨">Event: &#39;error&#39; çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-10">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-12">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„æµ-stream">Node.js ä¸­çš„æµ(Stream)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-pause-1">Event: &#39;pause&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-streams-ç®€ä»‹-3">æµï¼ˆStreamsï¼‰ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-äº‹ä»¶">readable äº‹ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-6">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#streams-åŸºç¡€">Streams åŸºç¡€</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#äº‹ä»¶-resume">äº‹ä»¶ï¼š&#39;resume&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-11">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£é‡Š-1">è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨æ¡ˆä¾‹">å®é™…åº”ç”¨æ¡ˆä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-readable-closed">ä»€ä¹ˆæ˜¯ readable.closed?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„">å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-2">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-1">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆéœ€è¦çŸ¥é“æµæ˜¯å¦å·²ç»è¢«é”€æ¯">ä¸ºä»€ä¹ˆéœ€è¦çŸ¥é“æµæ˜¯å¦å·²ç»è¢«é”€æ¯ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-12">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-stream-ç®€ä»‹">æµï¼ˆStreamï¼‰ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯è¯»æµä¸-ispaused-æ–¹æ³•">å¯è¯»æµä¸ isPaused() æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-ispaused-1">readable.isPaused()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨åœºæ™¯">å®é™…åº”ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-13">å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-13">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è¯´æ˜">å‚æ•°è¯´æ˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¸¾ä¾‹-1">å®é™…åº”ç”¨ä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-14">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-streams-ç®€ä»‹-4">æµï¼ˆStreamsï¼‰ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-read-size-1">readable.read([size])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯æµ-stream">ä»€ä¹ˆæ˜¯æµï¼ˆStreamï¼‰ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯è¯»æµ-readable-streams">å¯è¯»æµï¼ˆReadable Streamsï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-readable-å±æ€§">readable.readable å±æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-14">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯è¯»æµ-readable-streams-1">å¯è¯»æµï¼ˆReadable Streamsï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸­æ­¢æµ">ä¸­æ­¢æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-readableaborted-1">readable.readableAborted</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-stream-1">ä»€ä¹ˆæ˜¯ Streamï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-readabledidread-è¯¦è§£">readable.readableDidRead è¯¦è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-8">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-readable-readableencoding">ä»€ä¹ˆæ˜¯ readable.readableEncoding?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆé‡è¦">ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-11">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-15">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä½¿ç”¨åœºæ™¯">å®é™…ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-16">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-errored-1">readable.errored</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-17">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-9">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€æ¦‚å¿µ-2">åŸºç¡€æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readablehighwatermark">readableHighWaterMark</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯-1">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-18">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-readablelength-1">readable.readableLength</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-15">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-19">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-2">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-readableobjectmode-1">readable.readableObjectMode</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨">å®é™…åº”ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯è¯»æµ-readable-streams-2">å¯è¯»æµï¼ˆReadable Streamsï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-resume-æ–¹æ³•">readable.resume() æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-20">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-stream">æµï¼ˆStreamï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¼–ç -encoding">ç¼–ç ï¼ˆEncodingï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-setencoding-encoding-1">readable.setEncoding(encoding)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-17">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-streams-2">æµï¼ˆStreamsï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç®¡é“-pipes">ç®¡é“ï¼ˆPipesï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-readable-unpipe-destination">ä»€ä¹ˆæ˜¯ readable.unpipe([destination])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯-2">ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-1">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-streams-ç®€ä»‹-5">æµï¼ˆStreamsï¼‰ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯è¯»æµ-readable-streams-3">å¯è¯»æµï¼ˆReadable Streamsï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-unshift-chunk-encoding-æ–¹æ³•">readable.unshift(chunk[, encoding]) æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£é‡Š-2">è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-10">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-18">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„-streams">Node.js ä¸­çš„ Streams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¼‚æ­¥ç¼–ç¨‹">å¼‚æ­¥ç¼–ç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-symbol-asyncdispose">readable[Symbol.asyncDispose]()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š-1">å‚æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-13">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-readable-iterator-options">ä»€ä¹ˆæ˜¯ readable.iterator([options])ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#options-å‚æ•°">Options å‚æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-7">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-2">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-3">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-map-fn-options-è§£é‡Š">readable.map(fn[, options]) è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-14">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-4">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å…³äº-readable-filter-fn-options">å…³äº readable.filter(fn[, options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-8">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-5">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-19">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-1">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-stream-2">ä»€ä¹ˆæ˜¯ Stream</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-toarray-options-1">readable.toArray([options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-11">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-some-fn-options-1">readable.some(fn[, options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-6">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-20">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å°ç»“-2">å°ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-streams-ç®€ä»‹-6">æµï¼ˆStreamsï¼‰ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-every-fn-options-æ–¹æ³•">readable.every(fn[, options]) æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-9">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„ç‚¹">æ³¨æ„ç‚¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-streams-3">æµï¼ˆStreamsï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#flatmap-å‡½æ•°">flatMap å‡½æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-flatmap-fn-options-1">readable.flatMap(fn[, options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-drop-limit-options-1">readable.drop(limit[, options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-12">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-21">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£é‡Š-3">è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-15">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯è¯»æµ-readable-stream">å¯è¯»æµï¼ˆReadable Streamï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-reduce-æ–¹æ³•">ä»€ä¹ˆæ˜¯ reduce æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-ä¸­çš„-readable-reduce-fn-initial-options">Node.js ä¸­çš„ readable.reduce(fn[, initial[, options]])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#duplex-and-transform-streams">Duplex and transform streams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-ç†è§£æµ-streams">1. ç†è§£æµï¼ˆStreamsï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-duplex-streams">2. Duplex Streams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-transform-streams">3. Transform Streams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-22">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-streams-ç®€ä»‹-7">æµï¼ˆStreamsï¼‰ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#duplex-æµ">Duplex æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨åœºæ™¯-1">å®é™…åº”ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯åŒå·¥æµ-duplex-stream">ä»€ä¹ˆæ˜¯åŒå·¥æµï¼ˆDuplex Streamï¼‰?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#duplex-allowhalfopen-å±æ€§">duplex.allowHalfOpen å±æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-14">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬åŸç†">åŸºæœ¬åŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åº”ç”¨ç¤ºä¾‹">åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-23">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨çš„ä¾‹å­">å®é™…åº”ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-finished-stream-options-callback">stream.finished(stream[, options], callback)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-finished-stream-options-callback-1">stream.finished(stream[, options], callback)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-pipeline-source-transforms-destination-callback">stream.pipeline(source[, ...transforms], destination, callback)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-stream-3">ä»€ä¹ˆæ˜¯ Streamï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-pipelineå‡½æ•°ä»‹ç»">stream.pipelineå‡½æ•°ä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-17">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-24">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-pipeline-streams-callback">stream.pipeline(streams, callback)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-stream-4">ä»€ä¹ˆæ˜¯ Streamï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#pipeline-çš„ä½œç”¨">pipeline çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨ç¤ºä¾‹-1">ä½¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-25">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-compose-streams">stream.compose(...streams)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-streams">ç†è§£ Streams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸ºä»€ä¹ˆéœ€è¦stream-compose">ä¸ºä»€ä¹ˆéœ€è¦stream.compose</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-composeçš„å·¥ä½œåŸç†">stream.composeçš„å·¥ä½œåŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨ç¤ºä¾‹-2">ä½¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-readable-from-iterable-options">stream.Readable.from(iterable[, options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-7">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-readable-from-iterable-options-1">stream.Readable.from(iterable[, options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-18">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-26">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-readable-fromweb-readablestream-options">stream.Readable.fromWeb(readableStream[, options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½•ä¸ºreadablestream">ä½•ä¸ºReadableStream</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-readable-fromweb-readablestream-options-çš„ä½œç”¨">stream.Readable.fromWeb(readableStream[, options])çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-10">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-readable-isdisturbed-stream">stream.Readable.isDisturbed(stream)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-stream-ç®€ä»‹-1">æµï¼ˆStreamï¼‰ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯è¯»æµ-readable-stream-1">å¯è¯»æµï¼ˆReadable Streamï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµè¢«-disturb">æµè¢« &quot;disturb&quot;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-readable-isdisturbed-stream-1">stream.Readable.isDisturbed(stream)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-iserrored-stream">stream.isErrored(stream)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-iserrored-stream-1">stream.isErrored(stream)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯ä¾‹å­">ä½¿ç”¨åœºæ™¯ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-27">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-isreadable-stream">stream.isReadable(stream)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-stream-æ˜¯ä»€ä¹ˆ">æµï¼ˆStreamï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯è¯»æµ">å¯è¯»æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-isreadable-stream-1">stream.isReadable(stream)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-readable-toweb-streamreadable-options">stream.Readable.toWeb(streamReadable[, options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€è§£é‡Š">åŸºç¡€è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-readable-toweb-æ–¹æ³•çš„ä½œç”¨">stream.Readable.toWeb æ–¹æ³•çš„ä½œç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹">ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¤ºä¾‹ä»£ç -1">ç¤ºä¾‹ä»£ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-writable-fromweb-writablestream-options">stream.Writable.fromWeb(writableStream[, options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-node-js-å’Œ-streams">ä»€ä¹ˆæ˜¯ Node.js å’Œ Streamsï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-writable-fromweb-writablestream-options-1">stream.Writable.fromWeb(writableStream[, options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-writable-toweb-streamwritable">stream.Writable.toWeb(streamWritable)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµçš„ç§ç±»">æµçš„ç§ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-writable-toweb-streamwritable-1">stream.Writable.toWeb(streamWritable)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-21">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-duplex-from-src">stream.Duplex.from(src)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-streams-4">æµï¼ˆStreamsï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŒå·¥æµ-duplex-streams">åŒå·¥æµï¼ˆDuplex Streamsï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-duplex-from-src-1">stream.Duplex.from(src)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-duplex-fromweb-pair-options">stream.Duplex.fromWeb(pair[, options])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°è§£é‡Š-3">å‚æ•°è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-11">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-duplex-toweb-streamduplex">stream.Duplex.toWeb(streamDuplex)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-8">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-duplex-toweb-streamduplex-1">stream.Duplex.toWeb(streamDuplex)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-16">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-addabortsignal-signal-stream">stream.addAbortSignal(signal, stream)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºæœ¬æ¦‚å¿µ-9">åŸºæœ¬æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-addabortsignal-signal-stream-1">stream.addAbortSignal(signal, stream)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¸¾ä¾‹-2">å®é™…åº”ç”¨ä¸¾ä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-getdefaulthighwatermark-objectmode">stream.getDefaultHighWaterMark(objectMode)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯æµ-stream-1">ä»€ä¹ˆæ˜¯æµï¼ˆStreamï¼‰ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é«˜æ°´ä½çº¿-high-water-mark">é«˜æ°´ä½çº¿ï¼ˆHigh Water Markï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-getdefaulthighwatermark-objectmode-1">stream.getDefaultHighWaterMark(objectMode)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-22">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-setdefaulthighwatermark-objectmode-value">stream.setDefaultHighWaterMark(objectMode, value)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç®€ä»‹">ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-setdefaulthighwatermark-objectmode-value-1">stream.setDefaultHighWaterMark(objectMode, value)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-23">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#api-for-stream-implementers">API for stream implementers</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµçš„ç±»å‹">æµçš„ç±»å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é’ˆå¯¹æµå®ç°è€…çš„-api-æ„ä¹‰">é’ˆå¯¹æµå®ç°è€…çš„ API æ„ä¹‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-24">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-28">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#simplified-construction">Simplified construction</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-4">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-29">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#implementing-a-writable-stream">Implementing a writable stream</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-å¼•å…¥å¿…è¦çš„æ¨¡å—">1. å¼•å…¥å¿…è¦çš„æ¨¡å—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-åˆ›å»ºå¯å†™æµçš„ç±»">2. åˆ›å»ºå¯å†™æµçš„ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-ä½¿ç”¨è‡ªå®šä¹‰çš„å¯å†™æµ">3. ä½¿ç”¨è‡ªå®šä¹‰çš„å¯å†™æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-5">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-30">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ›å»º-writable-æµçš„é€‰é¡¹">åˆ›å»º writable æµçš„é€‰é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-17">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-streams-ç®€ä»‹-8">æµï¼ˆStreamsï¼‰ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#writable-construct-callback-1">writable._construct(callback)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç®€ä»‹-1">ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#streams-ç®€ä»‹">Streams ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#writable-streams-2">Writable Streams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#writable-writev-æ–¹æ³•">writable._writev() æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-æµ-stream-æ˜¯ä»€ä¹ˆ">1. æµï¼ˆStreamï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-writable-æµ">2. Writable æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-destroyæ–¹æ³•">3. _destroyæ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-19">å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-node-js-ä¸­çš„writable-final-callback">ä»€ä¹ˆæ˜¯ Node.js ä¸­çš„writable._final(callback)ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-20">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-31">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å†™å…¥æµ-writable-streams-ä¸­çš„é”™è¯¯">å†™å…¥æµï¼ˆWritable Streamsï¼‰ä¸­çš„é”™è¯¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¦‚ä½•æ•è·å’Œå¤„ç†è¿™äº›é”™è¯¯">å¦‚ä½•æ•è·å’Œå¤„ç†è¿™äº›é”™è¯¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-3">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯å†™æµçš„åŸºæœ¬ç¤ºä¾‹">å¯å†™æµçš„åŸºæœ¬ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-22">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-32">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£ç ç¼“å†²åŒº-buffers-åœ¨å¯å†™æµä¸­çš„åº”ç”¨">è§£ç ç¼“å†²åŒºï¼ˆBuffersï¼‰åœ¨å¯å†™æµä¸­çš„åº”ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#implementing-a-readable-stream">Implementing a readable stream</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ›å»ºä¸€ä¸ªå¯è¯»æµ">åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ç¤ºä¾‹-12">å®é™…åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#stream-readable">stream.Readable</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŸºç¡€ç†è§£-1">åŸºç¡€ç†è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-7">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-4">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-stream-1">æµï¼ˆStreamï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯è¯»æµ-readable-stream-2">å¯è¯»æµï¼ˆReadable Streamï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-read-size-3">readable._read(size)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-25">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-stream-ç®€ä»‹-2">æµï¼ˆStreamï¼‰ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-destroy-err-callback-è§£é‡Š">readable._destroy(err, callback) è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-22">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-push-chunk-encoding-1">readable.push(chunk[, encoding])</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¤„ç†æµè¯»å–ä¸­çš„é”™è¯¯">å¤„ç†æµè¯»å–ä¸­çš„é”™è¯¯ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-23">å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ›å»ºè®¡æ•°æµ">åˆ›å»ºè®¡æ•°æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨è®¡æ•°æµ">ä½¿ç”¨è®¡æ•°æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#implementing-a-duplex-stream">Implementing a duplex stream</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ç°-duplex-stream">å®ç° Duplex Stream</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ç¤ºä¾‹">å®é™…ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-streams-åŸºç¡€">æµ(Streams)åŸºç¡€</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#duplex-streams">Duplex Streams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-8">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŒå·¥æµç¤ºä¾‹è§£æ">åŒå·¥æµç¤ºä¾‹è§£æ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#object-mode-duplex-streams-1">Object Mode Duplex Streams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#implementing-a-transform-stream">Implementing a transform stream</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®ç°è½¬æ¢æµ">å®ç°è½¬æ¢æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¾‹å­">ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åº”ç”¨ç¤ºä¾‹-1">åº”ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‚æ•°-12">å‚æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-24">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#streams-æµ-ç®€ä»‹">Streamsï¼ˆæµï¼‰ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-end-2">Event: &#39;end&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…åº”ç”¨ä¾‹å­-9">å®é™…åº”ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#streams-ä¸-node-js">Streams ä¸ Node.js</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#event-finish-2">Event: &#39;finish&#39;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-25">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-5">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#transform-flush-callback-1">transform._flush(callback)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-24">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç†è§£-transform-transform">ç†è§£ transform._transform</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-26">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-6">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#passthrough-æµçš„ç‰¹ç‚¹">PassThrough æµçš„ç‰¹ç‚¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-27">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ›å»ºå’Œä½¿ç”¨-passthrough-æµ">åˆ›å»ºå’Œä½¿ç”¨ PassThrough æµ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#additional-notes">Additional notes</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-streams-æ˜¯ä»€ä¹ˆ">1. Streams æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-streams-çš„ç±»å‹">2. Streams çš„ç±»å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-å®é™…è¿ç”¨çš„ä¾‹å­">3. å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-7">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#streams-compatibility-with-async-generators-and-async-iterators">Streams compatibility with async generators and async iterators</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#node-js-å’Œ-streams">Node.js å’Œ Streams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä»€ä¹ˆæ˜¯-readable-streams-å¯è¯»æµ">ä»€ä¹ˆæ˜¯ Readable Streamsï¼ˆå¯è¯»æµï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ¶ˆè´¹-readable-streams">æ¶ˆè´¹ Readable Streams</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#async-iterators-å¼‚æ­¥è¿­ä»£å™¨">Async Iteratorsï¼ˆå¼‚æ­¥è¿­ä»£å™¨ï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨">å®é™…è¿ç”¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ€»ç»“-33">æ€»ç»“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¼‚æ­¥ç”Ÿæˆå™¨-async-generators">å¼‚æ­¥ç”Ÿæˆå™¨ï¼ˆAsync Generatorsï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆ›å»ºå¯è¯»æµ">åˆ›å»ºå¯è¯»æµ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…ä¾‹å­-2">å®é™…ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“è®º-8">ç»“è®º</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-28">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#compatibility-with-older-node-js-versions">Compatibility with older Node.js versions</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å…¼å®¹æ€§é—®é¢˜">å…¼å®¹æ€§é—®é¢˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ä¾‹å­-26">å®é™…è¿ç”¨ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è§£å†³å…¼å®¹æ€§é—®é¢˜çš„æ–¹æ³•">è§£å†³å…¼å®¹æ€§é—®é¢˜çš„æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-read-0">readable.read(0)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-streams-ç®€ä»‹-9">æµï¼ˆStreamsï¼‰ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-read-0-è§£é‡Š">readable.read(0) è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨ç¤ºä¾‹-29">å®é™…è¿ç”¨ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-push">readable.push(&#39;&#39;)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯è¯»æµ-readable-streams-4">å¯è¯»æµï¼ˆReadable Streamsï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#readable-push-æ–¹æ³•">readable.push(&#39;&#39;) æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-25">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#highwatermark-discrepancy-after-calling-readable-setencoding">highWaterMark discrepancy after calling readable.setEncoding()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æµ-stream-ç®€ä»‹-3">æµï¼ˆStreamï¼‰ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#highwatermark-ç®€ä»‹">highWaterMark ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#setencoding-æ–¹æ³•">setEncoding() æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#highwatermark-ä¸ä¸€è‡´é—®é¢˜">highWaterMark ä¸ä¸€è‡´é—®é¢˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å®é™…è¿ç”¨çš„ä¾‹å­-26">å®é™…è¿ç”¨çš„ä¾‹å­</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="stream" tabindex="-1"><a class="header-anchor" href="#stream"><span><a href="https://nodejs.org/docs/latest/api/stream.html#stream" target="_blank" rel="noopener noreferrer">Stream</a></span></a></h1><p>Node.js ä¸­çš„ Streamï¼ˆæµï¼‰æ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œè®©æˆ‘ä»¬èƒ½ä»¥æŒç»­çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚æƒ³è±¡ä¸€ä¸‹æ°´ä»æ°´é¾™å¤´æµåˆ°æ°´æ§½çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªæµåŠ¨çš„è¿‡ç¨‹å°±åƒæ˜¯ Node.js ä¸­å¤„ç†æ•°æ®çš„â€œæµâ€ã€‚ä½¿ç”¨ Streamï¼Œä½ å¯ä»¥è¯»å–æˆ–å†™å…¥æ•°æ®ç‰‡æ®µè€Œä¸å¿…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®åˆ°å†…å­˜ä¸­ï¼Œè¿™åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–å®æ—¶æ•°æ®æ—¶éå¸¸æœ‰æ•ˆã€‚</p><h3 id="stream-çš„ç±»å‹" tabindex="-1"><a class="header-anchor" href="#stream-çš„ç±»å‹"><span>Stream çš„ç±»å‹</span></a></h3><ol><li><strong>Readable Streams (å¯è¯»æµ)</strong>ï¼šç”¨äºè¯»å–æ•°æ®çš„æµã€‚ä¾‹å¦‚ï¼Œä»æ–‡ä»¶è¯»å–æ•°æ®æˆ–ä»ç½‘ç»œè¯·æ±‚è·å–æ•°æ®ã€‚</li><li><strong>Writable Streams (å¯å†™æµ)</strong>ï¼šç”¨äºå†™å…¥æ•°æ®çš„æµã€‚ä¾‹å¦‚ï¼Œå‘æ–‡ä»¶å†™å…¥æ•°æ®æˆ–å‘é€å“åº”åˆ°ç½‘ç»œè¯·æ±‚ã€‚</li><li><strong>Duplex Streams (åŒå·¥æµ)</strong>ï¼šæ—¢æ˜¯å¯è¯»æµä¹Ÿæ˜¯å¯å†™æµã€‚ä¾‹å¦‚ï¼Œç½‘ç»œå¥—æ¥å­—ï¼ˆSocketï¼‰æ—¢å¯ä»¥æ¥æ”¶æ•°æ®ä¹Ÿå¯ä»¥å‘é€æ•°æ®ã€‚</li><li><strong>Transform Streams (è½¬æ¢æµ)</strong>ï¼šä¸€ç§ç‰¹æ®Šçš„åŒå·¥æµï¼Œå®ƒå¯ä»¥ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®ï¼Œç„¶åå†è¾“å‡ºã€‚ä¾‹å¦‚ï¼Œå‹ç¼©æ•°æ®æˆ–åŠ å¯†æ•°æ®ã€‚</li></ol><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><ol><li><p><strong>ä»æ–‡ä»¶è¯»å–å¤§é‡æ•°æ®</strong><br> å‡è®¾ä½ æœ‰ä¸€ä¸ªå¤§å‹æ–‡æœ¬æ–‡ä»¶ï¼Œä½ æƒ³é€è¡Œè¯»å–å†…å®¹è€Œä¸æ˜¯ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ä½ å¯ä»¥ä½¿ç”¨<code>fs.createReadStream</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./largeFile.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯»å–å®Œæˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>å°†æ•°æ®å†™å…¥æ–‡ä»¶</strong><br> å¦‚æœä½ æƒ³ç”Ÿæˆæ—¥å¿—æ–‡ä»¶å¹¶ä¸”åœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´æŒç»­å†™å…¥æ—¥å¿—ä¿¡æ¯ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>fs.createWriteStream</code>åˆ›å»ºä¸€ä¸ªå¯å†™æµã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writeStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./log.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">flags</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯ä¸€æ¡æ—¥å¿—ä¿¡æ¯</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç®¡é“æ“ä½œ</strong><br> ç®¡é“ï¼ˆPipingï¼‰æ˜¯ä¸€ç§å°†å¯è¯»æµä¸­çš„æ•°æ®ç›´æ¥ä¼ è¾“åˆ°å¯å†™æµçš„æœºåˆ¶ã€‚ä¾‹å¦‚ï¼Œä½ æƒ³å¤åˆ¶ä¸€ä¸ªæ–‡ä»¶å†…å®¹åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./original.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writeStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./copy.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;finish&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å¤åˆ¶å®Œæˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç½‘ç»œé€šä¿¡</strong><br> åœ¨æ„å»º HTTP æœåŠ¡å™¨æ—¶ï¼ŒNode.js ä½¿ç”¨æµå¤„ç†è¯·æ±‚å’Œå“åº”ä½“ã€‚è¿™å…è®¸ä½ å¤„ç†å¤§å‹è¯·æ±‚ä½“ï¼Œå¦‚æ–‡ä»¶ä¸Šä¼ ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">method</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;POST&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†è¯·æ±‚ä½“ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;åªæ¥å—POSTè¯·æ±‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>ä»¥ä¸Šç¤ºä¾‹å±•ç¤ºäº† Node.js ä¸­ Stream çš„åŸºæœ¬ç”¨é€”å’Œæ“ä½œã€‚Stream çš„é«˜æ•ˆæ€§ä¸»è¦ä½“ç°åœ¨å¤„ç†å¤§è§„æ¨¡æ•°æ®å’Œå®æ—¶æ•°æ®æ–¹é¢ï¼Œå› ä¸ºå®ƒä»¬å…è®¸æ•°æ®åˆ†å—å¤„ç†ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><h2 id="organization-of-this-document" tabindex="-1"><a class="header-anchor" href="#organization-of-this-document"><span><a href="https://nodejs.org/docs/latest/api/stream.html#organization-of-this-document" target="_blank" rel="noopener noreferrer">Organization of this document</a></span></a></h2><p>å½“ä½ åˆšå¼€å§‹æ¥è§¦ç¼–ç¨‹ï¼Œå°¤å…¶æ˜¯ Node.jsï¼Œå¯èƒ½ä¼šå¯¹å¾ˆå¤šæ¦‚å¿µæ„Ÿåˆ°å›°æƒ‘ã€‚ä»Šå¤©ï¼Œæˆ‘å°†å¸®åŠ©ä½ äº†è§£ Node.js æ–‡æ¡£ä¸­æåˆ°çš„â€œOrganization of this documentâ€ï¼Œç‰¹åˆ«æ˜¯åœ¨ Node.js v21.7.1 ç‰ˆæœ¬çš„ Streams éƒ¨åˆ†ã€‚</p><h3 id="node-js-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#node-js-ç®€ä»‹"><span>Node.js ç®€ä»‹</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç®€å•ä»‹ç»ä¸€ä¸‹ Node.jsã€‚Node.js æ˜¯ä¸€ä¸ªå¼€æºã€è·¨å¹³å°çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚è¿™æ˜¯ä¸€ç§é«˜æ•ˆä¸”å¹¿æ³›ç”¨äºåˆ›å»ºå„ç§ç½‘ç»œæœåŠ¡å’Œåº”ç”¨çš„æŠ€æœ¯ã€‚</p><h3 id="streams-çš„æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#streams-çš„æ¦‚å¿µ"><span>Streams çš„æ¦‚å¿µ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼ŒStreams æ˜¯å¤„ç†è¯»å–æˆ–å†™å…¥æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ I/O æ“ä½œçš„ä¸€ç§æ–¹å¼ã€‚å®ƒä»¬å¯ä»¥å°†å¤§æ–‡ä»¶æˆ–æ•°æ®åˆ†æˆå°å—ï¼Œé€ç‰‡å¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™æ ·åšæœ‰ä¸¤ä¸ªä¸»è¦ä¼˜ç‚¹ï¼šæé«˜æ€§èƒ½å’Œå‡å°‘å†…å­˜ä½¿ç”¨ã€‚</p><h3 id="æ–‡æ¡£ç»„ç»‡è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#æ–‡æ¡£ç»„ç»‡è§£é‡Š"><span>æ–‡æ¡£ç»„ç»‡è§£é‡Š</span></a></h3><p>åœ¨ Node.js çš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œâ€œOrganization of this documentâ€è¿™ä¸ªéƒ¨åˆ†ï¼Œæ˜¯åœ¨å‘Šè¯‰ä½ è¿™ä»½æ–‡æ¡£æ˜¯å¦‚ä½•è¢«ç»„ç»‡çš„ï¼Œä»¥ä¾¿ä½ æ›´å®¹æ˜“åœ°æ‰¾åˆ°éœ€è¦çš„ä¿¡æ¯ã€‚ä»¥ Streams ä¸ºä¾‹ï¼Œå®ƒé€šå¸¸åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ol><li><strong>ç®€ä»‹</strong>ï¼šä»‹ç»å½“å‰æ¨¡å—æˆ–åŠŸèƒ½çš„åŸºæœ¬æ¦‚å¿µã€‚</li><li><strong>API å‚è€ƒ</strong>ï¼šè¯¦ç»†åˆ—å‡ºäº†æ‰€æœ‰ç›¸å…³å‡½æ•°ã€å¯¹è±¡å’Œäº‹ä»¶çš„ä½¿ç”¨æ–¹æ³•ã€‚</li><li><strong>ç¤ºä¾‹ä»£ç </strong>ï¼šæä¾›å®é™…çš„ä»£ç ä¾‹å­ï¼Œå¸®åŠ©ç†è§£å¦‚ä½•ä½¿ç”¨ç‰¹å®šçš„ APIã€‚</li><li><strong>æ·±å…¥è¯é¢˜</strong>ï¼šæ¢è®¨æ›´å¤æ‚æˆ–é«˜çº§çš„ç”¨æ³•å’Œæ¦‚å¿µã€‚</li></ol><h3 id="å®é™…è¿ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>è®©æˆ‘ä»¬çœ‹ä¸€äº›å…·ä½“çš„ Streams å®é™…åº”ç”¨ä¾‹å­ï¼š</p><ol><li><p><strong>è¯»å–å¤§æ–‡ä»¶</strong>ï¼šå‡è®¾ä½ æœ‰ä¸€ä¸ªéå¸¸å¤§çš„æ—¥å¿—æ–‡ä»¶éœ€è¦å¤„ç†ã€‚ä½¿ç”¨ Streamï¼Œä½ å¯ä»¥é€æ­¥è¯»å–æ–‡ä»¶å†…å®¹ï¼Œé€è¡Œåˆ†ææ—¥å¿—ï¼Œè€Œä¸å¿…å°†æ•´ä¸ªæ–‡ä»¶ä¸€æ¬¡æ€§åŠ è½½è¿›å†…å­˜ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> inputStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;bigfile.log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> lineReader</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">input</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">inputStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">lineReader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;line&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å¤„ç†ä¸€è¡Œæ•°æ®ï¼š&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç½‘ç«™å›¾ç‰‡å‹ç¼©</strong>ï¼šå¦‚æœä½ æ­£åœ¨å»ºè®¾ä¸€ä¸ªç½‘ç«™ï¼Œå¹¶å¸Œæœ›ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡è‡ªåŠ¨å‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨ Stream æ¥è¯»å–å›¾ç‰‡æ•°æ®ï¼Œå¤„ç†åå†ä¿å­˜æˆ–å‘é€ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> sharp</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;sharp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// éœ€è¦å®‰è£…sharpåº“</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;input.jpg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sharp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resize</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¿®æ”¹å°ºå¯¸ä¸º200x200</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.jpg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ° Streams å¦‚ä½•åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–æ–‡ä»¶æ—¶å‘æŒ¥å·¨å¤§ä½œç”¨ï¼ŒåŒæ—¶é¿å…æ¶ˆè€—è¿‡å¤šå†…å­˜èµ„æºã€‚</p><p>æ€»ä¹‹ï¼Œâ€œOrganization of this documentâ€éƒ¨åˆ†æ˜¯ä¸ºäº†å¸®åŠ©ä½ æ›´å¥½åœ°å¯¼èˆªå’Œç†è§£ Node.js çš„æ–‡æ¡£å¸ƒå±€ï¼Œè€Œå¯¹äº Streamsï¼Œç†è§£å…¶åŸºæœ¬æ¦‚å¿µå¹¶é€šè¿‡å®ä¾‹å­¦ä¹ å¦‚ä½•ä½¿ç”¨ï¼Œå°†æ˜¯å…¥é—¨ Node.js éå¸¸é‡è¦çš„ä¸€æ­¥ã€‚</p><h2 id="types-of-streams" tabindex="-1"><a class="header-anchor" href="#types-of-streams"><span><a href="https://nodejs.org/docs/latest/api/stream.html#types-of-streams" target="_blank" rel="noopener noreferrer">Types of streams</a></span></a></h2><p>Node.js ä¸­çš„æµï¼ˆStreamsï¼‰æ˜¯å¤„ç†è¯»å†™æ•°æ®çš„æŠ½è±¡æ¦‚å¿µã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªæ°´æ¡¶ï¼ˆæ•°æ®æºï¼‰å’Œä¸€ä¸ªç©ºæ°´å£¶ï¼ˆç›®çš„åœ°ï¼‰ï¼Œä½ éœ€è¦å°†æ°´ä»æ¡¶ç§»åŠ¨åˆ°å£¶é‡Œã€‚ä½ å¯ä»¥ä¸€æ¬¡æ€§å€’å…¥ï¼Œè¿™ç±»ä¼¼äºä¼ ç»Ÿçš„å…¨éƒ¨åŠ è½½åå¤„ç†æ•°æ®çš„æ–¹å¼ï¼›æˆ–è€…ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€æ ¹ç®¡é“é€æ¸å°†æ°´å¯¼å…¥å£¶ä¸­ï¼Œè¿™å°±åƒ Node.js ä¸­çš„æµæ“ä½œã€‚ä½¿ç”¨æµæœ‰åŠ©äºæœ‰æ•ˆç®¡ç†å†…å­˜å’Œæ—¶é—´ï¼Œç‰¹åˆ«æ˜¯å½“å¤„ç†å¤§é‡æ•°æ®æ—¶ã€‚</p><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œæµä¸»è¦åˆ†ä¸ºå››ç§ç±»å‹ï¼š</p><ol><li><p><strong>å¯è¯»æµï¼ˆReadable Streamsï¼‰</strong>:</p><ul><li>å¯è¯»æµæ˜¯æ‚¨å¯ä»¥ä»ä¸­è¯»å–æ•°æ®çš„æµã€‚ä¾‹å¦‚ï¼Œå½“ä½ è¯»å–ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œæ–‡ä»¶ç³»ç»Ÿä¸­çš„æ•°æ®è¢«è¯»å–è¿›æ¥ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªå¯è¯»æµé€æ­¥æä¾›ç»™ä½ çš„åº”ç”¨ç¨‹åºã€‚</li><li>å®é™…åº”ç”¨ä¾‹å­ï¼šå‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªæ—¥å¿—åˆ†æå·¥å…·ï¼Œä½ éœ€è¦ä»ä¸€ä¸ªéå¸¸å¤§çš„æ—¥å¿—æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚ä½¿ç”¨å¯è¯»æµï¼Œä½ å¯ä»¥é€æ­¥è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶è½½å…¥å†…å­˜ï¼Œè¿™æ ·å¯ä»¥é¿å…å†…å­˜æº¢å‡ºã€‚</li></ul></li><li><p><strong>å¯å†™æµï¼ˆWritable Streamsï¼‰</strong>:</p><ul><li>å¯å†™æµå…è®¸ä½ å‘å…¶å†™å…¥æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå½“ä½ è¦ä¿å­˜æ•°æ®åˆ°æ–‡ä»¶æ—¶ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯å†™æµï¼Œå°†æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿã€‚</li><li>å®é™…åº”ç”¨ä¾‹å­ï¼šå¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘ç»œåº”ç”¨ï¼Œå…è®¸ç”¨æˆ·ä¸Šä¼ è§†é¢‘ã€‚ç”¨æˆ·ä¸Šä¼ çš„è§†é¢‘å¯ä»¥é€šè¿‡å¯å†™æµç›´æ¥å†™å…¥æœåŠ¡å™¨ä¸Šçš„æŸä¸ªä½ç½®ï¼Œè€Œä¸éœ€è¦å…ˆå®Œæ•´æ¥æ”¶å†å†™å…¥ï¼Œå‡å°‘äº†å¯¹å†…å­˜çš„éœ€æ±‚ã€‚</li></ul></li><li><p><strong>åŒå·¥æµï¼ˆDuplex Streamsï¼‰</strong>:</p><ul><li>åŒå·¥æµæ—¢å¯ä»¥è¯»åˆå¯ä»¥å†™ã€‚å®ƒä»¬åœ¨ä¸¤ç«¯éƒ½æ‰“å¼€ï¼Œå…è®¸æ•°æ®åŒæ—¶åŒå‘æµåŠ¨ã€‚</li><li>å®é™…åº”ç”¨ä¾‹å­ï¼šè€ƒè™‘ä¸€ä¸ªå®æ—¶èŠå¤©åº”ç”¨ï¼ŒæœåŠ¡å™¨éœ€è¦åŒæ—¶è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯å¹¶å“åº”æ¶ˆæ¯ã€‚æ­¤æ—¶ï¼ŒåŒå·¥æµå¯ä»¥ä½¿æœåŠ¡å™¨æ—¢èƒ½æ¥æ”¶å®¢æˆ·ç«¯çš„æ•°æ®ï¼Œä¹Ÿèƒ½å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚</li></ul></li><li><p><strong>å˜æ¢æµï¼ˆTransform Streamsï¼‰</strong>:</p><ul><li>å˜æ¢æµæ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„åŒå·¥æµï¼Œä½†å®ƒå¯ä»¥ä¿®æ”¹æˆ–å˜æ¢é€šè¿‡æµä¼ è¾“çš„æ•°æ®ã€‚</li><li>å®é™…åº”ç”¨ä¾‹å­ï¼šå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªæ•°æ®å‹ç¼©å·¥å…·ï¼Œç”¨æˆ·å¯ä»¥ä¸Šä¼ æ–‡ä»¶æ¥è¿›è¡Œå‹ç¼©ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸Šä¼ çš„æ–‡ä»¶å¯ä»¥é€šè¿‡ä¸€ä¸ªå˜æ¢æµæµè¿‡ï¼Œè¯¥æµåœ¨æ•°æ®åˆ°è¾¾ç›®çš„åœ°ä¹‹å‰å®æ—¶å‹ç¼©æ•°æ®ï¼Œç„¶åå°†å‹ç¼©åçš„æ•°æ®è¾“å‡ºã€‚</li></ul></li></ol><p>æ¯ç§æµéƒ½æ˜¯ä¸ºä¸åŒçš„æ•°æ®å¤„ç†åœºæ™¯è®¾è®¡çš„ã€‚é€šè¿‡ç»„åˆä½¿ç”¨è¿™äº›æµï¼ŒNode.js åº”ç”¨å¯ä»¥é«˜æ•ˆã€çµæ´»åœ°å¤„ç†å„ç§æ•°æ®æµåŠ¨åœºæ™¯ï¼Œä»è€Œä¼˜åŒ–æ€§èƒ½å’Œèµ„æºåˆ©ç”¨ã€‚</p><h3 id="streams-promises-api" tabindex="-1"><a class="header-anchor" href="#streams-promises-api"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streams-promises-api" target="_blank" rel="noopener noreferrer">Streams Promises API</a></span></a></h3><p>Node.js ä¸­çš„ Streamsï¼ˆæµï¼‰æ˜¯ä¸€ç§å¤„ç†è¯»å–å’Œå†™å…¥æ•°æ®çš„æ–¹æ³•ï¼Œå…è®¸ä½ ä»¥è¿ç»­çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚ä¼ ç»Ÿçš„æµ API åŸºäºäº‹ä»¶ï¼Œè€Œåœ¨ Node.js v21.7.1 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œæä¾›äº†åŸºäº Promise çš„ Streams APIï¼Œä½¿å¾—ä½¿ç”¨æµå˜å¾—æ›´åŠ ç®€ä¾¿å’Œç°ä»£ã€‚</p><h3 id="streams-promises-api-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#streams-promises-api-æ˜¯ä»€ä¹ˆ"><span>Streams Promises API æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>Streams Promises API æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨<code>async/await</code>è¯­æ³•å¤„ç†æµï¼Œè¿™æ ·å¯ä»¥é¿å…å›è°ƒåœ°ç‹±ï¼ˆcallback hellï¼‰å¹¶ä¸”è®©ä»£ç çœ‹èµ·æ¥æ›´åŠ ç®€æ´å’Œæ˜“äºç†è§£ã€‚é€šè¿‡ä½¿ç”¨ Promises APIï¼Œå½“ä½ è¿›è¡Œæµæ“ä½œæ—¶ï¼ˆå¦‚è¯»å–æ–‡ä»¶ã€è·å–ç½‘ç»œè¯·æ±‚çš„å“åº”ç­‰ï¼‰ï¼Œä½ å¯ä»¥åƒå¤„ç†æ™®é€šçš„å¼‚æ­¥æ“ä½œä¸€æ ·å¤„ç†å®ƒä»¬ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨"><span>å¦‚ä½•ä½¿ç”¨ï¼Ÿ</span></a></h3><p>é¦–å…ˆï¼Œä½ éœ€è¦ä»<code>stream/promises</code>æ¨¡å—ä¸­å¯¼å…¥æ‰€éœ€çš„å‡½æ•°ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ æƒ³ä»¥å¼‚æ­¥çš„æ–¹å¼è¯»å–æ–‡ä»¶ï¼Œä½ å¯èƒ½ä¼šéœ€è¦ä½¿ç”¨<code>fs</code>æ¨¡å—çš„<code>readable</code>æµä¸<code>stream/promises</code>æ¨¡å—ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">finished</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;stream/promises&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä½¿ç”¨for await...ofå¾ªç¯å¼‚æ­¥è¯»å–æµä¸­çš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  for</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ç­‰å¾…æµç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> finished</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…è¿ç”¨ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-1"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p><strong>ä¾‹å­ 1ï¼šè¯»å–å¤§å‹æ–‡ä»¶</strong></p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªéå¸¸å¤§çš„æ—¥å¿—æ–‡ä»¶ï¼Œä½ ä¸å¸Œæœ›ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå› ä¸ºè¿™æ ·ä¼šéå¸¸æ¶ˆè€—èµ„æºã€‚ä½ å¯ä»¥ä½¿ç”¨ Streams Promises API æŒ‰å—è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶è¿›è¡Œå¤„ç†ï¼Œå¦‚ç»Ÿè®¡æ–‡ä»¶è¡Œæ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">finished</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;stream/promises&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> countLines</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> linesCount</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  for</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    linesCount</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">split</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> finished</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> linesCount</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">countLines</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/your/large/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">count</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Total lines: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¾‹å­ 2ï¼šä» API è·å–æ•°æ®</strong></p><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œéœ€è¦ä»æŸä¸ª API è·å–å¤§é‡æ•°æ®ã€‚ä½ å¯ä»¥ä½¿ç”¨ Streams Promises API æ¥å¤„ç†è¿™äº›æ•°æ®ï¼Œè€Œä¸å¿…ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// Node.jsçš„HTTPSæ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">finished</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;stream/promises&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;stream/promises&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // getè¯·æ±‚è¿”å›ä¸€ä¸ªæµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> requestStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä½¿ç”¨pipelineå¤„ç†æµï¼Œä¾‹å¦‚ä¿å­˜åˆ°æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    requestStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è¿™é‡Œå¯ä»¥æ’å…¥è½¬æ¢æµï¼ˆtransform streamsï¼‰æˆ–å…¶ä»–å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ•°æ®å·²ä¿å­˜åˆ° output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://example.com/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ•°æ®ä»ç½‘ç»œè¯·æ±‚ä¸­è·å–ï¼Œå¹¶é€šè¿‡æµç›´æ¥å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œé¿å…äº†å¤§é‡æ•°æ®åŒæ—¶å æ®å†…å­˜çš„é—®é¢˜ã€‚</p><h3 id="ç»“è®º" tabindex="-1"><a class="header-anchor" href="#ç»“è®º"><span>ç»“è®º</span></a></h3><p>Streams Promises API åœ¨ Node.js ä¸­æä¾›äº†ä¸€ç§æ›´ç°ä»£ã€æ›´æ˜“äºç†è§£å’Œä½¿ç”¨çš„æ–¹å¼æ¥å¤„ç†æµæ•°æ®ã€‚é€šè¿‡ç»“åˆ<code>async/await</code>ï¼Œä½ å¯ä»¥ä»¥å‡ ä¹ä¸åŒæ­¥ä»£ç ç›¸åŒçš„æ–¹å¼ä¹¦å†™å¼‚æ­¥çš„æµå¤„ç†é€»è¾‘ï¼Œä»è€Œå¤§å¤§ç®€åŒ–äº†ä»£ç å¹¶æé«˜äº†å¯è¯»æ€§ã€‚</p><h3 id="stream-pipeline-source-transforms-destination-options" tabindex="-1"><a class="header-anchor" href="#stream-pipeline-source-transforms-destination-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streampipelinesource-transforms-destination-options" target="_blank" rel="noopener noreferrer">stream.pipeline(source[, ...transforms], destination[, options])</a></span></a></h3><p>å½“ç„¶ï¼Œå¾ˆé«˜å…´å¸®åŠ©ä½ ç†è§£ Node.js ä¸­çš„ <code>stream.pipeline</code> åŠŸèƒ½ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä»åŸºæœ¬æ¦‚å¿µå¼€å§‹ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-stream" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-stream"><span>ä»€ä¹ˆæ˜¯ Streamï¼Ÿ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<strong>stream</strong> æ˜¯å¤„ç†æ•°æ®æµçš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«é€‚ç”¨äºå¤„ç†å¤§é‡æ•°æ®æˆ–è€…é€æ­¥æ¥æ”¶æ•°æ®çš„æƒ…å†µã€‚æ¯”å¦‚è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶æ—¶ï¼Œä¸éœ€è¦ç­‰åˆ°æ•´ä¸ªæ–‡ä»¶éƒ½è¯»å–è¿›å†…å­˜åå†å¤„ç†ï¼Œè€Œæ˜¯å¯ä»¥è¾¹è¯»è¾¹å¤„ç†ï¼Œè¿™æ ·å°±å¤§å¤§æé«˜äº†æ•ˆç‡å’Œæ€§èƒ½ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-stream-pipeline" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-stream-pipeline"><span>ä»€ä¹ˆæ˜¯ <code>stream.pipeline</code>?</span></a></h3><p><code>stream.pipeline</code> æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªå·¥å…·å‡½æ•°ï¼Œç”¨æ¥è½»æ¾åœ°æŠŠå¤šä¸ªæµï¼ˆstreamsï¼‰è¿æ¥èµ·æ¥ï¼Œä½¿å¾—æ•°æ®å¯ä»¥ä¾æ¬¡é€šè¿‡è¿™äº›æµè¿›è¡Œå¤„ç†ã€‚è¿™åŒ…æ‹¬å¯è¯»æµ (source)ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªè½¬æ¢æµ (transforms)ï¼Œä»¥åŠä¸€ä¸ªå¯å†™æµ (destination)ã€‚å¦‚æœåœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œpipeline èƒ½å¤Ÿç¡®ä¿æ‰€æœ‰çš„æµéƒ½è¢«æ­£ç¡®å…³é—­ã€‚</p><h3 id="å‚æ•°è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š"><span>å‚æ•°è§£é‡Š</span></a></h3><ul><li><strong>source</strong>: æ•°æ®çš„æ¥æºæµï¼Œæ¯”å¦‚ä»æ–‡ä»¶è¯»å–çš„æµã€‚</li><li><strong>...transforms</strong>: å¯é€‰çš„ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªè½¬æ¢æµï¼Œç”¨æ¥å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚å‹ç¼©ã€ç¼–ç è½¬æ¢ç­‰ã€‚</li><li><strong>destination</strong>: æ•°æ®çš„ç›®çš„åœ°æµï¼Œæ¯”å¦‚å†™å…¥åˆ°æ–‡ä»¶çš„æµã€‚</li><li><strong>options</strong>: å¯é€‰çš„é…ç½®å¯¹è±¡ï¼Œå¯ä»¥ç”¨æ¥æ§åˆ¶è¡Œä¸ºç»†èŠ‚ï¼Œæ¯”å¦‚è®¾ç½®é«˜æ°´ä½çº¿ã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯ä¸ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯ä¸ä¾‹å­"><span>ä½¿ç”¨åœºæ™¯ä¸ä¾‹å­</span></a></h3><p>å‡è®¾æœ‰ä»¥ä¸‹å‡ ä¸ªåœºæ™¯ï¼š</p><ol><li><p><strong>è¯»å–æ–‡ä»¶ï¼Œç„¶åå†™å…¥å¦ä¸€ä¸ªæ–‡ä»¶</strong></p><p>å‡è®¾ä½ æƒ³è¦è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œå¹¶å°†å…¶å†…å®¹å¤åˆ¶åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> source</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;source.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> destination</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;destination.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">source</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">destination</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Pipeline failed.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Pipeline succeeded.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>è¯»å–æ–‡ä»¶ï¼Œå¯¹å†…å®¹è¿›è¡Œå‹ç¼©ï¼Œç„¶åä¿å­˜</strong></p><p>å¦‚æœæƒ³è¦è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œå°†å…¶å‹ç¼©ï¼ˆæ¯”å¦‚ä½¿ç”¨ gzipï¼‰ï¼Œç„¶åä¿å­˜åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;zlib&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> source</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;input.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> transform</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createGzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> destination</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt.gz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">source</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">destination</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Pipeline failed.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Pipeline succeeded.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>stream.pipeline</code> æä¾›äº†ä¸€ç§ç®€å•æœ‰æ•ˆçš„æ–¹å¼æ¥å¤„ç†å’Œè½¬æ¢æ•°æ®æµã€‚è¿™ä¸ä»…ä»…é™äºæ–‡ä»¶æ“ä½œï¼Œä¹Ÿå¯ä»¥ç”¨äºç½‘ç»œé€šä¿¡ã€æ•°æ®å‹ç¼©ç­‰å¤šç§åœºæ™¯ã€‚å®ƒçš„ä¼˜åŠ¿åœ¨äºæ˜“äºç®¡ç†ï¼Œå¹¶ä¸”èƒ½å¤Ÿè‡ªåŠ¨å¤„ç†æµä¹‹é—´çš„é”™è¯¯ä¼ æ’­å’Œèµ„æºæ¸…ç†ã€‚</p><h3 id="stream-pipeline-streams-options" tabindex="-1"><a class="header-anchor" href="#stream-pipeline-streams-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streampipelinestreams-options" target="_blank" rel="noopener noreferrer">stream.pipeline(streams[, options])</a></span></a></h3><p>Node.js ä¸­çš„ <code>stream.pipeline()</code> æ–¹æ³•æ˜¯ä¸€ä¸ªç”¨äºå°†æµï¼ˆstreamsï¼‰åºåˆ—åŒ–è¿æ¥çš„å·¥å…·ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥å°†å¤šä¸ªæµæ“ä½œè¿æ¥èµ·æ¥ï¼Œæ•°æ®ä¼šä¾æ¬¡é€šè¿‡è¿™äº›æµï¼Œç›´åˆ°æœ€ç»ˆæ“ä½œå®Œæˆã€‚è¿™ä¸ªæ–¹æ³•å°¤å…¶æœ‰ç”¨ï¼Œå› ä¸ºå®ƒè‡ªåŠ¨ç®¡ç†äº†æµä¹‹é—´çš„æ•°æ®ä¼ é€’ï¼Œå¹¶ä¸”åœ¨å‡ºç°é”™è¯¯æ—¶èƒ½å¤Ÿæ­£ç¡®åœ°å…³é—­æ‰€æœ‰æµï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªåœºæ™¯ï¼Œä½ éœ€è¦ä»ä¸€ä¸ªæ–‡ä»¶è¯»å–æ•°æ®ï¼Œç„¶åå‹ç¼©è¿™äº›æ•°æ®ï¼Œå¹¶æœ€ç»ˆå°†å‹ç¼©åçš„æ•°æ®å†™å…¥å¦ä¸€ä¸ªæ–‡ä»¶ã€‚è¿™é‡Œæ¶‰åŠåˆ°ä¸‰ä¸ªæµæ“ä½œï¼šè¯»å–ï¼ˆreadable streamï¼‰ã€å‹ç¼©ï¼ˆtransform streamï¼‰ã€å†™å…¥ï¼ˆwritable streamï¼‰ã€‚</p><p>ä¸ä½¿ç”¨ <code>stream.pipeline()</code> çš„è¯ï¼Œä½ éœ€è¦æ‰‹åŠ¨ç›‘å¬æ¯ä¸ªæµçš„ <code>data</code>ã€<code>error</code> å’Œ <code>end</code> äº‹ä»¶ï¼Œç¡®ä¿æ•°æ®æ­£ç¡®æµåŠ¨å¹¶ä¸”åœ¨å‘ç”Ÿé”™è¯¯æ—¶æ­£ç¡®å¤„ç†ã€‚ä½†æ˜¯ä½¿ç”¨ <code>stream.pipeline()</code>ï¼Œä½ å¯ä»¥ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-1"><span>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;zlib&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªè¯»å–æµï¼Œè¯»å– &#39;input.txt&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> source</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;input.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå†™å…¥æµï¼Œè¾“å‡ºåˆ° &#39;output.txt.gz&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> destination</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt.gz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ª gzip å‹ç¼©æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> gzip</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createGzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ pipeline å°†å®ƒä»¬è¿æ¥èµ·æ¥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">source</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">gzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">destination</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æµå¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å¤„ç†å®Œæˆï¼Œæ–‡ä»¶å‹ç¼©æˆåŠŸã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>stream.pipeline()</code> æ–¹æ³•å°†ä¸€ä¸ªè¯»å–æµã€ä¸€ä¸ª gzip å‹ç¼©è½¬æ¢æµå’Œä¸€ä¸ªå†™å…¥æµè¿æ¥èµ·æ¥ã€‚è¿™æ ·ï¼Œ<code>input.txt</code> çš„å†…å®¹å°±ä¼šè¢«è¯»å–ï¼Œå‹ç¼©ï¼Œç„¶åå†™å…¥ <code>output.txt.gz</code>ã€‚å¦‚æœè¿‡ç¨‹ä¸­ä»»ä½•ä¸€ä¸ªç¯èŠ‚å‡ºç°é”™è¯¯ï¼Œ<code>pipeline</code> ä¼šè‡ªåŠ¨ç¡®ä¿æ‰€æœ‰æµéƒ½è¢«æ­£ç¡®å…³é—­ï¼Œå¹¶ä¸”ä¼šè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œä¼ å…¥é”™è¯¯ä¿¡æ¯ã€‚</p><p>è¿™ç§æ–¹æ³•çš„å¥½å¤„æ˜¯ä»£ç æ›´ç®€æ´ã€æ›´æ˜“äºç»´æŠ¤ï¼Œå¹¶ä¸”è‡ªåŠ¨å¤„ç†äº†æµä¹‹é—´çš„é”™è¯¯ä¼ é€’å’Œèµ„æºç®¡ç†ï¼Œå¤§å¤§é™ä½äº†å‡ºé”™çš„å¯èƒ½æ€§ã€‚</p><h3 id="stream-finished-stream-options" tabindex="-1"><a class="header-anchor" href="#stream-finished-stream-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streamfinishedstream-options" target="_blank" rel="noopener noreferrer">stream.finished(stream[, options])</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥æ·±å…¥ç†è§£ä¸€ä¸‹ Node.js ä¸­çš„ <code>stream.finished(stream[, options])</code>ã€‚</p><p>é¦–å…ˆï¼Œä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ä¸ªåŠŸèƒ½ï¼Œä½ éœ€è¦çŸ¥é“ä»€ä¹ˆæ˜¯æµï¼ˆStreamï¼‰ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ç”¨äºå¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“ä½ å¤„ç†å¤§é‡æ•°æ®ï¼Œæˆ–è€…ä½ ä¸æƒ³ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­æ—¶ã€‚æµå¯ä»¥å¸®åŠ©ä½ ä»¥è¾ƒå°çš„ç‰‡æ®µï¼ˆé€šå¸¸ç§°ä¸ºâ€œå—â€ï¼‰å¤„ç†æ•°æ®ã€‚Node.js ä¸­æœ‰å‡ ç§ç±»å‹çš„æµï¼Œå¦‚è¯»å–æµï¼ˆReadableï¼‰ã€å†™å…¥æµï¼ˆWritableï¼‰ã€è½¬æ¢æµï¼ˆTransformï¼‰å’ŒåŒå‘æµï¼ˆDuplexï¼‰ã€‚</p><h3 id="stream-finished-stream-options-1" tabindex="-1"><a class="header-anchor" href="#stream-finished-stream-options-1"><span>stream.finished(stream[, options])</span></a></h3><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬èšç„¦äº <code>stream.finished</code> æ–¹æ³•ã€‚</p><p><code>stream.finished</code> æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†æµï¼ˆStreamï¼‰ç»“æŸçš„å‡½æ•°ã€‚å½“æµç»“æŸï¼ˆå³æ²¡æœ‰æ›´å¤šçš„æ•°æ®å¯ä¾›è¯»å–ï¼‰ã€å…³é—­æˆ–é‡åˆ°é”™è¯¯æ—¶ï¼Œå®ƒä¼šè¢«è§¦å‘ã€‚è¿™å¯¹äºç¡®ä¿èµ„æºè¢«æ­£ç¡®æ¸…ç†éå¸¸é‡è¦ã€‚</p><h4 id="å‚æ•°" tabindex="-1"><a class="header-anchor" href="#å‚æ•°"><span>å‚æ•°</span></a></h4><ul><li><code>stream</code>: è¿™æ˜¯ä½ æƒ³è¦ç›‘å¬å…¶ç»“æŸäº‹ä»¶çš„æµå¯¹è±¡ã€‚</li><li><code>options</code> (å¯é€‰): ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥åŒ…å« <code>error</code>, <code>readable</code> å’Œ <code>writable</code> å±æ€§ï¼Œå…è®¸ä½ å¯¹ç›‘å¬è¡Œä¸ºè¿›è¡Œå¾®è°ƒã€‚</li></ul><h4 id="è¿”å›å€¼" tabindex="-1"><a class="header-anchor" href="#è¿”å›å€¼"><span>è¿”å›å€¼</span></a></h4><p>è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª Promiseï¼Œå½“æµç»“æŸæ—¶è¿™ä¸ª Promise å°†è¢«è§£å†³ï¼›å¦‚æœæµåœ¨ç»“æŸå‰å‘ç”Ÿé”™è¯¯ï¼ŒPromise å°†è¢«æ‹’ç»ã€‚</p><h4 id="å®é™…åº”ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h4><h5 id="ç¤ºä¾‹-1-ç›‘å¬æ–‡ä»¶è¯»å–æµç»“æŸ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-ç›‘å¬æ–‡ä»¶è¯»å–æµç»“æŸ"><span>ç¤ºä¾‹ 1: ç›‘å¬æ–‡ä»¶è¯»å–æµç»“æŸ</span></a></h5><p>å‡è®¾ä½ æ­£åœ¨ä»ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œä½ å¯èƒ½æƒ³è¦çŸ¥é“ä½•æ—¶è¯»å–å®Œæ¯•ï¼Œä»¥ä¾¿æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œæˆ–è€…è¿›å…¥ä¸‹ä¸€ä¸ªæ­¥éª¤ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">finished</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/large/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">finished</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stream failed.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stream finished successfully.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="ç¤ºä¾‹-2-ä½¿ç”¨-promise-å¤„ç†æµç»“æŸ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ä½¿ç”¨-promise-å¤„ç†æµç»“æŸ"><span>ç¤ºä¾‹ 2: ä½¿ç”¨ Promise å¤„ç†æµç»“æŸ</span></a></h5><p>ç”±äº <code>stream.finished</code> è¿”å›ä¸€ä¸ª Promiseï¼Œä½ å¯ä»¥ä½¿ç”¨ async/await è¯­æ³•æ¥æ›´ä¼˜é›…åœ°å¤„ç†æµçš„ç»“æŸã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">finished</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">promises</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> processFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> finished</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stream finished successfully.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stream failed.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">processFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/large/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œä½ å°±èƒ½å¤Ÿåœ¨æµå¤„ç†å®Œæˆåï¼Œæ–¹ä¾¿åœ°è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼Œæ¯”å¦‚å…³é—­æ•°æ®åº“è¿æ¥ã€é‡Šæ”¾èµ„æºæˆ–è€…ç®€å•åœ°æ‰“å°å‡ºå®Œæˆä¿¡æ¯ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>stream.finished</code> æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„æ–¹æ³•æ¥ç¡®å®šæµä½•æ—¶ç»“æŸã€æ˜¯å¦æˆåŠŸï¼Œå¹¶å…è®¸ä½ æ®æ­¤ä½œå‡ºç›¸åº”çš„å¤„ç†ã€‚è¿™å¯¹äºç¼–å†™å¥å£®ä¸”æ˜“äºç»´æŠ¤çš„ Node.js åº”ç”¨ç¨‹åºè‡³å…³é‡è¦ã€‚</p><h3 id="object-mode" tabindex="-1"><a class="header-anchor" href="#object-mode"><span><a href="https://nodejs.org/docs/latest/api/stream.html#object-mode" target="_blank" rel="noopener noreferrer">Object mode</a></span></a></h3><p>äº†è§£ Node.js ä¸­çš„ Object modeï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ Node.js ä¸­çš„ Streamï¼ˆæµï¼‰æ˜¯ä»€ä¹ˆã€‚åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§å¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œå°¤å…¶æ˜¯å½“ä½ å¤„ç†çš„æ•°æ®é‡å¾ˆå¤§æˆ–è€…ä½ ä¸æƒ³ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­æ—¶ã€‚æµå¯ä»¥è®©ä½ ä»¥è¿ç»­çš„æ–¹å¼è¯»å–æˆ–å†™å…¥æ•°æ®ã€‚Node.js æä¾›äº†å‡ ç§ç±»å‹çš„æµï¼Œæ¯”å¦‚å¯è¯»æµã€å¯å†™æµã€åŒå‘æµå’Œè½¬æ¢æµã€‚</p><p>é€šå¸¸ï¼Œæµæ˜¯ç”¨æ¥å¤„ç†å­—èŠ‚æ•°æ®çš„ï¼Œæ¯”å¦‚ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®æˆ–é€šè¿‡ç½‘ç»œå‘é€æ•°æ®ã€‚ä½†æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›æµèƒ½å¤Ÿå¤„ç†æ›´å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚å¯¹è±¡ã€‚è¿™å°±æ˜¯ Object mode å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚</p><h3 id="object-mode-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#object-mode-æ˜¯ä»€ä¹ˆ"><span>Object mode æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>Object mode å…è®¸æµä¼ è¾“çš„æ•°æ®ä¸ä»…ä»…æ˜¯å­—ç¬¦ä¸²æˆ– Buffer å®ä¾‹ï¼ˆå³å­—èŠ‚ï¼‰ï¼Œè€Œæ˜¯ä»»ä½• JavaScript å¯¹è±¡ã€‚è¿™å¯¹äºé‚£äº›éœ€è¦æ“ä½œä¸€ç³»åˆ—å¯¹è±¡çš„åœºæ™¯ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸ä½ ç›´æ¥åœ¨æµä¸­å¤„ç†é«˜çº§æ•°æ®ç»“æ„ï¼Œè€Œä¸æ˜¯å°†å®ƒä»¬è½¬æ¢æˆå­—ç¬¦ä¸²æˆ– Bufferã€‚</p><h3 id="object-mode-çš„ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#object-mode-çš„ä½¿ç”¨"><span>Object mode çš„ä½¿ç”¨ï¼š</span></a></h3><p>è¦åœ¨ Node.js ä¸­åˆ›å»ºä¸€ä¸ªä»¥ Object mode è¿è¡Œçš„æµï¼Œä½ éœ€è¦åœ¨åˆ›å»ºæµæ—¶è®¾ç½® <code>objectMode</code> é€‰é¡¹ä¸º <code>true</code>ã€‚ä¾‹å¦‚ï¼Œåœ¨åˆ›å»ºä¸€ä¸ªå¯è¯»æµæˆ–å¯å†™æµæ—¶ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªä»¥ Object mode è¿è¡Œçš„å¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> objectReadableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  objectMode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªä»¥ Object mode è¿è¡Œçš„å¯å†™æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> objectWritableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  objectMode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-2"><span>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</span></a></h3><h4 id="_1-æ—¥å¿—å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_1-æ—¥å¿—å¤„ç†"><span>1. æ—¥å¿—å¤„ç†ï¼š</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªæ—¥å¿—å¤„ç†ç³»ç»Ÿï¼Œéœ€è¦ä»å„ç§æ¥æºæ”¶é›†æ—¥å¿—æ•°æ®ï¼Œç„¶åè¿›è¡Œåˆ†æã€æ ¼å¼åŒ–å’Œå­˜å‚¨ã€‚æ—¥å¿—æ¡ç›®å¯ä»¥è¡¨ç¤ºä¸º JavaScript å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡åŒ…å«äº†æ—¥å¿—ä¿¡æ¯çš„ä¸åŒå±æ€§ï¼Œæ¯”å¦‚æ—¶é—´æˆ³ã€æ—¥å¿—çº§åˆ«ã€æ¶ˆæ¯å†…å®¹ç­‰ã€‚</p><p>ä½¿ç”¨ Object modeï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæµï¼Œç›´æ¥å¤„ç†è¿™äº›æ—¥å¿—å¯¹è±¡ï¼Œæ— éœ€å°†å®ƒä»¬è½¬æ¢ä¸ºå­—ç¬¦ä¸²æˆ–å…¶ä»–æ ¼å¼ã€‚è¿™æ ·ï¼Œä½ çš„ä»£ç ä¸ä»…æ›´å®¹æ˜“ç¼–å†™å’Œç†è§£ï¼Œè€Œä¸”æ›´çµæ´»ã€æ›´å¼ºå¤§ã€‚</p><h4 id="_2-æ•°æ®è½¬æ¢" tabindex="-1"><a class="header-anchor" href="#_2-æ•°æ®è½¬æ¢"><span>2. æ•°æ®è½¬æ¢ï¼š</span></a></h4><p>è€ƒè™‘ä¸€ä¸ªéœ€è¦è¯»å–ç”¨æˆ·æ•°æ®ã€è¿›è¡ŒæŸç§è½¬æ¢ç„¶åä¿å­˜ç»“æœçš„åœºæ™¯ã€‚ç”¨æˆ·æ•°æ®å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œæ¯ä¸ªå¯¹è±¡åŒ…å«ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p>ä½ å¯ä»¥ä½¿ç”¨ Object mode æ¥ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼šåˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥è¯»å–ç”¨æˆ·æ•°æ®ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªè½¬æ¢æµï¼ˆä¹Ÿè¿è¡Œåœ¨ Object modeï¼‰è¿›è¡Œå¿…è¦çš„æ•°æ®è½¬æ¢ï¼Œå¹¶æœ€ç»ˆé€šè¿‡ä¸€ä¸ªå¯å†™æµå°†è½¬æ¢åçš„æ•°æ®ä¿å­˜èµ·æ¥ã€‚</p><p>è¿™é‡Œçš„å…³é”®ç‚¹æ˜¯ï¼Œé€šè¿‡æ•´ä¸ªæµç¨‹ï¼Œä½ éƒ½åœ¨ç›´æ¥æ“ä½œ JavaScript å¯¹è±¡ï¼Œè¿™ä½¿å¾—å¤„ç†å¤æ‚æ•°æ®å˜å¾—ç›´æ¥å’Œç®€å•ã€‚</p><p>æ€»ä¹‹ï¼ŒObject mode æ˜¯ Node.js æµçš„ä¸€ä¸ªå¼ºå¤§ç‰¹æ€§ï¼Œå®ƒå…è®¸ä½ ä»¥éå¸¸è‡ªç„¶å’Œç›´æ¥çš„æ–¹å¼å¤„ç†å¤æ‚çš„æ•°æ®ç»“æ„ã€‚æ— è®ºæ˜¯åœ¨æ•°æ®å¤„ç†ã€æ•°æ®è½¬æ¢è¿˜æ˜¯æ„å»ºå¤æ‚çš„ I/O å¤„ç†ç®¡é“æ–¹é¢ï¼ŒObject mode éƒ½ä¸ºå¼€å‘äººå‘˜æä¾›äº†æå¤§çš„çµæ´»æ€§å’Œä¾¿åˆ©ã€‚</p><h3 id="buffering" tabindex="-1"><a class="header-anchor" href="#buffering"><span><a href="https://nodejs.org/docs/latest/api/stream.html#buffering" target="_blank" rel="noopener noreferrer">Buffering</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµ(Stream)æ˜¯ä¸€ç§å¤„ç†è¯»å–æˆ–å†™å…¥æ•°æ®çš„æ–¹å¼ï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰ã€‚æµå¯ä»¥é«˜æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®ï¼Œå› ä¸ºå®ƒä»¬å…è®¸æ•°æ®åˆ†æ‰¹æ¬¡å¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™æ­£æ˜¯æµçš„æ ¸å¿ƒä¼˜åŠ¿ï¼šèŠ‚çœå†…å­˜å’Œæå‡æ€§èƒ½ã€‚</p><h3 id="ç¼“å†²-buffering" tabindex="-1"><a class="header-anchor" href="#ç¼“å†²-buffering"><span>ç¼“å†²ï¼ˆBufferingï¼‰</span></a></h3><p>ç¼“å†²æ˜¯æµå¤„ç†ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚å½“ä½ ä½¿ç”¨æµæ—¶ï¼Œæ•°æ®ä¼šè¢«åˆ†æˆå°å—è¿›è¡Œå¤„ç†ã€‚è¿™äº›å°å—æ•°æ®åœ¨è¢«æœ€ç»ˆå¤„ç†ï¼ˆæ¯”å¦‚æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€å†™å…¥ç£ç›˜æˆ–é€šè¿‡ç½‘ç»œå‘é€ï¼‰ä¹‹å‰ï¼Œä¼šæš‚æ—¶å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«åšâ€œç¼“å†²â€ã€‚</p><h4 id="ä¸ºä»€ä¹ˆéœ€è¦ç¼“å†²" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦ç¼“å†²"><span>ä¸ºä»€ä¹ˆéœ€è¦ç¼“å†²ï¼Ÿ</span></a></h4><ul><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šé€šè¿‡å‡å°‘å¯¹èµ„æºçš„é¢‘ç¹è®¿é—®ï¼ˆä¾‹å¦‚ç¡¬ç›˜è¯»å†™æ“ä½œï¼‰ï¼Œç¼“å†²å¯ä»¥æ˜¾è‘—æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚</li><li><strong>æ•°æ®æ•´åˆ</strong>ï¼šæœ‰æ—¶å€™ï¼Œå•ä¸ªæ•°æ®å—å¯èƒ½æ— æ³•å®Œæˆç‰¹å®šçš„æ“ä½œï¼Œç¼“å†²å…è®¸å°†å¤šä¸ªæ•°æ®å—èšé›†èµ·æ¥ï¼Œç›´åˆ°ç§¯ç´¯è¶³å¤Ÿçš„æ•°æ®é‡åå†è¿›è¡Œå¤„ç†ã€‚</li></ul><h4 id="node-js-ä¸­çš„æµå’Œç¼“å†²" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„æµå’Œç¼“å†²"><span>Node.js ä¸­çš„æµå’Œç¼“å†²</span></a></h4><p>Node.js æä¾›äº†å››ç§åŸºæœ¬çš„æµç±»å‹ï¼š</p><ol><li><strong>å¯è¯»æµ</strong> (<code>Readable</code>)ï¼šå…è®¸ Node.js ä»ä¸€ä¸ªèµ„æºï¼ˆä¾‹å¦‚æ–‡ä»¶æˆ–ç½‘ç»œè¯·æ±‚ï¼‰è¯»å–æ•°æ®ã€‚</li><li><strong>å¯å†™æµ</strong> (<code>Writable</code>)ï¼šå…è®¸ Node.js å‘ä¸€ä¸ªèµ„æºå†™å…¥æ•°æ®ã€‚</li><li><strong>åŒå·¥æµ</strong> (<code>Duplex</code>)ï¼šæ—¢å¯è¯»åˆå¯å†™ï¼Œåƒ TCP å¥—æ¥å­—ä¸€æ ·ã€‚</li><li><strong>è½¬æ¢æµ</strong> (<code>Transform</code>)ï¼šå¯ä»¥åœ¨è¯»å†™è¿‡ç¨‹ä¸­ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®çš„åŒå·¥æµã€‚</li></ol><p>å½“æ•°æ®é€šè¿‡æµä¼ è¾“æ—¶ï¼Œå¦‚æœæ¶ˆè´¹è€…ï¼ˆå¤„ç†æ•°æ®çš„éƒ¨åˆ†ï¼‰çš„é€Ÿåº¦è·Ÿä¸ä¸Šç”Ÿäº§è€…ï¼ˆç”Ÿæˆæ•°æ®çš„éƒ¨åˆ†ï¼‰çš„é€Ÿåº¦ï¼Œå°±éœ€è¦ç¼“å†²æœºåˆ¶æ¥å¤„ç†è¿™ç§é€Ÿåº¦ä¸åŒ¹é…ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-3"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="_1-æ–‡ä»¶è¯»å–" tabindex="-1"><a class="header-anchor" href="#_1-æ–‡ä»¶è¯»å–"><span>1. æ–‡ä»¶è¯»å–</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦ä»ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚å¦‚æœä½ ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œå¯¹äºéå¸¸å¤§çš„æ–‡ä»¶ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºå´©æºƒæˆ–è¿è¡Œç¼“æ…¢ã€‚ä½¿ç”¨æµå’Œç¼“å†²ï¼Œä½ å¯ä»¥é€æ­¥åœ°è¯»å–æ–‡ä»¶ï¼Œæ¯æ¬¡åªå¤„ç†ä¸€å°å—æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¯æ¬¡æ”¶åˆ°æ•°æ®å—æ—¶è§¦å‘&#39;data&#39;äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ•°æ®è¯»å–å®Œæ¯•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No more data.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-ç½‘ç»œè¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#_2-ç½‘ç»œè¯·æ±‚"><span>2. ç½‘ç»œè¯·æ±‚</span></a></h4><p>å½“ä½ çš„ Node.js æœåŠ¡å™¨æ¥æ”¶åˆ°ä¸€ä¸ªå¤§å‹çš„ POST è¯·æ±‚æ—¶ï¼Œä¾‹å¦‚ä¸Šä¼ æ–‡ä»¶ï¼Œä½ ä¸ä¼šå¸Œæœ›å°†æ•´ä¸ªè¯·æ±‚è½½å…¥å†…å­˜ä¸­ï¼Œå› ä¸ºè¿™æ ·åšæ•ˆç‡ä½ä¸‹ä¸”å®¹æ˜“è¶…å‡ºå†…å­˜é™åˆ¶ã€‚ç›¸åï¼Œä½ å¯ä»¥å°†è¯·æ±‚ä½œä¸ºä¸€ä¸ªæµæ¥å¤„ç†ï¼Œé€æ­¥è¯»å–è¯·æ±‚ä½“ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ¥æ”¶æ•°æ®ä¸º UTF8 å­—ç¬¦ä¸²ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¦‚æœæ²¡æœ‰è®¾ç½®å­—ç¬¦ç¼–ç ï¼Œåˆ™æ¥æ”¶åˆ°çš„æ˜¯ Buffer å¯¹è±¡ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ•´ä¸ªè¯·æ±‚ä½“å·²è¢«æ¥æ”¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ok&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸¤ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨æµå’Œç¼“å†²æ¥é«˜æ•ˆå¤„ç†å¤§é‡æ•°æ®ï¼Œä»è€Œæé«˜åº”ç”¨æ€§èƒ½å¹¶é¿å…å†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚</p><h2 id="api-for-stream-consumers" tabindex="-1"><a class="header-anchor" href="#api-for-stream-consumers"><span><a href="https://nodejs.org/docs/latest/api/stream.html#api-for-stream-consumers" target="_blank" rel="noopener noreferrer">API for stream consumers</a></span></a></h2><p>Node.js ä¸­çš„ Streams æ˜¯ä¸€ç§å¤„ç†æ•°æ®ï¼ˆå¦‚è¯»å–æ–‡ä»¶æˆ–ç½‘ç»œè¯·æ±‚ï¼‰çš„æ–¹å¼ï¼Œå®ƒå…è®¸æ•°æ®è¢«é€å—å¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–è€…ä»æ…¢é€Ÿè®¾å¤‡è¯»å–æ•°æ®æ—¶å°¤å…¶æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥å‡å°‘å†…å­˜çš„ä½¿ç”¨ï¼Œæé«˜åº”ç”¨çš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚</p><h3 id="api-for-stream-consumers-1" tabindex="-1"><a class="header-anchor" href="#api-for-stream-consumers-1"><span>API for stream consumers</span></a></h3><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œâ€œAPI for stream consumersâ€ä¸»è¦æŒ‡çš„æ˜¯ç»™é‚£äº›éœ€è¦æ¶ˆè´¹ï¼ˆå³è¯»å–æˆ–ä½¿ç”¨ï¼‰æµæ•°æ®çš„å¼€å‘è€…æä¾›çš„æ¥å£ã€‚å…·ä½“æ¥è¯´ï¼Œè¿™äº› API å…è®¸ä½ ä»¥ä¸€ç§ç®€å•ã€ç»Ÿä¸€çš„æ–¹å¼ä»æµä¸­è¯»å–æ•°æ®ï¼Œæ— è®ºæ˜¯æ–‡ä»¶ç³»ç»Ÿçš„æµã€HTTP å“åº”çš„æµè¿˜æ˜¯å…¶ä»–ç±»å‹çš„æµã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-4"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-è¯»å–æ–‡ä»¶å†…å®¹" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-è¯»å–æ–‡ä»¶å†…å®¹"><span>ä¾‹å­ 1: è¯»å–æ–‡ä»¶å†…å®¹</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªå¤§å‹æ—¥å¿—æ–‡ä»¶ï¼Œä½ æƒ³é€è¡Œè¯»å–å¹¶åˆ†ææ¯ä¸€è¡Œã€‚ç›´æ¥å°†æ•´ä¸ªæ–‡ä»¶ä¸€æ¬¡æ€§è½½å…¥å†…å­˜å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œç‰¹åˆ«æ˜¯åœ¨å†…å­˜èµ„æºæœ‰é™çš„æƒ…å†µä¸‹ã€‚è¿™æ—¶ï¼Œä½¿ç”¨æµå°±æ˜¾å¾—éå¸¸æœ‰ç”¨äº†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ fs.createReadStream åˆ›å»ºä¸€ä¸ªè¯»å–æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fileStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/your/large/file.log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> rl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  input</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fileStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  crlfDelay</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">Infinity</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">rl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;line&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Line from file: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">line</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™é‡Œå¯ä»¥å¯¹æ¯ä¸€è¡Œè¿›è¡Œå¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">rl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;close&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Finished reading the file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-2-å¤„ç†-http-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-å¤„ç†-http-è¯·æ±‚"><span>ä¾‹å­ 2: å¤„ç† HTTP è¯·æ±‚</span></a></h4><p>å½“ä½ åˆ›å»ºä¸€ä¸ªåŸºäº Node.js çš„æœåŠ¡å™¨æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨çš„æ•°æ®ï¼ˆæ¯”å¦‚ä¸Šä¼ çš„æ–‡ä»¶ï¼‰ä¹Ÿå¯ä»¥è¢«è§†ä¸ºæµã€‚ä½ å¯ä»¥é€å—åœ°å¤„ç†è¿™äº›æ•°æ®ï¼Œè€Œä¸æ˜¯ç­‰å¾…æ‰€æœ‰æ•°æ®ä¸€æ¬¡æ€§åˆ°è¾¾ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">method</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;POST&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è½¬æ¢ Buffer åˆ°å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ•°æ®æ¥æ”¶å®Œæ¯•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Data received&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Send a POST request to submit data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server listening on port 8080&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éƒ½åˆ©ç”¨äº† Node.js çš„æµå¤„ç†æœºåˆ¶æ¥é€æ­¥å¤„ç†æ•°æ®ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯æé«˜äº†ç¨‹åºçš„æ€§èƒ½ï¼Œå¹¶å‡å°‘äº†å†…å­˜çš„ä½¿ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œâ€œAPI for stream consumersâ€æ˜¯ Node.js æä¾›ç»™å¼€å‘è€…ç”¨äºé«˜æ•ˆã€çµæ´»å¤„ç†æµæ•°æ®çš„ä¸€ç»„ APIï¼Œé€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°å®ƒä»¬åœ¨å®è·µä¸­æ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„ã€‚</p><h3 id="writable-streams" tabindex="-1"><a class="header-anchor" href="#writable-streams"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writable-streams" target="_blank" rel="noopener noreferrer">Writable streams</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæµ(Streams)æ˜¯å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«é€‚ç”¨äºå¤„ç†å¤§é‡æ•°æ®æˆ–è€…ä»ä¸€ä¸ªåœ°æ–¹é€æ­¥ç§»åŠ¨æ•°æ®åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚å¯å†™æµï¼ˆWritable streamsï¼‰æ˜¯æµçš„ä¸€ç§ç±»å‹ï¼Œå®ƒå…è®¸ä½ å‘ç›®æ ‡å†™å…¥æ•°æ®ã€‚</p><h3 id="å¯å†™æµ-writable-streams" tabindex="-1"><a class="header-anchor" href="#å¯å†™æµ-writable-streams"><span>å¯å†™æµï¼ˆWritable Streamsï¼‰</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œå¯å†™æµå°±åƒæ˜¯ä¸€ä¸ªæ°´ç®¡ï¼Œä½ å¯ä»¥å°†æ°´ï¼ˆåœ¨è¿™ä¸ªæ¯”å–»ä¸­ï¼Œæ°´ä»£è¡¨æ•°æ®ï¼‰é€å…¥æ°´ç®¡çš„ä¸€ç«¯ã€‚è¿™äº›æ°´éšåä¼šæµç»æ°´ç®¡ï¼Œå¹¶æœ€ç»ˆåˆ°è¾¾æŒ‡å®šçš„ç›®æ ‡ï¼ˆæ¯”å¦‚æ–‡ä»¶ã€å¦ä¸€ä¸ªæµæˆ–è€…ä»»ä½•èƒ½æ¥å—æ•°æ®çš„åœ°æ–¹ï¼‰ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>fs.createWriteStream</code> æ–¹æ³•å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªå‘æ–‡ä»¶å†™å…¥æ•°æ®çš„å¯å†™æµã€‚åŒæ—¶ï¼Œè®¸å¤šå…¶ä»–çš„ Node.js API ä¹Ÿè¿”å›å¯å†™æµå¯¹è±¡ï¼Œä¾‹å¦‚ï¼ŒHTTP è¯·æ±‚çš„å“åº”å¯¹è±¡å°±æ˜¯ä¸€ä¸ªå¯å†™æµã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-å‘æ–‡ä»¶å†™å…¥æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-å‘æ–‡ä»¶å†™å…¥æ•°æ®"><span>ç¤ºä¾‹ 1ï¼šå‘æ–‡ä»¶å†™å…¥æ•°æ®</span></a></h4><p>å‡è®¾ä½ æƒ³å°†ä¸€äº›æ–‡æœ¬å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå‘ &quot;example.txt&quot; å†™å…¥çš„å¯å†™æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ write æ–¹æ³•å†™å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†è§ï¼Œä¸–ç•Œï¼</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æœ€åï¼Œä½¿ç”¨ end æ–¹æ³•å®Œæˆå†™å…¥è¿‡ç¨‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº† <code>fs</code> æ¨¡å—æ¥ä¸æ–‡ä»¶ç³»ç»Ÿäº¤äº’ã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘ <code>&quot;example.txt&quot;</code> æ–‡ä»¶çš„å¯å†™æµã€‚é€šè¿‡è°ƒç”¨ <code>write</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å‘è¯¥æ–‡ä»¶å†™å…¥æ•°æ®ã€‚æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨äº† <code>end</code> æ–¹æ³•è¡¨ç¤ºæˆ‘ä»¬å®Œæˆäº†å†™å…¥è¿‡ç¨‹ã€‚</p><h4 id="ç¤ºä¾‹-2-å¤åˆ¶æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-å¤åˆ¶æ–‡ä»¶"><span>ç¤ºä¾‹ 2ï¼šå¤åˆ¶æ–‡ä»¶</span></a></h4><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„ä¾‹å­ â€”â€” ä½¿ç”¨å¯è¯»æµå’Œå¯å†™æµæ¥å¤åˆ¶ä¸€ä¸ªæ–‡ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªä»æºæ–‡ä»¶è¯»å–çš„å¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;source.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå‘ç›®æ ‡æ–‡ä»¶å†™å…¥çš„å¯å†™æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;destination.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†å¯è¯»æµçš„æ•°æ®ä¼ è¾“åˆ°å¯å†™æµï¼ˆå³å¤åˆ¶æ–‡ä»¶ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ­¤ä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªå¯è¯»æµï¼Œç”¨äºä» <code>&#39;source.txt&#39;</code> æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºäº†å¦ä¸€ä¸ªå¯å†™æµï¼Œç›®æ ‡æ˜¯ <code>&#39;destination.txt&#39;</code> æ–‡ä»¶ã€‚é€šè¿‡è°ƒç”¨ <code>pipe</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å°†å¯è¯»æµçš„æ•°æ®ç›´æ¥ä¼ è¾“åˆ°å¯å†™æµä¸­ï¼Œä»è€Œå®ç°æ–‡ä»¶çš„å¤åˆ¶ã€‚</p><h3 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h3><p>å¯å†™æµåœ¨ Node.js ä¸­æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ¦‚å¿µï¼Œå®ƒä½¿å¾—å¤„ç†è¾“å‡ºæ•°æ®ï¼ˆå¦‚å†™å…¥æ–‡ä»¶ã€å‘å®¢æˆ·ç«¯å‘é€ HTTP å“åº”ç­‰ï¼‰å˜å¾—æ›´åŠ çµæ´»å’Œé«˜æ•ˆã€‚é€šè¿‡ç»“åˆä½¿ç”¨å¯è¯»æµå’Œå¯å†™æµï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å¤„ç†å„ç§æ•°æ®ä¼ è¾“å’Œè½¬æ¢ä»»åŠ¡ã€‚</p><h4 id="class-stream-writable" tabindex="-1"><a class="header-anchor" href="#class-stream-writable"><span><a href="https://nodejs.org/docs/latest/api/stream.html#class-streamwritable" target="_blank" rel="noopener noreferrer">Class: stream.Writable</a></span></a></h4><p>å½“ä½ å¬åˆ°â€œNode.jsâ€æ—¶ï¼Œå¯ä»¥æƒ³è±¡å®ƒæ˜¯ä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šçš„å¹³å°ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç ï¼Œå¤„ç†æ•°æ®åº“ã€æ–‡ä»¶æ“ä½œç­‰ä»»åŠ¡ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamsï¼‰æ˜¯ä¸€ç§å¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†å¤§é‡æ•°æ®æˆ–è€…è¿ç»­çš„æ•°æ®æµã€‚é€šè¿‡æµï¼Œä½ å¯ä»¥ä¸€å°å—ä¸€å°å—åœ°è¯»å–æˆ–å†™å…¥æ•°æ®ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™æ ·åšæœ‰å¾ˆå¤šå¥½å¤„ï¼Œæ¯”å¦‚æé«˜æ€§èƒ½å’Œå‡å°‘å†…å­˜ä½¿ç”¨ã€‚</p><p><code>stream.Writable</code>æ˜¯ Node.js æµçš„ä¸€ä¸ªé‡è¦ç±»ï¼Œå±äºå¯å†™æµçš„èŒƒç•´ã€‚é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªç±»ä¸»è¦ç”¨äºå†™å…¥æ•°æ®ã€‚å®ƒæ˜¯å¾ˆå¤šç±»å‹å¯å†™æµçš„åŸºç¡€ï¼Œä¾‹å¦‚æ–‡ä»¶å†™å…¥æµã€HTTP å“åº”æµç­‰ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-2"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>è®©æˆ‘ä»¬çœ‹å‡ ä¸ªå¦‚ä½•ä½¿ç”¨<code>stream.Writable</code>çš„ä¾‹å­ï¼š</p><h4 id="_1-å†™å…¥æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_1-å†™å…¥æ–‡ä»¶"><span>1. å†™å…¥æ–‡ä»¶</span></a></h4><p>å‡è®¾ä½ æƒ³æŠŠä¿¡æ¯æ—¥å¿—å†™å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>fs.createWriteStream()</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ªå†™å…¥æµï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªä»¥<code>stream.Writable</code>ä¸ºåŸºç¡€çš„æµå¯¹è±¡ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµï¼Œå†™å…¥åˆ°log.txtæ–‡ä»¶ä¸­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writeStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;log.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨writeæ–¹æ³•å†™å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯ç¬¬ä¸€è¡Œæ—¥å¿—</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯ç¬¬äºŒè¡Œæ—¥å¿—</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç»“æŸå†™å…¥è¿‡ç¨‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç»“æŸæ—¥å¿—è®°å½•ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æŠŠæ–‡æœ¬å†™å…¥<code>log.txt</code>æ–‡ä»¶ã€‚æ¯è°ƒç”¨ä¸€æ¬¡<code>writeStream.write()</code>æ–¹æ³•å°±å†™å…¥ä¸€å—æ•°æ®ã€‚æœ€åè°ƒç”¨<code>writeStream.end()</code>è¡¨ç¤ºå®Œæˆå†™å…¥ã€‚</p><h4 id="_2-http-å“åº”" tabindex="-1"><a class="header-anchor" href="#_2-http-å“åº”"><span>2. HTTP å“åº”</span></a></h4><p>åœ¨åˆ›å»º Web æœåŠ¡å™¨æ—¶ï¼ŒHTTP å“åº”å¯¹è±¡å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ª<code>Writable</code>æµã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨æµçš„æ–¹æ³•æ¥å‘é€å“åº”ç»™å®¢æˆ·ç«¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‘é€å“åº”å¤´ä¿¡æ¯åŠçŠ¶æ€ç </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä½¿ç”¨res.write()å‘é€æ•°æ®å—</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯å“åº”çš„ç»“æŸã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ç»“æŸå“åº”å¹¶å¯é€‰åœ°å‘é€æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬8080ç«¯å£</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ã€‚å½“æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡<code>res</code>å¯¹è±¡ï¼ˆå®ƒæ˜¯ä¸€ä¸ª<code>Writable</code>æµï¼‰å‘é€å“åº”ã€‚å…ˆé€šè¿‡<code>res.writeHead()</code>è®¾ç½®å“åº”å¤´ï¼Œç„¶åé€å—å‘é€æ•°æ®ï¼ˆä¾‹å¦‚&quot;Hello, World!\n&quot;ï¼‰ï¼Œæœ€åè°ƒç”¨<code>res.end()</code>æ ‡è®°å“åº”ç»“æŸã€‚</p><h3 id="æ€»ç»“-1" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-1"><span>æ€»ç»“</span></a></h3><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>stream.Writable</code>å¯¹è±¡å¦‚ä½•ä½¿å¾—æ•°æ®å†™å…¥å˜å¾—é«˜æ•ˆå’Œçµæ´»ã€‚æ— è®ºæ˜¯å†™å…¥æ–‡ä»¶ï¼Œè¿˜æ˜¯å‘é€ HTTP å“åº”ï¼Œå¯å†™æµéƒ½æä¾›äº†ä¸€ç§æµå¼å¤„ç†æ•°æ®çš„å¼ºå¤§æ–¹æ³•ã€‚åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–è€…éœ€è¦å³æ—¶å¤„ç†æ•°æ®çš„åœºæ™¯ä¸‹ï¼Œäº†è§£å¹¶æ­£ç¡®ä½¿ç”¨ Node.js ä¸­çš„æµå°†éå¸¸æœ‰å¸®åŠ©ã€‚</p><h5 id="event-close" tabindex="-1"><a class="header-anchor" href="#event-close"><span><a href="https://nodejs.org/docs/latest/api/stream.html#event-close" target="_blank" rel="noopener noreferrer">Event: &#39;close&#39;</a></span></a></h5><p>Node.js ä¸­çš„<code>Event: &#39;close&#39;</code>æ˜¯ä¸€ä¸ªä¸æµï¼ˆstreamsï¼‰ç›¸å…³çš„æ¦‚å¿µã€‚åœ¨è§£é‡Šè¿™ä¸ªäº‹ä»¶ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é¦–å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯æµä»¥åŠå®ƒä»¬åœ¨ Node.js ä¸­çš„è¿ç”¨ã€‚</p><h3 id="æµ-streams-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#æµ-streams-ç®€ä»‹"><span>æµï¼ˆStreamsï¼‰ç®€ä»‹</span></a></h3><p>æµæ˜¯ Node.js ä¸­å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“ä½ éœ€è¦å¤„ç†å¤§é‡æ•°æ®æˆ–è€…ä½ æƒ³é€æ­¥æ¥æ”¶æ•°æ®æ—¶ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªéå¸¸å¤§çš„æ–‡ä»¶éœ€è¦è¯»å–ï¼Œä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå´©æºƒæˆ–è€…è¿è¡Œéå¸¸ç¼“æ…¢ã€‚ä½¿ç”¨æµï¼Œä½ å¯ä»¥ä¸€å°å—ä¸€å°å—åœ°å¤„ç†è¿™ä¸ªæ–‡ä»¶ï¼Œè¿™æ ·å°±ä¸ä¼šå ç”¨å¤ªå¤šå†…å­˜ï¼ŒåŒæ—¶ä¹Ÿå…è®¸ç”¨æˆ·æ›´å¿«åœ°å¼€å§‹å¤„ç†æ•°æ®ï¼Œè€Œä¸æ˜¯ç­‰å¾…æ•´ä¸ªæ–‡ä»¶éƒ½è¢«åŠ è½½åæ‰å¼€å§‹ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæœ‰å››ç§åŸºæœ¬çš„æµç±»å‹ï¼š</p><ul><li><strong>Readable Streams</strong>ï¼šç”¨äºè¯»å–æ•°æ®ï¼ˆå¦‚ä»æ–‡ä»¶è¯»å–ï¼‰ã€‚</li><li><strong>Writable Streams</strong>ï¼šç”¨äºå†™å…¥æ•°æ®ï¼ˆå¦‚å†™å…¥æ–‡ä»¶ï¼‰ã€‚</li><li><strong>Duplex Streams</strong>ï¼šæ—¢å¯è¯»åˆå¯å†™ã€‚</li><li><strong>Transform Streams</strong>ï¼šåœ¨è¯»å†™è¿‡ç¨‹ä¸­å¯ä»¥ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®çš„ Duplex æµã€‚</li></ul><h3 id="event-close-1" tabindex="-1"><a class="header-anchor" href="#event-close-1"><span>Event: &#39;close&#39;</span></a></h3><p>ç°åœ¨æˆ‘ä»¬æ¥è°ˆè°ˆ<code>Event: &#39;close&#39;</code>ã€‚è¿™æ˜¯ä¸€ä¸ªåœ¨æµæˆ–èµ„æºè¢«å…³é—­æ—¶è§¦å‘çš„äº‹ä»¶ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æµéƒ½ä¼šè§¦å‘<code>&#39;close&#39;</code>äº‹ä»¶ã€‚åªæœ‰å½“åº•å±‚èµ„æºï¼ˆå¦‚æ–‡ä»¶æè¿°ç¬¦ï¼‰è¢«æ˜¾å¼å…³é—­æ—¶ï¼Œè¿™ä¸ªäº‹ä»¶æ‰ä¼šè¢«è§¦å‘ã€‚</p><h4 id="ä¸ºä»€ä¹ˆ-close-äº‹ä»¶å¾ˆé‡è¦" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-close-äº‹ä»¶å¾ˆé‡è¦"><span>ä¸ºä»€ä¹ˆ<code>&#39;close&#39;</code>äº‹ä»¶å¾ˆé‡è¦ï¼š</span></a></h4><ul><li>å®ƒå‘Šè¯‰ä½ æµå·²ç»å®Œæˆäº†å®ƒçš„ä»»åŠ¡ï¼Œæ²¡æœ‰æ›´å¤šçš„æ•°æ®å¯ä»¥è¢«è¯»å–æˆ–å†™å…¥ï¼Œä¸”èµ„æºå·²è¢«æ¸…ç†ã€‚</li><li>å®ƒå¯ä»¥ä½œä¸ºæ‰§è¡Œæ¸…ç†ä»£ç ï¼ˆå¦‚é‡Šæ”¾èµ„æºæˆ–é€šçŸ¥å…¶ä»–éƒ¨åˆ†åº”ç”¨ç¨‹åºï¼‰çš„ä¿¡å·ã€‚</li></ul><h4 id="å®é™…åº”ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-1"><span>å®é™…åº”ç”¨ç¤ºä¾‹ï¼š</span></a></h4><h5 id="ç¤ºä¾‹-1-ä½¿ç”¨fs-createreadstreamæ¥è¯»å–æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-ä½¿ç”¨fs-createreadstreamæ¥è¯»å–æ–‡ä»¶"><span>ç¤ºä¾‹ 1: ä½¿ç”¨<code>fs.createReadStream</code>æ¥è¯»å–æ–‡ä»¶</span></a></h5><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦ä»ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­è¯»å–æ•°æ®è¿›è¡Œå¤„ç†ã€‚ä½ å¯ä»¥ä½¿ç”¨<code>fs.createReadStream</code>åˆ›å»ºä¸€ä¸ªå¯è¯»æµï¼Œå¹¶ç›‘å¬<code>&#39;close&#39;</code>äº‹ä»¶æ¥çŸ¥é“ä½•æ—¶æ–‡ä»¶å·²ç»è¢«å®Œå…¨è¯»å–å¹¶ä¸”æµå·²ç»å…³é—­ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/large/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬&#39;close&#39;äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;close&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No more data to read. Stream is closed.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="ç¤ºä¾‹-2-ä½¿ç”¨http-createserverå¤„ç†-http-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ä½¿ç”¨http-createserverå¤„ç†-http-è¯·æ±‚"><span>ç¤ºä¾‹ 2: ä½¿ç”¨<code>http.createServer</code>å¤„ç† HTTP è¯·æ±‚</span></a></h5><p>å½“ä½ ä½¿ç”¨ Node.js çš„<code>http</code>æ¨¡å—åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨æ—¶ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå¯è¯»æµã€‚è™½ç„¶ä½ ä¸ä¸€å®šéœ€è¦æ‰‹åŠ¨ç›‘å¬æ¯ä¸ªè¯·æ±‚çš„<code>&#39;close&#39;</code>äº‹ä»¶ï¼Œä½†äº†è§£å®ƒçš„å­˜åœ¨å¯¹äºç†è§£æµå’Œè¯·æ±‚ç”Ÿå‘½å‘¨æœŸæ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // req æ˜¯ä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // res æ˜¯ä¸€ä¸ªå¯å†™æµ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received data: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è¯·æ±‚æ•°æ®å·²å…¨éƒ¨æ¥æ”¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;close&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è¿™é‡Œå¯ä»¥å¤„ç†è¯·æ±‚è¢«æå‰ç»ˆæ­¢çš„æƒ…å†µ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Request was closed before it finished.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server listening on port 3000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œé€šè¿‡ç›‘å¬<code>&#39;data&#39;</code>ã€<code>&#39;end&#39;</code>å’Œ<code>&#39;close&#39;</code>äº‹ä»¶ï¼Œä½ å¯ä»¥å¯¹æ•°æ®æµè¿›è¡Œæœ‰æ•ˆç®¡ç†ï¼Œå¹¶åœ¨æµç»“æŸæˆ–å¼‚å¸¸å…³é—­æ—¶æ‰§è¡Œå¿…è¦çš„æ“ä½œã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œ<code>Event: &#39;close&#39;</code>æ˜¯ç†è§£å’Œä½¿ç”¨ Node.js ä¸­æµæœºåˆ¶çš„ä¸€ä¸ªé‡è¦æ–¹é¢ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°æ§åˆ¶æ•°æ®å¤„ç†è¿‡ç¨‹ä»¥åŠåŠæ—¶é‡Šæ”¾èµ„æºã€‚</p><h5 id="event-drain" tabindex="-1"><a class="header-anchor" href="#event-drain"><span><a href="https://nodejs.org/docs/latest/api/stream.html#event-drain" target="_blank" rel="noopener noreferrer">Event: &#39;drain&#39;</a></span></a></h5><p>ç†è§£ Node.js ä¸­çš„<code>&#39;drain&#39;</code>äº‹ä»¶å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€äº›åŸºç¡€æ¦‚å¿µï¼Œç‰¹åˆ«æ˜¯å…³äºæµï¼ˆStreamsï¼‰å’ŒèƒŒå‹ï¼ˆBackpressureï¼‰ã€‚</p><h3 id="æµ-streams-ç®€ä»‹-1" tabindex="-1"><a class="header-anchor" href="#æµ-streams-ç®€ä»‹-1"><span>æµï¼ˆStreamsï¼‰ç®€ä»‹</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚æƒ³è±¡ä¸€ä¸‹æ°´æµï¼šæ•°æ®åƒæ°´ä¸€æ ·ä»ä¸€ä¸ªåœ°æ–¹æµå‘å¦ä¸€ä¸ªåœ°æ–¹ã€‚åœ¨ç¼–ç¨‹ä¸­ï¼Œè¿™å¯ä»¥æ˜¯æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰æ“ä½œã€‚Node.js æœ‰å››ç§åŸºæœ¬çš„æµç±»å‹ï¼š</p><ul><li><strong>Readable</strong> æµï¼ˆå¯è¯»æµï¼‰ï¼šä¾‹å¦‚ä»æ–‡ä»¶è¯»å–æ•°æ®ã€‚</li><li><strong>Writable</strong> æµï¼ˆå¯å†™æµï¼‰ï¼šä¾‹å¦‚å‘æ–‡ä»¶å†™å…¥æ•°æ®ã€‚</li><li><strong>Duplex</strong> æµï¼ˆåŒå·¥æµï¼‰ï¼šå³å¯è¯»ä¹Ÿå¯å†™ï¼Œå¦‚ TCP å¥—æ¥å­—ã€‚</li><li><strong>Transform</strong> æµï¼ˆè½¬æ¢æµï¼‰ï¼šæ˜¯ä¸€ç§ç‰¹æ®Šçš„åŒå·¥æµï¼Œå®ƒå¯ä»¥ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®ï¼Œç„¶åè¾“å‡ºã€‚</li></ul><h3 id="èƒŒå‹-backpressure" tabindex="-1"><a class="header-anchor" href="#èƒŒå‹-backpressure"><span>èƒŒå‹ï¼ˆBackpressureï¼‰</span></a></h3><p>èƒŒå‹å‘ç”Ÿåœ¨æ•°æ®çš„æ¥æ”¶é€Ÿåº¦è¶…è¿‡äº†å¤„ç†æˆ–ä¼ è¾“é€Ÿåº¦æ—¶ã€‚æƒ³è±¡ä½ æœ‰ä¸€æ¡æ°´ç®¡ï¼Œæ°´æºä¾›åº”çš„æ°´é‡çªç„¶å¢å¤šï¼Œè€Œç®¡é“å®¹é‡æˆ–å‡ºå£æ²¡æœ‰ç›¸åº”å¢åŠ ï¼Œè¿™æ—¶å€™å°±ä¼šäº§ç”Ÿå‹åŠ›ï¼Œç›´åˆ°æ‰¾åˆ°å¹³è¡¡ç‚¹æˆ–è€…å‡ºç°é—®é¢˜ä¸ºæ­¢ã€‚</p><p>åŒæ ·ï¼Œåœ¨æ•°æ®æµä¸­ï¼Œå¦‚æœç”Ÿäº§æ•°æ®çš„é€Ÿåº¦è¶…è¿‡æ¶ˆè´¹æ•°æ®çš„é€Ÿåº¦ï¼ˆæ¯”å¦‚å†™å…¥ç£ç›˜çš„é€Ÿåº¦ï¼‰ï¼Œå°±ä¼šäº§ç”ŸèƒŒå‹ã€‚</p><h3 id="event-drain-1" tabindex="-1"><a class="header-anchor" href="#event-drain-1"><span>Event: &#39;drain&#39;</span></a></h3><p>å½“ä½¿ç”¨å¯å†™æµï¼ˆWritable streamsï¼‰æ—¶ï¼Œå¦‚æœå°è¯•å†™å…¥çš„æ•°æ®è¶…è¿‡äº†å†…éƒ¨ç¼“å†²åŒºçš„å¤§å°ï¼Œ<code>write()</code>æ–¹æ³•ä¼šè¿”å›<code>false</code>ï¼Œè¡¨ç¤ºä¸èƒ½å†ç»§ç»­å†™å…¥æ•°æ®äº†ã€‚è¿™å°±æ˜¯èƒŒå‹çš„ä¸€ç§è¡¨ç°å½¢å¼ã€‚è¿™æ—¶ï¼Œæ‚¨åº”è¯¥åœæ­¢å†™å…¥æ•°æ®ï¼Œå¹¶ç­‰å¾…<code>&#39;drain&#39;</code>äº‹ä»¶çš„è§¦å‘ã€‚<code>&#39;drain&#39;</code>äº‹ä»¶è¡¨æ˜ç°åœ¨æµå·²ç»ç©ºé—²ä¸‹æ¥ï¼Œå¯ä»¥å†æ¬¡å®‰å…¨åœ°å†™å…¥æ›´å¤šçš„æ•°æ®äº†ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-5"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-å¤§æ–‡ä»¶å†™å…¥" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-å¤§æ–‡ä»¶å†™å…¥"><span>ä¾‹å­ 1 - å¤§æ–‡ä»¶å†™å…¥</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç¨‹åºæ¥å¤„ç†æ—¥å¿—æ–‡ä»¶çš„ç”Ÿæˆã€‚å¦‚æœæ—¥å¿—å†…å®¹éå¸¸é¢‘ç¹ï¼ˆæ¯”å¦‚æ¯æ¬¡è¯·æ±‚éƒ½å†™æ—¥å¿—ï¼‰ï¼Œç›´æ¥è¿ç»­å†™å…¥å¯èƒ½ä¼šè¶…è¿‡ç³»ç»Ÿå¤„ç†çš„èƒ½åŠ›ï¼Œå¯¼è‡´å†…å­˜å ç”¨æŒç»­å¢é«˜ã€‚æ­¤æ—¶ï¼Œé€šè¿‡ç›‘å¬<code>&#39;drain&#39;</code>äº‹ä»¶æ¥æ§åˆ¶å†™å…¥é€Ÿç‡å°±æ˜¾å¾—éå¸¸é‡è¦äº†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> file</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;./bigfile.log&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> canWrite</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`&lt;`</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1000000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> logEntry</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `Log entry </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">canWrite</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        canWrite</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">logEntry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // ç›‘å¬&#39;drain&#39;äº‹ä»¶ï¼Œå†æ¬¡å°è¯•å†™å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">once</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;drain&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">            canWrite</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">logEntry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-2-ç½‘ç»œé€šä¿¡" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ç½‘ç»œé€šä¿¡"><span>ä¾‹å­ 2 - ç½‘ç»œé€šä¿¡</span></a></h4><p>åœ¨ç½‘ç»œé€šä¿¡ä¸­ï¼Œæ¯”å¦‚ä½¿ç”¨ Node.js åˆ›å»ºçš„ TCP æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œå½“æœåŠ¡å™¨å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯ä½†å®¢æˆ·ç«¯æ¥æ”¶æ•°æ®çš„é€Ÿåº¦è·Ÿä¸ä¸Šæ—¶ï¼Œ<code>&#39;drain&#39;</code>äº‹ä»¶åŒæ ·é€‚ç”¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> net</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;net&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> net</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> bigData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> getSomeBigData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™æ˜¯ä¸€å¤§å—æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">bigData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">once</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;drain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // åœ¨è¿™é‡Œï¼Œå¯ä»¥å®‰å…¨åœ°ç»§ç»­å‘é€æ›´å¤šæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸¤ä¸ªå®ä¾‹ä¸­ï¼Œ<code>&#39;drain&#39;</code>äº‹ä»¶å¸®åŠ©æˆ‘ä»¬æœ‰æ•ˆåœ°ç®¡ç†æ•°æ®æµï¼Œé˜²æ­¢å› ä¸ºèƒŒå‹è€Œå¯¼è‡´çš„å†…å­˜æº¢å‡ºæˆ–åº”ç”¨å´©æºƒï¼Œç¡®ä¿åº”ç”¨çš„ç¨³å®šæ€§ä¸æ•ˆç‡ã€‚</p><h5 id="event-error" tabindex="-1"><a class="header-anchor" href="#event-error"><span><a href="https://nodejs.org/docs/latest/api/stream.html#event-error" target="_blank" rel="noopener noreferrer">Event: &#39;error&#39;</a></span></a></h5><p>åœ¨ Node.js ä¸­ï¼Œ<code>Event: &#39;error&#39;</code> æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†æµï¼ˆStreamsï¼‰æ—¶ã€‚æµæ˜¯ä¸€ç§å¯ä»¥è®©ä½ ä»¥è¿ç»­çš„æ–¹å¼å¤„ç†æ•°æ®çš„æœºåˆ¶ã€‚ä¾‹å¦‚ï¼Œè¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶æ—¶ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨æµé€æ¸åœ°è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè¿™æ ·å¯ä»¥æ˜¾è‘—é™ä½åº”ç”¨ç¨‹åºçš„å†…å­˜ä½¿ç”¨ç‡ã€‚</p><p>ç„¶è€Œï¼Œåœ¨ä½¿ç”¨æµè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°é”™è¯¯ï¼Œæ¯”å¦‚å°è¯•è¯»å–ä¸å­˜åœ¨çš„æ–‡ä»¶æˆ–è€…ç½‘ç»œé—®é¢˜å¯¼è‡´çš„æ•°æ®ä¼ è¾“é”™è¯¯ã€‚è¿™æ—¶å€™ï¼Œ<code>&#39;error&#39;</code> äº‹ä»¶å°±æ˜¾å¾—å°¤ä¸ºé‡è¦äº†ã€‚</p><h3 id="error-äº‹ä»¶ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#error-äº‹ä»¶ç®€ä»‹"><span><code>&#39;error&#39;</code> äº‹ä»¶ç®€ä»‹</span></a></h3><p>åœ¨ Node.js çš„å¾ˆå¤šæ¨¡å—ä¸­ï¼Œç‰¹åˆ«æ˜¯ä¸ I/O æ“ä½œï¼ˆä¾‹å¦‚æ–‡ä»¶ç³»ç»Ÿæ“ä½œã€ç½‘ç»œè¯·æ±‚ç­‰ï¼‰ç›¸å…³çš„æ¨¡å—ä¸­ï¼Œéƒ½ä¼šä½¿ç”¨åˆ°äº‹ä»¶æ¥å¤„ç†å¼‚æ­¥æ“ä½œçš„ç»“æœã€‚<code>&#39;error&#39;</code> äº‹ä»¶å°±æ˜¯è¿™äº›äº‹ä»¶ä¹‹ä¸€ï¼Œå®ƒç”¨äºè¡¨ç¤ºæ“ä½œä¸­å‡ºç°çš„é”™è¯¯ã€‚</p><p>å½“æµé‡åˆ°é”™è¯¯æ—¶ï¼Œå®ƒä¼šå‘å‡ºï¼ˆemitï¼‰<code>&#39;error&#39;</code> äº‹ä»¶ã€‚å¦‚æœä½ æ²¡æœ‰ç›‘å¬å¹¶å¤„ç†è¿™ä¸ªäº‹ä»¶ï¼Œé‚£ä¹ˆ Node.js é»˜è®¤çš„è¡Œä¸ºæ˜¯å°†é”™è¯¯æ‰“å°åˆ°æ§åˆ¶å°å¹¶é€€å‡ºç¨‹åºã€‚å› æ­¤ï¼Œç›‘å¬å’Œå¤„ç†è¿™ä¸ªäº‹ä»¶å¯¹äºæ„å»ºå¥å£¯çš„åº”ç”¨ç¨‹åºæ¥è¯´æ˜¯éå¸¸é‡è¦çš„ã€‚</p><h3 id="å¦‚ä½•ç›‘å¬å’Œå¤„ç†-error-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ç›‘å¬å’Œå¤„ç†-error-äº‹ä»¶"><span>å¦‚ä½•ç›‘å¬å’Œå¤„ç† <code>&#39;error&#39;</code> äº‹ä»¶</span></a></h3><p>ä½ å¯ä»¥ä½¿ç”¨ <code>.on()</code> æ–¹æ³•ç›‘å¬æµä¸Šçš„ <code>&#39;error&#39;</code> äº‹ä»¶ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµï¼Œå°è¯•è¯»å–ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;non-existent-file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ &#39;error&#39; äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å‘ç”Ÿé”™è¯¯: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">error</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°è¯•åˆ›å»ºä¸€ä¸ªæŒ‡å‘ä¸å­˜åœ¨æ–‡ä»¶çš„å¯è¯»æµã€‚å› ä¸ºæ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ‰€ä»¥ä¼šè§¦å‘ <code>&#39;error&#39;</code> äº‹ä»¶ï¼Œç„¶åæˆ‘ä»¬çš„é”™è¯¯å¤„ç†å›è°ƒå‡½æ•°å°±ä¼šè¢«æ‰§è¡Œï¼Œæ‰“å°å‡ºé”™è¯¯ä¿¡æ¯ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-1"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><ol><li><p><strong>æ–‡ä»¶è¯»å†™æ“ä½œ</strong>ï¼šå½“ä½ åœ¨è¿›è¡Œæ–‡ä»¶è¯»å†™æ“ä½œæ—¶ï¼Œå¦‚ä¸Šè¿°ç¤ºä¾‹ï¼Œç›‘å¬é”™è¯¯å¯ä»¥å¸®åŠ©ä½ æ•æ‰å¦‚æ–‡ä»¶ä¸å­˜åœ¨ã€æƒé™ä¸è¶³ç­‰é—®é¢˜ã€‚</p></li><li><p><strong>ç½‘ç»œè¯·æ±‚</strong>ï¼šå½“ä½ ä½¿ç”¨ <code>http</code> æ¨¡å—å‘é€ç½‘ç»œè¯·æ±‚æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°ç½‘ç»œè¶…æ—¶ã€ç›®æ ‡æœåŠ¡å™¨æ— å“åº”ç­‰é—®é¢˜ï¼Œé€šè¿‡ç›‘å¬ <code>&#39;error&#39;</code> äº‹ä»¶å¯ä»¥åŠæ—¶å¤„ç†è¿™äº›å¼‚å¸¸æƒ…å†µã€‚</p></li><li><p><strong>æ•°æ®åº“æ“ä½œ</strong>ï¼šåœ¨ä½¿ç”¨è¯¸å¦‚ MongoDB æˆ– MySQL ç­‰æ•°æ®åº“æ—¶ï¼Œå¦‚æœæ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œæˆ–è€…æŸ¥è¯¢æ‰§è¡Œé”™è¯¯ï¼Œé€šå¸¸ä¹Ÿä¼šé€šè¿‡å‘å‡º <code>&#39;error&#39;</code> äº‹ä»¶æ¥é€šçŸ¥ä½ ï¼Œä»è€Œå…è®¸ä½ åšå‡ºç›¸åº”çš„é”™è¯¯å¤„ç†ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œ<code>&#39;error&#39;</code> äº‹ä»¶æ˜¯ Node.js ä¸­ä¸€ç§éå¸¸åŸºç¡€ä¸”å¼ºå¤§çš„æœºåˆ¶ï¼Œé€šè¿‡æ­£ç¡®åœ°ä½¿ç”¨å®ƒï¼Œå¯ä»¥å¤§å¤§å¢å¼ºä½ çš„åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒã€‚</p><h5 id="event-finish" tabindex="-1"><a class="header-anchor" href="#event-finish"><span><a href="https://nodejs.org/docs/latest/api/stream.html#event-finish" target="_blank" rel="noopener noreferrer">Event: &#39;finish&#39;</a></span></a></h5><p>åœ¨ Node.js ä¸­ï¼Œ<code>Event: &#39;finish&#39;</code> äº‹ä»¶æ˜¯å’Œæµ (Streams) ç›¸å…³çš„ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µã€‚åœ¨ v21.7.1 ä¸­ï¼Œè¿™ä¸ªæ¦‚å¿µä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ä¸ºäº†ç†è§£è¿™ä¸ªäº‹ä»¶ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç®€å•äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„æµå’Œå®ƒä»¬çš„ä½œç”¨ã€‚</p><h3 id="æµ-streams-ç®€ä»‹-2" tabindex="-1"><a class="header-anchor" href="#æµ-streams-ç®€ä»‹-2"><span>æµï¼ˆStreamsï¼‰ç®€ä»‹</span></a></h3><p>æµæ˜¯ç”¨æ¥å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œå°¤å…¶æ˜¯å½“ä½ ä¸éœ€è¦ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­çš„æ—¶å€™ã€‚åœ¨ Node.js ä¸­ï¼Œæµä¸»è¦ç”¨äºè¯»å–æˆ–å†™å…¥æ•°æ®ã€‚æ¯”å¦‚ï¼Œä»æ–‡ä»¶è¯»å–æ•°æ®æˆ–å°†æ•°æ®å†™å…¥æ–‡ä»¶ï¼Œç½‘ç»œé€šä¿¡ç­‰åœºæ™¯ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ï¼Œæˆ–è€…æ—¢å¯è¯»åˆå¯å†™ï¼ˆåŒå‘æµï¼‰ã€‚</p><h3 id="finish-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#finish-äº‹ä»¶"><span><code>finish</code> äº‹ä»¶</span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º <code>Event: &#39;finish&#39;</code> äº‹ä»¶æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸æ˜¯åœ¨è®¨è®ºå¯å†™æµï¼ˆWritable Streamsï¼‰çš„ä¸Šä¸‹æ–‡ä¸­ã€‚<code>finish</code> äº‹ä»¶åœ¨å¯å†™æµä¸Šè§¦å‘ï¼Œè¡¨ç¤ºæ‰€æœ‰æ•°æ®å·²ç»è¢«å†™å…¥åˆ°åº•å±‚ç³»ç»Ÿï¼Œæµå®Œæˆäº†å®ƒçš„è¾“å‡ºå·¥ä½œã€‚</p><h4 id="ä¸¾ä¸ªä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä¸¾ä¸ªä¾‹å­"><span>ä¸¾ä¸ªä¾‹å­ï¼š</span></a></h4><ol><li><p><strong>æ–‡ä»¶å†™å…¥</strong>ï¼šå‡è®¾ä½ æ­£åœ¨å°†ä¸€äº›æ•°æ®å†™å…¥æ–‡ä»¶ï¼Œä¸€æ—¦æ‰€æœ‰çš„æ•°æ®éƒ½è¢«å†™å…¥å¹¶ä¸”æ²¡æœ‰ä»€ä¹ˆä¸œè¥¿ç•™åœ¨è¦å†™å…¥çš„é˜Ÿåˆ—ä¸­äº†ï¼Œ<code>finish</code> äº‹ä»¶å°±ä¼šè¢«è§¦å‘ã€‚è¿™ä¸ªäº‹ä»¶å‘Šè¯‰ä½ ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½å·²ç»æˆåŠŸå†™å…¥åº•å±‚ç³»ç»Ÿï¼ˆæ¯”å¦‚ä½ çš„ç¡¬ç›˜ï¼‰ã€‚</p></li><li><p><strong>ç½‘ç»œè¯·æ±‚</strong>ï¼šå½“ä½ é€šè¿‡ HTTP å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶ä¸”è¿™ä¸ªè¯·æ±‚çš„ä¸»ä½“è¢«å®Œå…¨å‘é€åˆ°æœåŠ¡å™¨åï¼Œå¦‚æœä½ çš„è¯·æ±‚æ˜¯é€šè¿‡ Node.js çš„æµæ¥å‘é€çš„ï¼Œé‚£ä¹ˆ<code>finish</code>äº‹ä»¶ä¼šè¢«è§¦å‘ï¼Œè¡¨ç¤ºè¯·æ±‚æ•°æ®å·²ç»å®Œå…¨å‘é€ã€‚</p></li></ol><h4 id="å¦‚ä½•ä½¿ç”¨-1" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-1"><span>å¦‚ä½•ä½¿ç”¨ï¼š</span></a></h4><p>ä½ å¯ä»¥ç»™æµæ·»åŠ ä¸€ä¸ªç›‘å¬å™¨æ¥å“åº” <code>finish</code> äº‹ä»¶ï¼Œè¿™æ ·å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä½ å¯ä»¥æ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œæˆ–è€…é€»è¾‘å¤„ç†ã€‚æ¯”å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> file</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å†™å…¥æ•°æ®åˆ°æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello Node.js Streams!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ ‡è®°æ–‡ä»¶ç»“æŸ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ &#39;finish&#39; äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;finish&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶å†™å…¥å®Œæˆã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘ &#39;example.txt&#39; æ–‡ä»¶çš„å¯å†™æµï¼Œå¹¶å†™å…¥äº†ä¸€äº›æ•°æ®ã€‚è°ƒç”¨ <code>file.end()</code> è¡¨ç¤ºæˆ‘ä»¬å®Œæˆäº†å†™å…¥ï¼Œä¹‹åï¼Œæˆ‘ä»¬ç›‘å¬ <code>finish</code> äº‹ä»¶æ¥ç¡®è®¤å½“æ‰€æœ‰æ•°æ®éƒ½è¢«å†™å…¥åº•å±‚ç³»ç»Ÿåï¼Œæ‰§è¡Œä¸€äº›åç»­æ“ä½œï¼Œè¿™é‡Œå°±æ˜¯ç®€å•åœ°åœ¨æ§åˆ¶å°è¾“å‡ºäº†ä¸€æ¡æ¶ˆæ¯ã€‚</p><p>é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œ<code>finish</code> äº‹ä»¶å¸®åŠ©æˆ‘ä»¬åœ¨è¿›è¡Œæ–‡ä»¶æ“ä½œã€ç½‘ç»œè¯·æ±‚æˆ–ä»»ä½•æ¶‰åŠåˆ° Node.js å¯å†™æµçš„åœºæ™¯ä¸­ï¼Œæ›´åŠ ç²¾ç¡®åœ°ç®¡ç†æ•°æ®æµçš„ç»“æŸå’Œèµ„æºçš„æ¸…ç†ã€‚</p><h5 id="event-pipe" tabindex="-1"><a class="header-anchor" href="#event-pipe"><span><a href="https://nodejs.org/docs/latest/api/stream.html#event-pipe" target="_blank" rel="noopener noreferrer">Event: &#39;pipe&#39;</a></span></a></h5><p>ç†è§£ Node.js ä¸­çš„ <code>Event: &#39;pipe&#39;</code>ï¼Œé¦–å…ˆæˆ‘ä»¬å¾—æ˜ç™½ Node.js é‡Œé¢çš„æµï¼ˆStreamsï¼‰å’Œäº‹ä»¶ï¼ˆEventsï¼‰æ¦‚å¿µã€‚</p><h3 id="æµ-streams" tabindex="-1"><a class="header-anchor" href="#æµ-streams"><span>æµï¼ˆStreamsï¼‰</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§æŠ½è±¡çš„æ•°æ®ç»“æ„ï¼Œç”¨äºè¯»å–æˆ–å†™å…¥æ•°æ®ã€‚æƒ³è±¡æˆæ°´æµï¼Œæ•°æ®å°±åƒæ°´ä¸€æ ·ä»ä¸€ä¸ªåœ°æ–¹æµå‘å¦ä¸€ä¸ªåœ°æ–¹ã€‚ä¸»è¦æœ‰å››ç§ç±»å‹çš„æµï¼š</p><ol><li><strong>å¯è¯»æµ</strong> (Readable Streams)ï¼šå¯ä»¥ä»ä¸­è¯»å–æ•°æ®ï¼Œä¾‹å¦‚æ–‡ä»¶è¯»å–ã€è¯·æ±‚è·å–ç­‰ã€‚</li><li><strong>å¯å†™æµ</strong> (Writable Streams)ï¼šå¯ä»¥å†™å…¥æ•°æ®ï¼Œä¾‹å¦‚æ–‡ä»¶å†™å…¥ã€å“åº”å‘é€ç­‰ã€‚</li><li><strong>åŒå·¥æµ</strong> (Duplex Streams)ï¼šå³å¯è¯»åˆå¯å†™ï¼Œå¦‚ TCP å¥—æ¥å­—è¿æ¥ã€‚</li><li><strong>è½¬æ¢æµ</strong> (Transform Streams)ï¼šåœ¨è¯»å†™è¿‡ç¨‹ä¸­å¯ä»¥ä¿®æ”¹æˆ–å¤„ç†æ•°æ®çš„ Duplex æµã€‚</li></ol><h3 id="äº‹ä»¶-events" tabindex="-1"><a class="header-anchor" href="#äº‹ä»¶-events"><span>äº‹ä»¶ï¼ˆEventsï¼‰</span></a></h3><p>Node.js çš„äº‹ä»¶æ¨¡å‹å…è®¸ç›‘å¬å’Œè§¦å‘äº‹ä»¶ï¼Œç±»ä¼¼äºå‰ç«¯ JavaScript å¤„ç†ç”¨æˆ·äº¤äº’ã€‚ä½ å¯ä»¥å¯¹ç‰¹å®šè¡Œä¸ºç»‘å®šäº‹ä»¶ç›‘å¬å™¨ï¼ˆå‡½æ•°ï¼‰ï¼Œå½“è¿™ä¸ªè¡Œä¸ºå‘ç”Ÿæ—¶ï¼Œç›¸åº”çš„äº‹ä»¶å°±ä¼šè¢«è§¦å‘ï¼Œæ‰§è¡Œç»‘å®šçš„å‡½æ•°ã€‚</p><h3 id="event-pipe-1" tabindex="-1"><a class="header-anchor" href="#event-pipe-1"><span>Event: &#39;pipe&#39;</span></a></h3><p>å½“æˆ‘ä»¬ä½¿ç”¨ <code>.pipe()</code> æ–¹æ³•å°†ä¸¤ä¸ªæµè¿æ¥åœ¨ä¸€èµ·æ—¶ï¼Œ<code>&#39;pipe&#39;</code> äº‹ä»¶å°±ä¼šåœ¨æºå¤´æµï¼ˆsource streamï¼‰ä¸Šè¢«è§¦å‘ã€‚é€šä¿—æ¥è¯´ï¼Œå½“ä½ ç”¨æ°´ç®¡ï¼ˆ<code>.pipe()</code>ï¼‰æŠŠä¸€ä¸ªæ¡¶ï¼ˆä¸€ä¸ªæµï¼‰çš„æ°´å¯¼å…¥å¦ä¸€ä¸ªæ¡¶ï¼ˆå¦ä¸€ä¸ªæµï¼‰æ—¶ï¼ŒåŸæ¥çš„æ¡¶ä¼šå‘Šè¯‰ä½ â€œæˆ‘å¼€å§‹å¾€å¦ä¸€ä¸ªæ¡¶é‡Œå€’æ°´äº†â€ã€‚</p><p>è¿™ä¸ªäº‹ä»¶ä¸»è¦ç”¨äºçŸ¥é“æ•°æ®ä»€ä¹ˆæ—¶å€™å¼€å§‹é€šè¿‡ç®¡é“ä¼ è¾“ï¼Œæˆ–è€…åšä¸€äº›åˆå§‹åŒ–è®¾ç½®ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-2"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-æ–‡ä»¶å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-æ–‡ä»¶å¤åˆ¶"><span>ç¤ºä¾‹ 1: æ–‡ä»¶å¤åˆ¶</span></a></h4><p>æƒ³è±¡ä½ éœ€è¦å°†ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹å¤åˆ¶åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¿™é‡Œæ¶‰åŠåˆ°ä»ä¸€ä¸ªæ–‡ä»¶ï¼ˆå¯è¯»æµï¼‰è¯»å–æ•°æ®ï¼Œå¹¶å°†è¿™äº›æ•°æ®å†™å…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ï¼ˆå¯å†™æµï¼‰ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> sourceStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;source.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> destinationStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;destination.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ &#39;pipe&#39; äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">sourceStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pipe&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">src</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å¼€å§‹æ•°æ®ä¼ è¾“...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿æ¥æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">sourceStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">destinationStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œ<code>sourceStream</code> æ˜¯æ•°æ®æºï¼ˆä» <code>source.txt</code> ä¸­è¯»å–æ•°æ®ï¼‰ï¼Œè€Œ <code>destinationStream</code> æ˜¯ç›®çš„åœ°ï¼ˆå†™å…¥åˆ° <code>destination.txt</code>ï¼‰ã€‚å½“ <code>sourceStream.pipe(destinationStream)</code> è¢«è°ƒç”¨æ—¶ï¼Œ<code>&#39;pipe&#39;</code> äº‹ä»¶ä¼šåœ¨ <code>sourceStream</code> ä¸Šè¢«è§¦å‘ï¼Œè¾“å‡º &quot;å¼€å§‹æ•°æ®ä¼ è¾“...&quot;ã€‚</p><h4 id="ç¤ºä¾‹-2-è¯·æ±‚æ—¥å¿—è®°å½•" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-è¯·æ±‚æ—¥å¿—è®°å½•"><span>ç¤ºä¾‹ 2: è¯·æ±‚æ—¥å¿—è®°å½•</span></a></h4><p>å¦‚æœä½ æ­£åœ¨å®ç°ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå¯èƒ½å¸Œæœ›å°†è¯·æ±‚çš„æ•°æ®æµè®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> logStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;requests.log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">flags</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">logStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pipe&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Logging data from request to &#39;requests.log&#39;`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;OK&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯å½“æœåŠ¡å™¨æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå®ƒå°†è¯·æ±‚çš„å†…å®¹æµå¼ä¼ è¾“åˆ° <code>requests.log</code> æ–‡ä»¶ã€‚æ­¤å¤–ï¼Œé€šè¿‡ç›‘å¬ <code>&#39;pipe&#39;</code> äº‹ä»¶ï¼ŒæœåŠ¡å™¨èƒ½å¤ŸçŸ¥é“æ•°æ®æ˜¯ä½•æ—¶å¼€å§‹è¢«è®°å½•çš„ã€‚</p><h3 id="æ€»ç»“-2" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-2"><span>æ€»ç»“</span></a></h3><p><code>&#39;pipe&#39;</code> äº‹ä»¶æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œå®ƒå…è®¸å¼€å‘è€…åœ¨æ•°æ®å¼€å§‹é€šè¿‡ç®¡é“ä»ä¸€ä¸ªæµä¼ è¾“åˆ°å¦ä¸€ä¸ªæµæ—¶è¿›è¡Œå¹²é¢„æˆ–è®°å½•ã€‚é€šè¿‡ç»“åˆä½¿ç”¨ Node.js çš„æµå’Œäº‹ä»¶ç³»ç»Ÿï¼Œä½ å¯ä»¥é«˜æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®ï¼ŒåŒæ—¶ä¿æŒä»£ç çš„æ¸…æ™°å’Œç»„ç»‡åŒ–ã€‚</p><h5 id="event-unpipe" tabindex="-1"><a class="header-anchor" href="#event-unpipe"><span><a href="https://nodejs.org/docs/latest/api/stream.html#event-unpipe" target="_blank" rel="noopener noreferrer">Event: &#39;unpipe&#39;</a></span></a></h5><p>ç†è§£ Node.js ä¸­çš„<code>&#39;unpipe&#39;</code>äº‹ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¦ç®€å•äº†è§£ä¸€ä¸‹ Node.js æµï¼ˆStreamï¼‰çš„æ¦‚å¿µã€‚åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ç”¨æ¥å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œæ¯”å¦‚è¯»å–æ–‡ä»¶ã€æ¥æ”¶ HTTP è¯·æ±‚ç­‰ã€‚æµå¯ä»¥è®©ä½ ä»¥ä¸€ç§éå¸¸é«˜æ•ˆçš„æ–¹å¼å¤„ç†å¤§é‡æ•°æ®ï¼Œå› ä¸ºå®ƒä»¬å…è®¸æ•°æ®è¢«é€ç‰‡å¤„ç†ï¼Œè€Œä¸æ˜¯ç­‰åˆ°æ‰€æœ‰æ•°æ®éƒ½å¯ç”¨æ—¶æ‰å¼€å§‹å¤„ç†ã€‚</p><p>åœ¨æµçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œ&quot;pipe&quot;æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªæµï¼Œä¸€ä¸ªæºï¼ˆsourceï¼‰å’Œä¸€ä¸ªç›®çš„åœ°ï¼ˆdestinationï¼‰ã€‚å½“æˆ‘ä»¬ä½¿ç”¨<code>.pipe()</code>æ–¹æ³•å°†æºæµè¿æ¥åˆ°ç›®çš„åœ°æµæ—¶ï¼Œæºæµä¸­çš„æ•°æ®ä¼šè‡ªåŠ¨ä¼ è¾“åˆ°ç›®çš„åœ°æµã€‚è¿™å°±æ˜¯â€œç®¡é“ï¼ˆpipingï¼‰â€ã€‚</p><p>ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä¸­æ–­è¿™ä¸ªè¿‡ç¨‹ï¼Œå³ä»æºæµä¸­æ–­å¼€æˆ–è§£é™¤ä¸ç›®çš„åœ°æµçš„è¿æ¥ã€‚è¿™æ—¶ï¼Œ<code>&#39;unpipe&#39;</code>äº‹ä»¶å°±ä¼šè¢«è§¦å‘ã€‚</p><h3 id="event-unpipe-1" tabindex="-1"><a class="header-anchor" href="#event-unpipe-1"><span>Event: &#39;unpipe&#39;</span></a></h3><p>åœ¨ Node.js v21.7.1 æ–‡æ¡£ä¸­ï¼Œå½“ä¸€ä¸ªæµï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºè¯»å–æµï¼‰åœæ­¢å‘é€æ•°æ®åˆ°å¦ä¸€ä¸ªæµï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºå†™å…¥æµï¼‰æ—¶ï¼Œ<code>&#39;unpipe&#39;</code>äº‹ä»¶å°±ä¼šåœ¨å†™å…¥æµä¸Šè§¦å‘ã€‚ç®€å•æ¥è¯´ï¼Œå½“<code>.unpipe()</code>æ–¹æ³•è¢«è°ƒç”¨ï¼Œæˆ–è€…ç”±äºæŸäº›åŸå› å¯¼è‡´ç®¡é“ï¼ˆpipeï¼‰æ“ä½œä¸­æ­¢æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ä¸ªäº‹ä»¶ã€‚</p><h4 id="å®é™…è¿ç”¨ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-3"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h4><h5 id="ä¾‹å­-1-ç›‘å¬-unpipe-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-ç›‘å¬-unpipe-äº‹ä»¶"><span>ä¾‹å­ 1: ç›‘å¬&#39;unpipe&#39;äº‹ä»¶</span></a></h5><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js ç¨‹åºï¼Œè¯¥ç¨‹åºä»ä¸€ä¸ªæ–‡ä»¶è¯»å–æ•°æ®ï¼Œç„¶åå†™å…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ã€‚çªç„¶ï¼Œç”±äºæŸç§åŸå› ï¼Œä½ éœ€è¦åœæ­¢å†™å…¥æ•°æ®ï¼ˆæ¯”å¦‚ç›®çš„åœ°æ–‡ä»¶å·²ç»è¶³å¤Ÿå¤§ï¼‰ï¼Œè¿™æ—¶ä½ ä¼šè°ƒç”¨<code>.unpipe()</code>æ–¹æ³•æ¥åœæ­¢æµåŠ¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµï¼ˆæºï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;source.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµï¼ˆç›®çš„åœ°ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> writeStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;destination.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç®¡é“è¿æ¥ä¸¤ä¸ªæµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¸€æ®µæ—¶é—´åï¼ŒåŸºäºæŸäº›æ¡ä»¶ï¼Œæˆ‘ä»¬å†³å®šåœæ­¢å†™å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">unpipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ•°æ®ä¼ è¾“è¢«ç»ˆæ­¢&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å½“æ•°æ®ä¼ è¾“ç»ˆæ­¢æ—¶ï¼Œç›‘å¬&#39;unpipe&#39;äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;unpipe&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">src</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;unpipeäº‹ä»¶è§¦å‘ï¼Œæ•°æ®ä¼ è¾“å·²åœæ­¢ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªä»<code>source.txt</code>åˆ°<code>destination.txt</code>çš„æ•°æ®æµã€‚é€šè¿‡è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿäº†åœ¨ 10 ç§’ååŸºäºç‰¹å®šæ¡ä»¶åœæ­¢æ•°æ®ä¼ è¾“çš„æƒ…å½¢ã€‚å½“è°ƒç”¨<code>readStream.unpipe(writeStream)</code>æ—¶ï¼Œ<code>&#39;unpipe&#39;</code>äº‹ä»¶å°†åœ¨<code>writeStream</code>ä¸Šè§¦å‘ï¼Œè¡¨æ˜æ•°æ®ä¼ è¾“å·²è¢«ç»ˆæ­¢ã€‚</p><h5 id="ä¾‹å­-2-åŠ¨æ€ç®¡é“æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-åŠ¨æ€ç®¡é“æ§åˆ¶"><span>ä¾‹å­ 2: åŠ¨æ€ç®¡é“æ§åˆ¶</span></a></h5><p>åœ¨å¦ä¸€ä¸ªåœºæ™¯ä¸­ï¼Œå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘ç»œåº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦æ ¹æ®ç”¨æˆ·çš„è¾“å…¥åŠ¨æ€åœ°å¼€å§‹æˆ–åœæ­¢æ—¥å¿—æ–‡ä»¶çš„å®æ—¶ä¼ è¾“ã€‚æ¯å½“ç”¨æˆ·æš‚åœæ—¥å¿—æŸ¥çœ‹æ—¶ï¼Œä½ å¯èƒ½å¸Œæœ›æš‚åœæ•°æ®æµï¼Œä»¥èŠ‚çœèµ„æºæˆ–å¸¦å®½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™æ˜¯ä¸€ä¸ªexpressè·¯ç”±å¤„ç†å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">app</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/stop-logging&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‡è®¾logStreamæ˜¯ä¹‹å‰é€šè¿‡.pipe()å¼€å§‹çš„æ—¥å¿—æ–‡ä»¶ä¼ è¾“æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  logStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">unpipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ—¥å¿—ä¼ è¾“å·²æš‚åœ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨reså¯¹è±¡ä¸Šç›‘å¬&#39;unpipe&#39;äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;unpipe&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å®¢æˆ·ç«¯è¯·æ±‚åœæ­¢æ—¥å¿—ä¼ è¾“&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œå½“ç”¨æˆ·è®¿é—®<code>/stop-logging</code>è·¯ç”±æ—¶ï¼ŒæœåŠ¡å™¨å°†åœæ­¢å°†æ—¥å¿—æµä¼ è¾“åˆ°å“åº”å¯¹è±¡ï¼ˆ<code>res</code>ï¼‰ï¼Œå¹¶ä¸”<code>&#39;unpipe&#39;</code>äº‹ä»¶ä¼šè¢«è§¦å‘ï¼Œç»™æœåŠ¡å™¨ä¸€ä¸ªåé¦ˆï¼Œè¡¨æ˜æ—¥å¿—ä¼ è¾“å·²è¢«ç”¨æˆ·æš‚åœã€‚</p><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>&#39;unpipe&#39;</code>äº‹ä»¶åœ¨å®ç°æµçš„åŠ¨æ€æ§åˆ¶æ–¹é¢çš„ä½œç”¨ï¼Œæ— è®ºæ˜¯æ–‡ä»¶å¤„ç†è¿˜æ˜¯ç½‘ç»œé€šä¿¡ï¼Œéƒ½èƒ½æä¾›çµæ´»çš„æ•°æ®ç®¡ç†ç­–ç•¥ã€‚</p><h5 id="writable-cork" tabindex="-1"><a class="header-anchor" href="#writable-cork"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writablecork" target="_blank" rel="noopener noreferrer">writable.cork()</a></span></a></h5><p>ç†è§£ <code>writable.cork()</code> æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä»€ä¹ˆæ˜¯ Node.js ä¸­çš„æµï¼ˆStreamï¼‰ï¼Œä»¥åŠä¸ºä½•å®ƒä»¬å¦‚æ­¤é‡è¦ã€‚</p><p><strong>æµï¼ˆStreamsï¼‰ç®€ä»‹</strong></p><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“ä½ å¤„ç†å¤§é‡æ•°æ®ï¼Œæˆ–è€…ä½ ä¸æƒ³ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­æ—¶ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªæ°´æ¡¶ï¼ˆæ•°æ®æºï¼‰ï¼Œä½ éœ€è¦å°†æ°´ï¼ˆæ•°æ®ï¼‰ç§»åŠ¨åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼Œä½†æ˜¯ä½ çš„æ°´å£¶ï¼ˆå†…å­˜ï¼‰åªèƒ½ä¸€æ¬¡è£…æ»¡ä¸€å®šé‡çš„æ°´ã€‚è¿™æ—¶ï¼Œä½ ä¼šåˆ†æ‰¹æ¬¡åœ°å°†æ°´ä»æ¡¶ä¸­èˆ€å‡ºï¼Œå€’å…¥æ°´å£¶ï¼Œå¹¶è¿é€åˆ°ç›®çš„åœ°ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ°´æ¡¶å°±åƒæ˜¯ä¸€ä¸ªå¯è¯»æµï¼Œæ°´å£¶å°±åƒæ˜¯ç¼“å†²åŒºï¼Œè€Œç›®çš„åœ°å°±æ˜¯ä¸€ä¸ªå¯å†™æµã€‚</p><p><strong>Writable Streams</strong></p><p>å¯å†™æµï¼ˆWritable streamsï¼‰å…è®¸ä½ å°†æ•°æ®å†™å…¥åˆ°ç›®çš„åœ°ã€‚è¿™å¯ä»¥æ˜¯æ–‡ä»¶ã€HTTP å“åº”æˆ–ä»»ä½•å…¶ä»–ç±»å‹çš„æ¥æ”¶æ•°æ®çš„é€šé“ã€‚</p><p><strong>cork() æ–¹æ³•ç®€ä»‹</strong></p><p><code>writable.cork()</code> æ˜¯ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ï¼Œç”¨äºæš‚æ—¶åœæ­¢å°†æ•°æ®ä»å†…å­˜ï¼ˆç¼“å†²åŒºï¼‰å†™å…¥åˆ°ç›®æ ‡ï¼ˆä¾‹å¦‚æ–‡ä»¶ï¼‰ã€‚ä½ å¯ä»¥å°†å…¶è§†ä¸ºâ€œå¡ä½â€æµçš„æ–¹æ³•ï¼Œè®©æ•°æ®æš‚æ—¶åœç•™åœ¨å†…å­˜ä¸­ï¼Œè€Œä¸æ˜¯ç«‹å³å†™å…¥ç›®æ ‡ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥å‡å°‘è¿›è¡Œå®é™…å†™å…¥æ“ä½œçš„æ¬¡æ•°ï¼Œé€šè¿‡åˆå¹¶å¤šä¸ªè¾ƒå°çš„å†™å…¥æ“ä½œæˆä¸ºè¾ƒå°‘çš„å¤§å—å†™å…¥æ“ä½œï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚</p><p><strong>ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹</strong></p><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œè¯¥ç¨‹åºéœ€è¦å°†å¤§é‡å°æ•°æ®ç‰‡æ®µå†™å…¥æ–‡ä»¶ã€‚å¦‚æœæ¯æ¥æ”¶åˆ°ä¸€å°å—æ•°æ®å°±ç«‹å³å†™å…¥æ–‡ä»¶ï¼Œè¿™å°†å¯¼è‡´é¢‘ç¹çš„ç£ç›˜æ“ä½œï¼Œä»è€Œå½±å“ç¨‹åºæ€§èƒ½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> file</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;./example.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæˆ‘ä»¬â€œå¡ä½â€æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cork</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿæ¥æ”¶åˆ°å¾ˆå¤šå°æ•°æ®ç‰‡æ®µï¼Œæ­£å¸¸æƒ…å†µä¸‹ä½ å¯èƒ½ä»ç½‘ç»œè¯·æ±‚æˆ–è®¡ç®—å¾—åˆ°è¿™äº›æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `&lt;`</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`è¿™æ˜¯ç¬¬ </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> è¡Œæ•°æ®ã€‚</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨process.nextTick()æ¥æ¨¡ä»¿å¼‚æ­¥æ“ä½œï¼Œå¹¶åœ¨æ‰€æœ‰æ•°æ®éƒ½å·²ç»åŠ å…¥åˆ°ç¼“å†²åŒºåâ€œè§£å¡â€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nextTick</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">uncork</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡è°ƒç”¨ <code>file.cork()</code> æ¥â€œå¡ä½â€æµã€‚ç„¶åï¼Œæˆ‘ä»¬å¾ªç¯å†™å…¥ 1000 è¡Œæ•°æ®åˆ°æ–‡ä»¶ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨ <code>cork()</code>ï¼Œæ¯æ¬¡è°ƒç”¨ <code>file.write()</code> éƒ½ä¼šå°è¯•å°†æ•°æ®å†™å…¥ç›®æ ‡æ–‡ä»¶ï¼Œå¯¼è‡´å¤§é‡çš„ç£ç›˜æ“ä½œã€‚ä½†æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº† <code>cork()</code>ï¼Œæ‰€ä»¥è¿™äº›æ•°æ®é¦–å…ˆè¢«ç´¯ç§¯åœ¨å†…å­˜ä¸­ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡ <code>process.nextTick()</code> å‡½æ•°æ¥æ¨¡ä»¿å¼‚æ­¥æ“ä½œï¼Œå¹¶åœ¨å…¶ä¸­è°ƒç”¨ <code>file.uncork()</code>ï¼Œè¿™å°†æŠŠç´¯ç§¯åœ¨å†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®ä¸€æ¬¡æ€§å†™å…¥æ–‡ä»¶ï¼Œè¿™æ ·å¯ä»¥æ˜¾è‘—å‡å°‘å¯¹ç£ç›˜çš„æ“ä½œæ¬¡æ•°ï¼Œæé«˜ç¨‹åºçš„æ•ˆç‡ã€‚</p><p><strong>æ€»ç»“</strong></p><p><code>writable.cork()</code> æ–¹æ³•æ˜¯ä¸€ç§æé«˜å¯å†™æµæ•°æ®å†™å…¥æ•ˆç‡çš„æŠ€æœ¯ï¼Œå®ƒé€šè¿‡æš‚æ—¶é˜»æ­¢æ•°æ®è¢«å†™å…¥ç›®æ ‡æ¥å‡å°‘ç£ç›˜æ“ä½œçš„æ¬¡æ•°ï¼Œä»è€Œæå‡æ€§èƒ½ã€‚åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–éœ€è¦é¢‘ç¹å†™å…¥æ“ä½œçš„åœºæ™¯ä¸­ï¼Œåˆç†åˆ©ç”¨è¿™ä¸€æ–¹æ³•å¯ä»¥å¸¦æ¥æ˜¾è‘—çš„æ€§èƒ½ä¼˜åŠ¿ã€‚</p><h5 id="writable-destroy-error" tabindex="-1"><a class="header-anchor" href="#writable-destroy-error"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writabledestroyerror" target="_blank" rel="noopener noreferrer">writable.destroy([error])</a></span></a></h5><p>Node.js ä¸­çš„ <code>writable.destroy([error])</code> æ–¹æ³•æ˜¯ç”¨äºæµï¼ˆstreamï¼‰å¤„ç†çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚ç†è§£å®ƒæœ‰åŠ©äºä½ é«˜æ•ˆåœ°ç®¡ç†æ•°æ®æµï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰åœºæ™¯æ—¶ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç®€å•äº†è§£ä¸€ä¸‹**æµï¼ˆStreamï¼‰<strong>å’Œ</strong>å¯å†™æµï¼ˆWritable Streamï¼‰**çš„æ¦‚å¿µã€‚</p><ul><li><strong>æµï¼ˆStreamï¼‰</strong>: åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§å¤„ç†è¯»å†™æ•°æ®çš„æ–¹æ³•ï¼Œå¯ä»¥å°†æ•°æ®ä»ä¸€ä¸ªåœ°æ–¹ä¼ è¾“åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚æƒ³è±¡æˆæ°´æµï¼Œæ•°æ®åƒæ°´ä¸€æ ·ä»æºå¤´æµå‘ç›®æ ‡ã€‚</li><li><strong>å¯å†™æµï¼ˆWritable Streamï¼‰</strong>: æ˜¯æµçš„ä¸€ç§ç±»å‹ï¼Œä¸“é—¨ç”¨äºå†™å…¥æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå½“ä½ æƒ³å°†æ•°æ®å†™å…¥æ–‡ä»¶æˆ–é€šè¿‡ç½‘ç»œå‘é€æ•°æ®æ—¶ï¼Œå°±ä¼šä½¿ç”¨åˆ°å¯å†™æµã€‚</li></ul><h3 id="writable-destroy-error-1" tabindex="-1"><a class="header-anchor" href="#writable-destroy-error-1"><span>writable.destroy([error])</span></a></h3><p>ç°åœ¨ï¼Œè¯´åˆ° <code>writable.destroy([error])</code>ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºç«‹å³ç»“æŸæµçš„å†™å…¥æ“ä½œï¼Œå¹¶å¯é€‰åœ°ä¼ é€’ä¸€ä¸ªé”™è¯¯å¯¹è±¡ã€‚å¦‚æœåœ¨é”€æ¯è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜æˆ–éœ€è¦æ ‡è®°ç»“æŸåŸå› ï¼Œè¿™ä¸ªé”™è¯¯å¯¹è±¡å°±éå¸¸æœ‰ç”¨ã€‚</p><h4 id="å‚æ•°-1" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-1"><span>å‚æ•°</span></a></h4><ul><li><code>error</code> ï¼ˆå¯é€‰ï¼‰: å¦‚æœæä¾›äº†é”™è¯¯å¯¹è±¡ï¼Œåˆ™æµä¼šè§¦å‘ <code>&#39;error&#39;</code> äº‹ä»¶ï¼Œå¹¶å°†è¯¥é”™è¯¯ä½œä¸ºå‚æ•°ä¼ é€’ã€‚</li></ul><h4 id="è¿”å›å€¼-1" tabindex="-1"><a class="header-anchor" href="#è¿”å›å€¼-1"><span>è¿”å›å€¼</span></a></h4><ul><li>è°ƒç”¨æ­¤æ–¹æ³•ä¸ä¼šè¿”å›ä»»ä½•å€¼ã€‚</li></ul><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-6" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-6"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><ol><li><strong>æ–‡ä»¶å†™å…¥</strong></li></ol><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œéœ€è¦å°†ä¸€äº›æ•°æ®å†™å…¥æ–‡ä»¶ä¸­ã€‚åœ¨å†™å…¥è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ç”±äºç£ç›˜ç©ºé—´ä¸è¶³æˆ–å…¶ä»–åŸå› å¯¼è‡´å†™å…¥å¤±è´¥ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>destroy</code> æ–¹æ³•æ¥ç»ˆæ­¢å†™å…¥æ“ä½œï¼Œå¹¶å¯é€‰æ‹©æä¾›ä¸€ä¸ªé”™è¯¯å¯¹è±¡æ¥è¯´æ˜ä¸­æ–­åŸå› ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, Node.js!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥è¢«æ„å¤–ç»ˆæ­¢&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æµé‡åˆ°é”™è¯¯ï¼Œå·²è¢«ç»ˆæ­¢:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¯•å›¾å†™å…¥å­—ç¬¦ä¸² &#39;Hello, Node.js!&#39; åˆ° <code>example.txt</code> æ–‡ä»¶ã€‚ç„¶åè°ƒç”¨ <code>destroy</code> æ–¹æ³•å¹¶ä¼ é€’ä¸€ä¸ªé”™è¯¯å¯¹è±¡ã€‚å¦‚æœ <code>destroy</code> è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆ <code>&#39;error&#39;</code> äº‹ä»¶ä¼šè¢«è§¦å‘ï¼Œæˆ‘ä»¬å¯ä»¥ç›‘å¬è¿™ä¸ªäº‹ä»¶å¹¶å¤„ç†é”™è¯¯ã€‚</p><ol start="2"><li><strong>ç½‘ç»œè¯·æ±‚</strong></li></ol><p>è€ƒè™‘å¦ä¸€ä¸ªåœºæ™¯ï¼Œä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå‘å®¢æˆ·ç«¯å‘é€å¤§é‡æ•°æ®ã€‚å¦‚æœçªç„¶å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ï¼Œç»§ç»­å‘é€æ•°æ®å°±æ²¡æœ‰å¿…è¦äº†ï¼Œä¹Ÿå¯èƒ½äº§ç”Ÿé”™è¯¯ã€‚è¿™æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>destroy</code> æ–¹æ³•æ¥åœæ­¢æ•°æ®çš„å‘é€ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;http&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¾ˆå¤§çš„æ•°æ®æºéœ€è¦å‘é€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> hugeDataSource</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> getHugeDataSource</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿè·å–å¤§é‡æ•°æ®çš„å‡½æ•°</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  hugeDataSource</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;data&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      hugeDataSource</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pause</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">once</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;drain&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> hugeDataSource</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  hugeDataSource</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;end&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;close&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å®¢æˆ·ç«¯å…³é—­è¿æ¥ï¼Œç»ˆæ­¢æ•°æ®å‘é€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    hugeDataSource</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;å®¢æˆ·ç«¯æ–­å¼€è¿æ¥&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> getHugeDataSource</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿä¸€ä¸ªå¤§å‹æ•°æ®æº</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;stream&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> count</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dataSource</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `&lt;`</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1000</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> dataSource</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå½“å®¢æˆ·ç«¯çªç„¶å…³é—­è¿æ¥æ—¶ï¼ˆæ¯”å¦‚ç”¨æˆ·å…³é—­äº†æµè§ˆå™¨ï¼‰ï¼Œ<code>req</code> å¯¹è±¡ä¼šè§¦å‘ <code>&#39;close&#39;</code> äº‹ä»¶ã€‚å“åº”äºè¿™ä¸ªäº‹ä»¶ï¼Œæˆ‘ä»¬è°ƒç”¨ <code>hugeDataSource.destroy()</code> æ–¹æ³•æ¥ç«‹åˆ»åœæ­¢æ•°æ®çš„å‘é€ã€‚è¿™æ ·åšæ—¢èŠ‚çº¦äº†èµ„æºï¼Œä¹Ÿé¿å…äº†æ— è°“çš„é”™è¯¯äº§ç”Ÿã€‚</p><h3 id="æ€»ç»“-3" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-3"><span>æ€»ç»“</span></a></h3><p><code>writable.destroy([error])</code> æ–¹æ³•æ˜¯ Node.js æµå¤„ç†ä¸­çš„ä¸€ä¸ªé‡è¦å·¥å…·ï¼Œå®ƒèƒ½å¤Ÿå¸®åŠ©ä½ æœ‰æ•ˆåœ°ç®¡ç†èµ„æºå’Œé”™è¯¯ã€‚åœ¨å¤„ç†æ–‡ä»¶å†™å…¥ã€ç½‘ç»œé€šä¿¡ç­‰åœºæ™¯æ—¶å°¤å…¶æœ‰ç”¨ã€‚é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œä½ åº”è¯¥å¯¹å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æœ‰äº†æ›´æ¸…æ™°çš„ç†è§£ã€‚</p><h5 id="writable-closed" tabindex="-1"><a class="header-anchor" href="#writable-closed"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writableclosed" target="_blank" rel="noopener noreferrer">writable.closed</a></span></a></h5><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥ç†è§£ Node.js ä¸­ <code>writable.closed</code> çš„æ¦‚å¿µï¼Œä»¥åŠå®ƒåœ¨å®é™…åº”ç”¨ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚</p><p>é¦–å…ˆï¼Œäº†è§£ Node.js æ˜¯å¾ˆé‡è¦çš„ã€‚Node.js æ˜¯ä¸€ä¸ªèƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript çš„å¹³å°ï¼Œå®ƒä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡ç«¯ä»£ç ã€‚è¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ‰©å±•äº† JavaScript çš„ä½¿ç”¨èŒƒå›´ï¼Œå› ä¸ºä¹‹å‰å®ƒä¸»è¦è¢«ç”¨äºæµè§ˆå™¨ç«¯ç¼–ç¨‹ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-streams" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-streams"><span>ä»€ä¹ˆæ˜¯ Streamsï¼Ÿ</span></a></h3><p>åœ¨æ·±å…¥ç†è§£ <code>writable.closed</code> ä¹‹å‰ï¼Œä½ éœ€è¦äº†è§£ Node.js ä¸­çš„ â€œæµâ€ï¼ˆStreamsï¼‰æ¦‚å¿µã€‚ç®€å•æ¥è¯´ï¼Œæµæ˜¯ä¸€ç§æ•°æ®çš„é›†åˆï¼Œåƒæ˜¯ä¸€ä¸ªè¿ç»­çš„æ°´æµï¼Œåªä¸è¿‡æµåŠ¨çš„æ˜¯æ•°æ®è€Œä¸æ˜¯æ°´ã€‚åœ¨ Node.js ä¸­ï¼Œæµè¢«ç”¨æ¥å¤„ç†å¤§é‡æ•°æ®ï¼Œå¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰ï¼Œå®ƒä»¬å…è®¸æ•°æ®è¢«é€å—å¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><h3 id="writable-streams-1" tabindex="-1"><a class="header-anchor" href="#writable-streams-1"><span>Writable Streams</span></a></h3><p><code>Writable streams</code> æ˜¯ä¸€ç§å¯ä»¥æ¥æ”¶æ•°æ®å¹¶å†™å…¥æ•°æ®çš„æµï¼Œä¾‹å¦‚å†™å…¥æ–‡ä»¶ã€å†™å…¥å“åº”ä½“ç­‰ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-writable-closed" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-writable-closed"><span>ä»€ä¹ˆæ˜¯ <code>writable.closed</code>?</span></a></h3><p>å½“ä½ ä½¿ç”¨ writable stream ï¼ˆå¯å†™æµï¼‰æ—¶ï¼Œ<code>writable.closed</code> å±æ€§ä¼šåœ¨æµæˆ–å…¶åº•å±‚èµ„æºï¼ˆå¦‚æ–‡ä»¶æè¿°ç¬¦ï¼‰è¢«å…³é—­åå˜æˆä¸€ä¸ª resolved çš„ Promiseã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ æœ‰ä¸€äº›å¼‚æ­¥æ“ä½œéœ€è¦åœ¨æµå®Œå…¨å…³é—­åæ‰§è¡Œï¼Œä½ å¯ä»¥ç­‰å¾…è¿™ä¸ª Promise è§£å†³ã€‚</p><p>æ³¨æ„ï¼Œ<code>writable.closed</code> å’Œç›´æ¥ç›‘å¬ &#39;close&#39; äº‹ä»¶æœ‰æ‰€ä¸åŒã€‚<code>writable.closed</code> æä¾›äº†ä¸€ä¸ª Promise æ¥å£ï¼Œè¿™åœ¨ç°ä»£å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ä¸­ï¼Œå°¤å…¶æ˜¯ä½¿ç”¨ async/await è¯­æ³•æ—¶éå¸¸æ–¹ä¾¿ã€‚</p><h3 id="å®é™…ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­"><span>å®é™…ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å†™ä¸€ä¸ªç®€å•çš„ç¨‹åºï¼Œè¯¥ç¨‹åºå°†æ•°æ®å†™å…¥æ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨æ–‡ä»¶æˆåŠŸå…³é—­åè¿›è¡Œä¸€äº›æ¸…ç†å·¥ä½œã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> file</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å†™å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Another line of text.</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å…³é—­æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç­‰å¾…æµå…³é—­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">closed</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;File has been written and closed successfully.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;An error occurred:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>file.closed</code> æ˜¯ä¸€ä¸ª Promiseï¼Œå®ƒä¼šåœ¨ <code>file.end()</code> è°ƒç”¨åï¼Œå¹¶ä¸”æ–‡ä»¶ç¡®å®è¢«å…³é—­åè§£å†³ã€‚å› æ­¤ï¼Œé€šè¿‡ä½¿ç”¨ <code>.then()</code> æ–¹æ³•ï¼Œä½ å¯ä»¥å®‰æ’ä¸€äº›æ¸…ç†å·¥ä½œæˆ–å…¶ä»–é€»è¾‘ï¼Œç¡®ä¿å®ƒä»¬åœ¨æ–‡ä»¶å®Œå…¨å…³é—­åæ‰§è¡Œã€‚</p><h3 id="æ€»ç»“-4" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-4"><span>æ€»ç»“</span></a></h3><ul><li>Node.js ä¸­çš„ Streams ç”¨äºå¤„ç†è¿ç»­çš„æ•°æ®æµã€‚</li><li><code>Writable streams</code> å…è®¸å‘æŸå¤„å†™å…¥æ•°æ®ã€‚</li><li><code>writable.closed</code> æä¾›äº†ä¸€ä¸ª Promiseï¼Œå®ƒåœ¨æµæˆ–å…¶èµ„æºè¢«å…³é—­åè§£å†³ï¼Œè¿™å¯¹äºè¿›è¡Œå¼‚æ­¥å¤„ç†éå¸¸æœ‰ç”¨ã€‚</li></ul><p>å¸Œæœ›è¿™èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ <code>writable.closed</code> åœ¨ Node.js ä¸­çš„ä½œç”¨å’Œå¦‚ä½•ä½¿ç”¨å®ƒï¼</p><h5 id="writable-destroyed" tabindex="-1"><a class="header-anchor" href="#writable-destroyed"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writabledestroyed" target="_blank" rel="noopener noreferrer">writable.destroyed</a></span></a></h5><p>äº†è§£ <code>writable.destroyed</code> å±æ€§ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ˜ç™½ Node.js ä¸­çš„ Streamsï¼ˆæµï¼‰æ¦‚å¿µã€‚Streams æ˜¯ç”¨äºå¤„ç†æ•°æ®ï¼ˆå¦‚æ–‡ä»¶è¯»å†™æˆ–ç½‘ç»œè¯·æ±‚ç­‰ï¼‰çš„æŠ½è±¡æ¥å£ï¼Œå…¶ä¸­ Writable Streamï¼ˆå¯å†™æµï¼‰æ˜¯ä¸€ç§å…è®¸ Node.js å‘å…¶å†™å…¥æ•°æ®çš„æµã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-writable-destroyed" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-writable-destroyed"><span>ä»€ä¹ˆæ˜¯ <code>writable.destroyed</code>ï¼Ÿ</span></a></h3><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>writable.destroyed</code> æ˜¯ <code>Writable</code> æµå¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆBooleanï¼‰ï¼Œç”¨äºæŒ‡ç¤ºæµæ˜¯å¦å·²ç»è¢«é”€æ¯ã€‚</p><ul><li>å½“æµæœªè¢«é”€æ¯æ—¶ï¼Œ<code>writable.destroyed</code> çš„å€¼ä¸º <code>false</code>ã€‚</li><li>å½“æµè¢«é”€æ¯æ—¶ï¼Œæ— è®ºæ˜¯å› ä¸ºé”™è¯¯ã€æ­£å¸¸ç»“æŸè¿˜æ˜¯è°ƒç”¨äº† <code>destroy()</code> æ–¹æ³•ï¼Œ<code>writable.destroyed</code> çš„å€¼ä¼šå˜ä¸º <code>true</code>ã€‚</li></ul><h3 id="ä¸ºä»€ä¹ˆéœ€è¦-writable-destroyed" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦-writable-destroyed"><span>ä¸ºä»€ä¹ˆéœ€è¦ <code>writable.destroyed</code>ï¼Ÿ</span></a></h3><p>åœ¨å¤„ç†æµæ—¶ï¼Œç¡®è®¤æµçš„çŠ¶æ€éå¸¸å…³é”®ã€‚å¦‚æœå°è¯•å‘å·²ç»é”€æ¯çš„æµå†™å…¥æ•°æ®ï¼Œç¨‹åºå¯èƒ½ä¼šé‡åˆ°é”™è¯¯ã€‚ä½¿ç”¨ <code>writable.destroyed</code> å¯ä»¥å¸®åŠ©å¼€å‘è€…æ£€æŸ¥æµçš„çŠ¶æ€ï¼Œä»è€Œåšå‡ºç›¸åº”çš„å¤„ç†é€»è¾‘ï¼Œæ¯”å¦‚é˜²æ­¢å¯¹é”€æ¯çš„æµè¿›è¡Œå†™æ“ä½œï¼Œæˆ–è€…åœ¨æµè¢«é”€æ¯åæ‰§è¡Œç‰¹å®šçš„æ¸…ç†é€»è¾‘ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-4"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>è€ƒè™‘ä¸€ä¸ªåœºæ™¯ï¼Œä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦ä»ä¸€ä¸ªæ–‡ä»¶è¯»å–æ•°æ®ï¼Œå¹¶å°†è¿™äº›æ•°æ®å†™å…¥å¦ä¸€ä¸ªæ–‡ä»¶ã€‚è¿™é‡Œï¼Œæºæ–‡ä»¶å¯ä»¥é€šè¿‡ Readable Stream æ¥è¯»å–ï¼Œç›®æ ‡æ–‡ä»¶åˆ™å¯ä»¥é€šè¿‡ Writable Stream æ¥å†™å…¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµå†™å…¥ &#39;output.txt&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;finish&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥å®Œæˆã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello Node.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ•°æ®å·²æˆåŠŸå†™å…¥ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾åŸºäºæŸäº›æ¡ä»¶åˆ¤æ–­å†³å®šä¸å†å†™å…¥æ–°æ•°æ®å¹¶å…³é—­æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">someCondition</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // åœ¨è°ƒç”¨ end() å‰æ£€æŸ¥æµæ˜¯å¦å·²è¢«é”€æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">destroyed</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æµæˆåŠŸå…³é—­ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åç»­å°è¯•å†™å…¥æ•°æ®åˆ°æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;é¢å¤–æ•°æ®&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å°è¯•å‘å·²å…³é—­çš„æµå†™å…¥æ•°æ®:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå¯å†™æµ <code>writableStream</code>ï¼Œç”¨äºå‘æ–‡ä»¶ <code>&#39;output.txt&#39;</code> å†™å…¥æ•°æ®ã€‚é€šè¿‡æ£€æŸ¥ <code>writableStream.destroyed</code> å±æ€§ï¼Œåœ¨æµè¢«é”€æ¯åå°è¯•è¿›è¡Œå†™æ“ä½œä¼šæå‰çŸ¥é“æµå·²ç»ä¸èƒ½å†ç”¨æ¥å†™å…¥æ•°æ®ï¼Œä»è€Œå¯ä»¥é¿å…ç›¸å…³çš„é”™è¯¯ã€‚</p><p>æ€»ç»“ï¼š<code>writable.destroyed</code> æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å±æ€§ï¼Œå®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…åœ¨å¤„ç†æµæ—¶ï¼Œæ›´å¥½åœ°ç®¡ç†å’Œæ§åˆ¶æµçš„çŠ¶æ€ã€‚</p><h5 id="writable-end-chunk-encoding-callback" tabindex="-1"><a class="header-anchor" href="#writable-end-chunk-encoding-callback"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writableendchunk-encoding-callback" target="_blank" rel="noopener noreferrer">writable.end([chunk[, encoding]][, callback])</a></span></a></h5><p>Node.js ä¸­çš„ <code>writable.end([chunk[, encoding]][, callback])</code> æ–¹æ³•æ˜¯ç”¨äºç»“æŸå†™æ“ä½œçš„ä¸€ä¸ªé‡è¦æ–¹æ³•ï¼Œå®ƒå±äºæµï¼ˆstreamï¼‰æ¨¡å—ä¸­å¯å†™æµï¼ˆWritable Streamï¼‰çš„ä¸€éƒ¨åˆ†ã€‚åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†å¤§é‡æ•°æ®ï¼Œæ¯”å¦‚æ–‡ä»¶æ“ä½œã€ç½‘ç»œé€šä¿¡ç­‰åœºæ™¯ã€‚</p><h3 id="åŸºæœ¬è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬è§£é‡Š"><span>åŸºæœ¬è§£é‡Š</span></a></h3><ul><li><strong>chunk</strong>ï¼šè¿™æ˜¯å¯é€‰å‚æ•°ã€‚å¦‚æœä½ åœ¨è°ƒç”¨ <code>end()</code> æ–¹æ³•æ—¶è¿˜æœ‰æœ€åä¸€æ®µæ•°æ®éœ€è¦å†™å…¥æµä¸­ï¼Œå¯ä»¥å°†è¿™ä¸ªæ•°æ®ä½œä¸º <code>chunk</code> å‚æ•°ä¼ å…¥ã€‚</li><li><strong>encoding</strong>ï¼šè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ã€‚å½“ä½ ä¼ å…¥äº† <code>chunk</code> ä¸”å®ƒæ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œå¯ä»¥é€šè¿‡ <code>encoding</code> æŒ‡å®šç¼–ç æ ¼å¼ï¼ˆå¦‚ &#39;utf8&#39;, &#39;ascii&#39; ç­‰ï¼‰ï¼Œé»˜è®¤æ˜¯ &#39;utf8&#39;ã€‚</li><li><strong>callback</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªåœ¨æµç»“æŸåä¼šè¢«è°ƒç”¨çš„å‡½æ•°ï¼Œæ˜¯å¯é€‰çš„ã€‚å¦‚æœä½ éœ€è¦åœ¨æµæˆåŠŸç»“æŸæˆ–é‡åˆ°é”™è¯¯æ—¶è·å–é€šçŸ¥ï¼Œå¯ä»¥æä¾›è¿™ä¸ªå›è°ƒå‡½æ•°ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹å‡ ä¸ªå¸¸è§çš„åº”ç”¨åœºæ™¯ï¼š</p><h4 id="_1-å†™å…¥æ–‡ä»¶-1" tabindex="-1"><a class="header-anchor" href="#_1-å†™å…¥æ–‡ä»¶-1"><span>1. å†™å…¥æ–‡ä»¶</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªç¨‹åºï¼Œè¯¥ç¨‹åºéœ€è¦å°†ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä¿å­˜è‡³ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ä½¿ç”¨ Node.js çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆfsï¼‰æ¨¡å—ä¸æµç»“åˆï¼Œå¯ä»¥é«˜æ•ˆåœ°å®ç°è¿™ä¸ªéœ€æ±‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµï¼ŒæŒ‡å‘ä¸€ä¸ªæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ write æ–¹æ³•å†™å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, this is a piece of data.</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æœ€åï¼Œè°ƒç”¨ end æ–¹æ³•ç»“æŸå†™å…¥ï¼Œå¹¶å¯ä»¥é€‰æ‹©ä¼ å…¥æœ€åä¸€æ®µæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;This is the end.</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;File has been written.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå½“è°ƒç”¨ <code>writableStream.end(&#39;This is the end.\n&#39;, &#39;utf8&#39;, callback)</code> æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬ä¸ä»…å†™å…¥äº†æœ€åä¸€æ®µæ•°æ® &#39;This is the end.\n&#39;ï¼ŒåŒæ—¶ä¹Ÿæ ‡è®°äº†æµçš„ç»“æŸã€‚åœ¨æ‰€æœ‰æ•°æ®éƒ½æ­£ç¡®å†™å…¥æ–‡ä»¶åï¼Œä¼šè°ƒç”¨æä¾›çš„å›è°ƒå‡½æ•°æ¥é€šçŸ¥æˆ‘ä»¬ã€‚</p><h4 id="_2-ç½‘ç»œé€šä¿¡" tabindex="-1"><a class="header-anchor" href="#_2-ç½‘ç»œé€šä¿¡"><span>2. ç½‘ç»œé€šä¿¡</span></a></h4><p>åœ¨å¤„ç† HTTP æœåŠ¡å™¨å“åº”æ—¶ï¼ŒNode.js ä½¿ç”¨æµæ¥å‘é€å“åº”ä½“æ•°æ®ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥é€å—åœ°å‘é€æ•°æ®ï¼Œæœ€åä½¿ç”¨ <code>end</code> æ–¹æ³•æ¥å®Œæˆå“åº”ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‘é€å“åº”å¤´å’Œéƒ¨åˆ†æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ç»“æŸå“åº”å¹¶å‘é€å‰©ä½™æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Sent a response to the client.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“è°ƒç”¨ <code>res.end(&#39;World!&#39;, &#39;utf8&#39;, callback)</code>ï¼Œæˆ‘ä»¬æ—¢å®Œæˆäº†å¯¹ &#39;World!&#39; çš„å†™å…¥ï¼Œä¹Ÿæ ‡ç¤ºäº†å“åº”çš„ç»“æŸã€‚è¿™æ ·å®¢æˆ·ç«¯çŸ¥é“æ‰€æœ‰çš„æ•°æ®å—å·²ç»æ¥æ”¶å®Œæ¯•ã€‚</p><h3 id="æ€»ç»“-5" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-5"><span>æ€»ç»“</span></a></h3><p>é€šè¿‡ä»¥ä¸Šä¾‹å­ï¼Œå¸Œæœ›ä½ èƒ½ç†è§£ <code>writable.end([chunk[, encoding]][, callback])</code> æ–¹æ³•çš„åŸºæœ¬ç”¨é€”å’Œå·¥ä½œåŸç†ã€‚å®ƒæ˜¯ç»“æŸå†™æ“ä½œçš„æ ‡å‡†æ–¹å¼ï¼Œåœ¨å¤„ç†æ–‡ä»¶å†™å…¥ã€ç½‘ç»œé€šè®¯ç­‰åœºæ™¯æ—¶éå¸¸æœ‰ç”¨ã€‚é€šè¿‡é€‚æ—¶è°ƒç”¨ <code>end</code> æ–¹æ³•ï¼Œä½ å¯ä»¥é«˜æ•ˆä¸”ä¼˜é›…åœ°ç®¡ç†æ•°æ®æµã€‚</p><h5 id="writable-setdefaultencoding-encoding" tabindex="-1"><a class="header-anchor" href="#writable-setdefaultencoding-encoding"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writablesetdefaultencodingencoding" target="_blank" rel="noopener noreferrer">writable.setDefaultEncoding(encoding)</a></span></a></h5><p>å¥½çš„ï¼Œæˆ‘ä¼šç›´æ¥æ·±å…¥åˆ°ä¸»é¢˜ã€‚</p><p>åœ¨è§£é‡Š <code>writable.setDefaultEncoding(encoding)</code> è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ Node.js ä¸­çš„æµï¼ˆStreamsï¼‰å’Œå®ƒä»¬çš„ä½œç”¨ã€‚Node.js æµæ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†å¤§é‡æ•°æ®ï¼Œæ¯”å¦‚è¯»å–æ–‡ä»¶æˆ–ç½‘ç»œè¯·æ±‚çš„å“åº”ã€‚æµå¯ä»¥åˆ†ä¸ºå››ç§ç±»å‹ï¼šå¯è¯»æµã€å¯å†™æµã€åŒå·¥æµï¼ˆæ—¢å¯è¯»ä¹Ÿå¯å†™ï¼‰ã€è½¬æ¢æµï¼ˆåœ¨è¯»å†™è¿‡ç¨‹ä¸­å¯ä»¥ä¿®æ”¹æ•°æ®ï¼‰ã€‚<code>writable.setDefaultEncoding(encoding)</code> æ˜¯å±äºå¯å†™æµï¼ˆWritable streamsï¼‰çš„ä¸€ä¸ªæ–¹æ³•ã€‚</p><h3 id="writable-setdefaultencoding-encoding-1" tabindex="-1"><a class="header-anchor" href="#writable-setdefaultencoding-encoding-1"><span>writable.setDefaultEncoding(encoding)</span></a></h3><p>è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„å­—ç¬¦ç¼–ç æ–¹å¼ï¼Œç”¨äºå†™å…¥æ•°æ®æ—¶è‡ªåŠ¨å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæŒ‡å®šçš„ç¼–ç ã€‚è¿™æ„å‘³ç€ï¼Œå½“ä½ å‘æµä¸­å†™å…¥æ–‡æœ¬æ•°æ®æ—¶ï¼Œä½ ä¸éœ€è¦æ¯æ¬¡è°ƒç”¨å†™å…¥æ“ä½œæ—¶éƒ½æŒ‡å®šç¼–ç æ–¹å¼ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•å·²ç»å¸®ä½ è®¾å®šäº†é»˜è®¤çš„ç¼–ç ã€‚</p><h4 id="å‚æ•°-2" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-2"><span>å‚æ•°</span></a></h4><ul><li><code>encoding</code>ï¼šè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨æ¥æŒ‡å®šå­—ç¬¦ç¼–ç çš„ç±»å‹ï¼Œæ¯”å¦‚ <code>&#39;utf8&#39;</code>, <code>&#39;ascii&#39;</code>, <code>&#39;base64&#39;</code> ç­‰ã€‚</li></ul><h4 id="è¿”å›å€¼-2" tabindex="-1"><a class="header-anchor" href="#è¿”å›å€¼-2"><span>è¿”å›å€¼</span></a></h4><ul><li>è¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯å…¶æ‰€å±çš„ Writable æµçš„å¼•ç”¨ï¼Œè¿™æ ·å¯ä»¥æ”¯æŒé“¾å¼è°ƒç”¨ã€‚</li></ul><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-7" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-7"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦ä»ä¸€ä¸ªæ–‡ä»¶è¯»å–æ•°æ®ï¼Œå¹¶å¤„ç†æ•°æ®åå†å†™å…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¯å†™æµï¼Œå¹¶ä¸”åˆ©ç”¨ <code>setDefaultEncoding</code> æ–¹æ³•æ¥æŒ‡å®šæˆ‘ä»¬æƒ³è¦çš„å­—ç¬¦ç¼–ç ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµï¼Œå†™å…¥åˆ° output.txt æ–‡ä»¶ä¸­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®é»˜è®¤ç¼–ç ä¸º &#39;utf8&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setDefaultEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å†™å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ•°æ®å†™å…¥æˆåŠŸï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç»“æŸå†™å…¥æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† <code>fs</code> æ¨¡å—ï¼Œç”¨äºæ“ä½œæ–‡ä»¶ç³»ç»Ÿã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘ <code>output.txt</code> çš„å¯å†™æµã€‚é€šè¿‡è°ƒç”¨ <code>setDefaultEncoding(&#39;utf8&#39;)</code>ï¼Œæˆ‘ä»¬è®¾å®šäº†é»˜è®¤çš„å­—ç¬¦ç¼–ç ä¸º UTF-8ï¼Œè¿™æ ·åœ¨åç»­å†™å…¥å­—ç¬¦ä¸²æ•°æ®æ—¶ï¼Œä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®šç¼–ç æ–¹å¼ã€‚éšåæˆ‘ä»¬é€šè¿‡ <code>write</code> æ–¹æ³•å†™å…¥äº†ä¸€äº›æ–‡æœ¬æ•°æ®ï¼Œå¹¶åœ¨å®Œæˆåå…³é—­äº†æµã€‚</p><p>è¿™ä¸ªåŠŸèƒ½ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒç®€åŒ–äº†ç¼–ç ç›¸å…³çš„æ“ä½œï¼Œç¡®ä¿äº†æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¹¶æœ‰åŠ©äºæé«˜ä»£ç çš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚</p><h5 id="writable-uncork" tabindex="-1"><a class="header-anchor" href="#writable-uncork"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writableuncork" target="_blank" rel="noopener noreferrer">writable.uncork()</a></span></a></h5><p>å¥½çš„ï¼Œè®©æˆ‘æ¥å¸®ä½ è¯¦ç»†äº†è§£ <code>writable.uncork()</code> è¿™ä¸ªæ–¹æ³•åœ¨ Node.js ä¸­çš„åº”ç”¨å’Œä½œç”¨ã€‚</p><p>é¦–å…ˆï¼Œè¦ç†è§£ <code>writable.uncork()</code>ï¼Œæˆ‘ä»¬éœ€è¦å…ˆçŸ¥é“ Node.js ä¸­æµ(Streams)çš„æ¦‚å¿µã€‚æµæ˜¯ä¸€ç§å¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“ä½ å¤„ç†å¤§é‡æ•°æ®ï¼Œæˆ–è€…ä½ ä¸æƒ³ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­æ—¶ã€‚åœ¨ Node.js ä¸­ï¼Œæµè¢«å¹¿æ³›ç”¨äºæ–‡ä»¶æ“ä½œã€ç½‘ç»œé€šä¿¡ç­‰åœºæ™¯ã€‚<code>Stream</code> æ¨¡å—æä¾›äº†ä¸€äº›åŸºç¡€çš„ API ç”¨äºæ„å»ºå’Œæ“ä½œæµæ•°æ®ã€‚</p><p>åœ¨æµçš„ç±»å‹ä¸­ï¼Œ<code>Writable</code> æµæ˜¯ä¸€ç§ç”¨äºå†™å…¥æ•°æ®çš„æµã€‚æ¯”å¦‚ï¼Œå½“ä½ æƒ³å¾€æ–‡ä»¶ä¸­å†™å…¥æ•°æ®æˆ–è€…é€šè¿‡ HTTP å“åº”å‘é€æ•°æ®æ—¶ï¼Œå°±ä¼šç”¨åˆ° <code>Writable</code> æµã€‚</p><p>ç°åœ¨æ¥è°ˆè°ˆ <code>.cork()</code> å’Œ <code>.uncork()</code> æ–¹æ³•ï¼š</p><ul><li><code>.cork()</code> æ–¹æ³•ç”¨äºæš‚åœæˆ–ç¼“å†²å†™å…¥åˆ°æµçš„æ“ä½œã€‚è°ƒç”¨ <code>.cork()</code> åï¼Œå†™å…¥çš„æ•°æ®ä¼šè¢«æš‚æ—¶ä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œè€Œä¸æ˜¯ç«‹å³è¾“å‡ºã€‚</li><li><code>.uncork()</code> æ–¹æ³•æ­£å¥½ç›¸åï¼Œå®ƒç”¨äºé‡Šæ”¾æˆ–â€œå¼€å¯â€ä¹‹å‰é€šè¿‡ <code>.cork()</code> ç¼“å†²çš„æ•°æ®ï¼Œè®©æ•°æ®å¯ä»¥æµå‡ºã€‚</li></ul><p>è¿™å¯¹äºæ€§èƒ½ä¼˜åŒ–éå¸¸æœ‰ç”¨ã€‚å‡è®¾ä½ æœ‰å¤šä¸ªå°çš„æ•°æ®å—éœ€è¦å†™å…¥æµã€‚å¦‚æœç›´æ¥é€ä¸ªå†™å…¥ï¼Œæ¯æ¬¡å†™å…¥éƒ½å¯èƒ½æ¶‰åŠåˆ°åº•å±‚ç³»ç»Ÿè°ƒç”¨ï¼Œè¿™ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚ä½¿ç”¨ <code>.cork()</code> å’Œ <code>.uncork()</code>ï¼Œä½ å¯ä»¥å°†è¿™äº›å°çš„å†™å…¥æ“ä½œæš‚æ—¶ç¼“å†²èµ·æ¥ï¼Œç„¶åä¸€æ¬¡æ€§é€šè¿‡ <code>.uncork()</code> å‘é€ï¼Œå‡å°‘ç³»ç»Ÿè°ƒç”¨ï¼Œæé«˜æ€§èƒ½ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-5"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="å°†å¤šä¸ªå°æ•°æ®å—å†™å…¥æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#å°†å¤šä¸ªå°æ•°æ®å—å†™å…¥æ–‡ä»¶"><span>å°†å¤šä¸ªå°æ•°æ®å—å†™å…¥æ–‡ä»¶</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js ç¨‹åºï¼Œéœ€è¦å°†å¤šä¸ªå°æ•°æ®å—å†™å…¥åŒä¸€ä¸ªæ–‡ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> file</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼€å§‹ç¼“å†²å†™æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cork</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿå†™å…¥å¤šä¸ªå°æ•°æ®å—</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;world &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;in &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Node.js</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¸€æ¬¡æ€§åœ°å°†æ‰€æœ‰ç¼“å†²çš„æ•°æ®å†™å…¥æ–‡ä»¶å¹¶ä¸”ç»§ç»­å…è®¸æ•°æ®è¢«å†™å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nextTick</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">uncork</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>.cork()</code> æ¥å¼€å§‹ç¼“å†²å†™å…¥æ“ä½œï¼Œç„¶åæ‰§è¡Œå¤šä¸ª <code>.write()</code> å†™å…¥æ•°æ®ã€‚è¿™äº›æ•°æ®æš‚æ—¶ä¸ä¼šè¢«å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨ <code>process.nextTick()</code> ä»¥ç¡®ä¿æ‰€æœ‰çš„ <code>.write()</code> æ“ä½œéƒ½å®Œæˆåï¼Œå†ä½¿ç”¨ <code>.uncork()</code> æ–¹æ³•å°†æ‰€æœ‰ç¼“å†²çš„æ•°æ®ä¸€æ¬¡æ€§å†™å…¥æ–‡ä»¶ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å‡å°‘äº†å‘æ–‡ä»¶å†™å…¥æ“ä½œçš„æ¬¡æ•°ï¼Œä»è€Œæé«˜äº†ç¨‹åºçš„æ€§èƒ½ã€‚è¿™åœ¨å¤„ç†å¤§é‡å°å‹å†™å…¥æ“ä½œæ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚</p><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šèƒ½å¸®ä½ æ›´å¥½åœ°ç†è§£ <code>writable.uncork()</code> æ–¹æ³•åŠå…¶åœ¨ Node.js ä¸­çš„åº”ç”¨ã€‚</p><h5 id="writable-writable" tabindex="-1"><a class="header-anchor" href="#writable-writable"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writablewritable" target="_blank" rel="noopener noreferrer">writable.writable</a></span></a></h5><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚Node.js å¼ºå¤§çš„ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯å…¶éé˜»å¡ I/O å’Œäº‹ä»¶é©±åŠ¨çš„ç‰¹æ€§ï¼Œè¿™è®© Node.js ç‰¹åˆ«é€‚ç”¨äºæ„å»ºé«˜æ€§èƒ½çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamsï¼‰æ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚æ¯”å¦‚ï¼Œå½“ä½ ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®æˆ–è€…å‘æ–‡ä»¶ä¸­å†™å…¥æ•°æ®æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨æµæ¥å®ç°ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯æ— éœ€ç­‰å¾…æ•´ä¸ªæ–‡ä»¶éƒ½è¢«è¯»å–åˆ°å†…å­˜ä¸­ï¼Œä½ å°±å¯ä»¥å¼€å§‹å¤„ç†æ•°æ®äº†ï¼Œè¿™å¯¹äºå¤„ç†å¤§æ–‡ä»¶å°¤å…¶æœ‰ç”¨ã€‚</p><p><code>writable.writable</code> æ˜¯ <code>Writable</code> æµæ¥å£çš„ä¸€ä¸ªå±æ€§ï¼Œè¡¨ç¤ºæµæ˜¯å¦å¯ä»¥è¢«å†™å…¥ã€‚å¦‚æœæµå·²ç»è¢«ç»“æŸï¼ˆä¾‹å¦‚ï¼Œè°ƒç”¨äº† <code>stream.end()</code> æ–¹æ³•ï¼‰ï¼Œé‚£ä¹ˆ <code>writable.writable</code> çš„å€¼å°†ä¸º <code>false</code>ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-8" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-8"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="_1-å†™å…¥æ–‡ä»¶-2" tabindex="-1"><a class="header-anchor" href="#_1-å†™å…¥æ–‡ä»¶-2"><span>1. å†™å…¥æ–‡ä»¶</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦å°†ç”¨æˆ·ä¸Šä¼ çš„æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;è¿™æ˜¯ä¸€æ®µå°†è¦è¢«å†™å…¥æ–‡ä»¶çš„æ–‡æœ¬æ•°æ®ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ£€æŸ¥æµæ˜¯å¦å¯ä»¥å†™å…¥</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;UTF8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å†™å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç»“æŸå†™å…¥è¿‡ç¨‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;finish&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥å®Œæˆã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å…ˆæ£€æŸ¥ <code>writableStream.writable</code> æ˜¯å¦ä¸ºçœŸï¼Œä»¥ç¡®å®šæµæ˜¯å¦å¯ä»¥å†™å…¥ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>.write()</code> æ–¹æ³•å†™å…¥æ•°æ®ï¼Œå¹¶é€šè¿‡è°ƒç”¨ <code>.end()</code> æ–¹æ³•æ¥ç»“æŸå†™å…¥è¿‡ç¨‹ã€‚<code>.on(&#39;finish&#39;, ...)</code> ç›‘å¬å™¨ä¼šåœ¨å†™å…¥å®Œæˆåè¢«è°ƒç”¨ã€‚</p><h4 id="_2-http-å“åº”-1" tabindex="-1"><a class="header-anchor" href="#_2-http-å“åº”-1"><span>2. HTTP å“åº”</span></a></h4><p>å¦ä¸€ä¸ªå¸¸è§çš„åœºæ™¯æ˜¯åœ¨åˆ›å»º Web æœåŠ¡å™¨æ—¶ï¼Œä½ å¯èƒ½éœ€è¦å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚HTTP å“åº”å¯¹è±¡ (<code>response</code>) ä¹Ÿæ˜¯ä¸€ä¸ª <code>Writable</code> æµã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello World</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running at http://127.0.0.1:8080/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒç›‘å¬ 8080 ç«¯å£ã€‚å¯¹äºæ¯ä¸ªè¯·æ±‚ï¼Œæˆ‘ä»¬æ£€æŸ¥ <code>response.writable</code> æ¥ç¡®è®¤å“åº”æ˜¯å¦å¯ä»¥å†™å…¥ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>.writeHead()</code> æ–¹æ³•è®¾ç½® HTTP å¤´éƒ¨ï¼Œæœ€åé€šè¿‡ <code>.end()</code> æ–¹æ³•å‘é€â€œHello Worldâ€å“åº”ç»™å®¢æˆ·ç«¯ã€‚</p><h3 id="æ€»ç»“-6" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-6"><span>æ€»ç»“</span></a></h3><p><code>writable.writable</code> æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„å±æ€§ï¼Œå®ƒå…è®¸ä½ æ£€æŸ¥ä¸€ä¸ª <code>Writable</code> æµå½“å‰æ˜¯å¦å¯ä»¥è¿›è¡Œå†™å…¥æ“ä½œã€‚è¿™å¯ä»¥å¸®åŠ©é¿å…åœ¨å°è¯•å†™å…¥å·²ç»å…³é—­çš„æµæ—¶å‘ç”Ÿé”™è¯¯ï¼Œä»è€Œä½¿ä½ çš„åº”ç”¨æ›´åŠ å¥å£®å’Œå¯é ã€‚</p><h5 id="writable-writableaborted" tabindex="-1"><a class="header-anchor" href="#writable-writableaborted"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writablewritableaborted" target="_blank" rel="noopener noreferrer">writable.writableAborted</a></span></a></h5><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ JavaScript ç¯å¢ƒï¼Œå®ƒè®©å¼€å‘è€…å¯ä»¥ç”¨ JavaScript ç¼–å†™åç«¯ä»£ç ã€‚Node.js ä¸­æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µå«åšâ€œæµï¼ˆStreamsï¼‰â€ï¼Œå®ƒä»¬å¯ä»¥å¸®åŠ©ä½ é«˜æ•ˆåœ°å¤„ç†æ•°æ®ï¼Œæ¯”å¦‚è¯»å†™æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ã€‚</p><p>åœ¨æµçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œâ€œå¯å†™æµï¼ˆWritable streamsï¼‰â€æ˜¯ä¸€ç§å…è®¸ä½ å‘æŸä¸ªç›®æ ‡å†™å…¥æ•°æ®çš„æµã€‚è¿™äº›ç›®æ ‡å¯ä»¥æ˜¯æ–‡ä»¶ã€HTTP å“åº”ã€æ ‡å‡†è¾“å‡ºï¼ˆconsoleï¼‰ã€æˆ–è€…æ˜¯å…¶ä»–æ›´å¤æ‚çš„ä¸œè¥¿ï¼Œæ¯”å¦‚åŠ å¯†è½¬æ¢æµç­‰ã€‚</p><h3 id="writable-writableaborted-1" tabindex="-1"><a class="header-anchor" href="#writable-writableaborted-1"><span>writable.writableAborted</span></a></h3><p><code>writable.writableAborted</code>æ˜¯ Node.js v21.7.1 ç‰ˆæœ¬ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œç”¨äºæŒ‡ç¤ºä¸€ä¸ªå¯å†™æµæ˜¯å¦å·²ç»è¢«ä¸­æ­¢äº†ã€‚å½“æµç”±äºæŸç§åŸå› ï¼ˆæ¯”å¦‚é”™è¯¯æˆ–æ‰‹åŠ¨è°ƒç”¨äº†ç»ˆæ­¢æ–¹æ³•ï¼‰è€Œæ— æ³•ç»§ç»­å†™å…¥æ•°æ®æ—¶ï¼Œè¿™ä¸ªå±æ€§ä¼šè¢«è®¾ç½®ä¸º<code>true</code>ã€‚</p><p>è¿™é‡Œç®€å•ä¸¾å‡ ä¸ªå®é™…è¿ç”¨çš„ä¾‹å­æ¥å¸®åŠ©ç†è§£ï¼š</p><h4 id="ä¾‹å­-1-å†™å…¥æ–‡ä»¶æ—¶å‡ºé”™" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-å†™å…¥æ–‡ä»¶æ—¶å‡ºé”™"><span>ä¾‹å­ 1ï¼šå†™å…¥æ–‡ä»¶æ—¶å‡ºé”™</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å°è¯•å°†ä¸€äº›æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä½†æ˜¯ç”±äºæŸäº›åŸå› ï¼ˆæ¯”å¦‚ç¡¬ç›˜ç©ºé—´ä¸è¶³ï¼‰ï¼Œå†™å…¥æ“ä½œå¤±è´¥äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒNode.js å°±å¯èƒ½å°†æµæ ‡è®°ä¸ºå·²ä¸­æ­¢ï¼Œå¹¶ä¸”<code>writable.writableAborted</code>å±æ€§ä¼šè¢«è®¾ç½®ä¸º<code>true</code>ã€‚è¿™æ—¶ï¼Œä½ çš„ä»£ç å¯ä»¥æ£€æŸ¥è¿™ä¸ªå±æ€§æ¥ç¡®å®šå†™å…¥æ“ä½œæ˜¯å¦æˆåŠŸï¼Œå¦‚æœæ²¡æœ‰æˆåŠŸï¼Œå¯ä»¥é€‚å½“åœ°å¤„ç†é”™è¯¯ï¼Œä¾‹å¦‚é€šè¿‡é‡Šæ”¾èµ„æºæˆ–è€…é€šçŸ¥ç”¨æˆ·ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writableAborted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥è¢«ä¸­æ­¢.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥æˆåŠŸ.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-2-æ‰‹åŠ¨ä¸­æ­¢å†™å…¥æµ" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-æ‰‹åŠ¨ä¸­æ­¢å†™å…¥æµ"><span>ä¾‹å­ 2ï¼šæ‰‹åŠ¨ä¸­æ­¢å†™å…¥æµ</span></a></h4><p>æœ‰äº›æ—¶å€™ï¼Œä½ å¯èƒ½å› ä¸ºä¸šåŠ¡é€»è¾‘çš„éœ€è¦è€Œæå‰ç»ˆæ­¢å†™å…¥æ“ä½œã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„æ•°æ®å¯¼å…¥ä»»åŠ¡ä¸­ï¼Œå¦‚æœç”¨æˆ·å–æ¶ˆäº†æ“ä½œï¼Œä½ å¯èƒ½æƒ³ç«‹å³åœæ­¢å†™å…¥æ•°æ®ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>.destroy()</code>æ–¹æ³•æ¥ä¸­æ­¢æµï¼Œç„¶åå¯ä»¥é€šè¿‡<code>writable.writableAborted</code>å±æ€§æ¥ç¡®è®¤æµæ˜¯å¦çœŸçš„è¢«ä¸­æ­¢äº†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> myWritable</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åœ¨è¿™é‡Œå¤„ç†å†™å…¥çš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾åœ¨æŸä¸ªæ¡ä»¶ä¸‹éœ€è¦ä¸­æ­¢å†™å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myWritable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ‰‹åŠ¨ç»ˆæ­¢&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myWritable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†æ‰“å°&quot;æ‰‹åŠ¨ç»ˆæ­¢&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myWritable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writableAborted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥æµå·²è¢«ä¸­æ­¢.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>writable.writableAborted</code>å±æ€§åœ¨å®é™…åº”ç”¨ä¸­ä¸»è¦ç”¨äºæ£€æµ‹å¯å†™æµæ˜¯å¦å› ä¸ºæŸäº›åŸå› è¢«æå‰ç»ˆæ­¢äº†ã€‚ç†è§£è¿™ä¸€ç‚¹å¯¹äºç¼–å†™å¥å£®å’Œå¯é çš„ I/O ç›¸å…³ä»£ç éå¸¸é‡è¦ã€‚</p><h5 id="writable-writableended" tabindex="-1"><a class="header-anchor" href="#writable-writableended"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writablewritableended" target="_blank" rel="noopener noreferrer">writable.writableEnded</a></span></a></h5><p>ç†è§£ <code>writable.writableEnded</code> å±æ€§å‰ï¼Œå…ˆäº†è§£ä¸€ä¸‹ Node.js ä¸­çš„æµï¼ˆStreamsï¼‰å’Œå¯å†™æµï¼ˆWritable streamsï¼‰ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ç”¨æ¥å¤„ç†æ•°æ®çš„ä¸€ç§æŠ½è±¡æ¥å£ã€‚è¿™äº›æ•°æ®å¯èƒ½æ˜¯æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰çš„å­—èŠ‚æµã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„æˆ–è€…å³å¯è¯»åˆå¯å†™çš„ã€‚å¯å†™æµæ˜¯ä¸€ç§å¯ä»¥å‘å…¶å†™å…¥æ•°æ®çš„æµã€‚</p><h3 id="å¯å†™æµ-writable-streams-1" tabindex="-1"><a class="header-anchor" href="#å¯å†™æµ-writable-streams-1"><span>å¯å†™æµï¼ˆWritable streamsï¼‰</span></a></h3><p>å¯å†™æµå…è®¸ä½ å‘æŸä¸ªç›®çš„åœ°å†™å…¥æ•°æ®ã€‚ä¾‹å¦‚ï¼š</p><ul><li>å†™å…¥æ–‡ä»¶ï¼ˆä½¿ç”¨ <code>fs.createWriteStream()</code>ï¼‰</li><li>HTTP å“åº”ä½“</li><li>æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯ï¼ˆ<code>process.stdout</code> å’Œ <code>process.stderr</code>ï¼‰</li></ul><h3 id="writable-writableended-1" tabindex="-1"><a class="header-anchor" href="#writable-writableended-1"><span>writable.writableEnded</span></a></h3><p>å½“æˆ‘ä»¬è°ˆåˆ° <code>writable.writableEnded</code> è¿™ä¸ªå±æ€§æ—¶ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯ä¸€ä¸ªåªè¯»å±æ€§ï¼Œå®ƒè¡¨ç¤ºæµæ˜¯å¦å·²ç»ç»“æŸå†™å…¥æ“ä½œã€‚ä¸€æ—¦æµçš„ç»“æŸæ–¹æ³• <code>.end()</code> è¢«è°ƒç”¨ï¼Œä¸å†å…è®¸å‘æµä¸­å†™å…¥æ›´å¤šçš„æ•°æ®ï¼Œ<code>writableEnded</code> å±æ€§ä¼šè¢«è®¾ç½®ä¸º <code>true</code>ã€‚</p><p>è¿™ä¸ªå±æ€§çš„ä¸»è¦ä½œç”¨æ˜¯æä¾›ä¸€ç§æ£€æŸ¥æµçŠ¶æ€çš„æ–¹å¼ï¼Œä»¥ç¡®å®šæ˜¯å¦è¿˜èƒ½å‘è¯¥æµå†™å…¥æ•°æ®ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-2"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ä¾‹å­-1-å°†æ–‡æœ¬å†™å…¥æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-å°†æ–‡æœ¬å†™å…¥æ–‡ä»¶"><span>ä¾‹å­ 1ï¼šå°†æ–‡æœ¬å†™å…¥æ–‡ä»¶</span></a></h4><p>å‡è®¾ä½ æƒ³å°†ä¸€äº›æ–‡æœ¬å†™å…¥æ–‡ä»¶ï¼Œå¹¶ç¡®è®¤å†™å…¥æ“ä½œæ˜¯å¦å®Œæˆï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµå†™å…¥ &#39;example.txt&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writeStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;finish&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    `Write operation finished. Writable Ended: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writeStream</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writableEnded</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å†™å…¥æ•°æ®åˆ°æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, Node.js!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç»“æŸå†™å…¥è¿‡ç¨‹</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ­¤ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å‘ <code>example.txt</code> æ–‡ä»¶å†™å…¥äº†ä¸€æ®µæ–‡æœ¬ã€‚è°ƒç”¨ <code>.end()</code> æ–¹æ³•åï¼Œè§¦å‘äº† <code>&#39;finish&#39;</code> äº‹ä»¶ï¼Œå¹¶ä¸”æ­¤æ—¶ <code>writeStream.writableEnded</code> çš„å€¼ä¸º <code>true</code>ï¼Œè¡¨æ˜å†™å…¥æ“ä½œå·²ç»å®Œæˆï¼Œä¸å†æ¥å—æ–°çš„å†™å…¥æ•°æ®ã€‚</p><h4 id="ä¾‹å­-2-http-æœåŠ¡å™¨å“åº”" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-http-æœåŠ¡å™¨å“åº”"><span>ä¾‹å­ 2ï¼šHTTP æœåŠ¡å™¨å“åº”</span></a></h4><p>è€ƒè™‘ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œè¿”å›å“åº”ç»™å®¢æˆ·ç«¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Response ended? </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writableEnded</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running at http://localhost:3000/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ &quot;Hello, World!&quot;ï¼Œç„¶åç»“æŸå“åº”ã€‚ç”±äºè°ƒç”¨äº† <code>res.end()</code>ï¼Œ<code>res.writableEnded</code> åœ¨å›è°ƒå‡½æ•°å†…éƒ¨è¿”å› <code>true</code>ï¼Œæ ‡è¯†å“åº”å·²ç»å®Œå…¨å‘é€ã€‚</p><p>é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>writable.writableEnded</code> åœ¨å®è·µä¸­å¦‚ä½•ç”¨æ¥æ£€æµ‹æµçš„å†™å…¥çŠ¶æ€ï¼Œç¡®ä¿æµçš„é€»è¾‘æ­£å¸¸è¿›è¡Œï¼Œé¿å…åœ¨æµç»“æŸåå°è¯•å†™å…¥å¯¼è‡´çš„é”™è¯¯ã€‚</p><h5 id="writable-writablecorked" tabindex="-1"><a class="header-anchor" href="#writable-writablecorked"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writablewritablecorked" target="_blank" rel="noopener noreferrer">writable.writableCorked</a></span></a></h5><p>Node.js ä¸­çš„ <code>writable.writableCorked</code> å±æ€§æ˜¯ä¸æµï¼ˆstreamsï¼‰ç›¸å…³çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¯å†™æµï¼ˆwritable streamsï¼‰æ—¶éå¸¸é‡è¦ã€‚è¦ç†è§£è¿™ä¸ªå±æ€§ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£å‡ ä¸ªå…³é”®ç‚¹ï¼šä»€ä¹ˆæ˜¯æµã€ä»€ä¹ˆæ˜¯å¯å†™æµï¼Œä»¥åŠâ€œcorkingâ€æ“ä½œæ˜¯ä»€ä¹ˆæ„æ€ã€‚</p><h3 id="æµ-streams-1" tabindex="-1"><a class="header-anchor" href="#æµ-streams-1"><span>æµï¼ˆStreamsï¼‰</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ç”¨äºå¤„ç†æ•°æ®çš„æŠ½è±¡æ¥å£ã€‚è¿™äº›æ•°æ®å¯ä»¥æ˜¯æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ï¼Œæˆ–è€…å³å¯è¯»åˆå¯å†™ã€‚ä½¿ç”¨æµçš„å¥½å¤„æ˜¯ï¼Œä½ ä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­å°±èƒ½å¤„ç†å®ƒä»¬ï¼Œè¿™å¯¹äºå¤„ç†å¤§é‡æ•°æ®éå¸¸æœ‰ç”¨ã€‚</p><h3 id="å¯å†™æµ-writable-streams-2" tabindex="-1"><a class="header-anchor" href="#å¯å†™æµ-writable-streams-2"><span>å¯å†™æµï¼ˆWritable Streamsï¼‰</span></a></h3><p>å¯å†™æµæ˜¯ä¸€ç§å…è®¸ä½ å‘æŸå¤„å†™å…¥æ•°æ®çš„æµï¼Œæ¯”å¦‚æ–‡ä»¶ã€HTTP å“åº”ä½“æˆ–è€…è¿›ç¨‹æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰ã€‚Node.js æä¾›äº†å¤šç§å¯å†™æµï¼Œä¾‹å¦‚ <code>fs.createWriteStream</code> ç”¨äºå†™å…¥æ–‡ä»¶ï¼Œæˆ– <code>http.ServerResponse</code> ç”¨äºå‘é€ HTTP å“åº”ã€‚</p><h3 id="corking-æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#corking-æ“ä½œ"><span>Corking æ“ä½œ</span></a></h3><p>åœ¨å¯å†™æµä¸­ï¼Œ&quot;corking&quot; æ˜¯ä¸€ç§æš‚æ—¶åœæ­¢å°†æ•°æ®å†™å…¥åº•å±‚ç³»ç»Ÿçš„æ“ä½œï¼Œç›´åˆ°ä½ æ‰§è¡Œäº† &quot;uncork&quot; æ“ä½œæˆ–è°ƒç”¨äº† <code>stream.end()</code> æ–¹æ³•ã€‚å½“ä¸€ä¸ªæµè¢« &quot;corked&quot; åï¼Œä½ å¯ä»¥è¿ç»­åœ°å†™å…¥å¤šä¸ªæ•°æ®ç‰‡æ®µï¼Œè€Œè¿™äº›æ•°æ®ä¸ä¼šç«‹å³å†™å…¥ç›®æ ‡ï¼Œå®ƒä»¬ä¼šè¢«æš‚æ—¶å­˜å‚¨èµ·æ¥ã€‚åªæœ‰å½“æ‰§è¡Œ &quot;uncork&quot; æ“ä½œåï¼Œè¿™äº›ç§¯æ”’çš„æ•°æ®æ‰ä¼šä¸€æ¬¡æ€§å†™å…¥ï¼Œè¿™æœ‰åŠ©äºå‡å°‘ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ï¼Œæé«˜æ•ˆç‡ã€‚</p><h3 id="writable-writablecorked-å±æ€§" tabindex="-1"><a class="header-anchor" href="#writable-writablecorked-å±æ€§"><span>writable.writableCorked å±æ€§</span></a></h3><p><code>writable.writableCorked</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œç”¨äºè·å–å½“å‰è¢« &quot;cork&quot; çš„æ¬¡æ•°ã€‚æ¯æ¬¡è°ƒç”¨ <code>stream.cork()</code> æ–¹æ³•æ—¶ï¼Œè¿™ä¸ªå±æ€§å€¼ä¼šå¢åŠ ï¼Œæ¯æ¬¡è°ƒç”¨ <code>stream.uncork()</code> æˆ– <code>stream.end()</code> æ—¶ï¼Œè¿™ä¸ªå±æ€§å€¼ä¼šå‡å°‘ã€‚å¦‚æœ <code>writable.writableCorked</code> çš„å€¼å¤§äº 0ï¼Œè¡¨ç¤ºå½“å‰æµæ˜¯å¤„äº &quot;corked&quot; çŠ¶æ€çš„ã€‚</p><h3 id="å®ä¾‹è¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å®ä¾‹è¿ç”¨"><span>å®ä¾‹è¿ç”¨</span></a></h3><p>è€ƒè™‘ä¸€ä¸ªåœºæ™¯ï¼Œä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦å°†å¤§é‡æ•°æ®å†™å…¥æ–‡ä»¶ã€‚å¦‚æœç›´æ¥å†™ï¼Œå¯èƒ½ä¼šæ¶‰åŠå¤§é‡çš„ç£ç›˜æ“ä½œï¼Œå½±å“æ€§èƒ½ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ &quot;corking&quot; æ¥ä¼˜åŒ–ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;output.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼€å§‹ corking</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cork</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿ç»­å†™å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `&lt;`</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`è¿™æ˜¯ç¬¬ </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> è¡Œæ•°æ®</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¡åˆ’åœ¨ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­ uncork</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nextTick</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">uncork</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ£€æŸ¥ writableCorked çš„å€¼ï¼Œç¡®è®¤æ˜¯å¦è¿˜å¤„äº corked çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writableCorked</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºå¯èƒ½æ˜¯ 1ï¼Œå–å†³äºæ­¤æ—¶ uncork æ˜¯å¦å·²ç»æ‰§è¡Œ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>stream.cork()</code> å‡½æ•°å¼€å§‹ &quot;corking&quot; è¿›ç¨‹ï¼Œå¹¶è¿ç»­å†™å…¥æ•°æ®ã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡ <code>process.nextTick()</code> è®¡åˆ’åœ¨ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯è¿­ä»£ä¸­æ‰§è¡Œ <code>stream.uncork()</code>ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿æ‰€æœ‰çš„æ•°æ®è¢«ä¸€æ¬¡æ€§æœ‰æ•ˆåœ°å†™å…¥æ–‡ä»¶ã€‚åˆ©ç”¨ <code>writable.writableCorked</code> å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥æµå½“å‰æ˜¯å¦å¤„äº &quot;corked&quot; çŠ¶æ€ã€‚</p><h5 id="writable-errored" tabindex="-1"><a class="header-anchor" href="#writable-errored"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writableerrored" target="_blank" rel="noopener noreferrer">writable.errored</a></span></a></h5><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamsï¼‰æ˜¯å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†å¤§é‡æ•°æ®æˆ–è€…ä½ ä¸å¸Œæœ›ä¸€æ¬¡æ€§è£…è½½åˆ°å†…å­˜ä¸­çš„æ•°æ®ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ï¼Œæˆ–è€…ä¸¤è€…éƒ½å…·å¤‡ã€‚å®ƒä»¬å¯ä»¥å¸®åŠ©ä½ é«˜æ•ˆåœ°å¤„ç†æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰ã€‚</p><p>åœ¨ Node.js çš„ç‰ˆæœ¬ 21.7.1 ä¸­ï¼Œ<code>writable.errored</code> å±æ€§æ˜¯é’ˆå¯¹å¯å†™æµï¼ˆWritable Streamsï¼‰çš„ï¼Œç”¨æ¥æŒ‡ç¤ºæµæ˜¯å¦é‡åˆ°äº†é”™è¯¯ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-writable-errored" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-writable-errored"><span>ä»€ä¹ˆæ˜¯ <code>writable.errored</code>ï¼Ÿ</span></a></h3><p><code>writable.errored</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œç”¨äºæ£€æŸ¥åœ¨å¯å†™æµä¸Šå‘ç”Ÿçš„é”™è¯¯ã€‚å½“æµæ­£å¸¸å·¥ä½œæ—¶ï¼Œè¯¥å±æ€§çš„å€¼ä¸º <code>null</code>ã€‚å¦‚æœæµåœ¨å¤„ç†æ•°æ®æ—¶é‡åˆ°é”™è¯¯ï¼Œ<code>writable.errored</code> åˆ™ä¼šè¢«è®¾ç½®ä¸ºç›¸åº”çš„é”™è¯¯å¯¹è±¡ï¼Œè¡¨ç¤ºè¯¥æµå·²ç»å› ä¸ºæŸç§åŸå› å‡ºé”™äº†ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨-writable-errored" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨-writable-errored"><span>å¦‚ä½•ä½¿ç”¨ <code>writable.errored</code>ï¼Ÿ</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦å‘ä¸€ä¸ªæ–‡ä»¶å†™å…¥æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°åˆ›å»ºä¸€ä¸ªå¯å†™æµã€‚ä½ å¯èƒ½ä¼šæƒ³çŸ¥é“åœ¨å†™å…¥è¿‡ç¨‹ä¸­æ˜¯å¦æœ‰ä»»ä½•é”™è¯¯å‘ç”Ÿï¼Œè¿™å°±æ˜¯ <code>writable.errored</code> å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼•å…¥ fs æ¨¡å—æ¥æ“ä½œæ–‡ä»¶ç³»ç»Ÿ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæŒ‡å‘ &#39;example.txt&#39; æ–‡ä»¶çš„å¯å†™æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘æ–‡ä»¶å†™å…¥å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥è¿‡ç¨‹ä¸­é‡åˆ°é”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥æˆåŠŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ &#39;error&#39; äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æµé‡åˆ°é”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ£€æŸ¥æµæ˜¯å¦é‡åˆ°é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">errored</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ£€æµ‹åˆ°æµé”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">errored</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æµæ²¡æœ‰é”™è¯¯ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-3" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-3"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><ol><li><strong>æ–‡ä»¶å†™å…¥</strong>ï¼šå¦‚ä¸Šé¢çš„ä»£ç ç‰‡æ®µæ‰€å±•ç¤ºçš„ï¼Œ<code>writable.errored</code> å¯ä»¥ç”¨æ¥æ£€æŸ¥å†™å…¥æ–‡ä»¶è¿‡ç¨‹ä¸­æ˜¯å¦é‡åˆ°äº†é”™è¯¯ã€‚</li><li><strong>ç½‘ç»œè¯·æ±‚å“åº”</strong>ï¼šå½“ä½ ä½¿ç”¨ Node.js ç¼–å†™åç«¯æœåŠ¡æ—¶ï¼Œä½ å¯èƒ½éœ€è¦å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚è¿™é‡Œï¼Œå¯å†™æµå¯ä»¥ç”¨äºå‘å®¢æˆ·ç«¯å‘é€å“åº”ä½“ã€‚é€šè¿‡ç›‘å¬å’Œæ£€æŸ¥ <code>writable.errored</code>ï¼Œä½ å¯ä»¥ç¡®å®šå“åº”æ•°æ®æ˜¯å¦æˆåŠŸå‘é€æˆ–æ˜¯å¦é‡åˆ°ä¼ è¾“é”™è¯¯ã€‚</li><li><strong>æ—¥å¿—è®°å½•</strong>ï¼šåœ¨å¤„ç†æ—¥å¿—æ—¶ï¼Œä½ å¯èƒ½ä¼šå°†æ—¥å¿—ä¿¡æ¯å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚ä½¿ç”¨ <code>writable.errored</code>ï¼Œä½ èƒ½å¤Ÿç¡®ä¿æ—¥å¿—è®°å½•è¿‡ç¨‹ä¸­æ²¡æœ‰å‘ç”Ÿé”™è¯¯ï¼Œä»è€Œä¿è¯æ—¥å¿—çš„å®Œæ•´æ€§å’Œå‡†ç¡®æ€§ã€‚</li></ol><p>æ€»ä¹‹ï¼Œ<code>writable.errored</code> å±æ€§ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç§ç®€ä¾¿çš„æ–¹å¼æ¥æ£€æŸ¥å’Œå¤„ç†å¯å†™æµä¸­å‘ç”Ÿçš„é”™è¯¯ï¼Œä»è€Œä½¿å¾—æ•°æ®å†™å…¥æ“ä½œæ›´åŠ å¥å£®å’Œå¯é ã€‚</p><h5 id="writable-writablefinished" tabindex="-1"><a class="header-anchor" href="#writable-writablefinished"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writablewritablefinished" target="_blank" rel="noopener noreferrer">writable.writableFinished</a></span></a></h5><p>Node.js çš„ <code>writable.writableFinished</code> å±æ€§æ˜¯ä¸€ä¸ªåªè¯»å±æ€§ï¼Œå®ƒåœ¨å¯å†™æµï¼ˆwritable streamï¼‰ç»“æŸå†™å…¥æ•°æ®åå˜ä¸º <code>true</code>ã€‚è¿™ä¸ªå±æ€§çš„ç›®çš„æ˜¯è®©ä½ èƒ½å¤ŸçŸ¥é“æ•°æ®æ˜¯å¦å·²ç»è¢«å®Œå…¨å†™å…¥åº•å±‚ç³»ç»Ÿï¼Œå¹¶ä¸”ä¸å†æœ‰æ›´å¤šçš„æ•°æ®è¦å†™å…¥ã€‚</p><p>å¯å†™æµæ˜¯ä¸€ç§å¯ä»¥å‘å…¶å‘é€æ•°æ®çš„æµï¼Œæ¯”å¦‚æ–‡ä»¶å†™å…¥ã€HTTP å“åº”ç­‰ã€‚å½“ä½ å®Œæˆæ•°æ®å†™å…¥å¹¶è°ƒç”¨äº† <code>stream.end()</code> æ–¹æ³•åï¼Œ<code>writableFinished</code> å±æ€§ä¼šè¢«è®¾ç½®ä¸º <code>true</code>ï¼Œè¡¨ç¤ºæ²¡æœ‰æ›´å¤šçš„æ•°æ®éœ€è¦è¢«å†™å…¥æµã€‚</p><p>è¿™é‡Œç”¨å‡ ä¸ªå®é™…çš„ä¾‹å­æ¥è¯´æ˜ <code>writable.writableFinished</code> çš„ç”¨æ³•ï¼š</p><h3 id="ä¾‹å­-1-å‘æ–‡ä»¶å†™å…¥æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-å‘æ–‡ä»¶å†™å…¥æ•°æ®"><span>ä¾‹å­ 1ï¼šå‘æ–‡ä»¶å†™å…¥æ•°æ®</span></a></h3><p>å‡è®¾ä½ æƒ³å‘ä¸€ä¸ªæ–‡ä»¶å†™å…¥æ•°æ®ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯å†™æµï¼Œä½¿ç”¨ <code>fs.createWriteStream</code> æ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> file</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥å®Œæˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç»“æŸå†™å…¥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;finish&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;writableFinished:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writableFinished</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å‘ <code>example.txt</code> æ–‡ä»¶å†™å…¥äº† &quot;Hello, World!&quot;ï¼Œç„¶åè°ƒç”¨äº† <code>file.end(&#39;ç»“æŸå†™å…¥&#39;)</code> æ¥ç»“æŸå†™å…¥è¿‡ç¨‹ã€‚å½“å†™å…¥å®Œæˆæ—¶ï¼Œæˆ‘ä»¬ç›‘å¬ <code>finish</code> äº‹ä»¶æ¥ç¡®è®¤ <code>writableFinished</code> æ˜¯å¦ä¸º <code>true</code>ï¼Œè¡¨ç¤ºæ‰€æœ‰æ•°æ®éƒ½å·²æ­£ç¡®å†™å…¥åº•å±‚ç³»ç»Ÿã€‚</p><h3 id="ä¾‹å­-2-http-å“åº”" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-http-å“åº”"><span>ä¾‹å­ 2ï¼šHTTP å“åº”</span></a></h3><p>åœ¨ä¸€ä¸ª HTTP æœåŠ¡å™¨ä¸­ï¼Œå“åº”å¯¹è±¡ (<code>response</code>) ä¹Ÿæ˜¯ä¸€ä¸ªå¯å†™æµã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>writableFinished</code> æ¥æ£€æŸ¥å“åº”æ˜¯å¦å·²ç»è¢«å®Œå…¨å‘é€ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;finish&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å“åº”å·²å®Œæˆ:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writableFinished</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“æœåŠ¡å™¨æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå®ƒä¼šå‘é€ &quot;Hello, World!&quot; ä½œä¸ºå“åº”ã€‚è°ƒç”¨ <code>res.end()</code> åï¼Œæˆ‘ä»¬ç›‘å¬ <code>finish</code> äº‹ä»¶æ¥æ£€æŸ¥ <code>res.writableFinished</code> å±æ€§ï¼Œç¡®è®¤å“åº”æ˜¯å¦å·²ç»å®Œå…¨å‘é€ã€‚</p><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>writable.writableFinished</code> åœ¨ Node.js ä¸­çš„å®é™…åº”ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†æµæ•°æ®å®Œæˆå†™å…¥çš„æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ã€‚</p><h5 id="writable-writablehighwatermark" tabindex="-1"><a class="header-anchor" href="#writable-writablehighwatermark"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writablewritablehighwatermark" target="_blank" rel="noopener noreferrer">writable.writableHighWaterMark</a></span></a></h5><p>åœ¨ Node.js ä¸­ï¼Œ<code>writableHighWaterMark</code>æ˜¯æµï¼ˆStreamï¼‰å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒæŒ‡å®šäº†åœ¨å¼€å§‹è¿”å›å‹åŠ›ï¼ˆbackpressureï¼‰ä¹‹å‰ï¼Œå¯å†™æµï¼ˆWritable streamï¼‰å†…éƒ¨çš„ç¼“å†²åŒºå¯ä»¥è¾¾åˆ°çš„æœ€å¤§å­—èŠ‚æ•°ã€‚ç†è§£è¿™ä¸ªæ¦‚å¿µå¯¹äºæ§åˆ¶æ•°æ®æµåŠ¨éå¸¸é‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ï¼Œå¦‚æ–‡ä»¶å†™å…¥ã€ç½‘ç»œé€šä¿¡ç­‰åœºæ™¯ã€‚</p><h3 id="writablehighwatermarkè¯¦è§£" tabindex="-1"><a class="header-anchor" href="#writablehighwatermarkè¯¦è§£"><span><code>writableHighWaterMark</code>è¯¦è§£</span></a></h3><ul><li><strong>å®šä¹‰</strong>: <code>writableHighWaterMark</code>è®¾ç½®äº†å¯å†™æµå†…éƒ¨ç¼“å†²åŒºçš„å¤§å°é™åˆ¶ã€‚å½“å†™å…¥æ•°æ®çš„æ€»é‡è¾¾åˆ°æˆ–è¶…è¿‡è¿™ä¸ªé™åˆ¶æ—¶ï¼Œæµä¼šå°è¯•é€šçŸ¥ä½ å‡æ…¢æ•°æ®çš„å‘é€é€Ÿåº¦ã€‚</li><li><strong>å•ä½</strong>: å­—èŠ‚ï¼ˆBytesï¼‰ã€‚</li><li><strong>é»˜è®¤å€¼</strong>: å¯¹äºå¤§å¤šæ•°æµï¼Œé»˜è®¤å€¼ä¸º 16KBï¼ˆ16 * 1024 å­—èŠ‚ï¼‰ã€‚ä½†è¿™ä¸ªå€¼å¯ä»¥åœ¨åˆ›å»ºæµçš„æ—¶å€™é€šè¿‡é€‰é¡¹è¿›è¡Œè‡ªå®šä¹‰ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-4" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-4"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><ol><li><p><strong>æ–‡ä»¶å†™å…¥</strong>:</p><p>å½“ä½ å°†æ•°æ®å†™å…¥æ–‡ä»¶æ—¶ï¼Œå¦‚æœæ•°æ®é‡éå¸¸å¤§ï¼Œç›´æ¥ä¸€æ¬¡æ€§å†™å…¥å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºæˆ–ç¨‹åºå´©æºƒã€‚é€šè¿‡è®¾ç½®<code>writableHighWaterMark</code>ï¼Œä½ å¯ä»¥æ§åˆ¶æ•°æ®å†™å…¥çš„é€Ÿåº¦ï¼Œè®© Node.js æœ‰æœºä¼šåœ¨å†™å…¥ä¸‹ä¸€æ‰¹æ•°æ®å‰å¤„ç†å·²æœ‰çš„æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  highWaterMark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®writableHighWaterMarkä¸º32KB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾`data`æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ•°æ®å—</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥å¤±è´¥:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥æˆåŠŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç½‘ç»œé€šä¿¡</strong>:</p><p>åœ¨ä½¿ç”¨ Node.js è¿›è¡Œç½‘ç»œé€šä¿¡æ—¶ï¼Œå¦‚åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œä½ å¯èƒ½ä¼šæ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„å¤§é‡æ•°æ®ã€‚é€šè¿‡åˆç†è®¾ç½®<code>writableHighWaterMark</code>ï¼Œå¯ä»¥é¿å…æœåŠ¡å™¨å› ä¸ºä¸€æ¬¡å¤„ç†å¤ªå¤šæ•°æ®è€Œå˜å¾—ç¼“æ…¢æˆ–ä¸ç¨³å®šã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> bodyChunks</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    bodyChunks</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¯ä»¥åœ¨è¿™é‡Œæ ¹æ®bodyChunksçš„å¤§å°å†³å®šæ˜¯å¦ç»§ç»­æ¥æ”¶æ•°æ®æˆ–è€…å¤„ç†æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ•°æ®æ¥æ”¶å®Œæ¯•&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè™½ç„¶æ²¡æœ‰ç›´æ¥æ“ä½œ<code>writableHighWaterMark</code>ï¼Œä½†é€šè¿‡æ§åˆ¶æ¥æ”¶å’Œå¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œå¯ä»¥é—´æ¥è¾¾åˆ°ç®¡ç†æµåŠ¨å‹åŠ›çš„ç›®çš„ã€‚</p><h3 id="æ€»ç»“-7" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-7"><span>æ€»ç»“</span></a></h3><p><code>writableHighWaterMark</code>æ˜¯ Node.js æµæ§åˆ¶æœºåˆ¶çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ï¼Œå®ƒå¸®åŠ©å¼€å‘è€…ç®¡ç†æ•°æ®çš„æµåŠ¨ï¼Œå°¤å…¶åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ï¼Œåˆç†ä½¿ç”¨è¿™ä¸€å±æ€§èƒ½å¤Ÿæ˜¾è‘—æå‡åº”ç”¨æ€§èƒ½å’Œç¨³å®šæ€§ã€‚</p><h5 id="writable-writablelength" tabindex="-1"><a class="header-anchor" href="#writable-writablelength"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writablewritablelength" target="_blank" rel="noopener noreferrer">writable.writableLength</a></span></a></h5><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç†è§£ Node.js ä¸­çš„ <code>writable.writableLength</code> æ˜¯ä»€ä¹ˆã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamï¼‰æ˜¯å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“ä½ ä¸éœ€è¦ç«‹å³å¤„ç†å…¨éƒ¨æ•°æ®ï¼Œæˆ–è€…æ•°æ®é‡å¤ªå¤§ï¼Œæ— æ³•ä¸€æ¬¡æ€§è£…è½½åˆ°å†…å­˜ä¸­æ—¶ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ï¼Œæˆ–è€…å³å¯è¯»åˆå¯å†™ã€‚å½“æˆ‘ä»¬è°ˆåˆ° <code>writable.writableLength</code> æ—¶ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯ä¸å¯å†™æµï¼ˆwritable streamsï¼‰ç›¸å…³çš„ä¸€ä¸ªå±æ€§ã€‚</p><h3 id="å¯å†™æµ-writable-streams-3" tabindex="-1"><a class="header-anchor" href="#å¯å†™æµ-writable-streams-3"><span>å¯å†™æµï¼ˆWritable Streamsï¼‰</span></a></h3><p>å¯å†™æµæ˜¯ä¸€ç§å¯ä»¥æ¥æ”¶æ•°æ®å¹¶å°†å…¶å†™å…¥ç›®æ ‡çš„æµã€‚ç›®æ ‡å¯ä»¥æ˜¯æ–‡ä»¶ã€ç»ˆç«¯ã€ç½‘ç»œè¿æ¥ã€æˆ–è€…ç¨‹åºä¸­çš„å¦ä¸€ä¸ªæµç­‰ã€‚</p><h3 id="writable-writablelength-1" tabindex="-1"><a class="header-anchor" href="#writable-writablelength-1"><span>writable.writableLength</span></a></h3><p><code>writable.writableLength</code> å±æ€§æä¾›äº†ä¸€ä¸ªéå¸¸é‡è¦çš„ä¿¡æ¯ï¼šå½“å‰ç¼“å†²é˜Ÿåˆ—ä¸­çš„å­—èŠ‚æ•°ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒå‘Šè¯‰ä½ å·²ç»ä½¿ç”¨ <code>write()</code> æ–¹æ³•å†™å…¥ä½†å°šæœªè¢«æœ€ç»ˆå¤„ç†ï¼ˆä¾‹å¦‚å†™å…¥æ–‡ä»¶ã€å‘é€åˆ°ç½‘ç»œç­‰ï¼‰çš„æ•°æ®é‡ã€‚</p><p>è¿™ä¸ªå±æ€§çš„å€¼å¯¹äºæ§åˆ¶æµé‡ï¼ˆflow controlï¼‰å¾ˆæœ‰å¸®åŠ©ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½æƒ³ç¡®ä¿ä½ ä¸ä¼šå‘ä¸€ä¸ªæ…¢é€Ÿçš„æ¶ˆè´¹è€…ï¼ˆä¾‹å¦‚ç½‘ç»œè¯·æ±‚æˆ–å¤§å‹æ–‡ä»¶æ“ä½œï¼‰æ¨é€å¤ªå¤šæ•°æ®ï¼Œä»¥é¿å…å ç”¨å¤ªå¤šå†…å­˜ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-5" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-5"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-å‘æ–‡ä»¶å†™å…¥æ•°æ®-1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-å‘æ–‡ä»¶å†™å…¥æ•°æ®-1"><span>ç¤ºä¾‹ 1: å‘æ–‡ä»¶å†™å…¥æ•°æ®</span></a></h4><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js ç¨‹åºï¼Œè¯¥ç¨‹åºä»æŸä¸ªæºï¼ˆæ¯”å¦‚ API è°ƒç”¨ï¼‰æŒç»­æ¥æ”¶æ•°æ®ï¼Œå¹¶å°†æ•°æ®å†™å…¥ä¸€ä¸ªæ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>writable.writableLength</code> æ¥ç›‘æ§ç¼“å†²åŒºçš„å¤§å°ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬ä¸ä¼šå› ä¸ºå†™å…¥é€Ÿåº¦è·Ÿä¸ä¸Šæ¥æ”¶é€Ÿåº¦è€Œè€—å°½å†…å­˜ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµï¼ŒæŒ‡å‘ä¸€ä¸ªæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> file</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> writableLength</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿä»æŸä¸ªæºä¸æ–­æ¥æ”¶æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;ä¸€äº›æ–°æ•°æ®</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å†™å…¥æ•°æ®å‰ï¼Œæ£€æŸ¥ writableLength</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writableLength</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">byteLength</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å‡è®¾æˆ‘ä»¬è®¾ç½®äº† 1MB çš„ç¼“å†²é™åˆ¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æš‚åœå†™å…¥ï¼Œé˜²æ­¢å†…å­˜æº¢å‡º&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å†™å…¥æ•°æ®ï¼Œå½“å‰ç¼“å†²åŒºå¤§å°ï¼š</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writableLength</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-æ§åˆ¶æ•°æ®å†™å…¥é€Ÿç‡" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-æ§åˆ¶æ•°æ®å†™å…¥é€Ÿç‡"><span>ç¤ºä¾‹ 2: æ§åˆ¶æ•°æ®å†™å…¥é€Ÿç‡</span></a></h4><p>å¦‚æœæˆ‘ä»¬æ­£åœ¨å®ç°ä¸€ä¸ª TCP æœåŠ¡å™¨ï¼Œéœ€è¦å‘å®¢æˆ·ç«¯å‘é€å¤§é‡æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥ä¾æ® <code>writable.writableLength</code> æ¥è°ƒæ•´å‘é€æ•°æ®çš„é€Ÿç‡ï¼Œé¿å…è¿‡å¿«åœ°å‘é€æ•°æ®å¯¼è‡´å®¢æˆ·ç«¯å¤„ç†ä¸è¿‡æ¥ï¼Œæˆ–æ˜¯æœåŠ¡å™¨ç«¯å†…å­˜å ç”¨è¿‡é«˜ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> net</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;net&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> net</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> intervalId</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;ä¸€äº›é‡è¦æ•°æ®&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writableLength</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `&lt;`</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) { </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ä¸è®©ç¼“å†²åŒºè¶…è¿‡ 1MB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;ç¼“å†²åŒºæ¥è¿‘é˜ˆå€¼ï¼Œç­‰å¾…ä¹‹å‰çš„æ•°æ®è¢«å‘é€&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;close&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        clearInterval</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">intervalId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼Œç›‘å¬ç«¯å£ 8080&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸¤ä¸ªç¤ºä¾‹ä¸­ï¼Œé€šè¿‡æ£€æŸ¥ <code>writable.writableLength</code> çš„å€¼ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæœ‰æ•ˆåœ°ç®¡ç†å†…å­˜ä½¿ç”¨å’Œæ§åˆ¶æ•°æ®æµçš„é€Ÿç‡ï¼Œä»¥é€‚åº”ä¸åŒçš„åœºæ™¯éœ€æ±‚ï¼Œä»è€Œæé«˜ç¨‹åºçš„ç¨³å®šæ€§å’Œæ•ˆç‡ã€‚</p><h5 id="writable-writableneeddrain" tabindex="-1"><a class="header-anchor" href="#writable-writableneeddrain"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writablewritableneeddrain" target="_blank" rel="noopener noreferrer">writable.writableNeedDrain</a></span></a></h5><p>Node.js v21.7.1 ä¸­çš„ <code>writable.writableNeedDrain</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œç”¨äºæŒ‡ç¤ºæ˜¯å¦éœ€è¦è§¦å‘ &#39;drain&#39; äº‹ä»¶ã€‚è¦ç†è§£å®ƒï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æŒæ¡ Node.js ä¸­æµï¼ˆStreamï¼‰çš„æ¦‚å¿µä»¥åŠèƒŒåçš„ä¸€äº›åŸºç¡€çŸ¥è¯†ã€‚</p><h3 id="æµ-stream-åŸºç¡€" tabindex="-1"><a class="header-anchor" href="#æµ-stream-åŸºç¡€"><span>æµï¼ˆStreamï¼‰åŸºç¡€</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ç”¨äºå¤„ç†æ•°æ®ï¼ˆå¦‚è¯»å–æˆ–å†™å…¥ï¼‰çš„æŠ½è±¡æ¥å£ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ï¼Œæˆ–è€…ä¸¤è€…éƒ½å…·å¤‡ã€‚æµçš„ç‰¹ç‚¹æ˜¯æ”¯æŒå¤§æ•°æ®çš„å¤„ç†ï¼Œå› ä¸ºä½ ä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œæ˜¯å¯ä»¥é€å—åœ°å¤„ç†å®ƒä»¬ã€‚</p><h3 id="å¯å†™æµ-writable-stream" tabindex="-1"><a class="header-anchor" href="#å¯å†™æµ-writable-stream"><span>å¯å†™æµï¼ˆWritable Streamï¼‰</span></a></h3><p>å½“æˆ‘ä»¬è®¨è®º <code>writable.writableNeedDrain</code> å±æ€§æ—¶ï¼Œæˆ‘ä»¬å…³æ³¨çš„æ˜¯å¯å†™æµã€‚å¯å†™æµå…è®¸ä½ å†™å…¥æ•°æ®ã€‚å¸¸è§çš„ä¾‹å­åŒ…æ‹¬æ–‡ä»¶å†™å…¥ã€HTTP è¯·æ±‚çš„å“åº”ä½“ç­‰ã€‚å½“ä½ å‘æµä¸­å†™å…¥æ•°æ®æ—¶ï¼Œæ•°æ®ä¼šè¢«æ”¾å…¥ä¸€ä¸ªå†…éƒ¨ç¼“å†²åŒºã€‚</p><h3 id="ç¼“å†²åŒºå’Œ-drain-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¼“å†²åŒºå’Œ-drain-äº‹ä»¶"><span>ç¼“å†²åŒºå’Œ <code>drain</code> äº‹ä»¶</span></a></h3><p>å¯å†™æµæœ‰ä¸€ä¸ªå†…éƒ¨çš„ç¼“å†²åŒºã€‚å½“ä½ å¾€æµä¸­å†™å…¥æ•°æ®æ—¶ï¼Œå¦‚æœå†…éƒ¨ç¼“å†²åŒºæœªæ»¡ï¼Œå†™æ“ä½œé€šå¸¸ä¼šç«‹åˆ»å®Œæˆã€‚ä½†å¦‚æœç¼“å†²åŒºå·²æ»¡ï¼Œé‚£ä¹ˆå†™æ“ä½œå°†ä¼šè¢«æ’é˜Ÿï¼Œç›´åˆ°ç¼“å†²åŒºå†æ¬¡å¯ç”¨ï¼ˆå³æ•°æ®è¢«æ¶ˆè´¹ï¼‰ã€‚è¿™æ—¶å€™ï¼Œå¦‚æœä½ ç»§ç»­å†™å…¥ï¼Œå°±å¯èƒ½è¶…è¿‡æµçš„é«˜æ°´ä½æ ‡è®°ï¼ˆhighWaterMarkï¼‰ï¼Œè¿™æ„å‘³ç€æµå†…éƒ¨çš„ç¼“å†²åŒºå·²ç»è¢«å¡«æ»¡ï¼Œå¹¶ä¸”è¿˜æœ‰æ•°æ®ç­‰å¾…å†™å…¥ã€‚ä¸ºäº†é¿å…æ— é™åˆ¶åœ°å¡«å……å†…å­˜ï¼Œæµæä¾›äº†ä¸€ç§åé¦ˆæœºåˆ¶ï¼šå¦‚æœå†™å…¥æ–¹æ³•è¿”å› <code>false</code>ï¼Œè¡¨ç¤ºç¼“å†²åŒºå·²æ»¡ï¼Œæ­¤æ—¶åº”åœæ­¢å†™å…¥æ“ä½œï¼Œç›´åˆ° <code>&#39;drain&#39;</code> äº‹ä»¶è¢«è§¦å‘ã€‚<code>&#39;drain&#39;</code> äº‹ä»¶è¡¨æ˜ç°åœ¨ç¼“å†²åŒºç©ºé—´è¶³å¤Ÿï¼Œå¯ä»¥ç»§ç»­å†™å…¥æ–°çš„æ•°æ®ã€‚</p><h3 id="writable-writableneeddrain-å±æ€§" tabindex="-1"><a class="header-anchor" href="#writable-writableneeddrain-å±æ€§"><span><code>writable.writableNeedDrain</code> å±æ€§</span></a></h3><p><code>writable.writableNeedDrain</code> å°±æ˜¯åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­å‡ºç°çš„ã€‚è¿™ä¸ªå±æ€§æä¾›äº†ä¸€ä¸ªç®€å•çš„æ–¹å¼ï¼Œæ¥æ£€æŸ¥æ˜¯å¦éœ€è¦ç­‰å¾… <code>drain</code> äº‹ä»¶æ‰èƒ½ç»§ç»­å†™å…¥æ•°æ®ã€‚å¦‚æœ <code>writable.writableNeedDrain</code> çš„å€¼ä¸º <code>true</code>ï¼Œè¿™æ„å‘³ç€ä¹‹å‰çš„å†™æ“ä½œå·²ç»å¯¼è‡´å†…éƒ¨ç¼“å†²åŒºå¡«æ»¡ï¼Œä½ åº”å½“åœæ­¢è¿›ä¸€æ­¥çš„å†™æ“ä½œï¼Œç›´åˆ° <code>&#39;drain&#39;</code> äº‹ä»¶å‘ç”Ÿã€‚</p><h3 id="ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹"><span>ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œè¯¥ç¨‹åºä»ä¸€ä¸ªæºæŒç»­è¯»å–æ•°æ®ï¼Œå¹¶å°†è¿™äº›æ•°æ®å†™å…¥æ–‡ä»¶ã€‚ä½ å¯èƒ½ä¼šä½¿ç”¨ Node.js çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆfsï¼‰æ¨¡å—ä¸­çš„ WriteStreamï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµå†™å…¥ &quot;output.txt&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> shouldContinue</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">shouldContinue</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writableNeedDrain</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">once</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;drain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å½“ &#39;drain&#39; äº‹ä»¶å‘ç”Ÿï¼Œç»§ç»­å†™å…¥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    continueWriting</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¦‚æœæ²¡æœ‰å¿…è¦ç­‰å¾… &#39;drain&#39; äº‹ä»¶ï¼Œç»§ç»­å†™å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  continueWriting</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°è¯•å†™å…¥æ•°æ®ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦éœ€è¦ç­‰å¾… <code>&#39;drain&#39;</code> äº‹ä»¶ã€‚<code>writable.writableNeedDrain</code> å±æ€§å‘Šè¯‰æˆ‘ä»¬ï¼Œåœ¨ç»§ç»­ä¹‹å‰æ˜¯å¦éœ€è¦ç›‘å¬è¯¥äº‹ä»¶ã€‚è¿™æ ·å¯ä»¥å¸®åŠ©æˆ‘ä»¬æœ‰æ•ˆç®¡ç†å†…å­˜å’Œæµçš„å‹åŠ›ï¼Œé¿å…è¿‡å¤šåœ°å°†æ•°æ®ç§¯èšåœ¨å†…å­˜ä¸­ï¼Œä»è€Œæé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚</p><h5 id="writable-writableobjectmode" tabindex="-1"><a class="header-anchor" href="#writable-writableobjectmode"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writablewritableobjectmode" target="_blank" rel="noopener noreferrer">writable.writableObjectMode</a></span></a></h5><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬ç®€å•æ˜äº†åœ°æ·±å…¥äº†è§£ä¸€ä¸‹ <code>Node.js</code> ä¸­çš„ <code>writable.writableObjectMode</code>ã€‚</p><p>é¦–å…ˆï¼Œè¦ç†è§£ <code>writable.writableObjectMode</code>ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ Node.js ä¸­çš„æµï¼ˆStreamsï¼‰å’Œå®ƒä»¬çš„æ¨¡å¼ã€‚Node.js çš„æµæ˜¯ç”¨äºå¤„ç†æ•°æ®çš„æ¥å£ï¼Œæ¯”å¦‚è¯»å–æˆ–å†™å…¥æ•°æ®åˆ°æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ã€æˆ–è€…ä¸¤è€…éƒ½å¯ä»¥ã€‚è€Œè¿™äº›æµå¯ä»¥å·¥ä½œåœ¨ä¸¤ç§æ¨¡å¼ä¹‹ä¸€ï¼š<strong>äºŒè¿›åˆ¶ï¼ˆbinaryï¼‰æ¨¡å¼å’Œå¯¹è±¡æ¨¡å¼</strong>ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæµå·¥ä½œåœ¨äºŒè¿›åˆ¶æ¨¡å¼ï¼Œæ„å‘³ç€å®ƒä»¬å¤„ç†çš„æ•°æ®æ˜¯ä¸€ä¸ªè¿ç»­çš„å­—èŠ‚åºåˆ—ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½æƒ³è¦æµæ¥å¤„ç†æ›´å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ JavaScript å¯¹è±¡ã€‚è¿™å°±æ˜¯ <code>writable.writableObjectMode</code> å±æ€§å‘æŒ¥ä½œç”¨çš„æ—¶å€™ã€‚</p><h3 id="è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#è§£é‡Š"><span>è§£é‡Š</span></a></h3><p><code>writable.writableObjectMode</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œç”¨æ¥æ£€æŸ¥ä¸€ä¸ª writableï¼ˆå¯å†™ï¼‰æµæ˜¯å¦è¢«è®¾ç½®ä¸ºå¯¹è±¡æ¨¡å¼ã€‚å½“è¯¥å±æ€§å€¼ä¸º <code>true</code> æ—¶ï¼Œä»£è¡¨è¿™ä¸ªæµæ¥å—ä»»ä½• JavaScript å¯¹è±¡ä½œä¸ºå…¶è¾“å…¥ï¼Œé™¤äº† <code>null</code>ï¼Œå› ä¸º <code>null</code> åœ¨æµä¸­æ˜¯ç”¨æ¥è¡¨ç¤ºæµçš„ç»“æŸã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-6" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-6"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-æ—¥å¿—è®°å½•å™¨" tabindex="-1"><a class="header-anchor" href="#_1-æ—¥å¿—è®°å½•å™¨"><span>1. æ—¥å¿—è®°å½•å™¨</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å†™ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œéœ€è¦è®°å½•å„ç§ç±»å‹çš„æ—¥å¿—ä¿¡æ¯ã€‚è¿™äº›æ—¥å¿—ä¿¡æ¯å¯èƒ½æ˜¯å­—ç¬¦ä¸²ã€é”™è¯¯å¯¹è±¡æˆ–è€…åŒ…å«å¤šä¸ªå±æ€§çš„å¯¹è±¡ã€‚å¦‚æœä½ ä½¿ç”¨ä¸€ä¸ªä»¥å¯¹è±¡æ¨¡å¼å·¥ä½œçš„å¯å†™æµï¼Œä½ å¯ä»¥ç›´æ¥å°†ä¸åŒç±»å‹çš„æ—¥å¿—æ•°æ®ä½œä¸ºå¯¹è±¡å†™å…¥åˆ°è¿™ä¸ªæµä¸­ï¼Œæ— éœ€å°†å®ƒä»¬è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„å¯å†™æµï¼Œç”¨äºæ—¥å¿—è®°å½•</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> LogStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è®¾ç½®å¯¹è±¡æ¨¡å¼</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">objectMode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¤„ç†æ—¥å¿—å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> logStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> LogStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">logStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">level</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;info&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;This is an information message.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">logStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  level</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Oops! Something went wrong.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä»¥ä¸Šä»£ç ä¼šæ‰“å°å‡ºä¼ å…¥çš„å¯¹è±¡</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-æ•°æ®è½¬æ¢-1" tabindex="-1"><a class="header-anchor" href="#_2-æ•°æ®è½¬æ¢-1"><span>2. æ•°æ®è½¬æ¢</span></a></h4><p>è€ƒè™‘ä¸€ä¸ªåº”ç”¨ï¼Œå®ƒä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼Œå¹¶ä¸”éœ€è¦å¯¹æ•°æ®è¿›è¡Œè½¬æ¢åå†™å…¥å¦ä¸€ä¸ªåœ°æ–¹ã€‚å¦‚æœè¿™äº›æ•°æ®ä»¥å¯¹è±¡å½¢å¼å¤„ç†ï¼Œé‚£ä¹ˆä½¿ç”¨å¯¹è±¡æ¨¡å¼çš„æµå°†éå¸¸æ–¹ä¾¿ã€‚</p><p>ä¾‹å¦‚ï¼Œä½ å¯èƒ½ä»æ•°æ®åº“è·å–åˆ°ä¸€ç³»åˆ—ç”¨æˆ·ä¿¡æ¯çš„å¯¹è±¡ï¼Œç„¶åéœ€è¦æ·»åŠ ä¸€ä¸ªæ—¶é—´æˆ³åˆ°æ¯ä¸ªå¯¹è±¡ä¸­ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> AddTimestamp</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">objectMode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼€å¯å¯¹è±¡æ¨¡å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> result</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">timestamp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() };</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æœ‰ä¸€ä¸ªæºå¤´æµ sourceStream æ­£åœ¨æä¾›å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™é‡Œåªæ˜¯æ¼”ç¤ºï¼Œä¸åŒ…å« sourceStream çš„å®ç°</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> addTimestamp</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AddTimestamp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡å®šsourceStreamæ˜¯ä¸€ä¸ªæä¾›ç”¨æˆ·å¯¹è±¡çš„å¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">sourceStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">addTimestamp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¯ä¸ªå¯¹è±¡ç°åœ¨éƒ½æœ‰äº† timestamp å±æ€§</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä»¥ä¸Šä¸¤ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>writable.writableObjectMode</code> å’Œå¯¹è±¡æ¨¡å¼åœ¨æµæ•°æ®å¤„ç†ä¸­çš„çµæ´»æ€§å’Œå®ç”¨æ€§ã€‚å®ƒè®©æµèƒ½å¤Ÿç›´æ¥å¤„ç†å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œå¢å¼ºäº† Node.js åº”ç”¨ç¨‹åºå¤„ç†å„ç§æ•°æ®ç±»å‹çš„èƒ½åŠ›ã€‚</p><h5 id="writable-write-chunk-encoding-callback" tabindex="-1"><a class="header-anchor" href="#writable-write-chunk-encoding-callback"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writablewritechunk-encoding-callback" target="_blank" rel="noopener noreferrer">writable.write(chunk[, encoding][, callback])</a></span></a></h5><p>Node.js ä¸­çš„<code>writable.write(chunk[, encoding][, callback])</code>æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ–¹æ³•ï¼Œç”¨äºå‘å¯å†™æµä¸­å†™å…¥æ•°æ®ã€‚è¿™ä¸ªæ–¹æ³•ä¸»å±äº Stream API çš„ä¸€éƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠåˆ° Writable æµã€‚ç†è§£è¿™ä¸ªæ–¹æ³•å¯¹äºå¤„ç†ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶æ“ä½œç­‰åœºæ™¯éå¸¸å…³é”®ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£å®ƒï¼Œå¹¶é€šè¿‡ä¸€äº›å®é™…çš„ä¾‹å­æ¥è¯´æ˜å…¶ç”¨æ³•ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œéœ€è¦æ˜ç¡®å‡ ä¸ªæ¦‚å¿µï¼š</p><ul><li><strong>Streamï¼ˆæµï¼‰</strong>ï¼šåœ¨ Node.js ä¸­ï¼Œæµæ˜¯ç”¨æ¥å¤„ç†æ•°æ®çš„æŠ½è±¡æ¥å£ã€‚æ•°æ®å¯ä»¥æ˜¯ä»ä¸€ä¸ªæ–‡ä»¶è¯»å–ï¼Œæˆ–è€…ä»ç½‘ç»œè¯·æ±‚ä¸­æ¥æ”¶ï¼Œç­‰ç­‰ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ï¼Œæˆ–è€…ä¸¤è€…éƒ½å…¼å…·ã€‚</li><li><strong>Writable Streamï¼ˆå¯å†™æµï¼‰</strong>ï¼šæ˜¯ä¸€ç§æµï¼Œå…è®¸ä½ å‘å…¶å†™å…¥æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶å°±å¯ä»¥æ˜¯ä¸€ä¸ªå¯å†™æµã€‚</li></ul><h3 id="writable-write-æ–¹æ³•çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#writable-write-æ–¹æ³•çš„ä½œç”¨"><span><code>writable.write</code> æ–¹æ³•çš„ä½œç”¨</span></a></h3><p><code>writable.write(chunk[, encoding][, callback])</code>æ–¹æ³•å…è®¸ä½ å‘ä¸€ä¸ªå¯å†™æµä¸­å†™å…¥æ•°æ®å—ï¼ˆchunkï¼‰ã€‚è¿™é‡Œçš„â€œæ•°æ®å—â€å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€… Bufferï¼ˆå³äºŒè¿›åˆ¶æ•°æ®ï¼‰ã€‚</p><ul><li><strong>chunk</strong>: è¦å†™å…¥æµçš„æ•°æ®ã€‚å¦‚æœæµçš„ç¼–ç æ˜¯<code>&#39;utf8&#39;</code>ï¼Œå¹¶ä¸” chunk æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™ä¸éœ€è¦æŒ‡å®šç¼–ç ï¼›å¦åˆ™ï¼Œchunk åº”è¯¥æ˜¯ä¸€ä¸ª Buffer æˆ– Uint8Arrayã€‚</li><li><strong>encoding (å¯é€‰)</strong>: å¦‚æœ chunk æ˜¯å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‚æ•°æŒ‡å®šå­—ç¬¦ç¼–ç ï¼ˆå¦‚<code>&#39;utf8&#39;</code>ï¼‰ã€‚å¦‚æœæœªæŒ‡å®šï¼Œé»˜è®¤ä¸º<code>&#39;utf8&#39;</code>ã€‚</li><li><strong>callback (å¯é€‰)</strong>: å½“æ•°æ®å—è¢«å®Œå…¨å¤„ç†åï¼Œè°ƒç”¨çš„å‡½æ•°ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-7" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-7"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-å‘æ–‡ä»¶å†™å…¥å†…å®¹" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-å‘æ–‡ä»¶å†™å…¥å†…å®¹"><span>ä¾‹å­ 1ï¼šå‘æ–‡ä»¶å†™å…¥å†…å®¹</span></a></h4><p>å‡è®¾æˆ‘ä»¬æƒ³è¦å‘ä¸€ä¸ªåä¸º<code>example.txt</code>çš„æ–‡ä»¶ä¸­å†™å…¥æ–‡æœ¬ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> file</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ writable.write æ–¹æ³•å†™å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, Node.js!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥å®Œæˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æœ€ååˆ«å¿˜äº†å…³é—­æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘<code>example.txt</code>çš„å¯å†™æµï¼Œç„¶åä½¿ç”¨<code>write</code>æ–¹æ³•å†™å…¥äº†ä¸€æ®µæ–‡æœ¬ã€‚å†™å…¥å®Œæˆåï¼Œä¼šè°ƒç”¨å›è°ƒå‡½æ•°æ‰“å°â€œå†™å…¥å®Œæˆâ€ã€‚</p><h4 id="ä¾‹å­-2-http-æœåŠ¡å™¨å“åº”-1" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-http-æœåŠ¡å™¨å“åº”-1"><span>ä¾‹å­ 2ï¼šHTTP æœåŠ¡å™¨å“åº”</span></a></h4><p>å½“åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>write</code>æ–¹æ³•å‘å®¢æˆ·ç«¯å‘é€å“åº”ä½“ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å“åº”ä½“å‘é€å®Œæˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç»“æŸå“åº”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“æœ‰ HTTP è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œæˆ‘ä»¬å‘å®¢æˆ·ç«¯å‘é€<code>Hello, World!</code>çš„å“åº”ä½“ã€‚ä½¿ç”¨<code>write</code>æ–¹æ³•ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨è°ƒç”¨<code>end</code>æ–¹æ³•ä¹‹å‰å¤šæ¬¡å†™å…¥å“åº”ä½“çš„ä¸åŒéƒ¨åˆ†ã€‚</p><h3 id="æ€»ç»“-8" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-8"><span>æ€»ç»“</span></a></h3><p><code>writable.write</code>æ–¹æ³•åœ¨ Node.js ä¸­æå…¶æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦å¤„ç†æµæ•°æ®æ—¶ã€‚æ— è®ºæ˜¯å†™å…¥æ–‡ä»¶ã€æä¾› HTTP æœåŠ¡è¿˜æ˜¯ä¸å…¶ä»–å½¢å¼çš„ I/O äº¤äº’ï¼ŒæŒæ¡è¿™ä¸ªæ–¹æ³•çš„ä½¿ç”¨å¯¹äº Node.js å¼€å‘è€…æ¥è¯´æ˜¯éå¸¸é‡è¦çš„ã€‚</p><h3 id="readable-streams" tabindex="-1"><a class="header-anchor" href="#readable-streams"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readable-streams" target="_blank" rel="noopener noreferrer">Readable streams</a></span></a></h3><p>Node.js ä¸­çš„ Readable streamsï¼ˆå¯è¯»æµï¼‰æ˜¯ä¸€ç§æ•°æ®å¤„ç†çš„æŠ½è±¡æ¦‚å¿µï¼Œè®©ä½ èƒ½å¤Ÿä»¥è¿ç»­çš„æ–¹å¼è¯»å–æ•°æ®æºã€‚æƒ³è±¡æˆä¸€ä¸ªæ°´ç®¡ï¼Œæ•°æ®å°±åƒæ°´æµä¸€æ ·ï¼Œä»ä¸€ç«¯æµå…¥ï¼Œç„¶åä½ å¯ä»¥åœ¨å¦ä¸€ç«¯æ¥æ”¶å¹¶å¤„ç†è¿™äº›æ•°æ®ã€‚è¿™ç§å¤„ç†æ–¹å¼å¯¹äºç®¡ç†å¤§é‡æ•°æ®æˆ–è€…æ¥è‡ªå¤–éƒ¨èµ„æºå¦‚æ–‡ä»¶ã€ç½‘ç»œè¯·æ±‚ç­‰çš„æ•°æ®ç‰¹åˆ«æœ‰ç”¨ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-1" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-1"><span>åŸºæœ¬æ¦‚å¿µï¼š</span></a></h3><ul><li><strong>éé˜»å¡</strong>: Node.js çš„è®¾è®¡ç†å¿µä¹‹ä¸€æ˜¯éé˜»å¡ I/O æ“ä½œï¼Œæ„å‘³ç€å½“ä½ ä»æ–‡ä»¶è¯»å–æ•°æ®æ—¶ï¼Œä½ çš„ç¨‹åºè¿˜å¯ä»¥åŒæ—¶åšå…¶ä»–äº‹æƒ…ï¼Œæ¯”å¦‚å¤„ç†ç”¨æˆ·è¾“å…¥ï¼Œè€Œä¸æ˜¯åç­‰æ–‡ä»¶è¯»å–å®Œæˆã€‚</li><li><strong>äº‹ä»¶é©±åŠ¨</strong>: Readable streams åŸºäºäº‹ä»¶é©±åŠ¨æ¨¡å‹ã€‚æœ€å¸¸è§çš„äº‹ä»¶æœ‰ &#39;data&#39;ï¼ˆå½“æœ‰æ•°æ®å¯è¯»æ—¶è§¦å‘ï¼‰å’Œ &#39;end&#39;ï¼ˆæ²¡æœ‰æ›´å¤šæ•°æ®å¯è¯»æ—¶è§¦å‘ï¼‰ã€‚</li></ul><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-9" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-9"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="ä»æ–‡ä»¶è¯»å–æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ä»æ–‡ä»¶è¯»å–æ•°æ®"><span>ä»æ–‡ä»¶è¯»å–æ•°æ®</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªå¾ˆå¤§çš„æ–‡æœ¬æ–‡ä»¶ï¼Œä½ æƒ³é€è¡Œè¯»å–æ•°æ®è¿›è¡Œåˆ†æï¼Œç›´æ¥è¯»å–æ•´ä¸ªæ–‡ä»¶åˆ°å†…å­˜å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚ä½¿ç”¨ stream å°±å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./bigFile.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ readline å’Œæˆ‘ä»¬çš„ stream é€è¡Œè¯»å–</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> rl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  input</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">rl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;line&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Line from file: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">line</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;close&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Finished reading the file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>createReadStream</code> æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘ &#39;bigFile.txt&#39; æ–‡ä»¶çš„å¯è¯»æµã€‚<code>readline.createInterface</code> åˆ™æ˜¯åˆ©ç”¨è¿™ä¸ªæµæ¥é€è¡Œè¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶ä¸”æ¯è¯»å–ä¸€è¡Œéƒ½ä¼šè§¦å‘ä¸€ä¸ª &#39;line&#39; äº‹ä»¶ï¼Œè®©ä½ å¤„ç†è¯»å–åˆ°çš„å†…å®¹ã€‚</p><h4 id="å¤„ç†-http-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#å¤„ç†-http-è¯·æ±‚"><span>å¤„ç† HTTP è¯·æ±‚</span></a></h4><p>å½“ä½ åˆ›å»ºä¸€ä¸ª Web æœåŠ¡å™¨æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨çš„è¯·æ±‚ä½“ï¼ˆbodyï¼‰ä¹Ÿå¯ä»¥è¢«è§†ä½œä¸€ä¸ªå¯è¯»æµã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æ­£åœ¨è®¾è®¡ä¸€ä¸ªéœ€è¦å¤„ç†å¤§æ–‡ä»¶ä¸Šä¼ çš„æœåŠ¡ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">method</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;POST&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è¯·æ±‚ä½“å°±æ˜¯ä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è½¬åŒ– buffer åˆ° string</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Body:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;File uploaded&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">405</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Method Not Allowed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server is running on http://localhost:8080&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯å½“æœ‰æ–°çš„ POST è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡ç›‘å¬ &#39;data&#39; äº‹ä»¶æ¥è¯»å–è¯·æ±‚ä½“çš„æ•°æ®å—ï¼ˆchunkï¼‰ï¼Œå¹¶åœ¨ &#39;end&#39; äº‹ä»¶è§¦å‘æ—¶ç»“æŸè¯»å–ã€‚</p><h3 id="æ€»ç»“-9" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-9"><span>æ€»ç»“</span></a></h3><p>Readable streams æä¾›äº†ä¸€ç§é«˜æ•ˆå¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–è€…æ¥è‡ªå¤–éƒ¨èµ„æºçš„æ•°æ®æ—¶ã€‚é€šè¿‡äº‹ä»¶ç›‘å¬å’Œéé˜»å¡çš„ç‰¹æ€§ï¼Œå®ƒä»¬ä½¿å¾— Node.js åº”ç”¨èƒ½å¤Ÿåœ¨ä¿æŒä½å†…å­˜å ç”¨çš„åŒæ—¶ï¼Œå®ç°é«˜æ€§èƒ½çš„æ•°æ®å¤„ç†ã€‚</p><h4 id="two-reading-modes" tabindex="-1"><a class="header-anchor" href="#two-reading-modes"><span><a href="https://nodejs.org/docs/latest/api/stream.html#two-reading-modes" target="_blank" rel="noopener noreferrer">Two reading modes</a></span></a></h4><p>Node.js ä¸­çš„æµï¼ˆStreamsï¼‰æ˜¯å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«é€‚ç”¨äºå¤„ç†å¤§é‡æ•°æ®æˆ–è€…ä½ ä¸å¸Œæœ›ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­çš„åœºæ™¯ã€‚åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­æåˆ°çš„ &quot;Two reading modes&quot;ï¼Œå³ä¸¤ç§è¯»å–æ¨¡å¼ï¼ŒæŒ‡çš„æ˜¯æµçš„ä¸¤ç§åŸºæœ¬å·¥ä½œæ¨¡å¼ï¼š<strong>éæµåŠ¨æ¨¡å¼</strong>ï¼ˆnon-flowing modeï¼‰å’Œ<strong>æµåŠ¨æ¨¡å¼</strong>ï¼ˆflowing modeï¼‰ã€‚ç†è§£è¿™ä¸¤ç§æ¨¡å¼å¯¹äºé«˜æ•ˆä½¿ç”¨ Node.js å¤„ç†æ•°æ®æµè‡³å…³é‡è¦ã€‚</p><h3 id="éæµåŠ¨æ¨¡å¼-non-flowing-mode" tabindex="-1"><a class="header-anchor" href="#éæµåŠ¨æ¨¡å¼-non-flowing-mode"><span>éæµåŠ¨æ¨¡å¼ï¼ˆNon-Flowing Modeï¼‰</span></a></h3><p>åœ¨éæµåŠ¨æ¨¡å¼ä¸‹ï¼Œæ•°æ®ä¸ä¼šè‡ªåŠ¨ä»åº•å±‚ç³»ç»Ÿè¯»å–ã€‚ç›¸åï¼Œä½ éœ€è¦æ˜¾å¼åœ°ä»æµä¸­æ‹‰å–æ•°æ®ï¼Œé€šå¸¸æ˜¯é€šè¿‡ç›‘å¬ <code>readable</code> äº‹ä»¶ç„¶åè°ƒç”¨ <code>read()</code> æ–¹æ³•æ¥å®Œæˆã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œä½ å®Œå…¨æ§åˆ¶ä½•æ—¶è¯»å–æ•°æ®ï¼Œä»¥åŠè¯»å–å¤šå°‘æ•°æ®ï¼Œè¿™å¯¹äºéœ€è¦ç²¾ç»†æ§åˆ¶æ•°æ®å¤„ç†é€Ÿåº¦çš„åº”ç”¨æ¥è¯´éå¸¸æœ‰ç”¨ã€‚</p><h4 id="å®é™…è¿ç”¨ä¾‹å­-8" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-8"><span>å®é™…è¿ç”¨ä¾‹å­ï¼š</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦ä»ä¸€ä¸ªéå¸¸å¤§çš„æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œä½†ä½ å¸Œæœ›æ ¹æ®å¤„ç†èƒ½åŠ›æ…¢æ…¢åœ°è¯»å–ï¼Œä»¥é¿å…ä¸€æ¬¡æ€§æ¶ˆè€—å¤ªå¤šå†…å­˜ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;very-large-file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¾ªç¯ç¡®ä¿æˆ‘ä»¬è¯»å–äº†æ‰€æœ‰å½“å‰å¯ç”¨çš„æ•°æ®ã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  while</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æµåŠ¨æ¨¡å¼-flowing-mode" tabindex="-1"><a class="header-anchor" href="#æµåŠ¨æ¨¡å¼-flowing-mode"><span>æµåŠ¨æ¨¡å¼ï¼ˆFlowing Modeï¼‰</span></a></h3><p>åœ¨æµåŠ¨æ¨¡å¼ä¸‹ï¼Œæ•°æ®è‡ªåŠ¨ä»åº•å±‚ç³»ç»Ÿè¯»å–ï¼Œå¹¶é€šè¿‡ EventEmitter çš„æ¥å£å°½å¿«ä¼ é€’ç»™åº”ç”¨ç¨‹åºã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œä½ å¯ä»¥è®¾ç½®æ•°æ®çš„ &#39;data&#39; äº‹ä»¶ç›‘å¬å™¨ï¼Œæµä¼šè‡ªåŠ¨å¼€å§‹æ¨é€æ•°æ®ã€‚</p><h4 id="å®é™…è¿ç”¨ä¾‹å­-9" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-9"><span>å®é™…è¿ç”¨ä¾‹å­ï¼š</span></a></h4><p>æƒ³è±¡ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå®æ—¶æ—¥å¿—æ–‡ä»¶åˆ†æå·¥å…·ï¼Œéœ€è¦æŒç»­ç›‘è§†æ—¥å¿—æ–‡ä»¶çš„æ›´æ–°ï¼Œå¹¶ç«‹å³å¤„ç†æ–°åŠ å…¥çš„æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;application-log.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™é‡Œå¯ä»¥å¯¹æ¯ä¸ªchunkè¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚æœç´¢ç‰¹å®šæ—¥å¿—ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No more data in stream.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æµåŠ¨æ¨¡å¼è®©æ•°æ®å¤„ç†å˜å¾—æ›´åŠ åŠæ—¶ï¼Œé€‚åˆäºå¯¹æ•°æ®çš„å®æ—¶å¤„ç†éœ€æ±‚ã€‚è€ŒéæµåŠ¨æ¨¡å¼ç»™äºˆäº†æ›´å¤šçš„æ§åˆ¶æƒï¼Œé€‚ç”¨äºæ•°æ®å¤„ç†é€Ÿåº¦ä¸å†…å­˜ç®¡ç†ä¹‹é—´éœ€è¦ç»†è‡´å¹³è¡¡çš„åœºæ™¯ã€‚</p><p>ç†è§£å’ŒåŒºåˆ†è¿™ä¸¤ç§æ¨¡å¼æ˜¯åˆ©ç”¨ Node.js æ„å»ºé«˜æ•ˆã€å¯é çš„æ•°æ®å¤„ç†åº”ç”¨çš„å…³é”®ã€‚é€‰æ‹©å“ªç§æ¨¡å¼å–å†³äºä½ çš„ç‰¹å®šéœ€æ±‚ï¼Œä¾‹å¦‚å¯¹å®æ—¶æ€§çš„è¦æ±‚ã€å†…å­˜ä½¿ç”¨é™åˆ¶ï¼Œä»¥åŠæ˜¯å¦éœ€è¦å¯¹æ•°æ®æµçš„å¤„ç†è¿‡ç¨‹è¿›è¡Œç²¾ç»†æ§åˆ¶ã€‚</p><h4 id="three-states" tabindex="-1"><a class="header-anchor" href="#three-states"><span><a href="https://nodejs.org/docs/latest/api/stream.html#three-states" target="_blank" rel="noopener noreferrer">Three states</a></span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamsï¼‰æ˜¯å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«é€‚åˆç”¨äºå¤„ç†å¤§é‡æ•°æ®æˆ–è€…ä»ä¸€ä¸ªåœ°æ–¹åˆ°å¦ä¸€ä¸ªåœ°æ–¹ä¼ è¾“æ•°æ®çš„æƒ…å†µã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ï¼Œæˆ–è€…æ—¢å¯è¯»åˆå¯å†™ã€‚ç†è§£æµçš„ä¸‰ç§çŠ¶æ€å¯¹äºæœ‰æ•ˆåœ°ä½¿ç”¨å®ƒä»¬éå¸¸é‡è¦ã€‚</p><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­æåˆ°çš„æµçš„ä¸‰ç§çŠ¶æ€åŒ…æ‹¬ï¼š</p><ol><li><p><strong>å¯è¯»æµçš„ä¸‰ç§çŠ¶æ€</strong>ï¼š</p><ul><li><code>readable._readableState.flowing</code> çš„å€¼ä¸º <code>null</code>ï¼šè¿™æ„å‘³ç€æµå·²ç»è¢«åˆ›å»ºï¼Œä½†è¿˜æ²¡æœ‰ç›‘å¬è€…æˆ–æ¶ˆè´¹è€…å»è¯»å–æˆ–æ“ä½œè¿™ä¸ªæµé‡Œçš„æ•°æ®ã€‚åœ¨è¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œæ•°æ®ä¸ä¼šä»åº•å±‚ç³»ç»Ÿè¯»å–ã€‚</li><li><code>readable._readableState.flowing</code> çš„å€¼ä¸º <code>false</code>ï¼šå½“ä½ æ˜¾å¼åœ°è°ƒç”¨äº† <code>.pause()</code> æ–¹æ³•æ—¶ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œæµä¼šåœæ­¢è‡ªåŠ¨ä»åº•å±‚ç³»ç»Ÿè¯»å–æ•°æ®ã€‚ä½†ä½ ä»ç„¶å¯ä»¥é€šè¿‡ <code>read()</code> æ–¹æ³•æ‰‹åŠ¨ä»æµä¸­è·å–æ•°æ®ã€‚</li><li><code>readable._readableState.flowing</code> çš„å€¼ä¸º <code>true</code>ï¼šè¿™è¡¨ç¤ºæµå¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå¹¶ä¸”æ•°æ®æ­£åœ¨è‡ªåŠ¨ä»åº•å±‚ç³»ç»Ÿä¼ è¾“ã€‚ä½ å¯ä»¥é€šè¿‡æ³¨å†Œ <code>&#39;data&#39;</code> äº‹ä»¶ç›‘å¬å™¨è¿›å…¥è¿™ä¸ªçŠ¶æ€ï¼Œæˆ–è€…è°ƒç”¨ <code>.resume()</code> æ–¹æ³•æ¥ä»æš‚åœçŠ¶æ€æ¢å¤ã€‚</li></ul></li><li><p><strong>å¯å†™æµçš„ä¸¤ç§çŠ¶æ€</strong>ï¼š</p><ul><li><code>writable._writableState.writing</code> çš„å€¼ä¸º <code>true</code> å½“æ•°æ®æ­£åœ¨è¢«å†™å…¥åº•å±‚ç³»ç»Ÿï¼›å¦åˆ™ä¸º <code>false</code>ã€‚è¿™ä¸ªæ ‡å¿—å¸®åŠ©æˆ‘ä»¬äº†è§£æµæ˜¯å¦å¤„äºæ´»è·ƒçš„å†™å…¥è¿‡ç¨‹ä¸­ã€‚</li><li><code>writable._writableState.bufferedRequest</code> å½“å­˜åœ¨å°šæœªå†™å…¥åº•å±‚ç³»ç»Ÿçš„æ•°æ®æ—¶ï¼Œæ­¤å€¼ä¸ºéé›¶ã€‚å®ƒè¡¨ç¤ºæœ‰æ•°æ®åœ¨å†…å­˜ç¼“å†²åŒºä¸­ç­‰å¾…è¢«å†™å…¥ã€‚</li></ul></li></ol><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-3" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-3"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><ol><li><p><strong>æ–‡ä»¶å¤„ç†</strong>ï¼š<br> å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œéœ€è¦è¯»å–ä¸€ä¸ªéå¸¸å¤§çš„æ—¥å¿—æ–‡ä»¶å¹¶åˆ†æå…¶ä¸­çš„æ•°æ®ã€‚ä½¿ç”¨ Node.js çš„æµå¯ä»¥è¾¹è¯»å–è¾¹å¤„ç†æ–‡ä»¶ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¿™æ ·å¯ä»¥æ˜¾è‘—é™ä½åº”ç”¨çš„å†…å­˜ä½¿ç”¨ç‡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readerStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®ç¼–ç ä¸º utf8ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readerStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;UTF8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¤„ç†æµäº‹ä»¶ --&gt; data, end, and error</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readerStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readerStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readerStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stack</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç¨‹åºæ‰§è¡Œå®Œæ¯•&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç½‘ç»œé€šä¿¡</strong>ï¼š<br> Node.js çš„æµä¹Ÿå¹¿æ³›åº”ç”¨äºç½‘ç»œé€šä¿¡ï¼Œæ¯”å¦‚å®ç°ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œæ ¹æ®è¯·æ±‚æµå¼åœ°è¿”å›æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæœåŠ¡ï¼Œå°†è§†é¢‘æ–‡ä»¶æµå¼ä¼ è¾“ç»™å®¢æˆ·ç«¯è€Œä¸æ˜¯ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªæ–‡ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;big_video.mp4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨pipeæ–¹æ³•è®©æ•°æ®æµä»æºå¤´ï¼ˆè§†é¢‘æ–‡ä»¶ï¼‰æµå‘ç›®æ ‡ï¼ˆå“åº”å¯¹è±¡ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8888</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running at http://127.0.0.1:8888/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>ä»¥ä¸Šç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨å®é™…åº”ç”¨ä¸­åˆ©ç”¨ Node.js ä¸­çš„æµå’Œå®ƒä»¬çš„çŠ¶æ€ã€‚é€šè¿‡æŒæ¡è¿™äº›æ¦‚å¿µï¼Œä½ å¯ä»¥æ„å»ºæ›´é«˜æ•ˆã€èµ„æºå ç”¨æ›´å°‘çš„åº”ç”¨ã€‚</p><h4 id="choose-one-api-style" tabindex="-1"><a class="header-anchor" href="#choose-one-api-style"><span><a href="https://nodejs.org/docs/latest/api/stream.html#choose-one-api-style" target="_blank" rel="noopener noreferrer">Choose one API style</a></span></a></h4><p>Node.js ä¸­çš„<code>Stream</code>å¯¹è±¡æ˜¯ç”¨äºå¤„ç†æ•°æ®æµçš„ã€‚æ•°æ®æµå¯ä»¥æ˜¯æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰æ•°æ®ä¼ è¾“è¿‡ç¨‹ã€‚<code>Stream</code>åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–è€…å®æ—¶æ•°æ®æ—¶ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸æ•°æ®è¢«é€å—å¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰æ•°æ®åŠ è½½è¿›å†…å­˜ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>Stream</code>æœ‰å‡ ç§ä¸åŒçš„ API é£æ ¼ï¼Œä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼šå¯è¯»ï¼ˆReadableï¼‰ã€å¯å†™ï¼ˆWritableï¼‰å’ŒåŒå·¥ï¼ˆDuplex/Transformï¼‰ã€‚ä¸åŒç±»å‹çš„<code>Stream</code>é€‚ç”¨äºä¸åŒçš„åº”ç”¨åœºæ™¯ã€‚åœ¨ Node.js v21.7.1 æ–‡æ¡£é‡Œæåˆ°çš„â€œChoose one API styleâ€ä¸»è¦æŒ‡çš„æ˜¯åœ¨ä½¿ç”¨<code>Stream</code>æ—¶ï¼Œå¼€å‘è€…åº”è¯¥é€‰æ‹©å¹¶åšæŒä½¿ç”¨ä¸€ç§ API é£æ ¼æ¥ä¿æŒä»£ç çš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h3 id="_1-å¯è¯»-readable-stream-api" tabindex="-1"><a class="header-anchor" href="#_1-å¯è¯»-readable-stream-api"><span>1. å¯è¯»ï¼ˆReadableï¼‰Stream API</span></a></h3><p>å¯è¯»æµæ˜¯ç”¨æ¥è¯»å–æ•°æ®çš„ã€‚æ¯”å¦‚ï¼Œä»æ–‡ä»¶è¯»å–æ•°æ®ï¼Œæˆ–è€…ä»ç½‘ç»œè¯·æ±‚ä¸­è¯»å–å“åº”ä½“ã€‚</p><p><strong>å®ä¾‹ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥è¯»å–æ–‡ä»¶å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`æ¥æ”¶åˆ° </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> å­—èŠ‚çš„æ•°æ®.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ²¡æœ‰æ›´å¤šæ•°æ®.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-å¯å†™-writable-stream-api" tabindex="-1"><a class="header-anchor" href="#_2-å¯å†™-writable-stream-api"><span>2. å¯å†™ï¼ˆWritableï¼‰Stream API</span></a></h3><p>å¯å†™æµæ˜¯ç”¨æ¥å†™å…¥æ•°æ®çš„ã€‚æ¯”å¦‚ï¼Œå‘æ–‡ä»¶ä¸­å†™å…¥æ•°æ®ï¼Œæˆ–è€…å‘ç½‘ç»œè¯·æ±‚ä¸­å†™å…¥è¯·æ±‚ä½“ã€‚</p><p><strong>å®ä¾‹ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµå†™å…¥åˆ°æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç»“æŸå†™å…¥</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;finish&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶å·²å…¨éƒ¨å†™å…¥.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-åŒå·¥-duplex-å’Œè½¬æ¢-transform-stream-api" tabindex="-1"><a class="header-anchor" href="#_3-åŒå·¥-duplex-å’Œè½¬æ¢-transform-stream-api"><span>3. åŒå·¥ï¼ˆDuplexï¼‰å’Œè½¬æ¢ï¼ˆTransformï¼‰ Stream API</span></a></h3><p>åŒå·¥æµæ—¢å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™ï¼Œå®ƒä»¬åœ¨éœ€è¦åŒæ—¶è¯»å†™æ•°æ®çš„åœºåˆç‰¹åˆ«æœ‰ç”¨ã€‚è½¬æ¢æµæ˜¯åŒå·¥æµçš„ä¸€ç§ç‰¹æ®Šç±»å‹ï¼Œå®ƒå¯ä»¥åœ¨è¾“å‡ºå‰ä¿®æ”¹æˆ–å¤„ç†æ•°æ®ã€‚</p><p><strong>å®ä¾‹ï¼ˆåŒå·¥æµï¼‰ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Duplex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªåŒå·¥æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> duplexStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Duplex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ä¸€äº›æ•°æ®&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨é€æ•°æ®åˆ°è¯»é˜Ÿåˆ—</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¡¨ç¤ºæ²¡æœ‰æ›´å¤šæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å†™å…¥: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">duplexStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`è¯»å–: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">duplexStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å®ä¾‹ï¼ˆè½¬æ¢æµï¼‰ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªè½¬æ¢æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> transformStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toUpperCase</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è½¬æ¢ä¸ºå¤§å†™</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">transformStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`è½¬æ¢å: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">transformStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello, world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ä½ åœ¨ Node.js é¡¹ç›®ä¸­ä½¿ç”¨æµæ—¶ï¼Œé€‰æ‹©ä¸€ç§é£æ ¼å¹¶åšæŒä½¿ç”¨ï¼Œè¿™æ ·å¯ä»¥è®©ä½ çš„ä»£ç æ›´åŠ ä¸€è‡´ã€æ¸…æ™°å’Œæ˜“äºç»´æŠ¤ã€‚</p><h4 id="class-stream-readable" tabindex="-1"><a class="header-anchor" href="#class-stream-readable"><span><a href="https://nodejs.org/docs/latest/api/stream.html#class-streamreadable" target="_blank" rel="noopener noreferrer">Class: stream.Readable</a></span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamï¼‰æ˜¯å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“ä½ å¤„ç†çš„æ•°æ®é‡å¾ˆå¤§æˆ–è€…æ¥è‡ªä¸€ä¸ªæŒç»­çš„æºæ—¶ã€‚æµå¯ä»¥è®©ä½ ä»¥ä¸€ç§éå¸¸é«˜æ•ˆçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œå› ä¸ºå®ƒä»¬å…è®¸ä½ å¤„ç†æ•°æ®ç‰‡æ®µï¼Œè€Œä¸æ˜¯ç­‰å¾…æ‰€æœ‰æ•°æ®éƒ½å¯ç”¨ä¹‹åå†è¿›è¡Œå¤„ç†ã€‚</p><p><code>stream.Readable</code> æ˜¯ Node.js ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„ç±»ï¼Œå±äºæµæ¨¡å—ã€‚æ­£å¦‚å…¶åï¼Œè¿™ä¸ªç±»ç”¨äºåˆ›å»ºä¸€ä¸ªå¯è¯»æµã€‚å¯è¯»æµæ˜¯ä¸€ç§å¯ä»¥ä»ä¸­æ¶ˆè´¹æ•°æ®çš„æµï¼Œæ¯”å¦‚ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œæˆ–è€…ä»ç½‘ç»œè¯·æ±‚ä¸­è·å–æ•°æ®ã€‚</p><h3 id="åŸºç¡€ç†è§£" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€ç†è§£"><span>åŸºç¡€ç†è§£</span></a></h3><p>ç®€å•åœ°è¯´ï¼Œ<code>stream.Readable</code> ç±»å°±åƒæ˜¯ä¸€ä¸ªç®¡é“ï¼Œä½ å¯ä»¥ä»è¿™ä¸ªç®¡é“çš„ä¸€ç«¯æ”¾å…¥æ•°æ®ï¼ˆæ¯”å¦‚æ–‡ä»¶å†…å®¹ï¼‰ï¼Œç„¶åä»å¦ä¸€ç«¯æ¥æ”¶å’Œå¤„ç†è¿™äº›æ•°æ®ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œä½ ä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™å¯¹äºå¤„ç†å¤§æ–‡ä»¶æˆ–è€…å®æ—¶æ•°æ®æ¥è¯´ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå‡å°‘äº†å†…å­˜çš„ä½¿ç”¨ï¼Œæé«˜äº†ç¨‹åºçš„æ•ˆç‡ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-10" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-10"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</strong>ï¼š</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¾ˆå¤§çš„æ–‡æœ¬æ–‡ä»¶ï¼Œæˆ‘ä»¬æƒ³è¦é€è¡Œè¯»å–è¿™ä¸ªæ–‡ä»¶ã€‚ä½¿ç”¨ <code>fs</code> æ¨¡å—ï¼ˆNode.js çš„æ–‡ä»¶ç³»ç»Ÿæ¨¡å—ï¼‰å’Œ <code>stream.Readable</code> ç±»ç»“åˆï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥è¯»å–æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fileStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/your/large/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ readline åˆ›å»ºä¸€ä¸ªé€è¡Œè¯»å–çš„æ¥å£</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> rl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  input</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fileStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  crlfDelay</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">Infinity</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é€è¡Œè¯»å–æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">rl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;line&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Line from file: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">line</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>HTTP è¯·æ±‚</strong>ï¼š</p><p>å½“ä½ å‘é€ä¸€ä¸ª HTTP è¯·æ±‚å¹¶ä¸”æ¥æ”¶å“åº”æ—¶ï¼Œå“åº”ä½“å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªå¯è¯»æµã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥é€å—å¤„ç†å“åº”æ•°æ®ï¼Œè€Œä¸æ˜¯ç­‰å¾…æ•´ä¸ªå“åº”ä½“éƒ½è¢«æ¥æ”¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">resp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ¥æ”¶æ•°æ®ç‰‡æ®µï¼Œå¹¶è¿æ¥æˆå®Œæ•´çš„å“åº”æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  resp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å½“æ‰€æœ‰æ•°æ®æ¥æ”¶å®Œæ¯•ï¼Œæ‰“å°å‡ºå®Œæ•´çš„å“åº”å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  resp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æµåŠ¨æ¨¡å¼ä¸æš‚åœæ¨¡å¼</strong>ï¼š</p><p>å¯è¯»æµæœ‰ä¸¤ç§æ¨¡å¼ï¼šæµåŠ¨æ¨¡å¼å’Œæš‚åœæ¨¡å¼ã€‚åœ¨æµåŠ¨æ¨¡å¼ä¸‹ï¼Œæ•°æ®è‡ªåŠ¨ä»åº•å±‚ç³»ç»Ÿè¯»å–ï¼Œå¹¶é€šè¿‡äº‹ä»¶å°½å¯èƒ½å¿«åœ°æä¾›ç»™ä½ çš„åº”ç”¨ç¨‹åºã€‚åœ¨æš‚åœæ¨¡å¼ä¸‹ï¼Œä½ éœ€è¦æ˜¾å¼åœ°è°ƒç”¨æ–¹æ³•æ¥è¯»å–æ•°æ®å—ã€‚</p><ul><li>æµåŠ¨æ¨¡å¼ç¤ºä¾‹ï¼šç›‘å¬ <code>data</code> äº‹ä»¶ã€‚</li><li>æš‚åœæ¨¡å¼ç¤ºä¾‹ï¼šä½¿ç”¨ <code>read()</code> æ–¹æ³•ã€‚</li></ul></li></ol><p><code>stream.Readable</code> ç±»åŠå…¶ç›¸å…³çš„æµå¤„ç†æœºåˆ¶ï¼Œåœ¨ Node.js ç¼–ç¨‹ä¸­æ‰®æ¼”äº†éå¸¸å…³é”®çš„è§’è‰²ã€‚ç†è§£å’ŒæŒæ¡æµçš„æ¦‚å¿µï¼Œå°†ä¼šè®©ä½ èƒ½å¤Ÿæ›´åŠ é«˜æ•ˆåœ°å¤„ç†å„ç§æ•°æ®æºï¼Œæ— è®ºæ˜¯æ–‡ä»¶ã€ç½‘ç»œè¯·æ±‚è¿˜æ˜¯å…¶ä»–ç±»å‹çš„æ•°æ®æµã€‚</p><h5 id="event-close-2" tabindex="-1"><a class="header-anchor" href="#event-close-2"><span><a href="https://nodejs.org/docs/latest/api/stream.html#event-close_1" target="_blank" rel="noopener noreferrer">Event: &#39;close&#39;</a></span></a></h5><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚è€Œ Node.js ä¸­ï¼Œæµï¼ˆStreamï¼‰æ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ é«˜æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®ï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å†™æˆ–ç½‘ç»œé€šä¿¡ç­‰ã€‚ç°åœ¨ï¼Œæˆ‘å°†è¯¦ç»†è§£é‡Š Node.js v21.7.1 ä¸­å…³äºæµçš„ <code>&#39;close&#39;</code> äº‹ä»¶ï¼Œå¹¶é€šè¿‡å®é™…ä¾‹å­æ¥é˜æ˜å…¶åº”ç”¨ã€‚</p><h3 id="event-close-3" tabindex="-1"><a class="header-anchor" href="#event-close-3"><span>Event: &#39;close&#39;</span></a></h3><p>åœ¨ Node.js çš„æµï¼ˆStreamï¼‰æ¨¡å—ä¸­ï¼Œ<code>&#39;close&#39;</code> äº‹ä»¶æ˜¯åœ¨æµæˆ–èµ„æºè¢«å…³é—­åè§¦å‘çš„ã€‚è¿™æ„å‘³ç€ï¼Œä¸å†æœ‰äº‹ä»¶ä¼šè¢«è§¦å‘ï¼Œä¹Ÿä¸ä¼šæœ‰æ›´å¤šçš„æ•°æ®è¢«è¯»å–æˆ–å†™å…¥ã€‚ç†è§£ <code>&#39;close&#39;</code> äº‹ä»¶å¯¹äºç®¡ç†èµ„æºå’Œé¿å…å†…å­˜æ³„æ¼éå¸¸é‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œé€šä¿¡æ—¶ã€‚</p><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹-4" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-4"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h4><p>æˆ‘å°†æä¾›ä¸¤ä¸ªä¾‹å­ï¼Œåˆ†åˆ«å±•ç¤º <code>&#39;close&#39;</code> äº‹ä»¶åœ¨æ–‡ä»¶ç³»ç»Ÿæ“ä½œå’Œç½‘ç»œè¯·æ±‚ä¸­çš„åº”ç”¨ã€‚</p><h5 id="ç¤ºä¾‹-1-æ–‡ä»¶ç³»ç»Ÿæ“ä½œ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-æ–‡ä»¶ç³»ç»Ÿæ“ä½œ"><span>ç¤ºä¾‹ 1ï¼šæ–‡ä»¶ç³»ç»Ÿæ“ä½œ</span></a></h5><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œéœ€è¦ä»ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­è¯»å–æ•°æ®è¿›è¡Œå¤„ç†ã€‚ä½¿ç”¨ <code>fs.createReadStream</code> æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¯è¯»æµè¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶ç›‘å¬ <code>&#39;close&#39;</code> äº‹ä»¶ä»¥çŸ¥é“ä½•æ—¶æ–‡ä»¶è¯»å–å®Œæ¯•å¹¶ä¸”æµå·²ç»å…³é—­ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥è¯»å–æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./largefile.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ &#39;close&#39; äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;close&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stream closed, no more data to read.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨ <code>fs.createReadStream</code> æ–¹æ³•æ‰“å¼€äº†ä¸€ä¸ªåä¸º <code>largefile.txt</code> çš„æ–‡ä»¶çš„å¯è¯»æµã€‚ä¹‹åï¼Œæˆ‘ä»¬ç›‘å¬ <code>data</code> äº‹ä»¶ä»¥æ¥æ”¶æ•°æ®å—ï¼Œå¹¶åœ¨ <code>close</code> äº‹ä»¶è§¦å‘æ—¶è¾“å‡ºæç¤ºä¿¡æ¯ã€‚è¿™æ ·ï¼Œå½“æ–‡ä»¶çš„æ‰€æœ‰å†…å®¹éƒ½è¢«è¯»å–å®Œæ¯•ï¼Œä¸”æµè¢«å…³é—­åï¼Œæˆ‘ä»¬å°±èƒ½å¾—åˆ°é€šçŸ¥ã€‚</p><h5 id="ç¤ºä¾‹-2-ç½‘ç»œè¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ç½‘ç»œè¯·æ±‚"><span>ç¤ºä¾‹ 2ï¼šç½‘ç»œè¯·æ±‚</span></a></h5><p>è€ƒè™‘ä¸€ä¸ªæœåŠ¡å™¨ç«¯çš„åœºæ™¯ï¼Œä½ å¯èƒ½éœ€è¦ä»ä¸€ä¸ª HTTP è¯·æ±‚ä¸­è¯»å–æ•°æ®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·æ±‚å¯¹è±¡æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¯è¯»æµã€‚ä½ å¯ä»¥ç›‘å¬è¿™ä¸ªæµçš„ <code>&#39;close&#39;</code> äº‹ä»¶ï¼Œä»¥ä¾¿çŸ¥é“å®¢æˆ·ç«¯æ˜¯å¦æå‰å…³é—­äº†è¿æ¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ç›‘å¬ &#39;close&#39; äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;close&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Connection closed before all data was received.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server is running on http://localhost:3000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œç›‘å¬è¿›å…¥çš„è¿æ¥è¯·æ±‚ã€‚å¯¹äºæ¯ä¸ªè¯·æ±‚ï¼Œæˆ‘ä»¬åœ¨è¯·æ±‚çš„å¯è¯»æµä¸Šç›‘å¬ <code>data</code> äº‹ä»¶ä»¥æ¥æ”¶æ•°æ®ï¼ŒåŒæ—¶ç›‘å¬ <code>close</code> äº‹ä»¶ä»¥æ•è·å®¢æˆ·ç«¯æå‰å…³é—­è¿æ¥çš„æƒ…å†µã€‚è¿™å¯¹äºæ¸…ç†èµ„æºæˆ–è€…è°ƒæ•´é€»è¾‘å¤„ç†éå¸¸é‡è¦ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>&#39;close&#39;</code> äº‹ä»¶åœ¨ Node.js æµå¤„ç†ä¸­æ˜¯ä¸€ä¸ªå…³é”®çš„æ¦‚å¿µï¼Œå®ƒä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ—¶æœºï¼Œè®©æˆ‘ä»¬çŸ¥é“ä½•æ—¶ä¸€ä¸ªæµæˆ–èµ„æºå·²ç»å®Œæˆå…¶ç”Ÿå‘½å‘¨æœŸå¹¶è¢«å…³é—­äº†ã€‚é€šè¿‡ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°ç®¡ç†èµ„æºå¹¶ç¡®ä¿åº”ç”¨çš„ç¨³å®šè¿è¡Œã€‚</p><h5 id="event-data" tabindex="-1"><a class="header-anchor" href="#event-data"><span><a href="https://nodejs.org/docs/latest/api/stream.html#event-data" target="_blank" rel="noopener noreferrer">Event: &#39;data&#39;</a></span></a></h5><p>äº†è§£ Node.js ä¸­çš„<code>&#39;data&#39;</code>äº‹ä»¶ï¼Œé¦–å…ˆè¦æ˜ç™½ Node.js å’Œæµï¼ˆStreamsï¼‰çš„å…³è”ã€‚åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†è¯»å–æˆ–å†™å…¥æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œå¯ä»¥çœ‹ä½œæ˜¯æ•°æ®çš„ç®¡é“ã€‚ä½ å¯ä»¥ä»ä¸€ä¸ªåœ°æ–¹ï¼ˆæ¯”å¦‚æ–‡ä»¶æˆ–ç½‘ç»œè¯·æ±‚ï¼‰æ¥æ”¶æ•°æ®ï¼Œå¹¶å°†è¿™äº›æ•°æ®ä¼ è¾“åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥æ˜¯åˆ†å—è¿›è¡Œçš„ï¼Œè¿™æ„å‘³ç€æ•°æ®å¯ä»¥ä¸€å°éƒ¨åˆ†ä¸€å°éƒ¨åˆ†åœ°è¢«å¤„ç†ï¼Œè€Œä¸æ˜¯ç­‰å¾…å…¨éƒ¨æ•°æ®éƒ½å‡†å¤‡å¥½äº†å†ä¸€æ¬¡æ€§å¤„ç†ã€‚</p><h3 id="event-data-1" tabindex="-1"><a class="header-anchor" href="#event-data-1"><span>Event: &#39;data&#39;</span></a></h3><p>å½“æˆ‘ä»¬è°ˆåˆ°<code>&#39;data&#39;</code>äº‹ä»¶æ—¶ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯å¯è¯»æµï¼ˆReadable Streamï¼‰ä¸­çš„ä¸€ä¸ªäº‹ä»¶ã€‚å¯è¯»æµæ˜¯ä¸€ç§å¯ä»¥ä»ä¸­è¯»å–æ•°æ®çš„æµã€‚å½“æµä¸­æœ‰æ•°æ®å¯ä¾›æ¶ˆè´¹æ—¶ï¼Œå°±ä¼šè§¦å‘<code>&#39;data&#39;</code>äº‹ä»¶ã€‚</p><p>æ¯æ¬¡è§¦å‘<code>&#39;data&#39;</code>äº‹ä»¶ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªæ•°æ®å—ï¼ˆchunkï¼‰ä½œä¸ºäº‹ä»¶å¤„ç†å‡½æ•°çš„å‚æ•°ã€‚è¿™ä¸ªæ•°æ®å—å°±æ˜¯æµä¸­çš„ä¸€éƒ¨åˆ†æ•°æ®ã€‚ç›‘å¬è¿™ä¸ªäº‹ä»¶è®©ä½ èƒ½å¤Ÿé€å—å¤„ç†æ•°æ®ï¼Œè¿™æ˜¯å¤„ç†å¤§é‡æ•°æ®çš„æœ‰æ•ˆæ–¹å¼ï¼Œå› ä¸ºä½ ä¸éœ€è¦ç­‰å¾…æ‰€æœ‰æ•°æ®éƒ½å‡†å¤‡å¥½æ‰å¼€å§‹å¤„ç†ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-1"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-è¯»å–æ–‡ä»¶å†…å®¹-1" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-è¯»å–æ–‡ä»¶å†…å®¹-1"><span>ä¾‹å­ 1ï¼šè¯»å–æ–‡ä»¶å†…å®¹</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªå¾ˆå¤§çš„æ–‡æœ¬æ–‡ä»¶ï¼Œä½ æƒ³è¦è¯»å–å¹¶å¤„ç†å…¶ä¸­çš„æ•°æ®ã€‚ä½¿ç”¨<code>fs</code>æ¨¡å—ï¼ˆNode.js çš„æ ¸å¿ƒæ¨¡å—ä¹‹ä¸€ï¼Œç”¨äºä¸æ–‡ä»¶ç³»ç»Ÿäº¤äº’ï¼‰ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥è¯»å–æ–‡ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/large/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬&#39;data&#39;äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®å—</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No more data to read.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯æ¬¡ä»æ–‡ä»¶è¯»å–ä¸€å—æ•°æ®æ—¶ï¼Œ<code>&#39;data&#39;</code>äº‹ä»¶å°±ä¼šè¢«è§¦å‘ï¼Œä½ å¯ä»¥ç«‹å³å¤„ç†è¿™äº›æ•°æ®ï¼Œæ¯”å¦‚æ‰“å°å‡ºæ¥æˆ–è¿›è¡Œä¸€äº›è®¡ç®—ã€‚å½“æ²¡æœ‰æ›´å¤šæ•°æ®å¯è¯»æ—¶ï¼Œè§¦å‘<code>&#39;end&#39;</code>äº‹ä»¶ã€‚</p><h4 id="ä¾‹å­-2-å¤„ç†-http-è¯·æ±‚æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-å¤„ç†-http-è¯·æ±‚æ•°æ®"><span>ä¾‹å­ 2ï¼šå¤„ç† HTTP è¯·æ±‚æ•°æ®</span></a></h4><p>å½“ä½ ä½¿ç”¨ Node.js æ„å»ºåç«¯æœåŠ¡æ—¶ï¼Œå¯èƒ½éœ€è¦å¤„ç†å®¢æˆ·ç«¯å‘é€çš„ HTTP è¯·æ±‚æ•°æ®ã€‚è¿™äº›æ•°æ®ä¹Ÿå¯ä»¥é€šè¿‡æµæ¥è¯»å–ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†Bufferè½¬æ¢ä¸ºå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¯·æ±‚ä½“æ•°æ®å®Œå…¨æ¥æ”¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Data received&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server is running on port 3000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ä½“ï¼ˆbodyï¼‰æ•°æ®æ—¶ï¼Œæ¯æ”¶åˆ°ä¸€éƒ¨åˆ†æ•°æ®ï¼Œ<code>&#39;data&#39;</code>äº‹ä»¶å°±ä¼šè¢«è§¦å‘ï¼Œå…è®¸ä½ é€æ­¥æ„å»ºæ•´ä¸ªè¯·æ±‚ä½“ã€‚å®Œæˆæ¥æ”¶æ‰€æœ‰æ•°æ®åï¼Œä¼šè§¦å‘<code>&#39;end&#39;</code>äº‹ä»¶ï¼Œæ­¤æ—¶ä½ å¯ä»¥å¤„ç†å·²ç»å®Œæ•´æ¥æ”¶çš„æ•°æ®ã€‚</p><h3 id="æ€»ç»“-10" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-10"><span>æ€»ç»“</span></a></h3><p><code>&#39;data&#39;</code>äº‹ä»¶æ˜¯ Node.js ä¸­å¤„ç†æµæ•°æ®çš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ã€‚é€šè¿‡ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œå¼€å‘è€…å¯ä»¥é«˜æ•ˆã€çµæ´»åœ°å¤„ç†å¤§é‡æ•°æ®ï¼Œæ— è®ºæ˜¯æ¥è‡ªæ–‡ä»¶ã€HTTP è¯·æ±‚è¿˜æ˜¯å…¶ä»–æºã€‚æŒæ¡äº†è¿™ä¸ªæ¦‚å¿µï¼Œå°†å¯¹ä½¿ç”¨ Node.js è¿›è¡Œ I/O å¯†é›†å‹åº”ç”¨å¼€å‘éå¸¸æœ‰å¸®åŠ©ã€‚</p><h5 id="event-end" tabindex="-1"><a class="header-anchor" href="#event-end"><span><a href="https://nodejs.org/docs/latest/api/stream.html#event-end" target="_blank" rel="noopener noreferrer">Event: &#39;end&#39;</a></span></a></h5><p>ç†è§£ Node.js ä¸­çš„<code>Event: &#39;end&#39;</code>éå¸¸å…³é”®ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†æµï¼ˆStreamsï¼‰æ—¶ã€‚åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†æ•°æ®ï¼ˆå¦‚è¯»å–æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ï¼‰çš„ä¸€ç§æ–¹å¼ï¼Œå®ƒå…è®¸ä½ ä»¥é«˜æ•ˆã€é€å—åœ°æ–¹å¼å¤„ç†æ•°æ®ã€‚è€Œ<code>Event: &#39;end&#39;</code>å°±æ˜¯æµå¤„ç†è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªé‡è¦äº‹ä»¶ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†æ¢è®¨ä¸€ä¸‹ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯event-end" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯event-end"><span>ä»€ä¹ˆæ˜¯<code>Event: &#39;end&#39;</code></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>Event: &#39;end&#39;</code>æ˜¯ Readable æµï¼ˆå¯è¯»æµï¼‰å‘å‡ºçš„ä¸€ä¸ªäº‹ä»¶ï¼Œè¡¨æ˜æ²¡æœ‰æ›´å¤šçš„æ•°æ®å¯ä»¥è¢«è¯»å–äº†ã€‚ç®€å•æ¥è¯´ï¼Œå½“æµä¸­çš„æ‰€æœ‰æ•°æ®éƒ½è¢«æ¶ˆè´¹å®Œæ¯•ï¼Œæµä¼šè§¦å‘<code>&#39;end&#39;</code>äº‹ä»¶ã€‚</p><h3 id="ä¸ºä»€ä¹ˆevent-end-é‡è¦" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆevent-end-é‡è¦"><span>ä¸ºä»€ä¹ˆ<code>Event: &#39;end&#39;</code>é‡è¦</span></a></h3><p>ç›‘å¬å’Œå¤„ç†<code>&#39;end&#39;</code>äº‹ä»¶å¯¹äºç¡®ä¿èµ„æºå¾—åˆ°æ­£ç¡®é‡Šæ”¾å’Œæ‰§è¡Œæµç»“æŸåçš„é€»è¾‘éå¸¸é‡è¦ã€‚æ¯”å¦‚ï¼Œåœ¨è¯»å–æ–‡ä»¶å†…å®¹æˆ–æ¥æ”¶ç½‘ç»œè¯·æ±‚æ•°æ®æ—¶ï¼Œ<code>&#39;end&#39;</code>äº‹ä»¶å‘Šè¯‰ä½ æ‰€æœ‰çš„æ•°æ®éƒ½å·²ç»è¢«å¤„ç†ï¼Œè¿™æ—¶ä½ å¯ä»¥å®‰å…¨åœ°å…³é—­æ–‡ä»¶æè¿°ç¬¦æˆ–æ¸…ç†ä¸è¯·æ±‚ç›¸å…³çš„èµ„æºã€‚</p><h3 id="å®é™…åº”ç”¨ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¸¾ä¾‹"><span>å®é™…åº”ç”¨ä¸¾ä¾‹</span></a></h3><h4 id="ä¾‹å­-1-è¯»å–æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-è¯»å–æ–‡ä»¶"><span>ä¾‹å­ 1: è¯»å–æ–‡ä»¶</span></a></h4><p>å‡è®¾ä½ æƒ³ä»ä¸€ä¸ªæ–‡ä»¶ä¸­è¯»å–å†…å®¹ï¼Œå¹¶å¤„ç†è¿™äº›å†…å®¹ï¼Œä½¿ç”¨<code>fs.createReadStream</code>åˆ›å»ºä¸€ä¸ªå¯è¯»æµï¼Œå¹¶ç›‘å¬<code>&#39;end&#39;</code>äº‹ä»¶æ¥çŸ¥é“ä½•æ—¶æ–‡ä»¶å†…å®¹è¯»å–å®Œæ¯•ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥è¯»å–æ–‡ä»¶å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯»å–åˆ°æ•°æ®ï¼š&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ–‡ä»¶è¯»å–å®Œæ¯•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶å·²å…¨éƒ¨è¯»å–å®Œæ¯•ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-2-http-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-http-è¯·æ±‚"><span>ä¾‹å­ 2: HTTP è¯·æ±‚</span></a></h4><p>å½“ä½¿ç”¨ Node.js æ„å»º HTTP æœåŠ¡å™¨æ—¶ï¼Œä½ å¯èƒ½éœ€è¦å¤„ç†å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ä½“æ•°æ®ã€‚è¯·æ±‚ä½“ä½œä¸ºä¸€ä¸ªå¯è¯»æµï¼Œå½“æ‰€æœ‰è¯·æ±‚ä½“æ•°æ®è¢«è¯»å–åï¼Œå°†ä¼šè§¦å‘<code>&#39;end&#39;</code>äº‹ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ¥æ”¶åˆ°çš„æ•°æ®ï¼š&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // åœ¨è¿™é‡Œå¯ä»¥å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;OK</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨å¯åŠ¨ï¼Œç›‘å¬8080ç«¯å£ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨ç›‘å¬å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå®¢æˆ·ç«¯é€šè¿‡è¯·æ±‚ä½“å‘é€æ•°æ®ã€‚æœåŠ¡å™¨é€å—è¯»å–è¿™äº›æ•°æ®ï¼Œæœ€ååœ¨æ¥æ”¶å®Œæ‰€æœ‰æ•°æ®åï¼Œé€šè¿‡<code>&#39;end&#39;</code>äº‹ä»¶è¿›è¡Œç›¸åº”çš„é€»è¾‘å¤„ç†ã€‚</p><h3 id="æ€»ç»“-11" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-11"><span>æ€»ç»“</span></a></h3><p><code>Event: &#39;end&#39;</code>æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªåŸºç¡€æ¦‚å¿µï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†æµæ—¶ã€‚å®ƒæä¾›äº†ä¸€ä¸ªæ˜ç¡®çš„ä¿¡å·è¡¨ç¤ºæ•°æ®å·²ç»å…¨éƒ¨è¢«è¯»å–ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿåœ¨é€‚å½“çš„æ—¶åˆ»æ‰§è¡Œæ¸…ç†å·¥ä½œæˆ–åç»­å¤„ç†æ“ä½œã€‚ç†è§£å’Œæ­£ç¡®ä½¿ç”¨è¿™ä¸ªäº‹ä»¶å¯¹äºç¼–å†™é«˜æ•ˆã€å¯é çš„ Node.js åº”ç”¨è‡³å…³é‡è¦ã€‚</p><h5 id="event-error-1" tabindex="-1"><a class="header-anchor" href="#event-error-1"><span><a href="https://nodejs.org/docs/latest/api/stream.html#event-error_1" target="_blank" rel="noopener noreferrer">Event: &#39;error&#39;</a></span></a></h5><p>Node.js ä¸­çš„ <code>Event: &#39;error&#39;</code> æ˜¯ä¸€ä¸ªéå¸¸å…³é”®çš„æ¦‚å¿µï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†æµï¼ˆStreamsï¼‰æ—¶ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç†è§£å‡ ä¸ªåŸºç¡€ç‚¹ï¼Œç„¶åæˆ‘ä»¬å°†é€šè¿‡ä¸€äº›ä¾‹å­æ¥è¯¦ç»†æ¢è®¨è¿™ä¸ªäº‹ä»¶ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-1" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-1"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><ol><li><strong>Node.js</strong>ï¼šä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“è¿è¡Œçš„ JavaScript ç¯å¢ƒï¼Œä½¿å¾—å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚</li><li><strong>äº‹ä»¶é©±åŠ¨ç¼–ç¨‹</strong>ï¼šNode.js å¤§é‡ä½¿ç”¨äº‹ä»¶æ¥é€šçŸ¥ä»£ç æŸäº›äº‹æƒ…å·²ç»å‘ç”Ÿäº†ï¼Œæ¯”å¦‚æ•°æ®å·²ç»ä»æ•°æ®åº“ä¸­è¯»å–å®Œæ¯•ã€‚</li><li><strong>æµï¼ˆStreamsï¼‰</strong>ï¼šStreams æ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†å¤§é‡æ•°æ®ï¼Œå› ä¸ºä½ ä¸éœ€è¦ä¸€æ¬¡æ€§æŠŠæ•°æ®å…¨éƒ¨è¯»åˆ°å†…å­˜ä¸­ï¼Œè€Œæ˜¯å¯ä»¥åˆ†ç‰‡å¤„ç†ã€‚</li><li><strong><code>Event: &#39;error&#39;</code></strong>ï¼šè¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„äº‹ä»¶ï¼Œç”¨äºåœ¨æµæ“ä½œä¸­å¤„ç†é”™è¯¯ã€‚å½“æµé‡åˆ°é—®é¢˜æ— æ³•æ­£å¸¸å¤„ç†æ—¶ï¼Œå°±ä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶ã€‚</li></ol><h3 id="event-error-çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#event-error-çš„ä½œç”¨"><span><code>Event: &#39;error&#39;</code> çš„ä½œç”¨</span></a></h3><p>åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå½“ä½ ä¸æ–‡ä»¶ç³»ç»Ÿäº¤äº’ï¼Œæˆ–æ˜¯è¿›è¡Œç½‘ç»œé€šä¿¡æ—¶ï¼Œæ€»æœ‰å¯èƒ½å‡ºç°é”™è¯¯ï¼Œä¾‹å¦‚æ–‡ä»¶æ‰¾ä¸åˆ°ã€æƒé™é—®é¢˜ã€æ•°æ®æŸåç­‰ã€‚<code>Event: &#39;error&#39;</code> å…è®¸ä½ ä¼˜é›…åœ°å¤„ç†è¿™äº›å¼‚å¸¸æƒ…å†µã€‚å¦‚æœä¸ç›‘å¬å¹¶å¤„ç†è¿™ä¸ªäº‹ä»¶ï¼Œé‚£ä¹ˆä¸€æ—¦å‘ç”Ÿé”™è¯¯ï¼ŒNode.js å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶ä¸”ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´ Node.js åº”ç”¨å´©æºƒé€€å‡ºã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-10" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-10"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-è¯»å–æ–‡ä»¶æµä¸­çš„é”™è¯¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-è¯»å–æ–‡ä»¶æµä¸­çš„é”™è¯¯å¤„ç†"><span>ä¾‹å­ 1: è¯»å–æ–‡ä»¶æµä¸­çš„é”™è¯¯å¤„ç†</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ä»ä¸€ä¸ªæ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;somefile.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Received a chunk of data:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;An error occurred:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœ <code>&#39;somefile.txt&#39;</code> æ–‡ä»¶ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆè¯»å–æµï¼ˆ<code>readStream</code>ï¼‰ä¼šè§¦å‘ <code>&#39;error&#39;</code> äº‹ä»¶ã€‚é€šè¿‡ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œä½ å¯ä»¥è·å–åˆ°é”™è¯¯ä¿¡æ¯è€Œä¸ä¼šå¯¼è‡´ç¨‹åºç›´æ¥å´©æºƒã€‚</p><h4 id="ä¾‹å­-2-ç½‘ç»œè¯·æ±‚é”™è¯¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ç½‘ç»œè¯·æ±‚é”™è¯¯å¤„ç†"><span>ä¾‹å­ 2: ç½‘ç»œè¯·æ±‚é”™è¯¯å¤„ç†</span></a></h4><p>å½“ä½¿ç”¨ http æ¨¡å—å‘é€è¯·æ±‚æ—¶ï¼Œä¹Ÿå¯èƒ½é‡åˆ°å„ç§é”™è¯¯ï¼ˆå¦‚ç½‘ç»œé—®é¢˜ï¼‰ï¼Œæ­¤æ—¶ä¹Ÿå¯ä»¥ç›‘å¬ <code>error</code> äº‹ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¤„ç†å“åº”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Request failed with error:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œå¦‚æœè¯·æ±‚ <code>http://example.com</code> å¤±è´¥ï¼ˆä¾‹å¦‚ï¼ŒåŸŸåä¸å­˜åœ¨æˆ–ç½‘ç»œé—®é¢˜ï¼‰ï¼Œ<code>error</code> äº‹ä»¶è¢«è§¦å‘ï¼Œå…è®¸ä½ å¤„ç†è¿™ç§é”™è¯¯æƒ…å†µã€‚</p><h3 id="æ€»ç»“-12" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-12"><span>æ€»ç»“</span></a></h3><p>Node.js ä¸­çš„ <code>Event: &#39;error&#39;</code> æ˜¯ä¸€ç§éå¸¸é‡è¦çš„æœºåˆ¶ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿä¼˜é›…åœ°å¤„ç†æµæ“ä½œä¸­å¯èƒ½é‡åˆ°çš„é”™è¯¯å’Œå¼‚å¸¸æƒ…å†µã€‚é€šè¿‡æ­£ç¡®åœ°ä½¿ç”¨å’Œç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œå¯ä»¥æé«˜åº”ç”¨çš„ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒã€‚</p><h5 id="event-pause" tabindex="-1"><a class="header-anchor" href="#event-pause"><span><a href="https://nodejs.org/docs/latest/api/stream.html#event-pause" target="_blank" rel="noopener noreferrer">Event: &#39;pause&#39;</a></span></a></h5><p>Node.js ä¸­çš„ Event: &#39;pause&#39;æ˜¯æµï¼ˆStreamï¼‰å¯¹è±¡ä¸­ä¸€ä¸ªé‡è¦çš„äº‹ä»¶ï¼Œå®ƒæ˜¯å½“å¯è¯»æµï¼ˆreadable streamï¼‰çš„è¯»å–æ“ä½œæš‚åœæ—¶è§¦å‘çš„ã€‚äº†è§£å®ƒä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç®€å•äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„æµå’Œå¯è¯»æµã€‚</p><h3 id="node-js-ä¸­çš„æµ-stream" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„æµ-stream"><span>Node.js ä¸­çš„æµ(Stream)</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ç”¨äºå¤„ç†æ•°æ®çš„æŠ½è±¡æ¥å£ã€‚è¿™äº›æ•°æ®å¯èƒ½æ˜¯æ–‡ä»¶ã€ç½‘ç»œä¼ è¾“ç­‰ã€‚æµå¯ä»¥å°†æ•°æ®åˆ†æˆå°å—è¿›è¡Œå¤„ç†ï¼Œè¿™å¯¹äºå¤„ç†å¤§é‡æ•°æ®éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºä½ ä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><p>æµä¸»è¦æœ‰å››ç§ç±»å‹ï¼š</p><ol><li><strong>å¯è¯»æµ</strong> (Readable)ï¼šå…è®¸æ•°æ®è¢«è¯»å–ã€‚</li><li><strong>å¯å†™æµ</strong> (Writable)ï¼šå…è®¸æ•°æ®è¢«å†™å…¥ã€‚</li><li><strong>åŒå·¥æµ</strong> (Duplex)ï¼šæ—¢å¯è¯»ä¹Ÿå¯å†™ã€‚</li><li><strong>è½¬æ¢æµ</strong> (Transform)ï¼šæ•°æ®å¯ä»¥åœ¨å†™å…¥å’Œè¯»å‡ºè¿‡ç¨‹ä¸­è¿›è¡Œä¿®æ”¹ã€‚</li></ol><h3 id="event-pause-1" tabindex="-1"><a class="header-anchor" href="#event-pause-1"><span>Event: &#39;pause&#39;</span></a></h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬å…³æ³¨çš„æ˜¯å¯è¯»æµï¼ˆReadable Streamï¼‰ä¸­çš„&#39;pause&#39;äº‹ä»¶ã€‚å½“è°ƒç”¨æµçš„<code>.pause()</code>æ–¹æ³•åï¼Œä¼šåœæ­¢ä»åº•å±‚èµ„æºè¯»å–æ•°æ®ï¼Œå¹¶è§¦å‘&#39;pause&#39;äº‹ä»¶ã€‚è¿™ä¸ªç‰¹æ€§å¯¹äºç®¡ç†æ•°æ®æµçš„é€Ÿç‡ï¼ˆä¾‹å¦‚ï¼Œé˜²æ­¢æ•°æ®å¤ªå¿«è¢«æ¶ˆè´¹è€Œå¯¼è‡´å†…å­˜æº¢å‡ºï¼‰ç‰¹åˆ«æœ‰ç”¨ã€‚</p><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹-5" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-5"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h4><h5 id="_1-å¤„ç†æ–‡ä»¶æ•°æ®" tabindex="-1"><a class="header-anchor" href="#_1-å¤„ç†æ–‡ä»¶æ•°æ®"><span>1. å¤„ç†æ–‡ä»¶æ•°æ®</span></a></h5><p>å‡è®¾ä½ æ­£åœ¨ä»ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œå¹¶ä¸”æ ¹æ®æŸäº›æ¡ä»¶ï¼ˆæ¯”å¦‚æ•°æ®è¾¾åˆ°ä¸€å®šé‡ï¼‰ï¼Œä½ å¯èƒ½æƒ³æš‚åœè¯»å–ä»¥æ‰§è¡ŒæŸäº›æ“ä½œï¼Œç„¶åå†ç»§ç»­è¯»å–ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;bigfile.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pause</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æš‚åœè¯»å–æ•°æ®</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;There will be no additional data for 1 second.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Now data will start flowing again.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// 1ç§’åæ¢å¤è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;pause&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stream is in pause mode.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;resume&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stream has been resumed.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Finished reading file.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯æ¬¡æ¥æ”¶åˆ°æ•°æ®(chunk)ï¼Œæˆ‘ä»¬å°±æš‚åœ(pause)æµçš„è¯»å–ã€‚æ‰“å°ç›¸å…³ä¿¡æ¯åï¼Œæˆ‘ä»¬ä½¿ç”¨<code>setTimeout</code>æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œï¼ˆæ¯”å¦‚ï¼Œæ•°æ®å¤„ç†ï¼‰ï¼Œåœ¨ 1 ç§’åæ¢å¤(resume)è¯»å–ã€‚</p><h5 id="_2-æ§åˆ¶æ•°æ®æµé€Ÿ" tabindex="-1"><a class="header-anchor" href="#_2-æ§åˆ¶æ•°æ®æµé€Ÿ"><span>2. æ§åˆ¶æ•°æ®æµé€Ÿ</span></a></h5><p>å¦‚æœä½ æ­£åœ¨å®ç°ä¸€ä¸ªæ¶‰åŠæ•°æ®å®æ—¶å¤„ç†çš„ç½‘ç»œåº”ç”¨ï¼Œæ¯”å¦‚è§†é¢‘æµæˆ–è€…å¤§è§„æ¨¡æ—¥å¿—å¤„ç†ç³»ç»Ÿï¼Œæ§åˆ¶æ•°æ®æµçš„é€Ÿç‡å°±å˜å¾—å°¤ä¸ºé‡è¦ã€‚é€šè¿‡ç›‘å¬&#39;pause&#39;å’Œ&#39;resume&#39;äº‹ä»¶ï¼Œä½ å¯ä»¥åŸºäºå½“å‰ç³»ç»Ÿè´Ÿè½½åŠ¨æ€åœ°è°ƒæ•´æ•°æ®å¤„ç†é€Ÿåº¦ï¼Œä¼˜åŒ–èµ„æºåˆ©ç”¨ï¼Œé¿å…è¿‡è½½ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ&#39;pause&#39;äº‹ä»¶åœ¨ Node.js çš„æµå¤„ç†ä¸­æ˜¯ä¸€ç§é‡è¦çš„æµæ§åˆ¶æœºåˆ¶ï¼Œå®ƒä½¿å¾—å¼€å‘è€…èƒ½æ›´ç»†ç²’åº¦åœ°æ§åˆ¶æ•°æ®çš„å¤„ç†è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–éœ€è¦é«˜æ•ˆç®¡ç†èµ„æºçš„åœºæ™¯ä¸‹ã€‚</p><h5 id="event-readable" tabindex="-1"><a class="header-anchor" href="#event-readable"><span><a href="https://nodejs.org/docs/latest/api/stream.html#event-readable" target="_blank" rel="noopener noreferrer">Event: &#39;readable&#39;</a></span></a></h5><p>åœ¨ Node.js ä¸­ï¼Œ<code>&#39;readable&#39;</code> äº‹ä»¶æ˜¯ä¸æµï¼ˆStreamsï¼‰ç›¸å…³çš„æ¦‚å¿µä¹‹ä¸€ã€‚è¦ç†è§£ <code>&#39;readable&#39;</code> äº‹ä»¶ï¼Œé¦–å…ˆéœ€è¦äº†è§£æµæ˜¯ä»€ä¹ˆä»¥åŠå®ƒä»¬å¦‚ä½•å·¥ä½œã€‚</p><h3 id="æµ-streams-ç®€ä»‹-3" tabindex="-1"><a class="header-anchor" href="#æµ-streams-ç®€ä»‹-3"><span>æµï¼ˆStreamsï¼‰ç®€ä»‹</span></a></h3><p>åœ¨ Node.js é‡Œï¼Œæµæ˜¯ç”¨äºå¤„ç†æ•°æ®çš„æŠ½è±¡æ¥å£ã€‚è¿™äº›æ•°æ®å¯ä»¥æ˜¯æ–‡ä»¶ã€ç½‘ç»œä¿¡æ¯ç­‰ç­‰ã€‚æµå…è®¸ä½ ä»¥è¿ç»­çš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€Œä¸å¿…ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™ä½¿å¾—å¤„ç†å¤§é‡æ•°æ®æ›´åŠ é«˜æ•ˆã€‚</p><p>æµä¸»è¦æœ‰å››ç§ç±»å‹ï¼š</p><ol><li><strong>Readable Streams</strong> - ç”¨äºè¯»å–æ•°æ®ã€‚ä¾‹å¦‚ä»æ–‡ä»¶è¯»å–æ•°æ®ã€‚</li><li><strong>Writable Streams</strong> - ç”¨äºå†™å…¥æ•°æ®ã€‚ä¾‹å¦‚å‘æ–‡ä»¶å†™å…¥æ•°æ®ã€‚</li><li><strong>Duplex Streams</strong> - æ—¢å¯è¯»åˆå¯å†™ã€‚ä¾‹å¦‚ç½‘ç»œå¥—æ¥å­—ã€‚</li><li><strong>Transform Streams</strong> - åœ¨è¯»å†™è¿‡ç¨‹ä¸­å¯ä»¥ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®çš„ Duplex æµã€‚ä¾‹å¦‚å‹ç¼©æ•°æ®ã€‚</li></ol><h3 id="readable-äº‹ä»¶" tabindex="-1"><a class="header-anchor" href="#readable-äº‹ä»¶"><span><code>readable</code> äº‹ä»¶</span></a></h3><p>å½“ä½¿ç”¨ Readable æµæ—¶ï¼Œ<code>&#39;readable&#39;</code> äº‹ä»¶æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µã€‚è¿™ä¸ªäº‹ä»¶å‘ç”Ÿåœ¨æµä¸­æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œä½†å®ƒå¹¶ä¸æ„å‘³ç€æ‰€æœ‰æ•°æ®éƒ½å·²ç»è¢«è¯»å– â€” å®ƒåªæ˜¯é€šçŸ¥ä½ æµç°åœ¨å¤„äºå¯ä»¥ä»ä¸­è¯»å–æ•°æ®çš„çŠ¶æ€ã€‚</p><p>ä¸€æ—¦ <code>&#39;readable&#39;</code> äº‹ä»¶è¢«è§¦å‘ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>.read()</code> æ–¹æ³•å°è¯•ä»æµä¸­è¯»å–æ•°æ®ã€‚å¦‚æœæ²¡æœ‰æ›´å¤šæ•°æ®å¯è¯»ï¼Œåˆ™ <code>.read()</code> å°†è¿”å› <code>null</code>ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-6" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-6"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦ä»ä¸€ä¸ªå¤§å‹æ–‡æœ¬æ–‡ä»¶ä¸­é€è¡Œè¯»å–æ•°æ®ã€‚ç”±äºæ–‡ä»¶å¾ˆå¤§ï¼Œä¸€æ¬¡æ€§è¯»å–æ‰€æœ‰å†…å®¹åˆ°å†…å­˜å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜æˆ–å†…å­˜æº¢å‡ºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨æµå’Œ <code>&#39;readable&#39;</code> äº‹ä»¶æ¥é«˜æ•ˆåœ°å¤„ç†æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥è¯»å–å¤§å‹æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;largeFile.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> rl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  input</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">rl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;line&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received line: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">line</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†æ¯ä¸€è¡Œæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">rl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;close&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Finished reading the file.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ–‡ä»¶å·²å…¨éƒ¨è¯»å–å®Œæ¯•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ­¤ä¾‹å­ä¸­ï¼š</p><ul><li>æˆ‘ä»¬ä½¿ç”¨ <code>fs.createReadStream</code> åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘å¤§å‹æ–‡æœ¬æ–‡ä»¶çš„ Readable æµã€‚</li><li>åˆ©ç”¨ <code>readline.createInterface</code> å’Œæˆ‘ä»¬çš„æµåˆ›å»ºäº†ä¸€ä¸ª readline æ¥å£ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›‘å¬å¹¶æŒ‰è¡Œå¤„ç†æ–‡ä»¶ä¸­çš„æ•°æ®ã€‚</li><li>æ¯å½“æœ‰æ–°è¡Œå¯è¯»æ—¶ï¼Œ<code>&#39;line&#39;</code> äº‹ä»¶ä¼šè¢«è§¦å‘ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¯è¡Œè¿›è¡Œå¤„ç†ã€‚</li><li>å½“æ²¡æœ‰æ›´å¤šå†…å®¹å¯è¯»å–ï¼Œå³æ–‡ä»¶å·²ç»å®Œæˆè¯»å–æ—¶ï¼Œ<code>&#39;close&#39;</code> äº‹ä»¶è¢«è§¦å‘ã€‚</li></ul><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå³ä¾¿æ˜¯å¤„ç†éå¸¸å¤§çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¹Ÿèƒ½ä¿æŒä½å†…å­˜æ¶ˆè€—ï¼Œå› ä¸ºå®ƒä¸€æ¬¡åªå¤„ç†å°‘é‡æ•°æ®ã€‚</p><h5 id="event-resume" tabindex="-1"><a class="header-anchor" href="#event-resume"><span><a href="https://nodejs.org/docs/latest/api/stream.html#event-resume" target="_blank" rel="noopener noreferrer">Event: &#39;resume&#39;</a></span></a></h5><p>è¦ç†è§£ Node.js ä¸­<code>Event: &#39;resume&#39;</code>äº‹ä»¶ï¼Œé¦–å…ˆå¾—çŸ¥é“å®ƒå±äº Node.js çš„æµï¼ˆStreamsï¼‰API éƒ¨åˆ†ã€‚åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ç”¨äºå¤„ç†æ•°æ®çš„æŠ½è±¡æ¥å£ï¼Œç‰¹åˆ«é€‚ç”¨äºå¤„ç†å¤§é‡æ•°æ®æˆ–è€…ä½ ä¸å¸Œæœ›ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®è£…è½½åˆ°å†…å­˜ä¸­çš„åœºæ™¯ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ï¼Œæˆ–è€…ä¸¤è€…éƒ½æ˜¯ã€‚</p><h3 id="streams-åŸºç¡€" tabindex="-1"><a class="header-anchor" href="#streams-åŸºç¡€"><span>Streams åŸºç¡€</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæœ‰å››ç§åŸºæœ¬çš„æµç±»å‹ï¼š</p><ol><li><strong>Readable</strong> - ç”¨äºè¯»å–æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œä»æ–‡ä»¶è¯»å–æ•°æ®ï¼‰ã€‚</li><li><strong>Writable</strong> - ç”¨äºå†™å…¥æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œå†™å…¥æ•°æ®åˆ°æ–‡ä»¶ï¼‰ã€‚</li><li><strong>Duplex</strong> - æ—¢å¯è¯»åˆå¯å†™ã€‚</li><li><strong>Transform</strong> - æ•°æ®è½¬æ¢ï¼Œä¹Ÿæ˜¯åŒå‘æµï¼Œä½†å®ƒå¯ä»¥åœ¨è¯»å†™è¿‡ç¨‹ä¸­ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®ã€‚</li></ol><h3 id="äº‹ä»¶-resume" tabindex="-1"><a class="header-anchor" href="#äº‹ä»¶-resume"><span>äº‹ä»¶ï¼š&#39;resume&#39;</span></a></h3><p>åœ¨è®²è¿°<code>Event: &#39;resume&#39;</code>ä¹‹å‰ï¼Œéœ€è¦æ˜ç™½æµçš„ä¸¤ç§æ¨¡å¼ï¼š<strong>æµåŠ¨æ¨¡å¼(flowing)</strong> å’Œ <strong>æš‚åœæ¨¡å¼(paused)</strong>ã€‚</p><ul><li><strong>æµåŠ¨æ¨¡å¼(Flowing):</strong> åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ•°æ®è‡ªåŠ¨åœ°ä»æ¥æºæµå‘æ¶ˆè´¹ç‚¹ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ã€‚</li><li><strong>æš‚åœæ¨¡å¼(Paused):</strong> è¿™æ—¶ï¼Œä½ å¿…é¡»æ˜¾å¼è°ƒç”¨ <code>.read()</code> æ¥ä»æµä¸­è¯»å–æ•°æ®å—ã€‚</li></ul><p>å½“ä¸€ä¸ªå¯è¯»æµåˆå§‹åˆ›å»ºæ—¶ï¼Œå®ƒå¤„äºæš‚åœæ¨¡å¼ã€‚ä½¿ç”¨<code>resume()</code>æ–¹æ³•å¯ä»¥å°†æµåˆ‡æ¢åˆ°æµåŠ¨æ¨¡å¼ï¼Œè¿™æ„å‘³ç€æ•°æ®å¯ä»¥ä»æµä¸­è‡ªç”±æµå‡ºï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨ä»‹å…¥ã€‚</p><p><code>Event: &#39;resume&#39;</code>æ˜¯å½“æµä»æš‚åœæ¨¡å¼åˆ‡æ¢åˆ°æµåŠ¨æ¨¡å¼æ—¶è§¦å‘çš„äº‹ä»¶ã€‚ç¼–å†™ä»£ç æ—¶ï¼Œä½ å¯ä»¥ç›‘å¬è¿™ä¸ªäº‹ä»¶æ¥çŸ¥æ™“æµçš„çŠ¶æ€å˜åŒ–æˆ–æ‰§è¡ŒæŸäº›æ“ä½œã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-11" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-11"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªç½‘ç»œåº”ç”¨ï¼Œéœ€è¦ä»ä¸€ä¸ªå¤§å‹æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œå¹¶å°†å…¶å‘é€ç»™è¯·æ±‚è¯¥èµ„æºçš„å®¢æˆ·ç«¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./large-file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;resume&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stream is in flowing mode now.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// `pipe`è‡ªåŠ¨ç®¡ç†æµçš„æš‚åœå’Œæ¢å¤</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server is running on port 8000&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå®ƒä¼šå“åº”å®¢æˆ·ç«¯è¯·æ±‚å¹¶ä»<code>large-file.txt</code>æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚é€šè¿‡<code>.createReadStream</code>ï¼Œæˆ‘ä»¬ä»¥æµçš„å½¢å¼è¯»å–æ–‡ä»¶å†…å®¹ã€‚ä½¿ç”¨<code>.pipe(res)</code>è¯­å¥ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªå¯è¯»æµè¿æ¥åˆ°å“åº”å¯¹è±¡ï¼ˆ<code>res</code>ï¼‰ï¼Œè¿™æ ·æ•°æ®å°±èƒ½ç›´æ¥è¢«å‘é€åˆ°å®¢æˆ·ç«¯ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå½“<code>stream.pipe(res)</code>æ‰§è¡Œæ—¶ï¼Œå®ƒå®é™…ä¸Šå°†å¯è¯»æµä»æš‚åœæ¨¡å¼åˆ‡æ¢åˆ°æµåŠ¨æ¨¡å¼ï¼Œè¿™æ—¶ï¼Œ<code>&#39;resume&#39;</code>äº‹ä»¶ä¼šè¢«è§¦å‘ï¼Œæˆ‘ä»¬é€šè¿‡ç›‘å¬è¿™ä¸ªäº‹ä»¶æ¥æ‰“å°å‡ºæ—¥å¿—ä¿¡æ¯ï¼Œç¡®è®¤æµçŠ¶æ€çš„æ”¹å˜ã€‚</p><p>é€šè¿‡äº†è§£å’Œä½¿ç”¨<code>Event: &#39;resume&#39;</code>ï¼Œä½ å¯ä»¥æ›´å¥½åœ°æ§åˆ¶å’Œç›‘è§† Node.js åº”ç”¨ä¸­æ•°æ®æµçš„è¡Œä¸ºï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ï¼Œè¿™å¯¹äºä¼˜åŒ–æ€§èƒ½å’Œèµ„æºç®¡ç†éå¸¸å…³é”®ã€‚</p><h5 id="readable-destroy-error" tabindex="-1"><a class="header-anchor" href="#readable-destroy-error"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readabledestroyerror" target="_blank" rel="noopener noreferrer">readable.destroy([error])</a></span></a></h5><p>åœ¨ Node.js ä¸­ï¼Œæµ(Stream)æ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“ä½ ä¸éœ€è¦ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰æ•°æ®éƒ½åŠ è½½åˆ°å†…å­˜é‡Œæ—¶ã€‚å®ƒä»¬å¯ä»¥ç”¨äºè¯»å–æˆ–å†™å…¥å¤§æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰åœºæ™¯ã€‚æµå¯ä»¥åˆ†ä¸ºå¯è¯»æµã€å¯å†™æµã€åŒå·¥æµï¼ˆæ—¢å¯è¯»åˆå¯å†™ï¼‰å’Œè½¬æ¢æµã€‚</p><p><code>readable.destroy([error])</code> æ˜¯ Node.js ä¸­é’ˆå¯¹å¯è¯»æµ(<code>Readable</code>)æä¾›çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºä¼˜é›…åœ°å…³é—­å’Œæ¸…ç†æµã€‚ç°åœ¨æˆ‘ä»¬å°±å…·ä½“æ·±å…¥äº†è§£è¿™ä¸ªæ–¹æ³•ã€‚</p><h3 id="è§£é‡Š-1" tabindex="-1"><a class="header-anchor" href="#è§£é‡Š-1"><span>è§£é‡Š</span></a></h3><ul><li><p><strong>ä½œç”¨</strong>: <code>readable.destroy([error])</code>æ–¹æ³•ç”¨æ¥ç«‹å³åœ°ç»“æŸæµï¼Œå¹¶ä¸”é‡Šæ”¾ä¸è¯¥æµç›¸å…³çš„èµ„æºï¼ˆæ¯”å¦‚å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼‰ã€‚è¿™ä¸ªæ–¹æ³•å…è®¸ä½ æœ‰é€‰æ‹©åœ°ä¼ é€’ä¸€ä¸ªé”™è¯¯å¯¹è±¡(<code>error</code>)ä½œä¸ºå‚æ•°ï¼Œè¡¨ç¤ºå› ä¸ºä¸€ä¸ªé”™è¯¯è€Œç»ˆæ­¢æµã€‚</p></li><li><p><strong>å‚æ•°</strong>:</p><ul><li><code>[error]</code> (å¯é€‰): è¿™æ˜¯ä¸€ä¸ª<code>Error</code>å¯¹è±¡å®ä¾‹ï¼Œç”¨æ¥æŒ‡ç¤ºé”€æ¯æµçš„åŸå› ã€‚å¦‚æœæä¾›äº†è¿™ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆæµä¼šè§¦å‘ä¸€ä¸ª<code>&#39;error&#39;</code>äº‹ä»¶ï¼Œå¹¶å°†è¿™ä¸ªé”™è¯¯å¯¹è±¡ä½œä¸ºäº‹ä»¶çš„å‚æ•°ã€‚</li></ul></li><li><p><strong>è¿”å›å€¼</strong>: è°ƒç”¨<code>readable.destroy()</code>æ–¹æ³•åï¼Œå®ƒä¼šè¿”å›<code>this</code>ï¼Œå³å¼•ç”¨è¢«é”€æ¯çš„æµæœ¬èº«ï¼Œä½¿å¾—ä½ å¯ä»¥é“¾å¼è°ƒç”¨å…¶ä»–æ–¹æ³•ï¼ˆå¦‚æœæœ‰éœ€è¦çš„è¯ï¼‰ã€‚</p></li></ul><h3 id="å®é™…åº”ç”¨æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨æ¡ˆä¾‹"><span>å®é™…åº”ç”¨æ¡ˆä¾‹</span></a></h3><h4 id="_1-å¤„ç†æ–‡ä»¶è¯»å–é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#_1-å¤„ç†æ–‡ä»¶è¯»å–é”™è¯¯"><span>1. å¤„ç†æ–‡ä»¶è¯»å–é”™è¯¯</span></a></h4><p>å½“ä½ ä½¿ç”¨ Node.js è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°å¦‚ç£ç›˜é”™è¯¯ã€æ–‡ä»¶çªç„¶åˆ é™¤ç­‰å¼‚å¸¸æƒ…å†µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>readable.destroy(error)</code>å¯ä»¥å¸®åŠ©ä½ åŠæ—¶åœæ­¢è¯»å–æ“ä½œå¹¶é‡Šæ”¾èµ„æºã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµè¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/path/to/large/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // åœ¨è¯»å–è¿‡ç¨‹ä¸­é‡åˆ°é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stream reading error:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾åœ¨æŸä¸ªç‰¹å®šæ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ç«‹å³åœæ­¢è¯»å–æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">needToStopReading</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> error</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stop reading due to specific condition.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é”€æ¯æµå¹¶ä¼ é€’é”™è¯¯ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-ä¸»åŠ¨ç»“æŸä¸å†éœ€è¦çš„æ•°æ®æµ" tabindex="-1"><a class="header-anchor" href="#_2-ä¸»åŠ¨ç»“æŸä¸å†éœ€è¦çš„æ•°æ®æµ"><span>2. ä¸»åŠ¨ç»“æŸä¸å†éœ€è¦çš„æ•°æ®æµ</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªæœåŠ¡ï¼Œå®ƒè¿æ¥åˆ°ä¸€ä¸ªå¤§å‹æ•°æ®æºï¼Œä¾‹å¦‚æ•°æ®åº“å¿«ç…§ã€‚å¦‚æœç”¨æˆ·å–æ¶ˆäº†è¯·æ±‚æˆ–è€…å·²ç»å¾—åˆ°ä»–ä»¬æ‰€éœ€è¦çš„æ•°æ®ä¹‹å‰çš„éƒ¨åˆ†ï¼Œä½ å¯èƒ½æƒ³è¦ä¸»åŠ¨åœæ­¢æ•°æ®æµã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™æ˜¯ä¸€ä¸ªè¿æ¥åˆ°æ•°æ®åº“å¿«ç…§çš„æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> dataSource</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> getDataSource</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™æ˜¯ä¸€ä¸ªå‡è®¾çš„å‡½æ•°</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> dataSource</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getNextChunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ•°æ®è¯»å–å®Œæ¯•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœç”¨æˆ·å–æ¶ˆè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">userRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;cancel&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;User cancelled the request.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼Œé€šè¿‡è°ƒç”¨<code>readable.destroy([error])</code>æ–¹æ³•ï¼Œä½ å¯ä»¥åœ¨ä»»ä½•æ—¶å€™åŸºäºæµçš„çŠ¶æ€æˆ–å¤–éƒ¨æ¡ä»¶ï¼ˆå¦‚ç”¨æˆ·å–æ¶ˆæ“ä½œã€é”™è¯¯å‘ç”Ÿç­‰ï¼‰æ¥ä¼˜é›…åœ°ç»ˆæ­¢æµçš„è¯»å–å¹¶è¿›è¡Œå¿…è¦çš„æ¸…ç†ã€‚</p><h5 id="readable-closed" tabindex="-1"><a class="header-anchor" href="#readable-closed"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readableclosed" target="_blank" rel="noopener noreferrer">readable.closed</a></span></a></h5><p>å½“ä½ åˆšå¼€å§‹æ¥è§¦ç¼–ç¨‹ï¼Œäº†è§£ Node.js æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ï¼Œå› ä¸ºå®ƒå¹¿æ³›ç”¨äºå¼€å‘å„ç§å¤§å°çš„åº”ç”¨ç¨‹åºã€‚åœ¨ Node.js ä¸­ï¼Œå¤„ç†æ•°æ®æµï¼ˆå¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰ï¼‰æ˜¯å¾ˆå¸¸è§çš„ä»»åŠ¡ï¼Œè€Œ<code>readable streams</code>ï¼ˆå¯è¯»æµï¼‰æ˜¯è¿™äº›æ“ä½œä¸­çš„ä¸€ä¸ªå…³é”®æ¦‚å¿µã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-readable-closed" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-readable-closed"><span>ä»€ä¹ˆæ˜¯ <code>readable.closed</code>?</span></a></h3><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>readable.closed</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒå±äºå¯è¯»æµï¼ˆReadable Streamï¼‰å¯¹è±¡ã€‚è¿™ä¸ªå±æ€§è¿”å›ä¸€ä¸ª Promiseï¼Œè¿™ä¸ª Promise å°†åœ¨æµï¼ˆstreamï¼‰å®Œå…¨å…³é—­æ—¶è§£å†³ã€‚å¦‚æœæµå·²ç»å…³é—­ï¼Œé‚£ä¹ˆè®¿é—®è¿™ä¸ªå±æ€§ä¼šå¾—åˆ°ä¸€ä¸ªå·²ç»è§£å†³çš„ Promiseã€‚</p><p>&quot;å®Œå…¨å…³é—­&quot;æ„å‘³ç€æµä¸ä»…ç»“æŸäº†æ•°æ®çš„è¯»å–ï¼ˆå³æ²¡æœ‰æ›´å¤šçš„æ•°æ®å¯ä»¥ä»æµä¸­è¯»å–ï¼‰ï¼Œè€Œä¸”æ‰€æœ‰çš„å†…éƒ¨èµ„æºï¼ˆå¦‚æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼‰éƒ½å·²ç»è¢«æ¸…ç†ã€‚</p><h3 id="å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„" tabindex="-1"><a class="header-anchor" href="#å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„"><span>å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</span></a></h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªç¨‹åºï¼Œå®ƒä»ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚ä½¿ç”¨ Node.js ä¸­çš„å¯è¯»æµï¼Œä½ å¯ä»¥é€å—åœ°è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™å¯¹äºå¤„ç†å¤§æ–‡ä»¶æˆ–æ•°æ®æµéå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥å‡å°‘å†…å­˜ä½¿ç”¨ï¼Œå¹¶æé«˜ç¨‹åºçš„æ•ˆç‡ã€‚</p><p>å½“ä½ å¼€å§‹è¯»å–æ–‡ä»¶æ—¶ï¼Œä½ åˆ›å»ºä¸€ä¸ªå¯è¯»æµã€‚éšç€ä½ è¯»å–æ–‡ä»¶ï¼Œæµå°†é€æ­¥å‘ä½ æä¾›æ•°æ®ã€‚å½“æ²¡æœ‰æ›´å¤šæ•°æ®å¯è¯»æ—¶ï¼Œæµä¼šå‘å‡ºä¸€ä¸ª&#39;end&#39;äº‹ä»¶ã€‚ç„¶è€Œï¼Œå³ä½¿åœ¨&#39;end&#39;äº‹ä»¶ä¹‹åï¼Œå¯èƒ½ä»éœ€ä¸€äº›æ—¶é—´æ¥æ¸…ç†èµ„æºï¼Œæ¯”å¦‚å…³é—­æ–‡ä»¶æè¿°ç¬¦ã€‚å½“æ‰€æœ‰è¿™äº›æ¸…ç†å·¥ä½œå®Œæˆåï¼Œ<code>readable.closed</code>å±æ€§ä¸Šçš„ Promise è¢«è§£å†³ï¼Œè¿™è¡¨æ˜æµç°åœ¨å®Œå…¨å…³é—­äº†ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-2"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><h4 id="_1-æ–‡ä»¶è¯»å–-1" tabindex="-1"><a class="header-anchor" href="#_1-æ–‡ä»¶è¯»å–-1"><span>1. æ–‡ä»¶è¯»å–</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ª Web åº”ç”¨ï¼Œéœ€è¦ä»æœåŠ¡å™¨è¯»å–ç”¨æˆ·ä¸Šä¼ çš„å¤§å‹æ–‡æ¡£ï¼Œå¯¹å…¶è¿›è¡Œåˆ†æï¼Œç„¶åå­˜å‚¨åˆ†æç»“æœã€‚ä½¿ç”¨å¯è¯»æµè¯»å–è¿™ä¸ªæ–‡æ¡£æ—¶ï¼Œå¯ä»¥åˆ©ç”¨<code>readable.closed</code>å±æ€§æ¥ç¡®ä¿åœ¨ç»§ç»­å¤„ç†ä¹‹å‰ï¼Œæ–‡ä»¶å·²ç»è¢«å®Œå…¨è¯»å–å¹¶ä¸”æµå·²ç»æ¸…ç†å¹²å‡€äº†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµç”¨äºè¯»å–æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/large/document.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†æ–‡ä»¶çš„æ¯ä¸€å—æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No more data to read.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç¡®ä¿æµå·²å®Œå…¨å…³é—­å†ç»§ç»­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">closed</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stream is fully closed now.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // åœ¨è¿™é‡Œè¿›è¡Œåç»­å¤„ç†ï¼Œæ¯”å¦‚å­˜å‚¨åˆ†æç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-ç½‘ç»œè¯·æ±‚-1" tabindex="-1"><a class="header-anchor" href="#_2-ç½‘ç»œè¯·æ±‚-1"><span>2. ç½‘ç»œè¯·æ±‚</span></a></h4><p>åœ¨å¤„ç†ç½‘ç»œè¯·æ±‚æ—¶ï¼Œå°¤å…¶æ˜¯å¤„ç†å¤§é‡æ•°æ®çš„ API å“åº”ï¼Œä½¿ç”¨å¯è¯»æµå¯ä»¥å¸®åŠ©ä½ é€æ­¥å¤„ç†æ•°æ®ã€‚<code>readable.closed</code>å±æ€§åŒæ ·æœ‰ç”¨ï¼Œå®ƒå¯ä»¥ä¿è¯åœ¨è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œä¹‹å‰ï¼Œæ•°æ®å·²ç»å®Œå…¨æ¥æ”¶å¹¶ä¸”æµèµ„æºå¾—åˆ°äº†åˆé€‚çš„æ¸…ç†ã€‚</p><h3 id="ç»“è®º-1" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-1"><span>ç»“è®º</span></a></h3><p><code>readable.closed</code>å±æ€§åœ¨å¤„ç† Node.js ä¸­çš„æµæ—¶æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç®€å•çš„æ–¹å¼æ¥ç¡®å®šæµä½•æ—¶å®Œå…¨å…³é—­ã€‚è¿™å¯¹äºç¡®ä¿èµ„æºæ­£ç¡®æ¸…ç†å’Œé¿å…æ½œåœ¨çš„å†…å­˜é—®é¢˜è‡³å…³é‡è¦ã€‚é€šè¿‡æŒæ¡è¿™ç±»åŸºç¡€çŸ¥è¯†ï¼Œä½ å°†èƒ½æ›´æœ‰æ•ˆåœ°å¤„ç†æ–‡ä»¶å’Œç½‘ç»œæ•°æ®ï¼Œæ„å»ºå‡ºæ›´ç¨³å®šå’Œé«˜æ•ˆçš„åº”ç”¨ç¨‹åºã€‚</p><h5 id="readable-destroyed" tabindex="-1"><a class="header-anchor" href="#readable-destroyed"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readabledestroyed" target="_blank" rel="noopener noreferrer">readable.destroyed</a></span></a></h5><p>åœ¨ Node.js ä¸­ï¼Œ<code>readable.destroyed</code> å±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨äºæ ‡è¯†ä¸€ä¸ª <code>Readable</code> æµå¯¹è±¡æ˜¯å¦å·²ç»è¢«é”€æ¯ã€‚ç®€å•æ¥è¯´ï¼Œå¦‚æœè¿™ä¸ªå€¼ä¸º <code>true</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªæµå·²ç»ç»“æŸäº†ç”Ÿå‘½å‘¨æœŸï¼Œä¸å†å¯ç”¨ï¼›å¦‚æœä¸º <code>false</code>ï¼Œæµè¿˜å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚</p><p>å…ˆæ¥ç†è§£ä»€ä¹ˆæ˜¯æµï¼ˆStreamï¼‰ã€‚åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§å¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œç‰¹åˆ«é€‚åˆç”¨äºå¤„ç†å¤§é‡æ•°æ®ï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å†™æˆ–ç½‘ç»œé€šä¿¡ã€‚æµå¯ä»¥å°†æ•°æ®åˆ†æˆå°å—è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä»è€Œæé«˜äº†åº”ç”¨çš„æ•ˆç‡å’Œæ€§èƒ½ã€‚</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦çŸ¥é“æµæ˜¯å¦å·²ç»è¢«é”€æ¯" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦çŸ¥é“æµæ˜¯å¦å·²ç»è¢«é”€æ¯"><span>ä¸ºä»€ä¹ˆéœ€è¦çŸ¥é“æµæ˜¯å¦å·²ç»è¢«é”€æ¯ï¼Ÿ</span></a></h3><p>åœ¨å¤„ç†æµæ•°æ®æ—¶ï¼Œäº†è§£æµçš„çŠ¶æ€ï¼ˆæ˜¯å¦å·²é”€æ¯ï¼‰éå¸¸é‡è¦ã€‚å¦‚æœä½ å°è¯•å‘ä¸€ä¸ªå·²ç»è¢«é”€æ¯çš„æµä¸­å†™å…¥æ•°æ®æˆ–ä»å®ƒè¯»å–æ•°æ®ï¼Œè¿™å°†ä¼šå¯¼è‡´é”™è¯¯ã€‚å› æ­¤ï¼Œ<code>readable.destroyed</code> å±æ€§å¯ä»¥å¸®åŠ©ä½ é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-12" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-12"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="è¯»å–æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#è¯»å–æ–‡ä»¶"><span>è¯»å–æ–‡ä»¶</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œä½ æƒ³é€å—è¯»å–è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œç„¶åå¤„ç†ã€‚ä½¿ç”¨ Node.js çš„æ–‡ä»¶æµï¼ˆ<code>fs.createReadStream</code>ï¼‰æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå½“é‡åˆ°é”™è¯¯æˆ–è€…ä¸å†éœ€è¦è¯»å–æ›´å¤šæ•°æ®æ—¶ï¼Œä½ å¯èƒ½æƒ³æå‰ç»ˆæ­¢è¿™ä¸ªæµï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥è¯»å–æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;large-file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‡è®¾åœ¨æ»¡è¶³æŸä¸ªæ¡ä»¶åæˆ‘ä»¬ä¸å†éœ€è¦è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;close&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stream is destroyed:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">destroyed</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼šStream is destroyed: true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ç›‘å¬ <code>data</code> äº‹ä»¶æ¥å¤„ç†æ•°æ®ï¼Œå¹¶åœ¨æŸä¸ªæ¡ä»¶è¾¾æˆåè°ƒç”¨ <code>destroy()</code> æ–¹æ³•æ¥é”€æ¯æµã€‚éšåï¼Œåœ¨ <code>close</code> äº‹ä»¶çš„å›è°ƒå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥ <code>readable.destroyed</code> æ¥ç¡®è®¤æµç¡®å®å·²ç»è¢«é”€æ¯äº†ã€‚</p><h4 id="ç½‘ç»œè¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ç½‘ç»œè¯·æ±‚"><span>ç½‘ç»œè¯·æ±‚</span></a></h4><p>åœ¨å¤„ç† HTTP è¯·æ±‚æ—¶ï¼Œå¦‚æœè¯·æ±‚è¢«å–æ¶ˆæˆ–è¶…æ—¶ï¼Œä½ å¯èƒ½ä¹Ÿæƒ³é”€æ¯ä¸è¯·æ±‚ç›¸å…³çš„æµï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`HTTP çŠ¶æ€ç : </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">statusCode</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // åœ¨æŸäº›æ¡ä»¶ä¸‹é”€æ¯å“åº”æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;close&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Response stream destroyed:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">destroyed</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å‘ <code>example.com</code> å‘èµ· GET è¯·æ±‚ã€‚å¯¹äºå“åº”å¯¹è±¡ <code>res</code>ï¼ˆä¸€ä¸ªå¯è¯»æµï¼‰ï¼Œæˆ‘ä»¬ç›‘å¬äº† <code>data</code> äº‹ä»¶ä»¥æ¥æ”¶æ•°æ®ã€‚ä¹‹åï¼Œæˆ‘ä»¬è°ƒç”¨ <code>res.destroy()</code> æ¥é”€æ¯æµï¼Œæœ€ååœ¨ <code>close</code> äº‹ä»¶çš„å›è°ƒä¸­éªŒè¯æµæ˜¯å¦å·²ç»é”€æ¯ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>readable.destroyed</code> æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„å±æ€§ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ ç®¡ç†æµçš„ç”Ÿå‘½å‘¨æœŸï¼Œç¡®ä¿èµ„æºè¢«é€‚æ—¶é‡Šæ”¾ï¼Œé¿å…æ½œåœ¨çš„å†…å­˜æ³„æ¼ç­‰é—®é¢˜ã€‚</p><h5 id="readable-ispaused" tabindex="-1"><a class="header-anchor" href="#readable-ispaused"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readableispaused" target="_blank" rel="noopener noreferrer">readable.isPaused()</a></span></a></h5><p>äº†è§£ <code>readable.isPaused()</code> æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„æµï¼ˆStreamï¼‰å’Œä¸ºä»€ä¹ˆè¦ç”¨åˆ°å®ƒã€‚</p><h3 id="æµ-stream-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#æµ-stream-ç®€ä»‹"><span>æµï¼ˆStreamï¼‰ç®€ä»‹</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“ä½ ä¸éœ€è¦ä¸€æ¬¡æ€§æŠŠæ•°æ®å…¨éƒ¨è¯»å…¥å†…å­˜æ—¶ã€‚è¿™å¯¹äºå¤„ç†å¤§æ–‡ä»¶æˆ–å®æ—¶æ•°æ®éå¸¸æœ‰ç”¨ã€‚Node.js é‡Œæµçš„ç§ç±»ä¸»è¦æœ‰å››ç§ï¼šå¯è¯»æµã€å¯å†™æµã€åŒå·¥æµï¼ˆæ—¢å¯è¯»åˆå¯å†™ï¼‰ï¼Œä»¥åŠè½¬æ¢æµï¼ˆæ•°æ®è½¬æ¢ç”¨çš„åŒå·¥æµï¼‰ã€‚</p><h3 id="å¯è¯»æµä¸-ispaused-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#å¯è¯»æµä¸-ispaused-æ–¹æ³•"><span>å¯è¯»æµä¸ <code>isPaused()</code> æ–¹æ³•</span></a></h3><p>å¯è¯»æµï¼ˆReadable streamsï¼‰æ˜¯æä¾›æ•°æ®çš„æºå¤´ã€‚æƒ³è±¡ä¸€ä¸‹ä½ æ­£åœ¨ç”¨ä¸€æ ¹ç®¡å­ï¼ˆæµï¼‰ä»ä¸€ä¸ªå¤§æ°´æ¡¶ï¼ˆæ•°æ®æºï¼Œå¦‚æ–‡ä»¶ï¼‰å¾€å¤–å¯¼æ°´ï¼ˆæ•°æ®ï¼‰ã€‚è¿™ä¸ªâ€œå¯¼â€æ“ä½œå°±æ˜¯æµçš„è¯»æ“ä½œã€‚</p><p>ç°åœ¨ï¼Œå‡è®¾ä½ å¸Œæœ›æ§åˆ¶è¿™ä¸ªâ€œæ°´æµâ€çš„é€Ÿåº¦ï¼Œä¸æƒ³å®ƒå¤ªå¿«ä¹Ÿä¸æƒ³å®ƒåœæ­¢ï¼Œåªæ˜¯åœ¨æŸäº›æ—¶å€™æš‚åœä¸€ä¸‹ï¼Œç¨åå†ç»§ç»­ã€‚è¿™å°±å¼•å‡ºäº†æµçš„ä¸¤ç§æ¨¡å¼ï¼šâ€œæµåŠ¨æ¨¡å¼â€å’Œâ€œæš‚åœæ¨¡å¼â€ã€‚</p><ul><li><strong>æµåŠ¨æ¨¡å¼ï¼ˆFlowingï¼‰</strong>ï¼šæ•°æ®è‡ªåŠ¨åœ°ä»æ¥æºæµå‘æ¶ˆè´¹è€…ï¼Œæ¯”å¦‚ç›´æ¥ä»æ–‡ä»¶æµåˆ°å±å¹•è¾“å‡ºã€‚</li><li><strong>æš‚åœæ¨¡å¼ï¼ˆPausedï¼‰</strong>ï¼šå¿…é¡»æ˜¾å¼è°ƒç”¨æ–¹æ³•æ¥è¯»å–æ•°æ®å—ã€‚</li></ul><h3 id="readable-ispaused-1" tabindex="-1"><a class="header-anchor" href="#readable-ispaused-1"><span><code>readable.isPaused()</code></span></a></h3><p><code>readable.isPaused()</code> è¿™ä¸ªæ–¹æ³•è®©æˆ‘ä»¬èƒ½æ£€æŸ¥å¯è¯»æµçš„çŠ¶æ€ï¼Œäº†è§£å®ƒå½“å‰æ˜¯ä¸æ˜¯å¤„äºâ€œæš‚åœæ¨¡å¼â€ã€‚</p><ul><li>å¦‚æœè¿”å› <code>true</code>ï¼Œé‚£ä¹ˆæµå½“å‰å¤„äºæš‚åœæ¨¡å¼ï¼›</li><li>å¦‚æœè¿”å› <code>false</code>ï¼Œæ„å‘³ç€æµå¤„äºæµåŠ¨æ¨¡å¼ã€‚</li></ul><h3 id="å®é™…åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨åœºæ™¯"><span>å®é™…åº”ç”¨åœºæ™¯</span></a></h3><h4 id="æ–‡ä»¶è¯»å–" tabindex="-1"><a class="header-anchor" href="#æ–‡ä»¶è¯»å–"><span>æ–‡ä»¶è¯»å–</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦ä»å¤§å‹æ—¥å¿—æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚ä½ å¯èƒ½ä¸å¸Œæœ›ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå› ä¸ºè¿™ä¼šæ¶ˆè€—å¤§é‡èµ„æºã€‚ä½¿ç”¨æµï¼Œä½ å¯ä»¥é€æ­¥è¯»å–æ–‡ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./largeLogFile.log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ£€æŸ¥æµæ˜¯å¦å·²æš‚åœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isPaused</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆå§‹çŠ¶æ€ä¸‹ï¼Œç»“æœåº”è¯¥æ˜¯falseï¼Œå› ä¸ºæµè¿˜æ²¡æœ‰å¼€å§‹æµåŠ¨æˆ–è¢«ç”¨æˆ·æš‚åœ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼€å§‹è¯»å–æ•°æ®ï¼Œä½†è®©æˆ‘ä»¬æ‰‹åŠ¨æš‚åœå’Œæ¢å¤æµæ¥æ§åˆ¶è¯»å–è¿‡ç¨‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pause</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ‰‹åŠ¨æš‚åœæµ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stream is paused:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isPaused</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ­¤æ—¶åº”è¯¥è¾“å‡º true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç»§ç»­è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stream is paused:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isPaused</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨æ•°æ®ç»§ç»­æµåŠ¨å‰ï¼Œä¼šæ˜¾ç¤º false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å»¶è¿Ÿ1ç§’åç»§ç»­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>readable.isPaused()</code> æ¥æ£€æŸ¥æµçš„çŠ¶æ€ï¼Œå¹¶ä»¥æ­¤åŸºç¡€ä¸Šè¿›è¡Œæµçš„æ§åˆ¶ï¼Œæ¯”å¦‚åœ¨éœ€è¦æ—¶æš‚åœå’Œæ¢å¤æµã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥æ›´æœ‰æ•ˆåœ°ç®¡ç†æ•°æ®æµï¼Œé¿å…å› ä¸€æ¬¡æ€§å¤„ç†å¤§é‡æ•°æ®è€Œé€ æˆå†…å­˜æº¢å‡ºçš„é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æ ¹æ®åº”ç”¨éœ€æ±‚ï¼Œå¦‚ç”¨æˆ·è¾“å…¥æˆ–å…¶ä»–å¤–éƒ¨äº‹ä»¶ï¼Œæ¥åŠ¨æ€è°ƒæ•´æ•°æ®å¤„ç†çš„èŠ‚å¥ã€‚</p><h5 id="readable-pause" tabindex="-1"><a class="header-anchor" href="#readable-pause"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablepause" target="_blank" rel="noopener noreferrer">readable.pause()</a></span></a></h5><p>Node.js ä¸­çš„ <code>readable.pause()</code> æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæš‚åœå¤„ç†æµï¼ˆStreamï¼‰ä¸­çš„æ•°æ®ã€‚æƒ³è¦ç†è§£è¿™ä¸ªæ–¹æ³•ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ Node.js ä¸­æµï¼ˆStreamï¼‰çš„æ¦‚å¿µã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§æŠ½è±¡çš„æ•°æ®ç»“æ„ï¼Œç”¨äºè¯»å–æˆ–å†™å…¥æ•°æ®ã€‚è¿™äº›æ•°æ®å¯ä»¥æ˜¯æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ã€æˆ–è€…ä»»ä½•è¿ç»­çš„æ•°æ®æº/ç›®æ ‡ã€‚æµä¸»è¦åˆ†ä¸ºå››ç§ç±»å‹ï¼šå¯è¯»æµã€å¯å†™æµã€åŒå·¥æµï¼ˆæ—¢å¯è¯»åˆå¯å†™ï¼‰ã€è½¬æ¢æµï¼ˆåœ¨è¯»å†™è¿‡ç¨‹ä¸­å¯ä»¥ä¿®æ”¹æ•°æ®ï¼‰ã€‚</p><p><code>readable.pause()</code> æ˜¯é’ˆå¯¹<strong>å¯è¯»æµ</strong>çš„æ“ä½œã€‚å¯è¯»æµæ˜¯æŒ‡é‚£äº›æä¾›æ•°æ®çš„æµï¼Œæ¯”å¦‚ä»æ–‡ä»¶è¯»å–æ•°æ®æˆ–æ¥æ”¶æ¥è‡ªäº’è”ç½‘çš„æ•°æ®ç­‰ã€‚å½“ä½ è°ƒç”¨ <code>readable.pause()</code> æ–¹æ³•æ—¶ï¼Œå®è´¨ä¸Šæ˜¯åœ¨å‘Šè¯‰æµï¼šâ€œæš‚æ—¶åœæ­¢è§¦å‘ &#39;data&#39; äº‹ä»¶ã€‚â€åœ¨ Node.js ä¸­ï¼Œæ•°æ®é€šå¸¸é€šè¿‡ç›‘å¬ &#39;data&#39; äº‹ä»¶æ¥ä»æµä¸­è¯»å–ã€‚ä¸€æ—¦è°ƒç”¨äº† <code>.pause()</code>ï¼Œå°±ä¸å†æœ‰æ–°çš„ &#39;data&#39; äº‹ä»¶è¢«è§¦å‘ï¼Œè¿™æ„å‘³ç€æ•°æ®çš„è¯»å–è¢«æš‚åœäº†ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-13" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-13"><span>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</span></a></h3><p>è€ƒè™‘è¿™å‡ ä¸ªåœºæ™¯ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£ <code>readable.pause()</code> çš„åº”ç”¨ã€‚</p><h4 id="ä¾‹å­-1-æ§åˆ¶æ•°æ®è¯»å–é€Ÿåº¦" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-æ§åˆ¶æ•°æ®è¯»å–é€Ÿåº¦"><span>ä¾‹å­ 1: æ§åˆ¶æ•°æ®è¯»å–é€Ÿåº¦</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ä»ä¸€ä¸ªéå¸¸å¤§çš„æ—¥å¿—æ–‡ä»¶ä¸­é€è¡Œè¯»å–æ•°æ®è¿›è¡Œåˆ†æï¼Œä½†ç”±äºæŸäº›åŸå› ï¼ˆæ¯”å¦‚å†…å­˜ä½¿ç”¨é™åˆ¶ï¼‰ï¼Œä½ ä¸å¸Œæœ›æ•°æ®è¯»å¾—å¤ªå¿«ã€‚ä½ å¯ä»¥åœ¨è¯»å–ä¸€å®šæ•°é‡çš„è¡Œä¹‹åè°ƒç”¨ <code>readable.pause()</code> æ¥æš‚åœè¯»å–ï¼Œå¤„ç†å½“å‰æ‰¹æ¬¡çš„æ•°æ®ï¼Œç„¶åå†ç»§ç»­è¯»å–ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> rl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  input</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;big_file.log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  output</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  terminal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">rl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;line&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†æ¯ä¸€è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‡è®¾æˆ‘ä»¬æƒ³è¦æš‚åœè¯»å–</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  rl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pause</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // åšä¸€äº›å¼‚æ­¥æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ç„¶åç»§ç»­è¯»å–</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    rl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å»¶è¿Ÿ1ç§’ç»§ç»­è¯»å–</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-2-æ ¹æ®æ¡ä»¶æš‚åœå’Œæ¢å¤æµ" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-æ ¹æ®æ¡ä»¶æš‚åœå’Œæ¢å¤æµ"><span>ä¾‹å­ 2: æ ¹æ®æ¡ä»¶æš‚åœå’Œæ¢å¤æµ</span></a></h4><p>æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼Œä½ æ­£åœ¨ä»ç½‘ç»œä¸‹è½½å¤§é‡æ•°æ®ï¼Œå¹¶ä¸”ä½ åªæƒ³åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰å¤„ç†è¿™äº›æ•°æ®ï¼ˆæ¯”å¦‚åªå¤„ç†ç‰¹å®šç±»å‹çš„æ•°æ®åŒ…ï¼‰ã€‚ä½ å¯ä»¥åœ¨æ£€æµ‹åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„æ•°æ®æ—¶ï¼Œä½¿ç”¨ <code>readable.pause()</code> æš‚åœè¯»å–ï¼Œç›´åˆ°æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ•°æ®åŒ…å†æ¢å¤è¯»å–ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™æ˜¯ä½ çš„æ•°æ®æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">shouldPause</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // shouldPause æ˜¯ä¸€ä¸ªä½ å®šä¹‰çš„å‡½æ•°ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦åº”è¯¥æš‚åœè¯»å–</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pause</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æš‚åœè¯»å–</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      processChunkLater</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¤„ç†å®Œåå†æ¢å¤è¯»å–</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // ç»§ç»­å¤„ç† chunk</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ€»ç»“-13" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-13"><span>æ€»ç»“</span></a></h3><p>æ€»çš„æ¥è¯´ï¼Œ<code>readable.pause()</code> æ˜¯ä¸€ä¸ªæ§åˆ¶æµæ•°æ®è¯»å–é€Ÿåº¦çš„é‡è¦æ‰‹æ®µï¼Œå…è®¸ä½ æ ¹æ®ç¨‹åºçš„éœ€è¦å’Œèµ„æºé™åˆ¶æ¥æš‚åœå’Œæ¢å¤æ•°æ®çš„è¯»å–ã€‚è¿™åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–éœ€è¦æ ¹æ®ç‰¹å®šæ¡ä»¶å¤„ç†æ•°æ®æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚</p><h5 id="readable-pipe-destination-options" tabindex="-1"><a class="header-anchor" href="#readable-pipe-destination-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablepipedestination-options" target="_blank" rel="noopener noreferrer">readable.pipe(destination[, options])</a></span></a></h5><p>äº†è§£ <code>readable.pipe(destination[, options])</code> å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•ç†è§£å‡ ä¸ªæ¦‚å¿µï¼š</p><ol><li><strong>Node.js</strong>ï¼šä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚</li><li><strong>Stream</strong>ï¼šæµæ˜¯ä¸€ç§å¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œç‰¹åˆ«é€‚ç”¨äºå¤„ç†å¤§é‡æ•°æ®æˆ–è€…æ¥è‡ªå¤–éƒ¨æºçš„æ•°æ®ã€‚æ•°æ®ä¼šä¸€å°å—ä¸€å°å—åœ°è¿›è¡Œä¼ è¾“å’Œå¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</li><li><strong>Readable Stream</strong>ï¼šä¸€ç§å¯ä»¥ä»ä¸­è¯»å–æ•°æ®çš„æµï¼Œä¾‹å¦‚ä»æ–‡ä»¶ç³»ç»Ÿè¯»å–æ–‡ä»¶æˆ–ä»ç½‘ç»œè¯·æ±‚è¯»å–æ•°æ®ã€‚</li></ol><p><code>readable.pipe(destination[, options])</code> æ–¹æ³•æ˜¯ Node.js ä¸­å¤„ç†æµéå¸¸é‡è¦çš„ä¸€ä¸ªæ–¹æ³•ã€‚å®ƒå…è®¸ä½ å°†ä¸€ä¸ªå¯è¯»æµï¼ˆreadable streamï¼‰ä¸­çš„æ•°æ®å‘é€åˆ°å¦ä¸€ä¸ªæµï¼ˆé€šå¸¸æ˜¯å¯å†™æµ writable streamï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºâ€œç®¡é“ï¼ˆpipingï¼‰â€ï¼Œç±»ä¼¼äº Unix ç³»ç»Ÿä¸­çš„ç®¡é“æ¦‚å¿µï¼Œå¯ä»¥å°†å¤šä¸ªæ“ä½œè¿æ¥èµ·æ¥ï¼Œå…¶ä¸­æ¯ä¸ªæ“ä½œçš„è¾“å‡ºç›´æ¥æˆä¸ºä¸‹ä¸€ä¸ªæ“ä½œçš„è¾“å…¥ã€‚</p><h3 id="å‚æ•°è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è¯´æ˜"><span>å‚æ•°è¯´æ˜</span></a></h3><ul><li><code>destination</code>ï¼šç›®æ ‡ä½ç½®ï¼Œå³æ•°æ®æµå‘çš„å¯å†™æµã€‚</li><li><code>options</code>ï¼šä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œæä¾›ç®¡é“æ“ä½œçš„é…ç½®é€‰é¡¹ï¼Œå¦‚æ§åˆ¶æµåŠ¨é€Ÿç‡ç­‰ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ä¸¾ä¾‹-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¸¾ä¾‹-1"><span>å®é™…åº”ç”¨ä¸¾ä¾‹</span></a></h3><h4 id="_1-æ–‡ä»¶å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#_1-æ–‡ä»¶å¤åˆ¶"><span>1. æ–‡ä»¶å¤åˆ¶</span></a></h4><p>å‡è®¾ä½ æƒ³è¦å¤åˆ¶ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œç›´æ¥è¯»å–æ•´ä¸ªæ–‡ä»¶åˆ°å†…å­˜ä¸­ç„¶åå†å†™å…¥å¯èƒ½ä¼šæ¶ˆè€—å¤ªå¤šèµ„æºã€‚ä½¿ç”¨æµå’Œ <code>.pipe()</code> æ–¹æ³•å¯ä»¥æ›´é«˜æ•ˆåœ°å®Œæˆä»»åŠ¡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµï¼ˆè¯»å–æ–‡ä»¶ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;source.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµï¼ˆå†™å…¥æ–‡ä»¶ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;destination.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ pipe æ–¹æ³•å°†å¯è¯»æµä¸­çš„æ•°æ®ç›´æ¥å†™å…¥å¯å†™æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç åˆ›å»ºäº†ä¸¤ä¸ªæµï¼šä¸€ä¸ªä» <code>source.txt</code> è¯»å–æ•°æ®çš„å¯è¯»æµï¼Œå’Œä¸€ä¸ªå‘ <code>destination.txt</code> å†™å…¥æ•°æ®çš„å¯å†™æµã€‚<code>.pipe()</code> æ–¹æ³•å°†ä¸¤è€…è¿æ¥èµ·æ¥ï¼Œå®ç°äº†æ–‡ä»¶çš„å¤åˆ¶åŠŸèƒ½ã€‚</p><h4 id="_2-ç½‘ç»œè¯·æ±‚-2" tabindex="-1"><a class="header-anchor" href="#_2-ç½‘ç»œè¯·æ±‚-2"><span>2. ç½‘ç»œè¯·æ±‚</span></a></h4><p>å½“å¤„ç† HTTP è¯·æ±‚æ—¶ï¼Œä½ å¯èƒ½æƒ³æŠŠæ”¶åˆ°çš„è¯·æ±‚æ•°æ®è½¬å‘åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ä¸Šã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;request&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å‡è®¾æˆ‘ä»¬è¦å°†è¯·æ±‚ä»£ç†åˆ°å¦ä¸€ä¸ªåœ°å€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> destinationUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;http://example.com/api&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ä½¿ç”¨ request åº“å‘èµ·è¯·æ±‚ï¼Œå¹¶å°†åŸè¯·æ±‚çš„å†…å®¹é€šè¿‡ pipe æ–¹æ³•è½¬å‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">request</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">destinationUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œé€šè¿‡ <code>.pipe()</code> æ–¹æ³•æŠŠæ¥æ”¶åˆ°çš„ HTTP è¯·æ±‚ (<code>req</code>) çš„æ•°æ®ç›´æ¥è½¬å‘åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ï¼Œç„¶åå°†å“åº” (<code>res</code>) ä¹Ÿé€šè¿‡ç®¡é“è¿”å›ç»™åŸå§‹è¯·æ±‚è€…ã€‚</p><h3 id="æ€»ç»“-14" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-14"><span>æ€»ç»“</span></a></h3><p>ä½¿ç”¨ <code>.pipe()</code> æ–¹æ³•èƒ½å¤Ÿæ–¹ä¾¿åœ°æ§åˆ¶æ•°æ®æµåŠ¨ï¼Œå®ƒæ˜¯æ„å»ºé«˜æ•ˆã€å¯æ‰©å±• Node.js åº”ç”¨çš„å…³é”®å·¥å…·ä¹‹ä¸€ã€‚é€šè¿‡ç®¡é“è¿æ¥æµï¼Œä½ å¯ä»¥ç®€åŒ–ä»£ç ã€èŠ‚çœå†…å­˜ï¼Œå¹¶æå‡åº”ç”¨æ€§èƒ½ã€‚</p><h5 id="readable-read-size" tabindex="-1"><a class="header-anchor" href="#readable-read-size"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablereadsize" target="_blank" rel="noopener noreferrer">readable.read([size])</a></span></a></h5><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„ <code>readable.read([size])</code> æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šåœ¨è®¨è®ºæµï¼ˆStreamsï¼‰çš„æ¦‚å¿µã€‚åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“ä½ æœ‰å¤§é‡æ•°æ®éœ€è¦å¤„ç†æ—¶ï¼Œè€Œä¸”ä½ ä¸å¸Œæœ›ä¸€æ¬¡æ€§å°†å®ƒä»¬å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><h3 id="æµ-streams-ç®€ä»‹-4" tabindex="-1"><a class="header-anchor" href="#æµ-streams-ç®€ä»‹-4"><span>æµï¼ˆStreamsï¼‰ç®€ä»‹</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµè¢«ç”¨äºè¯»å–æˆ–å†™å…¥æ•°æ®ã€‚è¿™äº›æ“ä½œå¯ä»¥æ˜¯å¼‚æ­¥çš„ï¼Œå¹¶ä¸”ä»¥å—çš„å½¢å¼å‘ç”Ÿï¼Œè¿™æ„å‘³ç€æ•°æ®è¢«åˆ†æˆå°å—é€ä¸€å¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨åŠ è½½ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ï¼Œæˆ–è€…å³å¯è¯»åˆå¯å†™ï¼ˆåŒå‘æµï¼‰ã€‚</p><h3 id="readable-read-size-1" tabindex="-1"><a class="header-anchor" href="#readable-read-size-1"><span><code>readable.read([size])</code></span></a></h3><p><code>readable.read([size])</code> æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºä»å¯è¯»æµä¸­æ‹‰å–ä¸€äº›æ•°æ®ã€‚è¿™é‡Œçš„ <code>size</code> å‚æ•°æ˜¯ä¸€ä¸ªå¯é€‰é¡¹ï¼Œè¡¨ç¤ºä½ æƒ³è¦ä»æµä¸­è¯»å–å¤šå°‘å­—èŠ‚çš„æ•°æ®ã€‚å¦‚æœä¸æŒ‡å®š <code>size</code>ï¼Œåˆ™ä¼šå°½å¯èƒ½å¤šåœ°è¯»å–æ•°æ®ã€‚</p><h4 id="ä½•æ—¶ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#ä½•æ—¶ä½¿ç”¨"><span>ä½•æ—¶ä½¿ç”¨ï¼š</span></a></h4><ul><li>å½“ä½ æƒ³ä»æºå¤´ï¼ˆå¦‚æ–‡ä»¶ã€è¯·æ±‚ç­‰ï¼‰æŒ‰éœ€è¯»å–æ•°æ®æ—¶ã€‚</li><li>å½“ä½ å¤„ç†çš„æ•°æ®é‡å¤ªå¤§ï¼Œæ— æ³•ä¸€æ¬¡æ€§æ”¾å…¥å†…å­˜æ—¶ã€‚</li><li>å½“ä½ æƒ³å¯¹æ•°æ®è¿›è¡Œæµæ°´çº¿ï¼ˆpipeï¼‰å¤„ç†ï¼Œæ¯”å¦‚ä»æ–‡ä»¶è¯»å–æ•°æ®åç›´æ¥å‹ç¼©ã€‚</li></ul><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹-7" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-7"><span>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</span></a></h4><ol><li><p><strong>ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼š</strong></p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œä½ æƒ³é€ä¸ªç‰‡æ®µåœ°è¯»å–å¹¶å¤„ç†æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;big-file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¾ªç¯è¯»å–æ•°æ®å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  while</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No more data to read.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æ§åˆ¶è¯»å–å¤§å°ï¼š</strong></p><p>å¦‚æœä½ æƒ³æ›´ç²¾ç¡®åœ°æ§åˆ¶æ¯æ¬¡è¯»å–çš„æ•°æ®é‡ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®š <code>size</code> å‚æ•°æ¥å®ç°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æ­¤å¤„ä½¿ç”¨çš„æ˜¯ä¹‹å‰å®šä¹‰çš„ readableStream</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™æ¬¡æˆ‘ä»¬æŒ‡å®šæ¯æ¬¡è¯»å–1024å­—èŠ‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  while</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received 1024 bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç½‘ç»œè¯·æ±‚ï¼š</strong></p><p>å½“å¤„ç† HTTP è¯·æ±‚æ—¶ï¼Œè¯·æ±‚å¯¹è±¡æ˜¯ä¸€ä¸ªå¯è¯»æµã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>.read()</code> æ–¹æ³•æŒ‰éœ€è¯»å–è¯·æ±‚ä½“æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Complete request body:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Data received&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>ä»¥ä¸Šç¤ºä¾‹å±•ç¤ºäº† <code>readable.read([size])</code> æ–¹æ³•åœ¨ä¸åŒåº”ç”¨åœºæ™¯ä¸‹çš„å®é™…åº”ç”¨ï¼ŒåŒ…æ‹¬æ–‡ä»¶å¤„ç†å’Œç½‘ç»œè¯·æ±‚å¤„ç†ã€‚é€šè¿‡æµå¼å¤„ç†æ•°æ®ï¼ŒNode.js åº”ç”¨å¯ä»¥æœ‰æ•ˆç®¡ç†å¤§é‡æ•°æ®ï¼ŒåŒæ—¶ä¿æŒå†…å­˜ä½¿ç”¨çš„é«˜æ•ˆæ€§ã€‚</p><h5 id="readable-readable" tabindex="-1"><a class="header-anchor" href="#readable-readable"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablereadable" target="_blank" rel="noopener noreferrer">readable.readable</a></span></a></h5><p>Node.js ä¸­çš„ <code>readable.readable</code> æ˜¯ä¸€ä¸ªå±æ€§ï¼Œå®ƒå±äº Stream API çš„ä¸€éƒ¨åˆ†ï¼Œå…·ä½“æ¥è¯´æ˜¯å¯è¯»æµï¼ˆReadable streamsï¼‰ç›¸å…³çš„å†…å®¹ã€‚åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£é‡Œï¼Œè¿™ä¸ªå±æ€§è¢«ç”¨æ¥æŒ‡ç¤ºæµï¼ˆstreamï¼‰æ˜¯å¦å¤„äºå¯è¯»çŠ¶æ€ã€‚</p><p>è®©æˆ‘ä»¬ç®€å•æ˜äº†åœ°ç†è§£å®ƒï¼š</p><h3 id="ä»€ä¹ˆæ˜¯æµ-stream" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯æµ-stream"><span>ä»€ä¹ˆæ˜¯æµï¼ˆStreamï¼‰ï¼Ÿ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§å¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œå°¤å…¶æ˜¯å½“ä½ ä¸éœ€è¦ä¸€æ¬¡æ€§è·å–æ‰€æœ‰æ•°æ®æ—¶ã€‚æ¯”å¦‚ï¼Œä»æ–‡ä»¶è¯»å–æ•°æ®æˆ–è€…é€šè¿‡ç½‘ç»œæ¥æ”¶æ•°æ®ã€‚æµå…è®¸æ•°æ®åˆ†å—å¤„ç†ï¼Œè¿™ä½¿å¾—å†…å­˜ç®¡ç†æ›´åŠ é«˜æ•ˆï¼Œç‰¹åˆ«æ˜¯å¤„ç†å¤§é‡æ•°æ®æ—¶ã€‚</p><h3 id="å¯è¯»æµ-readable-streams" tabindex="-1"><a class="header-anchor" href="#å¯è¯»æµ-readable-streams"><span>å¯è¯»æµï¼ˆReadable Streamsï¼‰</span></a></h3><p>å¯è¯»æµæ˜¯ä¸€ç§ Streamï¼Œå…è®¸ä½ ä»æŸä¸ªæ¥æºï¼ˆå¦‚æ–‡ä»¶ã€HTTP å“åº”ç­‰ï¼‰é€æ­¥è¯»å–æ•°æ®ã€‚å°±åƒæ‰“å¼€æ°´é¾™å¤´è®©æ°´æµå‡ºæ¥ä¸€æ ·ï¼Œä½ å¯ä»¥æ§åˆ¶ä½•æ—¶å¼€å§‹è¯»å–æ•°æ®ï¼Œä»¥åŠå¦‚ä½•å¤„ç†è¿™äº›æ•°æ®ã€‚</p><h3 id="readable-readable-å±æ€§" tabindex="-1"><a class="header-anchor" href="#readable-readable-å±æ€§"><span><code>readable.readable</code> å±æ€§</span></a></h3><ul><li><p><strong>å®šä¹‰</strong>: <code>readable.readable</code> å±äºå¯è¯»æµçš„å±æ€§ã€‚å½“å®ƒä¸º <code>true</code> æ—¶ï¼Œè¡¨ç¤ºæµç›®å‰å¤„äºå¯è¯»çŠ¶æ€ï¼Œå³æœ‰æ•°æ®å¯ä»¥è¯»å–ï¼Œæˆ–è€…æµå·²ç»ç»“æŸä½†è¿˜æ²¡æœ‰å…³é—­ã€‚å¦‚æœå®ƒä¸º <code>false</code>ï¼Œå¯èƒ½æ˜¯å› ä¸ºæµè¿˜æ²¡æœ‰å®Œå…¨åˆå§‹åŒ–ï¼Œæˆ–è€…æµå·²ç»ç»“æŸå¹¶ä¸”å…³é—­äº†ã€‚</p></li><li><p><strong>å®é™…æ„ä¹‰</strong>: è¿™ä¸ªå±æ€§å¯ä»¥å¸®åŠ©ä½ åˆ¤æ–­ä½•æ—¶å¯ä»¥ä»æµä¸­å®‰å…¨åœ°è¯»å–æ•°æ®ï¼Œè€Œä¸ä¼šé‡åˆ°é”™è¯¯ã€‚</p></li></ul><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-14" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-14"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-æ£€æŸ¥æµæ˜¯å¦å¯è¯»" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-æ£€æŸ¥æµæ˜¯å¦å¯è¯»"><span>ä¾‹å­ 1: æ£€æŸ¥æµæ˜¯å¦å¯è¯»</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œä»ä¸€ä¸ªæ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>fs.createReadStream</code> æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¯è¯»æµï¼Œå¹¶ä½¿ç”¨ <code>readable.readable</code> æ¥æ£€æŸ¥æ˜¯å¦å¯ä»¥ä»æµä¸­è¯»å–æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ &#39;readable&#39; äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æµæ˜¯å¯è¯»çš„ï¼Œå¯ä»¥å®‰å…¨åœ°è¯»å–æ•°æ®&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ((</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`è¯»å–çš„æ•°æ®: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æµä¸æ˜¯å¯è¯»çš„&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-2-æµçš„çŠ¶æ€å˜åŒ–" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-æµçš„çŠ¶æ€å˜åŒ–"><span>ä¾‹å­ 2: æµçš„çŠ¶æ€å˜åŒ–</span></a></h4><p>åœ¨ä¸€ä¸ªç½‘ç»œè¯·æ±‚çš„åœºæ™¯ä¸­ï¼ŒæœåŠ¡å™¨ç«¯å¯èƒ½ä¼šæ ¹æ®è¯·æ±‚çš„æƒ…å†µåŠ¨æ€ç”Ÿæˆæ•°æ®å¹¶å‘é€ç»™å®¢æˆ·ç«¯ã€‚æœåŠ¡å™¨ç«¯ä»£ç å¯ä»¥åˆ©ç”¨ <code>readable.readable</code> æ¥å†³å®šä½•æ—¶å¼€å§‹å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ http æ¨¡å—çš„æœåŠ¡å™¨ç«¯ä»£ç ç‰‡æ®µ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> getSomeReadableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡å®šè¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // æµå‡†å¤‡å¥½äº†ï¼Œå¯ä»¥å¼€å§‹å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ pipe æ–¹æ³•ç›´æ¥å°†æ•°æ®æµå‘å“åº”å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // æµä¸å¯è¯»ï¼Œå¯èƒ½éœ€è¦å¤„ç†é”™è¯¯æˆ–å‘é€æ›¿ä»£å“åº”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä»¥ä¸Šä¾‹å­ä¸­ï¼Œ<code>getSomeReadableStream</code> è¡¨ç¤ºä¸€ä¸ªè¿”å›å¯è¯»æµçš„å‡½æ•°ï¼Œè¿™ä¸ªæµå¯èƒ½æ˜¯ä»æ–‡ä»¶ç³»ç»Ÿè¯»å–ï¼Œä¹Ÿå¯èƒ½æ˜¯å…¶ä»–æ¥æºã€‚é€šè¿‡ç›‘å¬ <code>readable</code> äº‹ä»¶å’Œæ£€æŸ¥ <code>readable.readable</code> å±æ€§ï¼Œä»£ç å¯ä»¥çµæ´»åœ°å¤„ç†ä¸åŒçš„æµçŠ¶æ€ï¼Œç¡®ä¿åªæœ‰åœ¨æ•°æ®çœŸæ­£å¯è¯»æ—¶æ‰è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚</p><h5 id="readable-readableaborted" tabindex="-1"><a class="header-anchor" href="#readable-readableaborted"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablereadableaborted" target="_blank" rel="noopener noreferrer">readable.readableAborted</a></span></a></h5><p>Node.js ä¸­çš„<code>readable.readableAborted</code>å±æ€§æ˜¯ä¸å¯è¯»æµï¼ˆreadable streamsï¼‰ç›¸å…³çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå®ƒä¸»è¦ç”¨äºæŒ‡ç¤ºæµæ˜¯å¦å·²è¢«ä¸­æ­¢ã€‚åœ¨æ·±å…¥è§£é‡Šè¿™ä¸ªæ¦‚å¿µä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥å…ˆäº†è§£ä»€ä¹ˆæ˜¯å¯è¯»æµä»¥åŠä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä¸­æ–­æµã€‚</p><h3 id="å¯è¯»æµ-readable-streams-1" tabindex="-1"><a class="header-anchor" href="#å¯è¯»æµ-readable-streams-1"><span>å¯è¯»æµï¼ˆReadable Streamsï¼‰</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamsï¼‰æ˜¯å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œå°¤å…¶æ˜¯å½“ä½ ä¸éœ€è¦ä¸€æ¬¡æ€§è·å–æ‰€æœ‰æ•°æ®æ—¶ã€‚å¯è¯»æµæ˜¯ä¸€ç§å¯ä»¥ä»ä¸­è¯»å–æ•°æ®çš„æµï¼Œä¾‹å¦‚ä»æ–‡ä»¶ã€HTTP å“åº”æˆ–å…¶ä»–æ•°æ®æºä¸­è¯»å–æ•°æ®ã€‚</p><h3 id="ä¸­æ­¢æµ" tabindex="-1"><a class="header-anchor" href="#ä¸­æ­¢æµ"><span>ä¸­æ­¢æµ</span></a></h3><p>æœ‰æ—¶å€™ï¼Œåœ¨ä½ å¼€å§‹ä»ä¸€ä¸ªæµä¸­è¯»å–æ•°æ®åï¼Œä½ å¯èƒ½ä¼šå†³å®šä¸å†éœ€è¦æ›´å¤šçš„æ•°æ®ï¼Œæˆ–è€…å¸Œæœ›å› ä¸ºæŸäº›é”™è¯¯æˆ–æ¡ä»¶è€Œæå‰ç»“æŸæ•°æ®çš„è¯»å–ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥â€œä¸­æ­¢â€è¿™ä¸ªæµï¼Œåœæ­¢è¯»å–æ›´å¤šçš„æ•°æ®ï¼Œå¹¶å…è®¸ Node.js è¿›è¡Œå¿…è¦çš„æ¸…ç†å·¥ä½œã€‚</p><h3 id="readable-readableaborted-1" tabindex="-1"><a class="header-anchor" href="#readable-readableaborted-1"><span><code>readable.readableAborted</code></span></a></h3><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬èšç„¦äº<code>readable.readableAborted</code>ã€‚è¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆBooleanï¼‰ï¼Œç”¨äºæ ‡è®°ä¸€ä¸ªæµæ˜¯å¦å·²è¢«ä¸­æ­¢ã€‚å¦‚æœæµè¢«ä¸­æ­¢äº†ï¼Œ<code>readable.readableAborted</code>å°†è¿”å›<code>true</code>ï¼Œå¦åˆ™è¿”å›<code>false</code>ã€‚</p><h4 id="ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯"><span>ä½¿ç”¨åœºæ™¯</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¯¥åº”ç”¨ä»ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­è¯»å–æ•°æ®è¿›è¡Œå¤„ç†ã€‚çªç„¶ï¼Œç”±äºæŸäº›åŸå› ï¼ˆæ¯”å¦‚ç”¨æˆ·å–æ¶ˆæ“ä½œæˆ–å‘ç”Ÿäº†é”™è¯¯ï¼‰ï¼Œä½ éœ€è¦åœæ­¢è¯»å–å¹¶å…³é—­æ–‡ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/large/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¸€æ®µæ—¶é—´åï¼Œä½ å†³å®šä¸å†ç»§ç»­è¯»å–æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ­¤æ—¶ï¼Œä½ å¯ä»¥æ£€æŸ¥readable.readableAbortedæ¥ç¡®è®¤æµæ˜¯å¦å·²è¢«ä¸­æ­¢</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableAborted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stream has been aborted.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stream is still active.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>.destroy()</code>æ–¹æ³•æ¥ä¸­æ­¢æµã€‚ç´§æ¥ç€ï¼Œæˆ‘ä»¬é€šè¿‡æ£€æŸ¥<code>readable.readableAborted</code>å±æ€§æ¥ç¡®å®šæµæ˜¯å¦çœŸçš„è¢«ä¸­æ­¢äº†ã€‚</p><p>æ€»ç»“ï¼šåœ¨ Node.js ä¸­ï¼Œ<code>readable.readableAborted</code>æ˜¯ä¸€ä¸ªç”¨äºæ£€æŸ¥å¯è¯»æµæ˜¯å¦å·²ç»è¢«æ˜ç¡®ä¸­æ­¢çš„å±æ€§ã€‚è¿™å¯¹äºç®¡ç†èµ„æºå’Œç¡®ä¿åº”ç”¨é€»è¾‘æ­£ç¡®æ‰§è¡Œéå¸¸é‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–éœ€è¦å“åº”ç”¨æˆ·è¡Œä¸ºï¼ˆå¦‚å–æ¶ˆæ“ä½œï¼‰çš„æƒ…å†µä¸‹ã€‚</p><h5 id="readable-readabledidread" tabindex="-1"><a class="header-anchor" href="#readable-readabledidread"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablereadabledidread" target="_blank" rel="noopener noreferrer">readable.readableDidRead</a></span></a></h5><p>Node.js ä¸­çš„ <code>readable.readableDidRead</code> å±æ€§æ˜¯ä¸ streamï¼ˆæµï¼‰ç›¸å…³çš„ä¸€ä¸ªç‰¹æ€§ã€‚åœ¨è§£é‡Šè¿™ä¸ªå±æ€§ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€äº›åŸºç¡€çŸ¥è¯†ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-stream-1" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-stream-1"><span>ä»€ä¹ˆæ˜¯ Streamï¼Ÿ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œstream æ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œå°¤å…¶ç”¨äºå¤„ç†å¤§é‡æ•°æ®ã€‚æ¯”å¦‚è¯»å–æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰åœºæ™¯ã€‚ä½¿ç”¨ stream å¯ä»¥è¾¹è¯»è¾¹å¤„ç†æ•°æ®ï¼Œè€Œä¸å¿…ç­‰å¾…æ‰€æœ‰æ•°æ®éƒ½åŠ è½½å®Œæ¯•ï¼Œè¿™æ ·åšå¯ä»¥æé«˜æ•ˆç‡ï¼Œå‡å°‘å†…å­˜çš„ä½¿ç”¨ã€‚</p><p>Stream ä¸»è¦æœ‰å››ç§ç±»å‹ï¼š</p><ul><li><strong>Readable</strong>ï¼šåªè¯»æµï¼Œç”¨äºè¯»å–æ•°æ®ï¼ˆä¾‹å¦‚ä»æ–‡ä»¶è¯»å–æ•°æ®ï¼‰ã€‚</li><li><strong>Writable</strong>ï¼šåªå†™æµï¼Œç”¨äºå†™å…¥æ•°æ®ï¼ˆä¾‹å¦‚å°†æ•°æ®å†™å…¥æ–‡ä»¶ï¼‰ã€‚</li><li><strong>Duplex</strong>ï¼šå¯è¯»å†™æµï¼Œæ—¢å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™ï¼ˆä¾‹å¦‚ TCP socketsï¼‰ã€‚</li><li><strong>Transform</strong>ï¼šè½¬æ¢æµï¼Œæ˜¯ Duplex æµçš„ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œå¯ä»¥åœ¨è¯»å†™æ•°æ®æ—¶ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®ï¼ˆä¾‹å¦‚å‹ç¼©æ•°æ®ï¼‰ã€‚</li></ul><h3 id="readable-readabledidread-è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#readable-readabledidread-è¯¦è§£"><span><code>readable.readableDidRead</code> è¯¦è§£</span></a></h3><p>åœ¨ Node.js çš„ Readable æµä¸­ï¼Œ<code>readable.readableDidRead</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼å±æ€§ã€‚å®ƒè¡¨æ˜è‡ªä¸Šæ¬¡ <code>&#39;readable&#39;</code> äº‹ä»¶è§¦å‘åæ˜¯å¦è°ƒç”¨äº† <code>read()</code> æ–¹æ³•è¯»å–æ•°æ®ã€‚å¦‚æœä½ è°ƒç”¨è¿‡ <code>read()</code> æ–¹æ³•è·å–æ•°æ®ï¼Œåˆ™æ­¤å±æ€§ä¼šè¢«è®¾ç½®ä¸º <code>true</code>ï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¿æŒä¸º <code>false</code>ã€‚</p><p>è¿™ä¸ªå±æ€§çš„ä¸»è¦ç”¨é€”æ˜¯è®©å¼€å‘è€…çŸ¥é“è‡ª <code>&#39;readable&#39;</code> äº‹ä»¶è§¦å‘åæµçš„çŠ¶æ€ï¼Œæ˜¯å¦æœ‰æ•°æ®è¢«æ¶ˆè´¹ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-8" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-8"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å½“ä½ åœ¨å¤„ç†ä¸€ä¸ªå¯è¯»æµæ—¶ï¼Œå¯èƒ½ä¼šæƒ³çŸ¥é“è‡ªä¸Šæ¬¡ <code>&#39;readable&#39;</code> äº‹ä»¶å‘ç”Ÿä¹‹åï¼Œæµä¸­çš„æ•°æ®æ˜¯å¦å·²ç»è¢«æŸéƒ¨åˆ†ä»£ç è¯»å–äº†ã€‚è¿™åœ¨å¤„ç†å¤šä¸ªç›‘å¬å™¨å’Œå¤æ‚é€»è¾‘æ—¶å°¤å…¶æœ‰ç”¨ã€‚</p><p>å‡è®¾æœ‰ä¸€ä¸ªæ–‡ä»¶è¯»å–æµï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ£€æŸ¥è‡ªä¸Šæ¬¡ &#39;readable&#39; äº‹ä»¶åæ˜¯å¦è¯»å–äº†æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableDidRead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ•°æ®å¯è¯»ï¼Œä½†è¿˜æœªè¢«è¯»å–ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`è¯»å–çš„æ•°æ®: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ•°æ®å·²è¢«è¯»å–ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Node.js çš„æ–‡ä»¶ç³»ç»Ÿæ¨¡å—ï¼ˆ<code>fs</code>ï¼‰åˆ›å»ºäº†ä¸€ä¸ªå¯è¯»æµæ¥è¯»å–ä¸€ä¸ªæ–‡ä»¶ã€‚æˆ‘ä»¬åˆ©ç”¨ <code>&#39;readable&#39;</code> äº‹ä»¶æ¥æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„æ•°æ®å¯ä»¥è¯»å–ã€‚åˆ©ç”¨ <code>readable.readableDidRead</code> å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“è‡ªä¸Šæ¬¡ <code>&#39;readable&#39;</code> äº‹ä»¶åï¼Œæ˜¯å¦æœ‰ä»£ç è¯»å–äº†æ•°æ®ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥æ ¹æ®æƒ…å†µåšå‡ºç›¸åº”çš„å¤„ç†ï¼Œæ¯”å¦‚å¦‚æœæ²¡æœ‰æ•°æ®è¢«è¯»å–ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ <code>read()</code> æ–¹æ³•æ¥è¯»å–æ•°æ®ã€‚</p><p>è¿™ä¸ªå±æ€§æ˜¯ Node.js æµæœºåˆ¶çš„ç»†èŠ‚ä¹‹ä¸€ï¼Œäº†è§£å®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°æ§åˆ¶å’Œä¼˜åŒ–æ•°æ®æµçš„å¤„ç†é€»è¾‘ã€‚</p><h5 id="readable-readableencoding" tabindex="-1"><a class="header-anchor" href="#readable-readableencoding"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablereadableencoding" target="_blank" rel="noopener noreferrer">readable.readableEncoding</a></span></a></h5><p>å½“ä½ ä½¿ç”¨ Node.js å¤„ç†æ•°æ®æµæ—¶ï¼Œäº†è§£<code>readable.readableEncoding</code>å±æ€§ä¼šéå¸¸æœ‰å¸®åŠ©ã€‚æˆ‘å°†é€šè¿‡ä¸€ç³»åˆ—ç®€å•çš„ä¾‹å­æ¥è§£é‡Šè¿™ä¸ªæ¦‚å¿µã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-readable-readableencoding" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-readable-readableencoding"><span>ä»€ä¹ˆæ˜¯ <code>readable.readableEncoding</code>?</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamsï¼‰æ˜¯å¤„ç†æ•°æ®çš„ä¸»è¦æ–¹å¼ï¼Œæ¯”å¦‚è¯»å–æˆ–å†™å…¥æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ã€‚<code>readable.readableEncoding</code>æ˜¯ä¸€ä¸ªç‰¹å®šäºå¯è¯»æµï¼ˆreadable streamsï¼‰çš„å±æ€§ã€‚å®ƒè¡¨ç¤ºæµå½“å‰ä½¿ç”¨çš„å­—ç¬¦ç¼–ç ã€‚å¦‚æœæµæ˜¯ä»¥å­—ç¬¦ä¸²æ¨¡å¼å·¥ä½œçš„ï¼Œé‚£ä¹ˆè¿™ä¸ªå±æ€§ä¼šæ˜¾ç¤ºä½¿ç”¨çš„å­—ç¬¦ç¼–ç ï¼ˆå¦‚<code>&#39;utf8&#39;</code>, <code>&#39;ascii&#39;</code>, <code>&#39;base64&#39;</code>ç­‰ï¼‰ï¼Œå¦‚æœæµæ˜¯ä»¥ Bufferï¼ˆäºŒè¿›åˆ¶æ•°æ®å—ï¼‰æ¨¡å¼æ“ä½œçš„ï¼Œåˆ™æ­¤å±æ€§ä¸º<code>null</code>ã€‚</p><h3 id="ä¸ºä»€ä¹ˆé‡è¦" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆé‡è¦"><span>ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ</span></a></h3><p>äº†è§£æµæ­£åœ¨ä½¿ç”¨å“ªç§ç¼–ç å¯¹äºæ­£ç¡®è§£æå’Œå¤„ç†æ•°æ®è‡³å…³é‡è¦ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ ä»ä¸€ä¸ªæ–‡ä»¶è¯»å–æ–‡æœ¬æ•°æ®ï¼ŒçŸ¥é“ç¼–ç å¯ä»¥å¸®åŠ©ä½ å°†è¯»å–çš„äºŒè¿›åˆ¶æ•°æ®è½¬æ¢ä¸ºäººç±»å¯è¯»çš„æ ¼å¼ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-11" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-11"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-è¯»å–æ–‡ä»¶å†…å®¹" tabindex="-1"><a class="header-anchor" href="#_1-è¯»å–æ–‡ä»¶å†…å®¹"><span>1. è¯»å–æ–‡ä»¶å†…å®¹</span></a></h4><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶<code>hello.txt</code>ï¼Œå…¶å†…å®¹ä¸º<code>&quot;Hello, World!&quot;</code>ï¼Œå¹¶ä¸”è¯¥æ–‡ä»¶æ˜¯ç”¨<code>utf8</code>ç¼–ç ä¿å­˜çš„ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥è¯»å–æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: &#39;utf8&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†<code>encoding</code>é€‰é¡¹ä¸º<code>&#39;utf8&#39;</code>ï¼Œè¿™æ„å‘³ç€ Node.js ä¼šè‡ªåŠ¨å¤„ç†ç¼–ç ï¼Œè€Œ<code>readableStream.readableEncoding</code> å±æ€§ç¡®è®¤äº†è¿™ä¸€ç‚¹ã€‚å› æ­¤ï¼Œæ¯æ¬¡è§¦å‘<code>data</code>äº‹ä»¶æ—¶æ¥æ”¶åˆ°çš„<code>chunk</code>éƒ½æ˜¯å·²ç»è§£ç çš„æ–‡æœ¬å­—ç¬¦ä¸²ã€‚</p><h4 id="_2-ç½‘ç»œé€šä¿¡-1" tabindex="-1"><a class="header-anchor" href="#_2-ç½‘ç»œé€šä¿¡-1"><span>2. ç½‘ç»œé€šä¿¡</span></a></h4><p>è€ƒè™‘ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ï¼Œå®ƒå‘é€æ¬¢è¿æ¶ˆæ¯ç»™è¿æ¥çš„å®¢æˆ·ç«¯ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain; charset=utf-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™å°†æ˜¯ nullï¼Œå› ä¸ºè¯·æ±‚æµé»˜è®¤ä¸ä¼šè®¾ç½® encodingã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ¬¢è¿è®¿é—®æˆ‘ä»¬çš„ç½‘ç«™ï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running at http://localhost:3000/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¯·æ±‚å¯¹è±¡<code>req</code>æ˜¯ä¸€ä¸ªå¯è¯»æµã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœä½ æ²¡æœ‰æ˜¾å¼åœ°ä¸ºè¯·æ±‚æµè®¾ç½®ç¼–ç ï¼Œ<code>req.readableEncoding</code>å°†ä¼šæ˜¯<code>null</code>ï¼Œå› ä¸º HTTP è¯·æ±‚æ•°æ®é»˜è®¤ä»¥ Buffer å½¢å¼æ¥æ”¶ã€‚å“åº”å¯¹è±¡<code>res</code>è™½ç„¶ä¹Ÿæ˜¯ä¸€ä¸ªæµå®ä¾‹ï¼Œä½†å®ƒæ˜¯å¯å†™æµï¼Œæ‰€ä»¥è¿™é‡Œä¸é€‚ç”¨<code>readableEncoding</code>å±æ€§ã€‚</p><h3 id="æ€»ç»“-15" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-15"><span>æ€»ç»“</span></a></h3><p>ç†è§£<code>readable.readableEncoding</code>å±æ€§å¸®åŠ©ä½ æ›´å¥½åœ°æ§åˆ¶å’Œæ“ä½œ Node.js ä¸­çš„æ•°æ®æµã€‚å®ƒè®©ä½ çŸ¥é“æµä¸­çš„æ•°æ®ä»¥ä½•ç§å½¢å¼å­˜åœ¨ï¼Œæ˜¯åŸå§‹çš„ Buffer è¿˜æ˜¯å·²ç»æ ¹æ®æŒ‡å®šçš„ç¼–ç è½¬æ¢æˆäº†å­—ç¬¦ä¸²ã€‚è¿™åœ¨å¤„ç†æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰åœºæ™¯ä¸­å°¤ä¸ºé‡è¦ã€‚</p><h5 id="readable-readableended" tabindex="-1"><a class="header-anchor" href="#readable-readableended"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablereadableended" target="_blank" rel="noopener noreferrer">readable.readableEnded</a></span></a></h5><p>å½“ä½ å¼€å§‹ä½¿ç”¨ Node.jsï¼Œå°¤å…¶æ˜¯å¤„ç†ç½‘ç»œåº”ç”¨æˆ–æ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œä½ ä¼šå‘ç°â€œæµï¼ˆStreamsï¼‰â€æ˜¯ä¸€ä¸ªå¸¸è§çš„æ¦‚å¿µã€‚æµæ˜¯ä¸€ç§æ•°æ®çš„ä¼ è¾“æ–¹å¼ï¼Œå¯ä»¥è®©ä½ é€ç‰‡æ®µåœ°å¤„ç†æ•°æ®ï¼Œè€Œä¸æ˜¯ç­‰å¾…æ‰€æœ‰æ•°æ®éƒ½å¯ç”¨ã€‚è¿™å¯¹äºå¤„ç†å¤§é‡æ•°æ®ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå‡å°‘äº†å†…å­˜å ç”¨ï¼Œå¹¶ä¸”å¯ä»¥è®©ç”¨æˆ·ä½“éªŒåˆ°æ›´å¿«çš„å“åº”æ—¶é—´ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>readable.readableEnded</code>å±æ€§æ˜¯é’ˆå¯¹å¯è¯»æµçš„ä¸€ä¸ªå±æ€§ã€‚ç®€å•æ¥è¯´ï¼Œ<code>readable.readableEnded</code>ä¼šåœ¨æµçš„æœ«å°¾è¢«è¯»å–å®Œæ¯•åè¿”å›<code>true</code>ï¼Œå¦‚æœæµè¿˜æ²¡æœ‰ç»“æŸï¼Œå°±è¿”å›<code>false</code>ã€‚</p><h3 id="å®é™…ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#å®é™…ä½¿ç”¨åœºæ™¯"><span>å®é™…ä½¿ç”¨åœºæ™¯</span></a></h3><h4 id="æ–‡ä»¶è¯»å–-1" tabindex="-1"><a class="header-anchor" href="#æ–‡ä»¶è¯»å–-1"><span>æ–‡ä»¶è¯»å–</span></a></h4><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦ä»ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚ä½¿ç”¨ä¼ ç»Ÿçš„æ–¹æ³•ï¼Œå¯èƒ½éœ€è¦å…ˆå°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥å†…å­˜ä¸­ï¼Œç„¶åå†å¼€å§‹å¤„ç†æ•°æ®ã€‚å¯¹äºéå¸¸å¤§çš„æ–‡ä»¶ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºè¿è¡Œç¼“æ…¢æˆ–ç”šè‡³å´©æºƒã€‚ä½†æ˜¯ï¼Œé€šè¿‡ä½¿ç”¨æµï¼Œä½ å¯ä»¥é€æ­¥åœ°è¯»å–æ–‡ä»¶å†…å®¹ï¼Œæ¯æ¬¡åªå¤„ç†ä¸€å°å—æ•°æ®ã€‚</p><p>ä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/large/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯»å–å®Œæˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†æ–‡ä»¶çš„ä¸€éƒ¨åˆ†æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å¤„ç†æ•°æ®å—&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableEnded</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨ &#39;end&#39; äº‹ä»¶è§¦å‘ä¹‹å‰ï¼Œè¿™é‡Œå°†ä¼šæ‰“å° false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†æ–‡ä»¶ç³»ç»Ÿ(<code>fs</code>)æ¨¡å—åˆ›å»ºäº†ä¸€ä¸ªè¯»å–æµæ¥è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶ã€‚æˆ‘ä»¬ç›‘å¬äº†æ•°æ®(<code>data</code>)äº‹ä»¶æ¥å¤„ç†æ–‡ä»¶çš„æ¯ä¸€å°å—æ•°æ®ï¼Œå¹¶ä¸”ç›‘å¬äº†ç»“æŸ(<code>end</code>)äº‹ä»¶æ¥çŸ¥é“æ–‡ä»¶æ˜¯å¦å·²ç»è¯»å–å®Œæ¯•ã€‚é€šè¿‡<code>readStream.readableEnded</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥æµæ˜¯å¦å·²ç»ç»“æŸã€‚</p><h4 id="http-è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#http-è¯·æ±‚"><span>HTTP è¯·æ±‚</span></a></h4><p>å¦ä¸€ä¸ªå¸¸è§çš„ä¾‹å­æ˜¯åœ¨å¤„ç† HTTP è¯·æ±‚æ—¶ä½¿ç”¨æµã€‚å½“ä½ çš„ Node.js æœåŠ¡å™¨æ”¶åˆ°ä¸€ä¸ªå¤§çš„ POST è¯·æ±‚æ—¶ï¼Œæ¯”å¦‚ä¸Šä¼ çš„æ–‡ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨æµæ¥é€æ­¥å¤„ç†è¿™äº›æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ¥æ”¶åˆ°æ•°æ®å—&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableEnded</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// trueï¼Œå› ä¸ºè¯·æ±‚ä½“å·²ç»è¢«å®Œå…¨æ¥æ”¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ•°æ®æ¥æ”¶å®Œæ¯•&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ POST è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨é€šè¿‡ç›‘å¬<code>data</code>äº‹ä»¶é€æ­¥æ¥æ”¶è¯·æ±‚ä½“çš„å†…å®¹ã€‚å½“æ‰€æœ‰æ•°æ®éƒ½æ¥æ”¶å®Œæ¯•æ—¶ï¼Œ<code>end</code>äº‹ä»¶è¢«è§¦å‘ï¼Œå¹¶ä¸”æ­¤æ—¶<code>req.readableEnded</code>å±æ€§å°†è¿”å›<code>true</code>ï¼Œè¡¨ç¤ºè¯·æ±‚ä½“å·²ç»è¢«å®Œå…¨æ¥æ”¶ã€‚</p><h3 id="æ€»ç»“-16" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-16"><span>æ€»ç»“</span></a></h3><p><code>readable.readableEnded</code>æ˜¯ Node.js ä¸­å¯è¯»æµå¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒæä¾›äº†ä¸€ç§ç®€ä¾¿çš„æ–¹å¼æ¥æ£€æµ‹æµæ˜¯å¦å·²ç»ç»“æŸã€‚è¿™åœ¨å¤„ç†å¤§é‡æ•°æ®ï¼Œç‰¹åˆ«æ˜¯æ¥è‡ªæ–‡ä»¶ç³»ç»Ÿæˆ–ç½‘ç»œè¯·æ±‚çš„æ•°æ®æ—¶éå¸¸æœ‰ç”¨ã€‚é€šè¿‡é€æ­¥è¯»å–å’Œå¤„ç†æ•°æ®ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥æ›´é«˜æ•ˆåœ°ä½¿ç”¨èµ„æºï¼Œæä¾›æ›´å¥½çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚</p><h5 id="readable-errored" tabindex="-1"><a class="header-anchor" href="#readable-errored"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readableerrored" target="_blank" rel="noopener noreferrer">readable.errored</a></span></a></h5><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚å®ƒç‰¹åˆ«é€‚åˆæ„å»ºå¿«é€Ÿçš„ã€å¯æ‰©å±•çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚Node.js ä½¿ç”¨äº‹ä»¶é©±åŠ¨ã€éé˜»å¡ I/O æ¨¡å‹ï¼Œä½¿å…¶è½»é‡åˆé«˜æ•ˆã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamsï¼‰æ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæµå°±åƒæ˜¯æ°´ç®¡ï¼Œæ•°æ®å°±åƒæ˜¯æµç»æ°´ç®¡çš„æ°´ã€‚è¿™ç§æ–¹å¼èƒ½å¤Ÿæœ‰æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®ï¼Œå› ä¸ºä½ ä¸éœ€è¦ç­‰å¾…æ‰€æœ‰æ•°æ®éƒ½å‡†å¤‡å¥½äº†å†å¼€å§‹å¤„ç†ï¼Œæ•°æ®ç‰‡æ®µå¯ä»¥ä¸€è¾¹åŠ è½½ä¸€è¾¹è¢«å¤„ç†ã€‚</p><h3 id="readable-errored-1" tabindex="-1"><a class="header-anchor" href="#readable-errored-1"><span><code>readable.errored</code></span></a></h3><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>readable.errored</code> å±æ€§æ˜¯ä¸æµç›¸å…³çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå…·ä½“æ¥è¯´ï¼Œå±äºå¯è¯»æµï¼ˆReadable Streamsï¼‰çš„èŒƒç•´ã€‚è¿™ä¸ªå±æ€§çš„ä½œç”¨æ˜¯å¸®åŠ©ä½ ç¡®å®šæµæ˜¯å¦é‡åˆ°äº†é”™è¯¯ï¼Œå¹¶ä¸”ä¿æŒè¯¥é”™è¯¯çŠ¶æ€ã€‚å¦‚æœæµæ²¡æœ‰é”™è¯¯ï¼Œè¯¥å±æ€§çš„å€¼å°†ä¼šæ˜¯ <code>null</code>ï¼Œæ„å‘³ç€ä¸€åˆ‡æ­£å¸¸ï¼›å¦‚æœæœ‰é”™è¯¯å‘ç”Ÿï¼Œå®ƒä¼šä¿å­˜é‚£ä¸ªé”™è¯¯å¯¹è±¡ï¼Œè®©ä½ èƒ½å¤Ÿäº†è§£å‡ºäº†ä»€ä¹ˆé—®é¢˜ã€‚</p><h4 id="å®é™…è¿ç”¨ä¾‹å­-12" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-12"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h4><ol><li><p><strong>æ–‡ä»¶è¯»å–</strong>ï¼šå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œéœ€è¦ä»ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚ä½¿ç”¨ Node.js çš„æµï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥è¯»å–è¿™ä¸ªæ–‡ä»¶ã€‚åœ¨è¯»å–è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ–‡ä»¶è¢«æ„å¤–åˆ é™¤æˆ–ç£ç›˜æŸåå¯¼è‡´è¯»å–å¤±è´¥ï¼Œ<code>readable.errored</code> å°†ä¼šåŒ…å«è¿™ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œä½ å¯ä»¥æ®æ­¤é€šçŸ¥ç”¨æˆ·æˆ–è€…é‡‡å–å…¶ä»–æªæ–½ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/large/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stream error:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableErrored</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Error happened:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableErrored</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No error, continue processing...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç½‘ç»œè¯·æ±‚</strong>ï¼šå½“ä½ ä½¿ç”¨ Node.js å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„ç½‘ç»œè¯·æ±‚æ—¶ï¼Œå¦‚æœè¯·æ±‚ä½“å¾ˆå¤§ï¼Œä½ å¯ä»¥é€šè¿‡æµæ¥å¤„ç†è¿™äº›æ•°æ®ã€‚å¦‚æœåœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­é‡åˆ°ç½‘ç»œæ³¢åŠ¨æˆ–å…¶ä»–åŸå› å¯¼è‡´è¯·æ±‚å¤±è´¥ï¼Œ<code>readable.errored</code> å±æ€§ä¼šä¿å­˜è¿™äº›é”™è¯¯ä¿¡æ¯ï¼Œæ–¹ä¾¿ä½ è¿›è¡Œé”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableErrored</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server Error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Request error:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableErrored</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // æ­£å¸¸å¤„ç†è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="æ€»ç»“-17" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-17"><span>æ€»ç»“</span></a></h3><p><code>readable.errored</code> æ˜¯ Node.js å¯è¯»æµä¸­ç”¨æ¥æ ‡è¯†å’Œå­˜å‚¨æµé”™è¯¯çŠ¶æ€çš„å±æ€§ã€‚åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–è€…ç½‘ç»œè¯·æ±‚æ—¶ï¼Œè¿™ä¸ªå±æ€§è®©é”™è¯¯å¤„ç†å˜å¾—æ›´åŠ ç›´æ¥å’Œé«˜æ•ˆï¼Œæœ‰åŠ©äºæå‡åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒã€‚</p><h5 id="readable-readableflowing" tabindex="-1"><a class="header-anchor" href="#readable-readableflowing"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablereadableflowing" target="_blank" rel="noopener noreferrer">readable.readableFlowing</a></span></a></h5><p>ç†è§£ <code>readable.readableFlowing</code> å±æ€§ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ Node.js ä¸­çš„æµï¼ˆStreamsï¼‰æ¦‚å¿µã€‚åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†è¯»å–æˆ–å†™å…¥åºåˆ—åŒ–æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚æ¯”å¦‚è¯´ï¼Œå½“ä½ ä»æ–‡ä»¶è¯»å–æ•°æ®æˆ–è€…å‘æ–‡ä»¶å†™å…¥æ•°æ®æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨æµæ¥è¿›è¡Œã€‚</p><p>Node.js é‡Œçš„æµåˆ†ä¸ºå››ç§åŸºæœ¬ç±»å‹ï¼š</p><ol><li><strong>Readable</strong> - ç”¨äºè¯»å–æ•°æ®çš„æµï¼ˆä¾‹å¦‚ä»æ–‡ä»¶è¯»å–ï¼‰ã€‚</li><li><strong>Writable</strong> - ç”¨äºå†™å…¥æ•°æ®çš„æµï¼ˆä¾‹å¦‚å†™å…¥åˆ°æ–‡ä»¶ï¼‰ã€‚</li><li><strong>Duplex</strong> - å¯è¯»ä¹Ÿå¯å†™çš„æµï¼ˆä¾‹å¦‚ TCP å¥—æ¥å­—ï¼‰ã€‚</li><li><strong>Transform</strong> - åœ¨è¯»å†™è¿‡ç¨‹ä¸­å¯ä»¥ä¿®æ”¹å’Œå˜æ¢æ•°æ®çš„åŒå·¥æµã€‚</li></ol><p>åœ¨è¿™ä¸ªèŒƒå›´å†…ï¼Œ<code>readable.readableFlowing</code> æ˜¯ä¸€ä¸ªç‰¹å®šäº Readable æµçš„å±æ€§ã€‚å®ƒæ˜¯ä¸€ä¸ªå¯é€‰çš„å¸ƒå°”å€¼ï¼ˆBooleanï¼‰ï¼Œç”¨äºæ ‡è¯†æµçš„çŠ¶æ€ï¼š</p><ul><li>å¦‚æœè®¾ç½®ä¸º <code>null</code>ï¼Œè¡¨ç¤ºæ²¡æœ‰è®¾å®šæµåŠ¨æ¨¡å¼ï¼ˆflowingï¼‰æˆ–æš‚åœæ¨¡å¼ï¼ˆpausedï¼‰ã€‚è¿™æ˜¯é»˜è®¤çŠ¶æ€ã€‚</li><li>å¦‚æœè®¾ç½®ä¸º <code>true</code>ï¼Œåˆ™è¡¨ç¤ºæµå¤„äºæµåŠ¨æ¨¡å¼ã€‚</li><li>å¦‚æœè®¾ç½®ä¸º <code>false</code>ï¼Œåˆ™è¡¨ç¤ºæµå¤„äºæš‚åœæ¨¡å¼ã€‚</li></ul><p>é‚£ä¹ˆï¼ŒæµåŠ¨æ¨¡å¼å’Œæš‚åœæ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><ul><li><p><strong>æµåŠ¨æ¨¡å¼ï¼ˆFlowingï¼‰</strong>: åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ•°æ®è‡ªåŠ¨ä»åº•å±‚ç³»ç»Ÿè¯»å–ï¼Œå¹¶é€šè¿‡ EventEmitter æ¥å£çš„äº‹ä»¶å°½å¯èƒ½å¿«åœ°è¢«æä¾›ç»™åº”ç”¨ç¨‹åºã€‚ç®€å•æ¥è¯´ï¼Œä½ ä¸éœ€è¦æ˜¾å¼è°ƒç”¨ <code>.read()</code> æ–¹æ³•ï¼Œæ•°æ®ä¼šè‡ªåŠ¨æµåŠ¨å¹¶å¯ä»¥é€šè¿‡ç›‘å¬ <code>data</code> äº‹ä»¶æ¥è¯»å–ã€‚</p></li><li><p><strong>æš‚åœæ¨¡å¼ï¼ˆPausedï¼‰</strong>: è¿™ç§æ¨¡å¼ä¸‹ï¼Œä½ éœ€è¦æ˜¾å¼è°ƒç”¨ <code>.read()</code> æ–¹æ³•æ¥ä»æµä¸­è¯»å–æ•°æ®å—ã€‚</p></li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-9" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-9"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>è®©æˆ‘ä»¬ä¸¾ä¸€ä¸ªå®é™…çš„ä¾‹å­æ¥è¯´æ˜è¿™ä¸€ç‚¹ã€‚</p><p>æƒ³è±¡ä½ æ­£åœ¨ä»ä¸€ä¸ªéå¸¸å¤§çš„æ—¥å¿—æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œä½ å¯èƒ½åªå¯¹æ–‡ä»¶ä¸­çš„æŸäº›éƒ¨åˆ†æ„Ÿå…´è¶£ï¼Œè€Œä¸å¸Œæœ›ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶è½½å…¥å†…å­˜ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/large/log/file.log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  highWaterMark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®æ¯æ¬¡è¯»å–çš„æœ€å¤§å­—èŠ‚æ•°ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é»˜è®¤æƒ…å†µä¸‹ï¼ŒreadableFlowing ä¸º nullï¼Œè¡¨ç¤ºæµæœªå¤„äºæµåŠ¨æ¨¡å¼ä¹Ÿæœªåœ¨æš‚åœæ¨¡å¼ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableFlowing</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼šnull</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ &#39;data&#39; äº‹ä»¶å°†æµåˆ‡æ¢åˆ°æµåŠ¨æ¨¡å¼ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†æ•°æ®...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableFlowing</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼štrueï¼Œç°åœ¨æµå¤„äºæµåŠ¨æ¨¡å¼ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœæ­¢æ•°æ®çš„æµåŠ¨å¯ä»¥é€šè¿‡ pause() æ–¹æ³•ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pause</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableFlowing</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼šfalseï¼Œæµç°åœ¨å¤„äºæš‚åœæ¨¡å¼ã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯ä»¥é€šè¿‡ resume() æ–¹æ³•æ¢å¤æ•°æ®æµåŠ¨ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå¯è¯»æµæ¥è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶ã€‚æˆ‘ä»¬é€šè¿‡ç›‘å¬ <code>data</code> äº‹ä»¶ä½¿æµè¿›å…¥æµåŠ¨æ¨¡å¼ï¼Œåœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œæ•°æ®ä¼šè‡ªåŠ¨è¯»å–å¹¶æä¾›ç»™æˆ‘ä»¬çš„å›è°ƒå‡½æ•°å¤„ç†ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å±•ç¤ºäº†å¦‚ä½•æ£€æŸ¥ <code>readableFlowing</code> çš„çŠ¶æ€ä»¥åŠå¦‚ä½•æ§åˆ¶æµçš„æš‚åœå’Œæ¢å¤ã€‚</p><p>ç†è§£ <code>readable.readableFlowing</code> å±æ€§åŠå…¶ç›¸å…³çš„æµæ§åˆ¶æœºåˆ¶ï¼Œå¯¹äºæœ‰æ•ˆç®¡ç† Node.js ä¸­çš„æ•°æ®æµè‡³å…³é‡è¦ï¼Œç‰¹åˆ«æ˜¯å½“å¤„ç†å¤§é‡æ•°æ®æˆ–éœ€è¦ä¼˜åŒ–æ€§èƒ½ä¸èµ„æºæ¶ˆè€—æ—¶ã€‚</p><h5 id="readable-readablehighwatermark" tabindex="-1"><a class="header-anchor" href="#readable-readablehighwatermark"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablereadablehighwatermark" target="_blank" rel="noopener noreferrer">readable.readableHighWaterMark</a></span></a></h5><p>åœ¨è§£é‡Š <code>readable.readableHighWaterMark</code> ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ä¸€äº›åŸºç¡€æ¦‚å¿µï¼Œç‰¹åˆ«æ˜¯å…³äº Node.js ä¸­çš„æµï¼ˆStreamsï¼‰å’Œç¼“å†²ï¼ˆBufferingï¼‰ã€‚</p><h3 id="åŸºç¡€æ¦‚å¿µ-2" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€æ¦‚å¿µ-2"><span>åŸºç¡€æ¦‚å¿µ</span></a></h3><p><strong>æµï¼ˆStreamsï¼‰</strong>ï¼šåœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†æ•°æ®ï¼ˆå¦‚ä»æ–‡ä»¶è¯»å–æˆ–å‘æ–‡ä»¶å†™å…¥ï¼‰çš„æŠ½è±¡æ¦‚å¿µã€‚æµå¯ä»¥è®©ä½ ä»¥è¿ç»­çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚æ¯”å¦‚ï¼Œå½“ä½ åœ¨çœ‹è§†é¢‘æ—¶ï¼Œä½ ä¸éœ€è¦ç­‰å¾…æ•´ä¸ªæ–‡ä»¶ä¸‹è½½å®Œæ¯•ï¼Œè§†é¢‘ä¼šè¾¹ä¸‹è½½è¾¹æ’­æ”¾ï¼Œè¿™å°±æ˜¯æµçš„ä½“ç°ã€‚</p><p><strong>ç¼“å†²ï¼ˆBufferingï¼‰</strong>ï¼šç¼“å†²æ˜¯ä¸´æ—¶å­˜å‚¨æ•°æ®çš„æ–¹æ³•ï¼Œç›´åˆ°æœ‰è¶³å¤Ÿçš„æ•°æ®è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†ã€‚æƒ³è±¡ä½ æ­£åœ¨ç”¨æ°´å£¶æ¥æ°´ï¼Œä½†æ˜¯æ°´æµå¾ˆå°ï¼Œä½ ä¸å¾—ä¸ç­‰å£¶é‡Œç§¯æ”’è¶³å¤Ÿçš„æ°´åæ‰èƒ½ä½¿ç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±åƒç¼“å†²ã€‚</p><h3 id="readablehighwatermark" tabindex="-1"><a class="header-anchor" href="#readablehighwatermark"><span>readableHighWaterMark</span></a></h3><p>åœ¨ Node.js çš„æµæ¨¡å—ä¸­ï¼Œ<code>readableHighWaterMark</code> æ˜¯ä¸€ä¸ªä¸ Readable æµç›¸å…³çš„é€‰é¡¹ã€‚å®ƒå®šä¹‰äº†å†…éƒ¨ç¼“å†²åŒºæœ€å¤šå¯ä»¥ç§¯ç´¯çš„å­—èŠ‚çš„æ•°é‡ï¼Œåœ¨è¿™ä¸ªé˜ˆå€¼è¾¾åˆ°ä¹‹åï¼Œæµä¼šåœæ­¢ä»åº•å±‚èµ„æºè¯»å–æ›´å¤šçš„æ•°æ®ã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯-1" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯-1"><span>ä½¿ç”¨åœºæ™¯</span></a></h3><p><strong>ä¾‹å­ 1ï¼šæ–‡ä»¶è¯»å–</strong></p><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªåº”ç”¨ï¼Œéœ€è¦ä»ä¸€ä¸ªéå¸¸å¤§çš„æ—¥å¿—æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚ä½¿ç”¨ Readable æµå¹¶è®¾ç½®åˆé€‚çš„ <code>readableHighWaterMark</code> å¯ä»¥æœ‰æ•ˆåœ°æ§åˆ¶å†…å­˜çš„ä½¿ç”¨ï¼Œé¿å…ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­å¯¼è‡´åº”ç”¨å´©æºƒã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµï¼Œè®¾ç½®é«˜æ°´ä½æ ‡è®°ä¸º 16KBã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hugeLogFile.log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  highWaterMark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">16</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¾‹å­ 2ï¼šæ•°æ®ä¼ è¾“</strong></p><p>è€ƒè™‘å¦ä¸€ä¸ªä¾‹å­ï¼Œä½ éœ€è¦è®¾è®¡ä¸€ä¸ªæœåŠ¡æ¥å¤„ç†å›¾åƒæˆ–è§†é¢‘æ–‡ä»¶çš„ä¸Šä¼ ã€‚é€šè¿‡è°ƒæ•´ <code>readableHighWaterMark</code>ï¼Œä½ å¯ä»¥æ§åˆ¶åœ¨ä»»æ„æ—¶åˆ»å†…å­˜ä¸­ä¿ç•™çš„æ•°æ®é‡ï¼Œè¿›è€Œä¼˜åŒ–åº”ç”¨çš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">method</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;POST&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fileStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;uploadedFile&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      highWaterMark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾å®šä¸º 1MBã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fileStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;File uploaded successfully&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ€»ç»“-18" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-18"><span>æ€»ç»“</span></a></h3><ul><li><code>readableHighWaterMark</code> æ˜¯å®šä¹‰åœ¨ Readable æµä¸­çš„ä¸€ä¸ªå‚æ•°ï¼Œç”¨æ¥æŒ‡å®šæµå†…éƒ¨ç¼“å†²åŒºçš„å¤§å°ä¸Šé™ã€‚</li><li>å®ƒå¸®åŠ©æ§åˆ¶å†…å­˜çš„ä½¿ç”¨ï¼Œæå‡äº†åº”ç”¨å¤„ç†å¤§é‡æ•°æ®åœºæ™¯æ—¶çš„æ€§èƒ½å’Œæ•ˆç‡ã€‚</li><li>é€šè¿‡åˆç†è®¾ç½®è¿™ä¸ªå‚æ•°ï¼Œå¯ä»¥æ ¹æ®å®é™…åº”ç”¨çš„éœ€æ±‚å¹³è¡¡å†…å­˜ä½¿ç”¨å’Œæ•°æ®å¤„ç†é€Ÿåº¦ã€‚</li></ul><h5 id="readable-readablelength" tabindex="-1"><a class="header-anchor" href="#readable-readablelength"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablereadablelength" target="_blank" rel="noopener noreferrer">readable.readableLength</a></span></a></h5><p>ç†è§£ <code>readable.readableLength</code> å±æ€§ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦çŸ¥é“ Node.js ä¸­çš„æµï¼ˆStreamsï¼‰ã€‚æµæ˜¯ä¸€ç»„æœ‰åºçš„ã€æœ‰èµ·ç‚¹å’Œç»ˆç‚¹çš„æ•°æ®å…ƒç´ ï¼Œè¿™äº›æ•°æ®å…ƒç´ åœ¨è¢«å¤„ç†æ—¶å¹¶ä¸éœ€è¦å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚Node.js çš„æµæ˜¯å¤„ç†å¤§é‡æ•°æ®æˆ–æ—¶é—´è¾ƒé•¿çš„ I/O æ“ä½œçš„ä¸€ç§é«˜æ•ˆæ–¹å¼ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œ<code>readable</code> æ˜¯ä¸€ä¸ªè¡¨ç¤ºå¯è¯»æµçš„å¯¹è±¡ç±»å‹ã€‚å¯è¯»æµå¸¸è§çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬è¯»å–æ–‡ä»¶ã€HTTP å“åº”ç­‰ã€‚</p><h3 id="readable-readablelength-1" tabindex="-1"><a class="header-anchor" href="#readable-readablelength-1"><span>readable.readableLength</span></a></h3><p><code>readable.readableLength</code> å±æ€§è¿”å›ä¸€ä¸ªæ•´æ•°å€¼ï¼Œè¡¨ç¤ºå½“å‰ç¼“å†²åœ¨å¯è¯»æµå¯¹è±¡å†…éƒ¨çš„å­—èŠ‚æ•°ã€‚ç®€å•åœ°è¯´ï¼Œå®ƒå‘Šè¯‰ä½ åœ¨è°ƒç”¨ <code>.read()</code> æ–¹æ³•è·å–æ•°æ®ä¹‹å‰ï¼Œæœ‰å¤šå°‘æ•°æ®ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰æ˜¯å¯ç”¨çš„ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-15" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-15"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-è¯»å–æ–‡ä»¶å†…å®¹-2" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-è¯»å–æ–‡ä»¶å†…å®¹-2"><span>ä¾‹å­ 1ï¼šè¯»å–æ–‡ä»¶å†…å®¹</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œéœ€è¦ä»ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚ä½¿ç”¨ <code>fs.createReadStream</code> åˆ›å»ºä¸€ä¸ªå¯è¯»æµï¼Œå¹¶åˆ©ç”¨ <code>readable.readableLength</code> æ¥ç›‘æ§è¿˜æœ‰å¤šå°‘æ•°æ®æœªè¢«è¯»å–ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæŒ‡å‘æŸä¸ªæ–‡ä»¶çš„å¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ•°æ®äº‹ä»¶å¤„ç†å™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    `There are </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableLength</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data remaining in the buffer.`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No more data.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ¯æ¬¡ <code>&#39;data&#39;</code> äº‹ä»¶è§¦å‘ï¼Œä½ éƒ½ä¼šè·å–åˆ°ä¸€å—æ•°æ®ï¼ˆ<code>chunk</code>ï¼‰ï¼ŒåŒæ—¶å¯ä»¥é€šè¿‡ <code>readableStream.readableLength</code> æŸ¥çœ‹è¿˜æœ‰å¤šå°‘æ•°æ®å¾…è¯»å–ã€‚</p><h4 id="ä¾‹å­-2-æ§åˆ¶æ•°æ®æµé€Ÿåº¦" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-æ§åˆ¶æ•°æ®æµé€Ÿåº¦"><span>ä¾‹å­ 2ï¼šæ§åˆ¶æ•°æ®æµé€Ÿåº¦</span></a></h4><p>å¦‚æœä½ æƒ³ç²¾ç¡®æ§åˆ¶æ•°æ®çš„è¯»å–é€Ÿç‡ï¼Œäº†è§£ç¼“å†²åŒºå†…å¾…è¯»å–çš„æ•°æ®é‡ï¼ˆå³ <code>readable.readableLength</code>ï¼‰æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›æ ¹æ®ç¼“å†²åŒºçš„å¤§å°æš‚åœå’Œæ¢å¤æ•°æ®æµï¼Œé¿å…è¿‡å¤šçš„å†…å­˜ä½¿ç”¨ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./large-file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬å¯è¯»æµçš„ &#39;readable&#39; äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  while</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Read </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¦‚æœç¼“å†²åŒºçš„é•¿åº¦è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œåˆ™æš‚åœè¯»å–</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableLength</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Pausing due to large buffer size.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pause</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // å»¶è¿Ÿåå†ç»§ç»­è¯»å–</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Resuming stream.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ€»ç»“-19" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-19"><span>æ€»ç»“</span></a></h3><p><code>readable.readableLength</code> å±æ€§æä¾›äº†ä¸€ç§æ–¹æ³•æ¥æ£€æŸ¥å¯è¯»æµå†…éƒ¨ç¼“å†²åŒºçš„å¤§å°ï¼Œè¿™å¯¹äºç®¡ç†æ•°æ®æµã€æ§åˆ¶å†…å­˜ä½¿ç”¨ä»¥åŠä¼˜åŒ–æ€§èƒ½æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚é€šè¿‡ä¸Šè¿°ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºæ˜¯ç®€å•åœ°ç›‘æµ‹æ•°æ®é‡æˆ–æ˜¯å®ç°æ›´å¤æ‚çš„æµé‡æ§åˆ¶ï¼Œ<code>readable.readableLength</code> éƒ½æ‰®æ¼”ç€å…³é”®è§’è‰²ã€‚</p><h5 id="readable-readableobjectmode" tabindex="-1"><a class="header-anchor" href="#readable-readableobjectmode"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablereadableobjectmode" target="_blank" rel="noopener noreferrer">readable.readableObjectMode</a></span></a></h5><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„æµï¼ˆStreamsï¼‰ï¼Œæˆ‘ä»¬é€šå¸¸æŒ‡çš„æ˜¯æ•°æ®çš„ä¸€ç§å¤„ç†æ–¹å¼ï¼Œå…¶ä¸­æ•°æ®å¯ä»¥åˆ†æˆå°å—é€æ­¥å¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–è¿ç»­æ•°æ®æºï¼ˆæ¯”å¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰ï¼‰æ—¶éå¸¸æœ‰ç”¨ã€‚</p><p>åœ¨ Node.js çš„æµä¸­ï¼Œ<code>readable.readableObjectMode</code>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å±æ€§ï¼Œå®ƒä¸æµçš„å·¥ä½œæ¨¡å¼ç›¸å…³ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-2" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-2"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNode.js ä¸­çš„å¯è¯»æµï¼ˆReadable streamsï¼‰å·¥ä½œåœ¨<strong>å­—èŠ‚æ¨¡å¼</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬å°†æ•°æ®è§†ä¸ºä¸€ç³»åˆ—çš„å­—èŠ‚ï¼ˆæ¯”å¦‚ Buffer å¯¹è±¡æˆ–å­—ç¬¦ä¸²ï¼‰ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½å¸Œæœ›ä»¥æ›´é«˜å±‚æ¬¡çš„ç»“æ„åŒ–æ•°æ®æ¥å¤„ç†æµï¼Œæ¯”å¦‚å¯¹è±¡ã€‚è¿™å°±æ˜¯<code>objectMode</code>å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚</p><p>å½“ä½ æŠŠä¸€ä¸ªå¯è¯»æµçš„<code>objectMode</code>è®¾ç½®ä¸º<code>true</code>æ—¶ï¼Œè¯¥æµå°±å¯ä»¥æ¥æ”¶ä»»ä½• JavaScript çš„å€¼ä½œä¸ºå…¶æ•°æ®å—ï¼ŒåŒ…æ‹¬å¯¹è±¡ã€‚è¿™å°±æ˜¯æ‰€è°“çš„<strong>å¯¹è±¡æ¨¡å¼</strong>ã€‚</p><h3 id="readable-readableobjectmode-1" tabindex="-1"><a class="header-anchor" href="#readable-readableobjectmode-1"><span><code>readable.readableObjectMode</code></span></a></h3><p><code>readable.readableObjectMode</code>æ˜¯ä¸€ä¸ªåªè¯»å±æ€§ï¼Œå®ƒè¡¨æ˜äº†æµæ˜¯å¦åœ¨å¯¹è±¡æ¨¡å¼ä¸‹è¿è¡Œã€‚å¦‚æœæµè¢«åˆ›å»ºæ—¶ï¼ˆé€šè¿‡æ“ä½œæˆ–è€…é…ç½®ï¼‰è®¾ç½®ä¸ºäº†å¯¹è±¡æ¨¡å¼ï¼Œé‚£ä¹ˆ<code>readable.readableObjectMode</code>ä¼šè¿”å›<code>true</code>ï¼›å¦åˆ™è¿”å›<code>false</code>ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªåœ¨å¯¹è±¡æ¨¡å¼ä¸‹è¿è¡Œçš„æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myObjStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  objectMode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myObjStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableObjectMode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼štrue</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæ ‡å‡†æ¨¡å¼çš„æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myStandardStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myStandardStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableObjectMode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºï¼šfalse</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨"><span>å®é™…åº”ç”¨</span></a></h3><p>å¯¹è±¡æ¨¡å¼åœ¨å¤„ç†éå­—èŠ‚åºåˆ—æ•°æ®æ—¶éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æ­£åœ¨ä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®ï¼Œå¹¶å¸Œæœ›ç›´æ¥ä»¥å¯¹è±¡å½¢å¼å¤„ç†è¿™äº›æ•°æ®ï¼Œè€Œä¸æ˜¯è½¬æ¢ä¸ºå­—ç¬¦ä¸²æˆ– Bufferã€‚</p><p><strong>ä¾‹ 1ï¼šæ•°æ®åº“æŸ¥è¯¢</strong></p><p>å‡è®¾ä½ ä½¿ç”¨ Node.js è®¿é—®æ•°æ®åº“ï¼Œä½ å¯èƒ½æƒ³ç›´æ¥ä»¥å¯¹è±¡çš„å½¢å¼æµå¼ä¼ è¾“æŸ¥è¯¢ç»“æœã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;stream&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> dbQuery</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `&lt;`</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å‡è®¾ä»æ•°æ®åº“è·å–çš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    yield</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`name</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> objStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dbQuery</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">objectMode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">objStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;data&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// { id: 0, name: &#39;name0&#39; }ï¼Œä¾æ­¤ç±»æ¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¾‹ 2ï¼šæ•°ç»„å¤„ç†</strong></p><p>å¦ä¸€ä¸ªå®é™…çš„åº”ç”¨åœºæ™¯æ˜¯ï¼Œä½ å¯èƒ½æœ‰ä¸€ä¸ªå¤§å‹æ•°æ®é›†åˆï¼Œæ¯”å¦‚ä¸€ä¸ªæ•°ç»„ï¼Œä½ æƒ³è¦é€ä¸ªå…ƒç´ åœ°å¤„ç†å®ƒã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> bigArray</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [{ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }]; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¤§æ•°ç»„</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> arrayStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  objectMode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">bigArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">bigArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">shift</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">arrayStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ€»ä¹‹ï¼Œ<code>readable.readableObjectMode</code>å‘Šè¯‰ä½ æµæ˜¯å¦åœ¨å¯¹è±¡æ¨¡å¼ä¸‹è¿è¡Œï¼Œè¿™å¯¹äºéœ€è¦å¤„ç†é«˜çº§æ•°æ®ç»“æ„ï¼ˆè€Œä¸æ˜¯ä»…ä»…æ˜¯å­—èŠ‚ï¼‰çš„åœºæ™¯éå¸¸æœ‰ç”¨ã€‚</p><h5 id="readable-resume" tabindex="-1"><a class="header-anchor" href="#readable-resume"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readableresume" target="_blank" rel="noopener noreferrer">readable.resume()</a></span></a></h5><p>Node.js æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®© JavaScript å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œã€‚åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamsï¼‰æ˜¯ä¸€ç§å¤„ç†è¯»å†™æ•°æ®çš„æ–¹å¼ï¼Œæ¯”å¦‚ä»æ–‡ä»¶è¯»å–æ•°æ®æˆ–å‘æ–‡ä»¶å†™å†™å…¥æ•°æ®ã€‚æµå¯ä»¥é«˜æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®ï¼Œå› ä¸ºå®ƒä»¬ä¸éœ€è¦ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚åœ¨æµçš„ä¸–ç•Œé‡Œï¼Œæœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µå°±æ˜¯â€œå¯è¯»æµâ€ï¼ˆReadable Streamsï¼‰ã€‚</p><h3 id="å¯è¯»æµ-readable-streams-2" tabindex="-1"><a class="header-anchor" href="#å¯è¯»æµ-readable-streams-2"><span>å¯è¯»æµï¼ˆReadable Streamsï¼‰</span></a></h3><p>ç®€å•æ¥è¯´ï¼Œå¯è¯»æµæ˜¯ä¸€ç§ä»æºå¤´ï¼ˆå¦‚æ–‡ä»¶ã€ç½‘ç»œè¯·æ±‚ç­‰ï¼‰é€æ­¥è¯»å–æ•°æ®çš„æ–¹å¼ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ ç”¨ä¸€æ ¹å¸ç®¡æ…¢æ…¢åœ°å–ä¸€æ¯æ°´ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±åƒä¸€ä¸ªå¯è¯»æµï¼Œæ°´ä»£è¡¨æ•°æ®ï¼Œä½ é€æ¸åœ°ä»æ¯å­ï¼ˆæ•°æ®æºï¼‰ä¸­å¸å–æ°´ï¼ˆæ•°æ®ï¼‰ã€‚</p><h3 id="readable-resume-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#readable-resume-æ–¹æ³•"><span>readable.resume() æ–¹æ³•</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>readable.resume()</code>æ˜¯å¯è¯»æµæä¾›çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯è®©è¢«æš‚åœï¼ˆpausedï¼‰çš„æµé‡æ–°å¼€å§‹æµåŠ¨ï¼ˆflowing modeï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œå½“ä½ æš‚åœäº†æ•°æ®çš„è¯»å–ï¼Œä½¿ç”¨<code>readable.resume()</code>å¯ä»¥è®©æ•°æ®å†æ¬¡å¼€å§‹æµåŠ¨ã€‚</p><h4 id="å®é™…è¿ç”¨çš„ä¾‹å­-16" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-16"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h4><p><strong>1. è¯»å–å¤§æ–‡ä»¶</strong></p><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨ï¼Œè¿™ä¸ªåº”ç”¨éœ€è¦å¤„ç†éå¸¸å¤§çš„æ—¥å¿—æ–‡ä»¶ã€‚å¦‚æœä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚è¿™æ—¶å€™ï¼Œä½ å¯ä»¥ä½¿ç”¨æµæ¥é€æ­¥è¯»å–æ–‡ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./bigfile.log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬&quot;data&quot;äº‹ä»¶æ¥è¯»å–æ•°æ®å—(chunk)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‡è®¾æˆ‘ä»¬æ ¹æ®æŸäº›æ¡ä»¶æš‚åœæ•°æ®æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pause</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œï¼Œä¾‹å¦‚æ•°æ®å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Resuming stream...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ä½¿ç”¨readable.resume()æ¥æ¢å¤æ•°æ®æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å»¶è¿Ÿ1ç§’åæ¢å¤æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No more data.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªå¤§æ–‡ä»¶åˆ›å»ºäº†ä¸€ä¸ªå¯è¯»æµã€‚å½“æˆ‘ä»¬å¼€å§‹æ¥æ”¶æ•°æ®æ—¶ï¼ŒåŸºäºæŸä¸ªæ¡ä»¶ï¼ˆå¯èƒ½æ˜¯æˆ‘ä»¬éœ€è¦æ—¶é—´æ¥å¤„ç†æ•°æ®ï¼‰ï¼Œæˆ‘ä»¬æš‚åœäº†æµã€‚ä¹‹åï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿäº†ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼ˆæ¯”å¦‚å¯¹æ¥æ”¶åˆ°çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼‰ï¼Œç„¶åä½¿ç”¨<code>readable.resume()</code>æ¥æ¢å¤æ•°æ®æµçš„è¯»å–ã€‚</p><p><strong>2. ç½‘ç»œè¯·æ±‚</strong></p><p>å¦ä¸€ä¸ªå®é™…çš„åœºæ™¯æ˜¯å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªæœåŠ¡ï¼Œå®¢æˆ·ç«¯é€šè¿‡ HTTP è¯·æ±‚å‘é€å¤§é‡æ•°æ®ç»™ä½ çš„æœåŠ¡å™¨ï¼Œä½ å¯ä»¥ä½¿ç”¨æµæ¥é€æ­¥å¤„ç†è¿™äº›æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">method</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;POST&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pause</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å‡è®¾æˆ‘ä»¬éœ€è¦åšä¸€äº›å¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚éªŒè¯APIå¯†é’¥</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Processing request...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // æ•°æ®éªŒè¯å®Œæˆåï¼Œæ¢å¤è¯·æ±‚æ•°æ®æµçš„å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Data processed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å»¶è¿Ÿ1ç§’</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">405</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server listening on port 8080...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå®ƒå¤„ç†å®¢æˆ·ç«¯çš„ POST è¯·æ±‚ã€‚å½“æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬æš‚åœå¤„ç†è¯·æ±‚ä½“ï¼Œæ‰§è¡Œä¸€äº›å¼‚æ­¥æ“ä½œï¼ˆä¾‹å¦‚éªŒè¯ï¼‰ï¼Œç„¶åä½¿ç”¨<code>readable.resume()</code>ç»§ç»­å¤„ç†è¯·æ±‚ä½“ã€‚</p><h3 id="æ€»ç»“-20" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-20"><span>æ€»ç»“</span></a></h3><p><code>readable.resume()</code>æ–¹æ³•åœ¨ Node.js ä¸­éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯å½“ä½ éœ€è¦ç²¾ç»†æ§åˆ¶æ•°æ®å¤„ç†çš„é€Ÿç‡æ—¶ã€‚å®ƒå…è®¸ä½ åœ¨é€‚å½“çš„æ—¶æœºæš‚åœå’Œæ¢å¤æ•°æ®æµï¼Œè¿™å¯¹äºé˜²æ­¢å†…å­˜æ³„éœ²å’Œæé«˜åº”ç”¨æ€§èƒ½å°¤ä¸ºé‡è¦ã€‚é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œä½ åº”è¯¥å¯¹<code>readable.resume()</code>æœ‰äº†æ›´æ·±å…¥çš„ç†è§£ã€‚</p><h5 id="readable-setencoding-encoding" tabindex="-1"><a class="header-anchor" href="#readable-setencoding-encoding"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablesetencodingencoding" target="_blank" rel="noopener noreferrer">readable.setEncoding(encoding)</a></span></a></h5><p>ç†è§£ <code>readable.setEncoding(encoding)</code> çš„æ¦‚å¿µå’Œä½œç”¨ï¼Œé¦–å…ˆéœ€è¦æ˜ç™½ Node.js ä¸­çš„æµï¼ˆStreamï¼‰å’Œç¼–ç ï¼ˆEncodingï¼‰ã€‚</p><h3 id="æµ-stream" tabindex="-1"><a class="header-anchor" href="#æµ-stream"><span>æµï¼ˆStreamï¼‰</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§å¤„ç†è¯»å†™æ•°æ®çš„æ–¹å¼ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€æ¡æ²³ï¼ˆæ•°æ®æºï¼‰ï¼Œè€Œä½ ä¸æ˜¯ä¸€æ¬¡æ€§çœ‹åˆ°æ•´æ¡æ²³ï¼Œè€Œæ˜¯ç«™åœ¨æ²³è¾¹ï¼Œè§‚å¯Ÿè¿‡å»çš„æ°´ï¼ˆæ•°æ®ï¼‰ã€‚è¿™å°±åƒæµåœ¨ Node.js ä¸­å·¥ä½œçš„æ–¹å¼ã€‚å®ƒå…è®¸ä½ å¤„ç†å¤§é‡æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><h3 id="ç¼–ç -encoding" tabindex="-1"><a class="header-anchor" href="#ç¼–ç -encoding"><span>ç¼–ç ï¼ˆEncodingï¼‰</span></a></h3><p>ç¼–ç æ˜¯å­—ç¬¦å¦‚ä½•è½¬æ¢ä¸ºå­—èŠ‚çš„è§„åˆ™ã€‚ä¾‹å¦‚ï¼ŒUTF-8 æ˜¯ä¸€ç§æµè¡Œçš„ç¼–ç ï¼Œå®ƒå®šä¹‰äº†å¦‚ä½•å°†å­—ç¬¦ï¼ˆå¦‚ A, B, C, ä¸­æ–‡ç­‰ï¼‰è½¬æ¢ä¸ºæ•°å­—è¡¨ç¤ºã€‚</p><h3 id="readable-setencoding-encoding-1" tabindex="-1"><a class="header-anchor" href="#readable-setencoding-encoding-1"><span><code>readable.setEncoding(encoding)</code></span></a></h3><p>å½“ä½ ä»ä¸€ä¸ªå¯è¯»æµä¸­è¯»å–æ•°æ®æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä½ å¾—åˆ°çš„æ˜¯åŸå§‹çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ Buffer å¯¹è±¡ã€‚å¦‚æœä½ æƒ³ç›´æ¥å¤„ç†å­—ç¬¦ä¸²ï¼Œè€Œä¸æƒ³æ‰‹åŠ¨å°† Buffer è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆ <code>readable.setEncoding(encoding)</code> å°±éå¸¸æœ‰ç”¨ã€‚</p><p>é€šè¿‡è°ƒç”¨ <code>readable.setEncoding(encoding)</code> æ–¹æ³•å¹¶æŒ‡å®šä¸€ä¸ªç¼–ç ï¼ˆæ¯”å¦‚ &#39;utf8&#39;ï¼‰ï¼Œä½ å‘Šè¯‰æµï¼šæˆ‘å¸Œæœ›æ¥æ”¶çš„æ•°æ®æ˜¯ä»¥æŒ‡å®šç¼–ç çš„å­—ç¬¦ä¸²å½¢å¼ï¼Œè€Œä¸æ˜¯ Bufferã€‚è¿™æ ·ï¼Œæ¯å½“ä½ ä»æµä¸­è¯»å–æ•°æ®æ—¶ï¼Œä½ å¾—åˆ°çš„ç›´æ¥å°±æ˜¯å­—ç¬¦ä¸²ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-17" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-17"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="_1-è¯»å–æ–‡æœ¬æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_1-è¯»å–æ–‡æœ¬æ–‡ä»¶"><span>1. è¯»å–æ–‡æœ¬æ–‡ä»¶</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ª UTF-8 ç¼–ç çš„æ–‡æœ¬æ–‡ä»¶ï¼Œä½ æƒ³é€è¡Œè¯»å–å†…å®¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®ç¼–ç ä¸º UTF-8</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> rl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  input</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">rl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;line&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`è¡Œå†…å®¹ï¼š</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">line</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†æµçš„ç¼–ç ä¸º &#39;utf8&#39;ã€‚è¿™æ„å‘³ç€å½“æˆ‘ä»¬é€è¡Œè¯»å–æ–‡ä»¶æ—¶ï¼Œ<code>line</code> äº‹ä»¶ä¼ é€’çš„ <code>line</code> å˜é‡å·²ç»æ˜¯ä¸€ä¸ª UTF-8 ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª Buffer å¯¹è±¡ã€‚</p><h4 id="_2-ç½‘ç»œè¯·æ±‚-3" tabindex="-1"><a class="header-anchor" href="#_2-ç½‘ç»œè¯·æ±‚-3"><span>2. ç½‘ç»œè¯·æ±‚</span></a></h4><p>å½“å¤„ç†æ¥è‡ª HTTP è¯·æ±‚çš„æ•°æ®æ—¶ï¼Œä½ å¯èƒ½ä¹Ÿæƒ³ç›´æ¥å¤„ç†å­—ç¬¦ä¸²ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> rawData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    rawData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">rawData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯¹æ¥è‡ªç½‘ç»œè¯·æ±‚çš„å“åº”è®¾ç½®äº†ç¼–ç ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥å°†æ¥æ”¶åˆ°çš„æ•°æ®å—ï¼ˆ<code>chunk</code>ï¼‰ç›´æ¥æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸éœ€è¦é¢å¤–çš„ç¼–ç è½¬æ¢æ­¥éª¤ã€‚</p><p>é€šè¿‡ä½¿ç”¨ <code>readable.setEncoding(encoding)</code>ï¼Œä½ å¯ä»¥ç®€åŒ–å¤„ç†æ–‡æœ¬æ•°æ®çš„è¿‡ç¨‹ï¼Œæ— è®ºæ˜¯æ¥è‡ªæ–‡ä»¶ã€ç½‘ç»œè¯·æ±‚è¿˜æ˜¯å…¶ä»–æºçš„æµæ•°æ®ã€‚</p><h5 id="readable-unpipe-destination" tabindex="-1"><a class="header-anchor" href="#readable-unpipe-destination"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readableunpipedestination" target="_blank" rel="noopener noreferrer">readable.unpipe([destination])</a></span></a></h5><p>ç†è§£ <code>readable.unpipe([destination])</code> æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆææ¸…æ¥šå‡ ä¸ªæ¦‚å¿µï¼šNode.js ä¸­çš„æµï¼ˆStreamsï¼‰ã€ç®¡é“ï¼ˆPipesï¼‰ä»¥åŠä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦â€œunpipeâ€æŸäº›ä¸œè¥¿ã€‚</p><h3 id="æµ-streams-2" tabindex="-1"><a class="header-anchor" href="#æµ-streams-2"><span>æµï¼ˆStreamsï¼‰</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç³»åˆ—çš„æ•°æ®å…ƒç´ ï¼Œè¿™äº›æ•°æ®å…ƒç´ å¯ä»¥é€ä¸ªåœ°å¤„ç†ï¼Œè€Œä¸å¿…ä¸€æ¬¡æ€§å°†å®ƒä»¬å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™å¯¹äºå¤„ç†å¤§æ–‡ä»¶æˆ–å®æ—¶æ•°æ®éå¸¸æœ‰ç”¨ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ï¼Œæˆ–è€…æ—¢å¯è¯»åˆå¯å†™çš„ã€‚</p><h3 id="ç®¡é“-pipes" tabindex="-1"><a class="header-anchor" href="#ç®¡é“-pipes"><span>ç®¡é“ï¼ˆPipesï¼‰</span></a></h3><p>ç®¡é“æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå…è®¸å°†ä¸€ä¸ªæµçš„è¾“å‡ºç›´æ¥è¿æ¥åˆ°å¦ä¸€ä¸ªæµçš„è¾“å…¥ï¼Œä»è€Œå½¢æˆæ•°æ®å¤„ç†é“¾ã€‚è¿™ç±»ä¼¼äº Unix ä¸­çš„ç®¡é“ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥æŠŠä¸€ä¸ªæ–‡ä»¶æµç›´æ¥ç®¡é“åˆ°ä¸€ä¸ªå‹ç¼©æµä¸­ï¼Œç„¶åå†ç®¡é“åˆ°ä¸€ä¸ªå†™å…¥æµï¼Œæœ€ç»ˆå®ç°æ–‡ä»¶çš„è¯»å–ã€å‹ç¼©å’Œå†™å…¥æ“ä½œã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-readable-unpipe-destination" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-readable-unpipe-destination"><span>ä»€ä¹ˆæ˜¯ <code>readable.unpipe([destination])</code></span></a></h3><p>ç®€å•æ¥è¯´ï¼Œ<code>readable.unpipe([destination])</code> æ–¹æ³•å…è®¸ä½ å°†ä¸€ä¸ªå¯è¯»æµä¸å…¶ä¸‹æ¸¸çš„å†™å…¥ç›®æ ‡ï¼ˆdestinationï¼‰æ–­å¼€è¿æ¥ã€‚å¦‚æœæŒ‡å®šäº†<code>destination</code>ï¼Œé‚£ä¹ˆåªä¼šæ–­å¼€ä¸è¯¥ç‰¹å®šç›®æ ‡çš„è¿æ¥ï¼›å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™æ–­å¼€ä¸æ‰€æœ‰ç›®æ ‡çš„è¿æ¥ã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯-2" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯-2"><span>ä½¿ç”¨åœºæ™¯</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ä»ä¸€ä¸ªæºå¤´ï¼ˆä¾‹å¦‚ä¸€ä¸ªå¤§æ–‡ä»¶ï¼‰è¯»å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®é€šè¿‡ç®¡é“ä¼ è¾“ç»™å¤šä¸ªç›®çš„åœ°è¿›è¡Œå¤„ç†ï¼ˆæ¯”å¦‚å†™å…¥ä¸åŒçš„æ–‡ä»¶ã€ä¸Šä¼ è‡³æœåŠ¡å™¨ç­‰ï¼‰ã€‚åœ¨æŸäº›æ—¶åˆ»ï¼ŒåŸºäºç‰¹å®šæ¡ä»¶ï¼ˆæ¯”å¦‚é”™è¯¯å‘ç”Ÿã€ç‰¹å®šæ•°æ®è¢«è¯»å–ï¼‰ï¼Œä½ å¯èƒ½æƒ³è¦åœæ­¢å‘æŸä¸ªï¼ˆæˆ–æ‰€æœ‰ï¼‰ç›®çš„åœ°å‘é€æ›´å¤šæ•°æ®ã€‚è¿™æ—¶ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨<code>readable.unpipe()</code>æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p><h3 id="å®é™…ä¾‹å­-1" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-1"><span>å®é™…ä¾‹å­</span></a></h3><h4 id="åœºæ™¯æè¿°" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯æè¿°"><span>åœºæ™¯æè¿°</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œä½ å¸Œæœ›å®æ—¶åœ°è¯»å–è¿™ä¸ªæ–‡ä»¶å¹¶å°†æ•°æ®å‘é€åˆ°ä¸¤ä¸ªåœ°æ–¹ï¼šæ§åˆ¶å°å’Œä¸€ä¸ªæ–°æ–‡ä»¶ã€‚åœ¨é‡åˆ°ç‰¹å®šç±»å‹çš„æ—¥å¿—è®°å½•æ—¶ï¼Œä½ å†³å®šä¸å†å¾€æ–°æ–‡ä»¶ä¸­å†™å…¥æ•°æ®ã€‚</p><h4 id="ä»£ç ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä»£ç ç¤ºä¾‹"><span>ä»£ç ç¤ºä¾‹</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµï¼ˆæ¨¡æ‹Ÿè¯»å–æ–‡ä»¶ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿå®æ—¶æ·»åŠ æ•°æ®åˆ°æµä¸­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯ä¸€æ¡æ™®é€šæ—¥å¿—</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯ä¸€æ¡è­¦å‘Šæ—¥å¿—</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯é”™è¯¯æ—¥å¿—ï¼Œåœæ­¢å†™å…¥æ–°æ–‡ä»¶</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯å¦ä¸€æ¡æ™®é€šæ—¥å¿—</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºæ–‡ä»¶å†™å…¥æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fileWriteStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;log_output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†æ•°æ®ä»å¯è¯»æµå¯¼å‘æ§åˆ¶å°å’Œæ–‡ä»¶å†™å…¥æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fileWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;é”™è¯¯æ—¥å¿—&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // é‡åˆ°é”™è¯¯æ—¥å¿—ï¼Œåœæ­¢å¾€æ–‡ä»¶ä¸­å†™å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">unpipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fileWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªå¯è¯»æµ<code>readableStream</code>ï¼Œæ¨¡æ‹Ÿä»ä¸€ä¸ªæ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†è¿™ä¸ªæµè¿æ¥åˆ°äº†ä¸¤ä¸ªç›®çš„åœ°ï¼šæ§åˆ¶å°ï¼ˆ<code>process.stdout</code>ï¼‰å’Œä¸€ä¸ªæ–‡ä»¶å†™å…¥æµï¼ˆ<code>fileWriteStream</code>ï¼‰ã€‚å½“è¯»å–åˆ°åŒ…å«&quot;é”™è¯¯æ—¥å¿—&quot;çš„æ•°æ®æ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨<code>readableStream.unpipe(fileWriteStream)</code>æ–¹æ³•ï¼Œä»è€Œåœæ­¢å‘æ–°æ–‡ä»¶<code>log_output.txt</code>ä¸­å†™å…¥æ›´å¤šæ•°æ®ã€‚ æ§åˆ¶å°ä¼šç»§ç»­æ¥æ”¶æµä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰æ–­å¼€ä¸å®ƒçš„è¿æ¥ã€‚</p><p>å¸Œæœ›è¿™äº›è§£é‡Šå’Œä¾‹å­èƒ½å¸®åŠ©ä½ ç†è§£<code>readable.unpipe([destination])</code>åœ¨ Node.js ä¸­çš„ä½œç”¨å’Œç”¨æ³•ã€‚</p><h5 id="readable-unshift-chunk-encoding" tabindex="-1"><a class="header-anchor" href="#readable-unshift-chunk-encoding"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readableunshiftchunk-encoding" target="_blank" rel="noopener noreferrer">readable.unshift(chunk[, encoding])</a></span></a></h5><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ Node.js ä¸­çš„ <code>readable.unshift(chunk[, encoding])</code> æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯æµï¼ˆStreamï¼‰API çš„ä¸€éƒ¨åˆ†ï¼Œç‰¹åˆ«ç”¨äºå¯è¯»æµã€‚åœ¨è§£é‡Šå®ƒä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£ä¸€äº›åŸºç¡€æ¦‚å¿µã€‚</p><h3 id="æµ-streams-ç®€ä»‹-5" tabindex="-1"><a class="header-anchor" href="#æµ-streams-ç®€ä»‹-5"><span>æµï¼ˆStreamsï¼‰ç®€ä»‹</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†å¤§é‡æ•°æ®ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªæ°´æ¡¶ï¼ˆæ–‡ä»¶æˆ–æ•°æ®æºï¼‰ï¼Œè€Œä½ éœ€è¦å°†æ°´ï¼ˆæ•°æ®ï¼‰å€’è¿›å¦ä¸€ä¸ªæ°´æ¡¶é‡Œã€‚å¦‚æœä½¿ç”¨ä¼ ç»Ÿçš„æ–¹æ³•ï¼Œä½ å¯èƒ½ä¼šç­‰åˆ°ç¬¬ä¸€ä¸ªæ°´æ¡¶é‡Œçš„æ‰€æœ‰æ°´éƒ½å‡†å¤‡å¥½äº†æ‰å¼€å§‹å€’ã€‚ä½†å¦‚æœä½¿ç”¨æµï¼Œä½ å¯ä»¥è¾¹å€’è¾¹æ¥ï¼Œä¸å¿…ç­‰å¾…å…¨éƒ¨å‡†å¤‡å°±ç»ªã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå®ƒæé«˜äº†æ•ˆç‡ï¼Œé™ä½äº†å†…å­˜æ¶ˆè€—ã€‚</p><h3 id="å¯è¯»æµ-readable-streams-3" tabindex="-1"><a class="header-anchor" href="#å¯è¯»æµ-readable-streams-3"><span>å¯è¯»æµï¼ˆReadable Streamsï¼‰</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œå¯è¯»æµæ˜¯ä¸€ç§æŠ½è±¡çš„æ¥å£ï¼Œç”¨äºä»æŸå¤„ï¼ˆæ¯”å¦‚æ–‡ä»¶ã€HTTP å“åº”ç­‰ï¼‰è¯»å–æ•°æ®ã€‚å½“ä½ ä»è¿™äº›èµ„æºè¯»å–æ•°æ®æ—¶ï¼Œå¯ä»¥é€å—åœ°è¿›è¡Œï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªèµ„æºã€‚</p><h3 id="readable-unshift-chunk-encoding-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#readable-unshift-chunk-encoding-æ–¹æ³•"><span><code>readable.unshift(chunk[, encoding])</code> æ–¹æ³•</span></a></h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥è°ˆè°ˆ <code>readable.unshift(chunk[, encoding])</code>ã€‚è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯å°†ä¸€å—æ•°æ®æ”¾å›å¯è¯»æµçš„å†…éƒ¨ç¼“å†²åŒºçš„å¼€å¤´ã€‚ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿæœ‰æ—¶ï¼Œåœ¨å¤„ç†æµæ•°æ®æ—¶ï¼Œä½ å¯èƒ½å·²ç»ä»æµä¸­è¯»å–äº†ä¸€äº›æ•°æ®ï¼Œç„¶åå‘ç°è¿˜ä¸æ˜¯æ—¶å€™å¤„ç†å®ƒï¼Œæˆ–è€…éœ€è¦å…ˆå¤„ç†å…¶ä»–æ•°æ®ã€‚<code>unshift</code> æ–¹æ³•å°±å…è®¸ä½ â€œé€€å›â€è¿™äº›æ•°æ®ï¼Œä»¥ä¾¿ç¨åå†æ¬¡è¯»å–ã€‚</p><h4 id="å‚æ•°-3" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-3"><span>å‚æ•°ï¼š</span></a></h4><ul><li><code>chunk</code>ï¼šè¦é€€å›çš„æ•°æ®å—ã€‚</li><li><code>encoding</code>ï¼šï¼ˆå¯é€‰ï¼‰å¦‚æœ <code>chunk</code> æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™æŒ‡å®šå…¶ç¼–ç ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ &#39;utf8&#39;ã€‚</li></ul><h4 id="å®é™…åº”ç”¨ç¤ºä¾‹-6" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-6"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h4><ol><li><p><strong>æ–‡æœ¬è§£æ</strong>ï¼šå‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªè§£æå™¨æ¥å¤„ç†æ¥è‡ªæ–‡ä»¶çš„æ–‡æœ¬è¾“å…¥ã€‚ä½ å¼€å§‹è¯»å–æ•°æ®ï¼Œå¯»æ‰¾ç‰¹å®šçš„æ ‡è®°æˆ–åˆ†éš”ç¬¦ã€‚å½“ä½ æ‰¾åˆ°ä¸€ä¸ªæ ‡è®°ï¼Œä½†æ„è¯†åˆ°éœ€è¦å…ˆå¤„ç†å‰é¢çš„æ•°æ®æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>unshift</code> å°†è¿™ä¸ªæ ‡è®°ï¼ˆå’Œéšåçš„æ•°æ®ï¼‰é€€å›åˆ°æµä¸­ã€‚</p></li><li><p><strong>åè®®è§£ç </strong>ï¼šå¦‚æœä½ æ­£åœ¨å®ç°ä¸€ä¸ªç½‘ç»œåè®®ï¼Œå¯èƒ½éœ€è¦è¯»å–å¹¶è§£ææ¶ˆæ¯å¤´ï¼Œç„¶åæ ¹æ®å¤´ä¿¡æ¯å†³å®šå¦‚ä½•å¤„ç†å‰©ä½™çš„æ•°æ®åŒ…ã€‚å¦‚æœåœ¨å¤„ç†å¤´ä¿¡æ¯åï¼Œä½ å‘ç°éœ€è¦é‡æ–°è¯„ä¼°å·²ç»è¯»å–çš„æ•°æ®åŒ…ï¼Œ<code>unshift</code> å…è®¸ä½ å°†è¿™éƒ¨åˆ†æ•°æ®æ¨å›æµä¸­ï¼Œä»¥ä¾¿ç”¨ä¸åŒçš„é€»è¾‘é‡æ–°å¤„ç†ã€‚</p></li><li><p><strong>é¢„è§ˆæ•°æ®</strong>ï¼šåœ¨å†³å®šå¦‚ä½•å¤„ç†æµæ•°æ®ä¹‹å‰ï¼Œä½ å¯èƒ½æƒ³â€œå·çœ‹â€ä¸€å°éƒ¨åˆ†æ•°æ®ã€‚é€šè¿‡è¯»å–å¹¶ä½¿ç”¨ <code>unshift</code> é€€å›è¿™äº›æ•°æ®ï¼Œä½ å¯ä»¥åœ¨ä¸å½±å“åç»­æµå¤„ç†çš„æƒ…å†µä¸‹ï¼ŒåŸºäºè¿™äº›é¢„è§ˆæ•°æ®åšå‡ºå†³ç­–ã€‚</p></li></ol><p>æ€»ç»“èµ·æ¥ï¼Œ<code>readable.unshift()</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ–¹æ³•ï¼Œå…è®¸æ›´çµæ´»åœ°å¤„ç†å¯è¯»æµä¸­çš„æ•°æ®ã€‚è¿™åœ¨éœ€è¦åŠ¨æ€å†³å®šå¦‚ä½•å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®æ—¶éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨è§£æå’Œåè®®å¤„ç†ç­‰åœºæ™¯ä¸­ã€‚</p><h5 id="readable-wrap-stream" tabindex="-1"><a class="header-anchor" href="#readable-wrap-stream"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablewrapstream" target="_blank" rel="noopener noreferrer">readable.wrap(stream)</a></span></a></h5><p>Node.js ä¸­çš„ <code>readable.wrap(stream)</code> æ˜¯ä¸€ä¸ªåœ¨ Node.js Stream API ä¸­æ¯”è¾ƒç‰¹æ®Šçš„æ–¹æ³•ã€‚å®ƒå…è®¸ä½ å°†ä¸€ä¸ªè€å¼çš„æµï¼ˆä¹Ÿå°±æ˜¯ä½¿ç”¨äº‹ä»¶å¦‚ <code>data</code> å’Œ <code>end</code> æ¥å¤„ç†æ•°æ®çš„æµï¼Œè¿™ç§ç±»å‹çš„æµåœ¨ Node.js æ—©æœŸç‰ˆæœ¬ä¸­å¾ˆå¸¸è§ï¼‰â€œåŒ…è£…â€æˆä¸€ä¸ªç°ä»£çš„ã€ç¬¦åˆ Streams API çš„å¯è¯»æµï¼ˆReadable Streamï¼‰ã€‚è¿™æ ·ï¼Œä½ å°±å¯ä»¥ç”¨æ–°ç‰ˆæµçš„æ‰€æœ‰ä¼˜ç§€ç‰¹æ€§å’Œæ–¹æ³•æ¥æ“ä½œåŸæœ¬çš„è€å¼æµäº†ã€‚</p><h3 id="è§£é‡Š-2" tabindex="-1"><a class="header-anchor" href="#è§£é‡Š-2"><span>è§£é‡Š</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç®€å•å›é¡¾ä¸€ä¸‹ä»€ä¹ˆæ˜¯æµï¼ˆStreamï¼‰ï¼š</p><ul><li><strong>æµ</strong>æ˜¯ Node.js ä¸­å¤„ç†æµå¼æ•°æ®çš„æŠ½è±¡æ¥å£ï¼Œä¾‹å¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰ã€‚å®ƒä»¬å…è®¸æ•°æ®è¢«é€æ®µå¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§è£…å…¥å†…å­˜ï¼Œè¿™å¯¹äºå¤„ç†å¤§é‡æ•°æ®éå¸¸æœ‰ç”¨ã€‚</li></ul><p>åœ¨ Node.js é‡Œï¼Œæµåˆ†ä¸ºå‡ ç§ç±»å‹ï¼Œå…¶ä¸­<strong>å¯è¯»æµ</strong>ï¼ˆReadable Streamï¼‰æ˜¯æœ€å¸¸è§çš„ä¸€ç§ï¼Œå®ƒä»£è¡¨ä¸€ä¸ªæ•°æ®æºï¼Œä½ å¯ä»¥ä»ä¸­è¯»å–æ•°æ®ã€‚</p><p>ç„¶åï¼Œç†è§£ <code>readable.wrap(stream)</code> çš„ä½œç”¨ï¼š</p><ul><li>å½“ä½ æœ‰ä¸€ä¸ªè€å¼æµï¼ˆæ¯”å¦‚æ¥è‡ªæŸäº›æ—§åº“æˆ–æ¨¡å—çš„æµï¼‰ï¼Œä½†ä½ æƒ³ä»¥æ›´ç°ä»£çš„æ–¹å¼å¤„ç†å®ƒï¼ˆæ¯”å¦‚ä½¿ç”¨ <code>pipe</code> æ–¹æ³•æˆ– async iterators ç­‰ï¼‰ï¼Œ<code>readable.wrap(stream)</code> å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</li><li>å®ƒä¼šè¿”å›ä¸€ä¸ªæ–°çš„<strong>å¯è¯»æµ</strong>ï¼ˆReadable Streamï¼‰ï¼Œè¿™ä¸ªæ–°æµå°†ä¼šè½¬å‘è€å¼æµçš„æ•°æ®å’Œäº‹ä»¶ï¼Œä½†åŒæ—¶æ”¯æŒæ–°æµçš„æ‰€æœ‰ç‰¹æ€§å’Œæ–¹æ³•ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-10" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-10"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¤„ç†ä¸€ä¸ªæ—§ç‰ˆçš„ HTTP è¯·æ±‚ï¼ˆè¿™åªæ˜¯ä¸ºäº†æ¼”ç¤ºï¼›å®é™…ä¸Š Node.js çš„ http æ¨¡å—å·²ç»è¿”å›ç°ä»£æµäº†ï¼‰æˆ–è€…ä½¿ç”¨äº†ä¸€ä¸ªåªæä¾›è€å¼æµæ¥å£çš„ç¬¬ä¸‰æ–¹åº“ï¼Œä½ å¸Œæœ›èƒ½å¤Ÿä»¥ç°ä»£æ–¹å¼å¤„ç†è¿”å›çš„æ•°æ®æµã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡å®šè¿™æ˜¯ä¸€ä¸ªè€å¼çš„æµæ¥å£</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™ä¸ªå‡½æ•°è·å–æŸä¸ªè€å¼çš„ HTTP æ•°æ®æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> getOldHttpRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™é‡Œä»…ä¸ºç¤ºä¾‹ä»£ç ã€‚å®é™…ä¸­ï¼ŒNode.js çš„ http.get è¿”å›çš„å“åº”å·²ç»æ˜¯æ–°å¼æµã€‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> oldStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è€å¼æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> oldStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ readable.wrap æ¥åŒ…è£…è€å¼æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> modernizeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">oldStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> modernStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">wrap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">oldStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> modernStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç”¨æ³•ç¤ºä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> oldStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> getOldHttpRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> modernStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> modernizeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">oldStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨ modernStream ï¼Œå¹¶äº«å—æ‰€æœ‰ç°ä»£å¯è¯»æµçš„å¥½å¤„äº†</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¯”å¦‚ä½¿ç”¨ pipe æ–¹æ³•å°†æ•°æ®ä¼ è¾“åˆ°æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">modernStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æˆ–è€…ä½¿ç”¨ async iterator æ¥å¼‚æ­¥è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> readStreamData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  for</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Data chunk:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readStreamData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">modernStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>getOldHttpRequest</code> å‡½æ•°æ¨¡æ‹Ÿä»ä¸€ä¸ªæ—§å¼ HTTP æ¥å£è·å¾—æ•°æ®æµã€‚ç„¶åï¼Œé€šè¿‡ <code>readable.wrap</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªè€å¼æµè½¬æ¢æˆä¸€ä¸ªç°ä»£çš„å¯è¯»æµï¼Œä»è€Œå¯ä»¥åˆ©ç”¨ç°ä»£æµçš„é«˜çº§åŠŸèƒ½ï¼Œå¦‚æµç®¡é“ï¼ˆ<code>.pipe</code>ï¼‰å’Œå¼‚æ­¥è¿­ä»£å™¨æ¥å¤„ç†æ•°æ®ã€‚è¿™æ ·ï¼Œå³ä½¿æ˜¯ä¸è€å¼ä»£ç æˆ–åº“äº¤äº’ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½äº«å—åˆ° Node.js æµ API çš„æœ€æ–°ç‰¹æ€§å’Œæ”¹è¿›ã€‚</p><h5 id="readablesymbol-asynciterator-https-nodejs-org-docs-latest-api-stream-html-readablesymbolasynciterator" tabindex="-1"><a class="header-anchor" href="#readablesymbol-asynciterator-https-nodejs-org-docs-latest-api-stream-html-readablesymbolasynciterator"><span>[readable<a href="">Symbol.asyncIterator</a>](<a href="https://nodejs.org/docs/latest/api/stream.html#readablesymbolasynciterator" target="_blank" rel="noopener noreferrer">https://nodejs.org/docs/latest/api/stream.html#readablesymbolasynciterator</a>)</span></a></h5><p>Node.js ä¸­çš„<code>readable[Symbol.asyncIterator]()</code>æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†æµï¼ˆStreamsï¼‰æ•°æ®æ—¶ã€‚è¿™ä¸ªåŠŸèƒ½å…è®¸ä½ ä»¥å¼‚æ­¥è¿­ä»£å™¨ï¼ˆAsync Iteratorï¼‰çš„æ–¹å¼æ¥è¯»å–æµä¸­çš„æ•°æ®ï¼Œä½¿å¾—æ“ä½œæµæ•°æ®å˜å¾—æ—¢ç®€å•åˆé«˜æ•ˆã€‚åœ¨è§£é‡Šè¿™ä¸ªåŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¦äº†è§£å‡ ä¸ªå…³é”®æ¦‚å¿µï¼š</p><ol><li><p><strong>æµï¼ˆStreamsï¼‰</strong>ï¼šåœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§æŠ½è±¡çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå¤„ç†å¤§é‡æ•°æ®ï¼ˆä¾‹å¦‚æ–‡ä»¶å†…å®¹ï¼‰çš„è¯»å†™æ“ä½œã€‚æµå¯ä»¥åˆ†ä¸ºå¯è¯»æµã€å¯å†™æµã€åŒå‘æµå’Œè½¬æ¢æµã€‚</p></li><li><p><strong>å¼‚æ­¥è¿­ä»£å™¨ï¼ˆAsync Iteratorï¼‰</strong>ï¼šå¼‚æ­¥è¿­ä»£å™¨å…è®¸ä½ é€šè¿‡<code>for-await-of</code>å¾ªç¯ä»¥å¼‚æ­¥çš„æ–¹å¼éå†æ•°æ®ã€‚è¿™æ„å‘³ç€åœ¨æ¯æ¬¡å¾ªç¯ç­‰å¾…æ–°å€¼æ—¶ï¼Œä¸ä¼šé˜»å¡ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ã€‚</p></li></ol><p>ç°åœ¨ï¼Œå›åˆ°<code>readable[Symbol.asyncIterator]()</code>ã€‚å½“ä½ å¯¹ä¸€ä¸ªå¯è¯»æµè°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œå®ƒè¿”å›ä¸€ä¸ªå¼‚æ­¥è¿­ä»£å™¨ã€‚è¿™æ ·ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨<code>for-await-of</code>å¾ªç¯æ¥è¯»å–æµä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šæ•°æ®ä¸ºæ­¢ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-18" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-18"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œä½ æƒ³é€è¡Œè¯»å–æ–‡ä»¶çš„å†…å®¹è¿›è¡Œå¤„ç†ã€‚ä½¿ç”¨<code>readable[Symbol.asyncIterator]()</code>å¯ä»¥è®©ä½ è½»æ¾å®ç°è¿™ä¸€åŠŸèƒ½ã€‚</p><h4 id="ç¤ºä¾‹-é€è¡Œè¯»å–æ–‡ä»¶å†…å®¹" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-é€è¡Œè¯»å–æ–‡ä»¶å†…å®¹"><span>ç¤ºä¾‹ï¼šé€è¡Œè¯»å–æ–‡ä»¶å†…å®¹</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">__dirname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;largeFile.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> readLines</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä½¿ç”¨for-await-ofå¾ªç¯è¯»å–æµä¸­çš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  for</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Symbol</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">asyncIterator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]()) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å‡è®¾æ–‡ä»¶å†…å®¹ä»¥æ¢è¡Œç¬¦åˆ†éš”ä¸ºå¤šè¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> lines</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">split</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> line</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> lines</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥å¯¹æ¯ä¸€è¡Œè¿›è¡Œå¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readLines</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡<code>fs.createReadStream</code>åˆ›å»ºä¸€ä¸ªæŒ‡å‘<code>largeFile.txt</code>çš„å¯è¯»æµã€‚ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¼‚æ­¥å‡½æ•°<code>readLines</code>ï¼Œåœ¨è¿™ä¸ªå‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>for-await-of</code>å¾ªç¯è¿­ä»£æµä¸­çš„æ•°æ®å—ï¼ˆchunkï¼‰ã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬å‡è®¾æ•°æ®å—æ˜¯æ–‡æœ¬ï¼Œä¸”æ–‡æœ¬è¡Œç”±æ¢è¡Œç¬¦<code>\n</code>åˆ†éš”ã€‚æ¥ç€ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªæ•°æ®å—åˆ†å‰²æˆå•ç‹¬çš„è¡Œï¼Œå¹¶å¯¹æ¯è¡Œè¿›è¡Œå¤„ç†ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯ç®€å•åœ°æ‰“å°å‡ºæ¥ï¼‰ã€‚</p><p>è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹åŒ…æ‹¬ï¼š</p><ul><li><strong>éé˜»å¡</strong>ï¼šåœ¨å¤„ç†æ¯ä¸ªæ•°æ®å—æ—¶ï¼Œä¸ä¼šé˜»å¡ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ã€‚</li><li><strong>å†…å­˜æ•ˆç‡</strong>ï¼šä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶å†…å®¹è½½å…¥å†…å­˜ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†å¤§æ–‡ä»¶ã€‚</li><li><strong>ç®€æ´çš„ä»£ç </strong>ï¼š<code>for-await-of</code>å¾ªç¯ä½¿ä»£ç çœ‹èµ·æ¥æ—¢ç®€æ´åˆæ˜“äºç†è§£ã€‚</li></ul><p>è¿™å°±æ˜¯<code>readable[Symbol.asyncIterator]()</code>åœ¨ Node.js ä¸­å¤„ç†æµæ•°æ®æ—¶çš„åŸºæœ¬åº”ç”¨ã€‚å¸Œæœ›è¿™èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å¦‚ä½•ä½¿ç”¨è¿™ä¸ªå¼ºå¤§çš„åŠŸèƒ½ï¼</p><h5 id="readablesymbol-asyncdispose-https-nodejs-org-docs-latest-api-stream-html-readablesymbolasyncdispose" tabindex="-1"><a class="header-anchor" href="#readablesymbol-asyncdispose-https-nodejs-org-docs-latest-api-stream-html-readablesymbolasyncdispose"><span>[readable<a href="">Symbol.asyncDispose</a>](<a href="https://nodejs.org/docs/latest/api/stream.html#readablesymbolasyncdispose" target="_blank" rel="noopener noreferrer">https://nodejs.org/docs/latest/api/stream.html#readablesymbolasyncdispose</a>)</span></a></h5><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚Node.js çš„æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€æ˜¯å®ƒçš„éé˜»å¡ I/O æ¨¡å‹ï¼Œè¿™ä½¿å¾— Node.js éå¸¸é€‚åˆå¤„ç†å¤§é‡å¹¶å‘è¿æ¥ï¼Œä¾‹å¦‚åœ¨ç½‘ç»œåº”ç”¨ã€å®æ—¶é€šä¿¡æœåŠ¡ç­‰åœºåˆã€‚</p><p>ä» Node.js v21.7.1 å¼€å§‹ï¼Œå¼•å…¥äº† <code>readable[Symbol.asyncDispose]()</code> æ–¹æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸æµï¼ˆStreamsï¼‰ç›¸å…³çš„æ–°åŠŸèƒ½ã€‚è¦ç†è§£è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ Node.js ä¸­çš„ Streams å’Œå¼‚æ­¥ç¼–ç¨‹ã€‚</p><h3 id="node-js-ä¸­çš„-streams" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„-streams"><span>Node.js ä¸­çš„ Streams</span></a></h3><p>åœ¨ Node.js ä¸­ï¼ŒStreams æ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆæ•°æ®çš„ç®¡é“ï¼Œæ•°æ®å¯ä»¥ä»æºå¤´æµå‘ç›®çš„åœ°ã€‚Streams ä¸»è¦ç”¨äºå¤„ç†å¤§æ–‡ä»¶æˆ–è€…å®æ—¶æ•°æ®ä¼ è¾“ï¼Œæ¯”å¦‚ï¼š</p><ul><li>ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</li><li>å‘æ–‡ä»¶å†™å…¥æ•°æ®</li><li>ç½‘ç»œé€šä¿¡</li></ul><p>Streams å¯ä»¥å‡å°‘å†…å­˜çš„ä½¿ç”¨ï¼Œå› ä¸ºä½ ä¸éœ€è¦ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰æ•°æ®è¯»å…¥å†…å­˜ï¼Œè€Œæ˜¯å¯ä»¥é€å—å¤„ç†æ•°æ®ã€‚</p><h3 id="å¼‚æ­¥ç¼–ç¨‹" tabindex="-1"><a class="header-anchor" href="#å¼‚æ­¥ç¼–ç¨‹"><span>å¼‚æ­¥ç¼–ç¨‹</span></a></h3><p>Node.js å¤§é‡ä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ï¼Œå°¤å…¶æ˜¯ Promises å’Œ async/await è¯­æ³•ã€‚è¿™ç§æ¨¡å¼å…è®¸ Node.js åœ¨æ‰§è¡Œé•¿æ—¶é—´æ“ä½œï¼ˆå¦‚è¯»å–æ–‡ä»¶ã€æŸ¥è¯¢æ•°æ®åº“ï¼‰æ—¶ä¸ä¼šè¢«é˜»å¡ï¼Œç¨‹åºå¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚</p><h3 id="readable-symbol-asyncdispose" tabindex="-1"><a class="header-anchor" href="#readable-symbol-asyncdispose"><span><code>readable[Symbol.asyncDispose]()</code></span></a></h3><p><code>readable[Symbol.asyncDispose]()</code> æ˜¯ä¸€ä¸ªå®éªŒæ€§æ–¹æ³•ï¼Œç”¨äºå¼‚æ­¥å…³é—­å¯è¯»æµã€‚å½“ä½ ä¸å†éœ€è¦ä¸€ä¸ªæµï¼Œå¹¶å¸Œæœ›ç¡®ä¿ç›¸å…³èµ„æºï¼ˆå¦‚å†…å­˜å’Œæ–‡ä»¶å¥æŸ„ï¼‰è¢«æ­£ç¡®é‡Šæ”¾æ—¶ï¼Œå¯ä»¥è°ƒç”¨æ­¤æ–¹æ³•ã€‚</p><h4 id="ä½¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ç¤ºä¾‹"><span>ä½¿ç”¨ç¤ºä¾‹</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªåº”ç”¨ï¼Œéœ€è¦ä»ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­è¯»å–æ•°æ®è¿›è¡Œå¤„ç†ï¼Œç„¶åå°†ç»“æœå‘é€åˆ°å®¢æˆ·ç«¯ã€‚ä½¿ç”¨ <code>readable[Symbol.asyncDispose]()</code> å¯ä»¥ç¡®ä¿åœ¨æ•´ä¸ªæ“ä½œå®Œæˆåï¼Œæ–‡ä»¶æµè¢«æ­£ç¡®å…³é—­å’Œæ¸…ç†ï¼Œå³ä½¿è¿‡ç¨‹ä¸­é‡åˆ°äº†é”™è¯¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> processData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // å¤„ç†æ¯ä¸€å—æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å¤„ç†æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      await</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Symbol</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">asyncDispose</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æœ‰ä¸€ä¸ªåä¸º &#39;data.txt&#39; çš„æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">processData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">__dirname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>createReadStream</code> ç”¨äºåˆ›å»ºä¸€ä¸ªä»æ–‡ä»¶è¯»å–æ•°æ®çš„æµã€‚é€šè¿‡ä½¿ç”¨ <code>for await...of</code> å¾ªç¯ï¼Œæˆ‘ä»¬å¯ä»¥å¼‚æ­¥åœ°è¯»å–æµä¸­çš„æ¯ä¸€å—æ•°æ®å¹¶è¿›è¡Œå¤„ç†ã€‚å¦‚æœå¤„ç†è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œæˆ–è€…åœ¨å¤„ç†å®Œæˆåï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>finally</code> å—æ¥ç¡®ä¿è°ƒç”¨ <code>stream[Symbol.asyncDispose]()</code>ï¼Œè¿™æ ·æ— è®ºå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Œèµ„æºéƒ½ä¼šè¢«æ­£ç¡®æ¸…ç†ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œ<code>readable[Symbol.asyncDispose]()</code> æä¾›äº†ä¸€ç§æ›´å®‰å…¨ä¸”æ˜“äºç®¡ç†çš„æ–¹å¼æ¥å¤„ç† Node.js ä¸­çš„å¯è¯»æµï¼Œç¡®ä¿èµ„æºå¾—åˆ°æœ‰æ•ˆç®¡ç†ï¼Œå¯¹äºæ„å»ºé«˜æ•ˆä¸”ç¨³å®šçš„ Node.js åº”ç”¨è‡³å…³é‡è¦ã€‚</p><h5 id="readable-compose-stream-options" tabindex="-1"><a class="header-anchor" href="#readable-compose-stream-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablecomposestream-options" target="_blank" rel="noopener noreferrer">readable.compose(stream[, options])</a></span></a></h5><p>å¥½çš„ï¼Œæ¥èŠèŠ Node.js ä¸­ <code>readable.compose(stream[, options])</code> çš„æ¦‚å¿µå’Œå®ƒåœ¨å®é™…ä¸­çš„åº”ç”¨ã€‚</p><p>é¦–å…ˆï¼Œäº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ Streamï¼ˆæµï¼‰ã€‚æµæ˜¯ä¸€ç§å¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“ä½ å¤„ç†å¤§é‡æ•°æ®ï¼Œæˆ–è€…è¯´ä½ ä¸å¸Œæœ›ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®éƒ½è½½å…¥å†…å­˜ä¸­æ—¶ã€‚åœ¨ Node.js ä¸­ï¼Œæµè¢«å¹¿æ³›ç”¨äºè¯»å†™æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰åœºæ™¯ã€‚</p><p>ç°åœ¨ï¼Œåˆ°äº† <code>readable.compose()</code> çš„éƒ¨åˆ†ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨ Node.js v16.5.0 ç‰ˆæœ¬ä¸­å¼•å…¥çš„ï¼Œå…è®¸ä½ å°†ä¸€ä¸ªæˆ–å¤šä¸ªå¯è¯»æµç»„åˆæˆå•ä¸€çš„å¯è¯»æµã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥é¡ºåºåœ°ã€æ— ç¼åœ°ä»å¤šä¸ªæºè¯»å–æ•°æ®ï¼Œå°±å¥½åƒå®ƒä»¬æ˜¯ä¸€ä¸ªè¿ç»­çš„æ•°æ®æºä¸€æ ·ã€‚</p><h3 id="å‚æ•°è§£é‡Š-1" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š-1"><span>å‚æ•°è§£é‡Š</span></a></h3><ul><li><code>stream</code>: è¿™æ˜¯ä½ æƒ³è¦ç»„åˆè¿›å½“å‰å¯è¯»æµçš„å¦ä¸€ä¸ªæµã€‚</li><li><code>options</code>: è¿™ä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œå…è®¸ä½ æŒ‡å®šä¸€äº›é…ç½®é€‰é¡¹ï¼Œæ¯”å¦‚æµçš„è¯»å–æ¨¡å¼ç­‰ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-13" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-13"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªæ—¥å¿—ç³»ç»Ÿï¼Œéœ€è¦ä»å‡ ä¸ªä¸åŒçš„æ—¥å¿—æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œç„¶åæŠŠè¿™äº›æ•°æ®ä½œä¸ºä¸€ä¸ªå•ä¸€çš„æ•°æ®æµè¿›è¡Œå¤„ç†ã€‚ä½ å¯èƒ½æœ‰ä¸‰ä¸ªæ—¥å¿—æ–‡ä»¶ï¼š<code>log1.txt</code>ã€<code>log2.txt</code>å’Œ<code>log3.txt</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸‰ä¸ªå¯è¯»æµï¼Œåˆ†åˆ«å¯¹åº”ä¸‰ä¸ªæ—¥å¿—æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> logStream1</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/log1.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> logStream2</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/log2.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> logStream3</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/log3.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæ–°çš„å¯è¯»æµï¼Œæš‚æ—¶è¿˜æ²¡æœ‰æ•°æ®æº</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> composedLogStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {}, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç”±äºæˆ‘ä»¬å°†ä»å…¶ä»–æµä¸­â€œå¯¼å…¥â€æ•°æ®ï¼Œè¿™é‡Œä¸éœ€è¦å®ç°ä»»ä½•è¯»å–é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ compose æ–¹æ³•å°†ä¸‰ä¸ªæ—¥å¿—æ–‡ä»¶çš„æµç»„åˆèµ·æ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">composedLogStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">compose</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">logStream1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">composedLogStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">compose</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">logStream2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">composedLogStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">compose</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">logStream3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç°åœ¨ï¼ŒcomposedLogStream åŒ…å«äº†ä¸‰ä¸ªæ—¥å¿—æ–‡ä»¶çš„å†…å®¹ï¼Œä½ å¯ä»¥åƒå¤„ç†å•ä¸ªæµä¸€æ ·å¤„ç†å®ƒ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">composedLogStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ <code>createReadStream</code> åˆ›å»ºä¸‰ä¸ªè¡¨ç¤ºä¸åŒæ—¥å¿—æ–‡ä»¶çš„å¯è¯»æµï¼Œç„¶åä½¿ç”¨ <code>readable.compose()</code> æ–¹æ³•å°†å®ƒä»¬ç»„åˆæˆä¸€ä¸ªå•ç‹¬çš„æµ <code>composedLogStream</code>ã€‚æœ€åï¼Œæˆ‘ä»¬ç›‘å¬ <code>composedLogStream</code> ä¸Šçš„ <code>data</code> äº‹ä»¶æ¥å¤„ç†åˆå¹¶åæµçš„æ•°æ®ã€‚</p><p>è¿™ç§æ–¹å¼ä½¿å¾—å¤„ç†å¤šä¸ªæ•°æ®æºå˜å¾—æ›´åŠ ç®€æ´å’Œç›´è§‚ã€‚ä½ ä¸å†éœ€è¦æ‰‹åŠ¨ç®¡ç†æ¯ä¸ªå•ç‹¬çš„æµï¼Œæˆ–è€…æ‹…å¿ƒå¦‚ä½•åŒæ­¥å®ƒä»¬çš„æ•°æ®è¯»å– â€”â€” <code>compose</code> æ–¹æ³•å¸®ä½ æå®šäº†è¿™ä¸€åˆ‡ã€‚</p><p>æ€»ä¹‹ï¼Œ<code>readable.compose()</code> æä¾›äº†ä¸€ç§å¼ºå¤§ä¸”çµæ´»çš„æ–¹å¼æ¥å¤„ç†å’Œç»„ç»‡æ¥è‡ªå¤šä¸ªæ¥æºçš„æ•°æ®æµï¼Œç‰¹åˆ«æ˜¯åœ¨ä½ éœ€è¦æŒ‰é¡ºåºå¤„ç†å¤šä¸ªæ•°æ®æºçš„åœºæ™¯ä¸­ã€‚</p><h5 id="readable-iterator-options" tabindex="-1"><a class="header-anchor" href="#readable-iterator-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readableiteratoroptions" target="_blank" rel="noopener noreferrer">readable.iterator([options])</a></span></a></h5><p>äº†è§£ Node.js ä¸­çš„<code>readable.iterator([options])</code>åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•æ˜äº†åœ°ç†è§£å‡ ä¸ªæ¦‚å¿µï¼š</p><ol><li><strong>Node.js</strong>ï¼šä¸€ä¸ªè®© JavaScript å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œçš„å¹³å°ã€‚</li><li><strong>Streamsï¼ˆæµï¼‰</strong>ï¼šåœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†è¯»å–æˆ–å†™å…¥æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚æƒ³è±¡æˆæ°´æµï¼Œæ•°æ®åƒæ°´ä¸€æ ·ä»ä¸€å¤„æµå‘å¦ä¸€å¤„ã€‚</li><li><strong>Readable Streamsï¼ˆå¯è¯»æµï¼‰</strong>ï¼šä¸€ç§æµï¼Œä¸“é—¨ç”¨äºè¯»å–æ•°æ®ï¼Œæ¯”å¦‚ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚</li></ol><p>å¥½ï¼Œç°åœ¨æˆ‘ä»¬æ¥èšç„¦äº<code>readable.iterator([options])</code>ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-readable-iterator-options" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-readable-iterator-options"><span>ä»€ä¹ˆæ˜¯ <code>readable.iterator([options])</code>ï¼Ÿ</span></a></h3><p>è¿™æ˜¯ Node.js ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå±äº Readable Streamï¼ˆå¯è¯»æµï¼‰ã€‚å®ƒå…è®¸ä½ ä»¥å¼‚æ­¥è¿­ä»£å™¨çš„å½¢å¼é€ä¸ªå¤„ç†æµä¸­çš„æ•°æ®ç‰‡æ®µã€‚æ¢å¥è¯è¯´ï¼Œä½ å¯ä»¥ä¸€å—ä¸€å—åœ°è·å–å¹¶æ“ä½œæ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰æ•°æ®å…¨éƒ¨åŠ è½½è¿›å†…å­˜ã€‚</p><h3 id="options-å‚æ•°" tabindex="-1"><a class="header-anchor" href="#options-å‚æ•°"><span>Options å‚æ•°</span></a></h3><ul><li><strong><code>options</code></strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå…è®¸ä½ è‡ªå®šä¹‰è¿­ä»£å™¨çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼š <ul><li><strong><code>encoding</code></strong>ï¼šæŒ‡å®šæ–‡æœ¬ç¼–ç æ ¼å¼ï¼Œå¦‚<code>&#39;utf8&#39;</code>ã€‚</li><li><strong><code>highWaterMark</code></strong>ï¼šè®¾ç½®å†…éƒ¨ç¼“å†²åŒºå¤§å°çš„ä¸Šé™ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹äºå¯¹è±¡æ¨¡å¼æµï¼Œå…¶å€¼ä¸º 16ï¼ˆè¡¨ç¤º 16 ä¸ªå¯¹è±¡ï¼‰ï¼Œå¯¹äºå…¶ä»–ç±»å‹çš„æµï¼Œé»˜è®¤å€¼åˆ™ä¸º 64 * 1024ï¼ˆå³ 64KBï¼‰ã€‚</li></ul></li></ul><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-7" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-7"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œä½ å¸Œæœ›é€è¡Œè¯»å–å¹¶å¤„ç†æ¯ä¸€è¡Œæ•°æ®ï¼Œä½†åˆä¸æƒ³ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼ˆå› ä¸ºè¿™å¯èƒ½ä¼šæ¶ˆè€—å¤§é‡çš„å†…å­˜èµ„æºï¼‰ã€‚è¿™æ—¶ï¼Œ<code>readable.iterator()</code>å°±æ˜¾å¾—éå¸¸æœ‰ç”¨ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç " tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç "><span>ç¤ºä¾‹ä»£ç ï¼š</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµï¼Œä»ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">__dirname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;big-file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨readable.iterator()éå†æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  for</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¤„ç†æ¯ä¸€ä¸ªæ•°æ®å—ï¼ˆchunkï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å‡è®¾ä½ åªæ‰“å°å‡ºæ•°æ®å—æ¥æŸ¥çœ‹ï¼Œå®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½éœ€è¦åšæ›´å¤æ‚çš„å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">})();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡<code>fs.createReadStream</code>åˆ›å»ºäº†ä¸€ä¸ªå¯è¯»æµæ¥è¯»å–åä¸º<code>big-file.txt</code>çš„æ–‡ä»¶å†…å®¹ã€‚ç„¶åï¼Œé€šè¿‡<code>readable.iterator()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¼‚æ­¥åœ°è¿­ä»£æ¯ä¸€å—æ•°æ®ï¼Œä¸€æ¬¡å¤„ç†ä¸€ä¸ªæ•°æ®å—ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶å†…å®¹åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™æ ·èƒ½æœ‰æ•ˆæ§åˆ¶å†…å­˜ä½¿ç”¨ï¼Œæé«˜ç¨‹åºçš„æ•ˆç‡å’Œæ€§èƒ½ã€‚</p><h3 id="ç»“è®º-2" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-2"><span>ç»“è®º</span></a></h3><p>ä½¿ç”¨<code>readable.iterator([options])</code>å¯ä»¥å¸®åŠ©ä½ æ›´æœ‰æ•ˆã€æ›´çµæ´»åœ°å¤„ç†å¤§é‡æ•°æ®ï¼Œç‰¹åˆ«æ˜¯å½“ä½ ä¸æƒ³æˆ–ä¸èƒ½ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®åˆ°å†…å­˜ä¸­æ—¶ã€‚é€šè¿‡å¼‚æ­¥è¿­ä»£å™¨çš„ç‰¹æ€§ï¼Œç»“åˆ Node.js çš„éé˜»å¡ IO ä¼˜åŠ¿ï¼Œå®ƒæå¤§åœ°æå‡äº†å¤„ç†å¤§å‹æ•°æ®é›†æ—¶çš„æ€§èƒ½å’Œæ•ˆç‡ã€‚</p><h5 id="readable-map-fn-options" tabindex="-1"><a class="header-anchor" href="#readable-map-fn-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablemapfn-options" target="_blank" rel="noopener noreferrer">readable.map(fn[, options])</a></span></a></h5><p>Node.js ä¸­çš„<code>readable.map(fn[, options])</code>æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°çš„åŠŸèƒ½ï¼ŒåŠ å…¥åˆ°äº†æµ(Streams) API ä¸­ï¼Œä½¿å¾—å¤„ç†æµæ•°æ®å˜å¾—æ›´ä¸ºç®€ä¾¿ã€‚è¦ç†è§£è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-3" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-3"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><ul><li><strong>Node.js:</strong> ä¸€ä¸ªå¯ä»¥è®©ä½ ä½¿ç”¨ JavaScript ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚</li><li><strong>Streams:</strong> åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§å¤„ç†è¯»å†™æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ IO æ“ä½œçš„æ–¹å¼ã€‚å®ƒä»¬å…è®¸æ•°æ®è¢«é€æ­¥å¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™å¯¹äºå¤„ç†å¤§æ–‡ä»¶æˆ–å®æ—¶æ•°æ®ä¼ è¾“å°¤å…¶æœ‰ç”¨ã€‚</li><li><strong>Readable Streams:</strong> æ˜¯ä¸€ç§æµï¼Œä»ä¸­ä½ å¯ä»¥è¯»å–æ•°æ®ã€‚æ¯”å¦‚ï¼Œå½“ä½ ä»æ–‡ä»¶è¯»å–æ•°æ®æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨å¯è¯»æµã€‚</li></ul><h3 id="readable-map-fn-options-è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#readable-map-fn-options-è§£é‡Š"><span><code>readable.map(fn[, options])</code> è§£é‡Š</span></a></h3><p><code>readable.map()</code>æ–¹æ³•å…ä½ åœ¨æµç»è¿‡çš„æ¯ä¸€å—æ•°æ®ä¸Šæ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œå¹¶å°†è¯¥å‡½æ•°çš„è¿”å›å€¼ä½œä¸ºæ–°çš„æµæ•°æ®ã€‚è¿™ç±»ä¼¼äºæ•°ç»„çš„<code>map()</code>æ–¹æ³•ï¼Œä½†åº”ç”¨äºæµæ•°æ®ã€‚</p><ul><li><strong>fn</strong>: è¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå°†ä¼šæ¥æ”¶åŸå§‹æ•°æ®å—ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›è½¬æ¢åçš„æ•°æ®å—ã€‚</li><li><strong>options</strong>: å¯é€‰å‚æ•°ï¼Œç”¨äºæ§åˆ¶æ˜ å°„æ“ä½œçš„ä¸€äº›ç»†èŠ‚ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-14" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-14"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ˆ<code>data.txt</code>ï¼‰ï¼Œé‡Œé¢åŒ…å«äº†å¤šè¡Œæ•°å­—ï¼Œæ¯è¡Œä¸€ä¸ªæ•°å­—ï¼Œæˆ‘ä»¬æƒ³é€è¡Œè¯»å–è¿™äº›æ•°å­—ï¼Œå°†æ¯ä¸ªæ•°å­—ä¹˜ä»¥ 2ï¼Œç„¶åè¾“å‡ºç»“æœã€‚</p><ol><li><p><strong>ä¸ä½¿ç”¨<code>readable.map</code>çš„æƒ…å†µ</strong>:</p><p>æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è¯»å–æµä¸­çš„æ•°æ®ï¼Œå¤„ç†æ•°æ®ï¼Œç„¶åè¾“å‡ºã€‚è¿™æ¶‰åŠåˆ°ç›‘å¬äº‹ä»¶å’Œæ‰‹åŠ¨å¤„ç†æ•°æ®è½¬æ¢ã€‚</p></li><li><p><strong>ä½¿ç”¨<code>readable.map</code>çš„æƒ…å†µ</strong>:</p><p>ä½¿ç”¨<code>readable.map</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–å¤„ç†æµç¨‹ã€‚</p></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥è¯»å–æ–‡ä»¶å†…å®¹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  highWaterMark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æŒ‡å®šæ¯æ¬¡è¯»å–æ–‡ä»¶çš„å­—èŠ‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨readable.mapå¯¹è¯»å–çš„æ•°æ®è¿›è¡Œå¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> mappedStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">split</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æ•°æ®æ˜¯æŒ‰è¡Œåˆ†éš”çš„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">Boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç§»é™¤ç©ºè¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">number</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> number</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†æ¯è¡Œçš„æ•°å­—ä¹˜ä»¥2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é‡æ–°æŒ‰è¡Œè¿æ¥æˆå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬å¤„ç†åçš„æ•°æ®æµï¼Œå¹¶è¾“å‡ºç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">mappedStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªå¯è¯»æµæ¥è¯»å–æ–‡ä»¶<code>data.txt</code>çš„å†…å®¹ã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ©ç”¨<code>readable.map</code>æ–¹æ³•å¯¹æ¯ä¸€å—è¯»å–çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼šå°†å…¶åˆ†å‰²æˆè¡Œã€å»é™¤ç©ºè¡Œã€å°†æ¯è¡Œçš„æ•°å­—ä¹˜ä»¥ 2ã€å¹¶é‡æ–°ç»„åˆæˆå­—ç¬¦ä¸²ã€‚æœ€åï¼Œæˆ‘ä»¬ç›‘å¬å¤„ç†åçš„æ•°æ®æµï¼Œå¹¶è¾“å‡ºç»“æœã€‚</p><p>é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿åœ°åœ¨æ•°æ®æµä¸­å®ç°å¤æ‚çš„æ•°æ®å¤„ç†é€»è¾‘ï¼Œè€Œæ— éœ€æ‹…å¿ƒåº•å±‚çš„æµæ§åˆ¶é—®é¢˜ã€‚è¿™ä½¿å¾—ä»£ç æ›´åŠ ç®€æ´æ˜“è¯»ï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†æ•ˆç‡ã€‚</p><h5 id="readable-filter-fn-options" tabindex="-1"><a class="header-anchor" href="#readable-filter-fn-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablefilterfn-options" target="_blank" rel="noopener noreferrer">readable.filter(fn[, options])</a></span></a></h5><p>Node.js ä¸­çš„ <code>readable.filter(fn[, options])</code> æ˜¯ä¸€ä¸ªæµï¼ˆstreamï¼‰å¤„ç†çš„æ–¹æ³•ï¼Œå®ƒå…è®¸ä½ æŒ‰ç…§ç‰¹å®šçš„æ¡ä»¶ç­›é€‰æ•°æ®ã€‚è¿™ä¸ªåŠŸèƒ½æ˜¯åœ¨ Node.js çš„è¾ƒæ–°ç‰ˆæœ¬ä¸­å¼•å…¥çš„ï¼Œä½¿å¾—å¤„ç†æµæ•°æ®æ›´åŠ çµæ´»å’Œå¼ºå¤§ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-4" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-4"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>åœ¨æ·±å…¥äº†è§£è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç®€å•æ˜ç™½å‡ ä¸ªå…³é”®ç‚¹ï¼š</p><ul><li><strong>æµï¼ˆStreamï¼‰</strong>ï¼šåœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç³»åˆ—æ•°æ®çš„é›†åˆï¼Œç±»ä¼¼äºæ•°ç»„æˆ–å­—ç¬¦ä¸²ï¼Œä½†ä¸å®ƒä»¬ä¸åŒçš„æ˜¯ï¼Œæµæ•°æ®æ˜¯éšæ—¶é—´é€æ¸å¤„ç†çš„ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ã€æˆ–è€…å³å¯è¯»åˆå¯å†™ã€‚</li><li><strong>å¯è¯»æµï¼ˆReadable Streamï¼‰</strong>ï¼šä¸€ç§ä»æŸå¤„è¯»å–æ•°æ®çš„æµï¼Œä¾‹å¦‚ä»æ–‡ä»¶ç³»ç»Ÿè¯»å–æ–‡ä»¶ã€ä»ç½‘ç»œè¯·æ±‚è¯»å–å“åº”ç­‰ã€‚</li></ul><h3 id="å…³äº-readable-filter-fn-options" tabindex="-1"><a class="header-anchor" href="#å…³äº-readable-filter-fn-options"><span>å…³äº <code>readable.filter(fn[, options])</code></span></a></h3><ul><li><strong>å«ä¹‰</strong>ï¼š<code>readable.filter()</code> æ–¹æ³•å…è®¸ä½ æ ¹æ®æä¾›çš„å‡½æ•°ï¼ˆ<code>fn</code>ï¼‰æ¥ç­›é€‰æµä¸­çš„æ•°æ®ã€‚åªæœ‰é‚£äº›å‡½æ•°è¿”å› <code>true</code> çš„æ•°æ®å…ƒç´ æ‰ä¼šè¢«ä¿ç•™å’Œä¼ é€’ä¸‹å»ã€‚</li><li><strong><code>fn</code> å‡½æ•°</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªç­›é€‰å‡½æ•°ï¼Œç”¨äºå†³å®šå“ªäº›å…ƒç´ åº”è¯¥è¢«åŒ…æ‹¬åœ¨è¿‡æ»¤åçš„æµä¸­ã€‚è¿™ä¸ªå‡½æ•°æ¥å—å½“å‰çš„æ•°æ®é¡¹ä½œä¸ºå‚æ•°ï¼Œå¦‚æœæ•°æ®é¡¹åº”è¯¥è¢«ä¿ç•™ï¼Œåˆ™è¿”å› <code>true</code>ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code>ã€‚</li><li><strong><code>options</code> å‚æ•°</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œæä¾›äº†ä¸€ç§æ–¹å¼æ¥é…ç½®ä¸€äº›é¢å¤–çš„è¡Œä¸ºï¼Œæ¯”å¦‚æ§åˆ¶å¯¹è±¡æ¨¡å¼ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-8" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-8"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨å¤„ç†ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶æµï¼Œæ–‡ä»¶ä¸­æ¯è¡Œä»£è¡¨ä¸€æ¡è®°å½•ï¼Œæˆ‘ä»¬æƒ³è¦ç­›é€‰å‡ºé‚£äº›ç¬¦åˆç‰¹å®šæ¡ä»¶çš„è¡Œã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ <code>readable.filter(fn[, options])</code> æ–¹æ³•çš„ç®€åŒ–ç¤ºä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º &quot;data.txt&quot; çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬æƒ³è¦è¯»å–è¿™ä¸ªæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  highWaterMark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ§åˆ¶æ¯æ¬¡è¯»å–çš„å­—èŠ‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ filter æ–¹æ³•ç­›é€‰å‡ºåŒ…å« &quot;Node.js&quot; å­—æ ·çš„è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> filteredStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">filter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Node.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ˜¾ç¤ºç­›é€‰åçš„ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">filteredStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Filtered Chunk:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡ <code>fs.createReadStream</code> åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘ &quot;data.txt&quot; æ–‡ä»¶çš„å¯è¯»æµã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡ <code>pipe</code> æ–¹æ³•å°†è¿™ä¸ªæµè¿æ¥åˆ° <code>filter</code> æ–¹æ³•ä¸Šï¼Œ<code>filter</code> æ–¹æ³•å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªç­›é€‰æ¡ä»¶â€”â€”é€‰å‡ºæ‰€æœ‰åŒ…å« &quot;Node.js&quot; å­—æ ·çš„è¡Œã€‚æœ€åï¼Œæˆ‘ä»¬ç›‘å¬ç­›é€‰åçš„æµï¼Œå¹¶åœ¨æ§åˆ¶å°è¾“å‡ºç¬¦åˆæ¡ä»¶çš„æ•°æ®å—ï¼ˆchunkï¼‰ã€‚</p><h3 id="å°ç»“" tabindex="-1"><a class="header-anchor" href="#å°ç»“"><span>å°ç»“</span></a></h3><p><code>readable.filter(fn[, options])</code> æä¾›äº†ä¸€ç§éå¸¸çµæ´»çš„æ–¹å¼æ¥å¤„ç†å’Œè½¬æ¢æµä¸­çš„æ•°æ®ï¼Œæ ¹æ®è‡ªå®šä¹‰çš„é€»è¾‘ç­›é€‰å‡ºæˆ‘ä»¬å…³å¿ƒçš„ä¿¡æ¯ã€‚è¿™å¯¹äºå¤„ç†å¤§é‡æ•°æ®ï¼Œå°¤å…¶æ˜¯åœ¨åªæœ‰éƒ¨åˆ†æ•°æ®ç¬¦åˆæˆ‘ä»¬éœ€æ±‚æ—¶éå¸¸æœ‰ç”¨ã€‚</p><h5 id="readable-foreach-fn-options" tabindex="-1"><a class="header-anchor" href="#readable-foreach-fn-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readableforeachfn-options" target="_blank" rel="noopener noreferrer">readable.forEach(fn[, options])</a></span></a></h5><p>Node.js æ˜¯ä¸€ä¸ªèƒ½è®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ï¼Œå¹¿æ³›ç”¨äºæ„å»ºå„ç§ç½‘ç»œåº”ç”¨ã€‚åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamsï¼‰æ˜¯ä¸€ç§å¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œå°¤å…¶æ˜¯å½“ä½ éœ€è¦å¤„ç†å¤§é‡æ•°æ®æˆ–è€…ä½ æƒ³é€æ­¥æ¥æ”¶æ•°æ®æ—¶ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ï¼Œæˆ–è€…ä¸¤è€…éƒ½æ˜¯ã€‚</p><p>åœ¨ v21.7.1 çš„ Node.js ç‰ˆæœ¬ä¸­å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ç‰¹æ€§ <code>readable.forEach(fn[, options])</code>ï¼Œè¿™å¯¹äºä»¥æ›´ç›´è§‚çš„æ–¹å¼å¤„ç†æµä¸­çš„æ•°æ®éå¸¸æœ‰ç”¨ã€‚ç°åœ¨æˆ‘å°†ç®€å•è§£é‡Šå®ƒçš„å·¥ä½œåŸç†ï¼Œå¹¶é€šè¿‡å‡ ä¸ªä¾‹å­æ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨å®ƒã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-5" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-5"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p><code>readable.forEach(fn[, options])</code> æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå…è®¸ä½ å¯¹æµä¸­çš„æ¯ä¸€å—æ•°æ®æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯â€œéå†â€æµä¸­çš„æ‰€æœ‰æ•°æ®ï¼‰ã€‚è¿™é‡Œçš„ <code>fn</code> è¡¨ç¤ºæ¯æ¥æ”¶åˆ°ä¸€å—æ•°æ®æ—¶è¦æ‰§è¡Œçš„å‡½æ•°ï¼Œè€Œ <code>options</code> å‚æ•°ç”¨æ¥æ§åˆ¶æµçš„è¡Œä¸ºï¼Œæ¯”å¦‚æ˜¯å¦è‡ªåŠ¨å…³é—­æµã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-19" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-19"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-è¯»å–æ–‡ä»¶å†…å®¹å¹¶å¤„ç†æ¯ä¸€è¡Œ" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-è¯»å–æ–‡ä»¶å†…å®¹å¹¶å¤„ç†æ¯ä¸€è¡Œ"><span>ä¾‹å­ 1ï¼šè¯»å–æ–‡ä»¶å†…å®¹å¹¶å¤„ç†æ¯ä¸€è¡Œ</span></a></h4><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ <code>log.txt</code>ï¼Œæˆ‘ä»¬æƒ³é€è¡Œè¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶ä¸”å¯¹æ¯ä¸€è¡Œåšä¸€äº›å¤„ç†ï¼ˆä¾‹å¦‚æ‰“å°å‡ºæ¥ï¼‰ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;log.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ readline åˆ›å»ºä¸€ä¸ªé€è¡Œå¤„ç†çš„æ¥å£</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> rl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  input</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  crlfDelay</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">Infinity</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ forEach éå†æµä¸­çš„æ¯ä¸€è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">rl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;line&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`å¤„ç†æ–‡ä»¶çš„ä¸€è¡Œï¼š</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">line</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè™½ç„¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨ <code>readable.forEach</code>ï¼Œä½†å±•ç¤ºäº†å¦‚ä½•é€è¡Œè¯»å–å’Œå¤„ç†æµä¸­çš„æ•°æ®ã€‚<code>readable.forEach</code> æä¾›äº†å¦ä¸€ç§æ–¹å¼æ¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½†ä»¥æ›´ç®€æ´çš„è¯­æ³•ã€‚</p><h4 id="ä¾‹å­-2-å¤„ç†ä»-http-è¯·æ±‚æ¥æ”¶çš„æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-å¤„ç†ä»-http-è¯·æ±‚æ¥æ”¶çš„æ•°æ®"><span>ä¾‹å­ 2ï¼šå¤„ç†ä» HTTP è¯·æ±‚æ¥æ”¶çš„æ•°æ®</span></a></h4><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦ä»æŸä¸ª API è·å–æ•°æ®ï¼Œå¹¶å¯¹æ¯ä¸ªæ•°æ®é¡¹è¿›è¡Œå¤„ç†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘èµ·ä¸€ä¸ª HTTP GET è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://api.example.com/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ä½¿ç”¨ forEach å¤„ç†å“åº”æµä¸­çš„æ¯ä¸€å—æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è¿™é‡Œå¯ä»¥å¯¹æ¥æ”¶åˆ°çš„æ•°æ®å—è¿›è¡Œå¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å‘ä¸€ä¸ª API å‘èµ· GET è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨ <code>forEach</code> æ¥å¤„ç†å“åº”ä½“ä¸­æ¥æ”¶åˆ°çš„æ¯ä¸€å—æ•°æ®ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥å¯¹æ•°æ®è¿›è¡Œå³æ—¶å¤„ç†ï¼Œè€Œä¸å¿…ç­‰å¾…æ•´ä¸ªå“åº”ä½“è¢«æ¥æ”¶å®Œæ¯•ã€‚</p><h3 id="å°ç»“-1" tabindex="-1"><a class="header-anchor" href="#å°ç»“-1"><span>å°ç»“</span></a></h3><p><code>readable.forEach(fn[, options])</code> æ–¹æ³•ä¸ºå¤„ç† Node.js ä¸­çš„æµæ•°æ®æä¾›äº†ä¸€ä¸ªæ›´åŠ ç›´è§‚å’Œæ–¹ä¾¿çš„æ–¹å¼ã€‚é€šè¿‡éå†æµä¸­çš„æ•°æ®å—ï¼Œæˆ‘ä»¬å¯ä»¥æ›´çµæ´»åœ°å¤„ç†æ•°æ®ï¼Œæ— è®ºæ˜¯æ¥è‡ªæ–‡ä»¶ã€ç½‘ç»œè¯·æ±‚è¿˜æ˜¯å…¶ä»–æºå¤´ã€‚è¿™ä¸ªæ–¹æ³•ç®€åŒ–äº†æµæ•°æ®å¤„ç†çš„ä»£ç ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿä»¥æ›´é«˜æ•ˆå’Œæ˜“äºç†è§£çš„æ–¹å¼ç¼–å†™ç›¸å…³åŠŸèƒ½ã€‚</p><h5 id="readable-toarray-options" tabindex="-1"><a class="header-anchor" href="#readable-toarray-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readabletoarrayoptions" target="_blank" rel="noopener noreferrer">readable.toArray([options])</a></span></a></h5><p>å½“æˆ‘ä»¬è°ˆè®º Node.jsï¼Œæˆ‘ä»¬åœ¨è°ˆè®ºçš„æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œè®©ä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚Node.js æœ‰å¾ˆå¤šå†…ç½®æ¨¡å—ï¼Œå…¶ä¸­ <code>stream</code> æ¨¡å—æ˜¯éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæä¾›äº†ä¸€ç§å¤„ç†æµæ•°æ®ï¼ˆæ¯”å¦‚ä»æ–‡ä»¶è¯»å–æ•°æ®æˆ–ç½‘ç»œé€šä¿¡ï¼‰çš„æ–¹å¼ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-stream-2" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-stream-2"><span>ä»€ä¹ˆæ˜¯ Stream</span></a></h3><p>åœ¨ Node.js ä¸­ï¼ŒStream æ˜¯ä¸€ç³»åˆ—æ•°æ®çš„é›†åˆ â€”â€” æƒ³è±¡æˆä¸€æ¡æ²³æµï¼Œæ•°æ®å°±åƒæ²³é‡Œçš„æ°´ä¸€æ ·ï¼Œä»ä¸€ä¸ªåœ°æ–¹æµå‘å¦ä¸€ä¸ªåœ°æ–¹ã€‚Streams å¯ä»¥é«˜æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®ï¼Œå› ä¸ºä½ ä¸éœ€è¦ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œæ˜¯å¯ä»¥ä¸€ç‚¹ç‚¹åœ°å¤„ç†ã€‚</p><h3 id="readable-toarray-options-1" tabindex="-1"><a class="header-anchor" href="#readable-toarray-options-1"><span><code>readable.toArray([options])</code></span></a></h3><p>è¿™ä¸ªæ–¹æ³•æ˜¯ <code>Readable</code> stream çš„ä¸€éƒ¨åˆ†ï¼Œå…è®¸ä½ å°†æµä¸­çš„æ‰€æœ‰æ•°æ®æ”¶é›†åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚è¿™éå¸¸æœ‰ç”¨ï¼Œå½“ä½ æƒ³è¦å¤„ç†æµä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œä½†åˆå¸Œæœ›ç­‰åˆ°æ‰€æœ‰æ•°æ®éƒ½å¯ç”¨æ—¶å†è¿›è¡Œå¤„ç†ã€‚</p><h4 id="å‚æ•°-options" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-options"><span>å‚æ•°ï¼š<code>options</code></span></a></h4><ul><li><code>options</code> å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒæ¥æ§åˆ¶å¦‚ä½•å¤„ç†æµæ•°æ®ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æŒ‡å®šç¼–ç ç±»å‹ã€‚</li></ul><h4 id="è¿”å›å€¼-3" tabindex="-1"><a class="header-anchor" href="#è¿”å›å€¼-3"><span>è¿”å›å€¼</span></a></h4><ul><li>è°ƒç”¨è¿™ä¸ªæ–¹æ³•åï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª Promiseï¼Œè¿™ä¸ª Promise è§£æä¸ºåŒ…å«æµä¸­æ‰€æœ‰æ•°æ®çš„æ•°ç»„ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-11" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-11"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-è¯»å–æ–‡ä»¶å†…å®¹" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-è¯»å–æ–‡ä»¶å†…å®¹"><span>ç¤ºä¾‹ 1ï¼šè¯»å–æ–‡ä»¶å†…å®¹</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªå¤§å‹æ–‡æœ¬æ–‡ä»¶ï¼Œä½ æƒ³è¦è¯»å–è¿™ä¸ªæ–‡ä»¶çš„å…¨éƒ¨å†…å®¹ï¼Œå¹¶ä¸”å°†å…¶æŒ‰è¡Œåˆ’åˆ†åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">EOL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;os&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> readFileToArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readable</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> lines</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> lines</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">split</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">EOL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„æ¢è¡Œç¬¦åˆ†å‰²å­—ç¬¦ä¸²è·å–æ¯ä¸€è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;An error occurred:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">//Tamakkuvik Ying Chao Tea-mit. Atorunnginnaviuk tunisassiornernut.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">readFileToArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/your/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">lines</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;File lines:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">lines</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>createReadStream</code> åˆ›å»ºäº†ä¸€ä¸ªå¯è¯»æµæ¥è¯»å–æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ <code>.toArray()</code> æ–¹æ³•å°†æµä¸­çš„æ‰€æœ‰æ•°æ®æ”¶é›†åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚ç”±äºæˆ‘ä»¬å¤„ç†çš„æ˜¯æ–‡æœ¬æ–‡ä»¶ï¼Œæˆ‘ä»¬è¿˜æŒ‡å®šäº† <code>encoding: &#39;utf8&#39;</code> ä½œä¸ºé€‰é¡¹ï¼Œç¡®ä¿æ­£ç¡®è§£ææ–‡æœ¬ã€‚</p><p>è¯·æ³¨æ„ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯¹äºéå¸¸å¤§çš„æ–‡ä»¶ï¼Œç›´æ¥ä½¿ç”¨ <code>.toArray()</code> å¯èƒ½ä¸æ˜¯æœ€ä½³å®è·µï¼Œå› ä¸ºå®ƒä¼šå°†æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹åŠ è½½åˆ°å†…å­˜ä¸­ã€‚å¯¹äºæ›´å¤§çš„æ•°æ®é›†ï¼Œæ›´æ¨èä½¿ç”¨æµçš„æ–¹å¼é€å—å¤„ç†æ•°æ®ã€‚</p><h4 id="ç¤ºä¾‹-2-ç½‘ç»œè¯·æ±‚-1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ç½‘ç»œè¯·æ±‚-1"><span>ç¤ºä¾‹ 2ï¼šç½‘ç»œè¯·æ±‚</span></a></h4><p>å‡è®¾ä½ æƒ³è¦ä»ç½‘ç»œä¸ŠæŸä¸ªèµ„æºè·å–æ•°æ®ï¼Œå¹¶å°†æ‰€æœ‰çš„å“åº”æ•°æ®æ”¶é›†åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    https</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        res</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">            resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://api.example.com/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">dataArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Data:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">concat</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dataArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨äº† <code>https</code> æ¨¡å—æ¥å‘èµ·ä¸€ä¸ª GET è¯·æ±‚ã€‚æˆ‘ä»¬è°ƒç”¨ <code>.toArray()</code> æ¥å°†å“åº”ä½“æ”¶é›†åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>Buffer.concat(dataArray).toString()</code> å°†æ‰€æœ‰ç‰‡æ®µæ‹¼æ¥èµ·æ¥å¹¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚</p><p>å¸Œæœ›è¿™äº›è§£é‡Šå’Œç¤ºä¾‹èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ Node.js ä¸­ <code>readable.toArray([options])</code> çš„ç”¨æ³•ï¼</p><h5 id="readable-some-fn-options" tabindex="-1"><a class="header-anchor" href="#readable-some-fn-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablesomefn-options" target="_blank" rel="noopener noreferrer">readable.some(fn[, options])</a></span></a></h5><p>ç†è§£ <code>readable.some(fn[, options])</code> æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆäº†è§£ Node.js ä¸­çš„ Streamsï¼ˆæµï¼‰å’Œ <code>Readable</code> æµã€‚Node.js ä¸­çš„æµæ˜¯å¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œæ¯”å¦‚è¯»å–æˆ–å†™å†™å…¥æ•°æ®åˆ°æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ã€‚æµå¯ä»¥é«˜æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®ï¼Œå› ä¸ºå®ƒä»¬å…è®¸æ•°æ®ä¸€å°å—ä¸€å°å—åœ°è¢«å¤„ç†ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ•°æ®å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><p><code>Readable</code> æµæ˜¯æµçš„ä¸€ç§ç±»å‹ï¼Œç”¨äºè¯»å–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå½“ä½ ä»æ–‡ä»¶è¯»å–æ•°æ®æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>Readable</code> æµã€‚</p><h3 id="readable-some-fn-options-1" tabindex="-1"><a class="header-anchor" href="#readable-some-fn-options-1"><span>readable.some(fn[, options])</span></a></h3><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>readable.some(fn[, options])</code> æ˜¯ <code>Readable</code> æµçš„ä¸€ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ç”¨äºæµ‹è¯•æµä¸­çš„æ•°æ®å…ƒç´ æ˜¯å¦è‡³å°‘æœ‰ä¸€ä¸ªæ»¡è¶³æä¾›çš„æµ‹è¯•å‡½æ•°ï¼ˆ<code>fn</code>ï¼‰ã€‚å¦‚æœæ‰¾åˆ°è‡³å°‘ä¸€ä¸ªå…ƒç´ ä½¿å¾—æµ‹è¯•å‡½æ•°è¿”å› <code>true</code>ï¼Œåˆ™ <code>some</code> æ–¹æ³•ä¼šç«‹å³ç»“æŸå¹¶è¿”å›ä¸€ä¸ªè§£æä¸º <code>true</code> çš„ Promiseã€‚å¦‚æœæµç»“æŸå¹¶ä¸”æ²¡æœ‰å…ƒç´ æ»¡è¶³æµ‹è¯•æ¡ä»¶ï¼Œé‚£ä¹ˆè¿”å›çš„ Promise å°†è§£æä¸º <code>false</code>ã€‚</p><h4 id="å‚æ•°-4" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-4"><span>å‚æ•°</span></a></h4><ul><li><code>fn</code>: ä¸€ä¸ªæµ‹è¯•å‡½æ•°ï¼Œæ¥å—æµä¸­çš„æ¯ä¸ªæ•°æ®å—ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li><li><code>options</code> (å¯é€‰): ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨äºé…ç½®æ–¹æ³•çš„è¡Œä¸ºï¼Œä¾‹å¦‚è®¾ç½®æµæ“ä½œçš„è¶…æ—¶æ—¶é—´ã€‚</li></ul><h4 id="ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1"><span>ç¤ºä¾‹</span></a></h4><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ <code>numbers.txt</code>ï¼Œé‡Œé¢åŒ…å«äº†ä¸€ç³»åˆ—æ•°å­—ï¼Œæ¯ä¸ªæ•°å­—å ä¸€è¡Œã€‚æˆ‘ä»¬æƒ³æ£€æŸ¥è¿™ä¸ªæ–‡ä»¶ä¸­æ˜¯å¦è‡³å°‘æœ‰ä¸€ä¸ªæ•°å­—å¤§äº 50ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> checkNumber</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;numbers.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    highWaterMark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¯æ¬¡è¯»å– 1KB æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> hasLargeNumber</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">some</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åˆ†å‰²æ•°æ®å—ä¸ºå•ç‹¬çš„æ•°å­—ï¼Œç„¶åæ£€æŸ¥æ˜¯å¦å­˜åœ¨å¤§äº 50 çš„æ•°å­—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> numbers</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">split</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">Number</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> numbers</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">some</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">num</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> num</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 50</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    hasLargeNumber</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Found a number greater than 50&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;No number greater than 50 found&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">checkNumber</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>fs.createReadStream</code> åˆ›å»ºä¸€ä¸ª <code>Readable</code> æµæ¥è¯»å– <code>numbers.txt</code> æ–‡ä»¶ã€‚ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨ <code>readable.some()</code> æ–¹æ³•æ¥æ£€æŸ¥æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨å¤§äº 50 çš„æ•°å­—ã€‚æµ‹è¯•å‡½æ•° (<code>fn</code>) æ¥æ”¶æµä¸­çš„æ•°æ®å—ï¼Œå°†å…¶åˆ†å‰²æˆå•ç‹¬çš„è¡Œï¼Œè½¬æ¢ä¸ºæ•°å­—ï¼Œç„¶åæ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•æ•°å­—å¤§äº 50ã€‚</p><p>æ³¨æ„ï¼Œè¿™é‡Œçš„å…³é”®æ˜¯åˆ©ç”¨æµçš„èƒ½åŠ›æ¥é€å—å¤„ç†æ•°æ®ï¼Œè¿™å¯¹äºå¤„ç†å¤§æ–‡ä»¶ç‰¹åˆ«æœ‰æ•ˆï¼Œå› ä¸ºå®ƒé¿å…äº†ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶å†…å®¹åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><h5 id="readable-find-fn-options" tabindex="-1"><a class="header-anchor" href="#readable-find-fn-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablefindfn-options" target="_blank" rel="noopener noreferrer">readable.find(fn[, options])</a></span></a></h5><p>Node.js ä¸­çš„ <code>readable.find(fn[, options])</code> æ˜¯ä¸€ä¸ªåœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­å¼•å…¥çš„æ–¹æ³•ï¼Œå®ƒå±äºæµï¼ˆStreamï¼‰æ¨¡å—ä¸­çš„å¯è¯»æµï¼ˆReadable Streamï¼‰ã€‚è¿™ä¸ªæ–¹æ³•ä½¿å¾—å¤„ç†æµä¸­çš„æ•°æ®å˜å¾—æ›´åŠ çµæ´»å’Œé«˜æ•ˆã€‚æˆ‘ä¼šé¦–å…ˆè§£é‡ŠåŸºæœ¬æ¦‚å¿µï¼Œç„¶åé€šè¿‡å®é™…ä¾‹å­æ¥å¸®åŠ©ä½ ç†è§£ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-6" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-6"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p><strong>å¯è¯»æµï¼ˆReadable Streamï¼‰</strong>ï¼šåœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç³»åˆ—æ•°æ®çš„ç§»åŠ¨é€šé“ã€‚å¯è¯»æµæ˜¯æµçš„ä¸€ç§ç±»å‹ï¼Œå…è®¸ä½ ä»ä¸­è¯»å–æ•°æ®ï¼Œä¾‹å¦‚ä»æ–‡ä»¶è¯»å–æ•°æ®æˆ–æ¥æ”¶ç½‘ç»œè¯·æ±‚çš„æ•°æ®ã€‚</p><p><strong><code>readable.find(fn[, options])</code> æ–¹æ³•</strong>ï¼šè¿™ä¸ªæ–¹æ³•ä½¿ä½ èƒ½å¤Ÿåœ¨å¯è¯»æµä¸­æœç´¢ç¬¦åˆç‰¹å®šæ¡ä»¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚å®ƒæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼ˆè¿™ä¸ªå‡½æ•°å®šä¹‰äº†æœç´¢æ¡ä»¶ï¼‰ï¼Œå½“æ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å…ƒç´ æ—¶ï¼Œæµçš„è¯»å–å°±ä¼šåœæ­¢ï¼Œå¹¶è¿”å›è¿™ä¸ªå…ƒç´ ã€‚</p><ul><li><code>fn</code>: è¿™æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ¥æ”¶æµä¸­çš„æ¯ä¸ªå…ƒç´ ä½œä¸ºå‚æ•°ã€‚å¦‚æœè¯¥å…ƒç´ æ»¡è¶³ä½ å®šä¹‰çš„æ¡ä»¶ï¼Œè¿™ä¸ªå‡½æ•°åº”è¯¥è¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code>ã€‚</li><li><code>options</code> (å¯é€‰): ä¸€ä¸ªåŒ…å«å¯é€‰è®¾ç½®çš„å¯¹è±¡ï¼Œä¾‹å¦‚å¯ä»¥è®¾ç½®ç¼–ç ç±»å‹ç­‰ã€‚</li></ul><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-20" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-20"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼ˆlog.txtï¼‰ï¼Œå…¶ä¸­è®°å½•äº†ä¸åŒç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼Œç°åœ¨ä½ æƒ³è¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªç”¨æˆ·åä¸º &quot;JohnDoe&quot; çš„ç™»å½•è®°å½•ã€‚</p><h4 id="æ­¥éª¤-1-åˆ›å»º-log-txt" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-1-åˆ›å»º-log-txt"><span>æ­¥éª¤ 1: åˆ›å»º log.txt</span></a></h4><p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªåä¸º <code>log.txt</code> çš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>2023-04-01 09:00:00, UserName: JaneDoe, Action: Login</span></span>
<span class="line"><span>2023-04-01 09:05:00, UserName: JohnDoe, Action: Login</span></span>
<span class="line"><span>2023-04-01 09:10:00, UserName: MikeSmith, Action: Login</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ­¥éª¤-2-ä½¿ç”¨-readable-find-fn-options-æ¥å¤„ç†è¿™ä¸ªæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-2-ä½¿ç”¨-readable-find-fn-options-æ¥å¤„ç†è¿™ä¸ªæ–‡ä»¶"><span>æ­¥éª¤ 2: ä½¿ç”¨ <code>readable.find(fn[, options])</code> æ¥å¤„ç†è¿™ä¸ªæ–‡ä»¶</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥è¯»å– log.txt æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;log.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ readable.find æ–¹æ³•æ‰¾åˆ°ç¬¬ä¸€ä¸ªç”¨æˆ·åä¸º &quot;JohnDoe&quot; çš„è®°å½•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableStream</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">find</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;UserName: JohnDoe&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡ºæ‰¾åˆ°çš„è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº†éœ€è¦çš„æ¨¡å—ï¼Œæ¥ç€åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘ <code>log.txt</code> çš„å¯è¯»æµã€‚ç„¶åï¼Œä½¿ç”¨ <code>readable.find</code> æ–¹æ³•å¹¶æä¾›äº†ä¸€ä¸ªå›è°ƒå‡½æ•° <code>fn</code> ï¼Œè¿™ä¸ªå‡½æ•°æ£€æŸ¥æ¯ä¸€å—æ•°æ®ï¼ˆåœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæ¯ä¸€å—æ•°æ®å¯èƒ½æ˜¯æ–‡ä»¶ä¸­çš„ä¸€è¡Œï¼‰ï¼Œä»¥åˆ¤æ–­æ˜¯å¦åŒ…å« â€œUserName: JohnDoeâ€ã€‚å½“æ‰¾åˆ°åŒ¹é…é¡¹æ—¶ï¼Œ<code>readable.find</code> ä¼šåœæ­¢è¯»å–æµï¼Œå¹¶è¿”å›æ‰¾åˆ°çš„é‚£ä¸€è¡Œæ•°æ®ã€‚</p><h3 id="å°ç»“-2" tabindex="-1"><a class="header-anchor" href="#å°ç»“-2"><span>å°ç»“</span></a></h3><p><code>readable.find(fn[, options])</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ–°æ–¹æ³•ï¼Œå®ƒè®©åœ¨æµä¸­å¯»æ‰¾ç‰¹å®šæ•°æ®å˜å¾—ç®€å•è€Œæœ‰æ•ˆã€‚é€šè¿‡å¼‚æ­¥åœ°è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…çš„å…ƒç´ ï¼Œå®ƒæ—¢æé«˜äº†æ€§èƒ½åˆç®€åŒ–äº†ä»£ç çš„ç¼–å†™ã€‚ä¸Šè¿°å®ä¾‹ä»…ä»…æ˜¯è¿™ä¸ªæ–¹æ³•æ½œåŠ›çš„ä¸€å°éƒ¨åˆ†å±•ç¤ºï¼Œæ ¹æ®ä½ çš„å…·ä½“éœ€æ±‚ï¼Œå®ƒå¯ä»¥è¢«ç”¨äºå¤šç§å¤æ‚ä¸”é«˜æ•ˆçš„æ•°æ®å¤„ç†ä»»åŠ¡ä¸­ã€‚</p><h5 id="readable-every-fn-options" tabindex="-1"><a class="header-anchor" href="#readable-every-fn-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readableeveryfn-options" target="_blank" rel="noopener noreferrer">readable.every(fn[, options])</a></span></a></h5><p>Node.js ä¸­çš„<code>readable.every(fn[, options])</code>æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°åŠ å…¥çš„æ–¹æ³•ï¼Œç”¨äºå¤„ç†æµï¼ˆstreamï¼‰æ•°æ®ã€‚åœ¨äº†è§£è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆç®€å•äº†è§£ä¸€äº›åŸºç¡€çŸ¥è¯†ã€‚</p><h3 id="æµ-streams-ç®€ä»‹-6" tabindex="-1"><a class="header-anchor" href="#æµ-streams-ç®€ä»‹-6"><span>æµï¼ˆStreamsï¼‰ç®€ä»‹</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§å¤„ç†è¯»å†™æ•°æ®çš„æ–¹å¼ï¼Œç‰¹åˆ«é€‚ç”¨äºå¤„ç†å¤§é‡æ•°æ®ã€‚æ¯”å¦‚ï¼Œå½“ä½ è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨ä¼ ç»Ÿçš„æ–¹æ³•å¯èƒ½éœ€è¦æŠŠæ•´ä¸ªæ–‡ä»¶å†…å®¹ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ä¸­ï¼Œè¿™å¯¹äºå†…å­˜èµ„æºæ¥è¯´å¯èƒ½æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ¶ˆè€—ã€‚è€Œä½¿ç”¨æµï¼Œä½ å¯ä»¥åˆ†æ‰¹æ¬¡é€æ¸è¯»å–æ–‡ä»¶å†…å®¹ï¼Œä»è€Œæœ‰æ•ˆå‡å°‘å†…å­˜æ¶ˆè€—ã€‚</p><h3 id="readable-every-fn-options-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#readable-every-fn-options-æ–¹æ³•"><span><code>readable.every(fn[, options])</code> æ–¹æ³•</span></a></h3><p>è¿™ä¸ªæ–¹æ³•æ·»åŠ åˆ°äº†å¯è¯»æµï¼ˆReadable Streamï¼‰çš„åŸå‹ä¸Šï¼Œå…è®¸ä½ æ£€æŸ¥æµä¸­çš„æ‰€æœ‰å…ƒç´ æ˜¯å¦éƒ½æ»¡è¶³æŸä¸ªæ¡ä»¶ã€‚å®ƒæ¥æ”¶ä¸€ä¸ªå‡½æ•°(<code>fn</code>)ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¯¹æµä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ æ‰§è¡Œæµ‹è¯•ã€‚å¦‚æœæ‰€æœ‰å…ƒç´ éƒ½æ»¡è¶³ç»™å®šçš„æµ‹è¯•ï¼Œåˆ™è¿”å›<code>true</code>ï¼›å¦åˆ™ï¼Œä¸€æ—¦å‘ç°ä¸æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ï¼Œç«‹å³è¿”å›<code>false</code>ã€‚</p><ul><li><code>fn</code>: è¿™æ˜¯ä¸€ä¸ªå°†è¢«åº”ç”¨åˆ°æµä¸­æ¯ä¸€ä¸ªå…ƒç´ çš„æµ‹è¯•å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æ¥æ”¶å½“å‰å…ƒç´ ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”åº”è¯¥è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li><li><code>options</code>: å¯é€‰å‚æ•°ï¼Œç”¨äºæ§åˆ¶æ“ä½œçš„ä¸€äº›è¡Œä¸ºï¼Œæ¯”å¦‚å¯ä»¥è®¾å®šæµçš„ç¼–ç ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-9" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-9"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œè®°å½•äº†ç½‘ç«™çš„è®¿é—®æƒ…å†µï¼Œç°åœ¨ä½ æƒ³æ£€æŸ¥æ—¥å¿—é‡Œé¢æ˜¯å¦æ‰€æœ‰è¯·æ±‚éƒ½æˆåŠŸäº†ï¼ˆæ¯”å¦‚çŠ¶æ€ç  200ï¼‰ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾log.txtåŒ…å«ç½‘ç«™çš„è®¿é—®æ—¥å¿—ï¼Œæ¯è¡Œæ˜¯ä¸€ä¸ªè¯·æ±‚çš„çŠ¶æ€ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;log.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ£€æŸ¥æ‰€æœ‰è¯·æ±‚æ˜¯å¦éƒ½æˆåŠŸï¼ˆçŠ¶æ€ç 200ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> areAllRequestsSuccessful</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> allSuccessful</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">every</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">trim</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;200&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">allSuccessful</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ‰€æœ‰è¯·æ±‚éƒ½æˆåŠŸäº†ï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å­˜åœ¨æœªæˆåŠŸçš„è¯·æ±‚ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">areAllRequestsSuccessful</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>readableStream.every()</code>æ–¹æ³•è¢«ç”¨äºæ£€æŸ¥æ—¥å¿—æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œï¼ˆå‡è®¾æ¯è¡Œè®°å½•äº†ä¸€ä¸ªè¯·æ±‚çš„çŠ¶æ€ç ï¼‰ï¼Œé€šè¿‡æ¯”è¾ƒæ¯è¡Œå†…å®¹æ˜¯å¦ä¸º&quot;200&quot;æ¥ç¡®å®šæ˜¯å¦æ‰€æœ‰è¯·æ±‚éƒ½æˆåŠŸäº†ã€‚</p><h3 id="æ³¨æ„ç‚¹" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„ç‚¹"><span>æ³¨æ„ç‚¹</span></a></h3><ul><li>å½“ä½¿ç”¨<code>every()</code>æ–¹æ³•æ—¶ï¼Œæµä¼šè¢«æ¶ˆè´¹æ‰ï¼ˆå³æ•°æ®è¢«è¯»å‡ºæ¥äº†ï¼‰ã€‚å› æ­¤ï¼Œåœ¨è°ƒç”¨<code>every()</code>åï¼Œæµä¸­çš„æ•°æ®å°†ä¸å†å¯ç”¨ã€‚è¿™æ˜¯å› ä¸º<code>every()</code>éœ€è¦è¯»å–æµä¸­çš„æ‰€æœ‰æ•°æ®æ¥è¿›è¡Œåˆ¤æ–­ã€‚</li><li>ç¡®ä¿å¤„ç†å¥½å¼‚æ­¥é€»è¾‘ï¼Œå› ä¸º<code>every()</code>æ–¹æ³•è¿”å›ä¸€ä¸ª Promiseï¼Œæ‰€ä»¥ä½ éœ€è¦ä½¿ç”¨<code>await</code>æˆ–è€…<code>.then/.catch</code>è¯­æ³•æ¥å¤„ç†ç»“æœã€‚</li></ul><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒNode.js æä¾›çš„<code>readable.every()</code>æ–¹æ³•ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¼ºå¤§ä¸”é«˜æ•ˆçš„å·¥å…·ï¼Œç”¨äºåœ¨å¤„ç†æµæ•°æ®æ—¶è¿›è¡Œæ¡ä»¶æ£€æŸ¥ã€‚</p><h5 id="readable-flatmap-fn-options" tabindex="-1"><a class="header-anchor" href="#readable-flatmap-fn-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readableflatmapfn-options" target="_blank" rel="noopener noreferrer">readable.flatMap(fn[, options])</a></span></a></h5><p>ç†è§£ <code>readable.flatMap(fn[, options])</code> åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç®€è¦äº†è§£ Node.js ä¸­çš„æµï¼ˆStreamsï¼‰å’Œ <code>flatMap</code> å‡½æ•°ã€‚</p><h3 id="æµ-streams-3" tabindex="-1"><a class="header-anchor" href="#æµ-streams-3"><span>æµï¼ˆStreamsï¼‰</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰ã€‚æµå¯ä»¥é«˜æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®ï¼Œå› ä¸ºå®ƒä»¬å…è®¸æ•°æ®è¢«åˆ†å—å¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å°†å…¨éƒ¨æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><h3 id="flatmap-å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#flatmap-å‡½æ•°"><span>flatMap å‡½æ•°</span></a></h3><p><code>flatMap</code> æ˜¯ä¸€ä¸ªå¸¸è§çš„å‡½æ•°å¼ç¼–ç¨‹æ¦‚å¿µã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒé¦–å…ˆå¯¹æ•°ç»„çš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œä¸€ä¸ªæ˜ å°„ï¼ˆmappingï¼‰æ“ä½œï¼Œç„¶åå°†ç»“æœâ€œæ‰å¹³åŒ–â€ï¼ˆflattenï¼‰ï¼Œå³å°†æ‰€æœ‰æ˜ å°„å¾—åˆ°çš„æ•°ç»„åˆå¹¶ä¸ºä¸€ä¸ªæ•°ç»„ã€‚è¿™ä¸ªè¿‡ç¨‹ç‰¹åˆ«é€‚åˆå¤„ç†åµŒå¥—æ•°ç»„ç»“æ„ã€‚</p><h3 id="readable-flatmap-fn-options-1" tabindex="-1"><a class="header-anchor" href="#readable-flatmap-fn-options-1"><span>readable.flatMap(fn[, options])</span></a></h3><p>åœ¨ Node.js v21.7.1 çš„ <code>readable.streams</code> æ¨¡å—ä¸­ï¼Œ<code>readable.flatMap(fn[, options])</code> æ–¹æ³•æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°çš„æ·»åŠ ã€‚å®ƒç»“åˆäº†ä¸Šè¿°ä¸¤ä¸ªæ¦‚å¿µ - å®ƒå…è®¸ä½ åœ¨æµçš„æ•°æ®ä¸Šåº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å¯¹æ¯ä¸ªæ•°æ®å—æ‰§è¡ŒæŸäº›æ“ä½œï¼Œå¹¶ä¸”å¯ä»¥è¿”å›ä¸€ä¸ªæ–°çš„æµï¼›ç„¶å <code>flatMap</code> æ–¹æ³•ä¼šå°†è¿™äº›è¿”å›çš„æµè‡ªåŠ¨æ‰å¹³åŒ–ï¼Œåˆå¹¶æˆä¸€ä¸ªå•ä¸€çš„è¾“å‡ºæµã€‚</p><h4 id="å‚æ•°-5" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-5"><span>å‚æ•°</span></a></h4><ul><li><strong>fn</strong>: è¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶å½“å‰å¤„ç†çš„æ•°æ®å—ä½œä¸ºå…¶å‚æ•°ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªæ–°çš„æµæˆ–è€…ä¸€ä¸ªå€¼ã€‚</li><li><strong>options</strong>: è¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œç”¨äºæ§åˆ¶æµçš„è¡Œä¸ºï¼Œæ¯”å¦‚æ§åˆ¶å¹¶å‘æ•°é‡ç­‰ã€‚</li></ul><h4 id="å®é™…è¿ç”¨çš„ä¾‹å­-21" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-21"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ä»ä¸€ä¸ªæ–‡ä»¶æµä¸­è¯»å–æ•°æ®ï¼Œæ¯ä¸€å—æ•°æ®æ˜¯ç”¨æˆ·çš„ ID åˆ—è¡¨ã€‚ä½ æƒ³è¦æ ¹æ®è¿™äº› ID è·å–ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¯èƒ½é€šè¿‡è°ƒç”¨è¿”å›ç”¨æˆ·ä¿¡æ¯çš„å¼‚æ­¥å‡½æ•°ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™æ˜¯æˆ‘ä»¬çš„æ•°æ®æºï¼Œæ¯ä¸ªæ•°æ®å—æ˜¯ä¸€ç»„ç”¨æˆ·ID</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> idStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">([</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  [</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  [</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™ä¸ªå‡½æ•°æ¨¡æ‹Ÿäº†æ ¹æ®ç”¨æˆ·IDå¼‚æ­¥è·å–ç”¨æˆ·ä¿¡æ¯çš„è¿‡ç¨‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetchUserInfoById</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">userId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`User</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ flatMap æ¥å¤„ç†æ¯ä¸ª IDï¼Œè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶å°†ç»“æœæ‰å¹³åŒ–æˆä¸€ä¸ªæµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">idStream</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">flatMap</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">idArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¯¹äºå½“å‰çš„IDæ•°ç»„ï¼Œæˆ‘ä»¬æŠŠå®ƒä»¬è½¬æ¢æˆä¸€ä¸ªåŒ…å«ç”¨æˆ·ä¿¡æ¯çš„Promiseæ•°ç»„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> userInfoPromises</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> idArray</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetchUserInfoById</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ç­‰å¾…æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯è¢«æ‹‰å–å®Œæˆ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">all</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">userInfoPromises</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">userInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ­¤å¤„å¤„ç†åˆå¹¶åçš„ç”¨æˆ·ä¿¡æ¯æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">userInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>flatMap</code> å…è®¸æˆ‘ä»¬å°†ä¸€ä¸ªå¤æ‚çš„æ“ä½œâ€”â€”è·å–å¤šç»„ç”¨æˆ· ID çš„è¯¦æƒ…ï¼Œå±•å¹³æˆäº†ä¸€ä¸ªè¿ç»­çš„ã€å¤„ç†å•ä¸ªå…ƒç´ çš„æµç¨‹ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½ä»¥éå¸¸ç›´è§‚çš„æ–¹å¼å¤„ç†æµä¸­çš„æ•°æ®ï¼ŒåŒæ—¶ä¿æŒä»£ç çš„æ¸…æ™°å’Œé«˜æ•ˆã€‚</p><h5 id="readable-drop-limit-options" tabindex="-1"><a class="header-anchor" href="#readable-drop-limit-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readabledroplimit-options" target="_blank" rel="noopener noreferrer">readable.drop(limit[, options])</a></span></a></h5><p>äº†è§£<code>readable.drop(limit[, options])</code>ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ Node.js ä¸­çš„ Streamï¼ˆæµï¼‰ã€‚åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§å¤„ç†è¯»å–æˆ–å†™å…¥æ•°æ®çš„æ–¹å¼ã€‚æƒ³è±¡æˆæ°´æµï¼Œæ•°æ®åƒæ°´ä¸€æ ·ä»ä¸€ä¸ªåœ°æ–¹â€œæµâ€åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚è¿™ç§æœºåˆ¶å…è®¸æˆ‘ä»¬é«˜æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®æˆ–è€…å³æ—¶æ•°æ®ã€‚</p><h3 id="readable-drop-limit-options-1" tabindex="-1"><a class="header-anchor" href="#readable-drop-limit-options-1"><span><code>readable.drop(limit[, options])</code></span></a></h3><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>readable.drop(limit[, options])</code>æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°å¼•å…¥çš„æ–¹æ³•ï¼Œç”¨äºä»å¯è¯»æµä¸­ä¸¢å¼ƒä¸€å®šæ•°é‡çš„æ•°æ®ã€‚å…·ä½“æ¥è¯´ï¼š</p><ul><li><strong>limit</strong> å‚æ•°æŒ‡å®šè¦ä¸¢å¼ƒçš„æ•°æ®é¡¹çš„æœ€å¤§æ•°é‡ã€‚</li><li><strong>options</strong> å¯é€‰å‚æ•°ï¼Œå¯ä»¥æä¾›é¢å¤–çš„é…ç½®ã€‚</li></ul><p>åŸºæœ¬ä¸Šï¼Œå½“ä½ è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œå®ƒä¼šä»å†…éƒ¨ç¼“å†²åŒºä¸­ç§»é™¤æœ€å¤š<code>limit</code>æ•°é‡çš„æ•°æ®é¡¹ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®š<code>limit</code>ï¼Œå°†å°è¯•ç§»é™¤æ‰€æœ‰å¯ç”¨æ•°æ®ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-12" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-12"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-å¤„ç†å¤§æ•°æ®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-å¤„ç†å¤§æ•°æ®æ–‡ä»¶"><span>ç¤ºä¾‹ 1: å¤„ç†å¤§æ•°æ®æ–‡ä»¶</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªéå¸¸å¤§çš„æ—¥å¿—æ–‡ä»¶ï¼Œä½ æƒ³åˆ†æå…¶ä¸­çš„æ•°æ®ï¼Œä½†ä½ åªå…³å¿ƒæ–‡ä»¶çš„ä¸€éƒ¨åˆ†å†…å®¹ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥è¯»å–å¤§æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;largeLogFile.log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬ä¸éœ€è¦å‰1000é¡¹æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drop</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¤„ç†å‰©ä½™æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¿™é‡Œå¤„ç†æ¯ä¸ªæ•°æ®å—</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-ç½‘ç»œè¯·æ±‚æ•°æ®è¿‡æ»¤" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ç½‘ç»œè¯·æ±‚æ•°æ®è¿‡æ»¤"><span>ç¤ºä¾‹ 2: ç½‘ç»œè¯·æ±‚æ•°æ®è¿‡æ»¤</span></a></h4><p>è€ƒè™‘ä¸€ä¸ªå®æ—¶æ•°æ®åˆ†æåº”ç”¨ï¼Œå®ƒå®æ—¶æ¥æ”¶ç½‘ç»œè¯·æ±‚çš„æ•°æ®ã€‚å¦‚æœæŸäº›æ•°æ®å¯¹å½“å‰åˆ†æä¸é‡è¦ï¼Œä½ å¯èƒ½å¸Œæœ›å¿½ç•¥å®ƒã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    req</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        body</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        body</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">concat</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å°†è¯·æ±‚ä½“è½¬æ¢ä¸ºæµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å‡è®¾æˆ‘ä»¬åªå…³å¿ƒå100é¡¹æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å…ˆè®¡ç®—å‡ºéœ€è¦ä¸¢å¼ƒçš„æ•°æ®é‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dropCount</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Math</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableLength</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drop</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dropCount</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // å¤„ç†å‰©ä½™çš„é‡è¦æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">importantData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">          // å¯¹é‡è¦æ•°æ®è¿›è¡Œå¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">          console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">importantData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ•°æ®å·²å¤„ç†&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ€»ç»“-21" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-21"><span>æ€»ç»“</span></a></h3><p><code>readable.drop(limit[, options])</code>æ–¹æ³•æä¾›äº†ä¸€ç§ç®€ä¾¿æ–¹å¼ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿä»æµä¸­ä¸¢å¼ƒä¸€å®šæ•°é‡çš„æ•°æ®ã€‚è¿™åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–è€…ä»…éœ€éƒ¨åˆ†æ•°æ®çš„æƒ…å¢ƒä¸­ç‰¹åˆ«æœ‰ç”¨ã€‚é€šè¿‡å‡å°‘ä¸å¿…è¦çš„æ•°æ®å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥æå‡åº”ç”¨çš„æ€§èƒ½å’Œæ•ˆç‡ã€‚</p><h5 id="readable-take-limit-options" tabindex="-1"><a class="header-anchor" href="#readable-take-limit-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readabletakelimit-options" target="_blank" rel="noopener noreferrer">readable.take(limit[, options])</a></span></a></h5><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„ <code>readable.take(limit[, options])</code> æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºå¤„ç†æµæ•°æ®ï¼ˆstream dataï¼‰æ—¶å¦‚ä½•æ›´åŠ çµæ´»åœ°æ§åˆ¶å’Œç®¡ç†è¿™äº›æ•°æ®ã€‚æµæ•°æ®å¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ç§è¿ç»­çš„æ•°æ®åºåˆ—ï¼Œå®ƒä¸åƒä¼ ç»Ÿçš„ä¸€æ¬¡æ€§è¯»å–å…¨éƒ¨æ•°æ®é‚£æ ·å·¥ä½œï¼Œè€Œæ˜¯ä»¥ä¸€ç§æµå¼çš„æ–¹å¼æŒç»­åœ°ä¼ è¾“æ•°æ®ã€‚æƒ³è±¡ä¸€ä¸‹æ°´æµï¼Œå®ƒä¸æ˜¯ç«‹å³å…¨é‡åˆ°è¾¾ï¼Œè€Œæ˜¯ä¸€ç‚¹ä¸€ç‚¹æµè¿‡æ¥çš„ã€‚</p><p>åœ¨ Node.js çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>readable.take(limit[, options])</code> æ–¹æ³•å±äºå¯è¯»æµï¼ˆReadable Streamï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œè¿™ä¸ªæ–¹æ³•ä½¿å¾—å¤„ç†è¿™ç±»æµæ•°æ®å˜å¾—æ›´åŠ å¯æ§ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¯¦ç»†åœ°äº†è§£ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•å’Œå®ƒçš„åº”ç”¨åœºæ™¯ã€‚</p><h3 id="è§£é‡Š-3" tabindex="-1"><a class="header-anchor" href="#è§£é‡Š-3"><span>è§£é‡Š</span></a></h3><ul><li><p><strong>å‚æ•°</strong></p><ul><li><code>limit</code>: è¿™ä¸ªå‚æ•°æŒ‡å®šä½ æƒ³ä»æµä¸­æå–å‡ºæ¥çš„å­—èŠ‚æ•°ï¼ˆå¯¹äº Buffer æˆ–å­—ç¬¦ä¸²æ•°æ®ï¼‰æˆ–è€…é¡¹ç›®æ•°ï¼ˆå¯¹äºå¯¹è±¡æ¨¡å¼ä¸‹çš„æµï¼‰ã€‚</li><li><code>options</code>: å¯é€‰å‚æ•°ï¼Œæä¾›é¢å¤–çš„é…ç½®ï¼Œæ¯”å¦‚è®¾ç½®æŸäº›ç‰¹æ®Šçš„è¡Œä¸ºæˆ–è€…ä¿®æ”¹é»˜è®¤è¡Œä¸ºã€‚</li></ul></li><li><p><strong>åŠŸèƒ½</strong><br><code>readable.take(limit[, options])</code> å…è®¸ä½ ä»ä¸€ä¸ªæµä¸­æŒ‰éœ€â€œå–å‡ºâ€ï¼ˆtakeï¼‰ä¸€å®šé‡çš„æ•°æ®ã€‚è¿™æ„å‘³ç€ä½ ä¸å¿…ç­‰å¾…æ•´ä¸ªæµå…¨éƒ¨å¤„ç†å®Œæ¯•å°±èƒ½å¼€å§‹å¤„ç†ä½ æ„Ÿå…´è¶£çš„é‚£éƒ¨åˆ†æ•°æ®ã€‚è¿™å¯¹äºå¤„ç†å¤§è§„æ¨¡æ•°æ®æˆ–è€…åªéœ€è¦éƒ¨åˆ†æ•°æ®çš„åœºæ™¯å°¤å…¶æœ‰ç”¨ã€‚</p></li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-15" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-15"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>æ–‡ä»¶å¤„ç†ï¼š</strong> å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªæ—¥å¿—åˆ†æç³»ç»Ÿï¼Œéœ€è¦å¤„ç†éå¸¸å·¨å¤§çš„æ—¥å¿—æ–‡ä»¶ã€‚ä½¿ç”¨ <code>readable.take()</code> æ–¹æ³•ï¼Œä½ å¯ä»¥ä»…æå–æ–‡ä»¶çš„å‰å‡ ç™¾æˆ–å‡ åƒè¡Œè¿›è¡Œåˆæ­¥åˆ†æï¼Œè€Œä¸æ˜¯ç­‰å¾…æ•´ä¸ªæ–‡ä»¶è¢«åŠ è½½å’Œå¤„ç†ï¼Œè¿™æ ·èƒ½æ˜¾è‘—æé«˜ç¨‹åºçš„å“åº”é€Ÿåº¦å’Œæ•ˆç‡ã€‚</p></li><li><p><strong>ç½‘ç»œè¯·æ±‚ï¼š</strong> åœ¨å¤„ç†å¤§å‹çš„ç½‘ç»œè¯·æ±‚æ—¶ï¼ˆä¾‹å¦‚ï¼Œä» REST API è·å–å¤§é‡æ•°æ®ï¼‰ï¼Œä½ å¯èƒ½ä»…å¯¹è¿”å›æ•°æ®çš„ä¸€å°éƒ¨åˆ†æ„Ÿå…´è¶£ã€‚é€šè¿‡ä½¿ç”¨ <code>readable.take(limit)</code>ï¼Œä½ å¯ä»¥ä»…è¯»å–éœ€è¦çš„æ•°æ®é‡ï¼Œé¿å…æ— è°“çš„å†…å­˜æ¶ˆè€—å’Œå¤„ç†æ—¶é—´ã€‚</p></li><li><p><strong>è§†é¢‘æµå¤„ç†ï¼š</strong> å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦ä»è§†é¢‘æµä¸­æå–ç‰¹å®šç‰‡æ®µçš„åº”ç”¨ï¼ˆæ¯”å¦‚ï¼ŒæŠ“å–è§†é¢‘çš„å‰ 10 ç§’åšé¢„è§ˆï¼‰ï¼Œ<code>readable.take()</code> æ–¹æ³•å¯ä»¥å¸®åŠ©ä½ ä»…è·å–éœ€è¦çš„è§†é¢‘æ•°æ®éƒ¨åˆ†ï¼Œè€Œæ— éœ€ä¸‹è½½æ•´ä¸ªè§†é¢‘æµã€‚</p></li></ol><p>é€šè¿‡è¿™äº›ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>readable.take(limit[, options])</code> æ–¹æ³•åœ¨ä¸åŒçš„æ•°æ®å¤„ç†åœºæ™¯ä¸­æ˜¯å¦‚ä½•æä¾›æ›´åŠ ç²¾ç¡®å’Œé«˜æ•ˆçš„æ•°æ®å¤„ç†èƒ½åŠ›çš„ã€‚å®ƒå…è®¸å¼€å‘è€…æ ¹æ®å…·ä½“éœ€æ±‚ä»å¤§é‡æ•°æ®ä¸­å¿«é€Ÿâ€œå–å‡ºâ€æ‰€éœ€æ•°æ®ï¼Œä»è€Œä¼˜åŒ–åº”ç”¨çš„æ€§èƒ½ä¸ç”¨æˆ·ä½“éªŒã€‚</p><h5 id="readable-reduce-fn-initial-options" tabindex="-1"><a class="header-anchor" href="#readable-reduce-fn-initial-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablereducefn-initial-options" target="_blank" rel="noopener noreferrer">readable.reduce(fn[, initial[, options]])</a></span></a></h5><p>ç†è§£ <code>readable.reduce(fn[, initial[, options]])</code> åŠŸèƒ½ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆç†è§£ä»€ä¹ˆæ˜¯ Node.js ä¸­çš„å¯è¯»æµï¼ˆReadable Streamï¼‰ä»¥åŠ <code>reduce</code> è¿™ä¸ªæ“ä½œé€šå¸¸ç”¨äºåšä»€ä¹ˆã€‚</p><h3 id="å¯è¯»æµ-readable-stream" tabindex="-1"><a class="header-anchor" href="#å¯è¯»æµ-readable-stream"><span>å¯è¯»æµï¼ˆReadable Streamï¼‰</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamï¼‰æ˜¯å¤„ç†æµå¼æ•°æ®çš„æŠ½è±¡æ¥å£ã€‚æœ‰å››ç§ä¸»è¦ç±»å‹çš„æµï¼šå¯è¯»ï¼ˆReadableï¼‰ã€å¯å†™ï¼ˆWritableï¼‰ã€åŒå·¥ï¼ˆDuplexï¼‰å’Œè½¬æ¢ï¼ˆTransformï¼‰ã€‚å¯è¯»æµæ˜¯ç”¨æ¥è¯»å–æ•°æ®çš„ä¸€ç§æµï¼Œæ¯”å¦‚ä»æ–‡ä»¶ã€HTTP å“åº”æˆ–è€…æ ‡å‡†è¾“å…¥ç­‰è¯»å–æ•°æ®ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-reduce-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-reduce-æ–¹æ³•"><span>ä»€ä¹ˆæ˜¯ <code>reduce</code> æ–¹æ³•</span></a></h3><p><code>reduce</code> æ˜¯ä¸€ä¸ªåœ¨æ•°ç»„ä¸­éå¸¸å¸¸è§çš„æ–¹æ³•ï¼Œç”¨äºå°†æ‰€æœ‰å…ƒç´ å½’çº³ï¼ˆæˆ–æ±‡æ€»ï¼‰æˆå•ä¸ªå€¼ã€‚å®ƒé€šè¿‡ä¸€ä¸ªç´¯åŠ å™¨å‡½æ•°å¯¹é›†åˆä¸­çš„å…ƒç´ è¿›è¡Œè¿­ä»£ï¼Œæ¯æ¬¡è¿­ä»£éƒ½ä¼šè¿”å›ä¸€ä¸ªæ›´æ–°åçš„ç´¯ç§¯å€¼ï¼Œå¹¶ä¸”è¿™ä¸ªç´¯ç§¯å€¼ä¼šè¢«ç”¨äºä¸‹ä¸€æ¬¡è¿­ä»£ï¼Œç›´åˆ°éå†å®Œæ‰€æœ‰å…ƒç´ ã€‚</p><h3 id="node-js-ä¸­çš„-readable-reduce-fn-initial-options" tabindex="-1"><a class="header-anchor" href="#node-js-ä¸­çš„-readable-reduce-fn-initial-options"><span>Node.js ä¸­çš„ <code>readable.reduce(fn[, initial[, options]])</code></span></a></h3><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œ<code>readable.reduce(...)</code> æ˜¯å¯è¯»æµï¼ˆReadable Streamï¼‰æä¾›çš„ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä½¿ä½ èƒ½å¤Ÿå¯¹æµä¸­çš„æ•°æ®é¡¹æ‰§è¡Œ <code>reduce</code> æ“ä½œï¼Œç±»ä¼¼äºä½ ä¼šåœ¨æ•°ç»„ä¸Šæ‰§è¡Œçš„é‚£æ ·ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥å¯¹æµå¼ä¼ è¾“çš„æ•°æ®è¿›è¡Œç´¯è®¡æˆ–å½’çº³å¤„ç†ï¼Œè€Œæ— éœ€ç­‰å¾…æ‰€æœ‰æ•°æ®éƒ½è¢«è¯»å–å®Œæ¯•ã€‚</p><h4 id="å‚æ•°-6" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-6"><span>å‚æ•°ï¼š</span></a></h4><ul><li><code>fn</code>: ç´¯åŠ å™¨å‡½æ•°ï¼Œç”¨äºå°†å½“å‰å€¼ä¸æµä¸­çš„ä¸‹ä¸€ä¸ªå€¼ç»“åˆèµ·æ¥ã€‚</li><li><code>initial</code>: ï¼ˆå¯é€‰ï¼‰åˆå§‹å€¼ä¼ é€’ç»™ç´¯åŠ å™¨å‡½æ•°ã€‚</li><li><code>options</code>: ï¼ˆå¯é€‰ï¼‰é…ç½®å¯¹è±¡ã€‚</li></ul><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹-13" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-13"><span>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</span></a></h4><h5 id="ç¤ºä¾‹-1-è®¡ç®—æ•°å­—æµçš„å’Œ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-è®¡ç®—æ•°å­—æµçš„å’Œ"><span>ç¤ºä¾‹ 1ï¼šè®¡ç®—æ•°å­—æµçš„å’Œ</span></a></h5><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªæ•°å­—æµï¼Œè¿™äº›æ•°å­—ä»£è¡¨äº†æŸä¸ªåº”ç”¨ä¸­çš„äº¤æ˜“é‡‘é¢ï¼Œç°åœ¨ä½ æƒ³è¦è®¡ç®—æ‰€æœ‰äº¤æ˜“é‡‘é¢çš„æ€»å’Œã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™æ˜¯ä½ çš„äº¤æ˜“é‡‘é¢æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> transactions</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">([</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">40</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ reduce æ¥è®¡ç®—æ€»å’Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">transactions</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">reduce</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">acc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">amount</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> acc</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> amount</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">total</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Total Transactions: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">total</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: Total Transactions: 150</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="ç¤ºä¾‹-2-è¿æ¥å­—ç¬¦ä¸²æµ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-è¿æ¥å­—ç¬¦ä¸²æµ"><span>ç¤ºä¾‹ 2ï¼šè¿æ¥å­—ç¬¦ä¸²æµ</span></a></h5><p>å¦‚æœä½ æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²çš„æµï¼Œä¾‹å¦‚ä»ä¸€ä¸ªå¤§å‹æ–‡æœ¬æ–‡ä»¶ä¸­é€è¡Œè¯»å–æ•°æ®ï¼Œä½†ä½ æƒ³å°†è¿™äº›è¡Œåˆå¹¶ä¸ºä¸€ä¸ªå•ä¸€çš„å­—ç¬¦ä¸²ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™æ˜¯ä½ çš„è¡Œæµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> lines</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;World&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;From&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Node.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ reduce æ¥æ‹¼æ¥å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">lines</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">reduce</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">acc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> acc</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> line</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot; &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Result: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">result</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">trim</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¾“å‡º: Result: Hello World From Node.js</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸¤ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>reduce</code> æ–¹æ³•å¤„ç†äº†æµå¼æ•°æ®ï¼Œæ— è®ºæ˜¯è®¡ç®—æ•°å­—æ€»å’Œè¿˜æ˜¯è¿æ¥å­—ç¬¦ä¸²ï¼Œè¿™å±•ç¤ºäº† <code>readable.reduce</code> å¦‚ä½•ä½¿å¯¹æµå¼æ•°æ®çš„å¤„ç†æ›´åŠ ç®€ä¾¿å’Œé«˜æ•ˆã€‚</p><h3 id="duplex-and-transform-streams" tabindex="-1"><a class="header-anchor" href="#duplex-and-transform-streams"><span><a href="https://nodejs.org/docs/latest/api/stream.html#duplex-and-transform-streams" target="_blank" rel="noopener noreferrer">Duplex and transform streams</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ¥ç†è§£ Node.js ä¸­çš„ Duplex å’Œ Transform Streamsã€‚</p><h3 id="_1-ç†è§£æµ-streams" tabindex="-1"><a class="header-anchor" href="#_1-ç†è§£æµ-streams"><span>1. ç†è§£æµï¼ˆStreamsï¼‰</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamsï¼‰æ˜¯å¤„ç†æ•°æ®çš„æŠ½è±¡æ¦‚å¿µã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆæ°´ç®¡ï¼Œæ•°æ®å°±åƒæ°´ä¸€æ ·ä»ä¸€ä¸ªåœ°æ–¹æµå‘å¦ä¸€ä¸ªåœ°æ–¹ã€‚Node.js ä¸­æœ‰å››ç§åŸºæœ¬ç±»å‹çš„æµï¼š</p><ul><li><strong>Readable</strong>ï¼šåªç”¨äºè¯»å–æ•°æ®ã€‚</li><li><strong>Writable</strong>ï¼šåªç”¨äºå†™å…¥æ•°æ®ã€‚</li><li><strong>Duplex</strong>ï¼šæ—¢å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™ã€‚</li><li><strong>Transform</strong>ï¼šä¸€ç§ç‰¹æ®Šçš„ Duplex æµï¼Œå®ƒå¯ä»¥ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®ã€‚</li></ul><h3 id="_2-duplex-streams" tabindex="-1"><a class="header-anchor" href="#_2-duplex-streams"><span>2. Duplex Streams</span></a></h3><p>Duplex æµæ—¢å¯ä»¥è¯»æ•°æ®ä¹Ÿå¯ä»¥å†™æ•°æ®ï¼Œå°±åƒç”µè¯é€šè¯ï¼ŒåŒæ–¹éƒ½å¯ä»¥è¯´è¯ï¼ˆå†™å…¥ï¼‰å’Œå¬ï¼ˆè¯»å–ï¼‰ã€‚è¿™æ„å‘³ç€è¿™ç§ç±»å‹çš„æµæ—¢å®ç°äº† Readable æ¥å£ä¹Ÿå®ç°äº† Writable æ¥å£ã€‚</p><p><strong>å®é™…åº”ç”¨ç¤ºä¾‹</strong>ï¼šWeb Socket è¿æ¥ã€‚åœ¨ä¸€ä¸ª Web Socket è¿æ¥ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯ä»¥å‘é€æ¶ˆæ¯ï¼ˆå†™å…¥æ•°æ®ï¼‰å’Œæ¥æ”¶æ¶ˆæ¯ï¼ˆè¯»å–æ•°æ®ï¼‰ï¼Œè¿™æ­£æ˜¯ Duplex Stream çš„ä½¿ç”¨åœºæ™¯ã€‚</p><h3 id="_3-transform-streams" tabindex="-1"><a class="header-anchor" href="#_3-transform-streams"><span>3. Transform Streams</span></a></h3><p>Transform æµæ˜¯ä¸€ç§ Duplex æµï¼Œä½†å®ƒæœ‰ä¸€ä¸ªç‰¹åˆ«ä¹‹å¤„ï¼šå®ƒå¯ä»¥åœ¨è¯»å†™è¿‡ç¨‹ä¸­ä¿®æ”¹æˆ–å¤„ç†æ•°æ®ã€‚å½“æ•°æ®ä»å¯å†™ç«¯è¿›å…¥æ—¶ï¼Œå®ƒä¼šè¿›è¡ŒæŸç§å½¢å¼çš„è½¬æ¢ï¼Œç„¶åæ‰èƒ½ä»å¯è¯»ç«¯è¯»å‡ºæ¥ã€‚</p><p><strong>å®é™…åº”ç”¨ç¤ºä¾‹</strong>ï¼š</p><ol><li><p><strong>æ•°æ®å‹ç¼©</strong>ï¼šå‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªç¨‹åºï¼Œéœ€è¦å°†æ–‡ä»¶å‹ç¼©åå†ä¼ è¾“ã€‚è¿™é‡Œï¼Œä½ å¯ä»¥ä½¿ç”¨ Transform æµæ¥æ¥æ”¶åŸå§‹æ•°æ®ï¼Œå‹ç¼©è¿™äº›æ•°æ®ï¼Œç„¶åè¾“å‡ºå‹ç¼©åçš„æ•°æ®ã€‚</p></li><li><p><strong>å­—ç¬¦ç¼–ç è½¬æ¢</strong>ï¼šå¦‚æœä½ æœ‰ä¸€ä¸ªæµçš„æ•°æ®æ˜¯ä»¥ä¸€ç§å­—ç¬¦ç¼–ç æ ¼å¼è¿›å…¥çš„ï¼Œä½†ä½ éœ€è¦å°†å…¶è½¬æ¢ä¸ºå¦ä¸€ç§æ ¼å¼è¾“å‡ºï¼ŒTransform æµå¯ä»¥åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­å®Œæˆè¿™ç§ç¼–ç çš„è½¬æ¢ã€‚</p></li><li><p><strong>æ•°æ®åˆ†æ</strong>ï¼šä¾‹å¦‚ï¼Œä½ æ­£åœ¨å¤„ç†ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶çš„æµï¼Œå¹¶ä¸”ä½ æƒ³ç»Ÿè®¡å…¶ä¸­çš„é”™è¯¯ä¿¡æ¯æ•°é‡ã€‚ä½ å¯ä»¥ä½¿ç”¨ Transform æµæ¥æ£€æŸ¥æ¯ä¸€å—æ•°æ®æ˜¯å¦åŒ…å«é”™è¯¯ä¿¡æ¯ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªåŒ…å«é”™è¯¯è®¡æ•°çš„æ–°æµã€‚</p></li></ol><h3 id="æ€»ç»“-22" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-22"><span>æ€»ç»“</span></a></h3><p>Duplex å’Œ Transform æµåœ¨ Node.js ä¸­æ˜¯å¤„ç†åŒå‘æ•°æ®æµå’Œæ•°æ®è½¬æ¢çš„é‡è¦å·¥å…·ã€‚å®ƒä»¬ä½¿å¾—åœ¨æ•°æ®ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´ä¼ è¾“å’Œè½¬æ¢æ•°æ®å˜å¾—ç®€å•é«˜æ•ˆã€‚é€šè¿‡ä»¥ä¸Šçš„ä¾‹å­ï¼Œæˆ‘å¸Œæœ›ä½ å¯¹è¿™ä¸¤ç§æµçš„æ¦‚å¿µå’Œè¿ç”¨æœ‰äº†æ›´æ¸…æ™°çš„è®¤è¯†ã€‚</p><h4 id="class-stream-duplex" tabindex="-1"><a class="header-anchor" href="#class-stream-duplex"><span><a href="https://nodejs.org/docs/latest/api/stream.html#class-streamduplex" target="_blank" rel="noopener noreferrer">Class: stream.Duplex</a></span></a></h4><p>Node.js ä¸­çš„ <code>stream</code> æ¨¡å—æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†æµæ•°æ®çš„å†…ç½®æ¨¡å—ã€‚åœ¨è°ˆè®º <code>class: stream.Duplex</code> ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆç†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯æµï¼ˆStreamï¼‰ä»¥åŠå®ƒåœ¨ Node.js ä¸­çš„ä½œç”¨ã€‚</p><h3 id="æµ-streams-ç®€ä»‹-7" tabindex="-1"><a class="header-anchor" href="#æµ-streams-ç®€ä»‹-7"><span>æµï¼ˆStreamsï¼‰ç®€ä»‹</span></a></h3><p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œæµæ˜¯ä¸€ç³»åˆ—çš„æ•°æ®å…ƒç´ ï¼Œè¿™äº›æ•°æ®å…ƒç´ å¯ä»¥ä½œä¸ºä¸€ä¸ªè¿ç»­çš„æµè¢«å¤„ç†ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†å®ƒä»¬å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™å¯¹äºå¤„ç†å¤§é‡æ•°æ®éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚ä»æ–‡ä»¶è¯»å–å†…å®¹æˆ–è€…ç½‘ç»œé€šä¿¡ç­‰ã€‚</p><p>Node.js ä¸­æœ‰å››ç§åŸºæœ¬çš„æµç±»å‹ï¼š</p><ol><li><strong>Readable</strong> - å¯è¯»æµï¼Œç”¨äºè¯»å–æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼‰ã€‚</li><li><strong>Writable</strong> - å¯å†™æµï¼Œç”¨äºå†™å…¥æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œå†™å…¥æ–‡ä»¶ï¼‰ã€‚</li><li><strong>Duplex</strong> - åŒå·¥æµï¼Œæ—¢å¯è¯»ä¹Ÿå¯å†™ï¼Œä¸¤ä¸ªæ–¹å‘éƒ½å¯ä»¥ç‹¬ç«‹æ“ä½œã€‚</li><li><strong>Transform</strong> - è½¬æ¢æµï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„åŒå·¥æµï¼Œä½†å®ƒå¯ä»¥ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®ï¼Œå½“æ•°æ®ä»å¯è¯»ç«¯ä¼ è¾“åˆ°å¯å†™ç«¯æ—¶ã€‚</li></ol><h3 id="duplex-æµ" tabindex="-1"><a class="header-anchor" href="#duplex-æµ"><span>Duplex æµ</span></a></h3><p><code>Duplex</code> æµæ˜¯ä¸€ä¸ªåŒæ—¶å®ç°äº† <code>Readable</code> å’Œ <code>Writable</code> æ¥å£çš„æµã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥é€šè¿‡è¿™ç§ç±»å‹çš„æµæ—¢å‘é€æ•°æ®ä¹Ÿæ¥æ”¶æ•°æ®ã€‚å¾ˆå¥½çš„æ¯”å–»å°±æ˜¯ç”µè¯é€šè¯ï¼Œä½ å¯ä»¥è¯´ï¼ˆå†™å…¥ï¼‰ä¹Ÿå¯ä»¥å¬ï¼ˆè¯»å–ï¼‰ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼•å…¥streamæ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Duplex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºè‡ªå®šä¹‰Duplexæµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> duplexStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Duplex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fromCharCode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">currentCharCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">currentCharCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 90</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // Zçš„ASCIIç æ˜¯90</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç»“æŸè¯»å–æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">duplexStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">currentCharCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 65</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// Açš„ASCIIç æ˜¯65</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">duplexStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>Duplex</code> æµï¼š<code>duplexStream</code>ã€‚åœ¨å…¶ <code>read</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é€å­—æ¯åœ°ç”Ÿæˆäº†ä» A åˆ° Z çš„å­—ç¬¦ï¼Œå¹¶åœ¨è¾¾åˆ° Z åç»“æŸæµã€‚åœ¨å…¶ <code>write</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ç®€å•åœ°å°†æ¥æ”¶åˆ°çš„æ•°æ®å—è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶æ‰“å°å‡ºæ¥ã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ©ç”¨ <code>pipe</code> æ–¹æ³•å°† <code>process.stdin</code>ï¼ˆæ ‡å‡†è¾“å…¥æµï¼‰ä¸æˆ‘ä»¬çš„ <code>duplexStream</code> ç›¸è¿æ¥ï¼Œå¹¶ä¸”å°† <code>duplexStream</code> è¾“å‡ºåˆ° <code>process.stdout</code>ï¼ˆæ ‡å‡†è¾“å‡ºæµï¼‰ï¼Œè¿™æ ·ï¼Œç”¨æˆ·è¾“å…¥çš„ä»»ä½•ä¸œè¥¿éƒ½ä¼šç»è¿‡æˆ‘ä»¬çš„ <code>duplexStream</code> æ‰“å°å‡ºæ¥ï¼ŒåŒæ—¶ä¹Ÿä¼šæŒ‰å­—æ¯é¡ºåºç”Ÿæˆ A åˆ° Z å¹¶è¾“å‡ºã€‚</p><h3 id="å®é™…åº”ç”¨åœºæ™¯-1" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨åœºæ™¯-1"><span>å®é™…åº”ç”¨åœºæ™¯</span></a></h3><ul><li><strong>ç½‘ç»œé€šä¿¡</strong>ï¼šåœ¨åˆ›å»º TCP/UDP æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨åŒå·¥æµè¿›è¡Œæ•°æ®çš„è¯»å†™æ“ä½œï¼Œè¿™å…è®¸æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯èƒ½å¤Ÿäº’ç›¸å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚</li><li><strong>æ–‡ä»¶å‹ç¼©å’Œè§£å‹</strong>ï¼šä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå°†æ–‡ä»¶æ•°æ®è¯»å…¥ï¼Œè¿›è¡Œå‹ç¼©æˆ–è§£å‹ï¼Œç„¶åå†™å‡ºåˆ°å¦ä¸€ä¸ªæ–‡ä»¶çš„æµç®¡é“ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ çš„åº”ç”¨ç¨‹åºå¯ä»¥è¾¹è¯»è¾¹å‹ç¼©æˆ–è§£å‹æ•°æ®ï¼Œè€Œä¸å¿…å…ˆå°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥å†…å­˜ä¸­ã€‚</li><li><strong>å®æ—¶æ•°æ®å¤„ç†</strong>ï¼šåœ¨å¤„ç†åƒè§†é¢‘ç›´æ’­æˆ–å®æ—¶æ•°æ®åˆ†æè¿™æ ·çš„åº”ç”¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨åŒå·¥æµæ¥è¯»å–æºæ•°æ®ï¼Œå®æ—¶å¤„ç†å®ƒï¼Œç„¶åè¾“å‡ºå¤„ç†åçš„æ•°æ®ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼Œäº†è§£å’Œä½¿ç”¨ Node.js ä¸­çš„ <code>Duplex</code> æµï¼Œå¯ä»¥è®©ä½ æ›´æœ‰æ•ˆåœ°å¤„ç†åœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šçš„æµæ•°æ®ï¼Œæ— è®ºæ˜¯åœ¨æ–‡ä»¶ IOã€ç½‘ç»œé€šä¿¡è¿˜æ˜¯å®æ—¶æ•°æ®å¤„ç†ç­‰æ–¹é¢ã€‚</p><h5 id="duplex-allowhalfopen" tabindex="-1"><a class="header-anchor" href="#duplex-allowhalfopen"><span><a href="https://nodejs.org/docs/latest/api/stream.html#duplexallowhalfopen" target="_blank" rel="noopener noreferrer">duplex.allowHalfOpen</a></span></a></h5><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒä½¿å¾— JavaScript å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œã€‚åœ¨ Node.js ä¸­ï¼Œæµ(Stream)æ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æœ‰æ•ˆæ–¹å¼ï¼Œå°¤å…¶æ˜¯å¤„ç†å¤§å‹æ–‡ä»¶æˆ–æ•°æ®æµæ—¶ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯åŒå·¥æµ-duplex-stream" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯åŒå·¥æµ-duplex-stream"><span>ä»€ä¹ˆæ˜¯åŒå·¥æµï¼ˆDuplex Streamï¼‰?</span></a></h3><p>åŒå·¥æµï¼ˆDuplex Streamï¼‰æ˜¯ Node.js ä¸­çš„ä¸€ç§ç‰¹æ®Šæµç±»å‹ï¼Œå®ƒå…è®¸æ•°æ®åŒæ—¶åœ¨ä¸¤ä¸ªæ–¹å‘ä¸ŠæµåŠ¨ï¼šå¯ä»¥æ—¢ä½œä¸ºå¯è¯»æµï¼Œä¹Ÿä½œä¸ºå¯å†™æµã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨é€šè¿‡ç”µè¯å’Œæœ‹å‹äº¤è°ˆï¼Œä½ å¯ä»¥åŒæ—¶å¬å’Œè¯´ï¼Œè¿™å°±åƒæ˜¯ç°å®ç”Ÿæ´»ä¸­çš„åŒå·¥é€šä¿¡ã€‚</p><h3 id="duplex-allowhalfopen-å±æ€§" tabindex="-1"><a class="header-anchor" href="#duplex-allowhalfopen-å±æ€§"><span>duplex.allowHalfOpen å±æ€§</span></a></h3><p>åœ¨æ·±å…¥ç†è§£ <code>duplex.allowHalfOpen</code> å±æ€§ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®ä»€ä¹ˆæ˜¯&quot;åŠå¼€&quot;è¿æ¥ã€‚åœ¨ä¸€ä¸ª TCP è¿æ¥ä¸­ï¼Œå¦‚æœä¸€æ–¹å®Œæˆäº†å‘é€ä»»åŠ¡å¹¶å‘é€äº† FIN åŒ…ï¼ˆè¡¨ç¤ºæ²¡æœ‰æ•°æ®å‘é€äº†ï¼‰ï¼Œä½†å¦ä¸€æ–¹è¿˜åœ¨å‘é€æ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿æ¥å°±è¿›å…¥äº†&quot;åŠå¼€&quot;çŠ¶æ€ã€‚åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼Œå³ä¾¿ä¸€æ–¹å·²ç»å®Œæˆå‘é€ï¼Œå®ƒä»ç„¶å¯ä»¥æ¥æ”¶æ¥è‡ªå¦ä¸€æ–¹çš„æ•°æ®ã€‚</p><p>åœ¨ Node.js çš„åŒå·¥æµä¸­ï¼Œ<code>allowHalfOpen</code> å±æ€§æ­£æ˜¯ç”¨æ¥æ§åˆ¶è¿™ç§åŠå¼€é€»è¾‘çš„ã€‚å½“è®¾ç½®ä¸º <code>true</code> æ—¶ï¼Œæµåœ¨ä¸€ä¸ªæ–¹å‘ä¸Šç»“æŸï¼ˆæ¯”å¦‚å¯å†™ç«¯è°ƒç”¨ <code>end()</code> æ–¹æ³•åï¼‰æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨å…³é—­å¦ä¸€ä¸ªæ–¹å‘ï¼ˆå³å¯è¯»ç«¯ï¼‰ã€‚è¿™æ„å‘³ç€æµä»ç„¶å¯ä»¥ç»§ç»­æ¥æ”¶ï¼ˆè¯»å–ï¼‰æ•°æ®ç›´åˆ°å¦ä¸€ç«¯ä¹Ÿç»“æŸã€‚å¦‚æœè®¾ç½®ä¸º <code>false</code>ï¼Œå½“æµçš„ä¸€ä¸ªæ–¹å‘ç»“æŸæ—¶ï¼Œå¦ä¸€ä¸ªæ–¹å‘ä¹Ÿä¼šè¢«è‡ªåŠ¨ç»“æŸã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-14" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-14"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>ä¸¾ä¸ªå®é™…çš„ä¾‹å­æ¥è¯´æ˜ <code>duplex.allowHalfOpen</code> çš„åº”ç”¨åœºæ™¯ï¼š</p><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªèŠå¤©æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯é€šè¿‡ TCP è¿æ¥å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å¯èƒ½åªæƒ³å‘é€ä¸€ä¸ªâ€œå‘Šåˆ«â€æ¶ˆæ¯ç„¶ååœæ­¢å‘é€æ•°æ®ï¼Œä½†å®ƒä»ç„¶å¸Œæœ›æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æœ€åæ¶ˆæ¯ï¼ˆæ¯”å¦‚ç¡®è®¤æ¶ˆæ¯æˆ–å…¶ä»–å®¢æˆ·ç«¯çš„å‘Šåˆ«ä¿¡æ¯ï¼‰ã€‚</p><p>åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œä½ å¯ä»¥è®¾ç½®åŒå·¥æµçš„ <code>allowHalfOpen</code> ä¸º <code>true</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Duplex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªåŒå·¥æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> duplexStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Duplex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  allowHalfOpen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // readé€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // writeé€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®šä¹‰å½“æµç»“æŸæ—¶çš„è¡Œä¸º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">duplexStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;finish&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥å®Œæˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å³ä½¿å†™å…¥å·²å®Œæˆï¼Œæˆ‘ä»¬ä»å¯ä»¥è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å½“æ²¡æœ‰æ›´å¤šæ•°æ®è¯»å–æ—¶ï¼Œè§¦å‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">duplexStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯»å–å®Œæˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå³ä½¿å®¢æˆ·ç«¯è°ƒç”¨äº† <code>duplexStream.end()</code> æ¥ç»“æŸå†™å…¥ï¼Œå®ƒä»ç„¶å¯ä»¥ç»§ç»­æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ•°æ®ç›´åˆ°æœåŠ¡å™¨ä¹Ÿè°ƒç”¨ <code>end()</code>ã€‚</p><p>æ€»ç»“èµ·æ¥ï¼Œ<code>duplex.allowHalfOpen</code> å±æ€§æä¾›äº†æµçš„çµæ´»æ§åˆ¶ï¼Œé€‚ç”¨äºéœ€è¦ç²¾ç¡®ç®¡ç†æµå…³é—­æ—¶æœºçš„åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¶‰åŠåˆ°ç½‘ç»œé€šä¿¡æ—¶ã€‚é€šè¿‡åˆç†åˆ©ç”¨è¿™ä¸€å±æ€§ï¼Œä½ å¯ä»¥æ„å»ºå‡ºæ›´ç¨³å¥ã€æ›´çµæ´»çš„ç½‘ç»œåº”ç”¨ã€‚</p><h4 id="class-stream-transform" tabindex="-1"><a class="header-anchor" href="#class-stream-transform"><span><a href="https://nodejs.org/docs/latest/api/stream.html#class-streamtransform" target="_blank" rel="noopener noreferrer">Class: stream.Transform</a></span></a></h4><p>Node.js ä¸­çš„ <code>stream.Transform</code> ç±»æ˜¯ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„æµï¼ˆStreamï¼‰ï¼Œå®ƒåŒæ—¶å®ç°äº†å¯è¯»æµï¼ˆReadable streamï¼‰å’Œå¯å†™æµï¼ˆWritable streamï¼‰çš„æ¥å£ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥å‘ <code>Transform</code> æµä¸­å†™å…¥æ•°æ®ï¼Œ<code>Transform</code> æµä¼šæŒ‰ç…§ä¸€å®šçš„è§„åˆ™å¤„ç†è¿™äº›æ•°æ®ï¼Œç„¶åå¯ä»¥ä»æµä¸­è¯»å‡ºå¤„ç†åçš„æ•°æ®ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ<code>Transform</code> æµæ˜¯ç”¨æ¥åœ¨è¾“å…¥æ•°æ®å’Œè¾“å‡ºæ•°æ®ä¹‹é—´è¿›è¡Œè½¬æ¢çš„ã€‚</p><h3 id="åŸºæœ¬åŸç†" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬åŸç†"><span>åŸºæœ¬åŸç†</span></a></h3><p>å½“ä½ å‘ <code>Transform</code> æµå†™å…¥æ•°æ®æ—¶ï¼Œè¿™äº›æ•°æ®ä¼šè¢«æ”¾å…¥ä¸€ä¸ªå†…éƒ¨çš„ç¼“å†²åŒºã€‚<code>Transform</code> ç±»é€šè¿‡å®ç°ä¸€ä¸ªåä¸º <code>_transform</code> çš„æ–¹æ³•æ¥å¤„ç†è¿™äº›æ•°æ®ã€‚æ¯æ¬¡å†…éƒ¨ç¼“å†²åŒºçš„æ•°æ®è¾¾åˆ°ä¸€å®šé‡ï¼ˆæˆ–è€…å†™å…¥ç«¯è°ƒç”¨äº†<code>.end()</code>æ–¹æ³•ï¼‰æ—¶ï¼Œ<code>_transform</code> æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ï¼Œå¹¶ä¸”å¤„ç†å†…éƒ¨ç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚å¤„ç†å®Œæˆçš„æ•°æ®éšåå¯ä»¥ä»æµä¸­è¢«è¯»å–ã€‚</p><p>å¦‚æœéœ€è¦å¯¹è¾“å‡ºæ•°æ®è¿›è¡Œæœ€ç»ˆçš„è°ƒæ•´ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°å®ç°ä¸€ä¸ª <code>_flush</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨æµå³å°†ç»“æŸï¼Œä½†è¿˜æœ‰æœ€åçš„æ•°æ®éœ€è¦è¾“å‡ºå‰è¢«è°ƒç”¨ã€‚</p><h3 id="åº”ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨ç¤ºä¾‹"><span>åº”ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-å¤§å†™è½¬æ¢å™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-å¤§å†™è½¬æ¢å™¨"><span>ç¤ºä¾‹ 1: å¤§å†™è½¬æ¢å™¨</span></a></h4><p>å‡è®¾æˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿå°†æ‰€æœ‰è¾“å…¥æ–‡æœ¬è½¬æ¢æˆå¤§å†™å½¢å¼çš„è½¬æ¢æµã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> UppercaseTransform</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºå¤§å†™</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toUpperCase</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨UppercaseTransform</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> upperCaseTr</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> UppercaseTransform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">upperCaseTr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ <code>UppercaseTransform</code> è½¬æ¢æµï¼Œå®ƒä¼šå°†æ‰€æœ‰ä¼ å…¥çš„æ–‡æœ¬æ•°æ®è½¬æ¢æˆå¤§å†™æ ¼å¼ã€‚è¿™ä¸ªè½¬æ¢æµè¿æ¥äº†æ ‡å‡†è¾“å…¥å’Œæ ‡å‡†è¾“å‡ºï¼Œå› æ­¤ä½ å¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥æ–‡æœ¬ï¼Œçœ‹åˆ°å…¶å¤§å†™å½¢å¼çš„ç»“æœã€‚</p><h4 id="ç¤ºä¾‹-2-json-è§£æå™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-json-è§£æå™¨"><span>ç¤ºä¾‹ 2: JSON è§£æå™¨</span></a></h4><p>å‡è®¾æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæµï¼Œå®ƒæ¥æ”¶ä¸€ç³»åˆ— JSON å­—ç¬¦ä¸²ç‰‡æ®µï¼Œç»„åˆå®ƒä»¬ï¼Œå¹¶è§£æä¸º JavaScript å¯¹è±¡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> JSONParseTransform</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableObjectMode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¯ç”¨å¯¹è±¡æ¨¡å¼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // å°è¯•è§£æJSONå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> obj</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">obj</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨é€è§£æåçš„å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨JSONParseTransform</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> jsonParseTr</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> JSONParseTransform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">jsonParseTr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">obj</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è§£æåçš„å¯¹è±¡:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">obj</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">jsonParseTr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;{&quot;name&quot;: &quot;Alice&quot;}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª <code>JSONParseTransform</code> ç±»ï¼Œå®ƒå°è¯•å°†æ¯ä¸ªä¼ å…¥çš„å­—ç¬¦ä¸²ç‰‡æ®µè§£æä¸º JSONã€‚è§£ææˆåŠŸçš„å¯¹è±¡éšåä¼šè¢«æ¨é€åˆ°æµçš„ä¸‹æ¸¸ã€‚æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ç”¨äº† <code>readableObjectMode</code>ï¼Œè¿™æ„å‘³ç€æµè¾“å‡ºçš„æ˜¯å¯¹è±¡è€Œä¸æ˜¯å­—ç¬¦ä¸²æˆ– Bufferã€‚</p><h3 id="æ€»ç»“-23" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-23"><span>æ€»ç»“</span></a></h3><p><code>Transform</code> æµæä¾›äº†å¼ºå¤§çš„æ•°æ®å¤„ç†èƒ½åŠ›ï¼Œå…è®¸ä½ ä»¥æµå¼çš„æ–¹å¼å¯¹æ•°æ®è¿›è¡Œå¤æ‚çš„è½¬æ¢ã€‚ä¸Šè¿°ä¾‹å­å±•ç¤ºäº†å¦‚ä½•è‡ªå®šä¹‰ <code>Transform</code> æµæ¥æ‰§è¡Œç‰¹å®šçš„æ•°æ®è½¬æ¢ä»»åŠ¡ï¼Œä½† Node.js ä¸­ä¹Ÿæœ‰å¾ˆå¤šå†…ç½®çš„ <code>Transform</code> æµï¼ˆæ¯”å¦‚ <code>zlib</code>ã€<code>crypto</code> ç­‰æ¨¡å—ï¼‰ï¼Œå®ƒä»¬å¯ç”¨äºæ›´ä¸°å¯Œçš„åº”ç”¨åœºæ™¯ã€‚</p><h5 id="transform-destroy-error" tabindex="-1"><a class="header-anchor" href="#transform-destroy-error"><span><a href="https://nodejs.org/docs/latest/api/stream.html#transformdestroyerror" target="_blank" rel="noopener noreferrer">transform.destroy([error])</a></span></a></h5><p>ç†è§£<code>transform.destroy([error])</code>æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç®€å•äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„æµï¼ˆStreamsï¼‰å’Œ Transform æµçš„æ¦‚å¿µã€‚</p><p>**æµï¼ˆStreamsï¼‰**åœ¨ Node.js ä¸­æ˜¯å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œå°¤å…¶é€‚ç”¨äºå¤„ç†å¤§é‡æ•°æ®æˆ–è€…ä½ ä¸æƒ³ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­çš„æƒ…å†µã€‚æµå¯ä»¥åˆ†ä¸ºå››ç§ç±»å‹ï¼šå¯è¯»æµã€å¯å†™æµã€åŒå·¥æµï¼ˆæ—¢å¯è¯»åˆå¯å†™ï¼‰ï¼Œä»¥åŠè½¬æ¢æµï¼ˆTransform streamsï¼‰ã€‚</p><p>**è½¬æ¢æµï¼ˆTransform streamsï¼‰**æ˜¯ä¸€ç§ç‰¹æ®Šçš„åŒå·¥æµï¼Œå®ƒèƒ½å¤Ÿåœ¨è¯»å†™è¿‡ç¨‹ä¸­ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æœ‰ä¸€ä¸ªä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ç„¶åå‹ç¼©è¿™äº›æ•°æ®çš„ Transform æµã€‚</p><p>æ¥ç€ï¼Œè®©æˆ‘ä»¬èšç„¦äº<code>transform.destroy([error])</code>æ–¹æ³•ã€‚æ­¤æ–¹æ³•å±äº Transform ç±»ï¼Œç”¨äºæ— æ¡ä»¶åœ°ç»ˆæ­¢æµï¼Œå¯é€‰åœ°å¯ä»¥ä¼ é€’ä¸€ä¸ªé”™è¯¯å‚æ•°ã€‚å½“ä½ è°ƒç”¨<code>destroy()</code>æ—¶ï¼Œæµå°†ä¼šè¢«å…³é—­ï¼Œå¹¶ä¸”ä¸å†å…è®¸è¿›è¡Œè¯»å†™æ“ä½œã€‚å¦‚æœä¼ é€’äº†ä¸€ä¸ªé”™è¯¯å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªé”™è¯¯ä¼šè¢«ä¼ é€’ç»™æµçš„æ¶ˆè´¹è€…ï¼Œé€šå¸¸ä¼šè§¦å‘ä¸€ä¸ª<code>&#39;error&#39;</code>äº‹ä»¶ã€‚</p><h3 id="å®é™…åº”ç”¨çš„ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨çš„ä¾‹å­"><span>å®é™…åº”ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ä¸€ä¸ª Transform æµæ¥å¤„ç†ä¸€äº›æ•°æ®ï¼Œä¾‹å¦‚ï¼Œå¯¹æ–‡ä»¶ä¸­çš„æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚ä½†åœ¨å¤„ç†è¿™äº›æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸€ä¸ªä¸å¯æ¢å¤çš„é”™è¯¯ï¼ˆæ¯”å¦‚ï¼ŒåŠ å¯†å¯†é’¥æ— æ•ˆï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¸Œæœ›ç«‹å³åœæ­¢å¤„ç†å¹¶å…³é—­æµï¼ŒåŒæ—¶å°†é”™è¯¯ä¿¡æ¯ä¼ è¾¾å‡ºå»ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªTransformæµå®ä¾‹ï¼Œç”¨äºæ¨¡æ‹Ÿæ•°æ®åŠ å¯†</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> encryptStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å‡è®¾æˆ‘ä»¬åœ¨è¿™é‡Œå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ä¸ºäº†ç¤ºä¾‹ç®€å•ï¼Œæˆ‘ä»¬åªæ˜¯å°†åŸå§‹æ•°æ®è½¬æ¢ä¸ºå¤§å†™</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> encryptedData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">      encryptedData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toUpperCase</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encryptedData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµï¼ˆæ¯”å¦‚ä»ä¸€ä¸ªæ–‡ä»¶è¯»å–æ•°æ®ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/input.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµï¼ˆæŠŠå¤„ç†åçš„æ•°æ®å†™å…¥å¦ä¸€ä¸ªæ–‡ä»¶ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> writeStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨åŠ å¯†è¿‡ç¨‹ä¸­å‘ç°é”™è¯¯ï¼Œéœ€è¦ç»ˆæ­¢æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">encryptStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">/* æ£€æµ‹åˆ°æŸä¸ªé”™è¯¯æ¡ä»¶ */</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    encryptStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Encryption failed.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¤„ç†&#39;transform.destroy&#39;å¼•èµ·çš„é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">encryptStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stream error:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ç®¡é“é“¾æ¥æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encryptStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šä»£ç ç¤ºä¾‹åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ Transform æµï¼Œç”¨äºåŠ å¯†ä»ä¸€ä¸ªæ–‡ä»¶è¯»å–çš„æ•°æ®ï¼Œå¹¶å°†åŠ å¯†åçš„æ•°æ®å†™å…¥å¦ä¸€ä¸ªæ–‡ä»¶ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘ç°äº†ä¸€ä¸ªé”™è¯¯ï¼Œæˆ‘ä»¬å°±è°ƒç”¨<code>encryptStream.destroy(new Error(&#39;Encryption failed.&#39;));</code>æ¥ç»ˆæ­¢æµå¹¶ä¼ é€’é”™è¯¯ä¿¡æ¯ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿æµè¢«é€‚å½“åœ°å…³é—­ï¼Œå¹¶ä¸”ç›¸å…³çš„èµ„æºè¢«é‡Šæ”¾ï¼ŒåŒæ—¶ä¹Ÿå‘æµçš„æ¶ˆè´¹è€…æŠ¥å‘Šäº†é”™è¯¯ã€‚</p><h3 id="stream-finished-stream-options-callback" tabindex="-1"><a class="header-anchor" href="#stream-finished-stream-options-callback"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streamfinishedstream-options-callback" target="_blank" rel="noopener noreferrer">stream.finished(stream[, options], callback)</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„ streamï¼ˆæµï¼‰æ—¶ï¼Œå¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ç§æ•°æ®çš„ç®¡é“ã€‚è¿™äº›æ•°æ®å¯èƒ½æ˜¯æ–‡ä»¶ä¸­çš„å†…å®¹ã€ç½‘ç»œè¯·æ±‚çš„æ•°æ®ç­‰ï¼Œè€Œæµå°±åƒæ˜¯å°†è¿™äº›æ•°æ®ä»ä¸€ä¸ªåœ°æ–¹â€œæµåŠ¨â€åˆ°å¦ä¸€ä¸ªåœ°æ–¹çš„ç®¡é“ã€‚åœ¨ Node.js ä¸­å¤„ç†æµæ˜¯éå¸¸å¸¸è§çš„ä»»åŠ¡ï¼Œå› ä¸ºå®ƒå…è®¸ä½ ä»¥éå¸¸é«˜æ•ˆçš„æ–¹å¼å¤„ç†å¤§é‡æ•°æ®ã€‚æ¯”å¦‚è¯´ï¼Œé€šè¿‡æµï¼Œä½ å¯ä»¥è¾¹è¯»å–æ–‡ä»¶è¾¹å¤„ç†æ–‡ä»¶ï¼Œè€Œä¸éœ€è¦ç­‰å¾…æ•´ä¸ªæ–‡ä»¶éƒ½è¢«è¯»å–è¿›å†…å­˜ã€‚</p><h3 id="stream-finished-stream-options-callback-1" tabindex="-1"><a class="header-anchor" href="#stream-finished-stream-options-callback-1"><span><code>stream.finished(stream[, options], callback)</code></span></a></h3><p>è¿™ä¸ªå‡½æ•°<code>stream.finished</code>æ˜¯ç”¨æ¥ç›‘å¬ä¸€ä¸ªæµæ˜¯å¦ç»“æŸäº†ï¼ˆæ— è®ºæ˜¯æ­£å¸¸ç»“æŸè¿˜æ˜¯å› ä¸ºå‡ºé”™è€Œç»ˆæ­¢ï¼‰ã€‚å½“æµçš„è¯»å–æˆ–å†™å…¥æ“ä½œå®Œæˆæ—¶ï¼Œå›è°ƒå‡½æ•°<code>callback</code>ä¼šè¢«è°ƒç”¨ã€‚ä½¿ç”¨è¿™ä¸ªå‡½æ•°å¯ä»¥é¿å…æ‰‹åŠ¨ç›‘å¬å„ç§äº‹ä»¶æ¥åˆ¤æ–­æµæ˜¯å¦ç»“æŸï¼Œç®€åŒ–äº†å¯¹æµç»“æŸçŠ¶æ€çš„ç®¡ç†ã€‚</p><h4 id="å‚æ•°-7" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-7"><span>å‚æ•°</span></a></h4><ul><li><code>stream</code>: è¿™æ˜¯ä½ è¦ç›‘å¬ç»“æŸäº‹ä»¶çš„é‚£ä¸ªæµå¯¹è±¡ã€‚</li><li><code>options</code> (å¯é€‰): ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œå¯ä»¥æŒ‡å®šè¡Œä¸ºç»†èŠ‚ï¼Œä¾‹å¦‚è®¾å®šè¶…æ—¶æ—¶é—´ã€‚</li><li><code>callback</code>: å½“æµç»“æŸæ—¶ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚å¦‚æœæµå› ä¸ºé”™è¯¯ç»“æŸï¼Œåˆ™è¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¼šä¼ é€’ä¸€ä¸ªé”™è¯¯å¯¹è±¡ã€‚</li></ul><h4 id="å®é™…è¿ç”¨ä¾‹å­-16" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-16"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h4><h5 id="ç¤ºä¾‹-1-ç›‘å¬æ–‡ä»¶è¯»å–æµç»“æŸ-1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-ç›‘å¬æ–‡ä»¶è¯»å–æµç»“æŸ-1"><span>ç¤ºä¾‹ 1: ç›‘å¬æ–‡ä»¶è¯»å–æµç»“æŸ</span></a></h5><p>å‡è®¾ä½ æ­£åœ¨è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œä½ å¸Œæœ›åœ¨è¯»å–å®Œæ¯•åï¼Œæ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œæˆ–è€…è¿›ä¸€æ­¥å¤„ç†ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">finished</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªè¯»å–æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/large/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ stream.finished æ¥ç›‘å¬æµæ˜¯å¦ç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">finished</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æµå¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶å·²æˆåŠŸè¯»å–å®Œæ¯•ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥æ”¾å¿ƒåœ°è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼Œæ¯”å¦‚å…³é—­æ–‡ä»¶å¥æŸ„ç­‰ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼€å§‹æµå¼è¯»å–æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">resume</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="ç¤ºä¾‹-2-ç›‘å¬-http-å“åº”ç»“æŸ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ç›‘å¬-http-å“åº”ç»“æŸ"><span>ç¤ºä¾‹ 2: ç›‘å¬ HTTP å“åº”ç»“æŸ</span></a></h5><p>è€ƒè™‘è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šä½ å‘ä¸€ä¸ªç½‘å€å‘é€äº†ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œå¹¶é€šè¿‡æµå¤„ç†å“åº”æ•°æ®ã€‚ä½ å¸Œæœ›åœ¨æ¥æ”¶å®Œæ‰€æœ‰æ•°æ®åå…³é—­è¿æ¥æˆ–æ‰§è¡Œå…¶ä»–æ“ä½œï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">finished</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘é€ä¸€ä¸ªGETè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // res æ˜¯ä¸€ä¸ªä»æœåŠ¡å™¨è¿”å›çš„å“åº”æµ</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†å“åº”æµæ•°æ®...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ç›‘å¬æµç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  finished</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;åœ¨æ¥æ”¶æ•°æ®è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å“åº”æ•°æ®æ¥æ”¶å®Œæ¯•ã€‚&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åœ¨è¿™é‡Œæ‰§è¡Œåç»­æ“ä½œï¼Œæ¯”å¦‚å…³é—­è¿æ¥ç­‰ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡<code>stream.finished</code>å‡½æ•°ï¼Œä½ å¯ä»¥ç®€æ´åœ°ç¡®ä¿åœ¨æµæ­£ç¡®ç»“æŸåæ‰§è¡Œæ‰€éœ€çš„æ“ä½œï¼Œè€Œæ— éœ€æ‹…å¿ƒå¿˜è®°å¤„ç†é”™è¯¯æƒ…å†µæˆ–æ˜¯æ‰‹åŠ¨ç›‘å¬å¤šä¸ªäº‹ä»¶ã€‚</p><h3 id="stream-pipeline-source-transforms-destination-callback" tabindex="-1"><a class="header-anchor" href="#stream-pipeline-source-transforms-destination-callback"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streampipelinesource-transforms-destination-callback" target="_blank" rel="noopener noreferrer">stream.pipeline(source[, ...transforms], destination, callback)</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬ä¸€æ­¥æ­¥åœ°äº†è§£<code>stream.pipeline</code>åœ¨ Node.js ä¸­çš„ä½œç”¨å’Œå¦‚ä½•ä½¿ç”¨å®ƒï¼Œå°¤å…¶æ˜¯åœ¨ v21.7.1 ç‰ˆæœ¬ä¸­ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-stream-3" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-stream-3"><span>ä»€ä¹ˆæ˜¯ Streamï¼Ÿ</span></a></h3><p>é¦–å…ˆï¼Œå¾—çŸ¥é“ä»€ä¹ˆæ˜¯ Streamï¼ˆæµï¼‰ã€‚Stream æ˜¯ç”¨äºå¤„ç†æ•°æ®çš„ä¸€ä¸ªæ¥å£ï¼Œç‰¹åˆ«é€‚åˆç”¨äºå¤„ç†å¤§é‡æ•°æ®æˆ–è€…é€å—å¤„ç†æ•°æ®ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€æ¡æ°´ç®¡ï¼ˆStreamï¼‰ï¼Œæ°´ï¼ˆæ•°æ®ï¼‰å¯ä»¥ä»ä¸€ç«¯æµå…¥ï¼Œç»è¿‡ä¸€ç³»åˆ—å¤„ç†ï¼Œå†ä»å¦ä¸€ç«¯æµå‡ºã€‚</p><p>Node.js ä¸­æœ‰å››ç§åŸºæœ¬ç±»å‹çš„ Streamï¼š</p><ul><li><strong>Readable</strong> - å¯è¯»å–æ•°æ®çš„æµï¼ˆä¾‹å¦‚ï¼šæ–‡ä»¶è¯»å–ï¼‰ã€‚</li><li><strong>Writable</strong> - å¯å†™å…¥æ•°æ®çš„æµï¼ˆä¾‹å¦‚ï¼šæ–‡ä»¶å†™å…¥ï¼‰ã€‚</li><li><strong>Duplex</strong> - æ—¢å¯è¯»åˆå¯å†™çš„æµã€‚</li><li><strong>Transform</strong> - å¯ä»¥ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®çš„ Duplex æµã€‚</li></ul><h3 id="stream-pipelineå‡½æ•°ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#stream-pipelineå‡½æ•°ä»‹ç»"><span><code>stream.pipeline</code>å‡½æ•°ä»‹ç»</span></a></h3><p><code>stream.pipeline</code>æ˜¯ä¸€ä¸ªå·¥å…·å‡½æ•°ï¼Œç”¨äºå°†æµ(Streams)è¿æ¥èµ·æ¥ï¼Œå½“æºå¤´(Stream)æ•°æ®è¢«å®Œå…¨æ¶ˆè€—æ—¶ï¼Œpipeline ä¼šè‡ªåŠ¨å…³é—­ç›®æ ‡ Streamï¼Œéå¸¸é€‚åˆç”¨äºç®¡ç†æµçš„ç”Ÿå‘½å‘¨æœŸï¼Œé¿å…å› ä¸ºé”™è¯¯å¯¼è‡´å†…å­˜æ³„æ¼ç­‰é—®é¢˜ã€‚</p><h4 id="å‡½æ•°ç­¾å" tabindex="-1"><a class="header-anchor" href="#å‡½æ•°ç­¾å"><span>å‡½æ•°ç­¾å</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">source</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, [</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">transforms</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">], </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">destination</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><strong>source</strong>: æ•°æ®æºçš„ Streamï¼Œå¿…é¡»æ˜¯ Readable Streamã€‚</li><li><strong>transforms</strong>: ï¼ˆå¯é€‰ï¼‰ä¸€ä¸ªæˆ–å¤šä¸ª Transform Streamï¼Œç”¨äºå¤„ç†æ•°æ®ã€‚</li><li><strong>destination</strong>: æ•°æ®æœ€ç»ˆå»å‘çš„ Streamï¼Œå¿…é¡»æ˜¯ Writable Streamã€‚</li><li><strong>callback</strong>: å½“ pipeline å®Œæˆæˆ–å‡ºé”™æ—¶è°ƒç”¨çš„å‡½æ•°ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-17" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-17"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-å¤åˆ¶æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-å¤åˆ¶æ–‡ä»¶"><span>ä¾‹å­ 1ï¼šå¤åˆ¶æ–‡ä»¶</span></a></h4><p>æƒ³è±¡æˆ‘ä»¬è¦æŠŠä¸€ä¸ªæ–‡ä»¶å†…å®¹å¤åˆ¶åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>fs.createReadStream</code>åˆ›å»ºä¸€ä¸ªæºå¤´ Readable Streamï¼Œç„¶åç”¨<code>fs.createWriteStream</code>åˆ›å»ºä¸€ä¸ªç›®æ ‡ Writable Streamï¼Œæœ€åç”¨<code>stream.pipeline</code>è¿æ¥è¿™ä¸¤è€…ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> pipeline</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">promisify</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> copyFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">srcFilePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">destFilePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> source</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">srcFilePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> destination</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">destFilePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">source</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">destination</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶å¤åˆ¶å®Œæˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">copyFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;source.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;destination.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†<code>util.promisify</code>æ¥å°†<code>pipeline</code>è½¬æ¢æˆè¿”å› Promise çš„å‡½æ•°ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨<code>async/await</code>è¿›è¡Œæ›´ä¼˜é›…çš„é”™è¯¯å¤„ç†å’Œæµç¨‹æ§åˆ¶ã€‚</p><h4 id="ä¾‹å­-2-å‹ç¼©æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-å‹ç¼©æ–‡ä»¶"><span>ä¾‹å­ 2ï¼šå‹ç¼©æ–‡ä»¶</span></a></h4><p>æ¯”æ–¹è¯´æˆ‘ä»¬æƒ³è¦å‹ç¼©ä¸€ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨<code>zlib</code>æ¨¡å—æä¾›çš„<code>createGzip</code>å‡½æ•°åˆ›å»ºä¸€ä¸ª Transform Stream è¿›è¡Œæ•°æ®å‹ç¼©ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;zlib&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;util&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> pipeline</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> util</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">promisify</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> compressFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">input</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">output</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> source</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">input</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> destination</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">output</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> gzip</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createGzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">source</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">gzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">destination</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶å‹ç¼©å®Œæˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">compressFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;input.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt.gz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œ<code>gzip</code>å˜é‡æ˜¯ä¸€ä¸ª Transform Streamï¼Œå®ƒå¤„äºè¯»å–æºæ–‡ä»¶å’Œå†™å…¥ç›®æ ‡æ–‡ä»¶ä¹‹é—´ï¼Œå¯¹æ•°æ®è¿›è¡Œå‹ç¼©å¤„ç†ã€‚</p><h3 id="æ€»ç»“-24" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-24"><span>æ€»ç»“</span></a></h3><p>é€šè¿‡<code>stream.pipeline</code>ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å°†ä¸åŒç±»å‹çš„ Stream è¿æ¥èµ·æ¥ï¼Œè¿›è¡Œæ•°æ®çš„è¯»å–ã€å¤„ç†å’Œå†™å…¥æ“ä½œï¼Œè€Œæ— éœ€æ‹…å¿ƒèµ„æºç®¡ç†å’Œé”™è¯¯å¤„ç†çš„å¤æ‚æ€§ã€‚è¿™ä½¿å¾—åœ¨ Node.js ä¸­å¤„ç†å¤§é‡æ•°æ®å˜å¾—å¼‚å¸¸ç®€å•å’Œé«˜æ•ˆã€‚</p><h3 id="stream-pipeline-streams-callback" tabindex="-1"><a class="header-anchor" href="#stream-pipeline-streams-callback"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streampipelinestreams-callback" target="_blank" rel="noopener noreferrer">stream.pipeline(streams, callback)</a></span></a></h3><p>è®©æˆ‘ä»¬ç”¨ç®€å•çš„è¯­è¨€æ¥ç†è§£ Node.js ä¸­çš„ <code>stream.pipeline</code> å‡½æ•°ï¼Œå®ƒæ˜¯å¤„ç†æ•°æ®æµçš„ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-stream-4" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-stream-4"><span>ä»€ä¹ˆæ˜¯ Streamï¼Ÿ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼ŒStreamï¼ˆæµï¼‰æ˜¯ä¸€ç§å¤„ç†è¯»å†™æ•°æ®çš„æ–¹å¼ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªéå¸¸å¤§çš„æ°´æ¡¶ï¼Œéœ€è¦æŠŠè¿™æ¡¶æ°´å€’å…¥å¦ä¸€ä¸ªæ¡¶ä¸­ã€‚å¦‚æœç›´æ¥æ¬èµ·æ¥å€’ï¼Œå¯èƒ½å› ä¸ºå¤ªé‡è€Œå¯¼è‡´æ°´æº¢å‡ºæˆ–è€…æ¡¶ç ´è£‚ã€‚Stream å°±åƒæ˜¯å°†è¿™ä¸ªå¤§æ¡¶æ°´é€šè¿‡ä¸€æ ¹ç®¡é“æ…¢æ…¢è½¬ç§»åˆ°å¦ä¸€ä¸ªæ¡¶ä¸­ï¼Œæ—¢é«˜æ•ˆåˆå®‰å…¨ã€‚</p><h3 id="pipeline-çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#pipeline-çš„ä½œç”¨"><span>pipeline çš„ä½œç”¨</span></a></h3><p><code>pipeline</code> æ˜¯ä¸€ä¸ªç‰¹å®šç±»å‹çš„ Streamï¼Œå®ƒçš„ç›®çš„æ˜¯å¸®åŠ©ä½ ç®¡ç†å¤šä¸ªæ­¥éª¤çš„æ•°æ®æµè½¬æ¢å’Œä¼ è¾“è¿‡ç¨‹ã€‚å®ƒä¼šè‡ªåŠ¨å¤„ç†æµä¹‹é—´çš„é€Ÿåº¦åŒ¹é…é—®é¢˜å’Œé”™è¯¯å¤„ç†ï¼Œä½¿å¾—æ•´ä¸ªæ•°æ®ä¼ è¾“è¿‡ç¨‹æ›´åŠ ç®€æ´å’Œç¨³å®šã€‚</p><h3 id="ä½¿ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ç¤ºä¾‹-1"><span>ä½¿ç”¨ç¤ºä¾‹</span></a></h3><p>è®©æˆ‘ä»¬çœ‹å‡ ä¸ªå®é™…çš„åº”ç”¨ä¾‹å­æ¥æ›´å¥½åœ°ç†è§£ <code>stream.pipeline</code>ã€‚</p><h4 id="ä¾‹å­-1-æ–‡ä»¶å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-æ–‡ä»¶å¤åˆ¶"><span>ä¾‹å­ 1: æ–‡ä»¶å¤åˆ¶</span></a></h4><p>å‡å¦‚ä½ æƒ³è¦å¤åˆ¶ä¸€ä¸ªæ–‡ä»¶ï¼Œä¼ ç»Ÿçš„æ–¹å¼å¯èƒ½éœ€è¦å…ˆè¯»å–æ•´ä¸ªæ–‡ä»¶åˆ°å†…å­˜ä¸­ï¼Œç„¶åå†å†™å…¥åˆ°æ–°æ–‡ä»¶ä¸­ã€‚å¯¹äºéå¸¸å¤§çš„æ–‡ä»¶ï¼Œè¿™æ ·åšå¯èƒ½ä¼šå ç”¨å¤§é‡å†…å­˜ï¼Œç”šè‡³å¯¼è‡´ç¨‹åºå´©æºƒã€‚ä½¿ç”¨ <code>stream.pipeline</code> å¯ä»¥æ›´åŠ æœ‰æ•ˆï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµå’Œä¸€ä¸ªå¯å†™æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> source</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;source.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> destination</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;destination.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ pipeline å°†æ•°æ®ä» source.txt å¤åˆ¶åˆ° destination.txt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">source</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">destination</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å¤åˆ¶è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶å¤åˆ¶æˆåŠŸï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-2-å‹ç¼©æ–‡ä»¶-1" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-å‹ç¼©æ–‡ä»¶-1"><span>ä¾‹å­ 2: å‹ç¼©æ–‡ä»¶</span></a></h4><p>å¦‚æœä½ æƒ³è¦å‹ç¼©ä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>pipeline</code> ç»“åˆ zlib æ¨¡å—æ¥å®ç°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;zlib&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµã€ä¸€ä¸ªå‹ç¼©æµå’Œä¸€ä¸ªå¯å†™æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> source</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> gzip</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createGzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> destination</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;file.txt.gz&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ pipeline å°† file.txt å‹ç¼©åä¿å­˜ä¸º file.txt.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">source</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">gzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">destination</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å‹ç¼©è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ–‡ä»¶å‹ç¼©æˆåŠŸï¼&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ€»ç»“-25" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-25"><span>æ€»ç»“</span></a></h3><p><code>stream.pipeline</code> æ˜¯ Node.js ä¸­ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œå®ƒè®©ç®¡ç†å’Œæ“ä½œæ•°æ®æµå˜å¾—ç®€å•å’Œé«˜æ•ˆã€‚æ— è®ºæ˜¯è¯»å†™æ–‡ä»¶ã€å‹ç¼©æ–‡ä»¶è¿˜æ˜¯ç½‘ç»œæ•°æ®ä¼ è¾“ï¼Œ<code>pipeline</code> éƒ½èƒ½æä¾›ä¸€ç§ä¼˜é›…å’Œç¨³å®šçš„å¤„ç†æ–¹å¼ã€‚</p><h3 id="stream-compose-streams" tabindex="-1"><a class="header-anchor" href="#stream-compose-streams"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streamcomposestreams" target="_blank" rel="noopener noreferrer">stream.compose(...streams)</a></span></a></h3><p>Node.js v21.7.1 ä¸­çš„<code>stream.compose(...streams)</code>æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ–¹æ³•ï¼Œæ—¨åœ¨å°†å¤šä¸ªæµï¼ˆStreamsï¼‰ç»„åˆæˆå•ä¸€çš„ã€å¯ç®¡ç†çš„æµã€‚è¿™å¯¹äºå¤„ç†æ•°æ®æµéå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯å½“ä½ éœ€è¦å°†å¤šä¸ªä¸åŒçš„å¤„ç†æ­¥éª¤æˆ–æ“ä½œä¸²è”èµ·æ¥æ—¶ã€‚</p><h3 id="ç†è§£-streams" tabindex="-1"><a class="header-anchor" href="#ç†è§£-streams"><span>ç†è§£ Streams</span></a></h3><p>åœ¨æ·±å…¥äº†è§£<code>stream.compose</code>ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆç®€å•å›é¡¾ä¸€ä¸‹ä»€ä¹ˆæ˜¯ Streamsã€‚åœ¨ Node.js ä¸­ï¼ŒStreams æ˜¯å¤„ç†è¯»å–ï¼ˆä¾‹å¦‚ä»æ–‡ä»¶è¯»å–æ•°æ®ï¼‰å’Œå†™å…¥ï¼ˆä¾‹å¦‚å†™å…¥åˆ°æ–‡ä»¶ï¼‰æ“ä½œçš„ä¸€ç§æ–¹å¼ã€‚Streams å¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ï¼Œæˆ–è€…å³å¯è¯»åˆå¯å†™çš„ã€‚å®ƒä»¬éå¸¸é€‚åˆå¤„ç†å¤§é‡æ•°æ®ï¼Œå› ä¸ºä½ æ— éœ€ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼›ç›¸åï¼Œæ•°æ®å¯ä»¥åˆ†æ‰¹å¤„ç†ï¼Œä»è€Œå‡å°‘å†…å­˜å ç”¨å¹¶æé«˜æ•ˆç‡ã€‚</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦stream-compose" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦stream-compose"><span>ä¸ºä»€ä¹ˆéœ€è¦<code>stream.compose</code></span></a></h3><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°éœ€è¦å°†å¤šä¸ªæ“ä½œä¸²è”èµ·æ¥å¤„ç†æ•°æ®çš„æƒ…å†µã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½æƒ³è¦ä»ä¸€ä¸ªæ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œç„¶åå¯¹æ•°æ®è¿›è¡Œè½¬æ¢ï¼ˆæ¯”å¦‚å‹ç¼©ã€åŠ å¯†ç­‰ï¼‰ï¼Œæœ€åå°†è½¬æ¢åçš„æ•°æ®å†™å…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>stream.pipeline</code>æ¥ä¸²è”è¿™äº›æ“ä½œï¼Œä½†å¦‚æœä½ å¸Œæœ›å°†è¿™ä¸€ç³»åˆ—çš„æ“ä½œå°è£…æˆä¸€ä¸ªå•ç‹¬çš„ã€å¯é‡ç”¨çš„æµï¼Œ<code>stream.compose</code>å°±éå¸¸æœ‰ç”¨äº†ã€‚</p><h3 id="stream-composeçš„å·¥ä½œåŸç†" tabindex="-1"><a class="header-anchor" href="#stream-composeçš„å·¥ä½œåŸç†"><span><code>stream.compose</code>çš„å·¥ä½œåŸç†</span></a></h3><p><code>stream.compose</code>å…è®¸ä½ å°†å¤šä¸ªæµï¼ˆæ¯”å¦‚ä¸€ä¸ªå¯è¯»æµã€ä¸€ä¸ªæˆ–å¤šä¸ªè½¬æ¢æµã€ä»¥åŠä¸€ä¸ªå¯å†™æµï¼‰ç»„åˆæˆä¸€ä¸ªæ–°çš„åŒå‘æµã€‚è¿™æ„å‘³ç€ï¼Œä½ å¯ä»¥åƒå¤„ç†å•ä¸ªæµä¸€æ ·å¤„ç†è¿™ä¸ªç»„åˆåçš„æµã€‚</p><h3 id="ä½¿ç”¨ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨ç¤ºä¾‹-2"><span>ä½¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æƒ³ä»ä¸€ä¸ªæ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œå°†æ•°æ®è½¬æ¢ä¸ºå¤§å†™å½¢å¼ï¼Œç„¶åå†™å…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ã€‚é¦–å…ˆï¼Œä½ éœ€è¦å¼•å…¥æ‰€éœ€çš„æ¨¡å—ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">compose</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªè½¬æ¢æµï¼Œç”¨äºå°†æ•°æ®è½¬æ¢ä¸ºå¤§å†™ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> upperCaseTransform</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å°†è¾“å…¥æ•°æ®è½¬æ¢ä¸ºå¤§å†™</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toUpperCase</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œä½¿ç”¨<code>compose</code>æ–¹æ³•å°†è¿™äº›æµç»„åˆèµ·æ¥ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;input.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writeStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç»„åˆæµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> composedStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> compose</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">upperCaseTransform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>composedStream</code>ç°åœ¨ä»£è¡¨äº†ä»<code>input.txt</code>è¯»å–æ•°æ®ï¼Œå°†æ•°æ®è½¬æ¢ä¸ºå¤§å†™ï¼Œç„¶åå†™å…¥åˆ°<code>output.txt</code>çš„æ•´ä¸ªæµç¨‹ã€‚ä½¿ç”¨<code>stream.compose</code>ï¼Œä½ åªéœ€è¦å…³å¿ƒæ•´ä½“çš„æ•°æ®æµåŠ¨ï¼Œæ— éœ€æ“å¿ƒæ¯ä¸ªå•ç‹¬çš„æ­¥éª¤ã€‚</p><p>é€šè¿‡<code>stream.compose</code>ï¼ŒNode.js ä½¿å¾—å°†å¤šä¸ªæ“ä½œä¸²è”èµ·æ¥å˜å¾—ç®€å•ä¸”é«˜æ•ˆï¼Œæå¤§åœ°å¢å¼ºäº†å¤„ç†æµæ•°æ®çš„èƒ½åŠ›ã€‚</p><h3 id="stream-readable-from-iterable-options" tabindex="-1"><a class="header-anchor" href="#stream-readable-from-iterable-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streamreadablefromiterable-options" target="_blank" rel="noopener noreferrer">stream.Readable.from(iterable[, options])</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ <code>stream.Readable.from(iterable[, options])</code> æ–¹æ³•ï¼Œå¹¶é€šè¿‡ä¸€äº›å®é™…çš„ç¤ºä¾‹æ¥ç†è§£å…¶ç”¨é€”å’Œå·¥ä½œåŸç†ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-7" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-7"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><p>é¦–å…ˆï¼Œéœ€è¦äº†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p><ul><li><strong>Node.js</strong>: ä¸€ä¸ªè®© JavaScript è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„å¹³å°ï¼Œå®ƒéå¸¸é€‚åˆå¤„ç†é«˜å¹¶å‘ã€I/O å¯†é›†å‹çš„ä»»åŠ¡ã€‚</li><li><strong>Streamï¼ˆæµï¼‰</strong>: åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§å¤„ç†è¯»å†™æ•°æ®çš„æ–¹å¼ã€‚å¯ä»¥å°†å…¶æƒ³è±¡æˆä¸€ä¸ªæ•°æ®çš„ç®¡é“ï¼Œè¿™äº›æ•°æ®å¯ä»¥ä¸€å—ä¸€å—åœ°ä¼ è¾“ã€‚æµçš„å¥½å¤„æ˜¯ä½ ä¸éœ€è¦ç­‰å¾…æ‰€æœ‰æ•°æ®éƒ½å‡†å¤‡å¥½æ‰å¼€å§‹å¤„ç†ï¼Œè¿™å¯¹äºå¤„ç†å¤§é‡æ•°æ®éå¸¸æœ‰ç”¨ã€‚</li><li><strong>Readable Streamï¼ˆå¯è¯»æµï¼‰</strong>: æ˜¯ä¸€ç§æµï¼Œå®ƒç”¨äºä»æŸå¤„è¯»å–æ•°æ®ã€‚æ¯”å¦‚ä»æ–‡ä»¶ã€è¯·æ±‚æˆ–è€…æ•°ç»„ä¸­è¯»å–æ•°æ®ã€‚</li></ul><h3 id="stream-readable-from-iterable-options-1" tabindex="-1"><a class="header-anchor" href="#stream-readable-from-iterable-options-1"><span><code>stream.Readable.from(iterable[, options])</code></span></a></h3><p>è¿™ä¸ªæ–¹æ³•ä½¿å¾—åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Readable</code> æµå˜å¾—ç®€å•ç›´æ¥ã€‚å®ƒæ¥å—ä¸€ä¸ª<strong>å¯è¿­ä»£å¯¹è±¡</strong>ï¼ˆä¾‹å¦‚æ•°ç»„ã€å­—ç¬¦ä¸²æˆ–ç”Ÿæˆå™¨å‡½æ•°ï¼‰ä½œä¸ºè¾“å…¥ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå°†è¿™ä¸ªå¯è¿­ä»£å¯¹è±¡çš„å…ƒç´ é€ä¸ªå‘é€å‡ºå»çš„å¯è¯»æµã€‚</p><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>iterable</code>: ä¸€ä¸ªç¬¦åˆè¿­ä»£åè®®çš„å¯¹è±¡ï¼Œå³å¯ä»¥è¢« for...of å¾ªç¯éå†çš„å¯¹è±¡ã€‚</li><li><code>options</code>: å¯é€‰å‚æ•°ï¼Œå…è®¸é…ç½®ä¸€äº›æµçš„è¡Œä¸ºï¼Œæ¯”å¦‚ç¼–ç æ–¹å¼æˆ–æ˜¯æµåº”è¯¥å¦‚ä½•å¤„ç†å†…éƒ¨ç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-18" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-18"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="ç¤ºä¾‹-1-ä»æ•°ç»„åˆ›å»ºæµ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-ä»æ•°ç»„åˆ›å»ºæµ"><span>ç¤ºä¾‹ 1: ä»æ•°ç»„åˆ›å»ºæµ</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªåŒ…å«ä¸€ç³»åˆ—åç§°çš„æ•°ç»„ï¼Œä½ æƒ³è¦é€ä¸ªåœ°å°†è¿™äº›åç§°æ‰“å°å‡ºæ¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹æ•°ç»„</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> names</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Alice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Bob&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Charlie&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨Readable.fromåˆ›å»ºä¸€ä¸ªæµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> nameStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">names</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬&quot;data&quot;äº‹ä»¶æ¥è·å–æµä¸­çš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">nameStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å½“æµç»“æŸæ—¶ï¼Œæ‰“å°ä¸€æ¡ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">nameStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No more data.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>nameStream</code>æ˜¯ä¸€ä¸ªç”±<code>names</code>æ•°ç»„åˆ›å»ºçš„å¯è¯»æµã€‚å½“æˆ‘ä»¬ç›‘å¬åˆ°<code>data</code>äº‹ä»¶æ—¶ï¼Œå°±ä¼šé€ä¸ªåœ°æ¥æ”¶åˆ°æ•°ç»„ä¸­çš„åå­—å¹¶å°†å…¶æ‰“å°å‡ºæ¥ã€‚å½“æ‰€æœ‰çš„åå­—éƒ½è¢«æ‰“å°åï¼Œæµç»“æŸï¼Œè§¦å‘<code>end</code>äº‹ä»¶ã€‚</p><h4 id="ç¤ºä¾‹-2-ä½¿ç”¨å¼‚æ­¥è¿­ä»£å™¨" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ä½¿ç”¨å¼‚æ­¥è¿­ä»£å™¨"><span>ç¤ºä¾‹ 2: ä½¿ç”¨å¼‚æ­¥è¿­ä»£å™¨</span></a></h4><p>å¦‚æœä½ æƒ³è¦ä»¥å¼‚æ­¥çš„æ–¹å¼å¤„ç†ä¸€ç³»åˆ—å¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚ä»æ•°æ®åº“ä¸­é€ä¸ªè·å–è®°å½•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>Readable.from</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿå¼‚æ­¥è·å–æ•°æ®çš„å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚æ•°æ®åº“æŸ¥è¯¢</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    await</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    yield</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨Readable.fromåˆ›å»ºä¸€ä¸ªæµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dataStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">dataStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">dataStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No more data.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>fetchData</code>æ˜¯ä¸€ä¸ªå¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°ï¼Œå®ƒæ¨¡æ‹Ÿäº†å¼‚æ­¥è·å–æ•°æ®çš„è¿‡ç¨‹ã€‚é€šè¿‡<code>Readable.from</code>ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å°†è¿™ä¸ªå¼‚æ­¥è¿‡ç¨‹è½¬æ¢ä¸ºä¸€ä¸ªæµï¼Œç„¶ååƒå¤„ç†æ™®é€šæµä¸€æ ·å¤„ç†è¿™äº›æ•°æ®ã€‚</p><h3 id="æ€»ç»“-26" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-26"><span>æ€»ç»“</span></a></h3><p><code>stream.Readable.from</code>æ˜¯ä¸€ä¸ªå¼ºå¤§è€Œçµæ´»çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ä½ å°†å„ç§ç±»å‹çš„æ•°æ®æºè½¬æ¢ä¸º Node.js ä¸­çš„æµã€‚é€šè¿‡æµçš„æ–¹å¼å¤„ç†æ•°æ®å¯ä»¥è®©ä½ çš„åº”ç”¨æ›´åŠ é«˜æ•ˆï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–éœ€è¦è¿›è¡Œå¼‚æ­¥å¤„ç†æ—¶ã€‚å¸Œæœ›ä»¥ä¸Šçš„è§£é‡Šå’Œç¤ºä¾‹èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£è¿™ä¸ªåŠŸèƒ½ï¼</p><h3 id="stream-readable-fromweb-readablestream-options" tabindex="-1"><a class="header-anchor" href="#stream-readable-fromweb-readablestream-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streamreadablefromwebreadablestream-options" target="_blank" rel="noopener noreferrer">stream.Readable.fromWeb(readableStream[, options])</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ JavaScript ä»£ç ã€‚åœ¨ Node.js ä¸­ï¼Œstreamsï¼ˆæµï¼‰æ˜¯å¤„ç†è¯»å–æˆ–å†™å…¥æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œå®ƒä»¬å¯ä»¥å¸®åŠ©ä½ ä»¥é«˜æ•ˆçš„æ–¹å¼å¤„ç†å¤§é‡æ•°æ®ï¼Œä¾‹å¦‚ä»æ–‡ä»¶è¯»å–æ•°æ®æˆ–è€…å‘æ–‡ä»¶å†™å…¥æ•°æ®ã€‚</p><p><code>stream.Readable.fromWeb</code>æ˜¯ Node.js v21.7.1 ä¸­å¼•å…¥çš„ä¸€ä¸ªæ–°çš„ APIï¼Œå®ƒå…è®¸å¼€å‘è€…å°†ä¸€ä¸ªç¬¦åˆ Web æ ‡å‡†çš„<code>ReadableStream</code>ï¼ˆé€šå¸¸ç”¨äºå‰ç«¯åº”ç”¨ä¸­ï¼‰è½¬æ¢æˆ Node.js ä¸­çš„<code>stream.Readable</code>å¯¹è±¡ã€‚è¿™æ„å‘³ç€ä½ ç°åœ¨å¯ä»¥æ›´å®¹æ˜“åœ°åœ¨ Node.js ä¸­ä½¿ç”¨æ¥è‡ªæµè§ˆå™¨ç¯å¢ƒçš„æµæ•°æ®ã€‚</p><h3 id="ä½•ä¸ºreadablestream" tabindex="-1"><a class="header-anchor" href="#ä½•ä¸ºreadablestream"><span>ä½•ä¸º<code>ReadableStream</code></span></a></h3><p>åœ¨æ·±å…¥äº†è§£<code>stream.Readable.fromWeb</code>ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£ä»€ä¹ˆæ˜¯<code>ReadableStream</code>ã€‚åœ¨ Web APIs ä¸­ï¼ˆä¸»è¦æ˜¯æŒ‡åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹ï¼‰ï¼Œ<code>ReadableStream</code>æ˜¯ç”¨æ¥è¡¨ç¤ºè¯»å–æ•°æ®æµçš„æ¥å£ã€‚ä¾‹å¦‚ï¼Œå½“ä½ ä»ç½‘ç»œè·å–æŸäº›æ•°æ®æ—¶ï¼ˆæ¯”å¦‚é€šè¿‡<code>fetch</code> APIï¼‰ï¼Œè¿”å›çš„å“åº”ä½“ï¼ˆresponse bodyï¼‰å°±å¯èƒ½æ˜¯ä¸€ä¸ª<code>ReadableStream</code>ï¼Œä»£è¡¨ç€æ­£åœ¨æ¥æ”¶çš„æ•°æ®æµã€‚</p><h3 id="stream-readable-fromweb-readablestream-options-çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#stream-readable-fromweb-readablestream-options-çš„ä½œç”¨"><span><code>stream.Readable.fromWeb(readableStream[, options])</code>çš„ä½œç”¨</span></a></h3><p><code>stream.Readable.fromWeb</code>å‡½æ•°å…è®¸ä½ å°†è¿™æ ·çš„<code>ReadableStream</code>å¯¹è±¡è½¬æ¢ä¸º Node.js ä¸­çš„<code>stream.Readable</code>å¯¹è±¡ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œä½ å¯ä»¥åˆ©ç”¨ Node.js ä¸­å¼ºå¤§çš„æµï¼ˆstreamï¼‰API æ¥å¤„ç†è¿™äº›æ•°æ®ï¼Œæ¯”å¦‚ä½¿ç”¨ç®¡é“ï¼ˆpipesï¼‰å°†æ•°æ®ä¼ è¾“åˆ°å…¶ä»–æµä¸­ï¼Œæˆ–è€…ä½¿ç”¨æµçš„å„ç§äº‹ä»¶å’Œæ–¹æ³•æ¥æ›´ç»†è‡´åœ°æ§åˆ¶æ•°æ®çš„å¤„ç†è¿‡ç¨‹ã€‚</p><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-10" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-10"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾æˆ‘ä»¬åœ¨ä¸€ä¸ª Node.js åº”ç”¨ä¸­ï¼Œéœ€è¦å¤„ç†ä¸€ä¸ªæ¥è‡ªå¤–éƒ¨ API çš„å¤§å‹æ•°æ®é›†ã€‚è¿™ä¸ª API é€šè¿‡ HTTP è¯·æ±‚æä¾›æ•°æ®ï¼Œå¹¶ä¸”è¿”å›çš„æ•°æ®æ˜¯ä¸€ä¸ª<code>ReadableStream</code>ã€‚</p><ol><li><p><strong>ä» Web API è·å–æ•°æ®å¹¶å¤„ç†</strong></p><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨<code>fetch</code>ï¼ˆæ³¨æ„ï¼šè™½ç„¶<code>fetch</code>åŸç”Ÿå±äº Web APIï¼Œä½†åœ¨ Node.js ä¸­å¯ä»¥é€šè¿‡å„ç§åŒ…å®ç°ï¼Œå¦‚<code>node-fetch</code>ï¼‰è·å–æ•°æ®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fetch</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node-fetch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetchDataAndProcess</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://example.com/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> webReadableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™é‡Œå¾—åˆ°ä¸€ä¸ªReadableStream</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å°†Webçš„ReadableStreamè½¬æ¢ä¸ºNode.jsçš„Readable Stream</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> nodeReadableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fromWeb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">webReadableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†è¿™ä¸ªæµï¼Œä¾‹å¦‚ï¼Œå°†å…¶ä¿å­˜åˆ°æ–‡ä»¶ä¸­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  nodeReadableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetchDataAndProcess</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨<code>fetch</code>è·å–äº†ä¸€ä¸ª URL çš„æ•°æ®æµã€‚è¿™ä¸ªæ•°æ®æµè¢«è¡¨ç¤ºä¸ºä¸€ä¸ª<code>ReadableStream</code>å¯¹è±¡ã€‚éšåï¼Œæˆ‘ä»¬ä½¿ç”¨<code>Readable.fromWeb</code>å°†è¿™ä¸ª Web æµè½¬æ¢ä¸º Node.js çš„å¯è¯»æµã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡ç®¡é“ï¼ˆ<code>.pipe()</code>ï¼‰å°†è¿™ä¸ªæµçš„å†…å®¹å¯¼å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼ˆ<code>output.txt</code>ï¼‰ä¸­ã€‚</p></li><li><p><strong>ç›‘å¬äº‹ä»¶</strong></p><p>è½¬æ¢åçš„<code>stream.Readable</code>å¯¹è±¡è¿˜å…è®¸ä½ ç›‘å¬ä¸åŒçš„äº‹ä»¶ï¼Œå¦‚<code>data</code>äº‹ä»¶ä»¥é€å—å¤„ç†æ•°æ®ï¼Œæˆ–<code>end</code>äº‹ä»¶ä»¥çŸ¥æ™“æ•°æ®ä¼ è¾“å®Œæˆã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">nodeReadableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">nodeReadableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;There is no more data to be consumed.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>è¿™ä¸ªåŠŸèƒ½çš„åŠ å…¥ï¼Œæ¶èµ·äº† Web ç¯å¢ƒä¸ Node.js ç¯å¢ƒé—´å¤„ç†æµæ•°æ®çš„ä¸€åº§æ¡¥æ¢ï¼Œå¤§å¤§æé«˜äº†åœ¨ Node.js ä¸­å¤„ç†å‰ç«¯æ•°æ®æµçš„çµæ´»æ€§å’Œæ–¹ä¾¿æ€§ã€‚</p><h3 id="stream-readable-isdisturbed-stream" tabindex="-1"><a class="header-anchor" href="#stream-readable-isdisturbed-stream"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streamreadableisdisturbedstream" target="_blank" rel="noopener noreferrer">stream.Readable.isDisturbed(stream)</a></span></a></h3><p>ç†è§£ <code>stream.Readable.isDisturbed(stream)</code> æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£å‡ ä¸ªæ¦‚å¿µï¼šNode.js ä¸­çš„æµï¼ˆStreamï¼‰ã€å¯è¯»æµï¼ˆReadable Streamï¼‰ï¼Œä»¥åŠä»€ä¹ˆæ„å‘³ç€ä¸€ä¸ªæµè¢« &quot;disturb&quot;ï¼ˆæ‰“æ‰°æˆ–è€…å¹²æ‰°ï¼‰ã€‚</p><h3 id="æµ-stream-ç®€ä»‹-1" tabindex="-1"><a class="header-anchor" href="#æµ-stream-ç®€ä»‹-1"><span>æµï¼ˆStreamï¼‰ç®€ä»‹</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œå°¤å…¶é€‚åˆå¤„ç†å¤§é‡æ•°æ®ã€‚æ¯”å¦‚ï¼Œå½“ä½ è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨æµå¯ä»¥é€ç‰‡æ®µåœ°è¯»å–æ•°æ®ï¼Œè€Œä¸å¿…ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™æ ·åšå¯ä»¥æé«˜æ•ˆç‡ï¼Œé™ä½ç¨‹åºçš„å†…å­˜å ç”¨ã€‚</p><h3 id="å¯è¯»æµ-readable-stream-1" tabindex="-1"><a class="header-anchor" href="#å¯è¯»æµ-readable-stream-1"><span>å¯è¯»æµï¼ˆReadable Streamï¼‰</span></a></h3><p>å¯è¯»æµæ˜¯ä¸€ç§ç‰¹æ®Šçš„æµï¼Œä¸“é—¨ç”¨äºè¯»å–æ•°æ®ã€‚æ¯”å¦‚ï¼Œä»æ–‡ä»¶è¯»å–æ•°æ®ã€ä»ç½‘ç»œè¯·æ±‚è¯»å–æ•°æ®ç­‰éƒ½å¯ä»¥é€šè¿‡å¯è¯»æµå®ç°ã€‚</p><h3 id="æµè¢«-disturb" tabindex="-1"><a class="header-anchor" href="#æµè¢«-disturb"><span>æµè¢« &quot;disturb&quot;</span></a></h3><p>ä¸€ä¸ªæµè¢« &quot;disturb&quot; æ„å‘³ç€æµçš„è¯»å–æ“ä½œå·²ç»å¼€å§‹ï¼Œæ¢å¥è¯è¯´ï¼Œæµçš„æ•°æ®å·²ç»è¢«æ¶ˆè´¹è¿‡äº†ã€‚åœ¨æµè¢« &quot;disturb&quot; ä¹‹åè¿›è¡ŒæŸäº›æ“ä½œï¼Œæ¯”å¦‚å†æ¬¡å°è¯•è¯»å–ï¼Œå¯èƒ½ä¼šå¯¼è‡´é”™è¯¯æˆ–è€…å¼‚å¸¸è¡Œä¸ºã€‚</p><h3 id="stream-readable-isdisturbed-stream-1" tabindex="-1"><a class="header-anchor" href="#stream-readable-isdisturbed-stream-1"><span><code>stream.Readable.isDisturbed(stream)</code></span></a></h3><p><code>stream.Readable.isDisturbed(stream)</code> æ˜¯åœ¨ Node.js v15.6.0 ä¸­å¼•å…¥çš„æ–¹æ³•ã€‚å®ƒç”¨äºæ£€æŸ¥ä¸€ä¸ªå¯è¯»æµæ˜¯å¦å·²ç»è¢« &quot;disturb&quot;ã€‚å¦‚æœæµçš„æ•°æ®å·²ç»å¼€å§‹è¢«è¯»å–ï¼ˆæ— è®ºæ˜¯å…¨éƒ¨è¿˜æ˜¯éƒ¨åˆ†ï¼‰ï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¼šè¿”å› <code>true</code>ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code>ã€‚</p><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹-15" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-15"><span>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</span></a></h4><ol><li><p><strong>æ–‡ä»¶è¯»å–</strong>ï¼šæƒ³è±¡ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨ï¼Œéœ€è¦ä»ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚ä½ å¯ç”¨äº†ä¸€ä¸ªå¯è¯»æµæ¥è¯»å–è¿™ä¸ªæ–‡ä»¶ã€‚åœ¨æŸä¸ªæ—¶é—´ç‚¹ï¼Œä½ æƒ³ç¡®è®¤æ˜¯å¦å·²ç»å¼€å§‹ä»è¿™ä¸ªæµä¸­è¯»å–æ•°æ®ï¼ˆå³æµæ˜¯å¦è¢« &quot;disturb&quot;ï¼‰ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>stream.Readable.isDisturbed(stream)</code> æ¥æ£€æŸ¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥è¯»å–æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ &#39;data&#39; äº‹ä»¶æ¥è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨ä¸€äº›æ“ä½œåï¼Œæ£€æŸ¥æµæ˜¯å¦è¢« &quot;disturb&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nextTick</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isDisturbed</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;The stream has been disturbed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;The stream has not been disturbed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>HTTP è¯·æ±‚</strong>ï¼šåœ¨å¤„ç† HTTP è¯·æ±‚çš„åœºæ™¯ä¸­ï¼Œè¯·æ±‚å¯¹è±¡æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯è¯»æµã€‚å¦‚æœä½ æƒ³æ£€æŸ¥è¯·æ±‚ä½“çš„æ•°æ®æ˜¯å¦å·²ç»å¼€å§‹è¢«è¯»å–ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isDisturbed</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Request stream has been disturbed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Request stream has not been disturbed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;OK&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>åœ¨ä»¥ä¸Šä¸¤ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>stream.Readable.isDisturbed()</code> æ–¹æ³•å¸®åŠ©æˆ‘ä»¬äº†è§£æµçš„çŠ¶æ€ï¼Œç¡®ä¿æˆ‘ä»¬åœ¨æ­£ç¡®çš„æ—¶é—´ç‚¹ä»¥æ­£ç¡®çš„æ–¹å¼å¤„ç†æµã€‚å°¤å…¶å¯¹äºèµ„æºç®¡ç†å’Œé”™è¯¯å¤„ç†æ¥è¯´ï¼Œäº†è§£æµæ˜¯å¦è¢« &quot;disturb&quot; æ˜¯éå¸¸æœ‰ä»·å€¼çš„ã€‚</p><h3 id="stream-iserrored-stream" tabindex="-1"><a class="header-anchor" href="#stream-iserrored-stream"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streamiserroredstream" target="_blank" rel="noopener noreferrer">stream.isErrored(stream)</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>stream</code> æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†æ•°æ®æµçš„æŠ½è±¡æ¥å£ã€‚ä½ å¯ä»¥å°†å®ƒæƒ³è±¡æˆä¸€æ¡æ²³æµï¼Œæ•°æ®å¦‚åŒæ²³æ°´ä¸€æ ·ï¼Œä»ä¸€ä¸ªåœ°æ–¹æµå‘å¦ä¸€ä¸ªåœ°æ–¹ã€‚Node.js çš„ <code>stream</code> æ¨¡å—æä¾›äº†ä¸€ç³»åˆ—ç”¨äºå¤„ç†è¿™ç§æ•°æ®æµçš„å·¥å…·å’Œæ–¹æ³•ã€‚åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œæœ‰ä¸€ä¸ªç‰¹å®šçš„æ–¹æ³•å«åš <code>stream.isErrored(stream)</code>ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªæµå¯¹è±¡æ˜¯å¦é‡åˆ°äº†é”™è¯¯ã€‚</p><h3 id="stream-iserrored-stream-1" tabindex="-1"><a class="header-anchor" href="#stream-iserrored-stream-1"><span><code>stream.isErrored(stream)</code></span></a></h3><h4 id="åŸºæœ¬è§£é‡Š-1" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬è§£é‡Š-1"><span>åŸºæœ¬è§£é‡Š</span></a></h4><p><code>stream.isErrored(stream)</code> æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨äºåˆ¤æ–­ç»™å®šçš„æµ(<code>stream</code>)å¯¹è±¡æ˜¯å¦å·²ç»å› ä¸ºæŸä¸ªé”™è¯¯è€Œä¸å†å¯ç”¨æˆ–è¿›å…¥äº†â€œå‡ºé”™â€çŠ¶æ€ã€‚å¦‚æœæµå·²ç»é”™è¯¯ï¼Œåˆ™è¯¥æ–¹æ³•è¿”å› <code>true</code>ï¼›å¦‚æœæµæ²¡æœ‰é”™è¯¯ï¼Œé‚£ä¹ˆè¿”å› <code>false</code>ã€‚</p><h4 id="å‚æ•°-8" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-8"><span>å‚æ•°</span></a></h4><ul><li><code>stream</code>: è¿™æ˜¯ä½ æƒ³è¦æ£€æŸ¥æ˜¯å¦å·²ç»é‡åˆ°é”™è¯¯çš„æµå¯¹è±¡ã€‚</li></ul><h4 id="è¿”å›å€¼-4" tabindex="-1"><a class="header-anchor" href="#è¿”å›å€¼-4"><span>è¿”å›å€¼</span></a></h4><ul><li>è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ (<code>true</code> æˆ– <code>false</code>)ï¼Œè¡¨ç¤ºæµæ˜¯å¦é‡åˆ°äº†é”™è¯¯ã€‚</li></ul><h3 id="ä½¿ç”¨åœºæ™¯ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯ä¾‹å­"><span>ä½¿ç”¨åœºæ™¯ä¾‹å­</span></a></h3><p>ä¸ºäº†æ›´å¥½åœ°ç†è§£ <code>stream.isErrored(stream)</code> æ–¹æ³•ï¼Œä¸‹é¢æˆ‘ä¼šé€šè¿‡å‡ ä¸ªå®é™…çš„ä¾‹å­æ¥è¯´æ˜å®ƒçš„ä½¿ç”¨åœºæ™¯ï¼š</p><h4 id="ä¾‹å­-1-è¯»æ–‡ä»¶è¿‡ç¨‹ä¸­é”™è¯¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-è¯»æ–‡ä»¶è¿‡ç¨‹ä¸­é”™è¯¯å¤„ç†"><span>ä¾‹å­ 1ï¼šè¯»æ–‡ä»¶è¿‡ç¨‹ä¸­é”™è¯¯å¤„ç†</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ Node.js ç¼–å†™ä»£ç æ¥è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šç”¨åˆ° <code>fs.createReadStream</code> æ¥åˆ›å»ºä¸€ä¸ªè¯»å–æ–‡ä»¶å†…å®¹çš„æµã€‚ä½†æ˜¯ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œæˆ–è€…ç”±äºæƒé™é—®é¢˜æ— æ³•è¯»å–ï¼Œè¿™æ—¶å€™æµå°±ä¼šé‡åˆ°é”™è¯¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">isErrored</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;éå¸¸é‡è¦çš„æ–‡ä»¶.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å½“æµé‡åˆ°é”™è¯¯æ—¶ï¼Œè¿™é‡Œçš„ä»£ç ä¼šè¢«æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isErrored</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æµé‡åˆ°äº†é”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å…¶ä»–å¤„ç†é€»è¾‘...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå½“è¯»å–æµï¼ˆ<code>readStream</code>ï¼‰é‡åˆ°é”™è¯¯æ—¶ï¼ˆä¾‹å¦‚æ–‡ä»¶ä¸å­˜åœ¨ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>isErrored(readStream)</code> æ¥åˆ¤æ–­è¿™ä¸ªæµæ˜¯å¦å·²ç»å¤„äºé”™è¯¯çŠ¶æ€ï¼Œå¹¶æ®æ­¤è¿›è¡Œç›¸åº”çš„é”™è¯¯å¤„ç†ã€‚</p><h4 id="ä¾‹å­-2-ç½‘ç»œè¯·æ±‚é”™è¯¯å¤„ç†-1" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ç½‘ç»œè¯·æ±‚é”™è¯¯å¤„ç†-1"><span>ä¾‹å­ 2ï¼šç½‘ç»œè¯·æ±‚é”™è¯¯å¤„ç†</span></a></h4><p>è€ƒè™‘å¦ä¸€ä¸ªä¾‹å­ï¼Œä½ å¯èƒ½é€šè¿‡ HTTP è¯·æ±‚è·å–ä¸€äº›æ•°æ®ï¼Œå¹¶åˆ©ç”¨æµæ¥å¤„ç†è¿™äº›æ•°æ®ã€‚å¦‚æœè¯·æ±‚å¤±è´¥æˆ–ä¸­æ–­ï¼ŒæµåŒæ ·ä¼šé‡åˆ°é”™è¯¯ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">isErrored</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://example.com/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isErrored</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å“åº”æµé‡åˆ°äº†é”™è¯¯&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œä¸€äº›é”™è¯¯å¤„ç†çš„é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ­£ç¡®æƒ…å†µä¸‹ï¼Œå°†å“åº”å†…å®¹è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è¯·æ±‚é‡åˆ°é”™è¯¯æ—¶çš„å¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯·æ±‚å¤±è´¥:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å‘é€äº†ä¸€ä¸ª HTTP GET è¯·æ±‚ã€‚å¦‚æœå“åº”æµï¼ˆ<code>res</code>ï¼‰é‡åˆ°äº†é”™è¯¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>isErrored(res)</code> æ¥æ£€æŸ¥å¹¶å¤„ç†è¿™äº›é”™è¯¯ï¼Œæ¯”å¦‚è®°å½•æ—¥å¿—æˆ–å°è¯•é‡æ–°å‘èµ·è¯·æ±‚ã€‚</p><h3 id="æ€»ç»“-27" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-27"><span>æ€»ç»“</span></a></h3><p><code>stream.isErrored(stream)</code> æ˜¯ä¸€ä¸ªåœ¨ Node.js ä¸­å¤„ç†æµç›¸å…³æ“ä½œæ—¶éå¸¸æœ‰ç”¨çš„æ–¹æ³•ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦è¯†åˆ«å’Œå¤„ç†æµé”™è¯¯çš„åœºæ™¯ä¸‹ã€‚æŒæ¡äº†è¿™ä¸ªæ–¹æ³•ï¼Œä½ å°±èƒ½æ›´åŠ æœ‰æ•ˆåœ°ç®¡ç†å’Œå“åº”æ•°æ®æµä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸æƒ…å†µã€‚</p><h3 id="stream-isreadable-stream" tabindex="-1"><a class="header-anchor" href="#stream-isreadable-stream"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streamisreadablestream" target="_blank" rel="noopener noreferrer">stream.isReadable(stream)</a></span></a></h3><p>Node.js ä¸­çš„<code>stream.isReadable(stream)</code>æ˜¯ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºå¯è¯»æµçš„æ–¹æ³•ã€‚åœ¨æ·±å…¥è§£é‡Šä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯æµï¼ˆStreamï¼‰ä»¥åŠå¯è¯»æµã€‚</p><h3 id="æµ-stream-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#æµ-stream-æ˜¯ä»€ä¹ˆ"><span>æµï¼ˆStreamï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§å¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“ä½ è¦å¤„ç†å¤§é‡æ•°æ®æˆ–è€…ä½ å¸Œæœ›è¾¹æ¥æ”¶è¾¹å¤„ç†æ•°æ®æ—¶ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªæ°´æ¡¶ï¼ˆæ•°æ®æºï¼‰ï¼Œä½ éœ€è¦å°†æ°´ï¼ˆæ•°æ®ï¼‰ä»è¿™ä¸ªæ¡¶ç§»åŠ¨åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚ä½¿ç”¨æµå°±åƒä½¿ç”¨ä¸€æ ¹ç®¡å­ï¼Œå…è®¸æ°´è¾¹æµè¾¹ç§»åŠ¨ï¼Œè€Œä¸æ˜¯ç­‰å¾…æ•´ä¸ªæ¡¶çš„æ°´éƒ½è£…æ»¡åå†ä¸€æ¬¡æ€§ç§»åŠ¨ã€‚</p><h3 id="å¯è¯»æµ" tabindex="-1"><a class="header-anchor" href="#å¯è¯»æµ"><span>å¯è¯»æµ</span></a></h3><p>ä¸€ä¸ªå¯è¯»æµå…è®¸ä½ è¯»å–æ•°æ®ã€‚æ¢å¥è¯è¯´ï¼Œæ•°æ®å¯ä»¥ä»è¿™ç§ç±»å‹çš„æµä¸­æµå‡ºã€‚è¿™å°±åƒæ‰“å¼€äº†æ°´é¾™å¤´ï¼Œæ°´å¼€å§‹æµå‡ºæ¥ã€‚</p><h3 id="stream-isreadable-stream-1" tabindex="-1"><a class="header-anchor" href="#stream-isreadable-stream-1"><span><code>stream.isReadable(stream)</code></span></a></h3><p><code>stream.isReadable(stream)</code>æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨äºæ£€æŸ¥ä¼ å…¥çš„å¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ªå¤„äºå¯è¯»çŠ¶æ€çš„æµã€‚å¦‚æœå¯¹è±¡æ˜¯ä¸€ä¸ªå¯è¯»æµå¹¶ä¸”è¿˜æ²¡æœ‰è¾¾åˆ°æœ«å°¾ï¼ˆæ„å‘³ç€æ•°æ®è¿˜å¯ä»¥ä»ä¸­è¯»å–ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°±ä¼šè¿”å›<code>true</code>ï¼Œå¦åˆ™è¿”å›<code>false</code>ã€‚</p><h4 id="å®é™…è¿ç”¨ä¾‹å­-19" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-19"><span>å®é™…è¿ç”¨ä¾‹å­:</span></a></h4><ol><li><p><strong>æ–‡ä»¶å¤„ç†</strong>ï¼š<br> å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œéœ€è¦ä»ä¸€ä¸ªå¾ˆå¤§çš„æ—¥å¿—æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚ä½ å¯ä»¥ä½¿ç”¨ Node.js çš„<code>fs.createReadStream</code>æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¯è¯»æµã€‚ç„¶åï¼Œä½¿ç”¨<code>stream.isReadable()</code>æ¥æ£€æŸ¥è¿™ä¸ªæµåœ¨ä»»ä½•æ—¶å€™æ˜¯å¦å¤„äºå¯è¯»çŠ¶æ€ï¼Œç¡®ä¿åœ¨å°è¯•ä»ä¸­è¯»å–æ•°æ®ä¹‹å‰ï¼Œæµæ˜¯å¯è¯»çš„ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/large/log/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isReadable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;The stream is readable, you can start reading.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;The stream is not readable.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç½‘ç»œé€šä¿¡</strong>ï¼š<br> å½“ä½ å¼€å‘æ¶‰åŠ HTTP è¯·æ±‚çš„åº”ç”¨æ—¶ï¼Œè¯·æ±‚å¯¹è±¡é€šå¸¸ä¹Ÿæ˜¯ä¸€ä¸ªå¯è¯»æµã€‚ä½¿ç”¨<code>stream.isReadable()</code>å¯ä»¥å¸®åŠ©ä½ åˆ¤æ–­è¯·æ±‚ä½“æ˜¯å¦å¯è¯»ï¼Œè¿™å¯¹äºé¢„å¤„ç†æˆ–éªŒè¯è¯·æ±‚ä½“éå¸¸æœ‰ç”¨ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">isReadable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;The request body is readable.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¤„ç†è¯·æ±‚ä½“...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;The request body is not readable.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>stream.isReadable(stream)</code>å¦‚ä½•åœ¨ä¸åŒåœºæ™¯ä¸‹è¢«ç”¨æ¥æ£€æŸ¥æµçš„çŠ¶æ€ï¼Œä»è€Œç¡®ä¿åœ¨å°è¯•è¯»å–æ•°æ®ä¹‹å‰æµæ˜¯å¤„äºæ­£ç¡®çš„çŠ¶æ€ã€‚</p><h3 id="stream-readable-toweb-streamreadable-options" tabindex="-1"><a class="header-anchor" href="#stream-readable-toweb-streamreadable-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streamreadabletowebstreamreadable-options" target="_blank" rel="noopener noreferrer">stream.Readable.toWeb(streamReadable[, options])</a></span></a></h3><p>Node.js çš„ <code>stream.Readable.toWeb</code> æ–¹æ³•æ˜¯åœ¨ Node.js ç‰ˆæœ¬ 16.5.0 ä¸­æ·»åŠ çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ å°† Node.js ä¸­çš„å¯è¯»æµï¼ˆ<code>stream.Readable</code>ï¼‰è½¬æ¢æˆ Web æ ‡å‡†çš„å¯è¯»æµã€‚è¿™ä¸ªè½¬æ¢å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒä½¿å¾—åœ¨ Node.js ç¯å¢ƒä¸­åˆ›å»ºçš„æ•°æ®æµå¯ä»¥æ›´å®¹æ˜“åœ°ä¸éµå¾ª Web æ ‡å‡†çš„ API ï¼ˆå¦‚ Fetch API æˆ– Streams APIï¼‰ä¸€èµ·ä½¿ç”¨ã€‚</p><h3 id="åŸºç¡€è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€è§£é‡Š"><span>åŸºç¡€è§£é‡Š</span></a></h3><p>åœ¨ Web å¼€å‘ä¸­ï¼Œæµï¼ˆStreamsï¼‰è¢«å¹¿æ³›ç”¨äºå¤„ç†å¤§é‡æ•°æ®ï¼Œæ¯”å¦‚æ–‡ä»¶ä¸Šä¼ æˆ–ä¸‹è½½ã€æ•°æ®ä¼ è¾“ç­‰ã€‚æµå¯ä»¥æœ‰æ•ˆåœ°å¤„ç†æ•°æ®ï¼Œå› ä¸ºå®ƒä»¬å…è®¸æ•°æ®åœ¨å®Œå…¨åˆ°è¾¾ä¹‹å‰å°±å¼€å§‹å¤„ç†ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å†…å­˜ä½¿ç”¨å¹¶å¢åŠ æ€§èƒ½ã€‚</p><ul><li><p><strong>Node.js çš„æµï¼ˆ<code>stream.Readable</code>ï¼‰</strong>ï¼šåœ¨ Node.js ä¸­ï¼Œæµè¢«ç”¨æ¥ä»ä¸€ä¸ªæºå¼‚æ­¥è¯»å–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå½“ä½ ä»æ–‡ä»¶ç³»ç»Ÿè¯»å–å¤§æ–‡ä»¶æˆ–ä»ç½‘ç»œæ¥æ”¶æ•°æ®æ—¶ã€‚</p></li><li><p><strong>Web çš„æµ</strong>ï¼šåœ¨ç°ä»£ Web APIs ä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨ Service Workers å’Œ Fetch API ä¸­ï¼ŒæµåŒæ ·æ˜¯å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚Web çš„æµä¸ Node.js çš„æµåœ¨æ¦‚å¿µä¸Šç±»ä¼¼ï¼Œä½†å®ƒä»¬éµå¾ªä¸åŒçš„å®ç°æ ‡å‡†ã€‚</p></li></ul><h3 id="stream-readable-toweb-æ–¹æ³•çš„ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#stream-readable-toweb-æ–¹æ³•çš„ä½œç”¨"><span><code>stream.Readable.toWeb</code> æ–¹æ³•çš„ä½œç”¨</span></a></h3><p><code>stream.Readable.toWeb(streamReadable[, options])</code> è¿™ä¸ªæ–¹æ³•çš„ç›®çš„æ˜¯ä¸ºäº†æ¡¥æ¥ Node.js æµå’Œ Web æµä¹‹é—´çš„å·®å¼‚ã€‚é€šè¿‡ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œä½ å¯ä»¥å°† Node.js ä¸­çš„å¯è¯»æµè½¬æ¢ä¸ºç¬¦åˆ Web æ ‡å‡†çš„å¯è¯»æµï¼Œè¿™æ ·å°±å¯ä»¥åˆ©ç”¨ Web API æ¥è¿›ä¸€æ­¥å¤„ç†æˆ–ä½¿ç”¨è¿™äº›æ•°æ®æµã€‚</p><h3 id="ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹"><span>ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹</span></a></h3><ol><li><p><strong>æ–‡ä»¶ä¸Šä¼ å¤„ç†</strong>ï¼šå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦æ¥æ”¶ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ï¼Œå¹¶å°†å…¶å‘é€åˆ°å¦ä¸€ä¸ªæ”¯æŒ Fetch API çš„ Web æœåŠ¡ã€‚ä½ å¯ä»¥é¦–å…ˆä½¿ç”¨ Node.js çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆ<code>fs</code> æ¨¡å—ï¼‰æ¥è¯»å–æ–‡ä»¶ä¸ºä¸€ä¸ª Node.js æµï¼Œç„¶åä½¿ç”¨ <code>stream.Readable.toWeb</code> æ–¹æ³•å°†å…¶è½¬æ¢ä¸º Web æµï¼Œæœ€åé€šè¿‡ Fetch API å°†å…¶ä¸Šä¼ ã€‚</p></li><li><p><strong>æ•°æ®è½¬å‘</strong>ï¼šå¦‚æœä½ çš„ Node.js æœåŠ¡å™¨å……å½“ä¸­ä»‹ï¼Œéœ€è¦ä»ä¸€ä¸ª Web API æ¥æ”¶æ•°æ®å¹¶å°†æ•°æ®ç›´æ¥è½¬å‘ç»™æµè§ˆå™¨ç«¯ï¼Œè€Œä¸æƒ³æŠŠæ•´ä¸ªæ•°æ®å…ˆå®Œå…¨åŠ è½½åˆ°æœåŠ¡å™¨å†…å­˜ä¸­ã€‚è¿™æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>stream.Readable.toWeb</code> å°† Node.js æµè½¬æ¢ä¸º Web æµï¼Œç„¶åç›´æ¥é€šè¿‡ HTTP å“åº”å°†è¿™ä¸ªæµå‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®ç°é«˜æ•ˆçš„æ•°æ®è½¬å‘ã€‚</p></li></ol><h3 id="ç¤ºä¾‹ä»£ç -1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -1"><span>ç¤ºä¾‹ä»£ç </span></a></h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª Node.js ä¸­çš„å¯è¯»æµ <code>nodeStream</code>ï¼Œæˆ‘ä»¬æƒ³å°†å®ƒè½¬æ¢ä¸º Web æµï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ nodeStream æ˜¯ä¸€ä¸ª Node.js å¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> nodeStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot; &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;World&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è½¬æ¢ä¸º Web å¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> webStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toWeb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">nodeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç°åœ¨ webStream å°±å¯ä»¥ç”¨åœ¨æ”¯æŒ Web æ ‡å‡†æµçš„ API ä¸­äº†</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼Œè™½ç„¶è¿™é‡Œä½¿ç”¨çš„ Node.js ç‰ˆæœ¬å·æ˜¯å‡è®¾çš„ï¼Œä½† <code>stream.Readable.toWeb</code> æ–¹æ³•è‡ª Node.js v16.5.0 èµ·è¢«å¼•å…¥ï¼Œç¡®åˆ‡çš„ä½¿ç”¨å’Œè¡Œä¸ºå¯èƒ½ä¼šéšç€ Node.js çš„ç‰ˆæœ¬æ›´æ–°è€Œæœ‰æ‰€å˜åŒ–ã€‚åœ¨ç¼–å†™ä½ çš„åº”ç”¨æ—¶ï¼Œç¡®ä¿å‚è€ƒä½ å½“å‰ Node.js ç¯å¢ƒä¸­çš„å®˜æ–¹æ–‡æ¡£ã€‚</p><h3 id="stream-writable-fromweb-writablestream-options" tabindex="-1"><a class="header-anchor" href="#stream-writable-fromweb-writablestream-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streamwritablefromwebwritablestream-options" target="_blank" rel="noopener noreferrer">stream.Writable.fromWeb(writableStream[, options])</a></span></a></h3><p>åœ¨è§£é‡Š <code>stream.Writable.fromWeb(writableStream[, options])</code> æ–¹æ³•å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-node-js-å’Œ-streams" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-node-js-å’Œ-streams"><span>ä»€ä¹ˆæ˜¯ Node.js å’Œ Streamsï¼Ÿ</span></a></h3><ul><li><strong>Node.js</strong>ï¼šNode.js æ˜¯ä¸€ä¸ªå¼€æºçš„ã€è·¨å¹³å°çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ JavaScriptã€‚</li><li><strong>Streams</strong>ï¼šåœ¨ Node.js ä¸­ï¼ŒStreams æ˜¯å¤„ç†æµå¼æ•°æ®çš„æŠ½è±¡æ¥å£ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä¸€å°å—ä¸€å°å—åœ°è¯»å–æˆ–å†™å…¥æ•°æ®ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™å¯¹äºå¤„ç†å¤§é‡æ•°æ®éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚æ–‡ä»¶å¤„ç†æˆ–ç½‘ç»œé€šä¿¡ã€‚</li></ul><p>åœ¨ Node.js ä¸­ï¼ŒStreams ä¸»è¦åˆ†ä¸ºå››ç§ç±»å‹ï¼š</p><ol><li><strong>Readable Stream</strong> - ç”¨äºè¯»å–æ•°æ®ã€‚</li><li><strong>Writable Stream</strong> - ç”¨äºå†™å…¥æ•°æ®ã€‚</li><li><strong>Duplex Stream</strong> - æ—¢å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™ã€‚</li><li><strong>Transform Stream</strong> - åœ¨è¯»å†™æ•°æ®çš„è¿‡ç¨‹ä¸­å¯ä»¥ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®ã€‚</li></ol><h3 id="stream-writable-fromweb-writablestream-options-1" tabindex="-1"><a class="header-anchor" href="#stream-writable-fromweb-writablestream-options-1"><span><code>stream.Writable.fromWeb(writableStream[, options])</code></span></a></h3><p>è¿™ä¸ªæ–¹æ³•çš„ç›®çš„æ˜¯ä¸ºäº†æ¡¥æ¥ Node.js çš„ Streams å’Œ Web Streams API ä¹‹é—´çš„å·®å¼‚ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå…è®¸ä½ å°† Web å¹³å°çš„ WritableStream å¯¹è±¡ï¼ˆå³å¯å†™çš„æµï¼‰è½¬æ¢ä¸º Node.js çš„ Writable Streamï¼Œè¿™æ ·ä½ å°±å¯ä»¥åœ¨ Node.js ç¯å¢ƒä¸­ä½¿ç”¨å®ƒï¼Œåˆ©ç”¨ Node.js æä¾›çš„å„ç§æµæ“ä½œåŠŸèƒ½ã€‚</p><h4 id="å‚æ•°è§£é‡Š-2" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š-2"><span>å‚æ•°è§£é‡Šï¼š</span></a></h4><ul><li><strong>writableStream</strong>: è¿™æ˜¯ä¸€ä¸ªæ¥è‡ª Web Streams API çš„ <code>WritableStream</code> å¯¹è±¡ã€‚åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼ŒWeb Streams API æä¾›äº†ä¸€å¥—ç”¨äºå¤„ç†æµå¼æ•°æ®çš„æ ‡å‡†æ¥å£ã€‚</li><li><strong>options</strong>: å¯é€‰å‚æ•°ã€‚è¿™æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨äºæä¾›é¢å¤–çš„é…ç½®é€‰é¡¹ï¼Œæ¯”å¦‚å¦‚ä½•å¤„ç†å›å‹ï¼ˆbackpressureï¼‰ç­‰ã€‚</li></ul><h4 id="å®é™…è¿ç”¨ä¾‹å­-20" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-20"><span>å®é™…è¿ç”¨ä¾‹å­ï¼š</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦å¤„ç†ä»å®¢æˆ·ç«¯æµè§ˆå™¨ä¸Šä¼ çš„å¤§å‹æ–‡ä»¶ã€‚å®¢æˆ·ç«¯å¯èƒ½ä¼šä½¿ç”¨ Web Streams API å°†æ–‡ä»¶ä»¥æµçš„å½¢å¼ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚åœ¨æœåŠ¡å™¨ç«¯ï¼Œä½ éœ€è¦å°†è¿™ä¸ªç”±å®¢æˆ·ç«¯ä¼ æ¥çš„ <code>WritableStream</code> è½¬æ¢ä¸º Node.js èƒ½å¤Ÿå¤„ç†çš„æµï¼Œä»¥ä¾¿è¿›è¡Œè¿›ä¸€æ­¥çš„æ“ä½œï¼Œæ¯”å¦‚ä¿å­˜åˆ°ç£ç›˜ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node:stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™ä¸ª writableStream æ¥è‡ªå®¢æˆ·ç«¯çš„ä¸Šä¼ æ“ä½œï¼Œå®é™…ä»£ç ä¸­éœ€è¦æŒ‰æƒ…å†µè·å–</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ fromWeb æ–¹æ³•å°† Web çš„ WritableStream è½¬æ¢ä¸º Node.js çš„ Writable Stream</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> nodeWritableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fromWeb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç°åœ¨å¯ä»¥ä½¿ç”¨ Node.js çš„æµæ–¹æ³•æ¥å¤„ç†è¿™ä¸ªæµäº†</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¾‹å¦‚ï¼Œå°†å…¶ä¿å­˜åˆ°ç£ç›˜æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fileStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/save/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">nodeWritableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fileStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº† Node.js çš„ <code>stream</code> æ¨¡å—ä¸­çš„ <code>Writable</code> ç±»ã€‚ç„¶åå‡è®¾ä»æŸå¤„è·å¾—äº†ä¸€ä¸ª Web çš„ <code>WritableStream</code>ï¼ˆè¿™éƒ¨åˆ†æ ¹æ®å®é™…æƒ…å†µæ¥ï¼‰ã€‚é€šè¿‡è°ƒç”¨ <code>Writable.fromWeb(writableStream)</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å°† Web çš„ <code>WritableStream</code> è½¬æ¢æˆäº† Node.js çš„ <code>Writable</code> æµï¼Œè¿™æ ·å°±å¯ä»¥åˆ©ç”¨ Node.js å¼ºå¤§çš„æµå¤„ç†åŠŸèƒ½ï¼Œå¦‚é€šè¿‡ <code>.pipe()</code> æ–¹æ³•å°†å…¶å†…å®¹æµå¼ä¼ è¾“åˆ°æ–‡ä»¶ä¸­ã€‚</p><p>è¿™æ ·çš„è½¬æ¢ä½¿å¾—åœ¨ Node.js åº”ç”¨ç¨‹åºä¸­å¤„ç†æ¥è‡ª Web åº”ç”¨çš„æµæ•°æ®å˜å¾—æ›´åŠ çµæ´»å’Œå¼ºå¤§ã€‚</p><h3 id="stream-writable-toweb-streamwritable" tabindex="-1"><a class="header-anchor" href="#stream-writable-toweb-streamwritable"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streamwritabletowebstreamwritable" target="_blank" rel="noopener noreferrer">stream.Writable.toWeb(streamWritable)</a></span></a></h3><p>å½“ä½ å¼€å§‹æ¥è§¦åˆ° Node.js çš„æ—¶å€™ï¼Œä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µå°±æ˜¯â€œæµï¼ˆStreamsï¼‰â€ã€‚åœ¨ Node.js ä¸­ï¼Œæµæ˜¯æ•°æ®çš„é›†åˆï¼Œæ¯”å¦‚æ–‡ä»¶æ•°æ®æˆ–ç½‘ç»œæ•°æ®ï¼Œå®ƒä»¬ä¸éœ€è¦ä¸€æ¬¡æ€§å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œæ˜¯å¯ä»¥åˆ†æ‰¹æ¬¡ã€è¿ç»­åœ°å¤„ç†ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯èƒ½æœ‰æ•ˆç®¡ç†å†…å­˜ä½¿ç”¨ï¼Œæé«˜æ•°æ®å¤„ç†æ•ˆç‡ï¼Œå°¤å…¶æ˜¯å¤„ç†å¤§é‡æ•°æ®æ—¶ã€‚</p><h3 id="æµçš„ç§ç±»" tabindex="-1"><a class="header-anchor" href="#æµçš„ç§ç±»"><span>æµçš„ç§ç±»</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œä¸»è¦æœ‰å››ç§ç±»å‹çš„æµï¼š</p><ol><li><strong>å¯è¯»æµï¼ˆReadable Streamsï¼‰</strong> - ç”¨äºè¯»å–æ•°æ®ï¼Œæ¯”å¦‚ä»æ–‡ä»¶è¯»å–æ•°æ®ã€‚</li><li><strong>å¯å†™æµï¼ˆWritable Streamsï¼‰</strong> - ç”¨äºå†™å…¥æ•°æ®ï¼Œæ¯”å¦‚å‘æ–‡ä»¶å†™å…¥æ•°æ®ã€‚</li><li><strong>åŒå·¥æµï¼ˆDuplex Streamsï¼‰</strong> - æ—¢å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™ï¼Œæ¯”å¦‚ TCP socketsã€‚</li><li><strong>å˜æ¢æµï¼ˆTransform Streamsï¼‰</strong> - æ•°æ®å¯ä»¥åœ¨å†™å…¥å’Œè¯»å–è¿‡ç¨‹ä¸­è¿›è¡Œä¿®æ”¹ï¼Œæ¯”å¦‚å‹ç¼©æµã€‚</li></ol><h3 id="stream-writable-toweb-streamwritable-1" tabindex="-1"><a class="header-anchor" href="#stream-writable-toweb-streamwritable-1"><span><code>stream.Writable.toWeb(streamWritable)</code></span></a></h3><p>åœ¨ Node.js v21.7.1 ä¸­ï¼Œ<code>stream.Writable.toWeb(streamWritable)</code> æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„åŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ å°† Node.js ä¸­çš„å¯å†™æµ (<code>Writable</code>) è½¬æ¢æˆ Web æ ‡å‡†çš„å¯å†™æµã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥æ›´å®¹æ˜“åœ°åœ¨ä¸åŒç¯å¢ƒï¼ˆåƒæ˜¯æµè§ˆå™¨å’Œ Node.js ä¹‹é—´ï¼‰å…±äº«å’Œæ“ä½œæ•°æ®æµã€‚</p><p>åœ¨ Web å¹³å°ä¸Šï¼Œæœ‰ä¸€å¥—ä¸ Node.js ç±»ä¼¼ä½†å¹¶ä¸å®Œå…¨ç›¸åŒçš„æµ APIï¼Œè¢«ç§°ä¸º Web Streams APIã€‚é€šè¿‡ä½¿ç”¨ <code>stream.Writable.toWeb()</code> æ–¹æ³•ï¼Œä½ å¯ä»¥å°† Node.js çš„æµè½¬æ¢ä¸ºéµå¾ª Web Streams API çš„æµï¼Œè¿™è®©è·¨å¹³å°çš„æµæ•°æ®æ“ä½œå˜å¾—æ›´ç®€å•ç›´æ¥ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-21" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-21"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-æ–‡ä»¶ä¸Šä¼ " tabindex="-1"><a class="header-anchor" href="#_1-æ–‡ä»¶ä¸Šä¼ "><span>1. æ–‡ä»¶ä¸Šä¼ </span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç½‘ç«™ï¼Œéœ€è¦ç”¨æˆ·ä¸Šä¼ è§†é¢‘æ–‡ä»¶ã€‚åœ¨æœåŠ¡å™¨ç«¯ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨ Node.js æ¥æ¥æ”¶è¿™äº›è§†é¢‘æ–‡ä»¶ã€‚ç°åœ¨ï¼Œå¦‚æœä½ æƒ³å°†è¿™ä¸ªè§†é¢‘æ–‡ä»¶è¿›ä¸€æ­¥ä¼ è¾“åˆ°å¦ä¸€ä¸ªæ”¯æŒ Web Streams API çš„æœåŠ¡ï¼ˆä¾‹å¦‚æŸäº‘å­˜å‚¨æœåŠ¡ï¼‰ï¼Œé‚£ä¹ˆä½ å¯ä»¥è¿™ä¹ˆåšï¼š</p><ul><li>é¦–å…ˆï¼Œåœ¨ Node.js ç«¯æ¥æ”¶æ–‡ä»¶ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šæ¶‰åŠåˆ° Node.js çš„å¯å†™æµï¼ˆ<code>Writable</code>ï¼‰ã€‚</li><li>ç„¶åï¼Œä½¿ç”¨ <code>stream.Writable.toWeb()</code> å°†è¯¥ Node.js å¯å†™æµè½¬æ¢ä¸º Web å¯å†™æµã€‚</li><li>æœ€åï¼Œå°†è½¬æ¢åçš„æµä¸Šä¼ åˆ°æ”¯æŒ Web Streams API çš„äº‘æœåŠ¡ã€‚</li></ul><p>è¿™ä¸ªè¿‡ç¨‹ä½¿å¾—åœ¨ä¸åŒå¹³å°é—´ä¼ è¾“æµæ•°æ®å˜å¾—æ— ç¼å’Œé«˜æ•ˆã€‚</p><h4 id="_2-æ—¥å¿—å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_2-æ—¥å¿—å¤„ç†"><span>2. æ—¥å¿—å¤„ç†</span></a></h4><p>è€ƒè™‘å¦ä¸€ä¸ªåœºæ™¯ï¼Œä½ å¸Œæœ›å°†åº”ç”¨çš„æ—¥å¿—æ•°æ®å®æ—¶ä¼ è¾“åˆ°ä¸€ä¸ªåŸºäºæµè§ˆå™¨çš„ç›‘æ§é¢æ¿ã€‚ä½ çš„åº”ç”¨è¿è¡Œåœ¨ Node.js ä¸Šï¼Œè€Œç›‘æ§é¢æ¿åˆ™æ˜¯ä¸€ä¸ª Web åº”ç”¨ï¼š</p><ul><li>åœ¨ Node.js åº”ç”¨ä¸­ï¼Œæ—¥å¿—æ•°æ®ä¼šå†™å…¥åˆ°ä¸€ä¸ªå¯å†™æµä¸­ã€‚</li><li>ä½¿ç”¨ <code>stream.Writable.toWeb()</code> æ–¹æ³•ï¼Œå°†è¿™ä¸ª Node.js çš„å¯å†™æµè½¬æ¢ä¸º Web å¯å†™æµã€‚</li><li>ç„¶åï¼Œåˆ©ç”¨ Web Sockets æˆ–å…¶ä»–æœºåˆ¶ï¼Œå°†è¿™ä¸ª Web å¯å†™æµè¿æ¥åˆ°ä½ çš„ç›‘æ§é¢æ¿ï¼Œå®æ—¶æ˜¾ç¤ºæ—¥å¿—ä¿¡æ¯ã€‚</li></ul><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨ <code>stream.Writable.toWeb()</code> æ–¹æ³•åœ¨ Node.js å’Œ Web åº”ç”¨ä¹‹é—´é«˜æ•ˆåœ°ä¼ è¾“å®æ—¶æ•°æ®ã€‚</p><p>æ€»ä½“æ¥è¯´ï¼Œ<code>stream.Writable.toWeb(streamWritable)</code> æä¾›äº†ä¸€ä¸ªå¼ºå¤§ä¸”çµæ´»çš„æ¡¥æ¢ï¼Œè®© Node.js çš„æµæ•°æ®èƒ½å¤Ÿæ›´åŠ å®¹æ˜“åœ°è¢«è½¬ç§»åˆ°éµå¾ª Web æ ‡å‡†çš„ç¯å¢ƒä¸­å»ï¼Œæ— è®ºæ˜¯åœ¨æ•°æ®ä¼ è¾“ã€å¤„ç†è¿˜æ˜¯åœ¨å¤šå¹³å°åº”ç”¨å¼€å‘ä¸­ï¼Œéƒ½æå¤§åœ°æ‰©å±•äº† Node.js æµçš„åº”ç”¨åœºæ™¯ã€‚</p><h3 id="stream-duplex-from-src" tabindex="-1"><a class="header-anchor" href="#stream-duplex-from-src"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streamduplexfromsrc" target="_blank" rel="noopener noreferrer">stream.Duplex.from(src)</a></span></a></h3><p>ç†è§£ <code>stream.Duplex.from(src)</code> çš„å…³é”®åœ¨äºå¼„æ¸…æ¥šä¸¤ä¸ªæ¦‚å¿µï¼š<strong>æµï¼ˆStreamsï¼‰<strong>å’Œ</strong>åŒå·¥æµï¼ˆDuplex Streamsï¼‰</strong>ã€‚åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§ç”¨äºå¤„ç†æ•°æ®çš„æŠ½è±¡æ¥å£ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¤§é‡æ•°æ®æˆ–è€…é€æ­¥åˆ°è¾¾çš„æ•°æ®ã€‚è€ŒåŒå·¥æµæ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„æµï¼Œå®ƒå¯ä»¥åŒæ—¶è¿›è¡Œè¯»å†™æ“ä½œï¼Œå°±åƒç”µè¯é€šè¯ä¸€æ ·ï¼Œä¸€è¾¹å¯ä»¥è¯´è¯ï¼Œä¸€è¾¹ä¹Ÿå¯ä»¥å¬åˆ°å¯¹æ–¹è¯´è¯ã€‚</p><h3 id="æµ-streams-4" tabindex="-1"><a class="header-anchor" href="#æµ-streams-4"><span>æµï¼ˆStreamsï¼‰</span></a></h3><p>æƒ³è±¡ä½ æ­£åœ¨ç”¨ä¸€æ ¹æ°´ç®¡ç»™ä¸€ä¸ªå¤§æ°´æ¡¶è£…æ°´ï¼Œæ°´ä»æ°´ç®¡çš„ä¸€ç«¯æµå…¥æ°´æ¡¶ä¸­ã€‚è¿™ä¸ªæ°´ç®¡å°±åƒæ˜¯ Node.js ä¸­çš„ä¸€ä¸ªå•å‘æµï¼Œæ°´æµåªèƒ½æœä¸€ä¸ªæ–¹å‘æµåŠ¨ã€‚åœ¨ç¼–ç¨‹çš„ä¸–ç•Œé‡Œï¼Œè¿™ä¸ªâ€œæ°´â€å¯ä»¥æ˜¯æ–‡ä»¶å†…å®¹ã€ç½‘ç»œè¯·æ±‚çš„æ•°æ®ç­‰ã€‚</p><h3 id="åŒå·¥æµ-duplex-streams" tabindex="-1"><a class="header-anchor" href="#åŒå·¥æµ-duplex-streams"><span>åŒå·¥æµï¼ˆDuplex Streamsï¼‰</span></a></h3><p>åŒå·¥æµï¼Œé¡¾åæ€ä¹‰ï¼Œæ—¢å¯ä»¥å‘é€æ•°æ®ä¹Ÿå¯ä»¥æ¥æ”¶æ•°æ®ï¼Œç±»ä¼¼äºæ°´ç®¡çš„ä¸¤ç«¯éƒ½å¼€æ”¾ï¼Œæ—¢å¯ä»¥è®©æ°´æµå‡ºä¹Ÿå¯ä»¥è®©æ°´æµå…¥ã€‚åœ¨ Node.js çš„åº”ç”¨ä¸­ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥åŒæ—¶è¯»å–å’Œå†™å…¥æ•°æ®åˆ°åŒä¸€ä¸ªæµä¸­ã€‚</p><h3 id="stream-duplex-from-src-1" tabindex="-1"><a class="header-anchor" href="#stream-duplex-from-src-1"><span><code>stream.Duplex.from(src)</code></span></a></h3><p><code>stream.Duplex.from(src)</code> æ˜¯ Node.js v21.7.1 å¼•å…¥çš„ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå…è®¸ä½ åŸºäºç°æœ‰çš„æºï¼ˆå¦‚å¯è¯»æµï¼‰åˆ›å»ºä¸€ä¸ªåŒå·¥æµã€‚è¿™ä¸ªåŠŸèƒ½æå…¶å¼ºå¤§ï¼Œå› ä¸ºå®ƒæä¾›äº†ä¸€ç§ç®€æ´çš„æ–¹å¼æ¥å¤„ç†é‚£äº›åŒæ—¶éœ€è¦è¯»å–å’Œå†™å…¥æ“ä½œçš„åœºæ™¯ã€‚</p><h4 id="å®é™…åº”ç”¨ä¾‹å­-3" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-3"><span>å®é™…åº”ç”¨ä¾‹å­ï¼š</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªèŠå¤©åº”ç”¨ï¼Œå®¢æˆ·ç«¯é€šè¿‡ WebSocket ä¸æœåŠ¡å™¨è¿›è¡Œå®æ—¶é€šä¿¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒWebSocket è¿æ¥å°±å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªåŒå·¥æµï¼Œå®¢æˆ·ç«¯æ—¢éœ€è¦ä¸æ–­æ¥æ”¶æ¶ˆæ¯ï¼ˆè¯»å–æ•°æ®ï¼‰ï¼Œä¹Ÿéœ€è¦å‘é€æ¶ˆæ¯ï¼ˆå†™å…¥æ•°æ®ï¼‰ã€‚</p><ol><li><p><strong>æ–‡ä»¶ä¼ è¾“</strong>ï¼šä½ å¸Œæœ›å°†ä¸€ä¸ªå¤§æ–‡ä»¶ä»ä¸€ä¸ªä½ç½®å¤åˆ¶åˆ°å¦ä¸€ä¸ªä½ç½®ã€‚ä½¿ç”¨ <code>stream.Duplex.from(src)</code>ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªåŒå·¥æµï¼Œè¿™ä¸ªæµæ—¢è¿æ¥åˆ°æ–‡ä»¶çš„è¯»å–ç«¯ï¼ˆè¯»å–åŸæ–‡ä»¶ï¼‰ï¼Œä¹Ÿè¿æ¥åˆ°æ–‡ä»¶çš„å†™å…¥ç«¯ï¼ˆå†™å…¥åˆ°ç›®æ ‡æ–‡ä»¶ï¼‰ã€‚è¿™ä½¿å¾—æ•°æ®å¯ä»¥åœ¨è¯»å–çš„åŒæ—¶å†™å…¥ï¼Œé«˜æ•ˆåœ°å®Œæˆæ–‡ä»¶çš„å¤åˆ¶æ“ä½œã€‚</p></li><li><p><strong>ç½‘ç»œä»£ç†æœåŠ¡å™¨</strong>ï¼šä½ æ­£åœ¨æ„å»ºä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œå®ƒéœ€è¦æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç„¶åå°†è¿™äº›è¯·æ±‚è½¬å‘åˆ°å…¶ä»–æœåŠ¡å™¨ï¼Œå¹¶å°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»£ç†æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªåŒå·¥æµæ¥åŒæ—¶å¤„ç†è¯·æ±‚çš„è¯»å–å’Œå“åº”çš„å†™å…¥ã€‚</p></li><li><p><strong>å®æ—¶éŸ³è§†é¢‘é€šä¿¡</strong>ï¼šåœ¨ä¸€ä¸ªè§†é¢‘ä¼šè®®åº”ç”¨ä¸­ï¼Œæ¯ä¸ªå‚ä¸è€…çš„éŸ³è§†é¢‘æ•°æ®éœ€è¦ä¸æ–­åœ°å‘é€ç»™å…¶ä»–æ‰€æœ‰å‚ä¸è€…ï¼ŒåŒæ—¶ä»–ä»¬ä¹Ÿä¼šæ¥æ”¶æ¥è‡ªå…¶ä»–äººçš„æ•°æ®ã€‚è¿™é‡Œï¼Œ<code>stream.Duplex.from(src)</code> å¯ä»¥ç”¨æ¥åˆ›å»ºä¸€ä¸ªå¤„ç†éŸ³è§†é¢‘æ•°æ®çš„åŒå·¥æµï¼Œä½¿å¾—æ¯ä¸ªå‚ä¸è€…æ—¢æ˜¯æ•°æ®çš„ç”Ÿäº§è€…ï¼ˆæ‘„åƒå¤´å’Œéº¦å…‹é£è¾“å…¥ï¼‰ï¼Œä¹Ÿæ˜¯æ¶ˆè´¹è€…ï¼ˆå±å¹•å’Œæ‰¬å£°å™¨è¾“å‡ºï¼‰ã€‚</p></li></ol><p>ä»¥ä¸Šä¾‹å­å±•ç¤ºäº† <code>stream.Duplex.from(src)</code> åœ¨ä¸åŒåœºæ™¯ä¸‹çš„åº”ç”¨ï¼Œå®ƒä¸ºå¤„ç†åŒæ—¶éœ€è¦è¯»å†™æ“ä½œçš„å¤æ‚æ•°æ®äº¤æ¢æä¾›äº†ä¸€ç§æœ‰æ•ˆçš„ç¼–ç¨‹æ¨¡å¼ã€‚</p><h3 id="stream-duplex-fromweb-pair-options" tabindex="-1"><a class="header-anchor" href="#stream-duplex-fromweb-pair-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streamduplexfromwebpair-options" target="_blank" rel="noopener noreferrer">stream.Duplex.fromWeb(pair[, options])</a></span></a></h3><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ¥ç†è§£ <code>stream.Duplex.fromWeb(pair[, options])</code> è¿™ä¸ªæ–¹æ³•åœ¨ Node.js ä¸­çš„ç”¨é€”å’Œå·¥ä½œæ–¹å¼ã€‚</p><p>é¦–å…ˆï¼Œæ¦‚æ‹¬åœ°è¯´ï¼ŒNode.js æ˜¯ä¸€ä¸ªèƒ½å¤Ÿè®©ä½ ç”¨ JavaScript ç¼–å†™æœåŠ¡å™¨ç«¯ä»£ç çš„å¹³å°ã€‚å®ƒå¯¹äºå¤„ç†ç½‘ç»œæ“ä½œã€æ–‡ä»¶ç³»ç»Ÿç­‰éå¸¸æœ‰æ•ˆï¼Œå…¶ä¸­ä¸€ä¸ªå¼ºå¤§çš„ç‰¹æ€§å°±æ˜¯å¯¹æµï¼ˆStreamsï¼‰çš„æ”¯æŒã€‚æµå¯ä»¥ç®€å•ç†è§£ä¸ºæ•°æ®çš„è¿ç»­ä¼ è¾“ï¼Œæƒ³è±¡æˆæ°´æµä»ä¸€ç‚¹æµå‘å¦ä¸€ç‚¹ï¼Œæ•°æ®ä¹Ÿæ˜¯å¦‚æ­¤ä»æ¥æºæµå‘ç›®çš„åœ°ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæœ‰å‡ ç§ç±»å‹çš„æµï¼š</p><ul><li><strong>å¯è¯»æµï¼ˆReadableï¼‰</strong>ï¼šç”¨äºè¯»å–æ•°æ®ï¼Œæ¯”å¦‚ä»æ–‡ä»¶è¯»å–æ•°æ®ã€‚</li><li><strong>å¯å†™æµï¼ˆWritableï¼‰</strong>ï¼šç”¨äºå†™å…¥æ•°æ®ï¼Œæ¯”å¦‚å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚</li><li><strong>åŒå·¥æµï¼ˆDuplexï¼‰</strong>ï¼šåŒæ—¶æ”¯æŒè¯»å†™æ“ä½œã€‚</li><li><strong>è½¬æ¢æµï¼ˆTransformï¼‰</strong>ï¼šæ˜¯ä¸€ç§åŒå·¥æµï¼Œä½†å®ƒå¯ä»¥ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®ï¼Œåœ¨å°†æ•°æ®ä»å¯è¯»éƒ¨åˆ†å‘é€åˆ°å¯å†™éƒ¨åˆ†ä¹‹å‰ã€‚</li></ul><p><code>stream.Duplex.fromWeb(pair[, options])</code> æ˜¯ Node.js v15.4.0 ç‰ˆæœ¬å¼•å…¥çš„ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§æœºåˆ¶ï¼Œé€šè¿‡è¿™ç§æœºåˆ¶ï¼Œå¼€å‘è€…å¯ä»¥è½»æ¾åœ°å°†éµå¾ª Web æ ‡å‡†ï¼ˆæ¯”å¦‚ WHATWG Streams APIï¼‰çš„åŒå·¥æµæ¥å£è½¬æ¢ä¸º Node.js çš„ Duplex æµã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥æ›´å®¹æ˜“åœ°åœ¨ä¸åŒç¯å¢ƒä¸‹é‡ç”¨ä»£ç ï¼Œå¹¶åˆ©ç”¨ Node.js å¼ºå¤§çš„æµå¤„ç†åŠŸèƒ½ã€‚</p><h3 id="å‚æ•°è§£é‡Š-3" tabindex="-1"><a class="header-anchor" href="#å‚æ•°è§£é‡Š-3"><span>å‚æ•°è§£é‡Š</span></a></h3><ul><li><code>pair</code>ï¼šè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªåŒ…å« <code>writable</code> å’Œ <code>readable</code> å±æ€§çš„å¯¹è±¡ã€‚<code>writable</code> æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ WHATWG WritableStreamï¼Œè€Œ <code>readable</code> æ˜¯ä¸€ä¸ª WHATWG ReadableStreamã€‚ç®€å•æ¥è¯´ï¼Œè¿™ä¸ªå¯¹è±¡ä»£è¡¨äº†ä¸€ä¸ªåŒæ–¹å‘çš„æµï¼Œæ—¢å¯ä»¥å†™å…¥æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä»ä¸­è¯»å–æ•°æ®ã€‚</li><li><code>options</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå…è®¸ä½ å®šåˆ¶åŒ–è½¬æ¢åçš„ Duplex æµï¼Œé€šè¿‡æä¾›ä»»ä½•é€‚ç”¨äº Node.js æµçš„é…ç½®é€‰é¡¹ã€‚</li></ul><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-11" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-11"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œä½ æœ‰ä¸€ä¸ªä½¿ç”¨ WHATWG Streams API çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼Œä½ å¯èƒ½æ­£åœ¨ç”¨ Fetch API è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œå¹¶å¸Œæœ›ä»¥æµçš„å½¢å¼å¤„ç†æ•°æ®ä»¥èŠ‚çœå†…å­˜å¹¶æé«˜æ•ˆç‡ã€‚ç°åœ¨ï¼Œå¦‚æœä½ æƒ³åœ¨ Node.js ç¯å¢ƒé‡Œå¤ç”¨è¿™æ®µä»£ç ï¼Œè¿›è¡Œç›¸åŒçš„æ•°æ®å¤„ç†ï¼Œ<code>stream.Duplex.fromWeb(pair[, options])</code> å°±èƒ½å¸®åˆ°ä½ ã€‚</p><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Duplex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™äº›æ˜¯ä»æŸä¸ª Web API è¿”å›çš„ WHATWG æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> ReadableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">enqueue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">enqueue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> WritableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°† WHATWG æµè½¬æ¢ä¸º Node.js çš„ Duplex æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> duplexStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Duplex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fromWeb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">duplexStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åº”è¯¥è¾“å‡º &#39;Hello, World!&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ WHATWG <code>ReadableStream</code> å’Œ <code>WritableStream</code>ï¼Œç„¶åä½¿ç”¨ <code>Duplex.fromWeb()</code> æ–¹æ³•å°†è¿™å¯¹æµè½¬æ¢ä¸º Node.js é£æ ¼çš„ Duplex æµã€‚è¿™æ ·å°±å¯ä»¥åˆ©ç”¨ Node.js æä¾›çš„ä¸°å¯Œçš„æµäº‹ä»¶å’Œæ–¹æ³•æ¥å¤„ç†æ•°æ®äº†ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œ<code>stream.Duplex.fromWeb(pair[, options])</code> ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªæ¡¥æ¢ï¼Œè®©ä»–ä»¬å¯ä»¥æ›´å®¹æ˜“åœ°åœ¨ Node.js å’Œéµå¾ª Web æ ‡å‡†çš„ç¯å¢ƒä¹‹é—´å…±äº«å’Œé‡ç”¨åŸºäºæµçš„ä»£ç ã€‚</p><h3 id="stream-duplex-toweb-streamduplex" tabindex="-1"><a class="header-anchor" href="#stream-duplex-toweb-streamduplex"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streamduplextowebstreamduplex" target="_blank" rel="noopener noreferrer">stream.Duplex.toWeb(streamDuplex)</a></span></a></h3><p>è¦ç†è§£<code>stream.Duplex.toWeb()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼šNode.js ä¸­çš„æµ(Streams)ã€åŒå·¥æµ(Duplex Streams)ã€ä»¥åŠå¦‚ä½•å°† Node.js ä¸­çš„æµè½¬æ¢ä¸º Web Streamsã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-8" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-8"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><ol><li><p><strong>æµ(Streams)</strong>: åœ¨ Node.js ä¸­ï¼Œæµæ˜¯æ•°æ®çš„é›†åˆï¼Œæ¯”å¦‚æ–‡ä»¶ä¸­çš„æ•°æ®æˆ–ç½‘ç»œä¼ è¾“ä¸­çš„æ•°æ®ã€‚æµçš„å¥½å¤„åœ¨äºå®ƒä»¬å¯ä»¥å°†å¤§é‡çš„æ•°æ®åˆ†æˆå°å—è¿›è¡Œå¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™ç§æ–¹å¼ä½¿å¾—å¤„ç†å¤§é‡æ•°æ®å˜å¾—æ›´åŠ é«˜æ•ˆã€‚</p></li><li><p><strong>åŒå·¥æµ(Duplex Streams)</strong>: åŒå·¥æµæ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„æµï¼Œå®ƒå…è®¸æ•°æ®åŒæ—¶åœ¨ä¸¤ä¸ªæ–¹å‘ä¸ŠæµåŠ¨ï¼Œå³å¯ä»¥è¯»ï¼Œä¹Ÿå¯ä»¥å†™ã€‚ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ç½‘ç»œå¥—æ¥å­—ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒå‘é€æ•°æ®ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æ¥æ”¶æ•°æ®ã€‚</p></li><li><p><strong>Web Streams</strong>: è¿™æ˜¯ Web å¹³å°çš„ä¸€ä¸ªæ ‡å‡†ï¼Œå®šä¹‰äº†åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨çš„æµå¼æ•°æ®å¤„ç†æ¥å£ã€‚Web Streams å’Œ Node.js ä¸­çš„ Streams ç›¸ä¼¼ï¼Œä½†å®ƒä»¬å±äºä¸åŒçš„ç¯å¢ƒï¼Œå…·æœ‰ä¸åŒçš„ APIã€‚</p></li></ol><h3 id="stream-duplex-toweb-streamduplex-1" tabindex="-1"><a class="header-anchor" href="#stream-duplex-toweb-streamduplex-1"><span><code>stream.Duplex.toWeb(streamDuplex)</code></span></a></h3><p>åœ¨ Node.js v21.7.1 ä¸­å¼•å…¥äº†<code>stream.Duplex.toWeb()</code>è¿™ä¸ªé™æ€æ–¹æ³•ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯å°† Node.js ä¸­çš„åŒå·¥æµ(Duplex Stream)è½¬æ¢ä¸º Web å¹³å°ä¸Šçš„åŒå·¥æµ(Web Streams)ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥å°† Node.js ä¸­çš„æµæ•°æ®æ— ç¼åœ°ä¸æ”¯æŒ Web Streams API çš„æµè§ˆå™¨æŠ€æœ¯ï¼ˆå¦‚ Fetch API æˆ–è€… Service Workersï¼‰ç»“åˆä½¿ç”¨ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-16" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-16"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œå®ƒä»æŸä¸ªæºï¼ˆæ¯”å¦‚æ–‡ä»¶æˆ–ç½‘ç»œæœåŠ¡ï¼‰è¯»å–æ•°æ®ï¼Œå¹¶ä¸”æˆ‘ä»¬æƒ³å°†è¿™äº›æ•°æ®å®æ—¶å‘é€åˆ°å®¢æˆ·ç«¯çš„æµè§ˆå™¨ä¸­ï¼ŒåŒæ—¶ä¹Ÿå¯èƒ½å¸Œæœ›æ¥æ”¶æ¥è‡ªæµè§ˆå™¨çš„æ•°æ®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>stream.Duplex.toWeb()</code>æ¥è½¬æ¢ Node.js ä¸­çš„åŒå·¥æµï¼Œç„¶ååœ¨ Web å‰ç«¯ä½¿ç”¨è¿™ä¸ªæµè¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚</p><p><strong>åç«¯ Node.js ä»£ç ç¤ºä¾‹</strong>:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Duplex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">pipeline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªç®€å•çš„åŒå·¥æµç¤ºä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> EchoStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Duplex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received data: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _final</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;/echo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> duplexStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> EchoStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å°†Node.jsåŒå·¥æµè½¬æ¢ä¸ºWeb Stream</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> webStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Duplex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toWeb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">duplexStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ä½¿ç”¨æ ‡å‡†çš„Web Streamsæ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    webStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipeTo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">statusCode</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 404</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server running at http://localhost:3000/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­åˆ›å»ºäº†ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚<code>/echo</code>è·¯å¾„æ—¶ï¼ŒæœåŠ¡å™¨ä½¿ç”¨ä¸€ä¸ªç®€å•çš„åŒå·¥æµ(<code>EchoStream</code>)å¤„ç†æ•°æ®ã€‚<code>EchoStream</code>ä»…ä»…æ˜¯å°†æ¥æ”¶åˆ°çš„æ•°æ®å›æ˜¾å‡ºå»ï¼Œå¹¶é€šè¿‡<code>Duplex.toWeb()</code>è½¬æ¢ä¸º Web æµï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ Web æµçš„æ–¹æ³•æ¥å¤„ç†æ•°æ®ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬åˆ©ç”¨<code>.pipeTo()</code>å°†è½¬æ¢åçš„ Web æµæ•°æ®å‘é€ç»™å®¢æˆ·ç«¯ã€‚</p><p><strong>è¯·æ³¨æ„</strong>ï¼Œè¿™åªæ˜¯ä¸€ä¸ªç®€åŒ–çš„ä¾‹å­ï¼Œç”¨äºæ¼”ç¤º<code>stream.Duplex.toWeb()</code>æ–¹æ³•çš„åŸºæœ¬ç”¨æ³•ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒåŒå·¥æµçš„ä½¿ç”¨åœºæ™¯å¯èƒ½ä¼šæ›´åŠ å¤æ‚ã€‚</p><h3 id="stream-addabortsignal-signal-stream" tabindex="-1"><a class="header-anchor" href="#stream-addabortsignal-signal-stream"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streamaddabortsignalsignal-stream" target="_blank" rel="noopener noreferrer">stream.addAbortSignal(signal, stream)</a></span></a></h3><p>Node.js ä¸­çš„ <code>stream.addAbortSignal(signal, stream)</code> æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°çš„åŠŸèƒ½ï¼Œå®ƒå…è®¸ä½ é€šè¿‡ AbortController çš„ä¿¡å·æ¥ç»ˆæ­¢ä¸€ä¸ªæµã€‚å…ˆæ¥åˆ†è§£ä¸€ä¸‹è¿™ä¸ªæ¦‚å¿µå’Œç”¨æ³•ï¼Œç„¶åå†é€šè¿‡å®é™…ä¾‹å­æ¥åŠ æ·±ç†è§£ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ-9" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ-9"><span>åŸºæœ¬æ¦‚å¿µ</span></a></h3><ol><li><p><strong>æµï¼ˆStreamï¼‰</strong>: åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚æ¯”å¦‚ï¼Œå½“ä½ è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶æˆ–è€…ä»ç½‘ç»œè·å–æ•°æ®æ—¶ï¼Œä½¿ç”¨æµå¯ä»¥é€å—åœ°å¤„ç†æ•°æ®ï¼Œè€Œä¸æ˜¯ç­‰å¾…æ‰€æœ‰æ•°æ®éƒ½åŠ è½½å®Œæ¯•ã€‚è¿™æ ·å¯ä»¥æé«˜æ•ˆç‡å¹¶å‡å°‘å†…å­˜çš„ä½¿ç”¨ã€‚Node.js ä¸­æœ‰å››ç§åŸºæœ¬ç±»å‹çš„æµï¼šå¯è¯»æµã€å¯å†™æµã€åŒå‘æµå’Œè½¬æ¢æµã€‚</p></li><li><p><strong>AbortController å’Œ AbortSignal</strong>: è¿™æ˜¯ Web æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œä½†ä¹Ÿè¢« Node.js é‡‡çº³ã€‚<code>AbortController</code> å¯ä»¥ç”¨æ¥ç”Ÿæˆä¸€ä¸ªå–æ¶ˆä¿¡å·ï¼ˆ<code>AbortSignal</code>ï¼‰ï¼Œè¿™ä¸ªä¿¡å·å¯ä»¥ä¼ é€’ç»™ä¸€ä¸ªæˆ–å¤šä¸ªéœ€è¦æ”¯æŒå–æ¶ˆæ“ä½œçš„ä»»åŠ¡ã€‚å½“è°ƒç”¨ <code>AbortController</code> çš„ <code>abort()</code> æ–¹æ³•æ—¶ï¼Œä¸ä¹‹å…³è”çš„ <code>AbortSignal</code> å°±ä¼šå‘å‡ºå–æ¶ˆä¿¡å·ã€‚</p></li></ol><h3 id="stream-addabortsignal-signal-stream-1" tabindex="-1"><a class="header-anchor" href="#stream-addabortsignal-signal-stream-1"><span><code>stream.addAbortSignal(signal, stream)</code></span></a></h3><p>è¿™ä¸ªå‡½æ•°å…è®¸ä½ å°†ä¸€ä¸ª <code>AbortSignal</code> ä¸ä¸€ä¸ªæµç›¸å…³è”ã€‚å¦‚æœè¿™ä¸ª <code>AbortSignal</code> å‘å‡ºäº†ç»ˆæ­¢ä¿¡å·ï¼Œé‚£ä¹ˆæµå°±ä¼šè‡ªåŠ¨å…³é—­ï¼Œå¹¶ä¸”æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚è¿™ä¸ºç®¡ç†å’Œå–æ¶ˆæµæ“ä½œæä¾›äº†ä¸€ç§ç®€æ´çš„æœºåˆ¶ã€‚</p><h3 id="å®é™…åº”ç”¨ä¸¾ä¾‹-2" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¸¾ä¾‹-2"><span>å®é™…åº”ç”¨ä¸¾ä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-è¯»å–å¤§æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-è¯»å–å¤§æ–‡ä»¶"><span>ç¤ºä¾‹ 1: è¯»å–å¤§æ–‡ä»¶</span></a></h4><p>æƒ³è±¡ä½ æ­£åœ¨è¯»å–ä¸€ä¸ªéå¸¸å¤§çš„æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨æŸä¸ªç‰¹å®šæ¡ä»¶ä¸‹ï¼ˆæ¯”å¦‚ç”¨æˆ·è¯·æ±‚å–æ¶ˆï¼Œæˆ–è€…è¶…æ—¶ï¼‰ä½ å¸Œæœ›åœæ­¢è¯»å–ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">addAbortSignal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ª AbortController å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> signal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥è¯»å–æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/large/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ addAbortSignal å…³è”ä¿¡å·å’Œæµ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">addAbortSignal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœ5ç§’åæˆ‘ä»¬æƒ³å–æ¶ˆè¯»å–</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™å°†å¯¼è‡´ readStream è¢«å…³é—­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¤„ç†æµè‡ªåŠ¨å…³é—­æ—¶çš„æƒ…å†µ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Read stream aborted.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stream encountered an error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœ 5 ç§’é’Ÿå†…æ–‡ä»¶æ²¡æœ‰è¯»å–å®Œæˆï¼Œè¯»å–æ“ä½œå°†è¢«å–æ¶ˆï¼Œæµä¼šè¢«è‡ªåŠ¨å…³é—­ã€‚</p><h4 id="ç¤ºä¾‹-2-ç½‘ç»œè¯·æ±‚-2" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ç½‘ç»œè¯·æ±‚-2"><span>ç¤ºä¾‹ 2: ç½‘ç»œè¯·æ±‚</span></a></h4><p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Node.js å‘é€ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„ç½‘ç»œè¯·æ±‚ï¼Œå¹¶ä¸”å¸Œæœ›èƒ½å¤Ÿåœ¨ç”¨æˆ·å–æ¶ˆæ“ä½œæ—¶åœæ­¢è¯¥è¯·æ±‚ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">addAbortSignal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> signal</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘é€ GET è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;response&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å“åº”å¯èƒ½æ˜¯ä¸€ä¸ªå¤§å‹æ•°æ®æµï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ AbortSignal æ§åˆ¶å…¶è¯»å–</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  addAbortSignal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">signal</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¦‚æœç”¨æˆ·æƒ³å–æ¶ˆè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  controller</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¿™å°†å–æ¶ˆè¯·æ±‚å’Œå“åº”æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;AbortError&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Request aborted.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Request encountered an error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œå¦‚æœç”¨æˆ·åœ¨ 3 ç§’å†…å–æ¶ˆäº†æ“ä½œï¼Œé‚£ä¹ˆç½‘ç»œè¯·æ±‚å’Œå¯¹åº”çš„å“åº”æµéƒ½ä¼šè¢«æ­£ç¡®åœ°ç»ˆæ­¢ã€‚</p><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>stream.addAbortSignal(signal, stream)</code> åœ¨å®é™…å¼€å‘ä¸­å¯¹äºèµ„æºç®¡ç†å’Œæ§åˆ¶å…·æœ‰å¾ˆå¤§çš„ä¾¿åˆ©æ€§ã€‚</p><h3 id="stream-getdefaulthighwatermark-objectmode" tabindex="-1"><a class="header-anchor" href="#stream-getdefaulthighwatermark-objectmode"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streamgetdefaulthighwatermarkobjectmode" target="_blank" rel="noopener noreferrer">stream.getDefaultHighWaterMark(objectMode)</a></span></a></h3><p>äº†è§£ <code>stream.getDefaultHighWaterMark(objectMode)</code> å‰ï¼Œæˆ‘ä»¬å…ˆç®€å•äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„æµï¼ˆStreamï¼‰å’Œå®ƒä»¬ä¸ºä»€ä¹ˆé‡è¦ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯æµ-stream-1" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯æµ-stream-1"><span>ä»€ä¹ˆæ˜¯æµï¼ˆStreamï¼‰ï¼Ÿ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†è¯»å–æˆ–å†™å…¥è¿ç»­æ•°æ®çš„æŠ½è±¡æ¥å£ã€‚æƒ³è±¡ä½ æ­£åœ¨ç”¨ä¸€æ ¹æ°´ç®¡è¾“é€æ°´ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±åƒæ˜¯ä¸€ä¸ªæµã€‚è¿™ç§æ–¹å¼éå¸¸é€‚åˆå¤„ç†å¤§é‡æ•°æ®ï¼Œæ¯”å¦‚æ–‡ä»¶å¤„ç†æˆ–ç½‘ç»œé€šä¿¡ç­‰ï¼Œå› ä¸ºä½ å¯ä»¥é€å—åœ°è¯»å–æˆ–å†™å…¥æ•°æ®ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><h3 id="é«˜æ°´ä½çº¿-high-water-mark" tabindex="-1"><a class="header-anchor" href="#é«˜æ°´ä½çº¿-high-water-mark"><span>é«˜æ°´ä½çº¿ï¼ˆHigh Water Markï¼‰</span></a></h3><p>æµåœ¨å†…éƒ¨ä½¿ç”¨ä¸€ä¸ªæ¦‚å¿µå«åšâ€œé«˜æ°´ä½çº¿â€ï¼ˆHigh Water Markï¼‰ï¼Œè¿™ä¸ªå€¼æŒ‡å®šäº†åœ¨å¼€å§‹æš‚åœä»åº•å±‚èµ„æºè¯»å–æ›´å¤šæ•°æ®ä¹‹å‰ï¼Œç¼“å†²åŒºæœ€å¤šå¯ä»¥ç§¯ç´¯å¤šå°‘å­—èŠ‚ï¼ˆæˆ–å¯¹è±¡ï¼‰ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå°±åƒæ˜¯å‘Šè¯‰æµï¼šâ€œå½“ä½ æ”¶é›†äº†è¿™ä¹ˆå¤šæ•°æ®åï¼Œå°±å¯ä»¥ç¨å¾®ä¼‘æ¯ä¸€ä¸‹ï¼Œä¸ç”¨å†æ€¥ç€å»è·å–æ›´å¤šäº†â€ã€‚</p><h3 id="stream-getdefaulthighwatermark-objectmode-1" tabindex="-1"><a class="header-anchor" href="#stream-getdefaulthighwatermark-objectmode-1"><span>stream.getDefaultHighWaterMark(objectMode)</span></a></h3><p><code>stream.getDefaultHighWaterMark(objectMode)</code> æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒç”¨äºè·å–åœ¨ç»™å®šæ¨¡å¼ï¼ˆå­—èŠ‚æ¨¡å¼æˆ–å¯¹è±¡æ¨¡å¼ï¼‰ä¸‹ï¼Œé»˜è®¤çš„é«˜æ°´ä½çº¿çš„å¤§å°ã€‚è¿™é‡Œé¢çš„å‚æ•° <code>objectMode</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼š</p><ul><li>å¦‚æœè®¾ç½®ä¸º <code>true</code>ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•è¿”å›çš„æ˜¯åœ¨å¯¹è±¡æ¨¡å¼ä¸‹çš„é»˜è®¤é«˜æ°´ä½çº¿çš„å€¼ã€‚</li><li>å¦‚æœè®¾ç½®ä¸º <code>false</code> æˆ–è€…ä¸æä¾›ï¼Œé‚£ä¹ˆè¿”å›çš„æ˜¯åœ¨å­—èŠ‚æ¨¡å¼ä¸‹çš„é»˜è®¤é«˜æ°´ä½çº¿çš„å€¼ã€‚</li></ul><h4 id="å­—èŠ‚æ¨¡å¼ä¸å¯¹è±¡æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#å­—èŠ‚æ¨¡å¼ä¸å¯¹è±¡æ¨¡å¼"><span>å­—èŠ‚æ¨¡å¼ä¸å¯¹è±¡æ¨¡å¼</span></a></h4><ul><li><strong>å­—èŠ‚æ¨¡å¼</strong>ï¼šæµæ“ä½œçš„ä¸»è¦æ˜¯å­—èŠ‚æ•°æ®ï¼Œä¾‹å¦‚æ–‡ä»¶è¯»å†™ï¼Œç½‘ç»œæ•°æ®ä¼ è¾“ç­‰ã€‚</li><li><strong>å¯¹è±¡æ¨¡å¼</strong>ï¼šæµæ“ä½œçš„æ˜¯å¯¹è±¡ï¼Œæ¯ä¸ªè¯»å–æˆ–å†™å…¥çš„æ“ä½œéƒ½æ˜¯é’ˆå¯¹ä¸€ä¸ªå¯¹è±¡è€Œä¸æ˜¯å­—èŠ‚æ•°ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-22" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-22"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>æ–‡ä»¶å¤„ç†</strong>ï¼šå½“ä½ ç”¨æµæ¥è¯»å–ä¸€ä¸ªéå¸¸å¤§çš„æ–‡ä»¶æ—¶ï¼Œæ¯”å¦‚ä¸€ä¸ªå‡  GB çš„æ—¥å¿—æ–‡ä»¶ï¼Œä½ å¯èƒ½å¸Œæœ›æ§åˆ¶æ•°æ®çš„è¯»å–é€Ÿåº¦ï¼Œä»¥é¿å…ä¸€æ¬¡æ€§å ç”¨å¤ªå¤šå†…å­˜ã€‚é€šè¿‡äº†è§£é»˜è®¤çš„é«˜æ°´ä½çº¿ï¼Œä½ å¯ä»¥æ›´å¥½åœ°è°ƒæ•´è‡ªå·±çš„æµæ¥é€‚åº”ç‰¹å®šçš„å†…å­˜ç®¡ç†éœ€æ±‚ã€‚</p></li><li><p><strong>ç½‘ç»œé€šä¿¡</strong>ï¼šå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªèŠå¤©åº”ç”¨ï¼ŒæœåŠ¡ç«¯éœ€è¦å‘å®¢æˆ·ç«¯å®æ—¶æ¨é€æ¶ˆæ¯ã€‚åˆ©ç”¨æµçš„é«˜æ°´ä½çº¿ï¼Œä½ å¯ä»¥æ§åˆ¶æ¶ˆæ¯çš„å‘é€é¢‘ç‡ï¼Œç¡®ä¿åœ¨é«˜æµé‡æƒ…å†µä¸‹æœåŠ¡å™¨ä¸ä¼šè¢«è¿‡å¤šçš„é€šä¿¡è¯·æ±‚å‹å®ã€‚</p></li><li><p><strong>æ•°æ®è½¬æ¢</strong>ï¼šå¦‚æœä½ æ­£åœ¨åšæ•°æ®è½¬æ¢ï¼Œæ¯”å¦‚ä» CSV æ ¼å¼è½¬æ¢åˆ° JSONï¼Œä½ ä¼šè¯»å–æºæ–‡ä»¶è¡Œä¸ºå•ä½ï¼Œå¹¶å°†æ¯è¡Œè½¬æ¢ä¸ºä¸€ä¸ªå¯¹è±¡è¾“å‡ºã€‚é€šè¿‡è°ƒæ•´å¯¹è±¡æ¨¡å¼ä¸‹çš„æµçš„é«˜æ°´ä½çº¿ï¼Œä½ å¯ä»¥æ§åˆ¶è½¬æ¢è¿‡ç¨‹ä¸­çš„å†…å­˜ä½¿ç”¨ï¼Œä¼˜åŒ–æ€§èƒ½ã€‚</p></li></ol><p>é€šè¿‡ä½¿ç”¨ <code>stream.getDefaultHighWaterMark(objectMode)</code> æ¥äº†è§£é»˜è®¤çš„é«˜æ°´ä½çº¿ï¼Œä½ å¯ä»¥æ›´åŠ çµæ´»åœ°è®¾è®¡è‡ªå·±çš„æµå¤„ç†é€»è¾‘ï¼Œæ— è®ºæ˜¯è¿›è¡Œå¤§æ–‡ä»¶å¤„ç†ã€é«˜æ•ˆçš„ç½‘ç»œé€šä¿¡è¿˜æ˜¯å¤æ‚çš„æ•°æ®è½¬æ¢å·¥ä½œã€‚</p><p>å¸Œæœ›è¿™è§£é‡Šèƒ½å¸®åŠ©ä½ ç†è§£ <code>stream.getDefaultHighWaterMark(objectMode)</code> çš„ä½œç”¨å’Œå®ƒåœ¨å®é™…ä¸­çš„åº”ç”¨ï¼</p><h3 id="stream-setdefaulthighwatermark-objectmode-value" tabindex="-1"><a class="header-anchor" href="#stream-setdefaulthighwatermark-objectmode-value"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streamsetdefaulthighwatermarkobjectmode-value" target="_blank" rel="noopener noreferrer">stream.setDefaultHighWaterMark(objectMode, value)</a></span></a></h3><p>äº†è§£<code>stream.setDefaultHighWaterMark(objectMode, value)</code>ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç®€å•ç†è§£å‡ ä¸ªæ¦‚å¿µï¼šNode.jsã€æµ(Stream)ã€ä»¥åŠé«˜æ°´ä½çº¿(HighWaterMark)ã€‚</p><h3 id="ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#ç®€ä»‹"><span>ç®€ä»‹</span></a></h3><ul><li><strong>Node.js</strong>ï¼šä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®© JavaScript å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œã€‚</li><li><strong>æµ(Stream)</strong>ï¼šåœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§å¤„ç†è¯»å–æˆ–å†™å…¥æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ I/O æ“ä½œçš„æ–¹å¼ã€‚å®ƒä»¬å…è®¸æ•°æ®è¢«é€å—å¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªæ•°æ®åˆ°å†…å­˜ä¸­ã€‚</li><li><strong>é«˜æ°´ä½çº¿(HighWaterMark)</strong>ï¼šåœ¨æµå¤„ç†ä¸­ï¼Œé«˜æ°´ä½çº¿è¡¨ç¤ºåœ¨æš‚åœä»æ•°æ®æºè¯»å–æ›´å¤šæ•°æ®ä¹‹å‰ï¼Œå†…éƒ¨ç¼“å†²åŒºæœ€å¤šèƒ½å¤Ÿå­˜å‚¨çš„å­—èŠ‚ï¼ˆå¯¹äº Buffer æ•°æ®ï¼‰æˆ–å¯¹è±¡ï¼ˆå¯¹äº Object æ¨¡å¼çš„æµï¼‰çš„æ•°é‡ã€‚</li></ul><h3 id="stream-setdefaulthighwatermark-objectmode-value-1" tabindex="-1"><a class="header-anchor" href="#stream-setdefaulthighwatermark-objectmode-value-1"><span><code>stream.setDefaultHighWaterMark(objectMode, value)</code></span></a></h3><p>è¿™ä¸ªæ–¹æ³•å…è®¸ä½ å…¨å±€è®¾ç½® Node.js åº”ç”¨ä¸­æ‰€æœ‰æµçš„é»˜è®¤é«˜æ°´ä½çº¿å€¼ï¼Œä»è€Œæ§åˆ¶å†…å­˜ä½¿ç”¨å’Œæ€§èƒ½è¡¨ç°ã€‚</p><ul><li><strong>objectMode</strong>ï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡å®šè®¾ç½®çš„æ˜¯å“ªç§æ¨¡å¼ä¸‹çš„æµçš„é«˜æ°´ä½çº¿ã€‚å½“è®¾ç½®ä¸º<code>true</code>æ—¶ï¼Œä¿®æ”¹çš„æ˜¯å¯¹è±¡æ¨¡å¼(<code>objectMode: true</code>)æµçš„é«˜æ°´ä½çº¿ï¼›å½“ä¸º<code>false</code>æ—¶ï¼Œä»£è¡¨ä¿®æ”¹çš„æ˜¯éå¯¹è±¡æ¨¡å¼çš„æµï¼ˆå³å¤„ç†äºŒè¿›åˆ¶æ•°æ®çš„æµï¼‰çš„é«˜æ°´ä½çº¿ã€‚</li><li><strong>value</strong>ï¼šè¿™æ˜¯ä½ æƒ³è¦è®¾ç½®çš„é«˜æ°´ä½çº¿çš„å€¼ï¼Œå¯¹äºéå¯¹è±¡æ¨¡å¼çš„æµï¼Œè¿™ä¸ªå€¼æ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½çš„ï¼›å¯¹äºå¯¹è±¡æ¨¡å¼çš„æµï¼Œåˆ™æ˜¯å¯¹è±¡çš„æ•°é‡ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-23" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-23"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦å¤„ç†å¤§é‡çš„æ—¥å¿—æ–‡ä»¶åˆ†æï¼Œå¹¶ä¸”ä½ æƒ³é€šè¿‡æµæ¥å®ç°ä»¥å‡å°‘å†…å­˜å ç”¨ã€‚</p><ol><li><p><strong>è¯»å–å¤§å‹æ–‡æœ¬æ–‡ä»¶</strong>ï¼šå¦‚æœä½ çš„åº”ç”¨éœ€è¦è¯»å–éå¸¸å¤§çš„æ—¥å¿—æ–‡ä»¶å¹¶è¿›è¡Œå¤„ç†ï¼Œå¯èƒ½ä¸å¸Œæœ›ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´å†…å­˜ä½¿ç”¨æ€¥å‰§å¢åŠ ã€‚æ­¤æ—¶å¯ä»¥ä½¿ç”¨æµæ¥é€æ­¥è¯»å–å’Œå¤„ç†æ–‡ä»¶å†…å®¹ã€‚å¦‚æœå‘ç°é»˜è®¤çš„é«˜æ°´ä½çº¿è®¾ç½®å¯¼è‡´å†…å­˜ä½¿ç”¨è¿‡é«˜æˆ–å¤„ç†æ•ˆç‡ä½ä¸‹ï¼Œå¯ä»¥è°ƒç”¨<code>stream.setDefaultHighWaterMark(false, æ–°çš„å€¼)</code>æ¥è°ƒæ•´éå¯¹è±¡æ¨¡å¼æµçš„é«˜æ°´ä½çº¿ï¼Œä¼˜åŒ–æ€§èƒ½ã€‚</p></li><li><p><strong>å¤„ç†å¯¹è±¡æµ</strong>ï¼šå‡è®¾ä½ çš„åº”ç”¨ä¸æ•°æ®åº“äº¤äº’ï¼Œéœ€è¦å¤„ç†è¿”å›çš„å¤§é‡æ•°æ®è®°å½•ã€‚å¦‚æœè¿™äº›è®°å½•ä½œä¸ºå¯¹è±¡æµå¤„ç†ï¼Œæ¯ä¸ªå¯¹è±¡ä»£è¡¨ä¸€æ¡è®°å½•ï¼Œé‚£ä¹ˆé€šè¿‡è°ƒæ•´å¯¹è±¡æ¨¡å¼æµçš„é«˜æ°´ä½çº¿ï¼ˆä½¿ç”¨<code>stream.setDefaultHighWaterMark(true, æ–°çš„å€¼)</code>ï¼‰ï¼Œå¯ä»¥ç²¾ç»†æ§åˆ¶åœ¨å†…å­˜ä¸­å­˜å‚¨çš„è®°å½•æ•°é‡ï¼Œé¿å…å› ä¸€æ¬¡å¤„ç†è¿‡å¤šè®°å½•è€Œå¯¼è‡´å†…å­˜æº¢å‡ºã€‚</p></li></ol><p>é€šè¿‡è¿™æ ·çš„è°ƒæ•´ï¼Œä½ å¯ä»¥æ ¹æ®åº”ç”¨çš„å®é™…éœ€æ±‚å’Œè¿è¡Œç¯å¢ƒçš„èµ„æºé™åˆ¶ï¼Œçµæ´»åœ°ç®¡ç†æµçš„å†…éƒ¨ç¼“å†²å¤§å°ï¼Œä»è€Œåœ¨ä¿è¯æ€§èƒ½çš„åŒæ—¶ï¼Œä¼˜åŒ–å†…å­˜ä½¿ç”¨ã€‚</p><p>è®°ä½ï¼Œè™½ç„¶è°ƒæ•´é«˜æ°´ä½çº¿å¯ä»¥ä¼˜åŒ–æ€§èƒ½ï¼Œä½†è®¾ç½®å¾—è¿‡é«˜æˆ–è¿‡ä½éƒ½å¯èƒ½æœ‰è´Ÿé¢å½±å“ï¼ˆå¦‚å†…å­˜ä½¿ç”¨è¿‡å¤šæˆ– I/O æ“ä½œé¢‘ç¹ï¼‰ï¼Œå› æ­¤éœ€è¦æ ¹æ®å®é™…æƒ…å†µè°¨æ…é€‰æ‹©åˆé€‚çš„å€¼ã€‚</p><h2 id="api-for-stream-implementers" tabindex="-1"><a class="header-anchor" href="#api-for-stream-implementers"><span><a href="https://nodejs.org/docs/latest/api/stream.html#api-for-stream-implementers" target="_blank" rel="noopener noreferrer">API for stream implementers</a></span></a></h2><p>Node.js ä¸­çš„æµï¼ˆStreamsï¼‰æ˜¯å¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œå°¤å…¶æ˜¯å½“æ•°æ®é‡å¤§æˆ–è€…æ•°æ®ä»¥ç‰‡æ®µçš„å½¢å¼åˆ°æ¥æ—¶ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€æ¡æ°´ç®¡ï¼Œæ°´ï¼ˆæ•°æ®ï¼‰å¯ä»¥ä¸€å°éƒ¨åˆ†ä¸€å°éƒ¨åˆ†åœ°æµè¿‡æ¥ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨æ¶Œåˆ°ç»ˆç‚¹ã€‚è¿™å°±æ˜¯æµçš„æ¦‚å¿µã€‚ç°åœ¨ï¼Œæˆ‘å°†è§£é‡Š Node.js v21.7.1 ä¸­é’ˆå¯¹æµå®ç°è€…çš„ API å¹¶ç»™å‡ºå‡ ä¸ªå®é™…çš„ä¾‹å­ã€‚</p><h3 id="æµçš„ç±»å‹" tabindex="-1"><a class="header-anchor" href="#æµçš„ç±»å‹"><span>æµçš„ç±»å‹</span></a></h3><p>é¦–å…ˆï¼ŒNode.js æœ‰å››ç§åŸºæœ¬çš„æµç±»å‹ï¼š</p><ol><li><strong>å¯è¯»æµï¼ˆReadableï¼‰</strong> - è¿™ç§æµç”¨äºä»ä¸€ä¸ªåœ°æ–¹ï¼ˆä¾‹å¦‚æ–‡ä»¶ã€è¯·æ±‚ç­‰ï¼‰è¯»å–æ•°æ®ã€‚</li><li><strong>å¯å†™æµï¼ˆWritableï¼‰</strong> - è¿™ç§æµç”¨äºå‘æŸå¤„å†™å…¥æ•°æ®ï¼Œæ¯”å¦‚æ–‡ä»¶ã€å“åº”ç­‰ã€‚</li><li><strong>åŒå·¥æµï¼ˆDuplexï¼‰</strong> - å¯ä»¥åŒæ—¶è¯»å†™æ•°æ®ã€‚</li><li><strong>è½¬æ¢æµï¼ˆTransformï¼‰</strong> - ä¸€ç§ç‰¹æ®Šç±»å‹çš„åŒå·¥æµï¼Œå®ƒå¯ä»¥åœ¨è¯»å†™æ•°æ®æ—¶ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®ã€‚</li></ol><h3 id="é’ˆå¯¹æµå®ç°è€…çš„-api-æ„ä¹‰" tabindex="-1"><a class="header-anchor" href="#é’ˆå¯¹æµå®ç°è€…çš„-api-æ„ä¹‰"><span>é’ˆå¯¹æµå®ç°è€…çš„ API æ„ä¹‰</span></a></h3><p>å¦‚æœä½ æ‰“ç®—è‡ªå·±åˆ›å»ºä¸€ä¸ªæ–°çš„æµç±»å‹ï¼Œäº†è§£ä»¥ä¸‹æ¦‚å¿µéå¸¸é‡è¦ï¼š</p><ul><li><strong>data äº‹ä»¶</strong>: å½“æµæœ‰æ•°æ®å¯ä¾›æ¶ˆè´¹æ—¶ï¼Œä¼šè§¦å‘æ­¤äº‹ä»¶ã€‚</li><li><strong>end äº‹ä»¶</strong>: å½“æ²¡æœ‰æ›´å¤šæ•°æ®å¯è¯»æ—¶ï¼Œä¼šè§¦å‘æ­¤äº‹ä»¶ã€‚</li><li><strong>error äº‹ä»¶</strong>: åœ¨å¤„ç†æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘ã€‚</li><li><strong>write æ–¹æ³•</strong>: ç”¨äºå°†æ•°æ®å†™å…¥æµä¸­ã€‚</li><li><strong>read æ–¹æ³•</strong>: ç”¨äºä»æµä¸­è¯»å–æ•°æ®ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-24" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-24"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><h4 id="_1-åˆ›å»ºè‡ªå®šä¹‰çš„å¯è¯»æµ" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»ºè‡ªå®šä¹‰çš„å¯è¯»æµ"><span>1. åˆ›å»ºè‡ªå®šä¹‰çš„å¯è¯»æµ</span></a></h4><p>å‡è®¾æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªç®€å•çš„å¯è¯»æµï¼Œè¯¥æµäº§ç”Ÿæ•°å­—åºåˆ—ä½œä¸ºè¾“å‡ºã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;stream&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> NumberStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">current</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">max</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> nextNumber</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">current</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">nextNumber</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `&lt;`</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">nextNumber</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†æ•°å­—æ¨é€åˆ°æµä¸­</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">current</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ²¡æœ‰æ›´å¤šæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> max</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> numberStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> NumberStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">max</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">numberStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;data&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">numberStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;end&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;No more numbers.&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ª <code>NumberStream</code> ç±»ï¼Œå®ƒç”Ÿæˆä» 1 åˆ°æŒ‡å®šæœ€å¤§å€¼çš„æ•°å­—åºåˆ—ã€‚é€šè¿‡ç›‘å¬ <code>data</code> å’Œ <code>end</code> äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•°å­—çš„è¾“å‡ºå’Œåºåˆ—ç»“æŸçš„æç¤ºã€‚</p><h4 id="_2-åˆ›å»ºè‡ªå®šä¹‰çš„å¯å†™æµ" tabindex="-1"><a class="header-anchor" href="#_2-åˆ›å»ºè‡ªå®šä¹‰çš„å¯å†™æµ"><span>2. åˆ›å»ºè‡ªå®šä¹‰çš„å¯å†™æµ</span></a></h4><p>è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªå°†æ¥æ”¶åˆ°çš„æ•°æ®å†™å…¥æ–‡ä»¶çš„å¯å†™æµä¾‹å­ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> FileWriterStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">filename</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filename</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> filename</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">appendFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filename</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fileWriter</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> FileWriterStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fileWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fileWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fileWriter</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Data has been written.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œï¼Œ<code>FileWriterStream</code> ç±»æ¥æ”¶ä¸€ä¸ªæ–‡ä»¶åå¹¶åˆ©ç”¨ <code>fs.appendFile</code> æ–¹æ³•å°†æ¥æ”¶åˆ°çš„æ•°æ®å—è¿½åŠ åˆ°æ–‡ä»¶ä¸­ã€‚é€šè¿‡ <code>write</code> æ–¹æ³•å‘é€æ•°æ®åˆ°æµï¼Œç„¶åè°ƒç”¨ <code>end</code> æ–¹æ³•ä»¥è¡¨ç¤ºå®Œæˆã€‚</p><h3 id="æ€»ç»“-28" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-28"><span>æ€»ç»“</span></a></h3><p>é€šè¿‡æä¾›çš„ç¤ºä¾‹ï¼Œä½ åº”è¯¥èƒ½å¤Ÿç†è§£ Node.js ä¸­æµçš„åŸºæœ¬æ¦‚å¿µä»¥åŠå¦‚ä½•å¼€å§‹å®ç°è‡ªå·±çš„æµã€‚è®°ä½ï¼Œæµæ˜¯å¤„ç†å¤§é‡æ•°æ®çš„å¼ºå¤§å·¥å…·ï¼Œå°¤å…¶æ˜¯å½“ä½ ä¸å¸Œæœ›ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®è¿›å†…å­˜æ—¶ã€‚</p><h3 id="simplified-construction" tabindex="-1"><a class="header-anchor" href="#simplified-construction"><span><a href="https://nodejs.org/docs/latest/api/stream.html#simplified-construction" target="_blank" rel="noopener noreferrer">Simplified construction</a></span></a></h3><p>Node.js ä¸­çš„ Streamï¼ˆæµï¼‰æ˜¯å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«é€‚ç”¨äºå¤„ç†å¤§é‡æ•°æ®æˆ–è€…ä½ ä¸å¸Œæœ›ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­çš„æƒ…å†µã€‚åœ¨ Node.js v21.7.1 ä¸­ï¼Œå®ƒä»¬å¼•å…¥äº†ä¸€ä¸ªç®€åŒ–çš„æ„é€ å‡½æ•°æ–¹æ³•ï¼Œè®©åˆ›å»ºå’Œä½¿ç”¨æµå˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p><p>ä¼ ç»Ÿä¸Šï¼Œå¦‚æœä½ æƒ³åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„æµï¼Œä½ éœ€è¦ç»§æ‰¿ Node.js å†…ç½®çš„ <code>Stream</code> ç±»ï¼Œå¹¶ä¸”å®ç°ä¸€äº›ç‰¹å®šçš„æ–¹æ³•ï¼Œæ¯”å¦‚ <code>_read</code> æˆ– <code>_write</code>ï¼Œè¿™æ ·çš„è¿‡ç¨‹å¯¹äºæ–°æ‰‹æ¥è¯´å¯èƒ½æœ‰ç‚¹å¤æ‚ã€‚ä½†æ˜¯åœ¨ Node.js v21.7.1 ä¸­ï¼Œé€šè¿‡ç®€åŒ–æ„é€ çš„æ–¹å¼ï¼Œä½ åªéœ€è¦æä¾›ä¸€ä¸ªé€‰é¡¹å¯¹è±¡ï¼Œå°±å¯ä»¥åˆ›å»ºæµï¼Œè€Œä¸å¿…æ‹…å¿ƒç»§æ‰¿å’Œå®ç°è¿™äº›åº•å±‚æ–¹æ³•ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-4" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-4"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨ï¼Œè¿™ä¸ªåº”ç”¨éœ€è¦è¯»å–ä¸€ä¸ªéå¸¸å¤§çš„æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶ä¸”æ‰¾å‡ºé‡Œé¢åŒ…å«ç‰¹å®šé”™è¯¯ä¿¡æ¯çš„è¡Œã€‚ä½¿ç”¨ç®€åŒ–æ„é€ çš„æ–¹å¼ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥å¤„ç†è¿™ä¸ªä»»åŠ¡ã€‚</p><h4 id="åˆ›å»ºä¸€ä¸ªç®€å•çš„å¯è¯»æµ" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ªç®€å•çš„å¯è¯»æµ"><span>åˆ›å»ºä¸€ä¸ªç®€å•çš„å¯è¯»æµ</span></a></h4><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä»¥ç®€åŒ–çš„æ–¹å¼åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myReadableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // read æ–¹æ³•æ˜¯å½“æµæƒ³è¦è·å–æ›´å¤šæ•°æ®æ—¶è¢«è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;some data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘æµä¸­æ¨é€æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å½“æ²¡æœ‰æ›´å¤šæ•°æ®æ—¶ï¼Œæ¨é€ null æ¥å…³é—­æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myReadableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myReadableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;There is no more data.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>new Readable(...)</code> ä½¿ç”¨äº†ç®€åŒ–çš„æ„é€ æ–¹å¼æ¥åˆ›å»ºä¸€ä¸ªå¯è¯»æµã€‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>read</code> å‡½æ•°ï¼Œå®ƒä¼šè¢«è‡ªåŠ¨è°ƒç”¨æ¥å¡«å……æµä¸­çš„æ•°æ®ã€‚è¿™ä¸ªä¾‹å­åªæ˜¯ä¸ºäº†æ¼”ç¤ºå¦‚ä½•åˆ›å»ºæµï¼Œå¹¶ä¸æ–­å‘å…¶ä¸­æ·»åŠ æ•°æ®ç›´åˆ°æ²¡æœ‰æ›´å¤šæ•°æ®ï¼Œå³é€šè¿‡ <code>this.push(null);</code> è¡¨ç¤ºæ•°æ®ç»“æŸã€‚</p><h4 id="åˆ›å»ºä¸€ä¸ªç®€å•çš„å¯å†™æµ" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ªç®€å•çš„å¯å†™æµ"><span>åˆ›å»ºä¸€ä¸ªç®€å•çš„å¯å†™æµ</span></a></h4><p>å¦‚æœä½ æƒ³å¤„ç†è¾“å‡ºæ•°æ®ï¼Œä¾‹å¦‚å°†ç‰¹å®šçš„æ—¥å¿—ä¿¡æ¯å†™å…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯å†™æµï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myWritableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // write æ–¹æ³•ç”¨äºå¤„ç†å†™å…¥æ•°æ®çš„é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Writing: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myWritableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Finished writing.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myWritableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è°ƒç”¨ end è¡¨ç¤ºæ²¡æœ‰æ›´å¤šçš„æ•°æ®è¦è¢«å†™å…¥</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„å¯å†™æµï¼Œå®ƒä¼šæŠŠæ¥æ”¶åˆ°çš„æ•°æ®æ‰“å°å‡ºæ¥ã€‚é€šè¿‡ç®€åŒ–çš„æ„å»ºå‡½æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦æä¾› <code>write</code> æ–¹æ³•ï¼Œå°±èƒ½å¤Ÿå®šä¹‰å¦‚ä½•å¤„ç†æ¯ä¸€å—å†™å…¥çš„æ•°æ®ã€‚</p><h3 id="æ€»ç»“-29" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-29"><span>æ€»ç»“</span></a></h3><p>ç®€åŒ–æ„é€ çš„å¼•å…¥ï¼Œæå¤§åœ°é™ä½äº†åˆ›å»ºå’Œä½¿ç”¨ Node.js æµçš„é—¨æ§›ã€‚ä½ ä¸å†éœ€è¦æ·±å…¥ç†è§£å’Œç»§æ‰¿å¤æ‚çš„ç±»ç»“æ„ï¼Œåªéœ€æä¾›å‡ ä¸ªåŸºæœ¬çš„å¤„ç†å‡½æ•°ï¼Œå°±å¯ä»¥è½»æ¾åœ°åˆ›å»ºå‡ºåŠŸèƒ½å¼ºå¤§çš„æµæ¥å¤„ç†å„ç§æ•°æ®ã€‚è¿™å¯¹äºå¤„ç†å¤§è§„æ¨¡æ•°æ®æˆ–è€…éœ€è¦é«˜æ•ˆç‡æ•°æ®ä¼ è¾“çš„åº”ç”¨å°¤å…¶æœ‰ç›Šã€‚</p><h3 id="implementing-a-writable-stream" tabindex="-1"><a class="header-anchor" href="#implementing-a-writable-stream"><span><a href="https://nodejs.org/docs/latest/api/stream.html#implementing-a-writable-stream" target="_blank" rel="noopener noreferrer">Implementing a writable stream</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„æµï¼ˆStreamï¼‰ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯ä¸€ç§å¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œè¿™äº›æ•°æ®å¯ä»¥æ˜¯è¯»å–çš„ï¼Œæ¯”å¦‚ä»æ–‡ä»¶ä¸­è¯»å–ï¼Œæˆ–è€…å†™å…¥çš„ï¼Œæ¯”å¦‚å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚æµå¯ä»¥è®©æˆ‘ä»¬ä»¥éå¸¸é«˜æ•ˆçš„æ–¹å¼å¤„ç†å¤§é‡æ•°æ®ï¼Œå› ä¸ºå®ƒä»¬å…è®¸æ•°æ®åˆ†ç‰‡å¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªæ•°æ®é›†è¿›å†…å­˜ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæœ‰å‡ ç§ç±»å‹çš„æµï¼Œä½†ç°åœ¨æˆ‘ä»¬èšç„¦åœ¨<strong>å¯å†™æµ</strong>ï¼ˆWritable Streamï¼‰ä¸Šã€‚ä¸€ä¸ªå¯å†™æµå…è®¸ä½ å¾€æŸå¤„å†™æ•°æ®ï¼Œè¿™ä¸ªâ€œæŸå¤„â€å¯ä»¥æ˜¯æ–‡ä»¶ã€HTTP å“åº”ä½“ã€ç”šè‡³æ˜¯æ§åˆ¶å°ï¼ˆconsoleï¼‰ç­‰ã€‚</p><p>è¦å®ç°ä¸€ä¸ªå¯å†™æµï¼Œæˆ‘ä»¬éœ€è¦ç»§æ‰¿è‡ª Node.js æ ¸å¿ƒæ¨¡å—<code>stream</code>æä¾›çš„<code>Writable</code>ç±»ï¼Œå¹¶ä¸”å®ç°å…¶ä¸­çš„<code>_write()</code>æ–¹æ³•ã€‚</p><p>ä¸‹é¢æ˜¯å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„å¯å†™æµçš„æ­¥éª¤ï¼š</p><h3 id="_1-å¼•å…¥å¿…è¦çš„æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#_1-å¼•å…¥å¿…è¦çš„æ¨¡å—"><span>1. å¼•å…¥å¿…è¦çš„æ¨¡å—</span></a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥<code>stream</code>æ¨¡å—ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-åˆ›å»ºå¯å†™æµçš„ç±»" tabindex="-1"><a class="header-anchor" href="#_2-åˆ›å»ºå¯å†™æµçš„ç±»"><span>2. åˆ›å»ºå¯å†™æµçš„ç±»</span></a></h3><p>ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç±»ï¼Œç»§æ‰¿è‡ª<code>Writable</code>ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> MyWritable</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¤„ç†å†™å…¥æ•°æ®çš„é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†æ¥æ”¶åˆ°çš„æ•°æ®ç‰‡æ®µè½¬æ¢æˆå­—ç¬¦ä¸²å¹¶æ‰“å°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å†™å…¥å®Œæˆåè°ƒç”¨å›è°ƒï¼Œè¡¨ç¤ºå‡†å¤‡å¥½å†™å…¥ä¸‹ä¸€ä¸ªæ•°æ®ç‰‡æ®µ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-ä½¿ç”¨è‡ªå®šä¹‰çš„å¯å†™æµ" tabindex="-1"><a class="header-anchor" href="#_3-ä½¿ç”¨è‡ªå®šä¹‰çš„å¯å†™æµ"><span>3. ä½¿ç”¨è‡ªå®šä¹‰çš„å¯å†™æµ</span></a></h3><p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºè¯¥å¯å†™æµçš„å®ä¾‹ï¼Œå¹¶ä½¿ç”¨å®ƒã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myWritable</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MyWritable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myWritable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello, &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å†™å…¥å­—ç¬¦ä¸² &#39;hello, &#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myWritable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç´§æ¥ç€å†™å…¥ &#39;world!&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myWritable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¡¨ç¤ºæ²¡æœ‰æ›´å¤šçš„æ•°æ®è¦è¢«å†™å…¥</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…åº”ç”¨ä¾‹å­-5" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-5"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ªæ—¥å¿—ç³»ç»Ÿï¼Œéœ€è¦å°†æ—¥å¿—ä¿¡æ¯å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šè¿°æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªå¯å†™æµï¼Œä¸“é—¨ç”¨äºå¤„ç†æ—¥å¿—å†™å…¥ã€‚</p><p>å¦ä¸€ä¸ªä¾‹å­å¯èƒ½æ˜¯ä¸€ä¸ªç½‘ç»œåº”ç”¨ï¼Œæ¥æ”¶å®¢æˆ·ç«¯ä¸Šä¼ çš„å¤§æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯å†™æµå°†æ¥æ”¶åˆ°çš„æ•°æ®ç‰‡æ®µå®æ—¶å†™å…¥ç£ç›˜ï¼Œè€Œä¸æ˜¯ç­‰å¾…æ•´ä¸ªæ–‡ä»¶ä¸Šä¼ å®Œæˆã€‚</p><h3 id="æ€»ç»“-30" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-30"><span>æ€»ç»“</span></a></h3><p>é€šè¿‡å®ç°<code>_write()</code>æ–¹æ³•ï¼Œåœ¨ Node.js ä¸­åˆ›å»ºè‡ªå®šä¹‰çš„å¯å†™æµè®©æˆ‘ä»¬èƒ½å¤Ÿä»¥æµå¼çš„æ–¹å¼å¤„ç†æ•°æ®å†™å…¥ã€‚è¿™æ ·ä¸ä»…æé«˜äº†åº”ç”¨ç¨‹åºå¤„ç†å¤§è§„æ¨¡æ•°æ®çš„èƒ½åŠ›ï¼ŒåŒæ—¶ä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†é«˜åº¦çš„çµæ´»æ€§å»ä¼˜åŒ–å’Œå®šåˆ¶æ•°æ®å†™å…¥è¿‡ç¨‹ã€‚</p><h4 id="new-stream-writable-options" tabindex="-1"><a class="header-anchor" href="#new-stream-writable-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#new-streamwritableoptions" target="_blank" rel="noopener noreferrer">new stream.Writable([options])</a></span></a></h4><p>Node.js ä¸­çš„ <code>stream</code> æ¨¡å—åŒ…å«äº†ä¸€å¥—æ„å»ºæ•°æ®æµæ“ä½œçš„åŸºç¡€ APIã€‚è¿™äº› API ä½¿å¾—å¤„ç†å¤§é‡æ•°æ®ï¼ˆæ¯”å¦‚ä»ä¸€ä¸ªæ–‡ä»¶ä¸­è¯»å–ï¼Œæˆ–æ˜¯ç½‘ç»œè¯·æ±‚ï¼‰å˜å¾—æ›´åŠ é«˜æ•ˆï¼Œå› ä¸ºå®ƒä»¬ä¸è¦æ±‚ä½ å°†æ‰€æœ‰æ•°æ®ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ç›¸åï¼Œæ•°æ®è¢«åˆ†æˆå°å—ï¼ˆchunksï¼‰ï¼Œç„¶åé€ä¸€å¤„ç†ï¼Œè¿™ç§æ–¹å¼å¤§å¤§å‡å°‘äº†å†…å­˜çš„ä½¿ç”¨ï¼Œå¹¶æé«˜äº†åº”ç”¨ç¨‹åºçš„å“åº”èƒ½åŠ›ã€‚</p><p>åœ¨è¿™ä¸ªæ¡†æ¶ä¸‹ï¼Œ<code>stream.Writable</code> æ˜¯ä¸€ä¸ªé‡è¦çš„å¯¹è±¡ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ª&quot;å¯å†™æµ&quot;ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯ä»¥æ¥æ”¶æ•°æ®å¹¶å†™å…¥ç›®æ ‡çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ–‡ä»¶ã€HTTP å“åº”ä½“ã€æˆ–è€…æ˜¯æ ‡å‡†è¾“å‡ºï¼ˆå‘½ä»¤è¡Œç»ˆç«¯ï¼‰ã€‚åˆ›å»ºä¸€ä¸ª <code>Writable</code> æµé€šå¸¸æ˜¯ä¸ºäº†å°†æ•°æ®å†™å…¥æŸå¤„ã€‚</p><h3 id="åˆ›å»º-writable-æµçš„é€‰é¡¹" tabindex="-1"><a class="header-anchor" href="#åˆ›å»º-writable-æµçš„é€‰é¡¹"><span>åˆ›å»º writable æµçš„é€‰é¡¹</span></a></h3><p>å½“ä½ ä½¿ç”¨ <code>new stream.Writable([options])</code> æ¥åˆ›å»ºä¸€ä¸ªå¯å†™æµæ—¶ï¼Œä½ å¯ä»¥é€šè¿‡ <code>options</code> å‚æ•°æ¥é…ç½®è¿™ä¸ªæµçš„è¡Œä¸ºã€‚è¿™é‡Œæœ‰å‡ ä¸ªé‡è¦çš„é€‰é¡¹ï¼š</p><ul><li><code>highWaterMark</code>: æ§åˆ¶å†…éƒ¨ç¼“å†²åŒºå¤§å°çš„é˜ˆå€¼ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚å½“ç¼“å†²åŒºçš„æ•°æ®é‡è¾¾åˆ°æˆ–è¶…è¿‡è¿™ä¸ªå€¼æ—¶ï¼Œæµä¼šè§†ä¸ºâ€œæ»¡â€çš„ï¼Œå¹¶ä¸”å°è¯•å†™å…¥å°†è¿”å› falseã€‚</li><li><code>decodeStrings</code>: é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å€¼ä¸º<code>true</code>ï¼Œæ„å‘³ç€æ‰€æœ‰å†™å…¥æµçš„å­—ç¬¦ä¸²å°†è¢«è½¬æ¢ä¸º Buffer å¯¹è±¡ã€‚è¿™æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„ç»Ÿä¸€æ€§å’Œå‡å°‘æ½œåœ¨çš„ç¼–ç é—®é¢˜ã€‚</li><li><code>objectMode</code>: å½“è®¾ç½®ä¸º<code>true</code>æ—¶ï¼Œæµçš„è¡Œä¸ºä¼šç¨å¾®ä¸åŒï¼Œå…è®¸ä»»ä½• JavaScript å¯¹è±¡ä½œä¸ºç‰‡æ®µä¼ é€’ï¼Œè€Œä¸ä»…ä»…æ˜¯å­—ç¬¦ä¸²æˆ– Buffer å¯¹è±¡ã€‚</li><li><code>write()</code>: ä¸€ä¸ªå‡½æ•°ï¼Œå½“æ•°æ®å—éœ€è¦è¢«å†™å…¥ç›®æ ‡æ—¶è°ƒç”¨ã€‚è¿™æ˜¯å®ç°è‡ªå®šä¹‰å¯å†™æµæ—¶å¿…é¡»æä¾›çš„ã€‚</li><li><code>writev()</code>: ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºä¼˜åŒ–å¤šä¸ªæ•°æ®å—åŒæ—¶å†™å…¥çš„åœºæ™¯ã€‚</li><li><code>final()</code>: åœ¨æµç»“æŸæ—¶è°ƒç”¨çš„å‡½æ•°ï¼Œç”¨äºæ‰§è¡Œæ¸…ç†å·¥ä½œã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-17" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-17"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-å†™å…¥æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-å†™å…¥æ–‡ä»¶"><span>ç¤ºä¾‹ 1ï¼šå†™å…¥æ–‡ä»¶</span></a></h4><p>å‡è®¾ä½ æƒ³æŠŠä¸€ç³»åˆ—æ¶ˆæ¯å†™å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯å†™æµæŒ‡å‘è¿™ä¸ªæ–‡ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ ‡è®°æ–‡ä»¶æœ«å°¾ï¼Œç¡®ä¿æµç»“æŸ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨äº†<code>fs.createWriteStream()</code>æ–¹æ³•ï¼ˆå®ƒå†…éƒ¨ä½¿ç”¨äº†<code>new stream.Writable([options])</code>ï¼‰æ¥åˆ›å»ºä¸€ä¸ªæŒ‡å‘<code>output.txt</code>æ–‡ä»¶çš„å¯å†™æµï¼Œç„¶åå†™å…¥ä¸¤æ¬¡æ•°æ®ã€‚æœ€åï¼Œè°ƒç”¨<code>.end()</code>æ–¹æ³•æ¥ç»“æŸæµï¼Œå¹¶å…³é—­æ–‡ä»¶ã€‚</p><h4 id="ç¤ºä¾‹-2-è‡ªå®šä¹‰å¯å†™æµ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-è‡ªå®šä¹‰å¯å†™æµ"><span>ç¤ºä¾‹ 2ï¼šè‡ªå®šä¹‰å¯å†™æµ</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨æ„å»ºä¸€ä¸ªæ—¥å¿—ç³»ç»Ÿï¼Œä½ å¸Œæœ›æ¯æ¬¡è°ƒç”¨<code>log()</code>æ–¹æ³•éƒ½ä¼šå°†ä¿¡æ¯å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œä½†åŒæ—¶ä¹Ÿåœ¨æ§åˆ¶å°æ‰“å°å‡ºæ¥ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> CustomLogger</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">logFile</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;app.log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> message</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">logFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> logger</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> CustomLogger</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">logger</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;This is a log message.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">logger</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®°å¾—ç»“æŸæµï¼Œä»¥ä¾¿æ–‡ä»¶èƒ½æ­£ç¡®å…³é—­</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç»§æ‰¿è‡ª<code>Writable</code>çš„<code>CustomLogger</code>ç±»ã€‚é€šè¿‡è¦†ç›–<code>_write()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå°†æ¥æ”¶åˆ°çš„æ•°æ®æ—¢å†™å…¥æ–‡ä»¶åˆè¾“å‡ºåˆ°æ§åˆ¶å°ã€‚è¿™å±•ç¤ºäº†å¯å†™æµåœ¨è‡ªå®šä¹‰æ•°æ®å¤„ç†é€»è¾‘ä¸­çš„å¼ºå¤§èƒ½åŠ›ã€‚</p><h4 id="writable-construct-callback" tabindex="-1"><a class="header-anchor" href="#writable-construct-callback"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writable_constructcallback" target="_blank" rel="noopener noreferrer">writable._construct(callback)</a></span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œ<code>writable._construct(callback)</code> æ˜¯æµï¼ˆStreamï¼‰API çš„ä¸€éƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯ä¸å¯å†™æµï¼ˆWritable streamsï¼‰ç›¸å…³ã€‚è¦ç†è§£è¿™ä¸ªæ–¹æ³•ï¼Œé¦–å…ˆå¾—äº†è§£ Node.js ä¸­çš„æµå’Œå®ƒä»¬çš„ç”¨å¤„ã€‚</p><h3 id="æµ-streams-ç®€ä»‹-8" tabindex="-1"><a class="header-anchor" href="#æµ-streams-ç®€ä»‹-8"><span>æµï¼ˆStreamsï¼‰ç®€ä»‹</span></a></h3><p>æµæ˜¯ä¸€ç§å¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œå…è®¸ä½ ä»¥è¿ç»­çš„æ–¹å¼è¯»å–æˆ–å†™å…¥æ•°æ®ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ•°æ®å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™åœ¨å¤„ç†å¤§æ–‡ä»¶æˆ–å®æ—¶æ•°æ®ï¼ˆå¦‚è§†é¢‘æ’­æ”¾ï¼‰æ—¶éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºä½ å¯ä»¥è¾¹è¯»å–è¾¹å¤„ç†æ•°æ®ï¼Œæé«˜æ•ˆç‡å’Œæ€§èƒ½ã€‚</p><p>Node.js ä¸­æœ‰å››ç§åŸºæœ¬ç±»å‹çš„æµï¼š</p><ol><li><strong>å¯è¯»æµ</strong>ï¼ˆReadableï¼‰ï¼šç”¨äºè¯»å–æ•°æ®ã€‚</li><li><strong>å¯å†™æµ</strong>ï¼ˆWritableï¼‰ï¼šç”¨äºå†™å…¥æ•°æ®ã€‚</li><li><strong>åŒå·¥æµ</strong>ï¼ˆDuplexï¼‰ï¼šæ—¢å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™ã€‚</li><li><strong>è½¬æ¢æµ</strong>ï¼ˆTransformï¼‰ï¼šä¸€ç§åŒå·¥æµï¼Œå¯ä»¥åœ¨è¯»å†™è¿‡ç¨‹ä¸­ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®ã€‚</li></ol><h3 id="writable-construct-callback-1" tabindex="-1"><a class="header-anchor" href="#writable-construct-callback-1"><span><code>writable._construct(callback)</code></span></a></h3><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬ä¸­ï¼Œ<code>writable._construct(callback)</code> æ–¹æ³•æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºåˆå§‹åŒ–å¯å†™æµå¯¹è±¡çš„é’©å­ï¼ˆhookï¼‰ã€‚å®ƒæ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œå…è®¸ä½ åœ¨æµå¼€å§‹æ¥æ”¶æ•°æ®ä¹‹å‰è¿›è¡Œå¿…è¦çš„è®¾ç½®æˆ–å‡†å¤‡å·¥ä½œã€‚</p><p>è¿™ä¸ªæ–¹æ³•é€šå¸¸åœ¨è‡ªå®šä¹‰å¯å†™æµæ—¶è¢«è¦†å†™ï¼ˆoverrideï¼‰ï¼Œç»™äºˆå¼€å‘è€…ä¸€ä¸ªæœºä¼šï¼Œåœ¨æµæ­£å¼å˜æˆå¯å†™çŠ¶æ€ä¹‹å‰æ‰§è¡Œä¸€äº›å¼‚æ­¥æ“ä½œï¼ˆä¾‹å¦‚æ‰“å¼€æ–‡ä»¶ã€å»ºç«‹æ•°æ®åº“è¿æ¥ç­‰ï¼‰ã€‚</p><h4 id="å‚æ•°-9" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-9"><span>å‚æ•°</span></a></h4><ul><li><code>callback</code>ï¼šä¸€ä¸ªå‡½æ•°ï¼Œä½ éœ€è¦åœ¨ä½ çš„å¼‚æ­¥å‡†å¤‡å·¥ä½œå®Œæˆåè°ƒç”¨å®ƒã€‚å¦‚æœåˆå§‹åŒ–æˆåŠŸï¼Œä½ è°ƒç”¨ <code>callback()</code> ä¸ä¼ é€’ä»»ä½•å‚æ•°ï¼›å¦‚æœå‡ºé”™ï¼Œä½ ä¼ é€’ä¸€ä¸ªé”™è¯¯å¯¹è±¡ <code>callback(err)</code>ã€‚</li></ul><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹-18" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-18"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨ï¼Œéœ€è¦å°†æ•°æ®å†™å…¥åˆ°æŸä¸ªæ–‡ä»¶ä¸­ã€‚ä½†æ˜¯ï¼Œä½ å¸Œæœ›åœ¨æ•°æ®å†™å…¥å‰ç¡®ä¿è¯¥æ–‡ä»¶å­˜åœ¨ä¸”å¯å†™ã€‚</p><ol><li><strong>åˆ›å»ºè‡ªå®šä¹‰å¯å†™æµ</strong></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> CustomWritableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _construct</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å‡è®¾æˆ‘ä»¬æƒ³ç¡®ä¿ç›®æ ‡æ–‡ä»¶å¤¹å­˜åœ¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dirPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">__dirname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dirPath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">recursive</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆå§‹åŒ–å¤±è´¥ï¼Œä¼ é€’é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filePath</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> path</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dirPath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®æ–‡ä»¶è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æˆåŠŸåˆå§‹åŒ–ï¼Œæ— é”™è¯¯ä¼ é€’</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å®ç°å†™å…¥é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">flag</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>ä½¿ç”¨è‡ªå®šä¹‰å¯å†™æµ</strong></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> CustomWritableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Failed to write:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Write successful!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€šè¿‡è¦†å†™ <code>_construct(callback)</code> æ–¹æ³•ï¼Œæˆ‘ä»¬ç¡®ä¿äº†åœ¨æ•°æ®å†™å…¥æ“ä½œå¼€å§‹å‰ï¼Œç›®æ ‡æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹å·²ç»è¢«åˆ›å»ºã€‚è¿™æ ·çš„è®¾è®¡ä½¿å¾—æ•´ä¸ªå†™å…¥æµç¨‹æ›´åŠ å¥å£®å’Œå¯é ã€‚</p><h4 id="writable-write-chunk-encoding-callback-1" tabindex="-1"><a class="header-anchor" href="#writable-write-chunk-encoding-callback-1"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writable_writechunk-encoding-callback" target="_blank" rel="noopener noreferrer">writable._write(chunk, encoding, callback)</a></span></a></h4><p>å½“ä½ å¼€å§‹å­¦ä¹  Node.jsï¼Œä½ ä¼šå‘ç°å®ƒéå¸¸æ“…é•¿å¤„ç†ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶æ“ä½œç­‰ IOï¼ˆè¾“å…¥/è¾“å‡ºï¼‰ä»»åŠ¡ã€‚è¿™äº›æ“ä½œå¾€å¾€æ¶‰åŠæ•°æ®çš„æµåŠ¨â€”â€”ä»ä¸€ä¸ªæ¥æºåˆ°å¦ä¸€ä¸ªç›®çš„åœ°ã€‚åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§æŠ½è±¡çš„æ¥å£ï¼Œè¢«è®¾è®¡ä¸ºå¤„ç†æ•°æ®çš„è¯»å–æˆ–å†™å…¥ä»¥ä¸€ç§é«˜æ•ˆçš„æ–¹å¼ã€‚å…¶ä¸­ï¼Œå¯å†™æµï¼ˆWritable Streamsï¼‰å°±æ˜¯ä¸€ç§å…è®¸ä½ å‘ç›®çš„åœ°å†™å…¥æ•°æ®çš„æµã€‚</p><p><strong><code>writable._write(chunk, encoding, callback)</code>æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p>åœ¨ Node.js ä¸­ï¼Œ<code>writable._write(chunk, encoding, callback)</code>æ˜¯ä¸€ä¸ªåº•å±‚çš„æ–¹æ³•ï¼Œç”¨äºå®é™…ä¸Šå°†æ•°æ®å—ï¼ˆchunkï¼‰å†™å…¥ç›®æ ‡èµ„æºã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ç”±å¼€å‘è€…å®šä¹‰çš„ï¼Œå½“æµå°è¯•å†™å…¥æ•°æ®æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¢«å†…éƒ¨è‡ªåŠ¨è°ƒç”¨ã€‚å®ƒæ˜¯<code>Writable</code>æµç±»çš„ä¸€éƒ¨åˆ†ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œä½ ä¸éœ€è¦ç›´æ¥è°ƒç”¨å®ƒï¼Œè€Œæ˜¯é€šè¿‡ç»§æ‰¿<code>Writable</code>æµå¹¶å®ç°è¿™ä¸ªæ–¹æ³•æ¥åˆ›å»ºè‡ªå®šä¹‰çš„å¯å†™æµã€‚</p><ul><li><strong>chunk</strong>: è¿™æ˜¯è¦å†™å…¥çš„æ•°æ®å—ã€‚å®ƒå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€… Bufferï¼ˆNode.js ä¸­ç”¨äºå¤„ç†äºŒè¿›åˆ¶æ•°æ®çš„ç±»ï¼‰ã€‚</li><li><strong>encoding</strong>: å¦‚æœ chunk æ˜¯å­—ç¬¦ä¸²ï¼Œè¿™æŒ‡æ˜äº†å­—ç¬¦ä¸²çš„ç¼–ç æ–¹å¼ï¼ˆå¦‚&#39;utf8&#39;, &#39;ascii&#39;ç­‰ï¼‰ã€‚</li><li><strong>callback</strong>: å½“å†™å…¥æ“ä½œå®Œæˆæˆ–é‡åˆ°é”™è¯¯æ—¶ï¼Œè¿™ä¸ªå‡½æ•°è¢«è°ƒç”¨ã€‚è¿™æ˜¯ç¡®ä¿æµçš„é¡ºåˆ©æ“ä½œçš„å…³é”®æœºåˆ¶ï¼Œå› ä¸ºå®ƒæä¾›äº†å¼‚æ­¥å¤„ç†é”™è¯¯å’ŒæˆåŠŸçš„èƒ½åŠ›ã€‚</li></ul><p><strong>å®é™…è¿ç”¨ä¾‹å­ï¼š</strong></p><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªæ—¥å¿—ç³»ç»Ÿï¼Œéœ€è¦å°†æ—¥å¿—ä¿¡æ¯å†™å…¥æ–‡ä»¶ç³»ç»Ÿã€‚ä½ å¯èƒ½å¸Œæœ›åˆ›å»ºä¸€ä¸ªå®šåˆ¶çš„å¯å†™æµï¼Œä½¿å¾—æ¯æ¬¡è°ƒç”¨<code>write()</code>æ–¹æ³•æ—¶ï¼Œéƒ½èƒ½æŒ‰ç…§ç‰¹å®šçš„æ ¼å¼è¿½åŠ æ—¥å¿—åˆ°æ–‡ä»¶ä¸­ã€‚</p><p>é¦–å…ˆï¼Œä½ éœ€è¦å¼•å…¥å¿…è¦çš„ Node.js æ¨¡å—ï¼Œå¹¶ç»§æ‰¿<code>Writable</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> LogStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åˆå§‹åŒ–ä»£ç ï¼Œæ¯”å¦‚æ‰“å¼€æ–‡ä»¶æµç­‰</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">logFile</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;log.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> logEntry</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `[</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toISOString</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">] - </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å°†æ ¼å¼åŒ–åçš„æ—¥å¿—ä¿¡æ¯å†™å…¥æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">logFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">logEntry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º<code>LogStream</code>çš„ç±»ï¼Œå®ƒç»§æ‰¿äº†<code>Writable</code>ã€‚æˆ‘ä»¬é‡å†™äº†<code>_write</code>æ–¹æ³•ï¼Œä»¥ä¾¿æ¯æ¬¡è°ƒç”¨<code>write()</code>æ–¹æ³•æ—¶ï¼Œéƒ½èƒ½å°†å¸¦æœ‰æ—¶é—´æˆ³çš„æ—¥å¿—ä¿¡æ¯è¿½åŠ åˆ°<code>log.txt</code>æ–‡ä»¶ä¸­ã€‚</p><p>ä½¿ç”¨è¿™ä¸ªè‡ªå®šä¹‰çš„æµå°±åƒè¿™æ ·ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myLogger</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> LogStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myLogger</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯ä¸€æ¡æ—¥å¿—ä¿¡æ¯&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯æ¬¡è°ƒç”¨<code>myLogger.write()</code>æ—¶ï¼Œ<code>_write</code>æ–¹æ³•éƒ½ä¼šè¢«è§¦å‘ï¼Œå°†ä¼ å…¥çš„å­—ç¬¦ä¸²è¿åŒæ—¶é—´æˆ³ä¸€èµ·å†™å…¥<code>log.txt</code>æ–‡ä»¶ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥åˆ©ç”¨ Node.js ä¸­æµçš„å¼ºå¤§åŠŸèƒ½å’Œçµæ´»æ€§ï¼Œä¸ºä½ çš„åº”ç”¨ç¨‹åºæ„å»ºé«˜æ•ˆä¸”å®šåˆ¶åŒ–çš„æ•°æ®å¤„ç†ç®¡é“ã€‚</p><h4 id="writable-writev-chunks-callback" tabindex="-1"><a class="header-anchor" href="#writable-writev-chunks-callback"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writable_writevchunks-callback" target="_blank" rel="noopener noreferrer">writable._writev(chunks, callback)</a></span></a></h4><p>ç†è§£ <code>writable._writev(chunks, callback)</code> æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ Streams å’Œå®ƒçš„ä¸€ä¸ªç‰¹å®šç±»å‹ï¼šWritable Streamsã€‚</p><h3 id="ç®€ä»‹-1" tabindex="-1"><a class="header-anchor" href="#ç®€ä»‹-1"><span>ç®€ä»‹</span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œè®©ä½ èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚Node.js ç”¨äºå¼€å‘éœ€è¦é«˜æ€§èƒ½ I/O æ“ä½œçš„åº”ç”¨ç¨‹åºï¼Œæ¯”å¦‚ web æœåŠ¡å™¨ã€å®æ—¶é€šä¿¡åº”ç”¨ç­‰ã€‚</p><h3 id="streams-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#streams-ç®€ä»‹"><span>Streams ç®€ä»‹</span></a></h3><p>åœ¨ Node.js ä¸­ï¼ŒStreams æ˜¯å¤„ç†è¯»å–æˆ–å†™å…¥æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ I/O æ“ä½œçš„ä¸€ç§æ–¹å¼ã€‚é€šè¿‡ Streamsï¼Œæ•°æ®å¯ä»¥ä»ä¸€ä¸ªåœ°æ–¹ï¼ˆæºå¤´ï¼‰æµå‘å¦ä¸€ä¸ªåœ°æ–¹ï¼ˆç›®çš„åœ°ï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯ä»¥æ˜¯é€å—ï¼ˆchunkï¼‰è¿›è¡Œçš„ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><h3 id="writable-streams-2" tabindex="-1"><a class="header-anchor" href="#writable-streams-2"><span>Writable Streams</span></a></h3><p>Writable Streams æ˜¯ Streams çš„ä¸€ç§ï¼Œä¸“é—¨ç”¨æ¥å†™æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå½“ä½ æƒ³å°†æ•°æ®å†™å…¥æ–‡ä»¶æˆ–å‘é€ç»™å®¢æˆ·ç«¯æ—¶ï¼Œä½ ä¼šä½¿ç”¨ Writable Streamã€‚</p><h3 id="writable-writev-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#writable-writev-æ–¹æ³•"><span>writable._writev() æ–¹æ³•</span></a></h3><p><code>writable._writev(chunks, callback)</code> æ˜¯ Writable Stream å†…éƒ¨æ–¹æ³•çš„ä¸€éƒ¨åˆ†ã€‚è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨äºä¼˜åŒ–å¤šä¸ª chunk æ•°æ®çš„å†™å…¥æ“ä½œã€‚å®ƒå…è®¸ Node.js ä¸€æ¬¡å¤„ç†ï¼ˆå†™å…¥æ“ä½œï¼‰å¤šä¸ª chunkï¼Œè€Œä¸æ˜¯ä¸€æ¬¡åªå¤„ç†ä¸€ä¸ªï¼Œè¿™æœ‰åŠ©äºæé«˜æ•ˆç‡ã€‚</p><h4 id="å‚æ•°-10" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-10"><span>å‚æ•°:</span></a></h4><ul><li><code>chunks</code>: æ˜¯åŒ…å«è¦å†™å…¥çš„ chunks çš„æ•°ç»„ï¼Œæ¯ä¸ª chunk æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…æ‹¬äº†è¦å†™å…¥çš„æ•°æ®å’Œå›è°ƒã€‚</li><li><code>callback</code>: æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“æ‰€æœ‰çš„ chunks éƒ½è¢«å¤„ç†å®Œæ¯•ï¼ˆæ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼‰åè¢«è°ƒç”¨ã€‚</li></ul><h4 id="å®é™…åº”ç”¨ä¾‹å­-6" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-6"><span>å®é™…åº”ç”¨ä¾‹å­:</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦ä»å‡ ä¸ªä¸åŒçš„æ¥æºæ”¶é›†æ•°æ®ï¼Œç„¶åå°†è¿™äº›æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­ã€‚</p><ol><li><p><strong>åˆå¹¶ç½‘ç»œè¯·æ±‚çš„å“åº”</strong>: ä½ å¯èƒ½ä»å‡ ä¸ªä¸åŒçš„ API ç«¯ç‚¹å¹¶è¡Œè¯·æ±‚æ•°æ®ï¼Œæ¯ä¸ªè¯·æ±‚è¿”å›çš„æ•°æ®éƒ½æ˜¯ä¸€ä¸ªæ•°æ®å—ï¼ˆchunkï¼‰ã€‚ä½¿ç”¨ <code>_writev</code> æ–¹æ³•ï¼Œä½ å¯ä»¥æœ‰æ•ˆåœ°å°†è¿™äº›å“åº”åˆå¹¶ï¼Œå¹¶ä¸€æ¬¡æ€§å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œè€Œä¸æ˜¯æ¯æ¥æ”¶åˆ°ä¸€ä¸ªå“åº”å°±å†™å…¥ä¸€æ¬¡ã€‚</p></li><li><p><strong>æ‰¹é‡æ•°æ®åº“è®°å½•å¯¼å‡º</strong>: å¦‚æœä½ çš„åº”ç”¨éœ€è¦ä»æ•°æ®åº“ä¸­è¯»å–å¤§é‡è®°å½•ï¼Œå¹¶å°†å®ƒä»¬å¯¼å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä½ å¯èƒ½ä¼šå°†æ¯æ¡è®°å½•ä½œä¸ºä¸€ä¸ª chunkã€‚ä½¿ç”¨ <code>_writev</code>ï¼Œä½ å¯ä»¥åœ¨å†…å­˜ä¸­ç´¯ç§¯ä¸€æ‰¹è®°å½•ï¼Œç„¶åä¸€æ¬¡æ€§å°†å®ƒä»¬å†™å…¥ç›®æ ‡æ–‡ä»¶ã€‚</p></li></ol><h3 id="æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹"><span>æ³¨æ„äº‹é¡¹</span></a></h3><ul><li><code>writable._writev</code> æ˜¯ä¸€ä¸ªåº•å±‚æ–¹æ³•ï¼Œç›´æ¥åœ¨åº”ç”¨ä¸­ä½¿ç”¨å®ƒå¯èƒ½ä¸å¤ªå¸¸è§ã€‚é€šå¸¸ï¼Œä½ ä¼šä½¿ç”¨æ›´é«˜çº§åˆ«çš„ Stream æ–¹æ³•æ¥å¤„ç†æ•°æ®æµï¼Œä½†äº†è§£å®ƒçš„å·¥ä½œåŸç†å¯¹äºç†è§£ Node.js å¦‚ä½•ä¼˜åŒ– I/O æ“ä½œå¾ˆæœ‰å¸®åŠ©ã€‚</li><li>åœ¨å®ç°è‡ªå®šä¹‰ Writable Stream æ—¶ï¼Œä½ å¯èƒ½ä¼šè¦†ç›– <code>_writev</code> æ–¹æ³•ä»¥æä¾›æ›´é«˜æ•ˆçš„æ‰¹å¤„ç†å†™å…¥èƒ½åŠ›ã€‚</li></ul><p>å¸Œæœ›è¿™è§£é‡Šæœ‰åŠ©äºä½ æ›´å¥½åœ°ç†è§£ <code>writable._writev(chunks, callback)</code> æ–¹æ³•åŠå…¶åœ¨ Node.js ä¸­çš„åº”ç”¨ï¼</p><h4 id="writable-destroy-err-callback" tabindex="-1"><a class="header-anchor" href="#writable-destroy-err-callback"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writable_destroyerr-callback" target="_blank" rel="noopener noreferrer">writable._destroy(err, callback)</a></span></a></h4><p>Node.js ä¸­çš„<code>writable._destroy(err, callback)</code>æ˜¯ä¸€ä¸ªåº•å±‚çš„æ–¹æ³•ï¼Œç”¨äºè‡ªå®šä¹‰æµï¼ˆstreamï¼‰å¯¹è±¡åœ¨è¢«é”€æ¯æ—¶çš„è¡Œä¸ºã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ†æ­¥éª¤ç†è§£è¿™ä¸ªæ¦‚å¿µï¼š</p><h3 id="_1-æµ-stream-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_1-æµ-stream-æ˜¯ä»€ä¹ˆ"><span>1. æµï¼ˆStreamï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§å¤„ç†è¯»å–å’Œå†™å…¥æ•°æ®çš„æ–¹å¼ï¼Œå®ƒå…è®¸ä½ å¤„ç†æ•°æ®ç‰‡æ®µï¼ˆchunkï¼‰ï¼Œè€Œä¸å¿…ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªæ•°æ®åˆ°å†…å­˜ä¸­ã€‚è¿™ä½¿å¾—æµéå¸¸é€‚åˆå¤„ç†å¤§é‡æ•°æ®ï¼Œå¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰åœºæ™¯ã€‚</p><p>æµä¸»è¦æœ‰å››ç§ç±»å‹ï¼š</p><ul><li><strong>Readable</strong>ï¼šç”¨äºè¯»å–æ•°æ®ã€‚</li><li><strong>Writable</strong>ï¼šç”¨äºå†™å…¥æ•°æ®ã€‚</li><li><strong>Duplex</strong>ï¼šæ—¢å¯è¯»åˆå¯å†™ã€‚</li><li><strong>Transform</strong>ï¼šåœ¨è¯»å†™è¿‡ç¨‹ä¸­å¯ä»¥ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®çš„åŒå·¥æµã€‚</li></ul><h3 id="_2-writable-æµ" tabindex="-1"><a class="header-anchor" href="#_2-writable-æµ"><span>2. Writable æµ</span></a></h3><p><code>Writable</code>æµæ˜¯ä¸€ç§ç”¨äºå†™å…¥æ•°æ®çš„æµã€‚æ¯”å¦‚ï¼Œå½“ä½ æƒ³è¦å‘æ–‡ä»¶ä¸­å†™å…¥æ•°æ®æˆ–è€…é€šè¿‡ HTTP å“åº”å‘é€æ•°æ®æ—¶ï¼Œä½ ä¼šä½¿ç”¨åˆ°<code>Writable</code>æµã€‚</p><h3 id="_3-destroyæ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_3-destroyæ–¹æ³•"><span>3. <code>_destroy</code>æ–¹æ³•</span></a></h3><p>ç°åœ¨ï¼Œæ¥èŠèŠ<code>_destroy</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªå†…éƒ¨æ–¹æ³•ï¼Œå®ƒè¢«è®¾è®¡ç”¨æ¥åœ¨æµå¯¹è±¡è¢«é”€æ¯æ—¶æ‰§è¡Œæ¸…ç†å·¥ä½œã€‚å½“æµå› ä¸ºé”™è¯¯æˆ–è€…å…¶ä»–åŸå› éœ€è¦ç»“æŸæ—¶ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><h4 id="å‚æ•°-11" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-11"><span>å‚æ•°ï¼š</span></a></h4><ul><li><code>err</code>: å¯èƒ½å­˜åœ¨çš„é”™è¯¯ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿé”™è¯¯ï¼Œåˆ™ä¸º<code>null</code>ã€‚</li><li><code>callback</code>: å›è°ƒå‡½æ•°ï¼Œåœ¨æ¸…ç†å·¥ä½œå®Œæˆåè°ƒç”¨ã€‚è¿™ä¸ªå›è°ƒå‡½æ•°æ¥å—ä¸€ä¸ªå¯èƒ½çš„é”™è¯¯å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚</li></ul><h4 id="å·¥ä½œåŸç†" tabindex="-1"><a class="header-anchor" href="#å·¥ä½œåŸç†"><span>å·¥ä½œåŸç†ï¼š</span></a></h4><p>å½“æµéœ€è¦ç»“æŸæ—¶ï¼ˆä¾‹å¦‚é‡åˆ°é”™è¯¯ï¼Œæˆ–è€…æ­£å¸¸ç»“æŸï¼‰ï¼Œ<code>_destroy</code>æ–¹æ³•å°†è¢«è°ƒç”¨ã€‚åœ¨è¿™ä¸ªæ–¹æ³•å†…éƒ¨ï¼Œä½ å¯ä»¥è¿›è¡Œæ¸…ç†æ“ä½œï¼Œæ¯”å¦‚å…³é—­æ–‡ä»¶æè¿°ç¬¦ã€é‡Šæ”¾èµ„æºç­‰ã€‚æ¸…ç†å®Œæˆåï¼Œä½ éœ€è¦è°ƒç”¨ä¼ å…¥çš„<code>callback</code>ï¼Œå‘ŠçŸ¥ Node.js æ¸…ç†å·¥ä½œå·²ç»å®Œæˆã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-19" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-19"><span>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„<code>Writable</code>æµï¼Œè¿™ä¸ªæµå°†æ•°æ®å†™å…¥æŸç§ç‰¹æ®Šçš„å­˜å‚¨ç³»ç»Ÿï¼Œå¹¶ä¸”åœ¨å†™å…¥è¿‡ç¨‹ä¸­å¯èƒ½éœ€è¦é‡Šæ”¾èµ„æºæˆ–è€…å…³é—­è¿æ¥ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> MyCustomWritable</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åˆå§‹åŒ–ä½ çš„èµ„æºï¼Œæ¯”å¦‚æ‰“å¼€æ–‡ä»¶æˆ–æ•°æ®åº“è¿æ¥ç­‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¤„ç†å†™å…¥æ•°æ®çš„é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;writing:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è¿™é‡Œè¿›è¡Œæ¸…ç†å·¥ä½œï¼Œæ¯”å¦‚å…³é—­æ–‡ä»¶ï¼Œæ–­å¼€è¿æ¥ç­‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Destroying:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;No error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨è‡ªå®šä¹‰çš„Writableæµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MyCustomWritable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Write completed.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Oops! Something went wrong.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>MyCustomWritable</code>ç»§æ‰¿äº†<code>Writable</code>ç±»ï¼Œå¹¶è¦†ç›–äº†<code>_destroy</code>æ–¹æ³•ã€‚å½“æµè¢«é”€æ¯æ—¶ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯æ‰‹åŠ¨è°ƒç”¨<code>destroy</code>æ–¹æ³•è§¦å‘çš„ï¼‰ï¼Œ<code>_destroy</code>æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œæ‰§è¡Œæ‰€æœ‰å¿…è¦çš„æ¸…ç†æ“ä½œã€‚</p><p>é€šè¿‡è¿™æ ·çš„æœºåˆ¶ï¼ŒNode.js æä¾›äº†é«˜åº¦å¯æ‰©å±•å’Œçµæ´»çš„æ–¹å¼æ¥å¤„ç†æ•°æ®æµï¼ŒåŒæ—¶ç¡®ä¿äº†èµ„æºå¯ä»¥è¢«é€‚å½“åœ°ç®¡ç†å’Œé‡Šæ”¾ã€‚</p><h4 id="writable-final-callback" tabindex="-1"><a class="header-anchor" href="#writable-final-callback"><span><a href="https://nodejs.org/docs/latest/api/stream.html#writable_finalcallback" target="_blank" rel="noopener noreferrer">writable._final(callback)</a></span></a></h4><p>å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ­¥ä¸€æ­¥æ¥ç†è§£è¿™ä¸ªæ¦‚å¿µã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-node-js-ä¸­çš„writable-final-callback" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-node-js-ä¸­çš„writable-final-callback"><span>ä»€ä¹ˆæ˜¯ Node.js ä¸­çš„<code>writable._final(callback)</code>ï¼Ÿ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamsï¼‰æ˜¯å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“ä½ ä¸éœ€è¦ä¸€æ¬¡æ€§è¯»å–æ‰€æœ‰æ•°æ®åˆ°å†…å­˜ä¸­çš„æ—¶å€™ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ï¼Œæˆ–è€…ä¸¤è€…éƒ½æœ‰ï¼ˆå³åŒå·¥æµå’Œå˜æ¢æµï¼‰ã€‚</p><p><code>writable._final(callback)</code>æ˜¯ Writable æµï¼ˆå¯å†™æµï¼‰å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ã€‚ä½ å¯ä»¥æŠŠ Writable æµæƒ³è±¡æˆä¸€ä¸ªé€šé“ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒå‘é€æ•°æ®åˆ°æ–‡ä»¶ã€ç½‘ç»œè¿æ¥ç­‰ã€‚</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå½“ä½ å‘æµä¸­å†™å…¥æ•°æ®æ—¶ï¼Œä½ ä¼šè°ƒç”¨<code>write()</code>æ–¹æ³•ã€‚ç„¶è€Œï¼Œå½“ä½ å®Œæˆæ•°æ®å†™å…¥ï¼Œå¹¶ä¸”æƒ³è¦å…³é—­æµä¹‹å‰ï¼Œ<code>_final()</code>æ–¹æ³•å°±æ´¾ä¸Šäº†ç”¨åœºã€‚ç®€å•åœ°è¯´ï¼Œ<code>_final(callback)</code>æ˜¯åœ¨æµå³å°†ç»“æŸå‰è¢«å†…éƒ¨è‡ªåŠ¨è°ƒç”¨çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒç»™ä½ ä¸€ä¸ªæœºä¼šå»ç¡®ä¿æ‰€æœ‰çš„æ•°æ®éƒ½å·²ç»è¢«å¤„ç†å®Œæ¯•ã€‚</p><p>è¿™ä¸ª<code>callback</code>å‡½æ•°æ˜¯éå¸¸é‡è¦çš„ï¼Œå› ä¸ºå®ƒå¿…é¡»è¢«è°ƒç”¨æ¥é€šçŸ¥æµï¼Œä½ å·²ç»å®Œæˆäº†æ‰€æœ‰æ•°æ®çš„å¤„ç†ã€‚<code>callback</code>å‡½æ•°é€šå¸¸æ¥æ”¶ä¸€ä¸ªå¯é€‰çš„é”™è¯¯å‚æ•°ï¼Œä»¥ä¾¿äºæŠ¥å‘Šåœ¨æœ€ç»ˆå¤„ç†é˜¶æ®µå‘ç”Ÿçš„é”™è¯¯ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-20" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-20"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js ç¨‹åºï¼Œè¯¥ç¨‹åºè¯»å–ä¸€äº›æ•°æ®ï¼ˆæ¯”å¦‚ä» API è·å–çš„æ•°æ®ï¼‰ï¼Œå¤„ç†è¿™äº›æ•°æ®ï¼Œç„¶åå°†ç»“æœå†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ç»“æŸæ—¶ï¼Œä½ å¯èƒ½éœ€è¦æ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œï¼Œæ¯”å¦‚å…³é—­æ•°æ®åº“è¿æ¥æˆ–è€…æ¸…ç©ºä¸´æ—¶ç¼“å­˜ã€‚è¿™æ—¶ï¼Œå°±å¯ä»¥åœ¨<code>_final(callback)</code>æ–¹æ³•ä¸­è¿›è¡Œè¿™äº›æ“ä½œã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -2" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹ä»£ç -2"><span>ç¤ºä¾‹ä»£ç ï¼š</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> MyWritable</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Writable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å½“è°ƒç”¨ stream.write() æ–¹æ³•ä¼ é€’æ•°æ®æ—¶ï¼Œ_write() æ–¹æ³•ä¼šè¢«è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å‡è®¾æˆ‘ä»¬æŠŠæ•°æ®å†™å…¥æŸå¤„ï¼Œä¾‹å¦‚æ ‡å‡†è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®Œæˆå¤„ç†å½“å‰æ•°æ®å—</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // åœ¨æµç»“æŸå‰ï¼Œ_final() æ–¹æ³•ä¼šè¢«è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _final</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ‰§è¡Œæ¸…ç†å·¥ä½œ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // æ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œï¼Œç„¶åè°ƒç”¨ callback é€šçŸ¥å®Œæˆ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºå®ä¾‹å¹¶ä½¿ç”¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myWritable</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MyWritable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myWritable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥ç¬¬ä¸€å—æ•°æ®&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myWritable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;world&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥ç¬¬äºŒå—æ•°æ®&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ ‡è®°å†™å…¥å®Œæˆï¼Œ_finalå°†è¢«è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myWritable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ‰€æœ‰å†™å…¥å®Œæˆï¼Œä¸”å·²æ‰§è¡Œæ¸…ç†&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>MyWritable</code>ç±»æ‰©å±•äº†<code>Writable</code>ç±»ï¼Œå¹¶è¦†ç›–äº†<code>_write</code>å’Œ<code>_final</code>æ–¹æ³•ã€‚æ¯æ¬¡è°ƒç”¨<code>.write()</code>æ—¶ï¼Œ<code>_write</code>æ–¹æ³•éƒ½ä¼šè¢«è°ƒç”¨æ¥å¤„ç†æ•°æ®ã€‚å½“è°ƒç”¨<code>.end()</code>æ ‡è®°æ‰€æœ‰æ•°æ®å·²ç»å†™å…¥å®Œæˆæ—¶ï¼Œ<code>_final</code>æ–¹æ³•å°†è¢«è‡ªåŠ¨è°ƒç”¨ï¼Œæ‰§è¡Œä»»ä½•æœ€ç»ˆçš„æ¸…ç†å·¥ä½œã€‚</p><h3 id="æ€»ç»“-31" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-31"><span>æ€»ç»“</span></a></h3><p><code>writable._final(callback)</code>æ˜¯ä¸€ä¸ªåœ¨å¯å†™æµç»“æŸä¹‹å‰æä¾›æ¸…ç†æœºä¼šçš„é’©å­ã€‚é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œä½ å¯ä»¥ç¡®ä¿èµ„æºè¢«é€‚å½“åœ°ç®¡ç†å’Œé‡Šæ”¾ï¼Œä¾‹å¦‚å…³é—­æ–‡ä»¶æè¿°ç¬¦æˆ–ç½‘ç»œå¥—æ¥å­—ã€‚è¿™å¯¹äºé¿å…å†…å­˜æ³„æ¼å’Œä¿æŒåº”ç”¨çš„ç¨³å®šæ€§æ˜¯éå¸¸é‡è¦çš„ã€‚</p><h4 id="errors-while-writing" tabindex="-1"><a class="header-anchor" href="#errors-while-writing"><span><a href="https://nodejs.org/docs/latest/api/stream.html#errors-while-writing" target="_blank" rel="noopener noreferrer">Errors while writing</a></span></a></h4><p>äº†è§£ Node.js ä¸­å†™å…¥è¿‡ç¨‹ä¸­çš„é”™è¯¯æ˜¯å¾ˆé‡è¦çš„ï¼Œå°¤å…¶æ˜¯å¯¹äºåˆšå¼€å§‹æ¥è§¦ Node.js çš„ç¼–ç¨‹æ–°æ‰‹ã€‚åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamsï¼‰æ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œéå¸¸é€‚åˆå¤„ç†å¤§é‡æ•°æ®ï¼Œæ¯”å¦‚æ–‡ä»¶ä¼ è¾“æˆ–ç½‘ç»œé€šä¿¡ã€‚Node.js v21.7.1 å¯¹è¿™éƒ¨åˆ†æœ‰è¯¦ç»†çš„æ–‡æ¡£è¯´æ˜ï¼Œæˆ‘ä»¬æ¥ç®€å•è§£è¯»ä¸€ä¸‹ï¼Œå¹¶é€šè¿‡å®é™…çš„ä¾‹å­æ¥ç†è§£ã€‚</p><h3 id="å†™å…¥æµ-writable-streams-ä¸­çš„é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#å†™å…¥æµ-writable-streams-ä¸­çš„é”™è¯¯"><span>å†™å…¥æµï¼ˆWritable Streamsï¼‰ä¸­çš„é”™è¯¯</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>Writable</code> æµæ˜¯ç”¨æ¥å†™å…¥æ•°æ®çš„ä¸€ç§æµã€‚æ¯”å¦‚ï¼Œä½ æƒ³æŠŠä¸€äº›æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œæˆ–è€…å‘é€ç»™å®¢æˆ·ç«¯å“åº”æ—¶ï¼Œè¿™æ—¶å°±ä¼šç”¨åˆ° <code>Writable</code> æµã€‚å½“ä½ å¯¹è¿™äº›æµè¿›è¡Œå†™å…¥æ“ä½œæ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°å„ç§é”™è¯¯ï¼Œæ¯”å¦‚ï¼š</p><ul><li>ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œæ— æ³•å†™å…¥æ–‡ä»¶ã€‚</li><li>æ–‡ä»¶è¢«å ç”¨æˆ–æ²¡æœ‰å†™å…¥æƒé™ã€‚</li><li>ç½‘ç»œé—®é¢˜å¯¼è‡´æ— æ³•å‘é€æ•°æ®ã€‚</li></ul><p>è¿™äº›é”™è¯¯å¦‚æœä¸è¢«å¦¥å–„å¤„ç†ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä½ çš„åº”ç”¨ç¨‹åºå¼‚å¸¸é€€å‡ºæˆ–å‡ºç°æ•°æ®ä¸¢å¤±ç­‰é—®é¢˜ã€‚</p><h3 id="å¦‚ä½•æ•è·å’Œå¤„ç†è¿™äº›é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•æ•è·å’Œå¤„ç†è¿™äº›é”™è¯¯"><span>å¦‚ä½•æ•è·å’Œå¤„ç†è¿™äº›é”™è¯¯</span></a></h3><p>å½“ä½¿ç”¨ <code>Writable</code> æµå†™å…¥æ•°æ®æ—¶ï¼Œé”™è¯¯å¯ä»¥é€šè¿‡ç›‘å¬æµçš„ <code>&#39;error&#39;</code> äº‹ä»¶æ¥æ•è·ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ­¥éª¤ï¼Œå› ä¸ºå®ƒå¯ä»¥å¸®åŠ©ä½ çš„åº”ç”¨æ›´åŠ å¥å£®å’Œç¨³å®šã€‚</p><h4 id="å®é™…è¿ç”¨ç¤ºä¾‹-21" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-21"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h4><h5 id="ç¤ºä¾‹-1-å‘æ–‡ä»¶ä¸­å†™å…¥æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-å‘æ–‡ä»¶ä¸­å†™å…¥æ•°æ®"><span>ç¤ºä¾‹ 1ï¼šå‘æ–‡ä»¶ä¸­å†™å…¥æ•°æ®</span></a></h5><p>å‡è®¾ä½ æƒ³å°†ä¸€äº›æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ª writable æµï¼ŒæŒ‡å‘ä¸€ä¸ªæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬é”™è¯¯äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°è¯•å†™å…¥æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœåœ¨å†™å…¥è¿‡ç¨‹ä¸­å‡ºç°ä»»ä½•é”™è¯¯ï¼ˆæ¯”å¦‚ <code>output.txt</code> æ–‡ä»¶ä¸èƒ½è¢«åˆ›å»ºæˆ–å†™å…¥ï¼‰ï¼Œé”™è¯¯ä¼šè¢«æ•è·å¹¶é€šè¿‡æ§åˆ¶å°æ‰“å°å‡ºæ¥ï¼Œè€Œä¸ä¼šè®©æ•´ä¸ªç¨‹åºå´©æºƒã€‚</p><h5 id="ç¤ºä¾‹-2-ç½‘é¡µæœåŠ¡å™¨å“åº”" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-ç½‘é¡µæœåŠ¡å™¨å“åº”"><span>ç¤ºä¾‹ 2ï¼šç½‘é¡µæœåŠ¡å™¨å“åº”</span></a></h5><p>å¦‚æœä½ æ­£åœ¨æ„å»ºä¸€ä¸ªç½‘é¡µæœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯è¯·æ±‚ç‰¹å®šèµ„æºæ—¶ï¼Œä½ å¯èƒ½éœ€è¦å°†æ•°æ®å†™å›åˆ°å®¢æˆ·ç«¯:</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è®¾ç½®å“åº”å¤´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setHeader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;text/plain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ç›‘å¬é”™è¯¯äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å“åº”è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‘é€æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000/&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœåœ¨å‘é€å“åº”ç»™å®¢æˆ·ç«¯æ—¶å‘ç”Ÿé”™è¯¯ï¼ˆæ¯”å¦‚ç½‘ç»œé—®é¢˜ï¼‰ï¼Œé”™è¯¯åŒæ ·ä¼šè¢«æ•è·å¹¶å¤„ç†ï¼Œé˜²æ­¢æœåŠ¡å™¨å´©æºƒã€‚</p><h3 id="ç»“è®º-3" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-3"><span>ç»“è®º</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæ­£ç¡®åœ°å¤„ç†å†™å…¥æµä¸­çš„é”™è¯¯æ˜¯éå¸¸é‡è¦çš„ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ æé«˜åº”ç”¨çš„ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒã€‚é€šè¿‡ç›‘å¬å’Œå¤„ç† <code>Writable</code> æµçš„ <code>&#39;error&#39;</code> äº‹ä»¶ï¼Œä½ å¯ä»¥å®‰å…¨åœ°ç®¡ç†é”™è¯¯ï¼Œä¿è¯åº”ç”¨çš„å¥åº·è¿è¡Œã€‚è®°å¾—åœ¨æ¯æ¬¡ä½¿ç”¨ <code>Writable</code> æµæ—¶éƒ½è¿›è¡Œé”™è¯¯å¤„ç†ï¼</p><h4 id="an-example-writable-stream" tabindex="-1"><a class="header-anchor" href="#an-example-writable-stream"><span><a href="https://nodejs.org/docs/latest/api/stream.html#an-example-writable-stream" target="_blank" rel="noopener noreferrer">An example writable stream</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamsï¼‰æ˜¯å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œå°¤å…¶æ˜¯å½“ä½ éœ€è¦å¤„ç†å¤§é‡æ•°æ®æˆ–è€…ä½ ä¸å¸Œæœ›ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­æ—¶ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ï¼Œæˆ–è€…ä¸¤è€…éƒ½å¯ä»¥ï¼Œå®ƒä»¬å¯ä»¥å¸®åŠ©ä½ ä»¥é«˜æ•ˆå’Œå¯ç®¡ç†çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚</p><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­æåˆ°äº†ä¸€ä¸ªå¯å†™æµï¼ˆWritable Streamï¼‰çš„ç¤ºä¾‹ã€‚å¯å†™æµæ˜¯ä¸€ç§æµï¼Œå®ƒå…è®¸ä½ å‘å®ƒå†™å…¥æ•°æ®ï¼Œç„¶åå®ƒå¯ä»¥å°†è¿™äº›æ•°æ®å‘é€åˆ°æŸä¸ªç›®çš„åœ°ã€‚ä¾‹å¦‚ï¼Œè¿™ä¸ªç›®çš„åœ°å¯ä»¥æ˜¯æ–‡ä»¶ã€HTTP å“åº”ä½“æˆ–è€…æ˜¯ä»»ä½•èƒ½æ¥æ”¶æ•°æ®çš„åœ°æ–¹ã€‚</p><h3 id="å¯å†™æµçš„åŸºæœ¬ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å¯å†™æµçš„åŸºæœ¬ç¤ºä¾‹"><span>å¯å†™æµçš„åŸºæœ¬ç¤ºä¾‹</span></a></h3><p>è€ƒè™‘è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªæ—¥å¿—ç³»ç»Ÿï¼Œéœ€è¦å°†æ—¥å¿—ä¿¡æ¯å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ä½¿ç”¨ Node.js çš„å¯å†™æµï¼Œä½ å¯ä»¥è½»æ¾åœ°å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>é¦–å…ˆï¼Œä½ éœ€è¦å¼•å…¥ <code>fs</code> æ¨¡å—ï¼Œè¿™æ˜¯ Node.js å†…ç½®çš„æ¨¡å—ï¼Œç”¨äºæ–‡ä»¶ç³»ç»Ÿæ“ä½œã€‚ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>fs.createWriteStream()</code> æ–¹æ³•åˆ›å»ºä¸€ä¸ªæŒ‡å‘ç‰¹å®šæ–‡ä»¶çš„å¯å†™æµï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæŒ‡å‘ &#39;example.log&#39; æ–‡ä»¶çš„å¯å†™æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç°åœ¨ï¼Œä½ å¯ä»¥å‘è¿™ä¸ªå¯å†™æµä¸­å†™å…¥æ•°æ®äº†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯ä¸€æ¡æ—¥å¿—ä¿¡æ¯</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¿™æ˜¯å¦ä¸€æ¡æ—¥å¿—ä¿¡æ¯</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å½“ä½ å®Œæˆå†™å…¥æ—¶ï¼Œéœ€è¦å…³é—­æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>&#39;example.log&#39;</code> çš„æ–‡ä»¶ï¼Œå¹¶é€šè¿‡å¯å†™æµå‘å…¶ä¸­å†™å…¥äº†ä¸¤æ¡æ—¥å¿—ä¿¡æ¯ã€‚ä½¿ç”¨ <code>\n</code> æ˜¯ä¸ºäº†åœ¨æ¯æ¡æ—¥å¿—ä¿¡æ¯ä¹‹åæ·»åŠ ä¸€ä¸ªæ–°è¡Œã€‚è°ƒç”¨ <code>writableStream.end()</code> æ–¹æ³•è¡¨ç¤ºæˆ‘ä»¬å·²ç»å®Œæˆäº†å†™å…¥æ“ä½œï¼Œå¯ä»¥å…³é—­æµäº†ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-22" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-22"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><ol><li><p><strong>æ—¥å¿—ç³»ç»Ÿ</strong>ï¼šå¦‚ä¸Šé¢æåˆ°çš„ï¼Œä½ å¯ä»¥ä½¿ç”¨å¯å†™æµæ¥è®°å½•åº”ç”¨ç¨‹åºçš„è¿è¡Œæƒ…å†µï¼Œæ¯”å¦‚é”™è¯¯æ—¥å¿—ã€ç”¨æˆ·æ´»åŠ¨ç­‰ã€‚</p></li><li><p><strong>æ–‡ä»¶ä¸Šä¼ </strong>ï¼šåœ¨å¤„ç† Web åº”ç”¨çš„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å¯å†™æµå°†æ¥æ”¶åˆ°çš„æ–‡ä»¶æ•°æ®å†™å…¥æœåŠ¡å™¨ä¸Šçš„ç£ç›˜ã€‚</p></li><li><p><strong>æ•°æ®è½¬æ¢</strong>ï¼šå¦‚æœä½ æ­£åœ¨å¤„ç†ä¸€äº›éœ€è¦è½¬æ¢çš„æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œä» CSV æ ¼å¼è½¬æ¢ä¸º JSON æ ¼å¼ï¼‰ï¼Œä½ å¯ä»¥è¯»å–åŸå§‹æ•°æ®çš„åŒæ—¶ï¼Œé€šè¿‡ä¸€ä¸ªè½¬æ¢æµï¼ˆTransform Streamï¼‰è¿›è¡Œè½¬æ¢ï¼Œç„¶åå†ç”¨å¯å†™æµå°†è½¬æ¢åçš„æ•°æ®å†™å…¥åˆ°ç›®æ ‡æ–‡ä»¶ä¸­ã€‚</p></li></ol><h3 id="æ€»ç»“-32" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-32"><span>æ€»ç»“</span></a></h3><p>å¯å†™æµæ˜¯ Node.js æä¾›çš„å¼ºå¤§å·¥å…·ä¹‹ä¸€ï¼Œå®ƒå…è®¸ä½ ä»¥æµå¼çš„æ–¹å¼å¤„ç†è¾“å‡ºæ•°æ®ã€‚æ— è®ºæ˜¯å†™å…¥æ–‡ä»¶ã€å‘é€ HTTP å“åº”è¿˜æ˜¯å…¶ä»–å½¢å¼çš„è¾“å‡ºï¼Œå¯å†™æµéƒ½èƒ½è®©æ•°æ®å¤„ç†å˜å¾—æ›´åŠ é«˜æ•ˆå’Œçµæ´»ã€‚é€šè¿‡ä¸Šè¿°ç¤ºä¾‹å’Œå®é™…è¿ç”¨çš„ä¾‹å­ï¼Œä½ åº”è¯¥èƒ½å¤Ÿç†è§£å¯å†™æµçš„åŸºæœ¬æ¦‚å¿µä»¥åŠå¦‚ä½•åœ¨ä½ è‡ªå·±çš„é¡¹ç›®ä¸­ä½¿ç”¨å®ƒä»¬äº†ã€‚</p><h4 id="decoding-buffers-in-a-writable-stream" tabindex="-1"><a class="header-anchor" href="#decoding-buffers-in-a-writable-stream"><span><a href="https://nodejs.org/docs/latest/api/stream.html#decoding-buffers-in-a-writable-stream" target="_blank" rel="noopener noreferrer">Decoding buffers in a writable stream</a></span></a></h4><p>Node.js ä¸­çš„æµï¼ˆStreamsï¼‰æ˜¯ç”¨äºå¤„ç†è¯»å†™æ•°æ®çš„æŠ½è±¡æ¥å£ã€‚åœ¨ Node.js é‡Œï¼Œæœ‰å››ç§åŸºæœ¬ç±»å‹çš„æµï¼šå¯è¯»ï¼ˆReadableï¼‰ã€å¯å†™ï¼ˆWritableï¼‰ã€åŒå‘ï¼ˆDuplexï¼‰å’Œè½¬æ¢ï¼ˆTransformï¼‰æµã€‚æˆ‘ä»¬è¿™é‡Œå…³æ³¨çš„æ˜¯å¯å†™æµï¼ˆWritableï¼‰ï¼Œå®ƒå…è®¸ä½ å°†æ•°æ®å†™å…¥åˆ°ç›®æ ‡ã€‚</p><h3 id="è§£ç ç¼“å†²åŒº-buffers-åœ¨å¯å†™æµä¸­çš„åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#è§£ç ç¼“å†²åŒº-buffers-åœ¨å¯å†™æµä¸­çš„åº”ç”¨"><span>è§£ç ç¼“å†²åŒºï¼ˆBuffersï¼‰åœ¨å¯å†™æµä¸­çš„åº”ç”¨</span></a></h3><p>åœ¨ Node.js v21.7.1 ç‰ˆæœ¬çš„æ–‡æ¡£ä¸­ï¼Œæåˆ°ä¸€ä¸ªç‰¹æ€§æ˜¯åœ¨å¯å†™æµä¸­è§£ç ç¼“å†²åŒºã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™æ„å‘³ç€å½“ä½ å°†äºŒè¿›åˆ¶æ•°æ®ï¼ˆå­˜å‚¨åœ¨ Buffer å¯¹è±¡ä¸­ï¼‰å†™å…¥ä¸€ä¸ªå¯å†™æµæ—¶ï¼Œå¯ä»¥è‡ªåŠ¨åœ°å°†è¿™äº›æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸²å½¢å¼ï¼Œè€Œä¸å¿…æ‰‹åŠ¨è¿›è¡Œè½¬æ¢ã€‚</p><h4 id="å®é™…è¿ç”¨çš„ä¾‹å­-23" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-23"><span>å®é™…è¿ç”¨çš„ä¾‹å­ï¼š</span></a></h4><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦ä»ä¸€ä¸ªæ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œç„¶åå°†è¿™äº›æ•°æ®ä»¥å­—ç¬¦ä¸²å½¢å¼å†™å…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚è¿™å…¶ä¸­å¯èƒ½æ¶‰åŠåˆ°ç¼–ç è½¬æ¢ï¼Œå› ä¸ºæ–‡ä»¶è¯»å–å‡ºæ¥çš„åŸå§‹æ•°æ®é€šå¸¸æ˜¯äºŒè¿›åˆ¶æ ¼å¼çš„ã€‚</p><h5 id="ä¾‹å­-1-æ²¡æœ‰è‡ªåŠ¨è§£ç çš„æƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-æ²¡æœ‰è‡ªåŠ¨è§£ç çš„æƒ…å†µ"><span>ä¾‹å­ 1ï¼šæ²¡æœ‰è‡ªåŠ¨è§£ç çš„æƒ…å†µ</span></a></h5><p>å¦‚æœæ²¡æœ‰åˆ©ç”¨æ–°çš„è§£ç åŠŸèƒ½ï¼Œä½ å¯èƒ½éœ€è¦å…ˆè¯»å–æ•°æ®åˆ° Buffer ä¸­ï¼Œç„¶ååœ¨å†™å…¥å‰ï¼Œæ‰‹åŠ¨è°ƒç”¨<code>.toString()</code>æ–¹æ³•å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> reader</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;source.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;destination.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">reader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ‰‹åŠ¨å°†Bufferè½¬æ¢ä¸ºå­—ç¬¦ä¸²å†å†™å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  writer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="ä¾‹å­-2-ä½¿ç”¨è‡ªåŠ¨è§£ç çš„æƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ä½¿ç”¨è‡ªåŠ¨è§£ç çš„æƒ…å†µ"><span>ä¾‹å­ 2ï¼šä½¿ç”¨è‡ªåŠ¨è§£ç çš„æƒ…å†µ</span></a></h5><p>åœ¨ Node.js çš„æ–°ç‰ˆæœ¬ä¸­ï¼Œå¯å†™æµæ”¯æŒç›´æ¥åœ¨æ„å»ºæ—¶æŒ‡å®šä¸€ä¸ª<code>decodeStrings</code>é€‰é¡¹å’Œä¸€ä¸ª<code>defaultEncoding</code>é€‰é¡¹ï¼Œä½¿å¾—ä½ å¯ä»¥è‡ªåŠ¨åœ°å°† Buffer æ•°æ®è§£ç æˆå­—ç¬¦ä¸²ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµï¼Œå¯ç”¨è‡ªåŠ¨è§£ç </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;destination.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  decodeStrings</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å…³é—­è‡ªåŠ¨çš„å­—ç¬¦ä¸²åˆ°Bufferçš„è½¬æ¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  defaultEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®é»˜è®¤ç¼–ç ä¸ºutf8</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> reader</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;source.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">reader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // ç›´æ¥å†™å…¥ï¼Œæ— éœ€æ‰‹åŠ¨è½¬æ¢</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  writer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€šè¿‡è®¾ç½®<code>decodeStrings: false</code>ï¼Œä½ å‘Šè¯‰ Node.jsï¼šâ€œæˆ‘ä¼šè‡ªå·±è´Ÿè´£å¤„ç†å­—ç¬¦ä¸²åˆ° Buffer çš„è½¬æ¢ï¼Œä¸éœ€è¦ä½ ï¼ˆNode.jsï¼‰è‡ªåŠ¨åšè¿™ä»¶äº‹ã€‚â€åŒæ—¶ï¼Œé€šè¿‡<code>defaultEncoding: &#39;utf8&#39;</code>ï¼Œä½ å®šä¹‰äº†å½“æ•°æ®è¢«è‡ªåŠ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ—¶ä½¿ç”¨çš„ç¼–ç ã€‚</p><p>è¿™æ ·çš„è®¾è®¡éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯å½“ä½ å¤„ç†æ–‡æœ¬æ•°æ®æ—¶ï¼Œå®ƒå¯ä»¥å¸®åŠ©é¿å…ä¸å¿…è¦çš„ç¼–ç è½¬æ¢æ­¥éª¤ï¼Œå¹¶ä¸”ä½¿ä»£ç æ›´åŠ æ¸…æ™°ã€ç®€æ´ã€‚</p><h3 id="implementing-a-readable-stream" tabindex="-1"><a class="header-anchor" href="#implementing-a-readable-stream"><span><a href="https://nodejs.org/docs/latest/api/stream.html#implementing-a-readable-stream" target="_blank" rel="noopener noreferrer">Implementing a readable stream</a></span></a></h3><p>ç†è§£ Node.js ä¸­çš„å¯è¯»æµï¼ˆReadable Streamï¼‰å¯¹äºå¤„ç†å„ç§ I/Oï¼ˆè¾“å…¥/è¾“å‡ºï¼‰ä»»åŠ¡éå¸¸æœ‰å¸®åŠ©ï¼Œæ¯”å¦‚ä»æ–‡ä»¶è¯»å–æ•°æ®æˆ–è€…æ¥æ”¶ç½‘ç»œè¯·æ±‚çš„æ•°æ®ã€‚åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§å¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œå®ƒå…è®¸ä½ æŒ‰é¡ºåºå¤„ç†æ•°æ®ç‰‡æ®µï¼Œè€Œä¸å¿…ç­‰å¾…æ‰€æœ‰æ•°æ®éƒ½å¯ç”¨ã€‚è¿™æ ·åšå¯ä»¥æé«˜æ€§èƒ½å¹¶å‡å°‘å†…å­˜ä½¿ç”¨ï¼Œç‰¹åˆ«é€‚ç”¨äºå¤„ç†å¤§é‡æ•°æ®ã€‚</p><h3 id="åˆ›å»ºä¸€ä¸ªå¯è¯»æµ" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ªå¯è¯»æµ"><span>åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></a></h3><p>åœ¨ Node.js v21.7.1 ä¸­åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„å¯è¯»æµï¼Œä½ éœ€è¦ï¼š</p><ol><li>ä» <code>stream</code> æ¨¡å—ä¸­å¼•å…¥ <code>Readable</code> ç±»ã€‚</li><li>é€šè¿‡æ‰©å±• <code>Readable</code> ç±»æ¥åˆ›å»ºä½ è‡ªå·±çš„å¯è¯»æµç±»ã€‚</li><li>å®ç° <code>_read</code> æ–¹æ³•ï¼ŒNode.js ä¼šåœ¨æµéœ€è¦æ›´å¤šæ•°æ®æ—¶è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</li></ol><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„å¯è¯»æµï¼Œæ¯æ¬¡è¯»å–æ“ä½œæ—¶ï¼Œå®ƒå°†äº§ç”Ÿä¸€äº›æ•°æ®ï¼Œç›´åˆ°æ»¡è¶³ç»“æŸæ¡ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> MyReadableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">counter</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å½“æµéœ€è¦æ›´å¤šæ•°æ®æ—¶ï¼Œ_read æ–¹æ³•è¢«è‡ªåŠ¨è°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">counter</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">counter</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // å½“æ²¡æœ‰æ›´å¤šæ•°æ®æ—¶ï¼Œè°ƒç”¨ push(null) æ¥ç»“æŸæµ</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // å‘å†…éƒ¨ç¼“å†²åŒºæ¨é€æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Chunk </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">counter</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨æˆ‘ä»¬çš„å¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MyReadableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No more data.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…åº”ç”¨ç¤ºä¾‹-12" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-12"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h3><ol><li><strong>æ–‡ä»¶è¯»å–</strong>ï¼šä½¿ç”¨ Node.js çš„ fs æ¨¡å—é…åˆå¯è¯»æµï¼Œå¯ä»¥é€å—è¯»å–å¤§å‹æ–‡ä»¶ï¼Œä»¥é¿å…ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;largeFile.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;There is no more data to read.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>ç½‘ç»œè¯·æ±‚</strong>ï¼šå½“ä½ å‘èµ·ä¸€ä¸ª HTTP è¯·æ±‚å¹¶è·å–å“åº”æ—¶ï¼Œå“åº”å¯¹è±¡å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¯è¯»æµã€‚å› æ­¤ï¼Œä½ å¯ä»¥é€æ­¥å¤„ç†è¿”å›çš„æ•°æ®ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>æ•°æ®è½¬æ¢</strong>ï¼šå¦‚æœä½ æƒ³åœ¨è¯»å–æ•°æ®æ—¶åŒæ—¶è¿›è¡Œä¸€äº›è½¬æ¢ï¼Œå¯ä»¥ä½¿ç”¨ Transform æµï¼ˆä¹Ÿå±äº Node.js çš„æµæœºåˆ¶ä¸€éƒ¨åˆ†ï¼‰ï¼Œå®ƒæ—¢æ˜¯å¯è¯»æµä¹Ÿæ˜¯å¯å†™æµã€‚</li></ol><p>ä»¥ä¸Šæ˜¯å…³äºå¦‚ä½•åœ¨ Node.js ä¸­å®ç°å’Œä½¿ç”¨å¯è¯»æµçš„åŸºæœ¬ä»‹ç»å’Œä¸€äº›å®é™…åº”ç”¨ç¤ºä¾‹ã€‚å¸Œæœ›è¿™å¯¹ä½ äº†è§£å’Œä½¿ç”¨ Node.js çš„æµæœ‰æ‰€å¸®åŠ©ï¼</p><h4 id="new-stream-readable-options" tabindex="-1"><a class="header-anchor" href="#new-stream-readable-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#new-streamreadableoptions" target="_blank" rel="noopener noreferrer">new stream.Readable([options])</a></span></a></h4><p>Node.js æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ JavaScript ç¯å¢ƒï¼Œè€Œ <code>stream</code> æ˜¯ Node.js æä¾›çš„ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œç”¨äºå¤„ç†æµæ•°æ®ã€‚æµï¼ˆStreamï¼‰æ˜¯ä¸€ç§æŠ½è±¡çš„æ•°æ®ç»“æ„ï¼Œç”¨äºè¯»å–æˆ–å†™å…¥æ•°æ®ï¼Œè®©ä½ èƒ½å¤ŸæŒ‰é¡ºåºå¤„ç†æ•°æ®ï¼Œè€Œä¸å¿…ç­‰å¾…æ‰€æœ‰æ•°æ®éƒ½å‡†å¤‡å¥½ã€‚è¿™åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–è€…æ¥è‡ªå¤–éƒ¨èµ„æºçš„æ•°æ®æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚</p><h3 id="stream-readable" tabindex="-1"><a class="header-anchor" href="#stream-readable"><span>stream.Readable</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ<code>stream.Readable</code> æ˜¯å¯è¯»æµçš„ä¸€ä¸ªæ¥å£ï¼Œå…è®¸å¯¹è±¡ä»¥æµçš„å½¢å¼è¯»å–æ•°æ®ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ª <code>Readable</code> æµæ—¶ï¼Œå¯ä»¥é€šè¿‡ä¸åŒçš„æ–¹å¼å‘æµä¸­æ¨é€æ•°æ®ï¼Œç„¶åé€å—åœ°è¯»å–è¿™äº›æ•°æ®ã€‚å®ƒéå¸¸é€‚åˆå¤„ç†é‚£äº›ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ä¼šå¯¼è‡´é—®é¢˜çš„å¤§æ–‡ä»¶ã€‚</p><h4 id="åˆ›å»º-readable-æµçš„åŸºç¡€" tabindex="-1"><a class="header-anchor" href="#åˆ›å»º-readable-æµçš„åŸºç¡€"><span>åˆ›å»º Readable æµçš„åŸºç¡€</span></a></h4><p>ä»¥ä¸‹æ˜¯åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ <code>Readable</code> æµçš„ç¤ºä¾‹ï¼Œå¹¶ä½¿ç”¨ç‰¹å®šé€‰é¡¹å¯¹å…¶è¿›è¡Œé…ç½®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ Readable æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myReadableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¦‚æœéœ€è¦ï¼Œå¯ä»¥è®¾ç½®æµçš„è¯»å–é€‰é¡¹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®ç¼–ç ï¼Œä½¿å¾—è¯»å–çš„æ•°æ®ä¸ºå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  highWaterMark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æœ€é«˜æ°´ä½çº¿ï¼Œæ§åˆ¶å†…éƒ¨ç¼“å†²åŒºçš„æœ€å¤§å­—èŠ‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç å±•ç¤ºäº†å¦‚ä½•å¼•å…¥ <code>stream</code> æ¨¡å—å¹¶åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„å¯è¯»æµå®ä¾‹ã€‚é€‰é¡¹ <code>encoding</code> å’Œ <code>highWaterMark</code> åˆ†åˆ«ç”¨äºè®¾ç½®æµçš„ç¼–ç å’Œå†…éƒ¨ç¼“å†²åŒºçš„å¤§å°é™åˆ¶ã€‚</p><h4 id="å®é™…åº”ç”¨ç¤ºä¾‹-13" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ç¤ºä¾‹-13"><span>å®é™…åº”ç”¨ç¤ºä¾‹</span></a></h4><ol><li><p><strong>ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</strong>ï¼š</p><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œç›´æ¥å…¨é‡è¯»å…¥å†…å­˜å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œè¿™æ—¶å€™å¯ä»¥åˆ©ç”¨æµæ¥åˆ†æ‰¹å¤„ç†æ–‡ä»¶å†…å®¹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/large/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  highWaterMark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">16</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// 16KB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No more data to read.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>fs.createReadStream</code> æ–¹æ³•ï¼ˆåŸºäº <code>stream.Readable</code>ï¼‰é€å—åœ°è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶çš„å†…å®¹ã€‚é€šè¿‡ç›‘å¬ <code>data</code> äº‹ä»¶ï¼Œæˆ‘ä»¬æ¯æ¬¡æ¥æ”¶åˆ°ä¸€å—æ•°æ®å°±ä¼šæ‰“å°å‡ºè¯¥æ•°æ®çš„å¤§å°ï¼Œç›´è‡³æ–‡ä»¶è¯»å–å®Œæ¯•ã€‚</p></li><li><p><strong>å®æ—¶æ•°æ®ä¼ è¾“</strong>ï¼š</p><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªèŠå¤©åº”ç”¨ï¼Œå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å°†æ¶ˆæ¯å¹¿æ’­ç»™æ‰€æœ‰å…¶ä»–å®¢æˆ·ç«¯ã€‚è¿™é‡Œå¯ä»¥ä½¿ç”¨å¯è¯»æµæ¥å¤„ç†æ¥æ”¶çš„æ¶ˆæ¯æ•°æ®ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ connection æ˜¯ä¸€ä¸ªä»£è¡¨å®¢æˆ·ç«¯è¿æ¥çš„å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">connection</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> messageStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  messageStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†æ¶ˆæ¯æ·»åŠ åˆ°æµä¸­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  messageStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¡¨æ˜æ²¡æœ‰æ›´å¤šçš„æ•°æ®è¦æ·»åŠ åˆ°æµä¸­äº†</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å‡è®¾ broadcast æ˜¯å°†æ¶ˆæ¯å¹¿æ’­ç»™æ‰€æœ‰å®¢æˆ·ç«¯çš„å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  broadcast</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">messageStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ <code>Readable</code> æµæ¥å¤„ç†æ¯æ¡æ¶ˆæ¯ã€‚ç”±äºæ¶ˆæ¯æ˜¯å³æ—¶çš„ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>push</code> æ–¹æ³•å‘æµä¸­æ·»åŠ æ•°æ®ï¼Œç„¶åç«‹å³é€šè¿‡ <code>broadcast</code> å‡½æ•°å°†å…¶å‘é€å‡ºå»ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œ<code>stream.Readable</code> æ˜¯å¤„ç†å¤§é‡æ•°æ®ã€æ–‡ä»¶æ“ä½œæˆ–å®æ—¶æ•°æ®ä¼ è¾“ç­‰åœºæ™¯æ—¶ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œå®ƒä½¿æ•°æ®å¤„ç†å˜å¾—é«˜æ•ˆä¸”æ˜“äºç®¡ç†ã€‚</p><h4 id="readable-construct-callback" tabindex="-1"><a class="header-anchor" href="#readable-construct-callback"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readable_constructcallback" target="_blank" rel="noopener noreferrer">readable._construct(callback)</a></span></a></h4><p>å½“ä½ å¼€å§‹å­¦ä¹ ç¼–ç¨‹ï¼Œå°¤å…¶æ˜¯ Node.js æ—¶ï¼Œä½ ä¼šé‡åˆ°å¾ˆå¤šæ–°çš„æ¦‚å¿µã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬è¦èŠä¸€ä¸‹ Node.js ä¸­çš„ä¸€ä¸ªç‰¹æ€§ï¼š<code>readable._construct(callback)</code>ã€‚ä¸ºäº†è®©ä½ æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘ä¼šå°½é‡ä½¿ç”¨é€šä¿—æ˜“æ‡‚çš„è¯­è¨€ï¼Œå¹¶ç»™å‡ºä¸€äº›å®é™…çš„è¿ç”¨ä¾‹å­ã€‚</p><h3 id="åŸºç¡€ç†è§£-1" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€ç†è§£-1"><span>åŸºç¡€ç†è§£</span></a></h3><p>é¦–å…ˆï¼Œ<code>readable._construct(callback)</code>æ˜¯ Node.js ä¸­æµï¼ˆStreamï¼‰API çš„ä¸€éƒ¨åˆ†ã€‚åœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œæ¯”å¦‚ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®æˆ–å†™æ•°æ®åˆ°æ–‡ä»¶ä¸­ã€‚æµå¯ä»¥é«˜æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®ï¼Œå› ä¸ºå®ƒä»¬å…è®¸æ•°æ®è¢«é€ç‰‡å¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªæ•°æ®é›†è¿›å†…å­˜ã€‚</p><p><code>readable._construct(callback)</code>ç”¨äºåˆå§‹åŒ–å¯è¯»æµå¯¹è±¡ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œä½ å¯ä»¥æ‰§è¡Œä»»ä½•å¿…è¦çš„è®¾ç½®å·¥ä½œï¼Œæ¯”å¦‚æ‰“å¼€æ–‡ä»¶æˆ–è®¾ç½®èµ„æºä»å“ªé‡Œè¯»å–æ•°æ®ã€‚å®Œæˆåï¼Œä½ éœ€è¦è°ƒç”¨<code>callback</code>å‡½æ•°æ¥å‘ŠçŸ¥æµå‡†å¤‡å°±ç»ªï¼Œæˆ–è€…å¦‚æœæœ‰é”™è¯¯å‘ç”Ÿï¼Œåˆ™é€šè¿‡<code>callback</code>ä¼ é€’ä¸€ä¸ªé”™è¯¯å¯¹è±¡ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>readable._construct(callback)</code>æ˜¯åœ¨åˆ›å»ºè‡ªå®šä¹‰å¯è¯»æµæ—¶ï¼Œè¿›è¡Œåˆå§‹åŒ–è®¾ç½®çš„é’©å­ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-7" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-7"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-ä»æ–‡ä»¶è¯»å–æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-ä»æ–‡ä»¶è¯»å–æ•°æ®"><span>ä¾‹å­ 1ï¼šä»æ–‡ä»¶è¯»å–æ•°æ®</span></a></h4><p>æƒ³è±¡ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ª Node.js ç¨‹åºï¼Œè¯¥ç¨‹åºéœ€è¦ä»ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶è¯»å–æ•°æ®ã€‚ä¸ºäº†åšåˆ°è¿™ç‚¹ï¼Œä½ å†³å®šä½¿ç”¨è‡ªå®šä¹‰å¯è¯»æµï¼Œå¹¶åœ¨<code>_construct</code>æ–¹æ³•ä¸­æ‰“å¼€æ–‡ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> FileReadStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">filename</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filename</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> filename</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _construct</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fd</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filename</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;r&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">fd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fd</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> fd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å…¶ä»–å¿…è¦çš„æ–¹æ³•ï¼Œæ¯”å¦‚ _read...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ä¸Šé¢çš„ç±»æ¥è¯»å–æ–‡ä»¶æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fileStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> FileReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fileStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">fileStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No more data.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨<code>_construct</code>æ–¹æ³•ä¸­æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶å¹¶å‡†å¤‡è¯»å–æ•°æ®ã€‚</p><h4 id="ä¾‹å­-2-æ¨¡æ‹Ÿæ•°æ®æµ" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-æ¨¡æ‹Ÿæ•°æ®æµ"><span>ä¾‹å­ 2ï¼šæ¨¡æ‹Ÿæ•°æ®æµ</span></a></h4><p>å¦ä¸€ä¸ªåœºæ™¯æ˜¯ä½ å¯èƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªæ•°æ®æºï¼Œä¾‹å¦‚ï¼Œç”¨äºæµ‹è¯•çš„æ¨¡æ‹Ÿæ•°æ®æµã€‚åœ¨<code>_construct</code>æ–¹æ³•ä¸­ï¼Œä½ å¯ä»¥è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œä½†ä¹Ÿè®¸ç«‹å³å‡†å¤‡å°±ç»ªï¼Œå› ä¸ºæ•°æ®æ˜¯å³æ—¶ç”Ÿæˆçš„ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> MockDataStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åˆå§‹åŒ–ä»£ç ï¼Œå¦‚è®¾å®šæ•°æ®èŒƒå›´ç­‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _construct</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ä»…éœ€è¦è°ƒç”¨callbackä»¥è¡¨ç¤ºæµå·²å‡†å¤‡å¥½</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¿…é¡»å®ç°çš„ _read æ–¹æ³•ï¼Œç”¨äºæä¾›æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> generateMockData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™æ˜¯ä¸€ä¸ªå‡½æ•°ç”¨æ¥ç”Ÿæˆæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ²¡æœ‰æ›´å¤šæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>_construct</code>åªæ˜¯ç®€å•åœ°è°ƒç”¨äº†<code>callback</code>ï¼Œå› ä¸ºæ²¡æœ‰å¤æ‚çš„å‡†å¤‡å·¥ä½œéœ€è¦å®Œæˆã€‚</p><h3 id="ç»“è®º-4" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-4"><span>ç»“è®º</span></a></h3><p>ç†è§£<code>readable._construct(callback)</code>åŠå…¶åœ¨ Node.js ä¸­çš„åº”ç”¨å¯¹äºæ·±å…¥ç†è§£å’Œåˆ©ç”¨ Node.js å¤„ç†æ•°æ®æµéå¸¸é‡è¦ã€‚é€šè¿‡ä¸Šè¿°ç¤ºä¾‹ï¼Œä½ åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°å¦‚ä½•åœ¨å®è·µä¸­ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥å®šåˆ¶å¯è¯»æµä»¥æ»¡è¶³ä½ çš„ç‰¹å®šéœ€æ±‚ã€‚è®°ä½ï¼ŒNode.js çš„æµæ˜¯å¤„ç†å¤§è§„æ¨¡æ•°æ®çš„å¼ºå¤§å·¥å…·ï¼Œç†Ÿæ‚‰å®ƒä»¬ä¼šè®©ä½ çš„ Node.js åº”ç”¨æ›´åŠ é«˜æ•ˆå’Œçµæ´»ã€‚</p><h4 id="readable-read-size-2" tabindex="-1"><a class="header-anchor" href="#readable-read-size-2"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readable_readsize" target="_blank" rel="noopener noreferrer">readable._read(size)</a></span></a></h4><p>Node.js ä¸­çš„<code>readable._read(size)</code>æ–¹æ³•æ˜¯ä¸€ä¸ªåº•å±‚åŠŸèƒ½ï¼Œä¸»è¦ç”¨äºè‡ªå®šä¹‰æµå¯¹è±¡æ—¶å®ç°ã€‚åœ¨è§£é‡Šè¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£ Node.js ä¸­çš„æµï¼ˆStreamï¼‰å’Œå¯è¯»æµï¼ˆReadable Streamï¼‰ã€‚</p><h3 id="æµ-stream-1" tabindex="-1"><a class="header-anchor" href="#æµ-stream-1"><span>æµï¼ˆStreamï¼‰</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ä¸€ç§æŠ½è±¡çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå¤„ç†æ•°æ®çš„è¯»å†™ã€‚è¿™äº›æ•°æ®å¯èƒ½æ¥è‡ªæ–‡ä»¶ã€ç½‘ç»œã€æˆ–æ˜¯ç¨‹åºå†…éƒ¨çš„å…¶ä»–æ¥æºã€‚ä½¿ç”¨æµå¯ä»¥é«˜æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®ï¼Œå› ä¸ºå®ƒä»¬å…è®¸æ•°æ®è¢«åˆ†å—å¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªæ•°æ®é›†è¿›å†…å­˜ä¸­ã€‚</p><h3 id="å¯è¯»æµ-readable-stream-2" tabindex="-1"><a class="header-anchor" href="#å¯è¯»æµ-readable-stream-2"><span>å¯è¯»æµï¼ˆReadable Streamï¼‰</span></a></h3><p>å¯è¯»æµæ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„æµï¼Œä¸“é—¨ç”¨äºè¯»å–æ•°æ®ã€‚å¯ä»¥å°†å…¶æƒ³è±¡ä¸ºä¸€ä¸ªæ°´ç®¡ï¼Œæ•°æ®åƒæ°´ä¸€æ ·ä»ä¸€ç«¯æµå…¥ï¼Œç¨‹åºåˆ™ä»å¦ä¸€ç«¯æ¥æ”¶æ•°æ®ã€‚å¯è¯»æµæä¾›äº†å¤šç§æ–¹æ³•å’Œäº‹ä»¶æ¥è¯»å–å’Œå¤„ç†æ•°æ®ã€‚</p><h3 id="readable-read-size-3" tabindex="-1"><a class="header-anchor" href="#readable-read-size-3"><span><code>readable._read(size)</code></span></a></h3><p>å½“ä½ åˆ›å»ºè‡ªå·±çš„å¯è¯»æµæ—¶ï¼ˆé€šè¿‡ç»§æ‰¿å†…ç½®çš„<code>stream.Readable</code>ç±»ï¼‰ï¼Œéœ€è¦å®ç°<code>_read(size)</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªå†…éƒ¨ï¼ˆç§æœ‰ï¼‰æ–¹æ³•ï¼Œå½“æµçš„æ¶ˆè´¹è€…è¯·æ±‚æ›´å¤šæ•°æ®æ—¶ï¼ˆå³è°ƒç”¨äº†<code>stream.read()</code>æ–¹æ³•æ—¶ï¼‰ï¼ŒNode.js å†…éƒ¨ä¼šè°ƒç”¨<code>_read(size)</code>æ–¹æ³•æ¥å¡«å……æµçš„å†…éƒ¨ç¼“å†²åŒºã€‚</p><ul><li><strong>å‚æ•°<code>size</code></strong>ï¼šæ¨èæ¯æ¬¡è°ƒç”¨æ—¶è¯»å–çš„å­—èŠ‚æ•°ã€‚</li><li><strong>ä½œç”¨</strong>ï¼šä½ éœ€è¦åœ¨è¿™ä¸ªæ–¹æ³•é‡Œç¼–å†™ä»£ç æ¥è·å–æ•°æ®ï¼ˆå¯èƒ½æ˜¯ä»æ–‡ä»¶ç³»ç»Ÿã€æ•°æ®åº“ã€ç½‘ç»œç­‰ï¼‰ï¼Œç„¶åä½¿ç”¨<code>this.push(data)</code>å°†æ•°æ®æ·»åŠ åˆ°æµä¸­ã€‚å½“æ²¡æœ‰æ›´å¤šæ•°æ®æ—¶ï¼Œè°ƒç”¨<code>this.push(null)</code>æ¥è¡¨æ˜æµçš„ç»“æŸã€‚</li></ul><h3 id="å®é™…è¿ç”¨ä¾‹å­-25" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-25"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªç®€å•çš„å¯è¯»æµï¼Œè¿™ä¸ªæµç”Ÿæˆéšæœºæ•°å¹¶å°†å…¶ä½œä¸ºæ•°æ®ä¼ é€’ç»™æµçš„æ¶ˆè´¹è€…ã€‚</p><ol><li><strong>åˆ›å»ºè‡ªå®šä¹‰å¯è¯»æµ</strong></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> RandomNumberStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">maxEmits</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é™åˆ¶äº§ç”Ÿ10ä¸ªæ•°å­—åç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">emittedCount</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">emittedCount</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">emittedCount</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">maxEmits</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // æ²¡æœ‰æ›´å¤šæ•°æ®ï¼Œç»“æŸæµ</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // ç”Ÿæˆä¸€ä¸ªä»‹äº1åˆ°100çš„éšæœºæ•°å¹¶æ¨é€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> num</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Math</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">floor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Math</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">random</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">num</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>ä½¿ç”¨è‡ªå®šä¹‰å¯è¯»æµ</strong></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> randomStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> RandomNumberStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">randomStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received random number: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">randomStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Stream ended.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º<code>RandomNumberStream</code>çš„è‡ªå®šä¹‰å¯è¯»æµã€‚è¿™ä¸ªæµåœ¨æ¯æ¬¡è°ƒç”¨<code>_read</code>æ–¹æ³•æ—¶ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œå¹¶ä¸”åœ¨ç”Ÿæˆ 10 ä¸ªæ•°å­—åç»“æŸã€‚é€šè¿‡ç›‘å¬<code>data</code>äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ¥æ”¶å’Œå¤„ç†æµä¸­çš„æ•°æ®ï¼Œç›´è‡³æµç»“æŸã€‚</p><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šå¸®åŠ©ä½ ç†è§£äº†<code>readable._read(size)</code>æ–¹æ³•åŠå…¶åœ¨ Node.js ä¸­çš„åº”ç”¨ã€‚</p><h4 id="readable-destroy-err-callback" tabindex="-1"><a class="header-anchor" href="#readable-destroy-err-callback"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readable_destroyerr-callback" target="_blank" rel="noopener noreferrer">readable._destroy(err, callback)</a></span></a></h4><p>å¥½çš„ï¼Œæˆ‘å°†å°½å¯èƒ½é€šä¿—æ˜“æ‡‚åœ°è§£é‡Š <code>readable._destroy(err, callback)</code> è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ç»“åˆä¸€äº›å®é™…çš„ä¾‹å­æ¥å¸®åŠ©ä½ ç†è§£ã€‚</p><p>é¦–å…ˆéœ€è¦æ˜ç™½çš„æ˜¯ï¼Œ<code>readable._destroy(err, callback)</code> æ˜¯ Node.js ä¸­ Stream æ¨¡å—çš„ä¸€ä¸ªéƒ¨åˆ†ã€‚åœ¨è®¨è®ºè¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç®€å•äº†è§£ä¸‹ Node.js ä¸­çš„æµï¼ˆStreamï¼‰å’Œå®ƒä»¬çš„ä½œç”¨ã€‚</p><h3 id="æµ-stream-ç®€ä»‹-2" tabindex="-1"><a class="header-anchor" href="#æµ-stream-ç®€ä»‹-2"><span>æµï¼ˆStreamï¼‰ç®€ä»‹</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµæ˜¯ç”¨äºå¤„ç†æ•°æ®çš„æŠ½è±¡æ¥å£ï¼Œç‰¹åˆ«æ˜¯å¤„ç†å¤§é‡æ•°æ®æˆ–è€…é€æ­¥æ¥æ”¶æ•°æ®çš„åœºæ™¯ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ã€æˆ–è€…æ—¢å¯è¯»åˆå¯å†™çš„ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªæ–‡ä»¶è¯»å–æ“ä½œå¯ä»¥ä½¿ç”¨å¯è¯»æµï¼Œç½‘ç»œè¯·æ±‚çš„å“åº”ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå¯è¯»æµã€‚</p><p>æµçš„ä¼˜ç‚¹åœ¨äºå®ƒä»¬å¯ä»¥å°†å¤§é‡æ•°æ®åˆ†æˆå°ç‰‡æ®µé€æ­¥å¤„ç†ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™ä½¿å¾—å¤„ç†å¤§å‹æ–‡ä»¶æˆ–æ•°æ®å˜å¾—é«˜æ•ˆå’ŒèŠ‚çœå†…å­˜ã€‚</p><h3 id="readable-destroy-err-callback-è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#readable-destroy-err-callback-è§£é‡Š"><span><code>readable._destroy(err, callback)</code> è§£é‡Š</span></a></h3><p><code>readable._destroy(err, callback)</code> æ˜¯å¯è¯»æµå†…éƒ¨ä½¿ç”¨çš„æ–¹æ³•ï¼Œç”¨äºè‡ªå®šä¹‰æµçš„é”€æ¯é€»è¾‘ã€‚å½“æµä¸å†éœ€è¦æ—¶ï¼Œæ­¤æ–¹æ³•ä¼šè¢«è°ƒç”¨ä»¥é‡Šæ”¾èµ„æºï¼Œä¾‹å¦‚å…³é—­æ–‡ä»¶æè¿°ç¬¦æˆ–æ¸…ç†å†…å­˜ä¸­çš„ç¼“å†²åŒºç­‰ã€‚</p><ul><li><code>err</code>: å¦‚æœé”€æ¯è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œ<code>err</code> å‚æ•°ä¼šæºå¸¦ç›¸å…³é”™è¯¯ä¿¡æ¯ã€‚</li><li><code>callback</code>: å‡½æ•°å®Œæˆåçš„å›è°ƒå‡½æ•°ã€‚å¦‚æœé”€æ¯æˆåŠŸï¼Œ<code>callback</code> å°†è¢«è°ƒç”¨ä¸”ä¸å¸¦å‚æ•°ï¼›å¦‚æœå¤±è´¥ï¼Œ<code>callback</code> å°†è¢«è°ƒç”¨å¹¶ä¼ å…¥é”™è¯¯ä¿¡æ¯ã€‚</li></ul><p>è¯·æ³¨æ„ï¼Œ<code>_destroy</code> æ–¹æ³•é€šå¸¸ç”±æµçš„å®ç°è€…è°ƒç”¨æˆ–é‡å†™ï¼Œå¯¹äºå¤§å¤šæ•°ä½¿ç”¨æµçš„å¼€å‘è€…æ¥è¯´ï¼Œä¸éœ€è¦ç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-22" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-22"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œè¯¥ç¨‹åºé€šè¿‡å¯è¯»æµè¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶ã€‚åœ¨æŸç§æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ç”¨æˆ·å–æ¶ˆæ“ä½œæˆ–è¯»å–å‡ºç°é”™è¯¯ï¼Œä½ å¯èƒ½éœ€è¦æå‰ç»ˆæ­¢è¯»å–å¹¶å…³é—­ä¸æ–‡ä»¶çš„è¿æ¥ã€‚è¿™æ—¶ï¼Œå°±å¯ä»¥åœ¨è‡ªå®šä¹‰æµçš„å®ç°ä¸­ï¼Œé‡å†™ <code>_destroy</code> æ–¹æ³•æ¥å¤„ç†è¿™äº›é€»è¾‘ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> MyReadableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åˆå§‹åŒ–ä»£ç ï¼Œæ¯”å¦‚æ‰“å¼€æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å®ç°è¯»å–é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¦‚æœé‡åˆ°æ–‡ä»¶æœ«å°¾æˆ–å…¶ä»–ç»“æŸæ¡ä»¶ï¼Œè°ƒç”¨ this.push(null) æ¥ç»“æŸæµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è‡ªå®šä¹‰æ¸…ç†é€»è¾‘ï¼Œæ¯”å¦‚å…³é—­æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æ¸…ç†èµ„æº&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¦‚æœæœ‰é”™è¯¯ä¼ ç»™ callbackï¼Œå¦åˆ™ä¼  null è¡¨ç¤ºæ­£å¸¸ç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨ MyReadableStream</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> myStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MyReadableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">myStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯»å–å®Œæ¯•&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœ <code>_destroy</code> è¢«è§¦å‘ï¼ˆæ¯”å¦‚è°ƒç”¨ <code>myStream.destroy()</code>ï¼‰ï¼Œå®ƒä¼šæ‰§è¡Œæ¸…ç†å·¥ä½œï¼Œå¦‚å…³é—­æ–‡ä»¶ï¼Œå¹¶é€šè¿‡ <code>callback</code> é€šçŸ¥å¤–ç•Œé”€æ¯è¿‡ç¨‹å·²å®Œæˆã€‚</p><p>æ€»ä¹‹ï¼Œ<code>readable._destroy(err, callback)</code> æä¾›äº†ä¸€ç§æœºåˆ¶æ¥è‡ªå®šä¹‰æ¸…ç†å’Œé”€æ¯æµçš„è¡Œä¸ºï¼Œç¡®ä¿èµ„æºè¢«é€‚å½“é‡Šæ”¾ï¼Œéå¸¸é‡è¦ä½†é€šå¸¸ä»…åœ¨å®ç°è‡ªå®šä¹‰æµæ—¶ä½¿ç”¨ã€‚</p><h4 id="readable-push-chunk-encoding" tabindex="-1"><a class="header-anchor" href="#readable-push-chunk-encoding"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablepushchunk-encoding" target="_blank" rel="noopener noreferrer">readable.push(chunk[, encoding])</a></span></a></h4><p>ç†è§£ <code>readable.push(chunk[, encoding])</code> è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç®€å•äº†è§£ä¸€ä¸‹ Node.js ä¸­çš„ Streamsï¼ˆæµï¼‰ä»¥åŠå…¶ä¸­çš„ Readable æµæ˜¯ä»€ä¹ˆã€‚</p><p>åœ¨ Node.js ä¸­ï¼ŒStreams æ˜¯ç”¨æ¥å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œå°¤å…¶é€‚åˆå¤„ç†å¤§é‡æ•°æ®æˆ–è€…è¯´ä½ ä¸éœ€è¦ä¸€æ¬¡æ€§æ‹¿åˆ°æ‰€æœ‰æ•°æ®çš„æƒ…å†µã€‚æ¯”å¦‚è¯»å–ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶ï¼Œå¦‚æœä½ ä¸€æ¬¡æ€§æŠŠæ–‡ä»¶å…¨éƒ¨è¯»å…¥å†…å­˜ä¸­ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¨‹åºè¿è¡Œç¼“æ…¢ç”šè‡³å´©æºƒã€‚ä½¿ç”¨æµï¼Œä½ å¯ä»¥ä¸€å°å—ä¸€å°å—åœ°è¯»å–å’Œå¤„ç†æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥æ˜¾è‘—æé«˜æ•ˆç‡ã€‚</p><p>Streams ä¸»è¦æœ‰å››ç§ç±»å‹ï¼š</p><ol><li><strong>Readable</strong> - å¯è¯»çš„æµï¼Œä¾‹å¦‚è¯»å–æ–‡ä»¶ã€‚</li><li><strong>Writable</strong> - å¯å†™çš„æµï¼Œä¾‹å¦‚å†™å…¥æ–‡ä»¶ã€‚</li><li><strong>Duplex</strong> - æ—¢å¯è¯»åˆå¯å†™çš„æµã€‚</li><li><strong>Transform</strong> - åœ¨è¯»å†™è¿‡ç¨‹ä¸­å¯ä»¥ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®çš„ Duplex æµã€‚</li></ol><p>ç°åœ¨æˆ‘ä»¬æ¥èšç„¦äº <code>readable.push(chunk[, encoding])</code> è¿™ä¸ªæ–¹æ³•ï¼Œå®ƒæ˜¯ç‰¹å®šç”¨äº <strong>Readable æµ</strong> çš„æ–¹æ³•ã€‚</p><h3 id="readable-push-chunk-encoding-1" tabindex="-1"><a class="header-anchor" href="#readable-push-chunk-encoding-1"><span>readable.push(chunk[, encoding])</span></a></h3><p>è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯å°†ä¸€å—æ•°æ®ï¼ˆ<code>chunk</code>ï¼‰æ·»åŠ åˆ°å¯è¯»æµä¸­ã€‚å¦‚æœæµæ˜¯å¤„äºæš‚åœæ¨¡å¼ï¼Œè¿™æ®µæ•°æ®å°±ä¼šè¢«ä¿å­˜èµ·æ¥ï¼Œç­‰å¾…è¢«æ¶ˆè´¹ï¼ˆå³è¢«è¯»å–ï¼‰ã€‚å¦‚æœæµæ˜¯æµåŠ¨æ¨¡å¼ï¼Œè¿™æ®µæ•°æ®ä¼šç«‹å³è¢«å‘é€å‡ºå»ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥æ‰‹åŠ¨åœ°å‘æµä¸­æ·»åŠ æ•°æ®ã€‚</p><p>å‚æ•°è§£é‡Šï¼š</p><ul><li><code>chunk</code>: æ˜¯ä½ æƒ³è¦æ·»åŠ åˆ°æµä¸­çš„æ•°æ®ç‰‡æ®µã€‚è¿™é€šå¸¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€… Bufferï¼ˆå¦‚æœä½ å¤„ç†çš„æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼‰ã€‚</li><li><code>encoding</code>: å¦‚æœ <code>chunk</code> æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ<code>encoding</code> è¡¨ç¤ºå­—ç¬¦ç¼–ç ï¼ˆä¾‹å¦‚ &#39;utf8&#39;ï¼‰ã€‚å¯¹äº Buffer æ•°æ®ï¼Œåˆ™ä¸éœ€è¦è¿™ä¸ªå‚æ•°ã€‚</li></ul><h4 id="å®é™…åº”ç”¨ä¸¾ä¾‹-3" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¸¾ä¾‹-3"><span>å®é™…åº”ç”¨ä¸¾ä¾‹</span></a></h4><ol><li><strong>åˆ›å»ºè‡ªå®šä¹‰çš„å¯è¯»æµ</strong>ï¼šå‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ï¼Œéœ€è¦ç”Ÿæˆå¤§é‡æ•°æ®å“åº”ç»™å®¢æˆ·ç«¯ï¼Œä½†è¿™äº›æ•°æ®éœ€è¦æŒ‰éœ€ç”Ÿæˆï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ <code>readable.push</code> æ¥å®ç°ã€‚ä½ å¯ä»¥ç»§æ‰¿ Readable æµï¼Œå¹¶åœ¨éœ€è¦æ—¶æ¨é€æ•°æ®åˆ°æµä¸­ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;stream&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> CustomReadable</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dataCount</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dataCount</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> newData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `Data </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dataCount</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dataCount</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `&lt;`</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) { </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾åªç”Ÿæˆ10ä¸ªæ•°æ®å—</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">newData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ²¡æœ‰æ›´å¤šæ•°æ®æ—¶ï¼Œéœ€è¦æ¨é€nullæ¥ç»“æŸæµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> customStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> CustomReadable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">customStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;data&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>æµ‹è¯•æµçš„æ§åˆ¶</strong>ï¼šå¼€å‘è€…å¯ä»¥ä½¿ç”¨ <code>readable.push</code> æ¥æµ‹è¯•æµçš„èƒŒå‹ï¼ˆbackpressureï¼‰æœºåˆ¶ã€‚èƒŒå‹æ˜¯æŒ‡å½“æ•°æ®ç”Ÿäº§é€Ÿåº¦è¶…è¿‡æ¶ˆè´¹é€Ÿåº¦æ—¶ï¼Œç³»ç»Ÿé‡‡å–çš„æ§åˆ¶æªæ–½ã€‚ä½ å¯ä»¥æ‰‹åŠ¨æ§åˆ¶æ¨é€åˆ°æµä¸­çš„æ•°æ®é‡ï¼Œè§‚å¯Ÿæµå¦‚ä½•å¤„ç†è¿™ç§æƒ…å†µã€‚</li></ol><p>ä»¥ä¸Šä¸¤ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­åˆ©ç”¨ <code>readable.push</code> æ–¹æ³•æ¥æ§åˆ¶æ•°æ®æµçš„è¯»å–å’Œå¤„ç†ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥ä¼˜åŒ–æ•°æ®å¤„ç†è¿‡ç¨‹ï¼Œæå‡ç¨‹åºæ€§èƒ½ã€‚</p><h4 id="errors-while-reading" tabindex="-1"><a class="header-anchor" href="#errors-while-reading"><span><a href="https://nodejs.org/docs/latest/api/stream.html#errors-while-reading" target="_blank" rel="noopener noreferrer">Errors while reading</a></span></a></h4><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹ Node.js æ˜¯ä»€ä¹ˆã€‚Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 JavaScript å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScript ä»£ç ã€‚å®ƒéå¸¸é€‚åˆå¼€å‘éœ€è¦é«˜æ€§èƒ½ã€å®æ—¶æˆ–ç½‘ç»œå¯†é›†å‹åº”ç”¨ç¨‹åºçš„åœºæ™¯ã€‚</p><p>ç°åœ¨ï¼Œå…³äºä½ æåˆ°çš„ â€œErrors while readingâ€ éƒ¨åˆ†ï¼Œè¿™æŒ‡çš„æ˜¯åœ¨ä½¿ç”¨ Node.js çš„æµï¼ˆStreamsï¼‰åŠŸèƒ½æ—¶å¯èƒ½é‡åˆ°çš„ä¸€ç±»é”™è¯¯ã€‚æµæ˜¯ Node.js ä¸­ç”¨äºå¤„ç†æ•°æ®ï¼ˆå¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰ï¼‰çš„æŠ½è±¡æ¦‚å¿µï¼Œå®ƒä»¬å¯ä»¥å°†æ•°æ®åˆ†æˆå°å—è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä»è€Œæé«˜äº†ç¨‹åºçš„æ•ˆç‡å’Œæ€§èƒ½ã€‚</p><p>åœ¨è¯»å–ï¼ˆå¦‚ä»æ–‡ä»¶è¯»å–æ•°æ®ã€æ¥æ”¶ç½‘ç»œè¯·æ±‚çš„æ•°æ®ç­‰ï¼‰è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°å„ç§é”™è¯¯ã€‚æ¯”å¦‚ï¼Œè¯•å›¾è¯»å–ä¸å­˜åœ¨çš„æ–‡ä»¶ã€æ²¡æœ‰æƒé™è¯»å–æ–‡ä»¶ã€ç½‘ç»œè¿æ¥ä¸­æ–­ç­‰ã€‚åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­ï¼Œâ€œErrors while readingâ€ ä¸»è¦è®²è¿°äº†å¦‚ä½•å¤„ç†è¿™äº›åœ¨è¯»å–æ•°æ®æµæ—¶å‘ç”Ÿçš„é”™è¯¯ã€‚</p><h3 id="å¤„ç†æµè¯»å–ä¸­çš„é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#å¤„ç†æµè¯»å–ä¸­çš„é”™è¯¯"><span>å¤„ç†æµè¯»å–ä¸­çš„é”™è¯¯ï¼š</span></a></h3><ol><li><strong>ç›‘å¬ &#39;error&#39; äº‹ä»¶</strong>ï¼šå½“è¯»å–æ•°æ®æµä¸­å‡ºç°é”™è¯¯æ—¶ï¼Œæµä¼šè§¦å‘ä¸€ä¸ª &#39;error&#39; äº‹ä»¶ã€‚é€šè¿‡ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼Œå¯ä»¥æ•è·å¹¶å¤„ç†é”™è¯¯ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;somefile.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬ &#39;error&#39; äº‹ä»¶ä»¥æ•è·å¹¶å¤„ç†é”™è¯¯</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;An error occurred:&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-23" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-23"><span>å®é™…è¿ç”¨ç¤ºä¾‹ï¼š</span></a></h3><ol><li><p><strong>è¯»å–æ–‡ä»¶</strong>ï¼šå‡è®¾ä½ æ­£åœ¨å°è¯•ä»ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­è¯»å–å†…å®¹ï¼Œä½†è¯¥æ–‡ä»¶å¯èƒ½ä¸å­˜åœ¨æˆ–ä¸å¯è®¿é—®ã€‚ä½¿ç”¨ä¸Šè¿°æ–¹æ³•ç›‘å¬ &#39;error&#39; äº‹ä»¶ï¼Œä½ å¯ä»¥ä¼˜é›…åœ°å¤„ç†è¿™äº›é”™è¯¯ï¼Œè€Œä¸ä¼šå¯¼è‡´ç¨‹åºå´©æºƒã€‚</p></li><li><p><strong>ç½‘ç»œè¯·æ±‚</strong>ï¼šå½“ä½ ä½¿ç”¨æµæ¥å¤„ç†æ¥è‡ª HTTP è¯·æ±‚çš„æ•°æ®æ—¶ï¼Œå¦‚æœç½‘ç»œè¿æ¥çªç„¶ä¸­æ–­æˆ–æœåŠ¡ç«¯å…³é—­è¿æ¥ï¼Œé€šè¿‡ç›‘å¬ &#39;error&#39; äº‹ä»¶ï¼Œä½ å¯ä»¥å¤„ç†è¿™äº›å¼‚å¸¸æƒ…å†µï¼Œæ¯”å¦‚é‡è¯•è¯·æ±‚æˆ–å‘ç”¨æˆ·æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ã€‚</p></li><li><p><strong>ç®¡é“ï¼ˆPipingï¼‰æ“ä½œ</strong>ï¼šå½“ä½ å°†ä¸€ä¸ªæµçš„è¾“å‡ºè¿æ¥åˆ°å¦ä¸€ä¸ªæµçš„è¾“å…¥æ—¶ï¼ˆä¾‹å¦‚ï¼Œä»æ–‡ä»¶è¯»å–æ•°æ®ç„¶åç›´æ¥å†™å…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ï¼‰ï¼Œä»»æ„ä¸€ç«¯å‘ç”Ÿé”™è¯¯éƒ½å¯èƒ½å½±å“æ•´ä¸ªæ“ä½œã€‚ç›‘å¬ &#39;error&#39; äº‹ä»¶ï¼Œå¹¶åœ¨å‘ç”Ÿé”™è¯¯æ—¶é‡‡å–é€‚å½“çš„æ¢å¤æªæ–½ï¼ˆå¦‚å…³é—­æ‰€æœ‰ç›¸å…³æµï¼‰ï¼Œå¯ä»¥é¿å…æ•°æ®ä¸¢å¤±æˆ–ç¨‹åºå¼‚å¸¸ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œæ­£ç¡®åœ°å¤„ç†æµä¸­çš„é”™è¯¯å¯¹äºå¼€å‘ç¨³å®šã€å¯é çš„ Node.js åº”ç”¨è‡³å…³é‡è¦ã€‚é€šè¿‡ç›‘å¬å’Œå“åº” &#39;error&#39; äº‹ä»¶ï¼Œä½ å¯ä»¥ç¡®ä¿å³ä½¿é¢ä¸´é—®é¢˜ï¼Œåº”ç”¨ä¹Ÿèƒ½ä»¥ä¼˜é›…å’Œæ§åˆ¶çš„æ–¹å¼ç»§ç»­è¿è¡Œæˆ–ç»ˆæ­¢ã€‚</p><h4 id="an-example-counting-stream" tabindex="-1"><a class="header-anchor" href="#an-example-counting-stream"><span><a href="https://nodejs.org/docs/latest/api/stream.html#an-example-counting-stream" target="_blank" rel="noopener noreferrer">An example counting stream</a></span></a></h4><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„æµï¼ˆStreamsï¼‰ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯ä¸€ç§å¤„ç†æ•°æ®æˆ–ä¿¡æ¯çš„æ–¹å¼ï¼Œå…¶ä¸­æ•°æ®å¯ä»¥é€å—å¤„ç†ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™å¯¹äºå¤„ç†å¤§å‹æ–‡ä»¶æˆ–å®æ—¶æ•°æ®éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒæé«˜äº†æ•ˆç‡å¹¶å‡å°‘äº†ç¨‹åºçš„å†…å­˜éœ€æ±‚ã€‚</p><p>åœ¨ Node.js v21.7.1 æ–‡æ¡£ä¸­æä¾›çš„â€œè®¡æ•°æµâ€ä¾‹å­ä¸­ï¼Œå±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰æµï¼Œè¿™ä¸ªæµçš„ä½œç”¨æ˜¯é€šè¿‡è¯»å–ä¼ å…¥çš„æ•°æ®å¹¶è®¡æ•°ï¼Œæ¥æ¼”ç¤º Node.js ä¸­æµçš„åŸºæœ¬æ¦‚å¿µå’Œæ“ä½œã€‚</p><p>è®©æˆ‘ä»¬é€æ­¥åˆ†æè¿™ä¸ªä¾‹å­ï¼š</p><h3 id="åˆ›å»ºè®¡æ•°æµ" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºè®¡æ•°æµ"><span>åˆ›å»ºè®¡æ•°æµ</span></a></h3><p>é¦–å…ˆï¼Œè¦åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„æµï¼Œä½ éœ€è¦å¼•å…¥ Node.js çš„<code>stream</code>æ¨¡å—ï¼Œå¹¶ä¸”ä½¿ç”¨è¿™ä¸ªæ¨¡å—ä¸­çš„<code>Transform</code>ç±»ã€‚<code>Transform</code>æµæ˜¯ä¸€ç§åŒå·¥æµï¼ˆå³æ—¢å¯è¯»ä¹Ÿå¯å†™çš„æµï¼‰ï¼Œå®ƒå…è®¸ä½ åœ¨è¯»å†™è¿‡ç¨‹ä¸­ä¿®æ”¹æˆ–å˜æ¢æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª<code>Transform</code>ç±»çš„<code>CountingStream</code>ç±»ã€‚åœ¨è¿™ä¸ªç±»ä¸­ï¼Œæˆ‘ä»¬ä¼šå®ç°ä¸€ä¸ªåä¸º<code>_transform</code>çš„æ–¹æ³•ã€‚æ¯å½“æœ‰æ–°çš„æ•°æ®å—ï¼ˆchunkï¼‰è¢«å†™å…¥åˆ°è¿™ä¸ªæµä¸­æ—¶ï¼Œ<code>_transform</code>æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œè®¡æ•°æˆ–å…¶ä»–å¤„ç†ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> CountingStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆå§‹åŒ–è®¡æ•°ä¸º0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¡ç®—ç´¯è®¡æ¥æ”¶åˆ°çš„å­—èŠ‚é•¿åº¦</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Chunk received (</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes): </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _flush</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Total length received: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ª<code>CountingStream</code>ç±»ä¸­ï¼š</p><ul><li><code>constructor</code>æ–¹æ³•åˆå§‹åŒ–ç±»å®ä¾‹ï¼Œè®¾ç½®åˆå§‹è®¡æ•°ä¸º 0ã€‚</li><li><code>_transform</code>æ–¹æ³•å¤„ç†æ¯ä¸ªæ•°æ®å—ï¼Œæ›´æ–°è®¡æ•°ï¼Œå¹¶é€šè¿‡<code>this.push()</code>æ–¹æ³•å‘é€å¸¦æœ‰æ•°æ®å—ä¿¡æ¯çš„å­—ç¬¦ä¸²ã€‚</li><li><code>_flush</code>æ–¹æ³•æ˜¯åœ¨æµç»“æŸæ—¶è°ƒç”¨çš„ï¼Œæ­¤å¤„ç”¨æ¥æ¨é€æ€»å­—èŠ‚é•¿åº¦ä¿¡æ¯ã€‚</li></ul><h3 id="ä½¿ç”¨è®¡æ•°æµ" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨è®¡æ•°æµ"><span>ä½¿ç”¨è®¡æ•°æµ</span></a></h3><p>ä¸€æ—¦æˆ‘ä»¬å®šä¹‰äº†<code>CountingStream</code>ç±»ï¼Œå°±å¯ä»¥åˆ›å»ºå…¶å®ä¾‹å¹¶å°†å…¶ç”¨ä½œå…¶ä»–æµçš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”é€šè¿‡æˆ‘ä»¬çš„<code>CountingStream</code>æ¥è®¡æ•°å¹¶æ˜¾ç¤ºæ¯ä¸ªæ•°æ®å—çš„ä¿¡æ¯ä»¥åŠæ€»å­—èŠ‚é•¿åº¦ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> countingStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> CountingStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†è¯»å–çš„æ•°æ®é€šè¿‡è®¡æ•°æµå¤„ç†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">countingStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†å¤„ç†åçš„æ•°æ®è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼ˆæ§åˆ¶å°ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">countingStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼š</p><ul><li>æˆ‘ä»¬ä½¿ç”¨<code>fs.createReadStream</code>åˆ›å»ºäº†ä¸€ä¸ªä»<code>example.txt</code>æ–‡ä»¶ä¸­è¯»å–æ•°æ®çš„å¯è¯»æµã€‚</li><li>é€šè¿‡<code>.pipe(countingStream)</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å°†å¯è¯»æµè¿æ¥åˆ°æˆ‘ä»¬çš„è®¡æ•°æµï¼Œè¿™æ ·æ–‡ä»¶ä¸­çš„æ•°æ®å°±ä¼šæµç»æˆ‘ä»¬çš„è®¡æ•°æµã€‚</li><li>æœ€åï¼Œæˆ‘ä»¬å°†è®¡æ•°æµè¿æ¥åˆ°<code>process.stdout</code>ï¼ˆæ ‡å‡†è¾“å‡ºï¼‰ï¼Œæ‰€ä»¥è½¬æ¢åçš„æ•°æ®ï¼ˆåŒ…æ‹¬æ¯ä¸ªæ•°æ®å—çš„å¤§å°å’Œæ€»å¤§å°ï¼‰ä¼šè¢«æ‰“å°åˆ°æ§åˆ¶å°ã€‚</li></ul><p>é€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Node.js ä¸­æµçš„å¼ºå¤§ä¹‹å¤„ï¼šèƒ½å¤Ÿä»¥é«˜æ•ˆã€å¯æ‰©å±•çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚æ— è®ºæ˜¯å¤„ç†å¤§å‹æ–‡ä»¶è¿˜æ˜¯å®æ—¶æ•°æ®æµï¼Œä½¿ç”¨æµéƒ½èƒ½è®©ä½ çš„åº”ç”¨æ›´åŠ é«˜æ•ˆå’Œå“åº”ã€‚</p><h3 id="implementing-a-duplex-stream" tabindex="-1"><a class="header-anchor" href="#implementing-a-duplex-stream"><span><a href="https://nodejs.org/docs/latest/api/stream.html#implementing-a-duplex-stream" target="_blank" rel="noopener noreferrer">Implementing a duplex stream</a></span></a></h3><p>Node.js ä¸­çš„ Duplex Stream æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„æµï¼Œå®ƒå¯ä»¥åŒæ—¶ç”¨äºè¯»å†™æ“ä½œã€‚æƒ³è±¡ä¸€ä¸‹ï¼ŒDuplex Stream å°±åƒæ˜¯ç”µè¯é€šè¯ï¼Œä½ æ—¢å¯ä»¥é€šè¿‡å®ƒè¯´è¯ï¼ˆå†™å…¥æ•°æ®ï¼‰ä¹Ÿå¯ä»¥å¬ï¼ˆè¯»å–æ•°æ®ï¼‰ã€‚è¿™å’Œå•å‘æµä¸åŒï¼Œåè€…è¦ä¹ˆåªèƒ½å†™å…¥ï¼ˆWritable Streamï¼‰ï¼Œè¦ä¹ˆåªèƒ½è¯»å–ï¼ˆReadable Streamï¼‰ã€‚</p><p>åœ¨ Node.js v21.7.1 æ–‡æ¡£ä¸­è®²è§£äº†å¦‚ä½•å®ç°ä¸€ä¸ª Duplex Streamã€‚æ¥ä¸‹æ¥æˆ‘ä¼šç”¨ä¸€ä¸ªç®€æ˜“ä½†å…·ä½“çš„ä¾‹å­æ¥å¸®åŠ©ä½ ç†è§£è¿™ä¸ªæ¦‚å¿µã€‚</p><h3 id="å®ç°-duplex-stream" tabindex="-1"><a class="header-anchor" href="#å®ç°-duplex-stream"><span>å®ç° Duplex Stream</span></a></h3><p>ä¸ºäº†å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„ Duplex Streamï¼Œä½ éœ€è¦ä½¿ç”¨ Node.js çš„ <code>stream</code> æ¨¡å—ä¸­çš„ <code>Duplex</code> ç±»ã€‚åŸºæœ¬çš„æ­¥éª¤åŒ…æ‹¬ï¼š</p><ol><li><strong>å¼•å…¥ <code>stream</code> æ¨¡å—</strong>ï¼šé¦–å…ˆï¼Œä½ éœ€è¦å¼•å…¥ Node.js çš„ <code>stream</code> æ¨¡å—ã€‚</li><li><strong>åˆ›å»ºä¸€ä¸ªç±»ï¼Œç»§æ‰¿è‡ª <code>Duplex</code></strong>ï¼šé€šè¿‡æ‰©å±• <code>Duplex</code> ç±»æ¥åˆ›å»ºä½ è‡ªå·±çš„ Duplex Stream å®ç°ã€‚</li><li><strong>å®ç° <code>_read</code> å’Œ <code>_write</code> æ–¹æ³•</strong>ï¼š<code>Duplex</code> ç±»éœ€è¦ä½ å®ç°ä¸¤ä¸ªæ–¹æ³• <code>_read(size)</code> å’Œ <code>_write(chunk, encoding, callback)</code>ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«è´Ÿè´£å¤„ç†æµçš„è¯»å–å’Œå†™å…¥æ“ä½œã€‚</li></ol><h3 id="å®é™…ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å®é™…ç¤ºä¾‹"><span>å®é™…ç¤ºä¾‹</span></a></h3><p>å‡è®¾æˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªç®€å•çš„è½¬æ¢æµï¼Œå®ƒå°†è¾“å…¥çš„æ–‡æœ¬è½¬æ¢ä¸ºå¤§å†™ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Duplex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> MyDuplexStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Duplex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åœ¨çœŸå®åœºæ™¯ä¸­ï¼Œè¿™é‡Œå¯èƒ½æ˜¯ä»æŸå¤„è·å–æ•°æ®ç„¶åpushåˆ°å†…éƒ¨bufferä¸­</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ä¸ºäº†ç¤ºä¾‹ç®€æ˜ï¼Œæˆ‘ä»¬ç›´æ¥push nullè¡¨ç¤ºæ²¡æœ‰æ›´å¤šæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å°†è¾“å…¥çš„æ•°æ®è½¬æ¢ä¸ºå¤§å†™</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> output</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toUpperCase</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è¾“å‡ºè½¬æ¢åçš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">output</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è¡¨ç¤ºå†™å…¥å®Œæˆ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨æˆ‘ä»¬çš„Duplexæµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> duplexStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> MyDuplexStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å†™å…¥æ•°æ®ï¼Œå°†è§¦å‘ _write æ–¹æ³•ï¼Œå¹¶ä¸”ç»è¿‡è½¬æ¢æ‰“å°å‡ºæ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">duplexStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥å®Œæˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ•°æ®è¯»å–ç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">duplexStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯»å–ç»“æŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>MyDuplexStream</code> çš„ç±»ï¼Œå®ƒç»§æ‰¿è‡ª <code>Duplex</code> ç±»ã€‚æˆ‘ä»¬é‡å†™äº† <code>_read</code> å’Œ <code>_write</code> æ–¹æ³•æ¥å®ç°æˆ‘ä»¬çš„é€»è¾‘ã€‚è¿™é‡Œï¼Œ<code>_write</code> æ–¹æ³•å°†æ¥æ”¶åˆ°çš„æ–‡æœ¬æ•°æ®è½¬æ¢ä¸ºå¤§å†™å¹¶æ‰“å°å‡ºæ¥ï¼Œè€Œ <code>_read</code> æ–¹æ³•ç®€åŒ–å¤„ç†ï¼Œç›´æ¥æ¨é€ <code>null</code> æ¥è¡¨ç¤ºæµçš„ç»“æŸã€‚</p><p>è¿™ä¸ªç®€å•çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºè‡ªå·±çš„ Duplex Streamï¼Œå®ƒèƒ½å¤Ÿè¯»å†™æ•°æ®ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½ä¼šç»“åˆç½‘ç»œé€šä¿¡ã€æ–‡ä»¶å¤„ç†ç­‰æ–¹é¢æ›´å¤æ‚çš„éœ€æ±‚æ¥å®ç°æ›´åŠŸèƒ½ä¸°å¯Œçš„ Duplex Streamsã€‚</p><h4 id="new-stream-duplex-options" tabindex="-1"><a class="header-anchor" href="#new-stream-duplex-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#new-streamduplexoptions" target="_blank" rel="noopener noreferrer">new stream.Duplex(options)</a></span></a></h4><p>äº†è§£ <code>stream.Duplex</code> ç±»ä»¥åŠ<code>Node.js</code>ä¸­æµï¼ˆStreamsï¼‰çš„æ¦‚å¿µæ˜¯å­¦ä¹ <code>Node.js</code>çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ã€‚æˆ‘å°†å°½å¯èƒ½åœ°ç®€åŒ–è§£é‡Šï¼ŒåŒæ—¶ç»™å‡ºä¸€äº›å®é™…ä¾‹å­ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ã€‚</p><h3 id="æµ-streams-åŸºç¡€" tabindex="-1"><a class="header-anchor" href="#æµ-streams-åŸºç¡€"><span>æµ(Streams)åŸºç¡€</span></a></h3><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬äº†è§£ä»€ä¹ˆæ˜¯æµï¼ˆStreamï¼‰ã€‚åœ¨<code>Node.js</code>ä¸­ï¼Œæµæ˜¯ç”¨æ¥å¤„ç†æ•°æ®çš„æŠ½è±¡æ¥å£ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½ æœ‰ä¸€æ¡¶æ°´éœ€è¦ä» A åœ°ç‚¹å€’åˆ° B åœ°ç‚¹ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€æ¬¡æ€§æ‹¿èµ·æ•´æ¡¶æ°´è½¬ç§»â€”â€”è¿™ç±»ä¼¼äºä¼ ç»Ÿçš„æ•°æ®å¤„ç†æ–¹å¼ï¼Œç­‰å¾…æ‰€æœ‰æ•°æ®åŠ è½½å®Œæˆåå†è¿›è¡Œå¤„ç†ï¼›æˆ–è€…ï¼Œä½ å¯ä»¥é€‰æ‹©ç”¨æ¯å­ä»æ¡¶é‡Œèˆ€å‡ºæ°´ï¼Œé€æ­¥å€’å…¥ B åœ°ç‚¹çš„å®¹å™¨ä¸­â€”â€”è¿™å°±åƒæµçš„å·¥ä½œæ–¹å¼ï¼Œæ•°æ®è¢«åˆ†æˆå°å—é€æ­¥å¤„ç†å’Œä¼ è¾“ï¼Œä¸å¿…ç­‰å¾…æ‰€æœ‰æ•°æ®éƒ½å‡†å¤‡å¥½ã€‚</p><p>æµåœ¨<code>Node.js</code>ä¸­æœ‰å››ç§åŸºæœ¬ç±»å‹ï¼šå¯è¯»ï¼ˆReadableï¼‰ã€å¯å†™ï¼ˆWritableï¼‰ã€åŒå·¥ï¼ˆDuplexï¼‰å’Œè½¬æ¢æµï¼ˆTransformï¼‰ã€‚</p><ul><li><strong>å¯è¯»</strong> æµå…è®¸<code>Node.js</code>ä»ä¸€ä¸ªæ•°æ®æºï¼ˆå¦‚æ–‡ä»¶æˆ–ç½‘ç»œè¿æ¥ï¼‰è¯»å–æ•°æ®ã€‚</li><li><strong>å¯å†™</strong> æµå…è®¸<code>Node.js</code>å‘ç›®çš„åœ°ï¼ˆå¦‚æ–‡ä»¶ã€ç»ˆç«¯æˆ–ç½‘ç»œè¿æ¥ï¼‰å†™å…¥æ•°æ®ã€‚</li><li><strong>åŒå·¥</strong>ï¼ˆDuplexï¼‰æµæ—¢å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™ï¼Œå°±åƒç”µè¯é€šè¯ï¼Œä¿¡æ¯å¯ä»¥åŒå‘æµåŠ¨ã€‚</li><li><strong>è½¬æ¢æµ</strong>ï¼ˆTransformï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„åŒå·¥æµï¼Œå®ƒå¯ä»¥ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®ï¼Œå½“æ•°æ®ä»å¯è¯»ç«¯æµå‘å¯å†™ç«¯æ—¶ã€‚</li></ul><h3 id="duplex-streams" tabindex="-1"><a class="header-anchor" href="#duplex-streams"><span>Duplex Streams</span></a></h3><p><code>Duplex</code>æµæ˜¯ä¸€ç§åŒæ—¶å®ç°äº†<code>Readable</code>å’Œ<code>Writable</code>æ¥å£çš„æµï¼Œå…è®¸æ•°æ®åœ¨ä¸¤ä¸ªæ–¹å‘ä¸ŠæµåŠ¨ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä»<code>Duplex</code>æµä¸­è¯»å–æ•°æ®ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å†™å…¥æ•°æ®åˆ°å®ƒé‡Œé¢ã€‚</p><h4 id="åˆ›å»º-duplex-æµ" tabindex="-1"><a class="header-anchor" href="#åˆ›å»º-duplex-æµ"><span>åˆ›å»º Duplex æµ</span></a></h4><p>åœ¨ Node.js v21.7.1 ä¸­åˆ›å»ºä¸€ä¸ª<code>Duplex</code>æµå®ä¾‹é€šå¸¸éœ€è¦ä½¿ç”¨<code>new stream.Duplex(options)</code>ï¼Œå…¶ä¸­<code>options</code>å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†æµçš„é…ç½®é€‰é¡¹ã€‚ä¾‹å¦‚ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Duplex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> duplexStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Duplex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å½“æ•°æ®è¢«æ¶ˆè´¹æ—¶çš„é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å½“æ•°æ®è¢«å†™å…¥æ—¶çš„é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>read</code>æ–¹æ³•ä¼šåœ¨æµéœ€è¦æä¾›æ•°æ®æ—¶è¢«è°ƒç”¨ã€‚<code>write</code>æ–¹æ³•åˆ™æ˜¯å½“æ•°æ®è¢«å†™å…¥æµæ—¶è°ƒç”¨ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-8" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-8"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><ol><li><p><strong>ç½‘ç»œé€šä¿¡</strong>ï¼šå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªèŠå¤©åº”ç”¨ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å¯ä»¥é€šè¿‡<code>Duplex</code>æµæ¥å®ç°ã€‚å®¢æˆ·ç«¯å¯ä»¥å°†æ¶ˆæ¯å†™å…¥åˆ°æµä¸­ï¼Œè¿™äº›æ¶ˆæ¯éšåè¢«æœåŠ¡å™¨è¯»å–å¹¶å¹¿æ’­ç»™å…¶ä»–å®¢æˆ·ç«¯ã€‚åŒæ—¶ï¼Œå®¢æˆ·ç«¯ä¹Ÿèƒ½ä»åŒä¸€ä¸ªæµä¸­è¯»å–æœåŠ¡å™¨å‘é€è¿‡æ¥çš„æ¶ˆæ¯ã€‚</p></li><li><p><strong>æ–‡ä»¶æ“ä½œ</strong>ï¼šè™½ç„¶å¯¹äºæ–‡ä»¶æ“ä½œæ›´å¸¸è§çš„åšæ³•æ˜¯ä½¿ç”¨å•å‘æµï¼ˆå¦‚<code>fs.createReadStream</code>æˆ–<code>fs.createWriteStream</code>ï¼‰ï¼Œä½†åœ¨æŸäº›å¤æ‚çš„åœºæ™¯ä¸‹ï¼Œä½ å¯èƒ½éœ€è¦å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œå³æ—¶çš„è¯»å†™å¤„ç†ï¼Œè¿™æ—¶<code>Duplex</code>æµå°±æ˜¾å¾—éå¸¸æœ‰ç”¨ã€‚</p></li><li><p><strong>æ•°æ®è½¬æ¢</strong>ï¼šå¦‚æœä½ éœ€è¦ä¸€ä¸ªå®æ—¶åœ°å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†å’Œè§£å¯†çš„ç®¡é“ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨<code>Duplex</code>æµã€‚æ•°æ®å¯ä»¥è¢«å†™å…¥æµè¿›è¡ŒåŠ å¯†ï¼Œç„¶åä»æµä¸­è¯»å‡ºå·²åŠ å¯†çš„æ•°æ®ã€‚åä¹‹äº¦ç„¶ã€‚</p></li></ol><p>ç†è§£å’ŒæŒæ¡æµçš„æ¦‚å¿µå¯¹äºé«˜æ•ˆå¤„ç†æ•°æ®å’Œæ„å»ºé«˜æ€§èƒ½çš„<code>Node.js</code>åº”ç”¨è‡³å…³é‡è¦ã€‚å¸Œæœ›è¿™ä¸ªè§£é‡Šå’Œä¾‹å­èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£<code>Duplex</code>æµï¼</p><h4 id="an-example-duplex-stream" tabindex="-1"><a class="header-anchor" href="#an-example-duplex-stream"><span><a href="https://nodejs.org/docs/latest/api/stream.html#an-example-duplex-stream" target="_blank" rel="noopener noreferrer">An example duplex stream</a></span></a></h4><p>Node.js ä¸­çš„æµï¼ˆStreamsï¼‰æ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œéå¸¸é€‚åˆå¤„ç†å¤§é‡æ•°æ®æˆ–è€…ä½ ä¸å¸Œæœ›ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­çš„åœºæ™¯ã€‚åœ¨ Node.js é‡Œï¼Œæµçš„æ¦‚å¿µéå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒä¸ Node.js çš„æ ¸å¿ƒç‰¹æ€§â€”â€”éé˜»å¡ I/O æ“ä½œç´§å¯†å…³è”ã€‚</p><p>åœ¨ Node.js ä¸­ï¼Œæœ‰å‡ ç§ä¸åŒç±»å‹çš„æµï¼š</p><ul><li><strong>å¯è¯»æµï¼ˆReadable streamsï¼‰</strong>ï¼šå…è®¸ä½ è¯»å–æ•°æ®ï¼Œæ¯”å¦‚ä»æ–‡ä»¶è¯»å–ã€‚</li><li><strong>å¯å†™æµï¼ˆWritable streamsï¼‰</strong>ï¼šå…è®¸ä½ å†™å…¥æ•°æ®ï¼Œæ¯”å¦‚å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚</li><li><strong>åŒå·¥æµï¼ˆDuplex streamsï¼‰</strong>ï¼šæ—¢å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™çš„æµï¼Œæ¯”å¦‚ç½‘ç»œå¥—æ¥å­—ã€‚</li><li><strong>è½¬æ¢æµï¼ˆTransform streamsï¼‰</strong>ï¼šä¸€ç§åŒå·¥æµï¼Œä½†å®ƒå¯ä»¥ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®ï¼Œå½“æ•°æ®ä»å¯è¯»ç«¯æµå‘å¯å†™ç«¯æ—¶ã€‚</li></ul><h3 id="åŒå·¥æµç¤ºä¾‹è§£æ" tabindex="-1"><a class="header-anchor" href="#åŒå·¥æµç¤ºä¾‹è§£æ"><span>åŒå·¥æµç¤ºä¾‹è§£æ</span></a></h3><p>åŒå·¥æµï¼ˆDuplex streamï¼‰å…è®¸åŒæ—¶è¿›è¡Œè¯»å†™æ“ä½œã€‚ä¸€ä¸ªå¾ˆå¥½çš„å®é™…ä¾‹å­æ˜¯ç½‘ç»œé€šä¿¡ï¼Œå…¶ä¸­å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éœ€è¦åŒæ—¶å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚</p><p>åœ¨ Node.js v21.7.1 çš„æ–‡æ¡£ä¸­æåˆ°çš„åŒå·¥æµç¤ºä¾‹ä¸»è¦å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªç®€å•çš„åŒå·¥æµã€‚è¿™ä¸ªä¾‹å­å¯èƒ½ä¼šç”¨åˆ° <code>stream</code> æ¨¡å—ä¸­çš„ <code>Duplex</code> ç±»æˆ–è€… <code>Readable</code> å’Œ <code>Writable</code> ç±»æ¥å®šåˆ¶è‡ªå·±çš„åŒå·¥æµè¡Œä¸ºã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºäºå®˜æ–¹æ–‡æ¡£ç®€åŒ–åçš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬å‡è®¾ä½ æƒ³åˆ›å»ºä¸€ä¸ªç®€å•çš„åŒå·¥æµï¼Œè¿™ä¸ªæµå°†æ¥æ”¶è¾“å…¥æ•°æ®ï¼Œç„¶ååŸæ ·è¾“å‡ºï¼ˆå›å£°æ•ˆåº”ï¼‰ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Duplex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªåŒå·¥æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> duplexStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Duplex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å®šä¹‰è¯»å–æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> getSomeData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æ˜¯ä¸€ä¸ªè·å–æ•°æ®çš„å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨é€æ•°æ®ä½¿å…¶å¯è¯»</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">noMoreData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">      // å¦‚æœæ²¡æœ‰æ›´å¤šæ•°æ®äº†</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘é€ &#39;null&#39; è¡¨ç¤ºæµç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å®šä¹‰å†™å…¥æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    processTheData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æ˜¯ä¸€ä¸ªå¤„ç†æ•°æ®çš„å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨åŒå·¥æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">duplexStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">duplexStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;hello world&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å†™å…¥æ•°æ®</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ª <code>Duplex</code> æµéœ€è¦æä¾›ä¸¤ä¸ªä¸»è¦æ–¹æ³•ï¼š<code>read</code> å’Œ <code>write</code>ã€‚</li><li><code>read</code> æ–¹æ³•ç”¨äºå®šä¹‰å¦‚ä½•è¯»å–æ•°æ®ã€‚è¿™é‡Œé€šè¿‡ <code>this.push(chunk)</code> æ¥æ¨é€æ•°æ®åˆ°è¯»å–é˜Ÿåˆ—ã€‚</li><li><code>write</code> æ–¹æ³•ç”¨äºå®šä¹‰å¦‚ä½•å¤„ç†å†™å…¥çš„æ•°æ®ã€‚å†™å…¥å®Œæˆåï¼Œè°ƒç”¨ <code>callback()</code> è¡¨ç¤ºå®Œæˆã€‚</li><li>ä½ å¯ä»¥ç›‘å¬ <code>data</code> äº‹ä»¶æ¥å¤„ç†æµä¸­çš„æ•°æ®ï¼Œç±»ä¼¼äºä¸Šé¢çš„ <code>duplexStream.on(&#39;data&#39;, callback)</code>ã€‚</li></ul><p>è¯·æ³¨æ„ï¼Œä»¥ä¸Šä»£ç æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç¤ºä¾‹ï¼ŒçœŸå®åº”ç”¨åœºæ™¯ä¸­ä½ å¯èƒ½éœ€è¦å¤„ç†é”™è¯¯ã€æµæ§åˆ¶ç­‰å¤æ‚æƒ…å†µã€‚è€Œä¸”ï¼Œ<code>getSomeData()</code> å’Œ <code>processTheData()</code> éƒ½æ˜¯å‡è®¾çš„å‡½æ•°ï¼Œç”¨äºè¯´æ˜åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œä½ éœ€è¦ç”¨å…·ä½“çš„é€»è¾‘æ¥æ›¿ä»£è¿™äº›éƒ¨åˆ†ã€‚</p><h4 id="object-mode-duplex-streams" tabindex="-1"><a class="header-anchor" href="#object-mode-duplex-streams"><span><a href="https://nodejs.org/docs/latest/api/stream.html#object-mode-duplex-streams" target="_blank" rel="noopener noreferrer">Object mode duplex streams</a></span></a></h4><p>Node.js ä¸­çš„æµï¼ˆStreamsï¼‰æ˜¯å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œå°¤å…¶é€‚åˆå¤„ç†å¤§é‡æ•°æ®æˆ–è€…ä½ ä¸å¸Œæœ›ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­çš„æƒ…å†µã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ã€æˆ–è€…æ—¢å¯è¯»ä¹Ÿå¯å†™çš„ï¼ˆå³åŒå·¥æµ Duplexï¼‰ã€‚åœ¨äº†è§£ Object mode duplex streams ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç†è§£å‡ ä¸ªåŸºç¡€æ¦‚å¿µï¼š</p><ol><li><strong>æµ(Streams)</strong>: æµæ˜¯ä¸€ç³»åˆ—æ•°æ®çš„é›†åˆï¼Œåƒä¸€ä¸ªç®¡é“ä¸€æ ·ï¼Œå…è®¸æ•°æ®ä»ä¸€ä¸ªåœ°æ–¹æµå‘å¦ä¸€ä¸ªåœ°æ–¹ã€‚</li><li><strong>åŒå·¥æµ(Duplex Streams)</strong>: å¯ä»¥åŒæ—¶è¿›è¡Œè¯»å†™æ“ä½œçš„æµã€‚å°±åƒç”µè¯é€šè¯ï¼Œä¸€æ–¹è¯´è¯å¦ä¸€æ–¹èƒ½å¬åˆ°ï¼ŒåŒæ—¶ï¼Œå¦ä¸€æ–¹ä¹Ÿèƒ½è¯´è¯ç¬¬ä¸€æ–¹ä¹Ÿèƒ½å¬åˆ°ã€‚</li><li><strong>å¯¹è±¡æ¨¡å¼(Object Mode)</strong>: æµé»˜è®¤æ“ä½œ Buffer æˆ–å­—ç¬¦ä¸²æ•°æ®ã€‚ä½†åœ¨å¯¹è±¡æ¨¡å¼ä¸‹ï¼Œæµå¯ä»¥æ“ä½œä»»æ„ JavaScript å¯¹è±¡ã€‚</li></ol><h3 id="object-mode-duplex-streams-1" tabindex="-1"><a class="header-anchor" href="#object-mode-duplex-streams-1"><span>Object Mode Duplex Streams</span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®ºåˆ° Node.js ä¸­çš„<code>Object mode duplex streams</code>ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯ä¸€ç§ç‰¹æ®Šçš„åŒå·¥æµï¼Œå®ƒåœ¨å¯¹è±¡æ¨¡å¼ä¸‹è¿è¡Œã€‚è¿™æ„å‘³ç€è¿™ç§æµå¯ä»¥åŒæ—¶è¯»å†™ JavaScript å¯¹è±¡ï¼Œè€Œä¸ä»…ä»…æ˜¯ Buffer æˆ–å­—ç¬¦ä¸²ã€‚</p><p><strong>å®é™…ç”¨é€”çš„ä¾‹å­</strong></p><ol><li><p><strong>ç½‘ç»œé€šä¿¡</strong>:</p><ul><li>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªèŠå¤©åº”ç”¨ç¨‹åºï¼ŒæœåŠ¡å™¨ç«¯ä½¿ç”¨ Node.jsã€‚ä½ å¯ä»¥ä½¿ç”¨å¯¹è±¡æ¨¡å¼çš„åŒå·¥æµæ¥å¤„ç†ä¼ å…¥å’Œä¼ å‡ºçš„æ¶ˆæ¯ã€‚æ¯æ¡æ¶ˆæ¯éƒ½ä½œä¸ºä¸€ä¸ªå¯¹è±¡å¤„ç†ï¼Œå…¶ä¸­åŒ…å«ä¿¡æ¯å¦‚å‘é€è€…ã€æ¥æ”¶è€…ã€æ—¶é—´æˆ³å’Œæ¶ˆæ¯å†…å®¹ã€‚è¿™ä½¿å¾—åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å¤„ç†å’Œè½¬å‘æ¶ˆæ¯å˜å¾—éå¸¸ç›´è§‚å’Œé«˜æ•ˆã€‚</li></ul></li><li><p><strong>æ•°æ®è½¬æ¢</strong>:</p><ul><li>æƒ³è±¡ä½ æ­£åœ¨å¤„ç†ä¸€ä¸ªæ•°æ®ç®¡é“ï¼Œéœ€è¦ä»ä¸€ä¸ªæºå®æ—¶è¯»å–æ•°æ®ï¼Œå¯¹æ•°æ®åšä¸€äº›è½¬æ¢ï¼Œç„¶åå†™å…¥ç›®çš„åœ°ã€‚æ¯”å¦‚ï¼Œä»ä¸€ä¸ª API è·å–è‚¡ç¥¨ä»·æ ¼ä¿¡æ¯ï¼Œç„¶åè°ƒæ•´æ ¼å¼å¹¶ä¿å­˜åˆ°æ•°æ®åº“ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ¨¡å¼çš„åŒå·¥æµï¼Œå…¶ä¸­è¯»å–éƒ¨åˆ†è´Ÿè´£ä» API è·å–æ•°æ®ï¼Œå†™å…¥éƒ¨åˆ†åˆ™å¤„ç†æ•°æ®æ ¼å¼çš„è½¬æ¢å¹¶ä¿å­˜åˆ°æ•°æ®åº“ã€‚</li></ul></li><li><p><strong>æ¸¸æˆå¼€å‘</strong>:</p><ul><li>åœ¨å®æ—¶å¤šç©å®¶æ¸¸æˆä¸­ï¼ŒæœåŠ¡å™¨éœ€è¦ä¸æ¯ä¸ªå®¢æˆ·ç«¯ä¿æŒå®æ—¶çš„ã€åŒå‘çš„æ•°æ®äº¤æ¢ã€‚é€šè¿‡ä½¿ç”¨å¯¹è±¡æ¨¡å¼çš„åŒå·¥æµï¼Œæ¸¸æˆæœåŠ¡å™¨å¯ä»¥æœ‰æ•ˆåœ°æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„æ¸¸æˆçŠ¶æ€å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œè§’è‰²ä½ç½®ã€åˆ†æ•°ç­‰ï¼‰ï¼Œå¤„ç†è¿™äº›å¯¹è±¡ï¼ˆæ¯”å¦‚è®¡ç®—ç¢°æ’ã€æ›´æ–°åˆ†æ•°ï¼‰ï¼Œç„¶åå°†æ›´æ–°åçš„æ¸¸æˆçŠ¶æ€æ¨é€ç»™ä¸€ä¸ªæˆ–å¤šä¸ªå®¢æˆ·ç«¯ã€‚</li></ul></li></ol><p>è¦åœ¨ Node.js ä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ¨¡å¼çš„åŒå·¥æµï¼Œä½ é€šå¸¸ä¼šå€ŸåŠ©äºç°æœ‰çš„åº“ï¼Œå¦‚<code>stream</code>æ¨¡å—ï¼Œä½¿ç”¨<code>Duplex</code>ç±»æˆ–è€…<code>Transform</code>ç±»ï¼ˆä¸€ä¸ªç‰¹æ®Šç±»å‹çš„åŒå·¥æµï¼Œä¸“é—¨ç”¨äºæ•°æ®è½¬æ¢ï¼‰ï¼Œå¹¶è®¾ç½®<code>objectMode: true</code>é€‰é¡¹æ¥å¯ç”¨å¯¹è±¡æ¨¡å¼ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Duplex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ¨¡å¼çš„åŒå·¥æµç¤ºä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> duplexStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Duplex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  objectMode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">obj</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è¡¨æ˜æ²¡æœ‰æ›´å¤šçš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¤„ç†å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">duplexStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;è¯»å–åˆ°æ•°æ®ï¼š&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">duplexStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">obj</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å†™å…¥ä¸€ä¸ªJavaScriptå¯¹è±¡</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è®¾ç½®<code>objectMode: true</code>æ¥åˆ›å»ºä¸€ä¸ªåŒå·¥æµï¼Œå®ƒå¯ä»¥è¯»å–å’Œå†™å…¥ JavaScript å¯¹è±¡ã€‚è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“åœºæ™¯æ¥è®¾è®¡æµçš„è¡Œä¸ºå’Œå¤„ç†é€»è¾‘ã€‚</p><h3 id="implementing-a-transform-stream" tabindex="-1"><a class="header-anchor" href="#implementing-a-transform-stream"><span><a href="https://nodejs.org/docs/latest/api/stream.html#implementing-a-transform-stream" target="_blank" rel="noopener noreferrer">Implementing a transform stream</a></span></a></h3><p>Node.js ä¸­çš„æµ(Streams)æ˜¯å¤„ç†æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“ä½ éœ€è¦å¤„ç†å¤§é‡æ•°æ®æ—¶ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªéå¸¸å¤§çš„æ–‡ä»¶è¦è¯»å–ï¼Œå°†æ•´ä¸ªæ–‡ä»¶ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºè¿è¡Œç¼“æ…¢æˆ–è€…å´©æºƒã€‚è¿™é‡Œï¼Œæµå°±æ´¾ä¸Šç”¨åœºäº†ï¼Œå®ƒå…è®¸ä½ åˆ†ç‰‡å¤„ç†æ–‡ä»¶ï¼Œä¸€æ¬¡åªå¤„ç†æ–‡ä»¶çš„ä¸€å°éƒ¨åˆ†ã€‚</p><p>åœ¨ Node.js çš„æµä¸­ï¼Œæœ‰å‡ ç§ç±»å‹ï¼ŒåŒ…æ‹¬å¯è¯»æµã€å¯å†™æµã€è½¬æ¢æµ(Transform Streams)å’ŒåŒå·¥æµ(Duplex Streams)ã€‚è½¬æ¢æµç‰¹åˆ«æœ‰è¶£ï¼Œå› ä¸ºå®ƒä»¬å…è®¸ä½ åœ¨è¯»å–æ•°æ®å’Œå†™å…¥æ•°æ®ä¹‹é—´è¿›è¡Œè½¬æ¢æˆ–å¤„ç†ã€‚ç®€å•æ¥è¯´ï¼Œå½“æ•°æ®é€šè¿‡ä¸€ä¸ªè½¬æ¢æµæ—¶ï¼Œä½ å¯ä»¥å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚</p><h3 id="å®ç°è½¬æ¢æµ" tabindex="-1"><a class="header-anchor" href="#å®ç°è½¬æ¢æµ"><span>å®ç°è½¬æ¢æµ</span></a></h3><p>è¦å®ç°ä¸€ä¸ªè½¬æ¢æµï¼Œä½ å¯ä»¥ä½¿ç”¨ Node.js çš„<code>stream</code>æ¨¡å—ä¸­çš„<code>Transform</code>ç±»ã€‚ä½ éœ€è¦åšçš„æ˜¯æ‰©å±•<code>Transform</code>ç±»ï¼Œå¹¶å®ç°ä¸€ä¸ª<code>_transform</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå¤„ç†æ•°æ®çš„è½¬æ¢é€»è¾‘ã€‚</p><p>è¿™é‡Œæ˜¯åˆ›å»ºä¸€ä¸ªè½¬æ¢æµçš„åŸºæœ¬æ­¥éª¤ï¼š</p><ol><li>å¯¼å…¥<code>stream</code>æ¨¡å—ã€‚</li><li>åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ï¼Œç»§æ‰¿è‡ª<code>stream.Transform</code>ã€‚</li><li>åœ¨ä½ çš„ç±»ä¸­å®ç°<code>_transform</code>æ–¹æ³•ã€‚</li></ol><p><code>_transform</code>æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼š</p><ul><li><code>chunk</code>ï¼šè¡¨ç¤ºå¤„ç†ä¸­çš„æ•°æ®å—ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ª Buffer æˆ–å­—ç¬¦ä¸²ï¼‰ã€‚</li><li><code>encoding</code>ï¼šå¦‚æœå—æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™è¿™æ˜¯ç¼–ç ç±»å‹ï¼ˆå¦‚æœå—æ˜¯ç¼“å†²åŒºï¼Œåˆ™å¯ä»¥å¿½ç•¥ï¼‰ã€‚</li><li><code>callback</code>ï¼šå½“å¤„ç†å®Œæˆæ—¶ï¼Œä½ éœ€è¦è°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°ã€‚</li></ul><h3 id="ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­"><span>ä¾‹å­</span></a></h3><p>å‡è®¾æˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªè½¬æ¢æµï¼Œå®ƒå°†æ‰€æœ‰ä¼ å…¥çš„æ–‡æœ¬è½¬æ¢ä¸ºå¤§å†™å½¢å¼ã€‚ä¸‹é¢æ˜¯å¦‚ä½•å®ç°å®ƒï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> UppercaseTransform</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å°†è¾“å…¥æ•°æ®å—è½¬æ¢ä¸ºå¤§å†™</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toUpperCase</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä½¿ç”¨æˆ‘ä»¬çš„è½¬æ¢æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> uppercaseTransform</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> UppercaseTransform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stdin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">uppercaseTransform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stdout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º<code>UppercaseTransform</code>çš„è½¬æ¢æµï¼Œå®ƒå°†æ‰€æœ‰é€šè¿‡å®ƒçš„æ–‡æœ¬è½¬æ¢ä¸ºå¤§å†™ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨äº†<code>process.stdin</code>ï¼ˆæ ‡å‡†è¾“å…¥æµï¼‰ä½œä¸ºè¾“å…¥æºï¼Œå¹¶ä¸”å°†ç»“æœè¾“å‡ºåˆ°<code>process.stdout</code>ï¼ˆæ ‡å‡†è¾“å‡ºæµï¼‰ã€‚è¿™æ„å‘³ç€å¦‚æœä½ è¿è¡Œè¿™æ®µä»£ç å¹¶è¾“å…¥æ–‡æœ¬ï¼Œå®ƒä¼šä»¥å¤§å†™å½¢å¼è¿”å›ç»™ä½ ã€‚</p><h3 id="åº”ç”¨ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨ç¤ºä¾‹-1"><span>åº”ç”¨ç¤ºä¾‹</span></a></h3><p>è½¬æ¢æµåœ¨å®é™…åº”ç”¨ä¸­éå¸¸æœ‰ç”¨ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ä¾‹å­ï¼š</p><ul><li><strong>æ•°æ®å‹ç¼©</strong>ï¼šåœ¨å°†æ•°æ®å†™å…¥ç£ç›˜ä¹‹å‰å¯¹å…¶è¿›è¡Œå‹ç¼©ã€‚</li><li><strong>æ•°æ®è§£å¯†/åŠ å¯†</strong>ï¼šåœ¨è¯»å–æˆ–å†™å…¥å‰å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†æˆ–è§£å¯†ã€‚</li><li><strong>è§£æ</strong>ï¼šæ¯”å¦‚ï¼Œä» CSV æ ¼å¼è½¬æ¢ä¸º JSONã€‚</li></ul><p>é€šè¿‡ä½¿ç”¨è½¬æ¢æµï¼Œä½ å¯ä»¥é«˜æ•ˆåœ°åœ¨å¤„ç†æ•°æ®æ—¶å³æ—¶è¿›è¡Œè½¬æ¢ï¼Œè¿™å¯¹äºèµ„æºæœ‰é™æˆ–éœ€è¦å®æ—¶å¤„ç†çš„åº”ç”¨ç¨‹åºå°¤ä¸ºé‡è¦ã€‚</p><h4 id="new-stream-transform-options" tabindex="-1"><a class="header-anchor" href="#new-stream-transform-options"><span><a href="https://nodejs.org/docs/latest/api/stream.html#new-streamtransformoptions" target="_blank" rel="noopener noreferrer">new stream.Transform([options])</a></span></a></h4><p>ç†è§£ Node.js ä¸­çš„ <code>stream.Transform</code> ç±»ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š</p><ol><li><p><strong>æµï¼ˆStreamsï¼‰</strong>ï¼šåœ¨ Node.js ä¸­ï¼Œæµæ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚æƒ³è±¡æˆæ°´æµï¼Œæ•°æ®ä»ä¸€ä¸ªåœ°æ–¹â€œæµåŠ¨â€åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚æµå¯ä»¥ä½¿å¾—å¤„ç†å¤§é‡æ•°æ®æˆ–å®æ—¶æ•°æ®å˜å¾—æ›´åŠ é«˜æ•ˆï¼Œå› ä¸ºä½ ä¸éœ€è¦ç­‰å¾…æ‰€æœ‰æ•°æ®éƒ½å‡†å¤‡å¥½æ‰å¼€å§‹å¤„ç†ã€‚</p></li><li><p><strong>Transform æµ</strong>ï¼šè¿™æ˜¯ä¸€ç§ç‰¹åˆ«çš„æµï¼Œå®ƒæ—¢å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™ï¼Œè€Œä¸”å®ƒèƒ½å¤Ÿå°†è¾“å…¥æ•°æ®è½¬æ¢æˆè¾“å‡ºæ•°æ®ã€‚æƒ³è±¡ä¸€ä¸ªè¿‡æ»¤å™¨ï¼ŒåŸæ–™ä»ä¸€ç«¯è¿›å…¥ï¼Œé€šè¿‡æŸäº›å¤„ç†åï¼Œä»å¦ä¸€ç«¯å‡ºæ¥æˆä¸ºäº§å“ã€‚</p></li></ol><p>è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°çœ‹çœ‹ <code>new stream.Transform([options])</code>:</p><p>å½“ä½ åˆ›å»ºä¸€ä¸ª Transform æµæ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨å®ç°ä¸€ä¸ªè½¬æ¢æœºåˆ¶ã€‚è¿™æ„å‘³ç€ä½ æ¥æ”¶ä¸€äº›æ•°æ®ï¼Œå¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œç„¶åè¾“å‡ºè¿™äº›è¢«å¤„ç†è¿‡çš„æ•°æ®ã€‚è¿™ä¸ªè½¬æ¢å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„ï¼šå‹ç¼©ã€åŠ å¯†ã€ä¿®æ”¹ç­‰ç­‰ã€‚</p><h3 id="å‚æ•°-12" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-12"><span>å‚æ•°</span></a></h3><ul><li><code>options</code>ï¼šæ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œç”¨äºè‡ªå®šä¹‰æµçš„è¡Œä¸ºã€‚ä¸€äº›å¸¸è§çš„é€‰é¡¹åŒ…æ‹¬ï¼š <ul><li><code>highWaterMark</code>ï¼šæ§åˆ¶å†…éƒ¨ç¼“å†²åŒºå¤§å°ã€‚</li><li><code>encoding</code>ï¼šå¦‚æœè®¾ç½®ï¼Œå½“æ•°æ®é€šè¿‡ <code>.read()</code> æ–¹æ³•è¯»å–æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨è½¬æ¢æˆè¿™ä¸ªç¼–ç ã€‚</li><li><code>objectMode</code>ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œæµåªå¤„ç†å­—ç¬¦ä¸²å’Œ Buffer å¯¹è±¡ã€‚å¦‚æœè¦å¤„ç†å…¶ä»–ç±»å‹çš„ JavaScript å€¼ï¼Œéœ€è¦å°†æ­¤é€‰é¡¹è®¾ä¸º trueã€‚</li></ul></li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-24" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-24"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><h4 id="ç¤ºä¾‹-1-å°†æ–‡ä»¶å†…å®¹å…¨éƒ¨è½¬æ¢ä¸ºå¤§å†™å­—æ¯" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-å°†æ–‡ä»¶å†…å®¹å…¨éƒ¨è½¬æ¢ä¸ºå¤§å†™å­—æ¯"><span>ç¤ºä¾‹ 1ï¼šå°†æ–‡ä»¶å†…å®¹å…¨éƒ¨è½¬æ¢ä¸ºå¤§å†™å­—æ¯</span></a></h4><p>å‡è®¾æœ‰ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œæˆ‘ä»¬æƒ³è¯»å–è¯¥æ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶å°†æ‰€æœ‰å­—ç¬¦è½¬æ¢æˆå¤§å†™å­—æ¯åå†™å…¥å¦ä¸€ä¸ªæ–‡ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ª Transform æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> upperCaseTr</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // chunk æ˜¯è¯»å–çš„æ•°æ®ç‰‡æ®µ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å°†å…¶è½¬æ¢æˆå¤§å†™</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toUpperCase</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºè¯»å–æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;input.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºå†™å…¥æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writeStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç®¡é“é“¾ï¼šè¯»å– -&gt; è½¬æ¢ -&gt; å†™å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">upperCaseTr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ç¤ºä¾‹-2-å®æ—¶æ•°æ®å‹ç¼©" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2-å®æ—¶æ•°æ®å‹ç¼©"><span>ç¤ºä¾‹ 2ï¼šå®æ—¶æ•°æ®å‹ç¼©</span></a></h4><p>å¦‚æœä½ æ­£åœ¨å¤„ç†å®æ—¶æ•°æ®ï¼ˆæ¯”å¦‚æ—¥å¿—æ–‡ä»¶ï¼‰ï¼Œå¹¶ä¸”æƒ³å°†è¿™äº›æ•°æ®å‹ç¼©åå‘é€ç»™å®¢æˆ·ç«¯æˆ–å­˜å‚¨èµ·æ¥ï¼Œå¯ä»¥ä½¿ç”¨ Transform æµæ¥å®ç°æ•°æ®çš„å³æ—¶å‹ç¼©ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;zlib&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå‹ç¼© Transform æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> compressStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ä½¿ç”¨ zlib åº“å‹ç¼©æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    zlib</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">gzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ inputStream æ˜¯ä»æŸä¸ªæ¥æºè¯»å–æ•°æ®çš„æµ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// outputStream æ˜¯å†™å…¥æ•°æ®çš„ç›®æ ‡æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">inputStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">compressStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">outputStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸¤ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº† Transform æµæ¥å¤„ç†æ•°æ®çš„å®æ—¶è¯»å–ã€è½¬æ¢å’Œå†™å…¥ï¼Œå±•ç¤ºäº† Node.js ä¸­æµçš„å¼ºå¤§åŠŸèƒ½å’Œçµæ´»æ€§ã€‚</p><h4 id="event-end-1" tabindex="-1"><a class="header-anchor" href="#event-end-1"><span><a href="https://nodejs.org/docs/latest/api/stream.html#event-end_1" target="_blank" rel="noopener noreferrer">Event: &#39;end&#39;</a></span></a></h4><p>åœ¨è§£é‡Š Node.js ä¸­çš„ <code>&#39;end&#39;</code> äº‹ä»¶ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ Node.js å’Œå®ƒçš„ Streamsï¼ˆæµï¼‰æ¦‚å¿µã€‚Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚Node.js ä½¿ç”¨éé˜»å¡ã€äº‹ä»¶é©±åŠ¨çš„æ¨¡å‹ï¼Œä½¿å…¶è½»é‡ä¸”é«˜æ•ˆã€‚</p><h3 id="streams-æµ-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#streams-æµ-ç®€ä»‹"><span>Streamsï¼ˆæµï¼‰ç®€ä»‹</span></a></h3><p>åœ¨ Node.js ä¸­ï¼ŒStreams æ˜¯å¤„ç†è¯»å–æˆ–å†™å…¥æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ I/O æ“ä½œçš„æŠ½è±¡æ¦‚å¿µã€‚ç®€å•æ¥è¯´ï¼Œæµå°±æ˜¯æ•°æ®çš„é›†åˆ â€”â€” åƒæ˜¯ä¸€ä¸²å­—ç¬¦æˆ–è€…ä¸€ç³»åˆ—çš„æ•°æ®å—ï¼Œè¿™äº›æ•°æ®å¯ä»¥åˆ†æ‰¹æ¬¡åœ°è¢«å¤„ç†ã€‚æµçš„ç‰¹ç‚¹æ˜¯æ•°æ®ä¸å¿…ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œæ˜¯éšç€æ—¶é—´çš„æ¨ç§»ï¼Œä¸€å°éƒ¨åˆ†ä¸€å°éƒ¨åˆ†åœ°è¿›è¡Œå¤„ç†ã€‚è¿™å¯¹å¤„ç†å¤§æ–‡ä»¶æˆ–å®æ—¶æ•°æ®éå¸¸æœ‰ç”¨ã€‚</p><h3 id="event-end-2" tabindex="-1"><a class="header-anchor" href="#event-end-2"><span>Event: &#39;end&#39;</span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º Node.js v21.7.1 ä¸­çš„ <code>Event: &#39;end&#39;</code> æ—¶ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯ä¸€ä¸ªç‰¹å®šç±»å‹çš„äº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶å±äº Node.js Streams API çš„ä¸€éƒ¨åˆ†ã€‚<code>&#39;end&#39;</code> äº‹ä»¶åœ¨å¯è¯»æµï¼ˆReadable Streamï¼‰ä¸­ä½¿ç”¨ï¼Œè¡¨ç¤ºæ²¡æœ‰æ›´å¤šçš„æ•°æ®å¯è¯»äº†ã€‚æ¢å¥è¯è¯´ï¼Œå½“æµä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å·²ç»è¢«æ¶ˆè´¹å®Œæ¯•ï¼Œ<code>&#39;end&#39;</code> äº‹ä»¶å°±ä¼šè¢«è§¦å‘ã€‚</p><h3 id="å®é™…åº”ç”¨ä¾‹å­-9" tabindex="-1"><a class="header-anchor" href="#å®é™…åº”ç”¨ä¾‹å­-9"><span>å®é™…åº”ç”¨ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-è¯»å–æ–‡ä»¶å†…å®¹-3" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-è¯»å–æ–‡ä»¶å†…å®¹-3"><span>ä¾‹å­ 1ï¼šè¯»å–æ–‡ä»¶å†…å®¹</span></a></h4><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ï¼Œéœ€è¦ä»ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚ä½¿ç”¨å¯è¯»æµï¼ˆfs.createReadStreamï¼‰å¯ä»¥æœ‰æ•ˆåœ°é€ç‰‡æ®µåœ°è¯»å–æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå½“æ²¡æœ‰æ›´å¤šçš„æ•°æ®å¯ä»¥è¯»å–æ—¶ï¼Œ<code>&#39;end&#39;</code> äº‹ä»¶å°†è¢«è§¦å‘ï¼Œè¡¨æ˜æ–‡ä»¶å·²ç»è¢«å®Œå…¨è¯»å–ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµæ¥è¯»å–æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬&#39;data&#39;äº‹ä»¶æ¥æ¥æ”¶æ•°æ®ç‰‡æ®µ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬&#39;end&#39;äº‹ä»¶æ¥çŸ¥é“ä½•æ—¶å®Œæˆ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No more data to read.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-2-http-è¯·æ±‚-1" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-http-è¯·æ±‚-1"><span>ä¾‹å­ 2ï¼šHTTP è¯·æ±‚</span></a></h4><p>å½“ä½ å‘ä¸€ä¸ªç½‘ç«™å‘èµ· HTTP è¯·æ±‚æ—¶ï¼Œè¿”å›çš„æ•°æ®ä¹Ÿå¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªæµã€‚Node.js å¯ä»¥ä½¿ç”¨ http æ¨¡å—æ¥å¤„ç†è¿™ç±»è¯·æ±‚ã€‚åœ¨æ•°æ®ä¼ è¾“å®Œæˆåï¼Œ<code>&#39;end&#39;</code> äº‹ä»¶åŒæ ·ä¼šè¢«è§¦å‘ï¼Œæ­¤æ—¶ä½ å¯ä»¥å¤„ç†æ‰€æœ‰æ¥æ”¶åˆ°çš„æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‘èµ· HTTP GET è¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http://example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ¥æ”¶æ•°æ®ç‰‡æ®µ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // æ•°æ®æ¥æ”¶å®Œæ¯•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡ä»¥ä¸Šç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ° <code>&#39;end&#39;</code> äº‹ä»¶åœ¨ Node.js ä¸­æ‰®æ¼”çš„è§’è‰²â€”â€”ä½œä¸ºå¯è¯»æµæ•°æ®æ¶ˆè´¹å®Œæ¯•çš„æ ‡å¿—ã€‚æŒæ¡äº†è¿™ä¸ªæ¦‚å¿µï¼Œä½ å°±æ›´åŠ èƒ½å¤Ÿçµæ´»åœ°å¤„ç†å„ç§éœ€è¦æŒ‰å—å¤„ç†æ•°æ®çš„åœºæ™¯äº†ã€‚</p><h4 id="event-finish-1" tabindex="-1"><a class="header-anchor" href="#event-finish-1"><span><a href="https://nodejs.org/docs/latest/api/stream.html#event-finish_1" target="_blank" rel="noopener noreferrer">Event: &#39;finish&#39;</a></span></a></h4><p>Node.js çš„ <code>Event: &#39;finish&#39;</code> æ˜¯ä¸ streams ï¼ˆæµï¼‰ç›¸å…³çš„ä¸€ä¸ªæ¦‚å¿µã€‚è¦æ·±å…¥ç†è§£ <code>&#39;finish&#39;</code> äº‹ä»¶ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ Node.js ä¸­çš„ streams å’Œå®ƒä»¬çš„ç”¨é€”ã€‚</p><h3 id="streams-ä¸-node-js" tabindex="-1"><a class="header-anchor" href="#streams-ä¸-node-js"><span>Streams ä¸ Node.js</span></a></h3><p>Streams æ˜¯å¤„ç†è¯»å†™æ•°æ®çš„æŠ½è±¡æ¦‚å¿µã€‚åœ¨ Node.js ä¸­ï¼Œstreams è¢«ç”¨äºå¤„ç†å¤§æ–‡ä»¶æˆ–è€…æ•°æ®æµï¼Œå¦‚ä»ä¸€ä¸ªç½‘ç»œè¯·æ±‚è¯»å–æ•°æ®ã€‚è¿™æ˜¯å› ä¸ºå®ƒä»¬å…è®¸æ•°æ®è¢«åˆ†å‰²æˆå°å—è¿›è¡Œå¤„ç†ï¼Œè€Œä¸å¿…ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™æ ·åšæé«˜äº†æ•ˆç‡å’Œæ€§èƒ½ï¼Œå°¤å…¶æ˜¯å¤„ç†å¤§å‹æ•°æ®æ—¶ã€‚</p><p>Node.js ä¸­æœ‰å››ç§åŸºæœ¬çš„ stream ç±»å‹ï¼š</p><ol><li><strong>Readable Streams</strong> - ç”¨äºè¯»å–æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œæ–‡ä»¶è¯»å–ï¼‰ã€‚</li><li><strong>Writable Streams</strong> - ç”¨äºå†™å…¥æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œå†™å…¥æ–‡ä»¶ï¼‰ã€‚</li><li><strong>Duplex Streams</strong> - å¯ä»¥åŒæ—¶è¯»å†™æ•°æ®ã€‚</li><li><strong>Transform Streams</strong> - æ•°æ®å¯ä»¥åœ¨å†™å…¥å‰æˆ–è¯»å‡ºæ—¶è¢«ä¿®æ”¹ï¼ˆè½¬æ¢ï¼‰ã€‚</li></ol><h3 id="event-finish-2" tabindex="-1"><a class="header-anchor" href="#event-finish-2"><span><code>Event: &#39;finish&#39;</code></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º <code>Event: &#39;finish&#39;</code> æ—¶ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯ä¸ Writable Streams ç›¸å…³çš„ç‰¹å®šäº‹ä»¶ã€‚è¿™ä¸ªäº‹ä»¶å‘ç”Ÿåœ¨æ‰€æœ‰æ•°æ®éƒ½å·²è¢«å†™å…¥åº•å±‚ç³»ç»Ÿä¹‹åã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ å¾€ä¸€ä¸ª stream ä¸­å†™å…¥æ•°æ®ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®å…¨éƒ¨å¤„ç†å®Œæ¯•ï¼ˆå³å·²ç»å®Œå…¨å‘é€å‡ºå»ï¼‰ï¼Œè¿™æ—¶å€™å°±ä¼šè§¦å‘ <code>&#39;finish&#39;</code> äº‹ä»¶ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-25" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-25"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨ç¼–å†™ä¸€ä¸ª Node.js ç¨‹åºï¼Œè¯¥ç¨‹åºéœ€è¦å‘æ–‡ä»¶ä¸­å†™å…¥æ•°æ®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨ <code>&#39;finish&#39;</code> äº‹ä»¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬çŸ¥é“ä½•æ—¶æ•°æ®å†™å…¥å®Œæˆï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯å†™æµï¼Œå†™å…¥åˆ° &#39;example.txt&#39; æ–‡ä»¶ä¸­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> writeStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å†™å…¥æ•°æ®åˆ° stream</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;UTF8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Another line!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;UTF8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ ‡è®°æ–‡ä»¶æœ«å°¾</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å½“æ‰€æœ‰æ•°æ®å†™å…¥å®Œæˆï¼Œå¹¶ä¸”æ–‡ä»¶å·²å…³é—­æ—¶ï¼Œ&#39;finish&#39; äº‹ä»¶è¢«è§¦å‘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;finish&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> () {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;å†™å…¥å®Œæˆ.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åœ¨å†™å…¥è¿‡ç¨‹ä¸­é‡åˆ°é”™è¯¯è§¦å‘ &#39;error&#39; äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">err</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stack</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ç¨‹åºæ‰§è¡Œå®Œæ¯•&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ <code>createWriteStream</code> æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªå¯å†™æµç”¨äºå†™å…¥æ•°æ®åˆ° <code>example.txt</code> æ–‡ä»¶ä¸­ã€‚è°ƒç”¨ <code>.write()</code> æ–¹æ³•å‘æ–‡ä»¶å†™å…¥æ–‡æœ¬ï¼Œç„¶åç”¨ <code>.end()</code> æ–¹æ³•ç»“æŸå†™å…¥è¿‡ç¨‹ã€‚æ­¤æ—¶ï¼Œå¦‚æœæ‰€æœ‰å†…å®¹æˆåŠŸå†™å…¥åº•å±‚ç³»ç»Ÿï¼Œå°†è§¦å‘ <code>&#39;finish&#39;</code> äº‹ä»¶ï¼Œå¹¶é€šè¿‡ <code>.on(&#39;finish&#39;, callback)</code> æ–¹æ³•æ³¨å†Œçš„å›è°ƒå‡½æ•°æ¥å“åº”æ­¤äº‹ä»¶ï¼Œè¡¨æ˜å†™å…¥æ“ä½œå·²å®Œæˆã€‚</p><h3 id="ç»“è®º-5" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-5"><span>ç»“è®º</span></a></h3><p><code>&#39;finish&#39;</code> äº‹ä»¶åœ¨ Node.js çš„å†™å…¥æµä¸­æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå®ƒæä¾›äº†ä¸€ç§æ–¹å¼æ¥é€šçŸ¥æˆ‘ä»¬æ•°æ®å·²ç»å…¨éƒ¨å†™å…¥å®Œæˆã€‚è¿™å¯¹äºç¡®ä¿æ•°æ®å®Œæ•´æ€§ä»¥åŠåœ¨å†™å…¥å®Œæˆåæ‰§è¡Œåç»­æ“ä½œï¼ˆæ¯”å¦‚å…³é—­æ–‡ä»¶ã€é€šçŸ¥ç”¨æˆ·ç­‰ï¼‰éå¸¸é‡è¦ã€‚</p><h4 id="transform-flush-callback" tabindex="-1"><a class="header-anchor" href="#transform-flush-callback"><span><a href="https://nodejs.org/docs/latest/api/stream.html#transform_flushcallback" target="_blank" rel="noopener noreferrer">transform._flush(callback)</a></span></a></h4><p>Node.js ä¸­çš„ <code>transform._flush(callback)</code> æ˜¯ä¸€ä¸ªåœ¨æµï¼ˆstreamï¼‰çš„è½¬æ¢æ“ä½œç»“æŸæ—¶ä½¿ç”¨çš„æ–¹æ³•ï¼Œå±äº Transform æµçš„ä¸€éƒ¨åˆ†ã€‚è¿™ä¸ªæ–¹æ³•éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç§å¤„ç†å’Œå®Œæˆæµå†…å‰©ä½™æ•°æ®çš„æ‰‹æ®µï¼Œç‰¹åˆ«æ˜¯åœ¨æ²¡æœ‰æ›´å¤šæ•°æ®è¢«å†™å…¥æµæ—¶ã€‚</p><p>é¦–å…ˆï¼Œç†è§£ Node.js ä¸­çš„æµï¼ˆStreamsï¼‰æ˜¯æœ‰å¸®åŠ©çš„ã€‚æµæ˜¯ä¸€ç³»åˆ—æ•°æ®çš„é›†åˆï¼Œå¦‚æ–‡ä»¶è¯»å†™æˆ–ç½‘ç»œé€šä¿¡ç­‰ï¼Œå®ƒä»¬å¯ä»¥ä»¥éå¸¸é«˜æ•ˆçš„æ–¹å¼å¤„ç†å¤§é‡æ•°æ®ã€‚Transform æµæ˜¯ä¸€ç±»ç‰¹æ®Šçš„åŒå‘æµï¼ˆDuplexï¼‰ï¼Œå®ƒå…è®¸ä½ åœ¨æ•°æ®è¢«è¯»å–å’Œå†™å…¥è¿‡ç¨‹ä¸­å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚</p><h3 id="transform-flush-callback-1" tabindex="-1"><a class="header-anchor" href="#transform-flush-callback-1"><span><strong>transform._flush(callback)</strong></span></a></h3><p>å½“æ²¡æœ‰æ›´å¤šæ•°æ®è¢«å†™å…¥ Transform æµæ—¶ï¼Œ<code>_flush</code> æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ã€‚ä½ å¯ä»¥åˆ©ç”¨è¿™ä¸ªæœºä¼šæ¥å¤„ç†æµä¸­å‰©ä½™çš„æ•°æ®ï¼Œå¹¶ä¸”åœ¨å®Œæˆåé€šè¿‡ <code>callback</code> å‡½æ•°å‘é€ä¿¡å·ã€‚è¿™ä¸ª <code>callback</code> å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªé”™è¯¯å¯¹è±¡ï¼ˆå¦‚æœæ“ä½œå¤±è´¥äº†ï¼‰å’Œç»“æœæ•°æ®ã€‚</p><p><strong>æ³¨æ„</strong>ï¼š<code>_flush</code> æ–¹æ³•æ˜¯ä¸€ä¸ªå¯é€‰çš„æ–¹æ³•ï¼Œä»…åœ¨ä½ éœ€è¦åœ¨æµç»“æŸå‰å¤„ç†å‰©ä½™æ•°æ®æ—¶å®ç°ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-24" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-24"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-å‹ç¼©æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-å‹ç¼©æ•°æ®"><span>ä¾‹å­ 1ï¼šå‹ç¼©æ•°æ®</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªç¨‹åºæ¥å‹ç¼©æ•°æ®ã€‚åœ¨æ•´ä¸ªæ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œä½ å¯ä»¥åˆ©ç”¨ Transform æµæ¥é€å—å‹ç¼©æ•°æ®ã€‚å½“æ‰€æœ‰æ•°æ®å—éƒ½è¢«å‹ç¼©åï¼Œ<code>_flush</code> æ–¹æ³•å¯ä»¥ç”¨æ¥ç¡®ä¿æ‰€æœ‰å‰©ä½™çš„ã€æœªå¤„ç†çš„æ•°æ®ä¹Ÿè¢«å‹ç¼©å¹¶è¾“å‡ºã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;zlib&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> CompressStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">compressBuffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Gzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†æ•°æ®å—ä¼ ç»™å‹ç¼©å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> compressedData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">compressBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">compress</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">compressedData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _flush</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // ç¡®ä¿æ‰€æœ‰å‰©ä½™çš„æ•°æ®è¢«å‹ç¼©</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> remainingCompressedData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">compressBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">finalize</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">remainingCompressedData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-2-æ”¶é›†æµä¸­çš„æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-æ”¶é›†æµä¸­çš„æ•°æ®"><span>ä¾‹å­ 2ï¼šæ”¶é›†æµä¸­çš„æ•°æ®</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ª Transform æµï¼Œå®ƒé€å—è¯»å–æ•°æ®ï¼Œç„¶åå¯¹æ¯ä¸ªæ•°æ®å—æ‰§è¡ŒæŸäº›æ“ä½œã€‚åœ¨æ²¡æœ‰æ›´å¤šæ•°æ®è¦å†™å…¥æµæ—¶ï¼Œä½ å¯èƒ½éœ€è¦å°†è¿™äº›ç»è¿‡å¤„ç†çš„æ•°æ®ç‰‡æ®µç»„åˆèµ·æ¥ï¼Œç„¶åä¸€æ¬¡æ€§åœ°è¿”å›ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> CollectStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">options</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dataCollection</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å°†æ•°æ®å—å­˜å‚¨èµ·æ¥</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">dataCollection</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _flush</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åœ¨æµçš„æœ€æœ«å°¾ï¼Œç»„åˆæ‰€æœ‰æ•°æ®ï¼Œå¹¶æ¨é€</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> combinedData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">concat</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dataCollection</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">combinedData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œ<code>CollectStream</code> ç±»é€šè¿‡ <code>_transform</code> æ–¹æ³•æ”¶é›†æµç»å…¶çš„æ•°æ®ï¼Œå¹¶åœ¨ <code>_flush</code> æ–¹æ³•ä¸­å°†æ”¶é›†åˆ°çš„æ‰€æœ‰æ•°æ®ç‰‡æ®µåˆå¹¶æˆä¸€ä¸ªå•ä¸€çš„æ•°æ®å—åè¾“å‡ºã€‚</p><p>é€šè¿‡è¿™äº›ä¾‹å­ï¼Œä½ åº”è¯¥èƒ½å¤Ÿçœ‹åˆ° <code>transform._flush(callback)</code> åœ¨å¤„ç† Node.js ä¸­çš„ Transform æµæ—¶çš„ä½œç”¨ï¼Œæ— è®ºæ˜¯æ¸…ç†å·¥ä½œè¿˜æ˜¯ç¡®ä¿æ‰€æœ‰æ•°æ®å‡è¢«å¤„ç†ã€‚</p><h4 id="transform-transform-chunk-encoding-callback" tabindex="-1"><a class="header-anchor" href="#transform-transform-chunk-encoding-callback"><span><a href="https://nodejs.org/docs/latest/api/stream.html#transform_transformchunk-encoding-callback" target="_blank" rel="noopener noreferrer">transform._transform(chunk, encoding, callback)</a></span></a></h4><p>å½“æˆ‘ä»¬åœ¨è°ˆè®º Node.js ä¸­çš„<code>transform._transform(chunk, encoding, callback)</code>æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºæµï¼ˆStreamsï¼‰çš„è½¬æ¢æ“ä½œã€‚Node.js ä¸­çš„æµæ˜¯ä¸€ç§å¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œå°¤å…¶æ˜¯å½“ä½ ä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®è½½å…¥å†…å­˜æ—¶ã€‚æµå¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ã€æˆ–è€…å³å¯è¯»åˆå¯å†™çš„ã€‚è½¬æ¢æµï¼ˆTransform streamsï¼‰å°±æ˜¯è¿™æ ·ä¸€ç§ç‰¹æ®Šç±»å‹çš„æµï¼Œå®ƒå…è®¸ä½ åœ¨è¯»å–æ•°æ®å’Œå†™å…¥æ•°æ®ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</p><h3 id="ç†è§£-transform-transform" tabindex="-1"><a class="header-anchor" href="#ç†è§£-transform-transform"><span>ç†è§£ <code>transform._transform</code></span></a></h3><p><code>transform._transform</code>æ–¹æ³•æ˜¯ä½ åœ¨åˆ›å»ºè‡ªå®šä¹‰è½¬æ¢æµæ—¶å¿…é¡»é‡å†™çš„å‡½æ•°ã€‚è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯å…·ä½“å®šä¹‰å¦‚ä½•å¤„ç†è¾“å…¥çš„æ•°æ®ï¼ˆchunkï¼‰ï¼Œå¹¶äº§ç”Ÿè¾“å‡ºã€‚</p><ul><li><code>chunk</code>ï¼šè¿™æ˜¯ä¼ é€’ç»™è½¬æ¢æ“ä½œçš„æ•°æ®ç‰‡æ®µã€‚æ ¹æ®æµçš„è®¾ç½®ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ– Bufferï¼ˆNode.js ä¸­ç”¨äºå¤„ç†äºŒè¿›åˆ¶æ•°æ®çš„å¯¹è±¡ï¼‰ã€‚</li><li><code>encoding</code>ï¼šå¦‚æœå—æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™<code>encoding</code>æ˜¯å­—ç¬¦ç¼–ç ï¼ˆä¾‹å¦‚ï¼š&#39;utf8&#39;ï¼‰ã€‚å¦‚æœå—æ˜¯ä¸€ä¸ª Bufferï¼Œåˆ™<code>encoding</code>å‚æ•°ä¼šè¢«å¿½ç•¥ã€‚</li><li><code>callback</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä½ å¿…é¡»åœ¨å¤„ç†å®Œ<code>chunk</code>åè°ƒç”¨å®ƒã€‚å®ƒæœ‰ä¸¤ä¸ªå‚æ•°ï¼šé”™è¯¯å’Œå¤„ç†åçš„æ•°æ®ã€‚å¦‚æœå¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä½ å¯ä»¥é€šè¿‡ç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’é”™è¯¯ï¼›å¦åˆ™ï¼Œç¬¬ä¸€ä¸ªå‚æ•°åº”ä¸º nullï¼Œå¹¶ä¸”å°†å¤„ç†åçš„æ•°æ®ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-26" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-26"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨æ„å»ºä¸€ä¸ªåº”ç”¨ï¼Œè¯¥åº”ç”¨éœ€è¦ä»æ–‡ä»¶ä¸­è¯»å–æ–‡æœ¬ï¼Œå°†æ–‡æœ¬ä¸­çš„æ¯ä¸ªå­—æ¯è½¬æ¢ä¸ºå¤§å†™ï¼Œç„¶åå°†è½¬æ¢åçš„æ–‡æœ¬å†™å…¥å¦ä¸€ä¸ªæ–‡ä»¶ã€‚ä½¿ç”¨ Node.js ä¸­çš„ Transform streamï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç°ï¼š</p><ol><li><strong>å¯¼å…¥å¿…è¦çš„æ¨¡å—</strong>ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ Transform æµæ¥è½¬æ¢æ•°æ®</strong>ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> UppercaseTransform</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _transform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å°†è¾“å…¥çš„æ–‡æœ¬è½¬æ¢ä¸ºå¤§å†™</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> upperChunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toUpperCase</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // è°ƒç”¨å›è°ƒï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºnullè¡¨ç¤ºæ²¡æœ‰é”™è¯¯ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è½¬æ¢åçš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    callback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">upperChunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>ä½¿ç”¨è¿™ä¸ªè½¬æ¢æµå¤„ç†æ–‡ä»¶</strong>ï¼š</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªè¯»å–æµå’Œå†™å…¥æµ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;input.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> writeStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;output.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®ä¾‹åŒ–æˆ‘ä»¬çš„UppercaseTransform</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> uppercaseTransform</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> UppercaseTransform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç®¡é“æ“ä½œï¼šè¯»å– -&gt; è½¬æ¢ä¸ºå¤§å†™ -&gt; å†™å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">uppercaseTransform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">writeStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè¯»å–<code>input.txt</code>æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œç„¶åé€šè¿‡ç®¡é“ï¼ˆ<code>.pipe()</code>ï¼‰å°†å…¶ä¼ é€’ç»™æˆ‘ä»¬çš„<code>UppercaseTransform</code>ã€‚åœ¨<code>UppercaseTransform</code>ä¸­ï¼Œæ¯ä¸ªæ•°æ®å—ï¼ˆ<code>chunk</code>ï¼‰éƒ½ä¼šè¢«è½¬æ¢æˆå¤§å†™ï¼Œç„¶åè¾“å‡ºæ•°æ®è¢«å†æ¬¡é€šè¿‡ç®¡é“å‘é€åˆ°<code>writeStream</code>ï¼Œæœ€ç»ˆå†™å…¥<code>output.txt</code>æ–‡ä»¶ã€‚</p><h3 id="ç»“è®º-6" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-6"><span>ç»“è®º</span></a></h3><p>é€šè¿‡<code>transform._transform</code>æ–¹æ³•ï¼Œä½ å¯ä»¥åˆ›å»ºé«˜åº¦å®šåˆ¶çš„æ•°æ®å¤„ç†æµç¨‹ï¼Œè¿™å¯¹äºå¤„ç†å¤§é‡æ•°æ®éå¸¸æœ‰æ•ˆï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥é€å—åœ°è¯»å–ã€è½¬æ¢å¹¶å†™å…¥ï¼Œè€Œæ— éœ€ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚åœ¨ Node.js çš„ä¸–ç•Œé‡Œï¼Œè¿™ä½¿å¾—å¤„ç†å¤§å‹æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰åœºæ™¯å˜å¾—æ›´åŠ é«˜æ•ˆå’Œçµæ´»ã€‚</p><h4 id="class-stream-passthrough" tabindex="-1"><a class="header-anchor" href="#class-stream-passthrough"><span><a href="https://nodejs.org/docs/latest/api/stream.html#class-streampassthrough" target="_blank" rel="noopener noreferrer">Class: stream.PassThrough</a></span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œ<code>stream.PassThrough</code> æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„ç±»ï¼Œå®ƒå±äº Streamï¼ˆæµï¼‰æ¨¡å—çš„ä¸€éƒ¨åˆ†ã€‚è¦ç†è§£ <code>PassThrough</code> æµï¼Œé¦–å…ˆå¾—çŸ¥é“ Node.js ä¸­çš„æµæ˜¯ä»€ä¹ˆã€‚æµæ˜¯ä¸€ç§æ•°æ®çš„å¤„ç†æ–¹å¼ï¼Œå…è®¸ä½ ä»ä¸€ä¸ªåœ°æ–¹ï¼ˆå¦‚æ–‡ä»¶ã€ç½‘ç»œè¿æ¥ç­‰ï¼‰è¯»å–æ•°æ®ï¼Œå¹¶ä¸”/æˆ–è€…å°†æ•°æ®å†™å…¥åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼Œè¿™ä¸€è¿‡ç¨‹å¯ä»¥æ˜¯è¿ç»­çš„ã€é€æ­¥çš„ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§åœ°å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><h3 id="passthrough-æµçš„ç‰¹ç‚¹" tabindex="-1"><a class="header-anchor" href="#passthrough-æµçš„ç‰¹ç‚¹"><span><code>PassThrough</code> æµçš„ç‰¹ç‚¹</span></a></h3><p><code>PassThrough</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„æµï¼Œå®ƒå®é™…ä¸Šä¸ä¼šå¯¹é€šè¿‡å®ƒçš„æ•°æ®åšä»»ä½•ä¿®æ”¹ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªæ²¡æœ‰ä»»ä½•è¿‡æ»¤å™¨çš„ç®¡é“ï¼Œæ•°æ®åŸå°ä¸åŠ¨åœ°ä»ä¸€ç«¯æµåˆ°å¦ä¸€ç«¯ã€‚å°½ç®¡å¬èµ·æ¥è¿™ä¼¼ä¹æ²¡ä»€ä¹ˆç”¨ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå®ƒå¯ä»¥ä½œä¸ºå…¶ä»–æµç»„ä»¶ä¹‹é—´çš„æ¡¥æ¢æˆ–è€…ç”¨æ¥è°ƒè¯•æµæ•°æ®ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-27" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-27"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><ol><li><p><strong>æ•°æ®è½¬å‘</strong>ï¼šå¦‚æœä½ æœ‰ä¸€ä¸ªæ•°æ®æºï¼ˆæ¯”å¦‚ä¸€ä¸ªæ–‡ä»¶è¯»å–æµï¼‰å’Œä¸€ä¸ªç›®æ ‡ä½ç½®ï¼ˆæ¯”å¦‚ä¸€ä¸ªæ–‡ä»¶å†™å…¥æµï¼‰ï¼Œä½†ä½ å¸Œæœ›åœ¨æ•°æ®åˆ°è¾¾ç›®çš„åœ°ä¹‹å‰èƒ½è§‚å¯Ÿæˆ–è®°å½•è¿™äº›æ•°æ®ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>PassThrough</code> æµæ¥å®ç°ã€‚æ•°æ®ä»æºå¤´æµåˆ° <code>PassThrough</code>ï¼Œç„¶åå†ä» <code>PassThrough</code> æµåˆ°ç›®çš„åœ°ï¼Œè¿‡ç¨‹ä¸­ä½ å¯ä»¥æ£€æŸ¥æˆ–è®°å½•æµç»çš„æ•°æ®ã€‚</p></li><li><p><strong>æµçš„ç»„åˆ</strong>ï¼šåœ¨ Node.js ä¸­ï¼Œæµå¯ä»¥è¢«ç»„åˆèµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªæ•°æ®å¤„ç†é“¾ã€‚å¦‚æœåœ¨è¿™ä¸ªé“¾ä¸­çš„æŸä¸ªä½ç½®ï¼Œä½ ä¸éœ€è¦å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œä½†åˆéœ€è¦ä¿æŒè¿™ä¸ªä½ç½®çš„å ä½ï¼ˆæ¯”å¦‚ï¼ŒåŸºäºæŸç§æ¡ä»¶åŠ¨æ€åœ°æ·»åŠ å¤„ç†æ­¥éª¤ï¼‰ï¼Œé‚£ä¹ˆ <code>PassThrough</code> æµå°±å¯ä»¥å‘æŒ¥ä½œç”¨ã€‚</p></li><li><p><strong>è°ƒè¯•</strong>ï¼š<code>PassThrough</code> æµä¹Ÿå¯ä»¥ç”¨æ¥è°ƒè¯•å¤æ‚çš„æµå¤„ç†è¿‡ç¨‹ã€‚é€šè¿‡å°† <code>PassThrough</code> æµæ’å…¥åˆ°æµå¤„ç†é“¾çš„ä¸åŒä½ç½®ï¼Œä½ å¯ä»¥è§‚å¯Ÿæ•°æ®åœ¨æµé€šè¿‡å„ä¸ªç¯èŠ‚æ—¶çš„çŠ¶æ€ï¼Œè€Œä¸å½±å“å®é™…çš„æ•°æ®å¤„ç†é€»è¾‘ã€‚</p></li></ol><h3 id="åˆ›å»ºå’Œä½¿ç”¨-passthrough-æµ" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºå’Œä½¿ç”¨-passthrough-æµ"><span>åˆ›å»ºå’Œä½¿ç”¨ <code>PassThrough</code> æµ</span></a></h3><p>ä½¿ç”¨ <code>stream</code> æ¨¡å—ä¸­çš„ <code>PassThrough</code> ç±»å¾ˆç®€å•ï¼Œé¦–å…ˆéœ€è¦å¼•å…¥æ¨¡å—ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª <code>PassThrough</code> æµçš„å®ä¾‹ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">PassThrough</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> passThrough</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> PassThrough</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç°åœ¨å¯ä»¥å°† passThrough æµä½œä¸ºæ•°æ®çš„ä¸­è½¬ç«™ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ä¾‹å¦‚ï¼Œå°†å®ƒæ’å…¥åˆ°å…¶ä»–æµä¹‹é—´ï¼Œç”¨äºæ•°æ®è½¬å‘æˆ–è°ƒè¯•ã€‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨å®è·µä¸­ï¼Œ<code>PassThrough</code> æµçš„ä½¿ç”¨è™½ç„¶ç®€å•ï¼Œä½†åœ¨å¤„ç†å¤æ‚çš„æµæ•°æ®æˆ–è¿›è¡Œæ•°æ®å¤„ç†çš„è°ƒè¯•æ—¶éå¸¸æœ‰å¸®åŠ©ã€‚é€šè¿‡åˆç†åº”ç”¨ï¼Œå®ƒå¯ä»¥è®©ä½ çš„ Node.js åº”ç”¨æ›´åŠ çµæ´»å’Œå¼ºå¤§ã€‚</p><h2 id="additional-notes" tabindex="-1"><a class="header-anchor" href="#additional-notes"><span><a href="https://nodejs.org/docs/latest/api/stream.html#additional-notes" target="_blank" rel="noopener noreferrer">Additional notes</a></span></a></h2><p>Node.js æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ JavaScript æ¥ç¼–å†™åç«¯ä»£ç ã€‚Node.js ä¸­æœ‰ä¸€ä¸ªæ ¸å¿ƒæ¨¡å—å«åš&quot;Stream&quot;ï¼Œè¿™ä¸ªæ¨¡å—å¯¹äºå¤„ç†æ•°æ®æµï¼ˆå¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰ï¼‰éå¸¸å…³é”®ã€‚åœ¨ Node.js çš„ v21.7.1 ç‰ˆæœ¬çš„æ–‡æ¡£ä¸­ï¼Œå…³äºæµï¼ˆStreamï¼‰æœ‰ä¸€äº›é¢å¤–çš„æ³¨æ„äº‹é¡¹ï¼Œæˆ‘ä»¬å°†åŸºäºè¿™äº›å†…å®¹è¿›è¡Œè¯¦ç»†ä¸”é€šä¿—æ˜“æ‡‚çš„è§£é‡Šã€‚</p><h3 id="_1-streams-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#_1-streams-æ˜¯ä»€ä¹ˆ"><span>1. Streams æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œstreams æ˜¯ç”¨æ¥å¤„ç†æ•°æ®çš„åºåˆ—ï¼Œè¿™äº›æ•°æ®å¯èƒ½æ˜¯ä¸€å¤§å—æ•°æ®ï¼Œä¹Ÿå¯èƒ½æ˜¯è¿ç»­ä¸æ–­åœ°åŠ¨æ€ç”Ÿæˆçš„æ•°æ®ã€‚é€šè¿‡ streamï¼Œä½ å¯ä»¥ä¸€å°éƒ¨åˆ†ä¸€å°éƒ¨åˆ†åœ°è¯»å–æˆ–å†™å…¥æ•°æ®ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚è¿™å¯¹äºå¤„ç†å¤§æ–‡ä»¶æˆ–å®æ—¶æ•°æ®ä¼ è¾“ç‰¹åˆ«æœ‰ç”¨ã€‚</p><h3 id="_2-streams-çš„ç±»å‹" tabindex="-1"><a class="header-anchor" href="#_2-streams-çš„ç±»å‹"><span>2. Streams çš„ç±»å‹</span></a></h3><p>ä¸»è¦æœ‰å››ç§ç±»å‹çš„ streamsï¼š</p><ul><li><strong>Readable streams</strong>ï¼šè¿™ç±»æµç”¨æ¥è¯»å–æ•°æ®ï¼Œä¾‹å¦‚ä»æ–‡ä»¶è¯»å–æ•°æ®ã€‚</li><li><strong>Writable streams</strong>ï¼šè¿™ç±»æµç”¨æ¥å†™å…¥æ•°æ®ï¼Œä¾‹å¦‚å‘æ–‡ä»¶å†™å…¥æ•°æ®ã€‚</li><li><strong>Duplex streams</strong>ï¼šè¿™ç±»æµæ—¢å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™ï¼Œä¾‹å¦‚ TCP å¥—æ¥å­—ã€‚</li><li><strong>Transform streams</strong>ï¼šè¿™æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„ Duplex æµï¼Œå®ƒå¯ä»¥åœ¨è¯»å†™è¿‡ç¨‹ä¸­ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®ï¼Œä¾‹å¦‚å‹ç¼©æµã€‚</li></ul><h3 id="_3-å®é™…è¿ç”¨çš„ä¾‹å­" tabindex="-1"><a class="header-anchor" href="#_3-å®é™…è¿ç”¨çš„ä¾‹å­"><span>3. å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®"><span>ä¾‹å­ 1ï¼šä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</span></a></h4><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªéå¸¸å¤§çš„æ–‡æœ¬æ–‡ä»¶ï¼Œä½ æƒ³é€è¡Œè¯»å–è¿™ä¸ªæ–‡ä»¶è€Œä¸æ˜¯ä¸€æ¬¡æ€§å°†å…¶å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;very-large-file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> lineReader</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  input</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">lineReader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;line&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">line</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¤„ç†æ¯ä¸€è¡Œæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-2-å‘æ–‡ä»¶å†™å…¥æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-å‘æ–‡ä»¶å†™å…¥æ•°æ®"><span>ä¾‹å­ 2ï¼šå‘æ–‡ä»¶å†™å…¥æ•°æ®</span></a></h4><p>å¦‚æœä½ æƒ³ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨å†™å…¥è¿‡ç¨‹ä¸­é€æ­¥æ·»åŠ å†…å®¹ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§å†™å…¥æ‰€æœ‰å†…å®¹ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;fs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createWriteStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;output-file.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `&lt;`</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`è¿™æ˜¯ç¬¬ </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> è¡Œå†…å®¹</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// é€è¡Œå†™å…¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å®Œæˆå†™å…¥</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¾‹å­-3-æ•°æ®å‹ç¼©" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-3-æ•°æ®å‹ç¼©"><span>ä¾‹å­ 3ï¼šæ•°æ®å‹ç¼©</span></a></h4><p>å¦‚æœä½ æƒ³åœ¨ç”¨æˆ·ä¸‹è½½æ–‡ä»¶æ—¶åŠ¨æ€è¿›è¡Œå‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨ Transform æµç»“åˆ zlib æ¨¡å—æ¥å®ç°ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;zlib&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> http</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;http&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;large-file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> zip</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> zlib</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createGzip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeHead</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Content-Encoding&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;gzip&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">zip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pipe</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†æ–‡ä»¶æµè¿æ¥åˆ°å‹ç¼©æµï¼Œå†è¿æ¥åˆ°å“åº”æµ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç»“è®º-7" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-7"><span>ç»“è®º</span></a></h3><p>Streams åœ¨ Node.js ä¸­æ˜¯å¤„ç†å¤§é‡æ•°æ®æ—¶çš„å…³é”®æŠ½è±¡æ¦‚å¿µï¼Œå®ƒèƒ½æœ‰æ•ˆåœ°å¸®åŠ©æˆ‘ä»¬æ§åˆ¶å†…å­˜ä½¿ç”¨ï¼Œæå‡æ€§èƒ½ã€‚é€šè¿‡ä¸Šè¿°ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºæ˜¯è¯»å–å¤§æ–‡ä»¶ã€é€æ­¥ç”Ÿæˆæ–‡ä»¶è¿˜æ˜¯å®æ—¶æ•°æ®å‹ç¼©ï¼Œstreams éƒ½ä¸ºæˆ‘ä»¬æä¾›äº†ä¼˜é›…é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚</p><h3 id="streams-compatibility-with-async-generators-and-async-iterators" tabindex="-1"><a class="header-anchor" href="#streams-compatibility-with-async-generators-and-async-iterators"><span><a href="https://nodejs.org/docs/latest/api/stream.html#streams-compatibility-with-async-generators-and-async-iterators" target="_blank" rel="noopener noreferrer">Streams compatibility with async generators and async iterators</a></span></a></h3><p>åœ¨ Node.js ä¸­ï¼ŒStreams æ˜¯ä¸€ç§å¤„ç†æ•°æ®æµçš„æŠ½è±¡æ¦‚å¿µã€‚å®ƒä»¬å¯ä»¥è®©æˆ‘ä»¬ä»¥éå¸¸é«˜æ•ˆçš„æ–¹å¼å¤„ç†å¤§é‡æ•°æ®ï¼Œæ¯”å¦‚ä»æ–‡ä»¶è¯»å–æ•°æ®æˆ–è€…ä»ç½‘ç»œæ¥æ”¶æ•°æ®ã€‚Node.js v21.7.1 ä¸­æåˆ°çš„â€œStreams compatibility with async generators and async iteratorsâ€ï¼Œæ„å‘³ç€ Streams ç°åœ¨ä¸å¼‚æ­¥ç”Ÿæˆå™¨å’Œå¼‚æ­¥è¿­ä»£å™¨å…¼å®¹äº†ã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ†åˆ«ç†è§£ä»€ä¹ˆæ˜¯å¼‚æ­¥ç”Ÿæˆå™¨ï¼ˆasync generatorsï¼‰å’Œå¼‚æ­¥è¿­ä»£å™¨ï¼ˆasync iteratorsï¼‰ã€‚</p><p><strong>å¼‚æ­¥ç”Ÿæˆå™¨ï¼ˆAsync Generatorsï¼‰</strong>:</p><ul><li>å¼‚æ­¥ç”Ÿæˆå™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œå®ƒèƒ½å¤Ÿä¸€æ¬¡è¿”å›å¤šä¸ªå€¼ï¼Œå¹¶ä¸”è¿™äº›å€¼çš„è¿”å›æ˜¯å¼‚æ­¥çš„ã€‚å®ƒé€šè¿‡<code>async function*</code>è¯­æ³•å®šä¹‰ã€‚</li><li>ä½¿ç”¨<code>yield</code>æ¥äº§ç”Ÿåºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå€¼ã€‚</li><li>è¿™ä½¿å¾—å¼‚æ­¥ç”Ÿæˆå™¨éå¸¸é€‚åˆäºæŒ‰éœ€å¤„ç†æ•°æ®æµä¸­çš„æ¯ä¸€å—æ•°æ®ã€‚</li></ul><p><strong>å¼‚æ­¥è¿­ä»£å™¨ï¼ˆAsync Iteratorsï¼‰</strong>:</p><ul><li>å¼‚æ­¥è¿­ä»£å™¨å…è®¸æˆ‘ä»¬å¼‚æ­¥åœ°éå†ä¸€ä¸ªé›†åˆï¼Œæ¯”å¦‚æ•°ç»„æˆ–å­—ç¬¦ä¸²ã€‚</li><li>å®ƒé€šè¿‡ä½¿ç”¨<code>Symbol.asyncIterator</code>æ¥å®ç°ï¼Œæ˜¯ä¸€ç§éµå¾ªç‰¹å®šåè®®çš„å¯¹è±¡ã€‚</li><li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>for await...of</code>å¾ªç¯æ¥éå†å¼‚æ­¥è¿­ä»£å™¨è¿”å›çš„å€¼ã€‚</li></ul><p><strong>å°† Streams ä¸å¼‚æ­¥ç”Ÿæˆå™¨å’Œå¼‚æ­¥è¿­ä»£å™¨ç»“åˆçš„ä¼˜åŠ¿</strong>:</p><p>ç»“åˆè¿™ä¸¤è€…ï¼Œå°±å¯ä»¥æ›´åŠ çµæ´»å’Œé«˜æ•ˆåœ°å¤„ç† Streams ä¸­çš„æ•°æ®ã€‚æ¯”å¦‚ï¼š</p><ol><li><p><strong>æ–‡ä»¶å¤„ç†</strong>: å‡è®¾ä½ æœ‰ä¸€ä¸ªéå¸¸å¤§çš„æ—¥å¿—æ–‡ä»¶ï¼Œä½ æƒ³è¦é€è¡Œè¯»å–å¹¶å¤„ç†å…¶ä¸­çš„æ¯ä¸€è¡Œã€‚ä½¿ç”¨ Stream é…åˆå¼‚æ­¥è¿­ä»£å™¨ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæµå¼çš„å¤„ç†è¿‡ç¨‹ï¼Œåªåœ¨éœ€è¦æ—¶è¯»å–ä¸‹ä¸€è¡Œï¼Œä»è€Œæ˜¾è‘—é™ä½å†…å­˜æ¶ˆè€—ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;readline&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> processLogFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">filePath</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> rl</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readline</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createInterface</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    input</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">readStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    crlfDelay</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">Infinity</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  for</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> line</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> rl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¤„ç†æ¯ä¸€è¡Œ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`æ—¥å¿—è¡Œï¼š</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">line</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">processLogFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./path/to/your/logfile.log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç½‘ç»œè¯·æ±‚</strong>: å¦‚æœä½ çš„åº”ç”¨éœ€è¦ä»ä¸€ä¸ª API æ‰¹é‡è·å–æ•°æ®ï¼Œä½ å¯èƒ½ä¼šä½¿ç”¨ Streams æ¥å¤„ç†å“åº”ä½“ã€‚åˆ©ç”¨å¼‚æ­¥è¿­ä»£å™¨ï¼Œä½ å¯ä»¥æ›´åŠ ç²¾ç¡®åœ°æ§åˆ¶ä½•æ—¶å¤„ç†æ¯ä¸€å—æ•°æ®ï¼Œç‰¹åˆ«æ˜¯å½“å“åº”ä½“éå¸¸å¤§æ—¶ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> https</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    https</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dataChunks</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        dataChunks</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">concat</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dataChunks</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">      res</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">reject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> asyncDataGenerator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> rawData</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  yield*</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> rawData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">split</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æ•°æ®æ˜¯æŒ‰è¡Œåˆ†éš”çš„</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> processApiData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  for</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> dataLine</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> of</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> asyncDataGenerator</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // å¤„ç†æ¯ä¸€è¡Œ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`API æ•°æ®è¡Œï¼š</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">dataLine</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">processApiData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://example.com/api/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>ä¸Šè¿°ä¾‹å­è¯´æ˜äº†å¦‚ä½•åˆ©ç”¨ Node.js ä¸­çš„ Streams ä¸å¼‚æ­¥ç”Ÿæˆå™¨å’Œå¼‚æ­¥è¿­ä»£å™¨ç»“åˆæ¥å¤„ç†å¤§é‡æ•°æ®ï¼Œæ— è®ºæ˜¯ä»æ–‡ä»¶ä¸­è¯»å–è¿˜æ˜¯ä»ç½‘ç»œè¯·æ±‚ä¸­è·å–ã€‚è¿™ç§æ–¹æ³•æé«˜äº†ä»£ç çš„æ•ˆç‡å’Œå¯è¯»æ€§ï¼ŒåŒæ—¶å‡å°‘äº†å†…å­˜çš„ä½¿ç”¨ã€‚</p><h4 id="consuming-readable-streams-with-async-iterators" tabindex="-1"><a class="header-anchor" href="#consuming-readable-streams-with-async-iterators"><span><a href="https://nodejs.org/docs/latest/api/stream.html#consuming-readable-streams-with-async-iterators" target="_blank" rel="noopener noreferrer">Consuming readable streams with async iterators</a></span></a></h4><p>å¥½çš„ï¼Œè®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥ç†è§£è¿™ä¸ªæ¦‚å¿µã€‚</p><h3 id="node-js-å’Œ-streams" tabindex="-1"><a class="header-anchor" href="#node-js-å’Œ-streams"><span>Node.js å’Œ Streams</span></a></h3><p>é¦–å…ˆï¼ŒNode.js æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ JavaScript è¿è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸ä½ åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ JavaScriptã€‚è€Œåœ¨ Node.js ä¸­ï¼Œ**Streamï¼ˆæµï¼‰**æ˜¯ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¦‚å¿µã€‚æµå¯ä»¥ç”¨æ¥å¤„ç†æ•°æ®ï¼Œæ¯”å¦‚è¯»å–æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰åœºæ™¯ï¼Œå®ƒä»¬çš„ç‰¹ç‚¹æ˜¯æ•°æ®ä¸æ˜¯ä¸€æ¬¡æ€§åˆ°è¾¾çš„ï¼Œè€Œæ˜¯ä¸€ç‚¹ä¸€ç‚¹åœ°å¤„ç†ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯-readable-streams-å¯è¯»æµ" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-readable-streams-å¯è¯»æµ"><span>ä»€ä¹ˆæ˜¯ Readable Streamsï¼ˆå¯è¯»æµï¼‰</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œ**Readable Streamsï¼ˆå¯è¯»æµï¼‰**æ˜¯ä¸€ç§æµï¼Œå®ƒå…è®¸ä½ è¯»å–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå½“ä½ ä»æ–‡ä»¶ç³»ç»Ÿä¸­è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨å¯è¯»æµå¯ä»¥é€å—åœ°è¯»å–æ–‡ä»¶å†…å®¹ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><h3 id="æ¶ˆè´¹-readable-streams" tabindex="-1"><a class="header-anchor" href="#æ¶ˆè´¹-readable-streams"><span>æ¶ˆè´¹ Readable Streams</span></a></h3><p>â€œæ¶ˆè´¹â€å¯è¯»æµæ„å‘³ç€ä»¥æŸç§æ–¹å¼å¤„ç†è¿™äº›æµå¼æ•°æ®ã€‚ä¼ ç»Ÿä¸Šï¼Œä½ å¯èƒ½ä¼šç›‘å¬ä¸€äº›äº‹ä»¶ï¼ˆå¦‚<code>&#39;data&#39;</code>å’Œ<code>&#39;end&#39;</code>äº‹ä»¶ï¼‰æ¥å¤„ç†æµä¸­çš„æ•°æ®ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼éœ€è¦æ‰‹åŠ¨ç®¡ç†æµçš„çŠ¶æ€å’Œé”™è¯¯å¤„ç†ï¼Œè¿™æœ‰æ—¶ä¼šå˜å¾—å¤æ‚ã€‚</p><h3 id="async-iterators-å¼‚æ­¥è¿­ä»£å™¨" tabindex="-1"><a class="header-anchor" href="#async-iterators-å¼‚æ­¥è¿­ä»£å™¨"><span>Async Iteratorsï¼ˆå¼‚æ­¥è¿­ä»£å™¨ï¼‰</span></a></h3><p>å¼‚æ­¥è¿­ä»£å™¨æä¾›äº†ä¸€ç§æ›´ç®€æ´ã€æ›´ç°ä»£çš„æ–¹å¼æ¥å¤„ç†å¼‚æ­¥æ•°æ®æµã€‚é€šè¿‡ä½¿ç”¨ <code>for-await-of</code> å¾ªç¯ï¼Œä½ å¯ä»¥éå¸¸ç›´è§‚åœ°éå†å¼‚æ­¥äº§ç”Ÿçš„æ•°æ®ï¼Œå°±åƒéå†ä¸€ä¸ªæ•°ç»„ä¸€æ ·ç®€å•ã€‚</p><h3 id="å®é™…è¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨"><span>å®é™…è¿ç”¨</span></a></h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å«å¤šç¯‡æ–‡ç« æ•°æ®çš„å¤§å‹æ–‡æœ¬æ–‡ä»¶ï¼Œæˆ‘ä»¬æƒ³è¦é€ç¯‡è¯»å–æ¯ç¯‡æ–‡ç« å¹¶å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚ä½¿ç”¨ Node.js ä¸­çš„å¯è¯»æµå’Œå¼‚æ­¥è¿­ä»£å™¨ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p><ol><li><strong>åˆ›å»ºä¸€ä¸ªå¯è¯»æµ</strong> - é¦–å…ˆï¼Œæˆ‘ä»¬ä»æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªæŒ‡å‘è¯¥å¤§æ–‡ä»¶çš„å¯è¯»æµã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/article/bigfile.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  highWaterMark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¯æ¬¡è¯»å–1KBæ•°æ®ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>ä½¿ç”¨å¼‚æ­¥è¿­ä»£å™¨æ¶ˆè´¹æµ</strong> - æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>for-await-of</code> æ¥éå†æµä¸­çš„æ•°æ®ã€‚</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> processArticles</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  for</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¤„ç†æ¯ä¸ªæ•°æ®å—ï¼Œè¿™é‡Œåªæ˜¯ç®€å•åœ°æ‰“å°å‡ºæ¥ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">processArticles</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>chunk</code> è¡¨ç¤ºä»æµä¸­è¯»å–çš„æ•°æ®å—ã€‚ç”±äºæˆ‘ä»¬è®¾ç½®äº† <code>highWaterMark</code> ä¸º 1024 å­—èŠ‚ï¼Œæ¯ä¸ª <code>chunk</code> çš„å¤§å°æœ€å¤šä¸º 1KBã€‚<code>for-await-of</code> å¾ªç¯ç­‰å¾…æ¯ä¸ªæ•°æ®å—å¼‚æ­¥åˆ°è¾¾ï¼Œå¹¶ä¸”ä¸€æ—¦æ¥æ”¶åˆ°ï¼Œå°±æ‰§è¡Œå¾ªç¯ä½“å†…çš„ä»£ç ã€‚</p><h3 id="æ€»ç»“-33" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“-33"><span>æ€»ç»“</span></a></h3><p>ä½¿ç”¨å¼‚æ­¥è¿­ä»£å™¨æ¶ˆè´¹å¯è¯»æµæ˜¯å¤„ç† Node.js ä¸­æµæ•°æ®çš„ä¸€ç§æ›´ç°ä»£ã€æ›´ç®€æ´çš„æ–¹æ³•ã€‚å®ƒä½¿å¾—ä»£ç æ›´æ˜“äºç¼–å†™ï¼Œä¹Ÿæ›´æ˜“äºé˜…è¯»ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†åƒæ–‡ä»¶è¯»å–è¿™æ ·çš„å¼‚æ­¥æ“ä½œæ—¶ã€‚</p><h4 id="creating-readable-streams-with-async-generators" tabindex="-1"><a class="header-anchor" href="#creating-readable-streams-with-async-generators"><span><a href="https://nodejs.org/docs/latest/api/stream.html#creating-readable-streams-with-async-generators" target="_blank" rel="noopener noreferrer">Creating readable streams with async generators</a></span></a></h4><p>åœ¨ Node.js ä¸­ï¼Œæµï¼ˆStreamsï¼‰æ˜¯å¤„ç†è¯»å†™æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œå…è®¸ä½ ä»¥è¿ç»­çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚æœ‰å››ç§åŸºæœ¬ç±»å‹çš„æµï¼šå¯è¯»ï¼ˆReadableï¼‰ã€å¯å†™ï¼ˆWritableï¼‰ã€åŒå·¥ï¼ˆDuplexï¼‰å’Œè½¬æ¢ï¼ˆTransformï¼‰æµã€‚</p><p>Node.js v21.7.1 å¼•å…¥äº†ä¸€ç§ä½¿ç”¨å¼‚æ­¥ç”Ÿæˆå™¨ï¼ˆasync generatorsï¼‰æ¥åˆ›å»ºå¯è¯»æµï¼ˆReadable Streamsï¼‰çš„æ–°æ–¹æ³•ã€‚è¿™æä¾›äº†ä¸€ç§æ›´ç®€æ´ã€æ›´ç›´æ¥çš„æ–¹å¼æ¥å¤„ç†å¼‚æ­¥æ“ä½œäº§ç”Ÿçš„æ•°æ®æµã€‚</p><h3 id="å¼‚æ­¥ç”Ÿæˆå™¨-async-generators" tabindex="-1"><a class="header-anchor" href="#å¼‚æ­¥ç”Ÿæˆå™¨-async-generators"><span>å¼‚æ­¥ç”Ÿæˆå™¨ï¼ˆAsync Generatorsï¼‰</span></a></h3><p>é¦–å…ˆï¼Œç†è§£ä»€ä¹ˆæ˜¯å¼‚æ­¥ç”Ÿæˆå™¨å¾ˆé‡è¦ã€‚å¼‚æ­¥ç”Ÿæˆå™¨æ˜¯ ES2018 ä¸­å¼•å…¥çš„ JavaScript ç‰¹æ€§ï¼Œå®ƒç»“åˆäº†<code>async/await</code>å’Œç”Ÿæˆå™¨ï¼ˆgeneratorsï¼‰çš„åŠŸèƒ½ã€‚ç”Ÿæˆå™¨å…è®¸ä½ æŒ‰éœ€äº§ç”Ÿä¸€ç³»åˆ—çš„å€¼ï¼Œè€Œå¼‚æ­¥ç”Ÿæˆå™¨åˆ™å…è®¸åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­åŒ…å«å¼‚æ­¥æ“ä½œã€‚</p><h3 id="åˆ›å»ºå¯è¯»æµ" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºå¯è¯»æµ"><span>åˆ›å»ºå¯è¯»æµ</span></a></h3><p>ä½¿ç”¨å¼‚æ­¥ç”Ÿæˆå™¨åˆ›å»ºå¯è¯»æµçš„åŸºæœ¬æ€æƒ³æ˜¯å°†ä¸€ä¸ªå¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°ä¼ é€’ç»™<code>stream.Readable.from()</code>æ–¹æ³•ã€‚è¿™ä¸ªå‡½æ•°åº”è¯¥<code>yield</code>ä½ æƒ³é€šè¿‡æµå‘é€çš„æ•°æ®å—ã€‚æ¯å½“ç”Ÿæˆå™¨<code>yield</code>ä¸€ä¸ªå€¼ï¼Œå®ƒå°±ä¼šæˆä¸ºæµä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå¤–éƒ¨çš„æ¶ˆè´¹è€…å¯ä»¥é€ä¸ªåœ°è¯»å–è¿™äº›å€¼ã€‚</p><h3 id="å®é™…ä¾‹å­-2" tabindex="-1"><a class="header-anchor" href="#å®é™…ä¾‹å­-2"><span>å®é™…ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-ä»-api-è¯»å–æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-ä»-api-è¯»å–æ•°æ®"><span>ä¾‹å­ 1: ä» API è¯»å–æ•°æ®</span></a></h4><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª APIï¼Œå®ƒæŒ‰é¡µè¿”å›ç”¨æˆ·æ•°æ®ï¼Œæˆ‘ä»¬æƒ³è¦å°†è¿™äº›æ•°æ®ä½œä¸ºä¸€ä¸ªæµå¤„ç†ï¼Œæ¯è·å–ä¸€é¡µæ•°æ®å°±å¤„ç†ä¸€æ¬¡ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fetch</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;node-fetch&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ä½¿ç”¨ node-fetch æ¥å‘èµ· HTTP è¯·æ±‚</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> generateUserData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> page</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> hasMore</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  while</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hasMore</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`https://api.example.com/users?page=</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">page</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    yield</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">users</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    hasMore</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">hasMore</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾ API è¿”å›ä¸€ä¸ª hasMore å­—æ®µå‘Šè¯‰æˆ‘ä»¬æ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    page</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">generateUserData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¤„ç†æ¯ä¸€æ‰¹ç”¨æˆ·æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¼‚æ­¥ç”Ÿæˆå™¨<code>generateUserData</code>ï¼Œå®ƒé€é¡µä» API è·å–ç”¨æˆ·æ•°æ®ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨<code>Readable.from()</code>å°†è¿™ä¸ªç”Ÿæˆå™¨è½¬æ¢æˆä¸€ä¸ªå¯è¯»æµï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›‘å¬<code>data</code>äº‹ä»¶æ¥é€ä¸ªå¤„ç†æ•°æ®äº†ã€‚</p><h4 id="ä¾‹å­-2-ç”Ÿæˆæ—¶é—´åºåˆ—" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-ç”Ÿæˆæ—¶é—´åºåˆ—"><span>ä¾‹å­ 2: ç”Ÿæˆæ—¶é—´åºåˆ—</span></a></h4><p>æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæµï¼Œè¿™ä¸ªæµæ¯éš”ä¸€ç§’äº§ç”Ÿå½“å‰çš„æ—¶é—´æˆ³ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> generateTimeSeries</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  while</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    await</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç­‰å¾…ä¸€ç§’</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    yield</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// äº§ç”Ÿå½“å‰æ—¥æœŸæ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">generateTimeSeries</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">time</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¯ç§’è¾“å‡ºå½“å‰æ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ<code>generateTimeSeries</code>æ˜¯ä¸€ä¸ªæ°¸æ— æ­¢å¢ƒçš„å¼‚æ­¥ç”Ÿæˆå™¨ï¼Œå®ƒæ¯ç§’<code>yield</code>ä¸€æ¬¡å½“å‰çš„æ—¥æœŸæ—¶é—´ã€‚é€šè¿‡<code>Readable.from()</code>ï¼Œæˆ‘ä»¬å°†å®ƒè½¬æ¢ä¸ºå¯è¯»æµï¼Œå¹¶ä¸”å¯ä»¥ç›‘å¬åˆ°æµä¸­æ¯æ¬¡äº§ç”Ÿçš„æ–°æ—¶é—´æˆ³ã€‚</p><h3 id="ç»“è®º-8" tabindex="-1"><a class="header-anchor" href="#ç»“è®º-8"><span>ç»“è®º</span></a></h3><p>é€šè¿‡ä½¿ç”¨å¼‚æ­¥ç”Ÿæˆå™¨ä¸<code>Readable.from()</code>æ–¹æ³•ï¼ŒNode.js ä¸ºå¤„ç†å„ç§å¼‚æ­¥æ•°æ®æºæä¾›äº†å¼ºå¤§è€Œçµæ´»çš„å·¥å…·ï¼Œä½¿å¾—åˆ›å»ºå¤æ‚çš„æ•°æ®å¤„ç†ç®¡é“å˜å¾—æ›´ä¸ºç®€å•å’Œç›´è§‚ã€‚</p><h4 id="piping-to-writable-streams-from-async-iterators" tabindex="-1"><a class="header-anchor" href="#piping-to-writable-streams-from-async-iterators"><span><a href="https://nodejs.org/docs/latest/api/stream.html#piping-to-writable-streams-from-async-iterators" target="_blank" rel="noopener noreferrer">Piping to writable streams from async iterators</a></span></a></h4><p>å½“ç„¶ï¼Œè®©æˆ‘æ¥è¯¦ç»†è§£é‡Š Node.js ä¸­å…³äº**ä»å¼‚æ­¥è¿­ä»£å™¨å‘å¯å†™æµè¿›è¡Œç®¡é“ä¼ è¾“ï¼ˆPiping to writable streams from async iteratorsï¼‰**çš„æ¦‚å¿µï¼Œå¹¶ä¸”ç»™ä½ ä¸¾ä¸€äº›å®é™…çš„ä¾‹å­æ¥å¸®åŠ©ç†è§£ã€‚</p><p>åœ¨æ·±å…¥ä¹‹å‰ï¼Œæœ‰å¿…è¦äº†è§£å‡ ä¸ªåŸºæœ¬æ¦‚å¿µï¼š</p><ol><li><p><strong>å¼‚æ­¥è¿­ä»£å™¨ï¼ˆAsync Iteratorsï¼‰</strong>ï¼šè¿™æ˜¯ JavaScript çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå®ƒå…è®¸æˆ‘ä»¬é€šè¿‡ä½¿ç”¨<code>for await...of</code>å¾ªç¯å¼‚æ­¥åœ°è¿­ä»£æ•°æ®ã€‚ç®€å•æ¥è¯´ï¼Œå¦‚æœä½ æœ‰ä¸€ç³»åˆ—æ•°æ®éœ€è¦å¤„ç†ï¼Œè€Œè¿™äº›æ•°æ®çš„è·å–åˆæ˜¯å¼‚æ­¥çš„ï¼ˆæ¯”å¦‚ä»æ•°æ®åº“æˆ–è€…æ–‡ä»¶ç³»ç»Ÿè¯»å–ï¼‰ï¼Œé‚£ä¹ˆå¼‚æ­¥è¿­ä»£å™¨å°±éå¸¸æœ‰ç”¨äº†ã€‚</p></li><li><p><strong>å¯å†™æµï¼ˆWritable Streamsï¼‰</strong>ï¼šåœ¨ Node.js ä¸­ï¼Œæµæ˜¯ç”¨æ¥å¤„ç†æ•°æ®çš„ã€‚å¦‚æœä½ æƒ³æŠŠæ•°æ®å†™å…¥åˆ°æŸä¸ªç›®çš„åœ°ï¼Œæ¯”å¦‚æ–‡ä»¶ã€HTTP å“åº”æˆ–è€…æ ‡å‡†è¾“å‡ºï¼ˆæ§åˆ¶å°ï¼‰ï¼Œä½ å¯ä»¥ä½¿ç”¨å¯å†™æµã€‚</p></li></ol><p>ç°åœ¨ï¼Œç»“åˆè¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œåœ¨ Node.js v21.7.1 ä¸­ï¼Œä½ å¯ä»¥æ–¹ä¾¿åœ°ä»ä¸€ä¸ªå¼‚æ­¥è¿­ä»£å™¨å°†æ•°æ®â€œç®¡é“â€åˆ°ä¸€ä¸ªå¯å†™æµã€‚æ‰€è°“â€œç®¡é“â€ï¼Œæ„å‘³ç€ä½ å¯ä»¥é¡ºç•…åœ°ä»æ•°æ®æºä¼ è¾“æ•°æ®åˆ°ç›®çš„åœ°ï¼Œä¸­é—´ä¸éœ€è¦æ‰‹åŠ¨è°ƒæ•´æˆ–é¢å¤–å¤„ç†ã€‚</p><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-28" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-28"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Node.js åº”ç”¨ç¨‹åºï¼Œè¯¥ç¨‹åºéœ€è¦ä»ä¸€ä¸ªå¼‚æ­¥ API è·å–ä¸€ç³»åˆ—æ•°æ®ï¼Œç„¶åæŠŠè¿™äº›æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨è¿™ä¸€ç‰¹æ€§çš„ç¤ºä¾‹ï¼š</p><h4 id="ç¤ºä¾‹-1-ä»å¼‚æ­¥-api-å†™å…¥åˆ°æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1-ä»å¼‚æ­¥-api-å†™å…¥åˆ°æ–‡ä»¶"><span>ç¤ºä¾‹ 1: ä»å¼‚æ­¥ API å†™å…¥åˆ°æ–‡ä»¶</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">writeFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;fs/promises&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;stream&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾è¿™æ˜¯ä»å¼‚æ­¥APIè·å–æ•°æ®çš„å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> part</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">part</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `&lt;`</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // åœ¨çœŸå®åœºæ™¯ä¸­ï¼Œè¿™é‡Œå¯èƒ½æ˜¯ä¸€ä¸ªå¼‚æ­¥APIè°ƒç”¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        yield</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> `æ•°æ®éƒ¨åˆ†</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">part</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        part</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å°†å¼‚æ­¥è¿­ä»£å™¨çš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> writeToAFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> iterStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> chunks</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    for</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> iterStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        chunks</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> writeFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;output.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunks</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">writeToAFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;æ•°æ®å†™å…¥å®Œæˆ&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>fetchData()</code>å‡½æ•°æ¨¡æ‹Ÿäº†ä¸€ä¸ªå¼‚æ­¥ç”Ÿæˆæ•°æ®çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬ä½¿ç”¨<code>Readable.from()</code>æ–¹æ³•å°†å…¶è½¬æ¢æˆä¸€ä¸ªå¯è¯»æµï¼Œç„¶åé€šè¿‡å¼‚æ­¥è¿­ä»£ï¼Œæˆ‘ä»¬éå†è¿™ä¸ªæµä¸­çš„æ‰€æœ‰æ•°æ®å—ï¼ˆchunksï¼‰ï¼Œå¹¶å°†å®ƒä»¬æ”¶é›†èµ·æ¥ã€‚æœ€åï¼Œæˆ‘ä»¬æŠŠè¿™äº›æ•°æ®å—å†™å…¥åˆ°<code>output.txt</code>æ–‡ä»¶ã€‚</p><p>æ­¤ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨å¼‚æ­¥è¿­ä»£å™¨å’Œ Node.js ä¸­çš„æµï¼Œä»¥ç®€æ´è€Œé«˜æ•ˆçš„æ–¹å¼å¤„ç†å’Œè½¬ç§»æ•°æ®ã€‚è¿™ç§æŠ€æœ¯å°¤å…¶é€‚ç”¨äºå¤„ç†å¤§é‡æ•°æ®ï¼Œæˆ–è€…åœ¨æ•°æ®ç”Ÿäº§å’Œæ¶ˆè´¹é€Ÿåº¦ä¸ä¸€è‡´æ—¶ä¿æŒåº”ç”¨çš„æ•ˆç‡å’Œå“åº”æ€§ã€‚</p><h3 id="compatibility-with-older-node-js-versions" tabindex="-1"><a class="header-anchor" href="#compatibility-with-older-node-js-versions"><span><a href="https://nodejs.org/docs/latest/api/stream.html#compatibility-with-older-nodejs-versions" target="_blank" rel="noopener noreferrer">Compatibility with older Node.js versions</a></span></a></h3><p>Node.js æ˜¯ä¸€ä¸ªåŸºäº Chrome çš„ V8 å¼•æ“ï¼Œå¯ä»¥è®©ä½ ä½¿ç”¨ JavaScript æ¥ç¼–å†™æœåŠ¡å™¨ç«¯çš„ä»£ç ã€‚åœ¨ Node.js çš„ä¸–ç•Œé‡Œï¼Œæœ‰ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¦‚å¿µå«åšâ€œæµï¼ˆStreamsï¼‰â€ï¼Œå®ƒå…è®¸ä½ ä»¥éå¸¸é«˜æ•ˆçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œæ¯”å¦‚è¯»å–æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ã€‚</p><h3 id="å…¼å®¹æ€§é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#å…¼å®¹æ€§é—®é¢˜"><span>å…¼å®¹æ€§é—®é¢˜</span></a></h3><p>å¯¹äºä¸åŒç‰ˆæœ¬çš„ Node.jsï¼Œå…¶å†…ç½®çš„ <code>streams</code> æ¨¡å—å¯èƒ½ä¼šè¡¨ç°å‡ºä¸åŒçš„è¡Œä¸ºã€‚è¿™æ„å‘³ç€ï¼Œåœ¨æ–°ç‰ˆæœ¬çš„ Node.js ä¸­ç¼–å†™çš„å…³äºæµçš„ä»£ç ï¼Œå¯èƒ½æ— æ³•åœ¨æ—§ç‰ˆæœ¬çš„ç¯å¢ƒä¸­æ­£å¸¸è¿è¡Œï¼Œåä¹‹äº¦ç„¶ã€‚ä¸»è¦åŸå› æ˜¯ Node.js åœ¨å‘å±•è¿‡ç¨‹ä¸­å¯¹ <code>streams</code> API è¿›è¡Œäº†æ”¹è¿›å’Œä¿®æ­£ï¼Œå¯¼è‡´ä¸åŒç‰ˆæœ¬ä¹‹é—´å­˜åœ¨å…¼å®¹æ€§å·®å¼‚ã€‚</p><h3 id="å®é™…è¿ç”¨ä¾‹å­-26" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ä¾‹å­-26"><span>å®é™…è¿ç”¨ä¾‹å­</span></a></h3><p><strong>1. æ–‡ä»¶è¯»å–</strong></p><p>å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ Node.js å¼€å‘ä¸€ä¸ªåº”ç”¨ï¼Œè¿™ä¸ªåº”ç”¨éœ€è¦ä»æ–‡ä»¶ç³»ç»Ÿä¸­è¯»å–å¤§é‡æ•°æ®ï¼Œå¹¶å¤„ç†è¿™äº›æ•°æ®ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œä½¿ç”¨æµå¯ä»¥éå¸¸é«˜æ•ˆåœ°é€å—è¯»å–æ•°æ®ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¿™å¯¹äºå¤„ç†å¤§æ–‡ä»¶æ¥è¯´å°¤å…¶é‡è¦ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./bigfile.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No more data in stream.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. ç½‘ç»œé€šä¿¡</strong></p><p>è€ƒè™‘ä¸€ä¸ªå®æ—¶èŠå¤©åº”ç”¨ï¼ŒæœåŠ¡å™¨éœ€è¦å¤„ç†æ¥è‡ªå¤šä¸ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯ã€‚ä½¿ç”¨ Node.js çš„ <code>net</code> æ¨¡å—ï¼Œä½ å¯ä»¥åˆ›å»ºåŸºäº TCP çš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼Œåˆ©ç”¨æµæ¥æ¥æ”¶å’Œå‘é€æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> net</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;net&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºæœåŠ¡å™¨</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> net</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createServer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Hello from server!</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  socket</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server closing connection.</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Server is running on port 8080&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è§£å†³å…¼å®¹æ€§é—®é¢˜çš„æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#è§£å†³å…¼å®¹æ€§é—®é¢˜çš„æ–¹æ³•"><span>è§£å†³å…¼å®¹æ€§é—®é¢˜çš„æ–¹æ³•</span></a></h3><ol><li><p><strong>æ–‡æ¡£é˜…è¯»</strong>: é˜…è¯» Node.js å®˜æ–¹æ–‡æ¡£ï¼Œç‰¹åˆ«æ˜¯ <code>streams</code> æ¨¡å—ç›¸å…³å†…å®¹çš„å†å²å˜æ›´å’Œè¿ç§»æŒ‡å—ï¼Œä»¥ç†è§£ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚ã€‚</p></li><li><p><strong>ä½¿ç”¨ polyfills æˆ– shim</strong>: å¯¹äºä¸€äº›è¾ƒè€çš„ Node.js ç‰ˆæœ¬ï¼Œä½ å¯ä»¥ä½¿ç”¨å…¼å®¹å±‚ï¼ˆpolyfillsï¼‰æˆ–å¡«å……åº“ï¼ˆshimï¼‰ï¼Œä»¥æ¨¡æ‹Ÿè¾ƒæ–°ç‰ˆæœ¬ä¸­å¼•å…¥çš„åŠŸèƒ½ã€‚</p></li><li><p><strong>ä»£ç é€‚é…</strong>: æ ¹æ®ç›®æ ‡éƒ¨ç½²ç¯å¢ƒçš„ Node.js ç‰ˆæœ¬ï¼Œæœ‰æ¡ä»¶åœ°ç¼–å†™ä»£ç ï¼Œä½¿ç”¨å¯åœ¨è¯¥ç‰ˆæœ¬ä¸Šè¿è¡Œçš„ API ç‰¹æ€§ã€‚</p></li><li><p><strong>ç‰ˆæœ¬é”å®š</strong>: å¦‚æœå…¼å®¹æ€§é—®é¢˜éš¾ä»¥è§£å†³ï¼Œå¯ä»¥è€ƒè™‘åœ¨é¡¹ç›®ä¸­é”å®š Node.js çš„ç‰ˆæœ¬ï¼Œç¡®ä¿æ‰€æœ‰å¼€å‘å’Œéƒ¨ç½²ç¯å¢ƒéƒ½ä½¿ç”¨ç›¸åŒçš„ç‰ˆæœ¬ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œå¤„ç† Node.js ä¸åŒç‰ˆæœ¬é—´çš„å…¼å®¹æ€§ï¼Œéœ€è¦å¼€å‘è€…æ·±å…¥äº†è§£ Node.js çš„ç‰ˆæœ¬æ›´æ–°å†å²ï¼Œç‰¹åˆ«æ˜¯ä¸è‡ªå·±é¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„ç‰¹æ€§ç›¸å…³çš„å˜æ›´ã€‚é€šè¿‡çµæ´»è¿ç”¨æŠ€æœ¯å’Œç­–ç•¥ï¼Œå¯ä»¥æœ€å¤§é™åº¦åœ°å‡å°‘ç‰ˆæœ¬å·®å¼‚å¸¦æ¥çš„å½±å“ã€‚</p><h3 id="readable-read-0" tabindex="-1"><a class="header-anchor" href="#readable-read-0"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readableread0" target="_blank" rel="noopener noreferrer">readable.read(0)</a></span></a></h3><p>ç†è§£ <code>readable.read(0)</code> çš„ç”¨æ³•ï¼Œé¦–å…ˆéœ€è¦å¯¹ Node.js ä¸­çš„æµï¼ˆStreamsï¼‰æœ‰åŸºæœ¬çš„äº†è§£ã€‚æµæ˜¯ä¸€ç§å¤„ç†æ•°æ®çš„æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯å½“æ•°æ®é‡å¤§æˆ–è€…æ•°æ®æ˜¯é€æ­¥äº§ç”Ÿæ—¶ã€‚åœ¨ Node.js ä¸­ï¼Œæµè¢«å¹¿æ³›åº”ç”¨äºæ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰åœºæ™¯ã€‚</p><h3 id="æµ-streams-ç®€ä»‹-9" tabindex="-1"><a class="header-anchor" href="#æµ-streams-ç®€ä»‹-9"><span>æµï¼ˆStreamsï¼‰ç®€ä»‹</span></a></h3><p>åœ¨ Node.js ä¸­ï¼Œæµåˆ†ä¸ºå››ç§ä¸»è¦ç±»å‹ï¼š</p><ol><li><strong>å¯è¯»æµï¼ˆReadableï¼‰</strong>ï¼šå…è®¸ä½ è¯»å–æ•°æ®ï¼Œä¾‹å¦‚ä»æ–‡ä»¶è¯»å–æ•°æ®ã€‚</li><li><strong>å¯å†™æµï¼ˆWritableï¼‰</strong>ï¼šå…è®¸ä½ å†™å…¥æ•°æ®ï¼Œä¾‹å¦‚å‘æ–‡ä»¶å†™å…¥æ•°æ®ã€‚</li><li><strong>åŒå·¥æµï¼ˆDuplexï¼‰</strong>ï¼šæ—¢å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™ï¼Œä¾‹å¦‚ TCP socketsã€‚</li><li><strong>è½¬æ¢æµï¼ˆTransformï¼‰</strong>ï¼šåœ¨è¯»å†™è¿‡ç¨‹ä¸­å¯ä»¥ä¿®æ”¹æˆ–è½¬æ¢æ•°æ®ï¼Œä¾‹å¦‚å‹ç¼©æµã€‚</li></ol><h3 id="readable-read-0-è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#readable-read-0-è§£é‡Š"><span><code>readable.read(0)</code> è§£é‡Š</span></a></h3><p><code>readable.read(size)</code> æ˜¯ä¸€ä¸ªç”¨äºä»å¯è¯»æµä¸­è¯»å–æ•°æ®çš„æ–¹æ³•ã€‚å…¶ä¸­ <code>size</code> å‚æ•°æ˜¯ä¸€ä¸ªå¯é€‰å€¼ï¼ŒæŒ‡å®šäº†å¸Œæœ›ä»å†…éƒ¨ç¼“å†²åŒºè¯»å–å¤šå°‘å­—èŠ‚çš„æ•°æ®ã€‚</p><ul><li>å½“è°ƒç”¨ <code>readable.read()</code> ä¸”ä¸ä¼ å…¥å‚æ•°æˆ–ä¼ å…¥éé›¶å€¼æ—¶ï¼Œå®ƒä¼šå°è¯•è¯»å–å¹¶è¿”å›ä¸€äº›æ•°æ®ã€‚å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®å¯è¯»ï¼Œåˆ™å¯èƒ½è¿”å› <code>null</code>ã€‚</li><li>å½“è°ƒç”¨ <code>readable.read(0)</code> æ—¶ï¼Œå®é™…ä¸Šå¹¶ä¸ä¼šå°è¯•ä»æµä¸­è¯»å–æ•°æ®ã€‚ç›¸åï¼Œè¿™ä¸ªæ“ä½œçš„ç›®çš„æ˜¯è§¦å‘æµæ£€æŸ¥å…¶å†…éƒ¨ç¼“å†²åŒºï¼Œå¹¶å°½å¯èƒ½å¡«å……å®ƒç›´åˆ°è¾¾åˆ°é¢„è®¾çš„é«˜æ°´ä½çº¿ï¼ˆhighWaterMarkï¼‰ã€‚è¿™é€šå¸¸ç”¨äºåœ¨æµçš„æ¶ˆè´¹è€…è¿˜æ²¡å‡†å¤‡å¥½ä»æµä¸­è¯»å–æ•°æ®å‰ï¼Œç¡®ä¿æµçš„å†…éƒ¨ç¼“å†²åŒºè¢«å¡«æ»¡ï¼Œä»¥ä¾¿åç»­å¯ä»¥æ›´é«˜æ•ˆåœ°è¯»å–ã€‚</li></ul><h3 id="å®é™…è¿ç”¨ç¤ºä¾‹-29" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨ç¤ºä¾‹-29"><span>å®é™…è¿ç”¨ç¤ºä¾‹</span></a></h3><p>å‡è®¾æˆ‘ä»¬æ­£åœ¨ç¼–å†™ä¸€ä¸ªç½‘ç»œåº”ç”¨ï¼Œéœ€è¦ä»æŸä¸ªèµ„æºï¼ˆå¦‚æ–‡ä»¶æˆ– HTTP å“åº”ï¼‰è¯»å–æ•°æ®ã€‚ä½†ç”±äºæŸäº›åŸå› ï¼Œæˆ‘ä»¬ç°åœ¨è¿˜ä¸èƒ½å¼€å§‹å¤„ç†è¿™äº›æ•°æ®ã€‚ä½¿ç”¨ <code>readable.read(0)</code> å¯ä»¥ç¡®ä¿å½“æˆ‘ä»¬å‡†å¤‡å¥½å¤„ç†æ•°æ®æ—¶ï¼Œæ•°æ®å·²ç»è¢«åŠ è½½è¿›äº†å†…éƒ¨ç¼“å†²åŒºã€‚</p><p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµï¼Œä»æŒ‡å®šæ–‡ä»¶è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;./example.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  highWaterMark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®å†…éƒ¨ç¼“å†²åŒºå¤§å°ä¸º 1KB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆå§‹æ—¶ï¼Œå¹¶ä¸ä»æµä¸­è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾åœ¨æ­¤ä¹‹åï¼Œæˆ‘ä»¬å®Œæˆäº†æŸäº›å¼‚æ­¥æ“ä½œï¼Œç°åœ¨å‡†å¤‡è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¾ªç¯è¯»å–æ•°æ®ï¼Œç›´è‡³æµä¸­æ²¡æœ‰æ›´å¤šæ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  while</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bytes of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªä»æ–‡ä»¶ <code>example.txt</code> è¯»å–æ•°æ®çš„å¯è¯»æµã€‚é€šè¿‡è®¾ç½® <code>highWaterMark</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶å†…éƒ¨ç¼“å†²åŒºçš„å¤§å°ã€‚åœ¨åˆšå¼€å§‹æ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨ <code>readable.read(0)</code> æ¥ç¡®ä¿å†…éƒ¨ç¼“å†²åŒºè¢«å°½å¯èƒ½å¡«æ»¡ã€‚ç¨åï¼Œæˆ‘ä»¬é€šè¿‡ <code>setTimeout</code> æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œï¼Œä¹‹åå¼€å§‹å¾ªç¯è¯»å–æ•°æ®ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½è¢«è¯»å–å®Œæ¯•ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œ<code>readable.read(0)</code> åœ¨ä¸€äº›ç‰¹å®šåœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½ æƒ³é¢„å…ˆå¡«å……æµçš„å†…éƒ¨ç¼“å†²åŒºï¼Œä½†æš‚æ—¶è¿˜ä¸æƒ³å¼€å§‹å¤„ç†æ•°æ®æ—¶ã€‚</p><h3 id="readable-push" tabindex="-1"><a class="header-anchor" href="#readable-push"><span><a href="https://nodejs.org/docs/latest/api/stream.html#readablepush" target="_blank" rel="noopener noreferrer">readable.push(&#39;&#39;)</a></span></a></h3><p>å½“æˆ‘ä»¬è°ˆè®º Node.js ä¸­çš„ <code>readable.push(&#39;&#39;)</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨è®¨è®ºæµï¼ˆStreamsï¼‰çš„ä¸€ä¸ªéå¸¸å…·ä½“çš„ç”¨æ³•ã€‚Node.js çš„ Streams æ˜¯ç”¨äºå¤„ç†æ•°æ®çš„ä¸€ç§æ‰‹æ®µï¼Œç‰¹åˆ«é€‚åˆå¤„ç†å¤§é‡æ•°æ®ï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰åœºæ™¯ã€‚å®ƒä»¬å¯ä»¥æ˜¯å¯è¯»çš„ã€å¯å†™çš„ï¼Œæˆ–è€…æ—¢å¯è¯»ä¹Ÿå¯å†™ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å…³æ³¨çš„æ˜¯å¯è¯»æµï¼ˆReadable streamsï¼‰ã€‚</p><h3 id="å¯è¯»æµ-readable-streams-4" tabindex="-1"><a class="header-anchor" href="#å¯è¯»æµ-readable-streams-4"><span>å¯è¯»æµï¼ˆReadable Streamsï¼‰</span></a></h3><p>ç®€å•æ¥è¯´ï¼Œå¯è¯»æµæ˜¯ä¸€ç§æ•°æ®çš„æ¥æºã€‚ä½ å¯ä»¥ä»ä¸­è¯»å–æ•°æ®ï¼Œå°±åƒä½ ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®æˆ–è€…ä»ç½‘ç»œè¯·æ±‚ä¸­æ¥æ”¶æ•°æ®ä¸€æ ·ã€‚å½“ä½ ä»å¯è¯»æµä¸­è¯»å–æ•°æ®æ—¶ï¼Œæ•°æ®ä¼šä¸€å°å—ä¸€å°å—åœ°è¢«å‘é€ï¼Œç›´åˆ°å‘é€å®Œæ¯•ã€‚è¿™ä¸ªè¿‡ç¨‹å«åš &quot;æµåŠ¨&quot; æ•°æ®ã€‚</p><h3 id="readable-push-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#readable-push-æ–¹æ³•"><span><code>readable.push(&#39;&#39;)</code> æ–¹æ³•</span></a></h3><p><code>readable.push(&#39;&#39;)</code> æ˜¯å¯è¯»æµçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†æ•°æ®å—æ·»åŠ åˆ°å¯è¯»æµä¸­ã€‚å½“ä½ è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œä½ åŸºæœ¬ä¸Šæ˜¯åœ¨å‘Šè¯‰æµï¼šâ€œå˜¿ï¼Œè¿™é‡Œæœ‰ä¸€äº›æ•°æ®ï¼Œä½ å¯èƒ½æƒ³ç»™ç›‘å¬è¿™ä¸ªæµçš„ä»»ä½•äººå‘ä¸€ä»½ã€‚â€ä½†æ˜¯ï¼Œå¦‚æœä½ ä¼ é€’çš„æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸² <code>&#39;&#39;</code>ï¼Œè¿™æ„å‘³ç€ä½ æ²¡æœ‰æ›´å¤šçš„æ•°æ®è¦æ·»åŠ äº†ï¼Œä½†ä½ å¹¶ä¸æ˜¯è¯´æµç»“æŸäº†ï¼Œä½ åªæ˜¯æš‚æ—¶æ²¡æœ‰æ•°æ®è¦æ¨é€ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-25" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-25"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><h4 id="ä¾‹å­-1-ç®€å•çš„æ–‡æœ¬ä¼ è¾“" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-1-ç®€å•çš„æ–‡æœ¬ä¼ è¾“"><span>ä¾‹å­ 1ï¼šç®€å•çš„æ–‡æœ¬ä¼ è¾“</span></a></h4><p>å‡è®¾ä½ æ­£åœ¨åˆ›å»ºä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºï¼Œè¯¥ç¨‹åºä»ä¸€ä¸ªæ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œå¹¶ä¸”ä½ å¸Œæœ›æŒ‰è¡Œå‘é€è¿™äº›æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> LineReader</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  constructor</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">fileContent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    super</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">lines</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fileContent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">split</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">lines</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">lines</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">shift</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">      this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fileContent</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Hello</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">World</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">This</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">Is</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">Node.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> lineReader</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> LineReader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">fileContent</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">lineReader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">lineReader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;No more lines.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>LineReader</code> ç±»é€šè¿‡ç»§æ‰¿ <code>Readable</code> åˆ›å»ºäº†ä¸€ä¸ªå¯è¯»æµã€‚å®ƒæ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆæ¨¡æ‹Ÿæ–‡ä»¶å†…å®¹ï¼‰ï¼Œå°†å…¶åˆ†å‰²æˆå¤šè¡Œã€‚æ¯æ¬¡ <code>_read</code> æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå®ƒä¼šå‘é€ä¸‹ä¸€è¡Œï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šçš„è¡Œå¯ä»¥å‘é€ï¼Œæ­¤æ—¶ä½¿ç”¨ <code>push(&#39;&#39;)</code> æ¥è¡¨ç¤ºæ²¡æœ‰æ›´å¤šçš„æ•°æ®äº†ã€‚</p><h4 id="ä¾‹å­-2-æ¨¡æ‹Ÿæ•°æ®æµ-1" tabindex="-1"><a class="header-anchor" href="#ä¾‹å­-2-æ¨¡æ‹Ÿæ•°æ®æµ-1"><span>ä¾‹å­ 2ï¼šæ¨¡æ‹Ÿæ•°æ®æµ</span></a></h4><p>å‡è®¾ä½ åœ¨åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿä¼ æ„Ÿå™¨æ•°æ®çš„ç¨‹åºï¼Œè¯¥ç¨‹åºä¼šä¸å®šæ—¶åœ°å‘é€æ•°æ®ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> SensorStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Readable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  _read</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Math</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">random</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toFixed</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// æ¨¡æ‹Ÿä¼ æ„Ÿå™¨æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">    this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å‡è®¾æ¯ç§’å°è¯•å‘é€ä¸€æ¬¡æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> sensorStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> SensorStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">sensorStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received sensor data: </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">sensorStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Sensor stream ended.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>SensorStream</code> ç±»åˆ›å»ºäº†ä¸€ä¸ªæ¨¡æ‹Ÿä¼ æ„Ÿå™¨æ•°æ®çš„æµã€‚<code>_read</code> æ–¹æ³•ç”Ÿæˆéšæœºæ•°æ®ä»¥æ¨¡æ‹Ÿä¼ æ„Ÿå™¨è¯»æ•°ï¼Œå¹¶é€šè¿‡ <code>setTimeout</code> åœ¨ä¸€ç§’åè°ƒç”¨ <code>this.push(&#39;&#39;)</code> æ¥æš‚æ—¶åœæ­¢æ•°æ®çš„å‘é€ï¼Œæ¨¡æ‹Ÿæ•°æ®é‡‡é›†çš„é—´æ­‡ã€‚æ³¨æ„ï¼Œåœ¨è¿™ä¸ªç®€åŒ–çš„ç¤ºä¾‹ä¸­ï¼Œæµæ°¸è¿œä¸ä¼šçœŸæ­£ç»“æŸï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰æä¾›ç»“æŸæµçš„é€»è¾‘ã€‚</p><p>ä»¥ä¸Šä¸¤ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ä¸åŒæƒ…å¢ƒä¸‹ä½¿ç”¨ <code>readable.push(&#39;&#39;)</code> æ–¹æ³•æ¥æ§åˆ¶æ•°æ®æµã€‚åœ¨ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œå®ƒç”¨äºæ ‡è®°æ•°æ®å‘é€å®Œæˆï¼›åœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œåˆ™ç”¨äºæš‚åœæ•°æ®å‘é€ã€‚åœ¨å¤„ç† Node.js ä¸­çš„æµæ—¶ï¼Œç†è§£å¦‚ä½•æ§åˆ¶æ•°æ®çš„æµåŠ¨æ˜¯éå¸¸é‡è¦çš„ã€‚</p><h3 id="highwatermark-discrepancy-after-calling-readable-setencoding" tabindex="-1"><a class="header-anchor" href="#highwatermark-discrepancy-after-calling-readable-setencoding"><span><a href="https://nodejs.org/docs/latest/api/stream.html#highwatermark-discrepancy-after-calling-readablesetencoding" target="_blank" rel="noopener noreferrer">highWaterMark discrepancy after calling readable.setEncoding()</a></span></a></h3><p>ç†è§£ Node.js ä¸­æ¶‰åŠçš„<code>highWaterMark</code>å’Œ<code>readable.setEncoding()</code>çš„æ¦‚å¿µï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ˜ç™½åœ¨ Node.js ä¸­æµ(Stream)æ˜¯ä»€ä¹ˆã€‚</p><h3 id="æµ-stream-ç®€ä»‹-3" tabindex="-1"><a class="header-anchor" href="#æµ-stream-ç®€ä»‹-3"><span>æµï¼ˆStreamï¼‰ç®€ä»‹</span></a></h3><p>æµæ˜¯ä¸€ç»„æœ‰åºçš„ã€æœ‰å§‹æœ‰ç»ˆçš„æ•°æ®å…ƒç´ åºåˆ—ã€‚åœ¨ Node.js ä¸­ï¼Œæµè¢«ç”¨äºè¯»å–æˆ–å†™å…¥æ•°æ®ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä»ä¸€ä¸ªæºé€æ­¥è¯»å–æ•°æ®ï¼Œæˆ–è€…é€æ­¥å†™å…¥æ•°æ®åˆ°ç›®æ ‡ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚æµçš„å¥½å¤„æ˜¯å¯ä»¥æ˜¾è‘—é™ä½å†…å­˜ä½¿ç”¨ï¼Œæé«˜åº”ç”¨æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯å¤„ç†å¤§é‡æ•°æ®æ—¶ã€‚</p><h3 id="highwatermark-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#highwatermark-ç®€ä»‹"><span>highWaterMark ç®€ä»‹</span></a></h3><p><code>highWaterMark</code>æ˜¯ä¸€ä¸ªä¸æµç›¸å…³çš„æ¦‚å¿µï¼Œåœ¨ Node.js ä¸­è¡¨ç¤ºæµæ“ä½œä¸­çš„ç¼“å†²åŒºå¤§å°ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒå®šä¹‰äº†åœ¨æš‚åœè¯»å–æˆ–å†™å…¥ä¹‹å‰ï¼Œæµå†…éƒ¨ç¼“å†²åŒºæœ€å¤šå¯ä»¥ç§¯ç´¯å¤šå°‘æ•°æ®ã€‚å¯¹äºå¯è¯»æµï¼Œé»˜è®¤å€¼æ˜¯ 16KBï¼ˆå¯¹äºéå¯¹è±¡æ¨¡å¼çš„æµï¼‰ï¼Œè€Œå¯¹äºå¯å†™æµï¼Œé»˜è®¤å€¼æ˜¯ 16KBã€‚</p><h3 id="setencoding-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#setencoding-æ–¹æ³•"><span>setEncoding() æ–¹æ³•</span></a></h3><p><code>setEncoding()</code>æ–¹æ³•ç”¨äºè®¾ç½®å¯è¯»æµçš„ç¼–ç ã€‚å½“ä½ è°ƒç”¨è¿™ä¸ªæ–¹æ³•åï¼Œæµä¼šè‡ªåŠ¨æŠŠ Bufferï¼ˆä¸€ä¸ªç”¨äºè¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®çš„ Node.js ç±»å‹ï¼‰è½¬æ¢ä¸ºä½ æŒ‡å®šçš„ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚&#39;utf8&#39;ã€‚è¿™æ ·ï¼Œå½“ä½ è¯»å–æ•°æ®æ—¶ï¼Œå¾—åˆ°çš„ç›´æ¥å°±æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ Buffer å¯¹è±¡ã€‚</p><h3 id="highwatermark-ä¸ä¸€è‡´é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#highwatermark-ä¸ä¸€è‡´é—®é¢˜"><span>highWaterMark ä¸ä¸€è‡´é—®é¢˜</span></a></h3><p>å½“ä½ å¯¹ä¸€ä¸ªå¯è¯»æµè®¾ç½®äº†ç¼–ç ï¼ˆé€šè¿‡<code>readable.setEncoding()</code>ï¼‰ï¼Œå®é™…å¤„ç†çš„å­—ç¬¦é•¿åº¦å¯èƒ½ä¼šå’ŒåŸå…ˆé¢„æƒ³çš„ä¸åŒã€‚åŸå› åœ¨äºï¼Œä¸€æ—¦è®¾ç½®äº†ç¼–ç ï¼Œæµå†…éƒ¨å¤„ç†çš„å•å…ƒå˜æˆäº†å­—ç¬¦è€Œä¸æ˜¯å­—èŠ‚ã€‚å­—èŠ‚åˆ°å­—ç¬¦çš„è½¬æ¢å¯èƒ½é€ æˆå®é™…çš„å­—ç¬¦æ•°ä¸åŸå§‹å­—èŠ‚ä¸ä¸€è‡´ï¼ˆç‰¹åˆ«æ˜¯å¯¹äºå¤šå­—èŠ‚å­—ç¬¦ç¼–ç ï¼Œå¦‚ UTF-8ï¼‰ã€‚å› æ­¤ï¼Œå½“ä½ è®¾ç½®äº†<code>highWaterMark</code>å¹¶æœŸæœ›æµèƒ½åœ¨è¾¾åˆ°æŸä¸ªå­—èŠ‚é•¿åº¦ååœæ­¢è¯»å–æ—¶ï¼Œå®é™…ä¸Šæµå¯èƒ½ä¼šå› ä¸ºå­—ç¬¦çš„åŸå› è¯»å–æ›´å¤šæˆ–æ›´å°‘çš„æ•°æ®ã€‚</p><h3 id="å®é™…è¿ç”¨çš„ä¾‹å­-26" tabindex="-1"><a class="header-anchor" href="#å®é™…è¿ç”¨çš„ä¾‹å­-26"><span>å®é™…è¿ç”¨çš„ä¾‹å­</span></a></h3><p>å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ Node.js å¼€å‘ä¸€ä¸ªåº”ç”¨ï¼Œéœ€è¦ä»ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­è¯»å–æ–‡æœ¬æ•°æ®è¿›è¡Œå¤„ç†ã€‚å¦‚æœè¿™ä¸ªæ–‡ä»¶éå¸¸å¤§ï¼Œç›´æ¥å…¨éƒ¨è¯»å–åˆ°å†…å­˜ä¸­å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå´©æºƒã€‚ä½¿ç”¨æµå¯ä»¥æ›´æœ‰æ•ˆåœ°å¤„ç†ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// å¼•å…¥fsæ¨¡å—</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;fs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// åˆ›å»ºä¸€ä¸ªå¯è¯»æµï¼Œä»æŒ‡å®šæ–‡ä»¶ä¸­è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> readableStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> fs</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">createReadStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;path/to/large/file.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // è®¾ç½®highWaterMark</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  highWaterMark</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">16</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// 16KB</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// è®¾ç½®ç¼–ç </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">setEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;utf8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬dataäº‹ä»¶è¯»å–æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">chunk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">`Received </span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">chunk</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">length</span><span style="--shiki-light:#032F62;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> characters of data.`</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  // å¤„ç†æ¯ä¸€ä¸ªæ•°æ®å—ï¼ˆchunkï¼‰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// ç›‘å¬endäº‹ä»¶ï¼Œè¡¨ç¤ºæ•°æ®è¯»å–å®Œæ¯•</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">readableStream</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Finished reading file.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›æ¯æ¬¡ä»æ–‡ä»¶ä¸­è¯»å–æœ€å¤š 16KB çš„æ•°æ®ã€‚ç„¶è€Œï¼Œä¸€æ—¦æˆ‘ä»¬é€šè¿‡<code>setEncoding(&#39;utf8&#39;)</code>è®¾ç½®äº†ç¼–ç ï¼Œå®é™…æ¯æ¬¡è¯»å–çš„å­—ç¬¦æ•°é‡å¯èƒ½ä¼šå› ä¸ºä¸Šè¿°çš„åŸå› ï¼ˆå³å­—ç¬¦ä¸å­—èŠ‚çš„è½¬æ¢ï¼‰è€Œæœ‰æ‰€ä¸åŒã€‚è¿™å°±æ˜¯<code>highWaterMark</code>çš„ä¸ä¸€è‡´é—®é¢˜ã€‚</p><p>ç†è§£è¿™ä¸€ç‚¹å¯¹äºå¼€å‘é«˜æ•ˆä¸”å¯é çš„åŸºäº Node.js çš„åº”ç”¨è‡³å…³é‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ã€‚åˆ©ç”¨æµå’Œåˆç†è®¾ç½®<code>highWaterMark</code>ï¼Œä½ å¯ä»¥æ§åˆ¶å†…å­˜ä½¿ç”¨ï¼Œé¿å…ç¨‹åºå› å ç”¨è¿‡å¤šå†…å­˜è€Œå´©æºƒã€‚</p></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: kamiacgxu@gmail.com">kamishima-kaede</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/document/node-doc/REPL.html" aria-label="REPL"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->REPL</div></a><a class="route-link auto-link next" href="/document/node-doc/String%20decoder.html" aria-label="String decoder"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">String decoder<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright Â© 2018-present hanekawa-shiki</div></footer></div><!--]--><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script src="/assets/js/runtime~app.28bb228f.js" defer></script><script src="/assets/js/6679.86a2b270.js" defer></script><script src="/assets/js/app.de91e5da.js" defer></script>
  </body>
</html>
